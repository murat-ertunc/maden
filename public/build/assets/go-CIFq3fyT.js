var Jn=Object.defineProperty;var $n=(_,b,ui)=>b in _?Jn(_,b,{enumerable:!0,configurable:!0,writable:!0,value:ui}):_[b]=ui;var g=(_,b,ui)=>$n(_,typeof b!="symbol"?b+"":b,ui);(function(){const _=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};_.requestAnimationFrame===void 0&&(_.setImmediate===void 0?_.requestAnimationFrame=w=>_.setTimeout(w,0):_.requestAnimationFrame=_.setImmediate);const Wt=class Wt{static Rk(e,t,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&Wt.Tg(s),s=Wt.ir(()=>{s=-1,i||e.apply(n,o)},t),i&&!s&&e.apply(n,o)}}static ir(e,t){return _.setTimeout(e,t)}static Tg(e){_.clearTimeout(e)}static hs(e){return _.document.createElement(e)}static o(e){throw new Error(e)}static L(e,t){let i="The object is frozen, so its properties cannot be set: "+e.toString();t!==void 0&&(i+="  to value: "+t),Wt.o(i)}static dE(e,t,i,s){}static s(e,t,i,s){}static gE(e,t,i){}static ec(e,t,i){(e===null||typeof e!="object")&&Wt.fC(t)}static k(e,t,i){}static mE(e,t,i){}static Zi(e,t,i,s){}static W(e,t,i,s){let n=Wt.fC(i);s!==void 0&&(n+="."+s),Wt.o(n+" is not in the range "+t+": "+e)}static Re(e){}static er(e,t){}static ni(e){_.console&&_.console.log(e)}static G(e){return e!==null&&typeof e=="object"}static it(e){return typeof e=="function"}static et(){const e=Wt.vk.pop();return e===void 0?[]:e}static J(e){e.length=0,Wt.vk.push(e)}static fC(e){return e===null?"*":typeof e=="string"?e:Wt.it(e)?e.name:""}static Dn(e){return Wt.it(e)?e.className?e.className:e.name:Wt.G(e)&&e.constructor?Wt.Dn(e.constructor):typeof e}static Uh(e,t){return t==null||t===""?null:Wt.G(e)&&t in e||e[t]?e[t]:null}static toString(e){let t=e;return Wt.G(e)&&(e.text?t=e.text:e.name?t=e.name:e.key!==void 0?t=e.key:e.id!==void 0?t=e.id:e.constructor===Object&&(e.Text?t=e.Text:e.Name?t=e.Name:e.Key!==void 0?t=e.Key:e.Id!==void 0?t=e.Id:e.ID!==void 0&&(t=e.ID))),t===void 0?"undefined":t===null?"null":t.toString()}static gw(e,t){if(e.hasOwnProperty(t))return!0;let i=Object.getPrototypeOf(e);for(;i&&i!==Function;){if(i.hasOwnProperty(t))return!0;const s=i.yE;if(s&&s[t])return!0;i=Object.getPrototypeOf(i)}return!1}static WD(e){const t=[];let i=0;for(i=0;i<256;i++)t[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+t[i]+119)%256,n=t[i],t[i]=t[s],t[s]=n;i=0,s=0;let o="";for(let r=0;r<e.length;r++)i=(i+1)%256,s=(s+t[i])%256,n=t[i],t[i]=t[s],t[s]=n,o+=String.fromCharCode(e.charCodeAt(r)^t[(t[i]+t[s])%256]);return o}static JD(e){const t="0123456789abcdef",i=[];for(let r=0;r<256;r++)i[t.charAt(r>>4)+t.charAt(r&15)]=String.fromCharCode(r);e.length%2&&(e="0"+e);const s=[];let n=0;for(let r=0;r<e.length;r+=2)s[n++]=i[e.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static Ts(e){return Wt.WD(Wt.JD(e))}};g(Wt,"tr",_.navigator!==void 0&&_.navigator.platform!==void 0&&_.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null),g(Wt,"vk",[]),g(Wt,"pE",Object.freeze([])),g(Wt,"color1","@COLOR1"),g(Wt,"color2","@COLOR2"),g(Wt,"mw","32ab5ff3b26f42dc0ed90f21412913b5");let b=Wt;b.vfo="29e646fdb160";class ui{constructor(){g(this,"Ok");this.Ok=[]}toString(){return this.Ok.join("")}add(e){e!==""&&this.Ok.push(e)}}class fe{}const qi=class qi{constructor(){g(this,"g");g(this,"key");g(this,"value");this.g=[]}[Symbol.iterator](){return this.g.values()}get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(e){return this}filter(){return this}get count(){return 0}ul(){}toString(){return"EmptyIterator"}};g(qi,"instance",new qi);let he=qi;class ti{constructor(e){g(this,"key");g(this,"value");this.key=-1,this.value=e}[Symbol.iterator](){return[this.value].values()}get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(e){return this.key=-1,e(this.value)}all(e){return this.key=-1,e(this.value)}each(e){return this.key=-1,e(this.value),this}map(e){return new ti(e(this.value))}filter(e){return e(this.value)?new ti(this.value):he.instance}get count(){return 1}ul(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class ei{constructor(e){g(this,"qt");g(this,"Ds");g(this,"Gt");g(this,"At");g(this,"key");g(this,"value");this.qt=e,this.Ds=null,e.sr=null,this.Gt=e.nt,this.At=-1}[Symbol.iterator](){return this.Ds===null?this.qt.r.values():this.qt.r.filter(this.Ds).values()}get iterator(){return this}get predicate(){return this.Ds}set predicate(e){this.Ds=e}reset(){const e=this.qt;e.sr=null,this.Gt=e.nt,this.At=-1}next(){const e=this.qt;if(e.nt!==this.Gt&&this.key<0)return!1;const t=e.r,i=t.length;let s=++this.At;const n=this.Ds;if(n!==null)for(;s<i;){const o=t[s];if(n(o))return this.At=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=t[s],!0;this.ul()}return!1}hasNext(){return this.next()}first(){const e=this.qt;this.Gt=e.nt,this.At=0;const t=e.r,i=t.length,s=this.Ds;if(s!==null){let n=0;for(;n<i;){const o=t[n];if(s(o))return this.At=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=t[0];return this.key=0,this.value=n,n}else return null}any(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const h=s[r];if(!(o!==null&&!o(h))){if(e(h))return!0;t.nt!==i&&b.Re(t)}}return!1}all(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const h=s[r];if(!(o!==null&&!o(h))){if(!e(h))return!1;t.nt!==i&&b.Re(t)}}return!0}each(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const h=s[r];o!==null&&!o(h)||(e(h),t.nt!==i&&b.Re(t))}return this}map(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=[],n=t.r,o=n.length,r=this.Ds;for(let a=0;a<o;a++){const l=n[a];r!==null&&!r(l)||(s.push(e(l)),t.nt!==i&&b.Re(t))}const h=new J;return h.r=s,h.ve(),h.iterator}filter(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=[],n=t.r,o=n.length,r=this.Ds;for(let a=0;a<o;a++){const l=n[a];r!==null&&!r(l)||(e(l)&&s.push(l),t.nt!==i&&b.Re(t))}const h=new J;return h.r=s,h.ve(),h.iterator}get count(){const e=this.Ds;if(e!==null){let t=0;const i=this.qt.r,s=i.length;for(let n=0;n<s;n++)e(i[n])&&t++;return t}else return this.qt.r.length}ul(){this.key=-1,this.value=null,this.Gt=-1,this.Ds=null,this.qt.sr=this}toString(){return"ListIterator@"+this.At+"/"+this.qt.count}}class vn{constructor(e){g(this,"qt");g(this,"Gt");g(this,"At");g(this,"key");g(this,"value");this.qt=e,e.nr=null,this.Gt=e.nt,this.At=e.r.length}[Symbol.iterator](){return this.qt.r.reverse().values()}get iterator(){return this}reset(){const e=this.qt;e.nr=null,this.Gt=e.nt,this.At=e.r.length}next(){const e=this.qt;if(e.nt!==this.Gt&&this.key<0)return!1;const t=--this.At;return t>=0?(this.key=t,this.value=e.r[t],!0):(this.ul(),!1)}hasNext(){return this.next()}first(){const e=this.qt;this.Gt=e.nt;const t=e.r,i=t.length-1;if(this.At=i,i>=0){const s=t[i];return this.key=i,this.value=s,s}else return null}any(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];if(e(r))return!0;t.nt!==i&&b.Re(t)}return!1}all(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!e(r))return!1;t.nt!==i&&b.Re(t)}return!0}each(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];e(r),t.nt!==i&&b.Re(t)}return this}map(e){const t=this.qt;t.nr=null;const i=t.nt,s=[],n=t.r,o=n.length;this.At=o;for(let h=o-1;h>=0;h--){const a=n[h];s.push(e(a)),t.nt!==i&&b.Re(t)}const r=new J;return r.r=s,r.ve(),r.iterator}filter(e){const t=this.qt;t.nr=null;const i=t.nt,s=[],n=t.r,o=n.length;this.At=o;for(let h=o-1;h>=0;h--){const a=n[h];e(a)&&s.push(a),t.nt!==i&&b.Re(t)}const r=new J;return r.r=s,r.ve(),r.iterator}get count(){return this.qt.r.length}ul(){this.key=-1,this.value=null,this.Gt=-1,this.qt.nr=this}toString(){return"ListIteratorBackwards("+this.At+"/"+this.qt.count+")"}}class J{constructor(e){g(this,"h");g(this,"r");g(this,"nt");g(this,"sr");g(this,"nr");K.Ki(this),this.h=!1,this.r=[],this.nt=0,this.sr=null,this.nr=null,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.r.values()}ve(){let e=this.nt;e++,e>999999999&&(e=0),this.nt=e}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"List()#"+K.as(this)}add(e){return this.h&&b.L(this,e),this.r.push(e),this.ve(),this}push(e){this.add(e)}addAll(e){if(e===null)return this;this.h&&b.L(this);const t=this.r;if(Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t.push(n)}}else{const i=e.iterator;for(;i.next();){const s=i.value;t.push(s)}}return this.ve(),this}clear(){this.h&&b.L(this),this.r.length=0,this.ve()}contains(e){return this.has(e)}has(e){return e===null?!1:this.r.indexOf(e)!==-1}indexOf(e){return e===null?-1:this.r.indexOf(e)}elt(e){const t=this.r;return(e<0||e>=t.length)&&b.W(e,"0 <= i < length",J,"elt:i"),t[e]}get(e){return this.elt(e)}setElt(e,t){const i=this.r;(e<0||e>=i.length)&&b.W(e,"0 <= i < length",J,"setElt:i"),this.h&&b.L(this,e),i[e]=t}set(e,t){this.setElt(e,t)}first(){const e=this.r;return e.length===0?null:e[0]}last(){const e=this.r,t=e.length;return t>0?e[t-1]:null}pop(){this.h&&b.L(this);const e=this.r;return e.length>0?e.pop():null}any(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++){if(e(t[n]))return!0;this.nt!==i&&b.Re(this)}return!1}all(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++){if(!e(t[n]))return!1;this.nt!==i&&b.Re(this)}return!0}each(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++)e(t[n]),this.nt!==i&&b.Re(this);return this}map(e){const t=new J,i=[],s=this.r,n=this.nt,o=s.length;for(let r=0;r<o;r++)i.push(e(s[r])),this.nt!==n&&b.Re(this);return t.r=i,t.ve(),t}filter(e){const t=new J,i=[],s=this.r,n=this.nt,o=s.length;for(let r=0;r<o;r++){const h=s[r];e(h)&&i.push(h),this.nt!==n&&b.Re(this)}return t.r=i,t.ve(),t}insertAt(e,t){e<0&&b.W(e,">= 0",J,"insertAt:i"),this.h&&b.L(this,e);const i=this.r;e>=i.length?i.push(t):i.splice(e,0,t),this.ve()}remove(e){return this.delete(e)}delete(e){if(e===null)return!1;this.h&&b.L(this,e);const t=this.r,i=t.indexOf(e);return i===-1?!1:(i===t.length-1?t.pop():t.splice(i,1),this.ve(),!0)}removeAt(e){const t=this.r;(e<0||e>=t.length)&&b.W(e,"0 <= i < length",J,"removeAt:i"),this.h&&b.L(this,e),e===t.length-1?t.pop():t.splice(e,1),this.ve()}removeRange(e,t){const i=this.r,s=i.length;if(e<0)e=0;else if(e>=s)return this;if(t<0)return this;if(t>=s&&(t=s-1),e>t)return this;this.h&&b.L(this);let n=e,o=t+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(t-e+1),this.ve(),this}copy(){const e=new J,t=this.r;return t.length>0&&(e.r=Array.prototype.slice.call(t)),e}toArray(){const e=this.r,t=this.count,i=new Array(t);for(let s=0;s<t;s++)i[s]=e[s];return i}get uC(){return this.r}toSet(){const e=new K,t=this.r,i=this.count;for(let s=0;s<i;s++)e.add(t[s]);return e}sort(e){return this.h&&b.L(this),this.r.sort(e),this.ve(),this}sortRange(e,t,i){const s=this.r,n=s.length;t===void 0&&(t=0),i===void 0&&(i=n),this.h&&b.L(this);const o=i-t;if(o<=1)return this;if((t<0||t>=n-1)&&b.W(t,"0 <= from < length",J,"sortRange:from"),o===2){const r=s[t],h=s[t+1];return e(r,h)>0&&(s[t]=h,s[t+1]=r,this.ve()),this}if(t===0)if(i>=n)s.sort(e);else{const r=s.slice(0,i);r.sort(e);for(let h=0;h<i;h++)s[h]=r[h]}else if(i>=n){const r=s.slice(t);r.sort(e);for(let h=t;h<n;h++)s[h]=r[h-t]}else{const r=s.slice(t,i);r.sort(e);for(let h=t;h<i;h++)s[h]=r[h-t]}return this.ve(),this}reverse(){return this.h&&b.L(this),this.r.reverse(),this.ve(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return he.instance;const e=this.sr;return e!==null?(e.reset(),e):new ei(this)}get iteratorBackwards(){if(this.r.length<=0)return he.instance;const e=this.nr;return e!==null?(e.reset(),e):new vn(this)}}class kn{constructor(e){g(this,"wo");g(this,"ii");g(this,"key");g(this,"value");this.wo=e,this.ii=e.g.values()}[Symbol.iterator](){return this.wo.g.values()}get iterator(){return this}reset(){const e=this.wo;this.ii=e.g.values()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.wo.g.size===0?null:(this.ii=this.wo.g.values(),this.ii.next().value)}any(e){return this.wo.any(e)}all(e){return this.wo.all(e)}each(e){return this.wo.each(e),this}map(e){const t=new J;return this.wo.g.forEach(i=>t.add(e(i))),t.iterator}filter(e){const t=new J;return this.wo.g.forEach(i=>{e(i)&&t.add(i)}),t.iterator}get count(){return this.wo.count}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"SetIterator"}}const je=class je{constructor(e){g(this,"h");g(this,"g");this.h=!1,this.g=new Set,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"Set()#"+je.as(this)}add(e){return e===null?this:(this.g.add(e),this)}addAll(e){if(e===null)return this;if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s!==null&&this.g.add(s)}}else{const t=e.iterator;for(;t.next();){const i=t.value;i!==null&&this.g.add(i)}}return this}has(e){return this.g.has(e)}contains(e){return this.has(e)}containsAll(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(!this.has(t.value))return!1;return!0}containsAny(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(this.has(t.value))return!0;return!1}first(){return this.g.size===0?null:this.g.values().next().value}any(e){for(const t of this.g)if(e(t))return!0;return!1}all(e){for(const t of this.g)if(!e(t))return!1;return!0}each(e){for(const t of this.g)e(t);return this}map(e){const t=new je;for(const i of this.g)t.add(e(i));return t}filter(e){const t=new je;for(const i of this.g)e(i)&&t.add(i);return t}delete(e){return this.h&&b.L(this),this.g.delete(e)}remove(e){return this.delete(e)}removeAll(e){if(e===null)return this;if(this.h&&b.L(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.delete(e[i])}else{const t=e.iterator;for(;t.next();)this.delete(t.value)}return this}retainAll(e){if(e===null)return this;if(this.count===0)return this;this.h&&b.L(this);const t=new je;t.addAll(e);const i=[],s=this.iterator;for(;s.next();){const n=s.value;t.has(n)||i.push(n)}return this.removeAll(i),this}clear(){this.h&&b.L(this),this.g.clear()}copy(){const e=new je;return this.g.forEach(t=>e.add(t)),e}toArray(){return Array.from(this.g)}toList(){const e=new J;return this.g.forEach(t=>e.add(t)),e}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?he.instance:new kn(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(e,t){return this.g.forEach(e,t)}static Ki(e){e.__gohashid=je.pw++}static as(e){return e.__gohashid}};g(je,"pw",1);let K=je;class Rs{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.keys()}[Symbol.iterator](){return this.q.g.keys()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.keys()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.ii=this.q.g.keys(),this.ii.next().value)}any(e){for(const t of this.q.g)if(e(t[0]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.q.g)e(t[0]);return this}map(e){const t=this.q,i=new J;for(const s of t.g)i.add(e(s[0]));return i.iterator}filter(e){const t=this.q,i=new J;for(const s of t.g){const n=s[0];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapKeySetIterator"}}class Ji extends K{constructor(t){super();g(this,"q");K.Ki(this),this.h=!0,this.q=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}u(){return this}Pt(){return this}toString(){return"MapKeySet("+this.q.toString()+")"}add(t){b.o("This Set is read-only: "+this.toString())}has(t){return this.q.has(t)}contains(t){return this.has(t)}delete(t){b.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){b.o("This Set is read-only: "+this.toString())}first(){return this.q.g.size===0?null:this.q.g.keys().next().value}any(t){for(const i of this.q.g)if(t(i[0]))return!0;return!1}all(t){for(const i of this.q.g)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.q.g)t(i[0]);return this}map(t){const i=new K;for(const s of this.q.g)i.add(t(s[0]));return i}filter(t){const i=new K;for(const s of this.q.g){const n=s[0];t(n)&&i.add(n)}return i}copy(){return new Ji(this.q)}toSet(){const t=new K,i=this.q.g;for(const s of i)t.add(s[0]);return t}toArray(){const t=this.q.g,i=new Array(t.size);let s=0;for(const n of t)i[s]=n[0],s++;return i}toList(){const t=new J,i=this.q.g;for(const s of i)t.add(s[0]);return t}get count(){return this.q.size}get size(){return this.q.size}get iterator(){return this.q.size<=0?he.instance:new Rs(this.q)}}class Pn{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.values()}[Symbol.iterator](){return this.q.g.values()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.values()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.ii=this.q.g.values(),this.ii.next().value)}any(e){for(const t of this.q.g)if(e(t[1]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[1]))return!1;return!0}each(e){for(const t of this.q.g)e(t[1]);return this}map(e){const t=this.q,i=new J;for(const s of t.g)i.add(e(s[1]));return i.iterator}filter(e){const t=this.q,i=new J;for(const s of t.g){const n=s[1];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapValueSetIterator"}}class Le{constructor(e,t){g(this,"key");g(this,"value");this.key=e,this.value=t}toString(){return"{"+this.key+":"+this.value+"}"}}class Sn{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.entries()}[Symbol.iterator](){return this.q.g.entries()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.entries()}next(){const e=this.ii.next();return e.done?(this.key=null,this.value=null,!1):(this.key=e.value[0],this.value=e.value[1],!0)}hasNext(){return this.next()}first(){if(this.q.g.size===0)return null;this.ii=this.q.g.entries();const e=this.ii.next().value;return this.key=e[0],this.value=e[1],new Le(e[0],e[1])}any(e){return this.q.any(e)}all(e){return this.q.all(e)}each(e){return this.q.each(e),this}map(e){const t=new J;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new Le(n,s):(i.key=n,i.value=s),t.add(e(i))}),t.iterator}filter(e){const t=new J;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new Le(n,s):(i.key=n,i.value=s),e(i)&&(t.add(i),i=null)}),t.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapIterator"}}class bt{constructor(e){g(this,"h");g(this,"g");K.Ki(this),this.h=!1,this.g=new Map,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"Map()#"+K.as(this)}set(e,t){return this.h&&b.L(this,e),this.g.set(e,t),this}add(e,t){return this.set(e,t)}addAll(e){if(e===null)return this;if(this.h&&b.L(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];this.set(s.key,s.value)}}else if(e instanceof bt){const t=e.iterator;for(;t.next();)this.set(t.key,t.value)}else{const t=e.iterator;for(;t.next();){const i=t.value;this.set(i.key,i.value)}}return this}first(){if(this.g.size===0)return null;const e=this.g.entries().next().value;return new Le(e[0],e[1])}any(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new Le(i,s):(t.key=i,t.value=s),e(t))return!0;return!1}all(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new Le(i,s):(t.key=i,t.value=s),!e(t))return!1;return!0}each(e){let t=null;for(const[i,s]of this.g)t===null?t=new Le(i,s):(t.key=i,t.value=s),e(t);return this}map(e){const t=new bt;let i=null;for(const[s,n]of this.g)i===null?i=new Le(s,n):(i.key=s,i.value=n),t.set(s,e(i));return t}filter(e){const t=new bt;let i=null;for(const[s,n]of this.g)i===null?i=new Le(s,n):(i.key=s,i.value=n),e(i)&&t.set(s,n);return t}has(e){return this.g.has(e)}contains(e){return this.has(e)}get(e){const t=this.g.get(e);return t===void 0?null:t}getValue(e){return this.get(e)}delete(e){return e===null?!1:(this.h&&b.L(this,e),this.g.delete(e))}remove(e){return this.delete(e)}clear(){this.h&&b.L(this),this.g.clear()}copy(){const e=new bt;return e.g=new Map(this.g),e}toArray(){const e=this.g,t=new Array(e.size);let i=0;for(const s of e)t[i]=new Le(s[0],s[1]),i++;return t}toKeySet(){return new Ji(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?he.instance:new Sn(this)}get iteratorKeys(){return this.count<=0?he.instance:new Rs(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?he.instance:new Pn(this)}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}}const _t=class _t{constructor(e,t){g(this,"px");g(this,"py");g(this,"h");e===void 0?(this.px=0,this.py=0):typeof e=="number"&&typeof t=="number"?(this.px=e,this.py=t):b.o("Invalid arguments to Point constructor: "+e+", "+t),this.h=!1}a(e){return this.px=e.px,this.py=e.py,this}i(e,t){return this.px=e,this.py=t,this}setTo(e,t){return this.px=e,this.py=t,this}set(e){return this.px=e.px,this.py=e.py,this}copy(){const e=new _t;return e.px=this.px,e.py=this.py,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new _t(s,o)}else return new _t}static stringify(e){return e.x.toString()+" "+e.y.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(e){return e instanceof _t?this.px===e.x&&this.py===e.y:!1}equalTo(e,t){return this.px===e&&this.py===t}equalsApprox(e){return A.f(this.px,e.x)&&A.f(this.py,e.y)}add(e){return this.px+=e.x,this.py+=e.y,this}subtract(e){return this.px-=e.x,this.py-=e.y,this}offset(e,t){return this.px+=e,this.py+=t,this}rotate(e){if(e===0)return this;const t=this.px,i=this.py;if(t===0&&i===0)return this;let s=0,n=0;if(e>=360?e-=360:e<0&&(e+=360),e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const o=e*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*t-n*i,this.py=n*t+s*i,this}scale(e,t){return this.px*=e,this.py*=t,this}distanceSquaredPoint(e){const t=e.x-this.px,i=e.y-this.py;return t*t+i*i}distanceSquared(e,t){const i=e-this.px,s=t-this.py;return i*i+s*s}normalize(){const e=this.px,t=this.py,i=Math.sqrt(e*e+t*t);return i>0&&(this.px=e/i,this.py=t/i),this}directionPoint(e){return this.dC(e.x-this.px,e.y-this.py)}direction(e,t){return this.dC(e-this.px,t-this.py)}dC(e,t){if(e===0)return t>0?90:t<0?270:0;if(t===0)return e>0?0:180;{if(isNaN(e)||isNaN(t))return 0;let i=Math.atan(Math.abs(t/e))*180/Math.PI;return e<0?t<0?i+=180:i=180-i:t<0&&(i=360-i),i}}static compareWithLineSegment(e,t,i,s,n,o){return A.eu(e,t,i,s,n,o)}compareWithLineSegmentPoint(e,t){return A.eu(e.x,e.y,t.x,t.y,this.x,this.y)}static intersectingLineSegments(e,t,i,s,n,o,r,h){return A.su(e,t,i,s,n,o,r,h)}projectOntoLineSegment(e,t,i,s){return A.dl(e,t,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(e,t){return A.dl(e.x,e.y,t.x,t.y,this.px,this.py,this),this}snapToGrid(e,t,i,s){return A.Dg(this.px,this.py,e,t,i,s,this),this}snapToGridPoint(e,t){return A.Dg(this.px,this.py,e.x,e.y,t.width,t.height,this),this}setRectSpot(e,t){return this.px=e.x+t.x*e.width+t.offsetX,this.py=e.y+t.y*e.height+t.offsetY,this}setSpot(e,t,i,s,n){return this.px=e+n.x*i+n.offsetX,this.py=t+n.y*s+n.offsetY,this}T(e){return e.gt(this),this}Oe(e){return e.$e(this),this}static distanceLineSegmentSquared(e,t,i,s,n,o){let r=n-i,h=o-s;const a=r*r+h*h,l=i-e,u=s-t,c=-l*r-u*h;if(c<=0||c>=a)return r=n-e,h=o-t,Math.min(l*l+u*u,r*r+h*h);{const d=r*u-h*l;return d*d/a}}static distanceSquared(e,t,i,s){const n=i-e,o=s-t;return n*n+o*o}static direction(e,t,i,s){const n=i-e,o=s-t;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.px}set x(e){this.px=e}get y(){return this.py}set y(e){this.py=e}isReal(){return isFinite(this.x)&&isFinite(this.y)}static l(){const e=_t.Ek.pop();return e===void 0?new _t:e}static V(e,t){const i=_t.Ek.pop();return i===void 0?new _t(e,t):(i.x=e,i.y=t,i)}static e(e){_t.Ek.push(e)}};g(_t,"xo",new _t(0,0).$()),g(_t,"gC",new _t(-1/0,-1/0).$()),g(_t,"mC",new _t(1/0,1/0).$()),g(_t,"pC",new _t(6,6).$()),g(_t,"Ik",new _t(NaN,NaN).$()),g(_t,"Ek",[]);let S=_t;const jt=class jt{constructor(e,t){g(this,"sw");g(this,"sh");g(this,"h");e===void 0?(this.sw=0,this.sh=0):typeof e=="number"&&(e>=0||isNaN(e))&&typeof t=="number"&&(t>=0||isNaN(t))?(this.sw=e,this.sh=t):b.o("Invalid arguments to Size constructor: "+e+", "+t),this.h=!1}a(e){return this.sw=e.sw,this.sh=e.sh,this}i(e,t){return this.sw=e,this.sh=t,this}setTo(e,t){return this.sw=e,this.sh=t,this}set(e){return this.sw=e.sw,this.sh=e.sh,this}copy(){const e=new jt;return e.sw=this.sw,e.sh=this.sh,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new jt(s,o)}else return new jt}static stringify(e){return e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(e){return e instanceof jt?this.sw===e.width&&this.sh===e.height:!1}equalTo(e,t){return this.sw===e&&this.sh===t}equalsApprox(e){return A.f(this.sw,e.width)&&A.f(this.sh,e.height)}inflate(e,t){const i=this.width+e;this.sw=i>=0?i:0;const s=this.height+t;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(e){e<0&&b.W(e,">= 0",jt,"width"),this.sw=e}get height(){return this.sh}set height(e){e<0&&b.W(e,">= 0",jt,"height"),this.sh=e}isReal(){return isFinite(this.width)&&isFinite(this.height)}static l(){const e=jt.xC.pop();return e===void 0?new jt:e}static e(e){jt.xC.push(e)}};g(jt,"sc",new jt(0,0).$()),g(jt,"Uk",new jt(1,1).$()),g(jt,"yC",new jt(6,6).$()),g(jt,"nu",new jt(8,8).$()),g(jt,"wC",new jt(10,10).$()),g(jt,"Bk",new jt(1/0,1/0).$()),g(jt,"ww",new jt(NaN,NaN).$()),g(jt,"xC",[]);let ot=jt;const oe=class oe{constructor(e,t,i,s){g(this,"rx");g(this,"ry");g(this,"rw");g(this,"rh");g(this,"h");if(e===void 0)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.rx=e,this.ry=t,this.rw=i,this.rh=s;else if(e instanceof S){const n=e.x,o=e.y;if(t instanceof S){const r=t.x,h=t.y;this.rx=Math.min(n,r),this.ry=Math.min(o,h),this.rw=Math.abs(n-r),this.rh=Math.abs(o-h)}else t instanceof ot?(this.rx=n,this.ry=o,this.rw=t.width,this.rh=t.height):b.o("Incorrect second argument supplied to Rect constructor "+t)}else b.o("Invalid arguments to Rect constructor: "+e+", "+t+", "+i+", "+s);this.h=!1}a(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}i(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}Fn(e,t){return this.rw=e,this.rh=t,this}setTo(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}set(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}setPoint(e){return this.rx=e.x,this.ry=e.y,this}setSize(e){return this.rw=e.width,this.rh=e.height,this}copy(){const e=new oe;return e.rx=this.rx,e.ry=this.ry,e.rw=this.rw,e.rh=this.rh,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n&&(r=parseFloat(n));let h=0;for(;t[i]==="";)i++;return n=t[i++],n&&(h=parseFloat(n)),new oe(s,o,r,h)}else return new oe}static stringify(e){return e.x.toString()+" "+e.y.toString()+" "+e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(e){return e instanceof oe?this.rx===e.x&&this.ry===e.y&&this.rw===e.width&&this.rh===e.height:!1}equalTo(e,t,i,s){return this.rx===e&&this.ry===t&&this.rw===i&&this.rh===s}equalsApprox(e){return A.f(this.rx,e.x)&&A.f(this.ry,e.y)&&A.f(this.rw,e.width)&&A.f(this.rh,e.height)}equalsApproxTo(e,t,i,s){return A.f(this.rx,e)&&A.f(this.ry,t)&&A.f(this.rw,i)&&A.f(this.rh,s)}equalsApproxClose(e){return A.z(this.rx,e.x)&&A.z(this.ry,e.y)&&A.z(this.rw,e.width)&&A.z(this.rh,e.height)}containsPoint(e){return this.rx<=e.x&&this.rx+this.rw>=e.x&&this.ry<=e.y&&this.ry+this.rh>=e.y}containsRect(e){return this.rx<=e.x&&e.x+e.width<=this.rx+this.rw&&this.ry<=e.y&&e.y+e.height<=this.ry+this.rh}contains(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.rx<=e&&e+i<=this.rx+this.rw&&this.ry<=t&&t+s<=this.ry+this.rh}offset(e,t){return this.rx+=e,this.ry+=t,this}inflate(e,t){return this.xw(t,e,t,e)}addMargin(e){return this.xw(e.top,e.right,e.bottom,e.left)}subtractMargin(e){return this.xw(-e.top,-e.right,-e.bottom,-e.left)}grow(e,t,i,s){return this.xw(e,t,i,s)}xw(e,t,i,s){const n=this.rw;t+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=t+s);const o=this.rh;return e+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=e,this.rh+=e+i),this}intersectRect(e){return this.bC(e.x,e.y,e.width,e.height)}intersect(e,t,i,s){return this.bC(e,t,i,s)}bC(e,t,i,s){const n=Math.max(this.rx,e),o=Math.max(this.ry,t),r=Math.min(this.rx+this.rw,e+i),h=Math.min(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,h-o),this}intersectsRect(e){return this.intersects(e.x,e.y,e.width,e.height)}intersects(e,t,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=e,isNaN(i)||isNaN(n)||o>i||e>n))return!1;let r=this.rh;const h=this.ry;return!(r!==1/0&&s!==1/0&&(r+=h,s+=t,isNaN(s)||isNaN(r)||h>s||t>r))}intersectsRectPlus(e,t){let i=this.rw,s=e.width+t+t;const n=this.rx,o=e.x-t;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,h=e.height+t+t;const a=this.ry,l=e.y-t;return r+=a,h+=l,!(a>h||l>r)}unionPoint(e){return this.unionNoCheck(e.x,e.y,0,0)}unionRect(e){return this.unionNoCheck(e.rx,e.ry,e.rw,e.rh)}union(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.unionNoCheck(e,t,i,s)}unionNoCheck(e,t,i,s){const n=Math.min(this.rx,e),o=Math.min(this.ry,t),r=Math.max(this.rx+this.rw,e+i),h=Math.max(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=h-o,this}setSpot(e,t,i){return this.rx=e-i.offsetX-i.x*this.rw,this.ry=t-i.offsetY-i.y*this.rh,this}static contains(e,t,i,s,n,o,r,h){return r===void 0&&(r=0),h===void 0&&(h=0),e<=n&&n+r<=e+i&&t<=o&&o+h<=t+s}static intersects(e,t,i,s,n,o,r,h){let a=i,l=r;const u=e,c=n;if(a+=u,l+=c,u>l||c>a)return!1;let d=s,f=h;const m=t,p=o;return d+=m,f+=p,!(m>f||p>d)}static intersectsLineSegment(e,t,i,s,n,o,r,h){return A.kC(e,t,i,s,n,o,r,h)}get x(){return this.rx}set x(e){this.rx=e}get y(){return this.ry}set y(e){this.ry=e}get width(){return this.rw}set width(e){e<0&&b.W(e,">= 0",oe,"width"),this.rw=e}get height(){return this.rh}set height(e){e<0&&b.W(e,">= 0",oe,"height"),this.rh=e}get left(){return this.rx}set left(e){this.rx=e}get top(){return this.ry}set top(e){this.ry=e}get right(){return this.rx+this.rw}set right(e){this.rx+=e-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(e){this.ry+=e-(this.ry+this.rh)}get position(){return new S(this.rx,this.ry)}set position(e){this.rx=e.x,this.ry=e.y}get size(){return new ot(this.rw,this.rh)}set size(e){this.rw=e.width,this.rh=e.height}get center(){return new S(this.rx+this.rw/2,this.ry+this.rh/2)}set center(e){this.rx=e.x-this.rw/2,this.ry=e.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(e){this.rx=e-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(e){this.ry=e-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static l(){const e=oe.Vk.pop();return e===void 0?new oe:e}static V(e,t,i,s){const n=oe.Vk.pop();return n===void 0?new oe(e,t,i,s):n.i(e,t,i,s)}static e(e){oe.Vk.push(e)}};g(oe,"Fg",new oe(0,0,0,0).$()),g(oe,"$D",new oe(NaN,NaN,NaN,NaN).$()),g(oe,"Vk",[]);let z=oe;const re=class re{constructor(e,t,i,s){g(this,"mt");g(this,"mr");g(this,"mb");g(this,"ml");g(this,"h");e===void 0?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):t===void 0?(t=e,i=e,s=e,this.mt=e,this.mr=t,this.mb=i,this.ml=s):i===void 0?(i=e,s=t,this.mt=e,this.mr=t,this.mb=i,this.ml=s):s!==void 0?(this.mt=e,this.mr=t,this.mb=i,this.ml=s):b.o("Invalid arguments to Margin constructor: "+e+", "+t+", "+i+", "+s),this.h=!1}a(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}setTo(e,t,i,s){return this.mt=e,this.mr=t,this.mb=i,this.ml=s,this}set(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}copy(){const e=new re;return e.mt=this.mt,e.mr=this.mr,e.mb=this.mb,e.ml=this.ml,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=NaN;for(;t[i]==="";)i++;let n=t[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new re;let o=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(o=parseFloat(n)),isNaN(o))return new re(s);let r=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(r=parseFloat(n)),isNaN(r))return new re(s,o);let h=NaN;for(;t[i]==="";)i++;return n=t[i++],n&&(h=parseFloat(n)),isNaN(h)?new re(s,o):new re(s,o,r,h)}else return new re}static stringify(e){return e.top.toString()+" "+e.right.toString()+" "+e.bottom.toString()+" "+e.left.toString()}static stringifyFixed(e){return t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(e){return e instanceof re?this.mt===e.top&&this.mr===e.right&&this.mb===e.bottom&&this.ml===e.left:!1}equalTo(e,t,i,s){return this.mt===e&&this.mr===t&&this.mb===i&&this.ml===s}equalsApprox(e){return A.f(this.mt,e.top)&&A.f(this.mr,e.right)&&A.f(this.mb,e.bottom)&&A.f(this.ml,e.left)}get top(){return this.mt}set top(e){this.mt=e}get right(){return this.mr}set right(e){this.mr=e}get bottom(){return this.mb}set bottom(e){this.mb=e}get left(){return this.ml}set left(e){this.ml=e}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static l(){const e=re.SC.pop();return e===void 0?new re:e}static e(e){re.SC.push(e)}};g(re,"Rg",new re(0,0,0,0).$()),g(re,"PC",new re(2,2,2,2).$()),g(re,"SC",[]);let Ot=re;const G=class G{constructor(e,t,i,s){g(this,"sx");g(this,"sy");g(this,"ox");g(this,"oy");g(this,"h");e===void 0?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=0),this.sx=e,this.sy=t,this.ox=i,this.oy=s),this.h=!1}a(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}setTo(e,t,i,s){return this.sx=e,this.sy=t,this.ox=i,this.oy=s,this}set(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}copy(){const e=new G;return e.sx=this.sx,e.sy=this.sy,e.ox=this.ox,e.oy=this.oy,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&b.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}Ie(e){return this.sx=NaN,this.sy=NaN,this.ox=e,this}wE(e,t){(isNaN(e)||e>1||e<0)&&b.W(e,"0 <= "+t+" <= 1",G,t)}xE(e,t){(isNaN(e)||e===1/0||e===-1/0)&&b.W(e,"real number, not NaN or Infinity",G,t)}static parse(e){if(typeof e=="string"){if(e=e.trim(),e==="None")return G.None;if(e==="TopLeft")return G.TopLeft;if(e==="Top"||e==="TopCenter"||e==="MiddleTop")return G.TopCenter;if(e==="TopRight")return G.TopRight;if(e==="Left"||e==="LeftCenter"||e==="MiddleLeft")return G.LeftCenter;if(e==="Center")return G.Center;if(e==="Right"||e==="RightCenter"||e==="MiddleRight")return G.RightCenter;if(e==="BottomLeft")return G.BottomLeft;if(e==="Bottom"||e==="BottomCenter"||e==="MiddleBottom")return G.BottomCenter;if(e==="BottomRight")return G.BottomRight;if(e==="TopSide")return G.TopSide;if(e==="LeftSide")return G.LeftSide;if(e==="RightSide")return G.RightSide;if(e==="BottomSide")return G.BottomSide;if(e==="TopBottomSides")return G.TopBottomSides;if(e==="LeftRightSides")return G.LeftRightSides;if(e==="TopLeftSides")return G.TopLeftSides;if(e==="TopRightSides")return G.TopRightSides;if(e==="BottomLeftSides")return G.BottomLeftSides;if(e==="BottomRightSides")return G.BottomRightSides;if(e==="NotTopSide")return G.NotTopSide;if(e==="NotLeftSide")return G.NotLeftSide;if(e==="NotRightSide")return G.NotRightSide;if(e==="NotBottomSide")return G.NotBottomSide;if(e==="AllSides")return G.AllSides;if(e==="Default")return G.Default;const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(r=parseFloat(n));let h=0;for(;t[i]==="";)i++;return n=t[i++],n!==void 0&&n.length>0&&(h=parseFloat(n)),new G(s,o,r,h)}else return new G}static stringify(e){return e.isSpot()?e.x.toString()+" "+e.y.toString()+" "+e.offsetX.toString()+" "+e.offsetY.toString():e.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?this.ox===0&&this.oy===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(G.None)?"None":this.equals(G.TopLeft)?"TopLeft":this.equals(G.TopCenter)?"Top":this.equals(G.TopRight)?"TopRight":this.equals(G.LeftCenter)?"Left":this.equals(G.Center)?"Center":this.equals(G.RightCenter)?"Right":this.equals(G.BottomLeft)?"BottomLeft":this.equals(G.BottomCenter)?"Bottom":this.equals(G.BottomRight)?"BottomRight":this.equals(G.TopSide)?"TopSide":this.equals(G.LeftSide)?"LeftSide":this.equals(G.RightSide)?"RightSide":this.equals(G.BottomSide)?"BottomSide":this.equals(G.TopBottomSides)?"TopBottomSides":this.equals(G.LeftRightSides)?"LeftRightSides":this.equals(G.TopLeftSides)?"TopLeftSides":this.equals(G.TopRightSides)?"TopRightSides":this.equals(G.BottomLeftSides)?"BottomLeftSides":this.equals(G.BottomRightSides)?"BottomRightSides":this.equals(G.NotTopSide)?"NotTopSide":this.equals(G.NotLeftSide)?"NotLeftSide":this.equals(G.NotRightSide)?"NotRightSide":this.equals(G.NotBottomSide)?"NotBottomSide":this.equals(G.AllSides)?"AllSides":this.equals(G.Default)?"Default":"None"}equals(e){return e instanceof G?(this.sx===e.x||isNaN(this.sx)&&isNaN(e.x))&&(this.sy===e.y||isNaN(this.sy)&&isNaN(e.y))&&this.ox===e.offsetX&&this.oy===e.offsetY:!1}opposite(){return new G(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(e){if(!this.isSide())return!1;if(!e.isSide())if(e.equals(G.Left))e=G.LeftSide;else if(e.equals(G.Right))e=G.RightSide;else if(e.equals(G.Top))e=G.TopSide;else if(e.equals(G.Bottom))e=G.BottomSide;else return!1;const t=this.oy,i=e.offsetY;return(t&i)===i}get x(){return this.sx}set x(e){this.sx=e}get y(){return this.sy}set y(e){this.sy=e}get offsetX(){return this.ox}set offsetX(e){this.ox=e}get offsetY(){return this.oy}set offsetY(e){this.oy=e}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static l(){const e=G.MC.pop();return e===void 0?new G:e}static e(e){G.MC.push(e)}};g(G,"None",new G(0,0,0,0).Ie(0).$()),g(G,"Default",new G(0,0,-1,0).Ie(-1).$()),g(G,"TopLeft",new G(0,0,0,0).$()),g(G,"TopCenter",new G(.5,0,0,0).$()),g(G,"TopRight",new G(1,0,0,0).$()),g(G,"LeftCenter",new G(0,.5,0,0).$()),g(G,"Center",new G(.5,.5,0,0).$()),g(G,"RightCenter",new G(1,.5,0,0).$()),g(G,"BottomLeft",new G(0,1,0,0).$()),g(G,"BottomCenter",new G(.5,1,0,0).$()),g(G,"BottomRight",new G(1,1,0,0).$()),g(G,"MiddleTop",G.TopCenter),g(G,"MiddleLeft",G.LeftCenter),g(G,"MiddleRight",G.RightCenter),g(G,"MiddleBottom",G.BottomCenter),g(G,"Top",G.TopCenter),g(G,"Left",G.LeftCenter),g(G,"Right",G.RightCenter),g(G,"Bottom",G.BottomCenter),g(G,"TopSide",new G(0,0,1,1).Ie(1).$()),g(G,"LeftSide",new G(0,0,1,2).Ie(1).$()),g(G,"RightSide",new G(0,0,1,4).Ie(1).$()),g(G,"BottomSide",new G(0,0,1,8).Ie(1).$()),g(G,"TopBottomSides",new G(0,0,1,9).Ie(1).$()),g(G,"LeftRightSides",new G(0,0,1,6).Ie(1).$()),g(G,"TopLeftSides",new G(0,0,1,3).Ie(1).$()),g(G,"TopRightSides",new G(0,0,1,5).Ie(1).$()),g(G,"BottomLeftSides",new G(0,0,1,10).Ie(1).$()),g(G,"BottomRightSides",new G(0,0,1,12).Ie(1).$()),g(G,"NotTopSide",new G(0,0,1,14).Ie(1).$()),g(G,"NotLeftSide",new G(0,0,1,13).Ie(1).$()),g(G,"NotRightSide",new G(0,0,1,11).Ie(1).$()),g(G,"NotBottomSide",new G(0,0,1,7).Ie(1).$()),g(G,"AllSides",new G(0,0,1,15).Ie(1).$()),g(G,"zk",new G(.156,.156).$()),g(G,"Xk",new G(.844,.844).$()),g(G,"MC",[]);let B=G;const Qe=class Qe{constructor(){g(this,"m11");g(this,"m12");g(this,"m21");g(this,"m22");g(this,"dx");g(this,"dy");this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(e){return this.m11=e.m11,this.m12=e.m12,this.m21=e.m21,this.m22=e.m22,this.dx=e.dx,this.dy=e.dy,this}setTo(e,t,i,s,n,o){return this.m11=e,this.m12=t,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const e=new Qe;return e.m11=this.m11,e.m12=this.m12,e.m21=this.m21,e.m22=this.m22,e.dx=this.dx,e.dy=this.dy,e}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(e){return this.m11===e.m11&&this.m12===e.m12&&this.m21===e.m21&&this.m22===e.m22&&this.dx===e.dx&&this.dy===e.dy}Yk(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ri(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}nc(e){const t=this.m11*e.m11+this.m21*e.m12,i=this.m12*e.m11+this.m22*e.m12,s=this.m11*e.m21+this.m21*e.m22,n=this.m12*e.m21+this.m22*e.m22;return this.dx=this.m11*e.dx+this.m21*e.dy+this.dx,this.dy=this.m12*e.dx+this.m22*e.dy+this.dy,this.m11=t,this.m12=i,this.m21=s,this.m22=n,this}NC(e){const t=1/(e.m11*e.m22-e.m12*e.m21),i=e.m22*t,s=-e.m12*t,n=-e.m21*t,o=e.m11*t,r=t*(e.m21*e.dy-e.m22*e.dx),h=t*(e.m12*e.dx-e.m11*e.dy),a=this.m11*i+this.m21*s,l=this.m12*i+this.m22*s,u=this.m11*n+this.m21*o,c=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*h+this.dx,this.dy=this.m12*r+this.m22*h+this.dy,this.m11=a,this.m12=l,this.m21=u,this.m22=c,this}bw(){const e=1/(this.m11*this.m22-this.m12*this.m21),t=this.m22*e,i=-this.m12*e,s=-this.m21*e,n=this.m11*e,o=e*(this.m21*this.dy-this.m22*this.dx),r=e*(this.m12*this.dx-this.m11*this.dy);return this.m11=t,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}cs(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return this;this.Fs(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,h=this.m11*-n+this.m21*s,a=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=h,this.m22=a,this.Fs(-t,-i),this}Fs(e,t){return this.dx+=this.m11*e+this.m21*t,this.dy+=this.m12*e+this.m22*t,this}tt(e,t){return t===void 0&&(t=e),this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}ZD(){if(this.m11===1&&this.m12===0)return 0;let e=Math.atan2(this.m12,this.m11)*180/Math.PI;return e<0&&(e+=360),e}gt(e){const t=e.x,i=e.y;return e.i(t*this.m11+i*this.m21+this.dx,t*this.m12+i*this.m22+this.dy)}$e(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=e.x-this.dx,h=e.y-this.dy;return e.i(r*i+h*n,r*s+h*o)}kw(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=t*(this.m21*this.dy-this.m22*this.dx),h=t*(this.m12*this.dx-this.m11*this.dy),a=e.x*1.25,l=e.y*1.2;return e.i(a*i+l*n+r,a*s+l*o+h)}vg(e){const t=e.x,i=e.y,s=t+e.width,n=i+e.height,o=this.m11,r=this.m12,h=this.m21,a=this.m22,l=this.dx,u=this.dy,c=t*o+i*h+l,d=t*r+i*a+u,f=s*o+i*h+l,m=s*r+i*a+u,p=t*o+n*h+l,y=t*r+n*a+u,x=s*o+n*h+l,P=s*r+n*a+u;let k=c,v=c,N=d,M=d;return k=Math.min(k,f),v=Math.max(v,f),N=Math.min(N,m),M=Math.max(M,m),k=Math.min(k,p),v=Math.max(v,p),N=Math.min(N,y),M=Math.max(M,y),k=Math.min(k,x),v=Math.max(v,x),N=Math.min(N,P),M=Math.max(M,P),e.i(k,N,v-k,M-N),e}static l(){const e=Qe.CC.pop();return e===void 0?new Qe:e}static e(e){Qe.CC.push(e)}};g(Qe,"CC",[]),g(Qe,"Gk","54a702f3e53909c447824c6706603faf4c");let Tt=Qe;const A={QD:"7da71ca0ad381e90",Rn:4*((Math.sqrt(2)-1)/3),LC:null,Pw:w=>{if(w<=0)return 0;let e=A.LC;if(e===null){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);A.LC=e}if(w<1){const t=1/w;return t<=2e3?1/e[t|0]:Math.sqrt(w)}else return w<=2e3?e[w|0]:Math.sqrt(w)},f:(w,e)=>{const t=w-e;return t<.5&&t>-.5},z:(w,e)=>{const t=w-e;return t<5e-8&&t>-5e-8},vi:(w,e,t,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,h=0,a=0,l=0;if(w<t?(h=w,r=t):(h=t,r=w),e<i?(l=e,a=i):(l=i,a=e),w===t)return l<=o&&o<=a&&w-s<=n&&n<=w+s;if(e===i)return h<=n&&n<=r&&e-s<=o&&o<=e+s;const u=r+s,c=h-s;if(c<=n&&n<=u){const d=a+s,f=l-s;if(f<=o&&o<=d)if(u-c>d-f)if(w-t>s||t-w>s){const m=(i-e)/(t-w)*(n-w)+e;if(m-s<=o&&o<=m+s)return!0}else return!0;else if(e-i>s||i-e>s){const m=(t-w)/(i-e)*(o-e)+w;if(m-s<=n&&n<=m+s)return!0}else return!0}return!1},Sw:(w,e,t,i,s,n,o,r,h,a,l,u)=>{if(!A.vi(w,e,o,r,u,t,i)||!A.vi(w,e,o,r,u,s,n)){const c=(w+t)/2,d=(e+i)/2,f=(t+s)/2,m=(i+n)/2,p=(s+o)/2,y=(n+r)/2,x=(c+f)/2,P=(d+m)/2,k=(f+p)/2,v=(m+y)/2,N=(x+k)/2,M=(P+v)/2;return A.Sw(w,e,c,d,x,P,N,M,h,a,l,u)||A.Sw(N,M,k,v,p,y,o,r,h,a,l,u)}else return A.vi(w,e,o,r,u,a,l)},AC:(w,e,t,i,s,n,o,r,h)=>{const a=(w+t)/2,l=(e+i)/2,u=(t+s)/2,c=(i+n)/2,d=(s+o)/2,f=(n+r)/2,m=(a+u)/2,p=(l+c)/2,y=(u+d)/2,x=(c+f)/2;return h.i((m+y)/2,(p+x)/2),h},_D:(w,e,t,i,s,n,o,r)=>{const h=(w+t)/2,a=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(s+o)/2,d=(n+r)/2,f=(h+l)/2,m=(a+u)/2,p=(l+c)/2,y=(u+d)/2;return S.direction(f,m,p,y)},ou:(w,e,t,i,s,n,o,r,h,a)=>{if(!A.vi(w,e,o,r,h,t,i)||!A.vi(w,e,o,r,h,s,n)){const l=(w+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,f=(s+o)/2,m=(n+r)/2,p=(l+c)/2,y=(u+d)/2,x=(c+f)/2,P=(d+m)/2,k=(p+x)/2,v=(y+P)/2;A.ou(w,e,l,u,p,y,k,v,h,a),A.ou(k,v,x,P,f,m,o,r,h,a)}else a.unionNoCheck(w,e,0,0),a.unionNoCheck(o,r,0,0);return a},vn:(w,e,t,i,s,n,o,r,h,a)=>{if(!A.vi(w,e,o,r,h,t,i)||!A.vi(w,e,o,r,h,s,n)){const l=(w+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,f=(s+o)/2,m=(n+r)/2,p=(l+c)/2,y=(u+d)/2,x=(c+f)/2,P=(d+m)/2,k=(p+x)/2,v=(y+P)/2;A.vn(w,e,l,u,p,y,k,v,h,a),A.vn(k,v,x,P,f,m,o,r,h,a)}else a.length===0&&(a.push(w),a.push(e)),a.push(o),a.push(r);return a},Kk:(w,e,t,i,s,n,o,r,h,a)=>{if(A.vi(w,e,s,n,a,t,i))return A.vi(w,e,s,n,a,r,h);{const l=(w+t)/2,u=(e+i)/2,c=(t+s)/2,d=(i+n)/2,f=(l+c)/2,m=(u+d)/2;return A.Kk(w,e,l,u,f,m,o,r,h,a)||A.Kk(f,m,c,d,s,n,o,r,h,a)}},bE:(w,e,t,i,s,n,o)=>{const r=(w+t)/2,h=(e+i)/2,a=(t+s)/2,l=(i+n)/2;return o.i((r+a)/2,(h+l)/2),o},jk:(w,e,t,i,s,n,o,r)=>{if(A.vi(w,e,s,n,o,t,i))r.unionNoCheck(w,e,0,0),r.unionNoCheck(s,n,0,0);else{const h=(w+t)/2,a=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(h+l)/2,d=(a+u)/2;A.jk(w,e,h,a,c,d,o,r),A.jk(c,d,l,u,s,n,o,r)}return r},Og:(w,e,t,i,s,n,o,r)=>{if(A.vi(w,e,s,n,o,t,i))r.length===0&&(r.push(w),r.push(e)),r.push(s),r.push(n);else{const h=(w+t)/2,a=(e+i)/2,l=(t+s)/2,u=(i+n)/2,c=(h+l)/2,d=(a+u)/2;A.Og(w,e,h,a,c,d,o,r),A.Og(c,d,l,u,s,n,o,r)}return r},Ig:(w,e,t,i,s,n,o,r,h,a,l,u,c,d)=>{if(!A.vi(w,e,o,r,c,t,i)||!A.vi(w,e,o,r,c,s,n)){const f=(w+t)/2,m=(e+i)/2,p=(t+s)/2,y=(i+n)/2,x=(s+o)/2,P=(n+r)/2,k=(f+p)/2,v=(m+y)/2,N=(p+x)/2,M=(y+P)/2,C=(k+N)/2,F=(v+M)/2;let T=1/0,L=!1,D=0,O=0;if(A.Ig(w,e,f,m,k,v,C,F,h,a,l,u,c,d)){const R=(d.x-h)**2+(d.y-a)**2;R<T&&(T=R,L=!0,D=d.x,O=d.y)}if(A.Ig(C,F,N,M,x,P,o,r,h,a,l,u,c,d)){const R=(d.x-h)**2+(d.y-a)**2;R<T&&(T=R,L=!0,D=d.x,O=d.y)}return L&&(d.x=D,d.y=O),L}else{if(!A.su(w,e,o,r,h,a,l,u))return!1;const f=(w-o)*(a-u)-(e-r)*(h-l);if(f===0)return!1;const m=((w*r-e*o)*(h-l)-(w-o)*(h*u-a*l))/f,p=((w*r-e*o)*(a-u)-(e-r)*(h*u-a*l))/f;return d.i(m,p),!0}},Eg:(w,e,t,i,s,n,o,r,h,a,l,u,c)=>{let d=0;if(!A.vi(w,e,o,r,c,t,i)||!A.vi(w,e,o,r,c,s,n)){const f=(w+t)/2,m=(e+i)/2,p=(t+s)/2,y=(i+n)/2,x=(s+o)/2,P=(n+r)/2,k=(f+p)/2,v=(m+y)/2,N=(p+x)/2,M=(y+P)/2,C=(k+N)/2,F=(v+M)/2;d+=A.Eg(w,e,f,m,k,v,C,F,h,a,l,u,c),d+=A.Eg(C,F,N,M,x,P,o,r,h,a,l,u,c)}else{const f=(w-o)*(a-u)-(e-r)*(h-l);if(f===0)return d;const m=((w*r-e*o)*(h-l)-(w-o)*(h*u-a*l))/f,p=((w*r-e*o)*(a-u)-(e-r)*(h*u-a*l))/f;if(m>=l)return d;let y=0,x=0;if((h>l?h-l:l-h)<(a>u?a-u:u-a)){if(e<r?(y=e,x=r):(y=r,x=e),p<y||p>x)return d}else if(w<o?(y=w,x=o):(y=o,x=w),m<y||m>x)return d;f>0?d++:f<0&&d--}return d},dl:(w,e,t,i,s,n,o)=>{if(A.z(w,t)){let r=0,h=0;e<i?(r=e,h=i):(r=i,h=e);const a=n;return a<r?(o.i(w,r),!1):a>h?(o.i(w,h),!1):(o.i(w,a),!0)}else if(A.z(e,i)){let r=0,h=0;w<t?(r=w,h=t):(r=t,h=w);const a=s;return a<r?(o.i(r,e),!1):a>h?(o.i(h,e),!1):(o.i(a,e),!0)}else{const r=(t-w)**2+(i-e)**2,h=((w-s)*(w-t)+(e-n)*(e-i))/r;if(h<-5e-6)return o.i(w,e),!1;if(h>1.000005)return o.i(t,i),!1;{const a=w+h*(t-w),l=e+h*(i-e);return o.i(a,l),!0}}},On:(w,e,t,i,s,n,o,r,h)=>{if(A.f(w,t)&&A.f(e,i))return h.i(w,e),!1;if(A.z(s,o)){if(A.z(w,t))return A.dl(w,e,t,i,s,n,h),!1;{const a=(i-e)/(t-w)*(s-w)+e;return A.dl(w,e,t,i,s,a,h)}}else{const a=(r-n)/(o-s);if(A.z(w,t)){const l=a*(w-s)+n;let u=0,c=0;return e<i?(u=e,c=i):(u=i,c=e),l<u?(h.i(w,u),!1):l>c?(h.i(w,c),!1):(h.i(w,l),!0)}else{const l=(i-e)/(t-w);if(A.z(a,l))return A.dl(w,e,t,i,s,n,h),!1;{const u=(l*w-a*s+n-e)/(l-a);if(A.z(l,0)){let c=0,d=0;return w<t?(c=w,d=t):(c=t,d=w),u<c?(h.i(c,e),!1):u>d?(h.i(d,e),!1):(h.i(u,e),!0)}else{const c=l*(u-w)+e;return A.dl(w,e,t,i,u,c,h)}}}}},kE:(w,e,t,i,s)=>A.On(t.x,t.y,i.x,i.y,w.x,w.y,e.x,e.y,s),PE:(w,e,t,i,s,n,o,r,h,a)=>{let l=1/0;function u(N,M){const C=(N-w)**2+(M-e)**2;C<l&&(l=C,h.i(N,M))}u(h.x,h.y);let c=0,d=0,f=0,m=0;s<o?(c=s,d=o):(c=o,d=s),n<r?(f=s,m=o):(f=o,m=s);const p=d-c,y=m-f,x=p/2+a,P=y/2+a,k=(s+o)/2,v=(n+r)/2;if(x===0||P===0)return h;if(A.f(w,t)){const N=1-(t-k)**2/(x*x);if(N<0)return h;const M=Math.sqrt(N),C=P*M+v,F=-P*M+v;u(t,C),u(t,F)}else{const N=(i-e)/(t-w),M=1/(x*x)+N*N/(P*P),C=2*N*(e-N*w)/(P*P)-2*N*v/(P*P)-2*k/(x*x),F=2*N*w*v/(P*P)-2*e*v/(P*P)+v*v/(P*P)+k*k/(x*x)-1+(e-N*w)*(e-N*w)/(P*P),T=C*C-4*M*F;if(T<0)return h;const L=Math.sqrt(T),D=(-C+L)/(2*M);u(D,N*D-N*w+e);const O=(-C-L)/(2*M);u(O,N*O-N*w+e)}return h},gl:(w,e,t,i,s,n,o,r,h)=>{let a=1e21,l=w,u=e;if(A.On(w,e,w,i,s,n,o,r,h)){const c=(h.x-s)**2+(h.y-n)**2;c<a&&(a=c,l=h.x,u=h.y)}if(A.On(t,e,t,i,s,n,o,r,h)){const c=(h.x-s)**2+(h.y-n)**2;c<a&&(a=c,l=h.x,u=h.y)}if(A.On(w,e,t,e,s,n,o,r,h)){const c=(h.x-s)**2+(h.y-n)**2;c<a&&(a=c,l=h.x,u=h.y)}if(A.On(w,i,t,i,s,n,o,r,h)){const c=(h.x-s)**2+(h.y-n)**2;c<a&&(a=c,l=h.x,u=h.y)}return h.i(l,u),a<1e21},Mw:(w,e,t)=>A.kC(w.x,w.y,w.width,w.height,e.x,e.y,t.x,t.y),kC:(w,e,t,i,s,n,o,r)=>{const h=w,a=w+t,l=e,u=e+i;if(s===o){let c=0,d=0;return n<r?(c=n,d=r):(c=r,d=n),h<=s&&s<=a&&c<=u&&d>=l}if(n===r){let c=0,d=0;return s<o?(c=s,d=o):(c=o,d=s),l<=n&&n<=u&&c<=a&&d>=h}return!!(z.contains(w,e,t,i,s,n)||z.contains(w,e,t,i,o,r)||A.su(h,l,a,l,s,n,o,r)||A.su(a,l,a,u,s,n,o,r)||A.su(a,u,h,u,s,n,o,r)||A.su(h,u,h,l,s,n,o,r))},su:(w,e,t,i,s,n,o,r)=>w===t&&e===i&&s===o&&n===r?w===s&&e===n:A.eu(w,e,t,i,s,n)*A.eu(w,e,t,i,o,r)<=0&&A.eu(s,n,o,r,w,e)*A.eu(s,n,o,r,t,i)<=0,eu:(w,e,t,i,s,n)=>{const o=t-w,r=i-e;let h=s-w,a=n-e,l=h*r-a*o;return l===0&&(l=h*o+a*r,l>0&&(h-=o,a-=r,l=h*o+a*r,l<0&&(l=0))),l},Ug:w=>(w<0&&(w+=360),w>=360&&(w-=360),w),TC:(w,e,t,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const r=i>s?-1:1,h=1e-5,a=o*2,l=[],u=o/2;let c=i,d=Math.min(a,Math.abs(s-i));if(d<h){const f=c+r*Math.min(d,u),m=w+t*Math.cos(c),p=e+t*Math.sin(c),y=w+t*Math.cos(f),x=e+t*Math.sin(f),P=(m+y)/2,k=(p+x)/2;return l.push([m,p,P,k,P,k,y,x]),l}for(;d>h;){const f=c+r*Math.min(d,u);l.push(A.tF(t,c,f,w,e)),d-=Math.abs(f-c),c=f}return l},tF:(w,e,t,i,s)=>{const n=(t-e)/2,o=w*Math.cos(n),r=w*Math.sin(n),h=o,a=-r,l=h*h+a*a,u=l+h*o+a*r,c=4/3*(Math.sqrt(2*l*u)-u)/(h*r-a*o),d=h-c*a,f=a+c*h,m=d,p=-f,y=n+e,x=Math.cos(y),P=Math.sin(y);return[i+w*Math.cos(e),s+w*Math.sin(e),i+d*x-f*P,s+d*P+f*x,i+m*x-p*P,s+m*P+p*x,i+w*Math.cos(t),s+w*Math.sin(t)]},Dg:(w,e,t,i,s,n,o)=>{const r=s,h=n,a=Math.floor((w-t)/r)*r+t,l=Math.floor((e-i)/h)*h+i;let u=a;a+r-w<r/2&&(u=a+r);let c=l;return l+h-e<h/2&&(c=l+h),o.i(u,c),o},DC:(w,e)=>{let t=Math.max(w,e),i=Math.min(w,e),s=1,n=1;do s=t%i,n=i,t=i,i=s;while(s>0);return n},iF:(w,e,t,i)=>{const s=t<0,n=i<0;let o=0,r=0,h=0;w<e?(r=1,h=0):(r=0,h=1);let a=0,l=0,u=0,c=0;return o=r,a=o===0?w:e,u=o===0?t:i,(o===0?s:n)&&(u=-u),o=h,l=o===0?w:e,c=o===0?t:i,(o===0?s:n)&&(c=-c),A.eF(a,l,u,c,0,0)},eF:(w,e,t,i,s,n)=>{let o=0;if(i>0)if(t>0){const r=w*w,h=e*e,a=w*t,l=e*i;let u=-h+l,c=-h+Math.sqrt(a*a+l*l),d=u;const f=9999999999;for(let y=0;y<f&&(d=.5*(u+c),!(d===u||d===c));++y){const x=a/(d+r),P=l/(d+h),k=x*x+P*P-1;if(k>0)u=d;else if(k<0)c=d;else break}s=r*t/(d+r),n=h*i/(d+h);const m=s-t,p=n-i;o=Math.sqrt(m*m+p*p)}else s=0,n=e,o=Math.abs(i-e);else{const r=w*w-e*e,h=w*t;if(h<r){const a=h/r,l=a*a;s=w*a,n=e*Math.sqrt(Math.abs(1-l));const u=s-t;o=Math.sqrt(u*u+n*n)}else s=w,n=0,o=Math.abs(t-w)}return o},In:new fe,Bg:new fe,or:new fe,rr:0,Vg:100};A.za=A.QD;var ii=(w=>(w[w.Line=1]="Line",w[w.Rectangle=2]="Rectangle",w[w.Ellipse=3]="Ellipse",w[w.Path=4]="Path",w))(ii||{}),$i=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w))($i||{});const ie=class ie{constructor(e){g(this,"n");g(this,"zg");g(this,"Xg");g(this,"oc");g(this,"ru");g(this,"lu");g(this,"En");g(this,"Un");g(this,"Bn");g(this,"H");g(this,"we");g(this,"xe");g(this,"Qi");g(this,"_i");g(this,"Rs");g(this,"rc");g(this,"lc");K.Ki(this),this.n=2,e===void 0&&(e=4),this.H=e,this.we=0,this.xe=0,this.Qi=0,this._i=0,e===4?this.Rs=new J:this.Rs=ie.Nw,this.zg=this.Rs.nt,this.Xg=new z().u(),this.oc=null,this.ru=null,this.lu=NaN,this.En=B.TopLeft,this.Un=B.BottomRight,this.rc=NaN,this.lc=NaN,this.Bn=2}copy(){const e=new ie;if(e.n=this.n&-2,e.H=this.H,e.we=this.we,e.xe=this.xe,e.Qi=this.Qi,e._i=this._i,this.H===4){const t=this.Rs.r,i=e.Rs;for(let s=0;s<t.length;s++){const n=t[s];i.add(n.copy())}e.Rs=i}else e.Rs=this.Rs;return e.zg=this.zg,e.Xg.a(this.Xg),e.oc=this.oc,e.ru=this.ru,e.lu=this.lu,e.En=this.En.P(),e.Un=this.Un.P(),e.rc=this.rc,e.lc=this.lc,e.Bn=this.Bn,e}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){if(this.h=!0,this.type!==4)return this;const e=this.figures;e.u();for(const t of e)t.u();return this}equalsApprox(e){if(!(e instanceof ie))return!1;if(this.type!==e.type)return this.type===1&&e.type===4?this.FC(e):e.type===1&&this.type===4?e.FC(this):!1;if(this.type===4){const t=this.figures.r,i=e.figures.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}else return A.f(this.startX,e.startX)&&A.f(this.startY,e.startY)&&A.f(this.endX,e.endX)&&A.f(this.endY,e.endY)}FC(e){if(this.type!==1||e.type!==4)return!1;if(e.figures.count===1){const t=e.figures.elt(0);if(t.segments.count===1&&A.f(this.startX,t.startX)&&A.f(this.startY,t.startY)){const i=t.segments.elt(0);if(i.type===2&&A.f(this.endX,i.endX)&&A.f(this.endY,i.endY))return!0}}return!1}static stringify(e){return e.toString()}static stringifyFixed(e){return t=>t.toString(e)}oi(e){e in ii?this.type=e:b.er(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i;switch(this.type){case 1:return e<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.startX)+" "+t(this.startY)+"L"+t(this.endX)+" "+t(this.endY);case 2:return i=new z(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+t(i.x)+" "+t(i.y)+"H"+t(i.right)+"V"+t(i.bottom)+"H"+t(i.left)+"z";case 3:if(i=new z(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),h=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+h+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}else{const r=t(i.left)+" "+t(i.y+i.height/2),h=t(i.right)+" "+t(i.y+i.height/2);return"M"+r+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+h+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const h=n[r];r>0&&(s+=" x "),h.isFilled&&(s+="F "),s+=h.toString(e)}return s;default:return ii[this.type]}}static fillPath(e){const t=e.split(/[Xx]/),i=t.length;let s="";for(let n=0;n<i;n++){const o=t[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static parse(e,t){t===void 0&&(t=!1);const i=new RegExp("(["+ie.Yg+"])(["+ie.Yg+"])","gm"),s=new RegExp("(["+ie.Yg+"])([^s])","gm"),n=new RegExp("([^s])(["+ie.Yg+"])","gm");e=e.replace(/,/gm," "),e=e.replace(i,"$1 $2"),e=e.replace(i,"$1 $2"),e=e.replace(s,"$1 $2"),e=e.replace(n,"$1 $2"),e=e.replace(/([0-9])([+\-])/gm,"$1 $2"),e=e.replace(/[\s\r\t\n]+/gm," "),e=e.replace(/^\s+|\s+$/g,"");const o=e.split(" ");for(let D=0;D<o.length;D++){const O=o[D];if(O.match(/(\.[0-9]*)(\.)/gm)!==null){const R=b.et();let I="",X=!1;for(let j=0;j<O.length;j++){const V=O[j];V==="."&&!X?(X=!0,I+=V):V==="."?(R.push(I),I="."):I+=V}R.push(I),o.splice(D,1);for(let j=0;j<R.length;j++)o.splice(D+j,0,R[j]);D+=R.length-1,b.J(R)}}let r=-1,h="",a="";const l=new S(0,0),u=new S(0,0),c=new S(0,0);let d=!0;function f(){return r>=k-1||o[r+1].match(T)!==null?!0:(d=!1,!1)}function m(){return r++,o[r]}function p(D){let O=parseFloat(m()),R=parseFloat(m());h===h.toLowerCase()&&(O=c.x+O,R=c.y+R),D.i(O,R)}function y(){return p(c),c}function x(){return p(u),u}function P(){const D=a.toLowerCase();return D==="c"||D==="s"||D==="q"||D==="t"?new S(2*c.x-u.x,2*c.y-u.y):new S(c.x,c.y)}const k=o.length,v=mi.RC(null);let N=!1,M=!1,C=!1,F=!0;const T=new RegExp("["+ie.Yg+"]");for(;!(r>=k-1);){if(a=h,h=m(),h==="")continue;d=!0;let D=!1;switch(h.toUpperCase()){case"X":F=!0,N=!1,M=!1;break;case"M":const O=y();for(v.bi===null||F===!0?(v.hu(O.x,O.y,N,!1,!M,C),F=!1):v.sF(O.x,O.y),l.a(c);!f();){const R=y();v.lr(R.x,R.y)}break;case"L":for(;!f();){const R=y();v.lr(R.x,R.y)}d&&(D=!0);break;case"H":for(;!f();)c.i((h===h.toLowerCase()?c.x:0)+parseFloat(m()),c.y),v.lr(c.x,c.y);break;case"V":for(;!f();)c.i(c.x,(h===h.toLowerCase()?c.y:0)+parseFloat(m())),v.lr(c.x,c.y);d&&(D=!0);break;case"C":for(;!f();){const R=new S;p(R);const I=x(),X=y();v.hr(R.x,R.y,I.x,I.y,X.x,X.y)}d&&(D=!0);break;case"S":for(;!f();){const R=P(),I=x(),X=y();v.hr(R.x,R.y,I.x,I.y,X.x,X.y)}d&&(D=!0);break;case"Q":for(;!f();){const R=x(),I=y();v.Cw(R.x,R.y,I.x,I.y)}d&&(D=!0);break;case"T":for(;!f();){const R=P();u.a(R);const I=y();v.Cw(R.x,R.y,I.x,I.y),u.a(I)}d&&(D=!0);break;case"B":for(;!f();){const R=parseFloat(m()),I=parseFloat(m());let X=parseFloat(m()),j=parseFloat(m());const V=parseFloat(m());let U=V,W=!1;f()||(U=parseFloat(m()),f()||(W=parseFloat(m())!==0)),h===h.toLowerCase()&&(X+=c.x,j+=c.y),v.nF(R,I,X,j,V,U,W)}d&&(D=!0);break;case"A":for(;!f();){const R=Math.abs(parseFloat(m())),I=Math.abs(parseFloat(m())),X=parseFloat(m());let j=!1,V=!1,U=0,W=0;const ct=m();ct.length===1?(j=!!parseFloat(ct),V=!!parseFloat(m()),U=parseFloat(m()),W=parseFloat(m())):ct.length===2?(j=!!parseFloat(ct[0]),V=!!parseFloat(ct[1]),U=parseFloat(m()),W=parseFloat(m())):(j=!!parseFloat(ct[0]),V=!!parseFloat(ct[1]),U=parseFloat(ct.slice(2)),W=parseFloat(m())),h===h.toLowerCase()&&(U=c.x+U,W=c.y+W),c.i(U,W),v.oF(R,I,X,j,V,U,W)}d&&(D=!0);break;case"Z":v.rF(),c.a(l);break;case"F":{let R="",I=1;for(;o[r+I];){if(o[r+I]==="0"){C=!0,I++;continue}if(o[r+I].match(/[Uu]/)!==null){I++;continue}if(o[r+I].match(T)===null){I++;continue}R=o[r+I];break}R.match(/[Mm]/)?N=!0:v.lF();break}case"U":{let R="",I=1;for(;o[r+I];){if(o[r+I].match(/[Ff]/)!==null){I++;continue}if(o[r+I].match(T)===null){I++;continue}R=o[r+I];break}R.match(/[Mm]/)?M=!0:v.hF(!1);break}default:if(h==="0"||h==="1")break;b.ni("Unknown geometry command: "+h);break}if(D){b.ni(`Bad geometry command: ${h}, next token: ${m()},
string: ${e}`);break}}const L=v.Gg;if(mi.vC(v),t){const D=L.figures.iterator;for(;D.next();){const O=D.value;O.isFilled=!0}}return L}static OC(e,t){const i=e.length,s=S.l();for(let n=0;n<i;n++){const o=e[n];s.x=o[0],s.y=o[1],t.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],t.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],t.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],t.gt(s),o[6]=s.x,o[7]=s.y}S.e(s)}Hk(){if(this.wt)return!0;if(this.type===4){const e=this.figures;if(this.zg!==e.nt)return!0;const t=this.figures.r,i=t.length;for(let s=0;s<i;s++)if(t[s].Hk())return!0}return!1}Lw(){if(this.wt=!1,this.oc=null,this.ru=null,this.lu=NaN,this.type===4){const t=this.figures;this.zg=t.nt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].aF()}const e=this.Xg;e.Pt(),isNaN(this.rc)||isNaN(this.lc)?e.i(0,0,0,0):e.i(0,0,this.rc,this.lc),this.IC(e,!1),e.unionNoCheck(0,0,0,0),e.u()}computeBoundsWithoutOrigin(){const e=new z;return this.IC(e,!0),e}IC(e,t){switch(this.type){case 1:case 2:case 3:t?e.i(this.we,this.xe,0,0):e.unionNoCheck(this.we,this.xe,0,0),e.unionNoCheck(this.Qi,this._i,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];t&&o===0?e.i(r.startX,r.startY,0,0):e.unionNoCheck(r.startX,r.startY,0,0);const h=r.segments.r,a=h.length;let l=r.startX,u=r.startY;for(let c=0;c<a;c++){const d=h[c];switch(d.type){case 2:case 1:l=d.endX,u=d.endY,e.unionNoCheck(l,u,0,0);break;case 3:A.ou(l,u,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,e),l=d.endX,u=d.endY;break;case 4:A.jk(l,u,d.point1X,d.point1Y,d.endX,d.endY,.5,e),l=d.endX,u=d.endY;break;case 5:case 6:const f=d.type===5?d.bo(r):d.Bh(r,l,u),m=f.length;if(m===0){l=d.type===5?d.centerX:d.endX,u=d.type===5?d.centerY:d.endY,e.unionNoCheck(l,u,0,0);break}let p=null;for(let y=0;y<m;y++)p=f[y],A.ou(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,e);p!==null&&(l=p[6],u=p[7]);break;default:b.o("Unknown Segment type: "+d.type)}}}break;default:b.o("Unknown Geometry type: "+this.type)}}cF(e,t){const i=this.bounds;let s=e/i.width,n=t/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.h&&b.L(this);const e=this.computeBoundsWithoutOrigin();return this.offset(-e.x,-e.y),new S(-e.x,-e.y)}offset(e,t){return this.h&&b.L(this),this.T(1,0,0,1,e,t),this}scale(e,t){return this.h&&b.L(this),this.T(e,0,0,t,0,0),this}rotate(e,t,i){this.h&&b.L(this),t===void 0&&(t=0),i===void 0&&(i=0);const s=Tt.l();return s.Ri(),s.cs(e,t,i),this.T(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Tt.e(s),this}T(e,t,i,s,n,o){let r=0,h=0;switch(this.type){case 1:case 2:case 3:r=this.we,h=this.xe,this.we=r*e+h*i+n,this.xe=r*t+h*s+o,r=this.Qi,h=this._i,this.Qi=r*e+h*i+n,this._i=r*t+h*s+o;break;case 4:const a=this.figures.r,l=a.length;for(let u=0;u<l;u++){const c=a[u];r=c.startX,h=c.startY,c.startX=r*e+h*i+n,c.startY=r*t+h*s+o;const d=c.segments.r,f=d.length;for(let m=0;m<f;m++){const p=d[m];switch(p.type){case 2:case 1:r=p.endX,h=p.endY,p.endX=r*e+h*i+n,p.endY=r*t+h*s+o;break;case 3:r=p.point1X,h=p.point1Y,p.point1X=r*e+h*i+n,p.point1Y=r*t+h*s+o,r=p.point2X,h=p.point2Y,p.point2X=r*e+h*i+n,p.point2Y=r*t+h*s+o,r=p.endX,h=p.endY,p.endX=r*e+h*i+n,p.endY=r*t+h*s+o;break;case 4:r=p.point1X,h=p.point1Y,p.point1X=r*e+h*i+n,p.point1Y=r*t+h*s+o,r=p.endX,h=p.endY,p.endX=r*e+h*i+n,p.endY=r*t+h*s+o;break;case 5:if(r=p.centerX,h=p.centerY,p.centerX=r*e+h*i+n,p.centerY=r*t+h*s+o,t!==0){let y=Math.atan2(t,e)*180/Math.PI;y<0&&(y+=360),p.startAngle+=y}e<0&&(p.startAngle=180-p.startAngle,p.sweepAngle=-p.sweepAngle),s<0&&(p.startAngle=-p.startAngle,p.sweepAngle=-p.sweepAngle),p.radiusX*=Math.sqrt(e*e+i*i),p.radiusY!==void 0&&(p.radiusY*=Math.sqrt(t*t+s*s));break;case 6:if(r=p.endX,h=p.endY,p.endX=r*e+h*i+n,p.endY=r*t+h*s+o,p.radiusX===0||p.radiusY===0)break;if(t!==0){let y=Math.atan2(t,e)*180/Math.PI;y<0&&(y+=360),p.xAxisRotation+=y}e<0&&(p.xAxisRotation=180-p.xAxisRotation,p.isClockwiseArc=!p.isClockwiseArc),s<0&&(p.xAxisRotation=-p.xAxisRotation,p.isClockwiseArc=!p.isClockwiseArc),p.radiusX*=Math.sqrt(e*e+i*i),p.radiusY*=Math.sqrt(t*t+s*s);break;default:b.o("Unknown Segment type: "+p.type)}}}break}return this.wt=!0,this}containsPoint(e,t){t===void 0&&(t=0);const i=this.we,s=this.xe,n=this.Qi,o=this._i;switch(this.type){case 1:return A.vi(i,s,n,o,t,e.x,e.y);case 2:{const r=Math.min(i,n)-t,h=Math.min(s,o)-t,a=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,u=z.V(r,h,a,l),c=u.containsPoint(e);return z.e(u),c}case 3:{let r=Math.min(i,n)-t,h=Math.min(s,o)-t;const a=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,u=a/2,c=l/2;return u<=0||c<=0?!1:(r=e.x-(r+u),h=e.y-(h+c),r*r/(u*u)+h*h/(c*c)<=1)}case 4:return this.qk(e,t,!0,!1);default:return!1}}qk(e,t,i,s){const n=e.x,o=e.y,r=this.bounds.x-20,h=o;let a=0,l=0,u=0,c=0,d=0,f=0;const m=this.figures.r,p=m.length;for(let y=0;y<p;y++){const x=m[y],P=!x.isEvenOdd;if(x.isFilled){if(i&&x.Wk(n,o,t))return!0}else{if(x.Wk(n,o,s?t:t+2))return!0;continue}const k=x.segments;l=x.startX,u=x.startY;let v=l,N=u;const M=k.r;for(let C=0;C<=k.length;C++){let F,T;switch(C!==k.length?(F=M[C],T=F.type,d=F.endX,f=F.endY):(T=2,d=v,f=N),T){case 1:{const L=this.Aw(n,o,r,h,l,u,v,N);if(isNaN(L))return!0;a+=L,v=d,N=f;break}case 2:{const L=this.Aw(n,o,r,h,l,u,d,f);if(isNaN(L))return!0;a+=L;break}case 3:c=A.Eg(l,u,F.point1X,F.point1Y,F.point2X,F.point2Y,d,f,r,h,n,o,.5),a+=c;break;case 4:{const L=(l+2*F.point1X)/3,D=(u+2*F.point1Y)/3,O=(F.point1X*2+d)/3,R=(F.point1Y*2+f)/3;c=A.Eg(l,u,L,D,O,R,d,f,r,h,n,o,.5),a+=c;break}case 5:case 6:{const L=F.type===5?F.bo(x):F.Bh(x,l,u),D=L.length;if(D===0){const R=this.Aw(n,o,r,h,l,u,F.type===5?F.centerX:F.endX,F.type===5?F.centerY:F.endY);if(isNaN(R))return!0;a+=R;break}let O=null;for(let R=0;R<D;R++){if(O=L[R],R===0){const I=this.Aw(n,o,r,h,l,u,O[0],O[1]);if(isNaN(I))return!0;a+=I}c=A.Eg(O[0],O[1],O[2],O[3],O[4],O[5],O[6],O[7],r,h,n,o,.5),a+=c}O!==null&&(d=O[6],f=O[7]);break}default:b.o("Unknown Segment type: "+F.type)}l=d,u=f}if(P){if(a!==0)return!0}else if(a%2!==0)return!0;a=0}return!1}Aw(e,t,i,s,n,o,r,h){if(A.vi(n,o,r,h,.05,e,t))return NaN;const a=(e-i)*(o-h);if(a===0)return 0;const l=((e*s-t*i)*(n-r)-(e-i)*(n*h-o*r))/a,u=(e*s-t*i)*(o-h)/a;if(l>=e)return 0;if((n>r?n-r:r-n)<(o>h?o-h:h-o)){if(o<h){if(u<o||u>h)return 0}else if(u<h||u>o)return 0}else if(n<r){if(l<n||l>r)return 0}else if(l<r||l>n)return 0;return a>0?1:-1}EC(e,t,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].Wk(e,t,i))return!0;return!1}getPointAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=new S),this.type===1)return t.i(this.startX+e*(this.endX-this.startX),this.startY+e*(this.endY-this.startY)),t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let h=0;for(let a=0;a<o;a++){const l=s[a],u=l.length;for(let c=0;c<u;c++){const d=l[c];if(h+d>=r){const f=r-h,m=d===0?0:f/d,p=i[a],y=p[c*2],x=p[c*2+1],P=p[c*2+2],k=p[c*2+3];return t.i(y+(P-y)*m,x+(k-x)*m),t}h+=d}}return t}getAngleAlongPath(e){if(e<0?e=0:e>1&&(e=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=t.length,o=s*e;let r=0;for(let h=0;h<n;h++){const a=i[h],l=a.length;for(let u=0;u<l;u++){const c=a[u];if(r+c>=o){const d=t[h],f=d[u*2],m=d[u*2+1],p=d[u*2+2],y=d[u*2+3];return Math.abs(p-f)<1&&Math.abs(y-m)<1?0:Math.abs(p-f)<1?y-m>=0?90:270:Math.abs(y-m)<1?p-f>=0?0:180:Math.atan2(y-m,p-f)*180/Math.PI}r+=c}}return NaN}getPointAndAngleAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=[]),t.length=3,this.type===1)return t[0]=this.startX+e*(this.endX-this.startX),t[1]=this.startY+e*(this.endY-this.startY),t[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let h=0;for(let a=0;a<o;a++){const l=s[a],u=l.length;for(let c=0;c<u;c++){const d=l[c];if(h+d>=r){const f=r-h,m=d===0?0:f/d,p=i[a],y=p[c*2],x=p[c*2+1],P=p[c*2+2],k=p[c*2+3];t[0]=y+(P-y)*m,t[1]=x+(k-x)*m;let v;return Math.abs(P-y)<1&&Math.abs(k-x)<1?v=0:Math.abs(P-y)<1?v=k-x>=0?90:270:Math.abs(k-x)<1?v=P-y>=0?0:180:v=Math.atan2(k-x,P-y)*180/Math.PI,t[2]=v,t}h+=d}}return t}getFractionForPoint(e){if(this.type===1){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=e.x,r=e.y;let h=0,a=0;if(t===s)return i<n?(h=i,a=n):(h=n,a=i),r<=h?h===i?0:1:r>=a?a===i?0:1:Math.abs(r-i)/(a-h);if(i===n)return t<s?(h=t,a=s):(h=s,a=t),o<=h?h===t?0:1:o>=a?a===t?0:1:Math.abs(o-t)/(a-h);{const l=(s-t)**2+(n-i)**2,u=S.l();A.dl(t,i,s,n,o,r,u);const c=u.x,d=u.y;return S.e(u),Math.sqrt(((c-t)**2+(d-i)**2)/l)}}}else if(this.type===2){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=s-t,r=n-i,h=o*2+r*2;let a=e.x,l=e.y;a=Math.min(Math.max(a,t),s),l=Math.min(Math.max(l,i),n);const u=Math.abs(a-t),c=Math.abs(a-s),d=Math.abs(l-i),f=Math.abs(l-n),m=Math.min(u,c,d,f);if(m===d)return a/h;if(m===c)return(o+l)/h;if(m===f)return(o*2+r-a)/h;if(m===u)return(o*2+r*2-l)/h}}else{const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=S.l();let o=1/0,r=0,h=0;const a=t.length;let l=0,u=0;for(let d=0;d<a;d++){const f=t[d],m=i[d],p=f.length;for(let y=0;y<p;y+=2){const x=f[y],P=f[y+1];if(y===0){l=x,u=P;continue}A.dl(l,u,x,P,e.x,e.y,n);const k=(n.x-e.x)**2+(n.y-e.y)**2;k<o&&(o=k,r=h,r+=Math.sqrt((n.x-l)**2+(n.y-u)**2)),h+=m[(y-2)/2],l=x,u=P}}S.e(n);const c=r/s;return c<0?0:c>1?1:c}return 0}get flattenedSegments(){return this.UC(),this.oc}UC(){if(this.oc===null){const e=this.oc=[],t=this.ru=[];this.fF(e,t)}}get flattenedLengths(){return this.UC(),this.ru}get flattenedTotalLength(){let e=this.lu;if(isNaN(e)){if(this.type===1){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(this.type===2){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=t*2+i*2}else{const t=this.flattenedLengths,i=t.length;e=0;for(let s=0;s<i;s++){const n=t[s],o=n.length;for(let r=0;r<o;r++)e+=n[r]}}this.lu=e}return e}Jk(e){const t=[];let i=0,s=0;const n=e.length;for(let o=0;o<n;o+=2){const r=e[o],h=e[o+1];if(o===0){i=r,s=h;continue}const a=Math.sqrt(S.distanceSquared(i,s,r,h));t.push(a),i=r,s=h}return t}fF(e,t){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),e.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),t.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),e.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),t.push(s);else if(this.type===3){const n=new qt;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new pt(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.bo(n),h=r.length;if(h===0)i.push(o.centerX),i.push(o.centerY);else{let a=n.startX,l=n.startY;for(let u=0;u<h;u++){const c=r[u];A.vn(a,l,c[2],c[3],c[4],c[5],c[6],c[7],.5,i),a=c[6],l=c[7]}}e.push(i),t.push(this.Jk(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,h=o.startY,a=r,l=h;const u=o.segments.r,c=u.length;for(let d=0;d<c;d++){const f=u[d];switch(f.type){case 1:i.length>=4&&(e.push(i),t.push(this.Jk(i))),i=[],i.push(f.endX),i.push(f.endY),r=f.endX,h=f.endY,a=r,l=h;break;case 2:i.push(f.endX),i.push(f.endY),r=f.endX,h=f.endY;break;case 3:A.vn(r,h,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,i),r=f.endX,h=f.endY;break;case 4:A.Og(r,h,f.point1X,f.point1Y,f.endX,f.endY,.5,i),r=f.endX,h=f.endY;break;case 5:{const m=f.bo(o),p=m.length;if(p===0){i.push(f.centerX),i.push(f.centerY),r=f.centerX,h=f.centerY;break}for(let y=0;y<p;y++){const x=m[y];A.vn(r,h,x[2],x[3],x[4],x[5],x[6],x[7],.5,i),r=x[6],h=x[7]}break}case 6:{const m=f.Bh(o,r,h),p=m.length,y=f.endX,x=f.endY;if(p===0){i.push(y),i.push(x),r=y,h=x;break}for(let P=0;P<p;P++){const k=m[P];A.vn(r,h,k[2],k[3],k[4],k[5],k[6],k[7],.5,i),r=k[6],h=k[7]}break}default:b.o("Segment not of valid type: "+f.type)}f.isClosed&&(i.push(a),i.push(l))}i.length>=4&&(e.push(i),t.push(this.Jk(i)))}}}get type(){return this.H}set type(e){this.H!==e&&(this.h&&b.L(this,e),this.H=e,e===4?this.Rs=new J:(ie.Nw===null&&(ie.Nw=new J().u()),this.Rs=ie.Nw),this.wt=!0)}get startX(){return this.we}set startX(e){this.we!==e&&(this.h&&b.L(this,e),this.we=e,this.wt=!0)}get startY(){return this.xe}set startY(e){this.xe!==e&&(this.h&&b.L(this,e),this.xe=e,this.wt=!0)}get endX(){return this.Qi}set endX(e){this.Qi!==e&&(this.h&&b.L(this,e),this.Qi=e,this.wt=!0)}get endY(){return this._i}set endY(e){this._i!==e&&(this.h&&b.L(this,e),this._i=e,this.wt=!0)}get figures(){return this.Rs}set figures(e){this.Rs!==e&&(this.h&&b.L(this,e),this.Rs=e,this.wt=!0)}add(e){return this.Rs.add(e),this}setSpots(e,t,i,s,n,o,r,h){return this.h&&b.L(this),this.En=new B(e,t,n,o).u(),this.Un=new B(i,s,r,h).u(),this}get spot1(){return this.En}set spot1(e){this.h&&b.L(this,e),this.En=e.P()}get spot2(){return this.Un}set spot2(e){this.h&&b.L(this,e),this.Un=e.P()}get defaultStretch(){return this.Bn}set defaultStretch(e){this.Bn=e}get bounds(){return this.Hk()&&this.Lw(),this.Xg}};g(ie,"Line",1),g(ie,"Rectangle",2),g(ie,"Ellipse",3),g(ie,"Path",4),g(ie,"Nw",new J().u()),g(ie,"Yg","UuBbMmZzLlHhVvCcSsQqTtAaFfXx");let Mt=ie;Mt.stringify=Mt.stringify,Mt.stringifyFixed=Mt.stringifyFixed,Mt.fillPath=Mt.fillPath,Mt.parse=Mt.parse;class qt{constructor(e,t,i,s,n){g(this,"n");g(this,"we");g(this,"xe");g(this,"hc");g(this,"Kg");g(this,"Ee");i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),e!==void 0?this.we=e:this.we=0,t!==void 0?this.xe=t:this.xe=0,this.hc=new J,this.Kg=this.hc.nt,this.Ee=null}copy(){const e=new qt;e.n=this.n&-2,e.we=this.we,e.xe=this.xe;const t=this.hc.r,i=t.length,s=e.hc;for(let n=0;n<i;n++){const o=t[n].copy();s.add(o)}return e.Kg=this.Kg,e.Ee=this.Ee,e}equalsApprox(e){if(!(e instanceof qt)||!A.f(this.startX,e.startX)||!A.f(this.startY,e.startY))return!1;const t=this.segments.r,i=e.segments.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}toString(e){e===void 0&&(e=-1);let t="";if(e<0)t="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(e);t="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+o.toString(e)}return t}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){this.h=!0;const e=this.segments;e.u();const t=e.r,i=e.length;for(let s=0;s<i;s++)t[s].u();return this}Hk(){if(this.wt)return!0;const e=this.segments;if(this.Kg!==e.nt)return!0;for(const t of e)if(t.wt)return!0;return!1}aF(){this.wt=!1,this.Ee=null;const e=this.segments;this.Kg=e.nt;for(const t of e)t.wt=!1,t.vs=null}get isFilled(){return(this.n&4)!==0}set isFilled(e){this.h&&b.L(this,e),e?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(e){this.h&&b.L(this,e),e?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(e){this.h&&b.L(this,e),e?this.n|=16:this.n&=-17}get startX(){return this.we}set startX(e){this.h&&b.L(this,e),this.we=e,this.Ee=null,this.wt=!0}get startY(){return this.xe}set startY(e){this.h&&b.L(this,e),this.xe=e,this.Ee=null,this.wt=!0}get segments(){return this.hc}set segments(e){this.h&&b.L(this,e),this.hc=e,this.Ee=null,this.wt=!0}add(e){return this.hc.add(e),this.Ee=null,this}Wk(e,t,i){const s=this;let n=s.startX,o=s.startY,r=n,h=o;const a=s.segments.r,l=a.length;for(let u=0;u<l;u++){const c=a[u];switch(c.type){case 1:r=c.endX,h=c.endY,n=c.endX,o=c.endY;break;case 2:if(A.vi(n,o,c.endX,c.endY,i,e,t))return!0;n=c.endX,o=c.endY;break;case 3:if(A.Sw(n,o,c.point1X,c.point1Y,c.point2X,c.point2Y,c.endX,c.endY,.5,e,t,i))return!0;n=c.endX,o=c.endY;break;case 4:if(A.Kk(n,o,c.point1X,c.point1Y,c.endX,c.endY,.5,e,t,i))return!0;n=c.endX,o=c.endY;break;case 5:case 6:const d=c.type===5?c.bo(s):c.Bh(s,n,o),f=d.length,m=c.type===5?c.centerX:c.endX,p=c.type===5?c.centerY:c.endY;if(f===0){if(A.vi(n,o,m,p,i,e,t))return!0;n=m,o=p;break}let y=null;for(let x=0;x<f;x++)if(y=d[x],x===0&&A.vi(n,o,y[0],y[1],i,e,t)||A.Sw(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],.5,e,t,i))return!0;y!==null&&(n=y[6],o=y[7]);break;default:b.o("Unknown Segment type: "+c.type)}if(c.isClosed&&(n!==r||o!==h)&&A.vi(n,o,r,h,i,e,t))return!0}return!1}}var ki=(w=>(w[w.Move=1]="Move",w[w.Line=2]="Line",w[w.Bezier=3]="Bezier",w[w.QuadraticBezier=4]="QuadraticBezier",w[w.Arc=5]="Arc",w[w.SvgArc=6]="SvgArc",w))(ki||{});const Ne=class Ne{constructor(e,t,i,s,n,o,r,h){g(this,"H");g(this,"n");g(this,"Qi");g(this,"_i");g(this,"tn");g(this,"pl");g(this,"yl");g(this,"ar");g(this,"vs");if(K.Ki(this),e===void 0&&(e=2),this.H=e,this.n=2,t!==void 0?this.Qi=t:this.Qi=0,i!==void 0?this._i=i:this._i=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),e===6){let a=o;a=a%360,a<0&&(a+=360),this.tn=a,this.pl=0,this.yl=Math.max(s,0),this.ar=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),h&&(this.isClockwiseArc=!0)}else this.tn=s,this.pl=n,e===5&&(o=Math.max(o,0)),this.yl=o,typeof r=="number"?(e===5&&(r=Math.max(r,0)),this.ar=r):this.ar=0;this.vs=null}copy(){const e=new Ne;return e.H=this.H,e.n=this.n&-2,e.Qi=this.Qi,e._i=this._i,e.tn=this.tn,e.pl=this.pl,e.yl=this.yl,e.ar=this.ar,e}equalsApprox(e){if(!(e instanceof Ne)||this.type!==e.type||this.isClosed!==e.isClosed)return!1;switch(this.type){case 1:case 2:return A.f(this.endX,e.endX)&&A.f(this.endY,e.endY);case 3:return A.f(this.endX,e.endX)&&A.f(this.endY,e.endY)&&A.f(this.point1X,e.point1X)&&A.f(this.point1Y,e.point1Y)&&A.f(this.point2X,e.point2X)&&A.f(this.point2Y,e.point2Y);case 4:return A.f(this.endX,e.endX)&&A.f(this.endY,e.endY)&&A.f(this.point1X,e.point1X)&&A.f(this.point1Y,e.point1Y);case 5:return A.f(this.startAngle,e.startAngle)&&A.f(this.sweepAngle,e.sweepAngle)&&A.f(this.centerX,e.centerX)&&A.f(this.centerY,e.centerY)&&A.f(this.radiusX,e.radiusX)&&A.f(this.radiusY,e.radiusY);case 6:return this.isClockwiseArc===e.isClockwiseArc&&this.isLargeArc===e.isLargeArc&&A.f(this.xAxisRotation,e.xAxisRotation)&&A.f(this.endX,e.endX)&&A.f(this.endY,e.endY)&&A.f(this.radiusX,e.radiusX)&&A.f(this.radiusY,e.radiusY);default:return!1}}oi(e){e in ki?this.type=e:b.er(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i="";switch(this.type){case 1:e<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+t(this.endX)+" "+t(this.endY);break;case 2:e<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+t(this.endX)+" "+t(this.endY);break;case 3:e<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.point2X)+" "+t(this.point2Y)+" "+t(this.endX)+" "+t(this.endY);break;case 4:e<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.endX)+" "+t(this.endY);break;case 5:e<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+t(this.startAngle)+" "+t(this.sweepAngle)+" "+t(this.centerX)+" "+t(this.centerY)+" "+t(this.radiusX)+" "+t(this.radiusY);break;case 6:e<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+t(this.radiusX)+" "+t(this.radiusY)+" "+t(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+t(this.endX)+" "+t(this.endY);break;default:i=ki[this.type]}return i+(this.isClosed?"z":"")}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){return this.h=!0,this}close(){return this.isClosed=!0,this}bo(e){if(this.vs!==null&&e.wt===!1)return this.vs;const t=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=t),t===0||i===0)return this.vs=[],this.vs;const s=this.tn,n=this.pl,o=A.TC(0,0,t<i?t:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(t!==i){const h=Tt.l();h.Ri(),t<i?h.tt(1,i/t):h.tt(t/i,1),Mt.OC(o,h),Tt.e(h)}const r=o.length;for(let h=0;h<r;h++){const a=o[h];a[0]+=s,a[1]+=n,a[2]+=s,a[3]+=n,a[4]+=s,a[5]+=n,a[6]+=s,a[7]+=n}return this.vs=o,this.vs}Bh(e,t,i){if(this.vs!==null&&e.wt===!1)return this.vs;if(this.radiusX===0||this.radiusY===0)return this.vs=[],this.vs;const s=t,n=i;let o=this.yl,r=this.ar;o===0&&(o=1e-4),r===0&&(r=1e-4);const h=this.tn*(Math.PI/180),a=this.isLargeArc,l=this.isClockwiseArc,u=this.Qi,c=this._i,d=Math.cos(h),f=Math.sin(h),m=d*(s-u)/2+f*(n-c)/2,p=-f*(s-u)/2+d*(n-c)/2,y=m*m/(o*o)+p*p/(r*r);y>1&&(o*=Math.sqrt(y),r*=Math.sqrt(y));let x=(a===l?-1:1)*Math.sqrt((o*o*r*r-o*o*p*p-r*r*m*m)/(o*o*p*p+r*r*m*m));isNaN(x)&&(x=0);let P=x*o*p/r,k=x*-r*m/o;isNaN(P)&&(P=0),isNaN(k)&&(k=0);const v=(s+u)/2+d*P-f*k,N=(n+c)/2+f*P+d*k,M=($,et)=>Math.sqrt($*$+et*et),C=($,et,tt,it)=>($*tt+et*it)/(M($,et)*M(tt,it)),F=($,et,tt,it)=>($*it<et*tt?-1:1)*Math.acos(C($,et,tt,it)),T=F(1,0,(m-P)/o,(p-k)/r),L=(m-P)/o,D=(p-k)/r,O=(-m-P)/o,R=(-p-k)/r;let I=F(L,D,O,R);const X=C(L,D,O,R);X<=-1?I=Math.PI:X>=1&&(I=0),!l&&I>0&&(I=I-2*Math.PI),l&&I<0&&(I=I+2*Math.PI);const j=o>r?o:r,V=o>r?1:o/r,U=o>r?r/o:1,W=A.TC(0,0,j,T,T+I,!0),ct=Tt.l();return ct.Ri(),ct.Fs(v,N),ct.cs(this.tn,0,0),ct.tt(V,U),Mt.OC(W,ct),Tt.e(ct),this.vs=W,this.vs}get isClosed(){return(this.n&8)!==0}set isClosed(e){this.isClosed!==e&&(e?this.n|=8:this.n&=-9,this.wt=!0)}get type(){return this.H}set type(e){this.h&&b.L(this,e),this.H=e,this.wt=!0}get endX(){return this.Qi}set endX(e){this.h&&b.L(this,e),this.Qi=e,this.wt=!0}get endY(){return this._i}set endY(e){this.h&&b.L(this,e),this._i=e,this.wt=!0}get point1X(){return this.tn}set point1X(e){this.h&&b.L(this,e),this.tn=e,this.wt=!0}get point1Y(){return this.pl}set point1Y(e){this.h&&b.L(this,e),this.pl=e,this.wt=!0}get point2X(){return this.yl}set point2X(e){this.h&&b.L(this,e),this.yl=e,this.wt=!0}get point2Y(){return this.ar}set point2Y(e){this.h&&b.L(this,e),this.ar=e,this.wt=!0}get centerX(){return this.tn}set centerX(e){this.h&&b.L(this,e),this.tn=e,this.wt=!0}get centerY(){return this.pl}set centerY(e){this.h&&b.L(this,e),this.pl=e,this.wt=!0}get radiusX(){return this.yl}set radiusX(e){e<0&&b.W(e,">= zero",Ne,"radiusX"),this.h&&b.L(this,e),this.yl=e,this.wt=!0}get radiusY(){return this.ar}set radiusY(e){e<0&&b.W(e,">= zero",Ne,"radiusY"),this.h&&b.L(this,e),this.ar=e,this.wt=!0}get startAngle(){return this.Qi}set startAngle(e){this.h&&b.L(this,e),e=e%360,e<0&&(e+=360),this.Qi=e,this.wt=!0}get sweepAngle(){return this._i}set sweepAngle(e){this.h&&b.L(this,e),e>360&&(e=360),e<-360&&(e=-360),this._i=e,this.wt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(e){this.h&&b.L(this,e),e?this.n|=4:this.n&=-5,this.wt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(e){this.h&&b.L(this,e),e?this.n|=16:this.n&=-17,this.wt=!0}get xAxisRotation(){return this.tn}set xAxisRotation(e){this.h&&b.L(this,e),e=e%360,e<0&&(e+=360),this.tn=e,this.wt=!0}};g(Ne,"Move",1),g(Ne,"Line",2),g(Ne,"Bezier",3),g(Ne,"QuadraticBezier",4),g(Ne,"Arc",5),g(Ne,"SvgArc",6);let pt=Ne;class Ge{constructor(){g(this,"N");g(this,"Tw");g(this,"Dw");g(this,"jg");g(this,"Hg");g(this,"qg");g(this,"Wg");g(this,"Jg");g(this,"$g");g(this,"Zg");g(this,"Qg");g(this,"_g");g(this,"tm");g(this,"im");g(this,"ko");g(this,"em");g(this,"sm");g(this,"nm");g(this,"be");this.N=null,this.Tw=new S(0,0).u(),this.Dw=new S(0,0).u(),this.jg=0,this.Hg=0,this.qg=1,this.Wg="",this.Jg="",this.$g=!1,this.Zg=!1,this.Qg=0,this._g=0,this.tm=!1,this.im=!1,this.ko=!1,this.em=null,this.sm=0,this.nm=null,this.be=null}copy(){const e=new Ge;return this.clone(e)}clone(e){return e.N=this.N,e.Tw.a(this.viewPoint),e.Dw.a(this.documentPoint),e.jg=this.jg,e.Hg=this.Hg,e.qg=this.qg,e.Wg=this.Wg,e.Jg=this.Jg,e.$g=this.$g,e.Zg=this.Zg,e.Qg=this.Qg,e._g=this._g,e.tm=this.tm,e.im=this.im,e.ko=this.ko,e.em=this.em,e.sm=this.sm,e.nm=this.nm,e.be=this.be,e}toString(){let e="^";return this.modifiers!==0&&(e+="M:"+this.modifiers),this.button!==0&&(e+="B:"+this.button),this.key!==""&&(e+="K:"+this.key),this.clickCount!==0&&(e+="C:"+this.clickCount),this.delta!==0&&(e+="D:"+this.delta),this.handled&&(e+="h"),this.bubbles&&(e+="b"),this.documentPoint!==null&&(e+="@"+this.documentPoint.toString()),e}get diagram(){return this.N}set diagram(e){this.N=e}get viewPoint(){return this.Tw}set viewPoint(e){this.Tw.a(e)}get documentPoint(){return this.Dw}set documentPoint(e){this.Dw.a(e)}getMultiTouchViewPoint(e,t){const i=this.diagram;return i===null||i.BC(this.event,e,t),t}getMultiTouchDocumentPoint(e,t){const i=this.diagram;return i===null||(i.BC(this.event,e,t),t.a(i.transformViewToDoc(t))),t}get modifiers(){return this.jg}set modifiers(e){this.jg=e}get button(){return this.Hg}set button(e){if(this.Hg=e,this.event===null)switch(e){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.qg}set buttons(e){this.qg=e}get key(){return this.Wg}set key(e){this.Wg=e}get code(){return this.Jg}set code(e){this.Jg=e}get down(){return this.$g}set down(e){this.$g=e}get up(){return this.Zg}set up(e){this.Zg=e}get clickCount(){return this.Qg}set clickCount(e){this.Qg=e}get delta(){return this._g}set delta(e){this._g=e}get isMultiTouch(){return this.tm}set isMultiTouch(e){this.tm=e}get handled(){return this.im}set handled(e){this.im=e}get bubbles(){return this.ko}set bubbles(e){this.ko=e}get event(){return this.em}set event(e){this.em=e}get isTouchEvent(){const e=this.event;return e===null?!1:e.pointerType==="touch"||e.pointerType==="pen"}get timestamp(){return this.sm}set timestamp(e){this.sm=e}get targetDiagram(){return this.nm}set targetDiagram(e){this.nm=e}get targetObject(){return this.be}set targetObject(e){this.be=e}get control(){return(this.modifiers&1)!==0}set control(e){this.modifiers=e?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(e){this.modifiers=e?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(e){this.modifiers=e?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(e){this.modifiers=e?this.modifiers|8:this.modifiers&-9}get left(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(e){e?this.buttons|=1:this.buttons&=-2}get right(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(e){e?this.buttons|=2:this.buttons&=-3}get middle(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(e){e?this.buttons|=4:this.buttons&=-5}get commandKey(){const e=this.code,t=this.key;return"cxvyzagCXVYZAG".includes(t)?t.toLowerCase():e==="KeyC"?"c":e==="KeyX"?"x":e==="KeyV"?"v":e==="KeyY"?"y":e==="KeyZ"?"z":e==="KeyA"?"a":e==="KeyG"?"g":e!==""?e:t}}class Oi{constructor(){g(this,"N");g(this,"St");g(this,"om");g(this,"rm");this.N=null,this.St="",this.om=null,this.rm=null}copy(){const e=new Oi;return e.N=this.N,e.St=this.St,e.om=this.om,e.rm=this.rm,e}toString(){let e="*"+this.name;return this.subject!==null&&(e+=":"+this.subject.toString()),this.parameter!==null&&(e+="("+this.parameter.toString()+")"),e}get diagram(){return this.N}set diagram(e){this.N=e}get name(){return this.St}set name(e){this.St=e}get subject(){return this.om}set subject(e){this.om=e}get parameter(){return this.rm}set parameter(e){this.rm=e}}var Zi=(w=>(w[w.Transaction=1]="Transaction",w[w.Property=2]="Property",w[w.Insert=3]="Insert",w[w.Remove=4]="Remove",w))(Zi||{});const hi=class hi{constructor(){g(this,"au");g(this,"lm");g(this,"en");g(this,"ki");g(this,"N");g(this,"cu");g(this,"ac");g(this,"cc");g(this,"fc");g(this,"uc");this.au=2,this.lm="",this.en="",this.ki=null,this.N=null,this.cu=null,this.ac=null,this.cc=null,this.fc=null,this.uc=null}clear(){this.ki=null,this.N=null,this.cu=null,this.ac=null,this.cc=null,this.fc=null,this.uc=null}copy(){const e=new hi;e.au=this.au,e.lm=this.lm,e.en=this.en,e.ki=this.ki,e.N=this.N,e.cu=this.cu;let t=this.ac;return b.G(t)&&b.it(t.copyFrozen)?e.ac=t.copyFrozen():e.ac=t,t=this.cc,b.G(t)&&b.it(t.copyFrozen)?e.cc=t.copyFrozen():e.cc=t,t=this.fc,b.G(t)&&b.it(t.copyFrozen)?e.fc=t.copyFrozen():e.fc=t,t=this.uc,b.G(t)&&b.it(t.copyFrozen)?e.uc=t.copyFrozen():e.uc=t,e}oi(e){e in Zi?this.change=e:b.er(this,e)}toString(){let e="";return this.change===1?e+="* ":this.change===2?e+=this.model!==null?"!m":"!d":e+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(e+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(e+=" "+this.modelChange),e+=": ",this.change===1?this.oldValue!==null&&(e+=" "+this.oldValue):(this.object!==null&&(e+=b.toString(this.object)),this.oldValue!==null&&(e+="  old: "+b.toString(this.oldValue)),this.oldParam!==null&&(e+=" "+this.oldParam),this.newValue!==null&&(e+="  new: "+b.toString(this.newValue)),this.newParam!==null&&(e+=" "+this.newParam)),e}getValue(e){return e?this.oldValue:this.newValue}getParam(e){return e?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.VC(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.VC(this,!1))}get model(){return this.ki}set model(e){this.ki=e}get diagram(){return this.N}set diagram(e){this.N=e}get change(){return this.au}set change(e){this.au=e}get modelChange(){return this.lm}set modelChange(e){this.lm=e}get propertyName(){return this.en}set propertyName(e){this.en=e}get isTransactionFinished(){return this.au===1&&(this.en==="CommittedTransaction"||this.en==="FinishedUndo"||this.en==="FinishedRedo")}get object(){return this.cu}set object(e){this.cu=e}get oldValue(){return this.ac}set oldValue(e){this.ac=e}get oldParam(){return this.cc}set oldParam(e){this.cc=e}get newValue(){return this.fc}set newValue(e){this.fc=e}get newParam(){return this.uc}set newParam(e){this.uc=e}};g(hi,"Transaction",1),g(hi,"Property",2),g(hi,"Insert",3),g(hi,"Remove",4);let si=hi;class Pi{constructor(){g(this,"zC");g(this,"St");g(this,"$k");this.zC=new J().u(),this.St="",this.$k=!1}toString(e){let t="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(e!==void 0&&e>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(t+=`
  `+n.toString())}}return t}clear(){const e=this.changes;e.Pt();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),e.u()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let e=this.changes.count-1;e>=0;e--){const t=this.changes.elt(e);t!==null&&t.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const e=this.changes.count;for(let t=0;t<e;t++){const i=this.changes.elt(t);i!==null&&i.redo()}}uF(e){const t=this.changes;for(let i=t.count-1;i>=e;i--){const s=t.elt(i);s!==null&&s.undo(),t.Pt(),t.removeAt(i)}t.u()}thaw(){this.changes.Pt()}optimize(){if(!this.isComplete)return;const e=this.changes;e.Pt();const t=new bt;for(let s=0;s<e.count;s++){const n=e.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=t.get(n.object);o||(o=new bt,t.set(n.object,o));const r=o.get(n.propertyName);r===null?o.set(n.propertyName,-1):(r>0&&e.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<e.count;s++){const n=e.elt(s);n!==null&&(s>i&&e.setElt(i,n),i++)}for(;e.length>i;)e.pop();e.u()}get changes(){return this.zC}get name(){return this.St}set name(e){this.St=e}get isComplete(){return this.$k}set isComplete(e){this.$k=e}}class Ri{constructor(e){g(this,"Fw");g(this,"Oi");g(this,"XC");g(this,"Os");g(this,"Zk");g(this,"hm");g(this,"Vn");g(this,"Qk");g(this,"_k");g(this,"sn");g(this,"dc");g(this,"Rw");g(this,"Is");g(this,"vw");g(this,"Ow");g(this,"am");g(this,"Iw");this.Fw=new K,this.Oi=!1,this.XC=new J().u(),this.Os=-1,this.Zk=999,this.Is=!1,this.hm=null,this.Vn=0,this.Qk=!1,this._k=23,this.sn=new J().u(),this.dc=new J,this.Rw=!0,this.vw=!1,this.Ow=!1,this.am=!1,this.Iw=!1,e&&Object.assign(this,e)}toString(e){let t="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;t+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(t+=" "),t+=this.nestedTransactionNames.elt(s);if(t+="]",e!==void 0&&e>0){i=this.history.count;for(let s=0;s<i;s++)t+=`
 `+this.history.elt(s).toString(e-1)}return t}clear(){const e=this.history;e.Pt();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),this.Os=-1,e.u(),this.Is=!1,this.hm=null,this.Vn=0,this.sn.Pt(),this.sn.clear(),this.sn.u(),this.dc.clear(),this.vw=!1,this.Ow=!1,this.am=!1,this.Iw=!1}copyProperties(e){this.isEnabled=e.isEnabled,this.maxHistoryLength=e.maxHistoryLength,this.cm=e.cm}addModel(e){this.Fw.add(e)}removeModel(e){this.Fw.delete(e)}startTransaction(e){if(e===void 0&&(e=""),e===null&&(e=""),this.isUndoingRedoing)return!1;this.Rw===!0&&(this.Rw=!1,this.Vn++,this.wl||this.xl("StartingFirstTransaction",e,this.currentTransaction),this.Vn>0&&this.Vn--),this.isEnabled&&(this.sn.Pt(),this.sn.add(e),this.sn.u(),this.currentTransaction===null?this.dc.add(0):this.dc.add(this.currentTransaction.changes.count)),this.Vn++;const t=this.transactionLevel===1;return t&&(this.wl||this.xl("StartedTransaction",e,this.currentTransaction)),t}commitTransaction(e){return e===void 0&&(e=""),this.YC(!0,e)}rollbackTransaction(){return this.YC(!1,"")}YC(e,t){if(this.isUndoingRedoing)return!1;this.cm&&this.transactionLevel<1&&b.ni("Ending transaction without having started a transaction: "+t);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&e&&(this.wl||this.xl("CommittingTransaction",t,s));let n=0;if(this.transactionLevel>0&&(this.Vn--,this.isEnabled)){const o=this.sn.count;o>0&&(t===""&&(t=this.sn.elt(0)),this.sn.Pt(),this.sn.removeAt(o-1),this.sn.u());const r=this.dc.count;r>0&&(n=this.dc.elt(r-1),this.dc.removeAt(r-1))}if(i){if(e){if(this.am=!1,s===null&&t!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=t),this.discardHistoryAfterIndex();const r=this.history;r.Pt();const h=this.maxHistoryLength;if(h>=0){if(h===0)r.clear();else if(r.count>=h){const a=r.elt(0);a!==null&&a.clear(),r.removeAt(0),this.Os--}}h!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.Os++),r.u(),s=o}this.wl||this.xl("CommittedTransaction",t,s)}else{this.Is=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.wl||this.xl("RolledBackTransaction",t,s),this.Is=!1}s!==null&&s.clear()}return this.hm=null,this.Ew&&this.clear(),this.Ew=!1,this.Uw=!1,!0}else return this.isEnabled&&!e&&s!==null&&s.uF(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const e=this.history;e.Pt();for(let t=e.count-1;t>this.historyIndex;t--){const i=e.elt(t);i!==null&&i.clear(),e.removeAt(t),this.am=!0}e.u()}thaw(){this.history.Pt()}SE(e){this.Vn+=e,this.Vn<0&&(this.Vn=0)}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToUndo;return!!(e!==null&&e.canUndo())}undo(){if(!this.canUndo())return;const e=this.transactionToUndo;try{this.Is=!0,this.xl("StartingUndo","Undo",e),this.Os--,e.undo()}catch(t){b.ni("undo error: "+t.toString())}finally{this.xl("FinishedUndo","Undo",e),this.Is=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToRedo;return!!(e!==null&&e.canRedo())}redo(){if(!this.canRedo())return;const e=this.transactionToRedo;try{this.Is=!0,this.xl("StartingRedo","Redo",e),this.Os++,e.redo()}catch(t){b.ni("redo error: "+t.toString())}finally{this.xl("FinishedRedo","Redo",e),this.Is=!1}}xl(e,t,i){i===void 0&&(i=null);const s=new si;s.change=1,s.propertyName=e,s.object=i,s.oldValue=t;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.dF(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;t===null&&(t=new Pi,this.hm=t);const i=e.copy(),s=t.changes;if(s.Pt(),s.add(i),s.u(),this.cm&&this._k>0&&this.transactionLevel<=0&&!this.Rw){const n=e.diagram;if(n!==null&&n.Vh===!1)return;b.ni("Change not within a transaction: "+i.toString()),this._k--}}}skipsEvent(e){if(e===null||e.change===1)return!0;const t=e.object;if(t===null)return!1;if(t.layer!==void 0){const i=t.layer;if(i!==null&&i.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.Fw.iterator}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.Is}get history(){return this.XC}get maxHistoryLength(){return this.Zk}set maxHistoryLength(e){this.Zk=e}get historyIndex(){return this.Os}get currentTransaction(){return this.hm}get transactionLevel(){return this.Vn}get isInTransaction(){return this.Vn>0}get cm(){return this.Qk}set cm(e){this.Qk=e}get nestedTransactionNames(){return this.sn}get Ew(){return this.vw}set Ew(e){this.vw=e}get Uw(){return this.Ow}set Uw(e){this.Ow=e}get wl(){return this.Iw}set wl(e){this.Iw=e}get isJustDiscarded(){return this.am}}class ce{constructor(){g(this,"N");g(this,"St");g(this,"Oi");g(this,"tP");g(this,"iP");g(this,"fm");g(this,"GC");K.Ki(this),this.N=kt.um(),this.St="",this.Oi=!0,this.tP=!1,this.iP=null,this.GC=new Ge,this.fm=-1}get diagram(){return this.N}set diagram(e){e instanceof kt&&(this.N=e)}toString(){return this.name!==""?this.name+" Tool":b.Dn(this.constructor)}updateAdornments(e){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const e=this.diagram;e.currentTool===this&&(e.currentTool=null,e.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.V(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.V(NaN,NaN));if(!i.isReal()||!s.isReal()){S.e(i),S.e(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){e.eP=e.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);e.sP=r,t.bubbles=!1}S.e(i),S.e(s)}standardPinchZoomMove(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,S.V(NaN,NaN)),s=t.getMultiTouchViewPoint(1,S.V(NaN,NaN));if(!i.isReal()||!s.isReal()){S.e(i),S.e(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/e.sP,h=new S((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),a=e.eP*r,l=e.commandHandler;if(a!==e.scale&&l.canResetZoom(a)){const u=e.zoomPoint;e.zoomPoint=h,l.resetZoom(a),e.zoomPoint=u}t.bubbles=!1}S.e(i),S.e(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(e){return e===void 0&&(e=this.name),this.transactionResult=null,this.diagram.startTransaction(e)}stopTransaction(){const e=this.diagram;return this.transactionResult===null?e.rollbackTransaction():e.commitTransaction(this.transactionResult)}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;const t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(i!==null){if(b.tr?t.meta:t.control){e.D("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),e.D("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.D("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),e.D("ChangedSelection",e.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&e.select(s)}}else t.left&&!(b.tr?t.meta:t.control)&&!t.shift&&e.clearSelection()}standardMouseClick(e,t){e===void 0&&(e=null),t===void 0&&(t=o=>{var r;return!((r=o.layer)!=null&&r.isTemporary)});const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,e,t);return s.targetObject=n,this.gF(n,s,i),s.handled}gF(e,t,i){if(t.handled=!1,e!==null&&!e.isEnabledObject())return;let s=0;t.left?t.clickCount===1?s=1:t.clickCount===2?s=2:s=1:t.right&&t.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(e!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.D(n,e)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.D(n)}if(e!==null)for(;e!==null;){let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick;break}if(o!==null&&(o(t,e),t.handled))break;e=e.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(t)}}standardMouseOver(){const e=this.diagram,t=e.lastInput;if(e.animationManager.pi===!0)return;const i=e.skipsUndoManager;e.skipsUndoManager=!0;let s=e.viewportBounds.containsPoint(t.documentPoint)?e.findObjectAt(t.documentPoint,null,null):null;t.event&&(t.event.type==="pointercancel"||t.event.type==="pointerout")&&(s=null),t.targetObject=s;let n=!1;if(s!==e.gc){let o=e.gc;const r=o;for(e.gc=s,this.doCurrentObjectChanged(o,s),t.handled=!1;o!==null;){const h=o.mouseLeave;if(h!==null&&(s===o||s!==null&&s.isContainedBy(o)||(h(t,o,s),n=!0,t.handled)))break;o=o.panel}for(o=r,t.handled=!1;s!==null;){const h=s.mouseEnter;if(h!==null&&(o===s||o!==null&&o.isContainedBy(s)||(h(t,s,o),n=!0,t.handled)))break;s=s.panel}s=e.gc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(e.currentCursor=r,t.handled=!1,o=s;o!==null;){const h=o.mouseOver;if(h!==null&&(h(t,o),n=!0,t.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=e.mouseOver;o!==null&&(o(t),n=!0)}n&&e.requestUpdate(),e.skipsUndoManager=i}doUpdateCursor(e){const t=this.diagram;t&&(t.currentCursor="")}doCurrentObjectChanged(e,t){}standardMouseWheel(){const e=this.diagram,t=e.lastInput;let i=t.delta;if(i===0||!e.documentBounds.isReal())return;const s=e.commandHandler,n=e.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!t.shift||n===1&&t.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=e.zoomPoint;e.zoomPoint=t.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),e.zoomPoint=o}t.bubbles=!1}else if(n===2&&t.shift||n===1&&!t.control){const o=e.position.copy(),r=t.event,h=r.deltaMode;let a=r.deltaX,l=r.deltaY,u="pixel";if((a!==0||l!==0)&&!t.shift){switch(h){case 0:u="pixel";break;case 1:u="line";break;case 2:u="page";break}if(a!==0&&e.allowHorizontalScroll){const c=e.scrollHorizontalLineChange;a=a*(c/16),e.scroll(u,a>0?"right":"left",Math.abs(a))}if(l!==0&&e.allowVerticalScroll){const c=e.scrollVerticalLineChange;l=l*(c/16),e.scroll(u,l>0?"down":"up",Math.abs(l))}}else!t.shift&&e.allowVerticalScroll?(i=i*3*e.scrollVerticalLineChange,e.scroll(u,i>0?"up":"down",Math.abs(i))):t.shift&&e.allowHorizontalScroll&&(i=i*3*e.scrollHorizontalLineChange,e.scroll(u,i>0?"left":"right",Math.abs(i)));this.doWheelChange(e,o,t)}}doWheelChange(e,t,i){(!e.position.equals(t)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(e,t){t===void 0&&(t=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=t.clone(this.GC);this.fm=b.ir(()=>i.doWaitAfter(s),e)}cancelWaitAfter(){this.fm!==-1&&b.Tg(this.fm),this.fm=-1}doWaitAfter(e){}findToolHandleAt(e,t){const i=this.diagram.findObjectAt(e,s=>{for(;s!==null&&!(s.panel instanceof yt);)s=s.panel;return s});return i===null?null:i.part.category===t?i:null}isBeyondDragSize(e,t){const i=this.diagram;e===void 0&&(e=i.firstInput.viewPoint),t===void 0&&(t=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>o}get name(){return this.St}set name(e){this.St=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isActive(){return this.tP}set isActive(e){this.tP=e}get transactionResult(){return this.iP}set transactionResult(e){this.iP=e}}var Bs=(w=>(w[w.Scroll=1]="Scroll",w[w.Zoom=2]="Zoom",w[w.None=3]="None",w))(Bs||{}),Es=(w=>(w[w.Zoom=1]="Zoom",w[w.Cancel=2]="Cancel",w[w.None=3]="None",w))(Es||{});class Se extends ce{constructor(t){super();g(this,"KC");g(this,"jC");g(this,"HC");g(this,"nP");g(this,"oP");g(this,"rP");g(this,"lP");g(this,"hP");g(this,"aP");g(this,"cP");g(this,"dm");g(this,"zh");this.name="ToolManager",this.KC=new J,this.jC=new J,this.HC=new J,this.nP=850,this.oP=850,this.rP=new ot(2,2).$(),this.lP=5e3,this.hP=1,this.aP=1,this.cP=null,this.dm=null,this.zh=-1,t&&Object.assign(this,t)}get mouseWheelBehavior(){return this.hP}set mouseWheelBehavior(t){this.hP=t}get gestureBehavior(){return this.aP}set gestureBehavior(t){this.aP=t}initializeStandardTools(){}updateAdornments(t){const i=this.currentToolTip;if(i instanceof yt&&this.dm===t){const s=i.adornedObject;(t!==null?s!==null&&s.part===t:s===null)?this.showToolTip(i,s):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&this.gestureBehavior===2&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;const s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const n=this.mouseMoveTools.length;for(let o=0;o<n;o++){const r=this.mouseMoveTools.elt(o);if(r.diagram=this.diagram,r.canStart()){t.doFocus(),t.currentTool=r,t.currentTool===r&&(r.isActive||r.doActivate(),r.doMouseMove());return}}}this.standardMouseActivity(t);const s=i.event;s!==null&&(s.type==="pointermove"||!s.cancelable)&&(i.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,i){const s=this.currentToolTip;s!==null&&(i!==null&&s instanceof yt&&(i===s||i.isContainedBy(s))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(i.mF()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled)){const s=t.copy();s.button=2,i.lastInput=s,i.Bw=!0,i.doMouseUp();return}}doMouseHover(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null)for(i.handled=!1;s!==null;){const n=this.isActive?s.mouseHold:s.mouseHover;if(n!==null&&(n(i,s),i.handled))break;s=s.panel}else{const n=this.isActive?t.mouseHold:t.mouseHover;n!==null&&n(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null){const n=this.currentToolTip;if(n instanceof yt&&(s===n||s.isContainedBy(n)))return;for(;s!==null;){const o=s.toolTip;if(o!==null){this.showToolTip(o,s);return}s=s.panel}this.hideToolTip()}else{const n=t.toolTip;n!==null?this.showToolTip(n,null):this.hideToolTip()}}showToolTip(t,i){const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof yt){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const o=t.diagram;o!==null&&o!==s&&o.remove(t),s.add(t),i!==null?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof qe&&t!==this.currentToolTip&&t.show!==null&&t.show(i,s,this);this.currentToolTip=t,this.zh!==-1&&(b.Tg(this.zh),this.zh=-1);const n=this.toolTipDuration;if(n>0&&n!==1/0){const o=this;this.zh=b.ir(()=>o.hideToolTip(),n)}}positionToolTip(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,h=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>h.right&&(o.x-=r.width+5/n.scale),o.x<h.x&&(o.x=h.x),o.y+20/n.scale+r.height>h.bottom?o.y-=r.height+5/n.scale:o.y+=20/n.scale,o.y<h.y&&(o.y=h.y),s.position=o}hideToolTip(){this.zh!==-1&&(b.Tg(this.zh),this.zh=-1);const t=this.diagram,i=this.currentToolTip;i!==null&&(i instanceof yt?(t.remove(i),this.dm!==null&&this.dm.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof qe&&i.hide!==null&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.cP}set currentToolTip(t){this.cP=t,this.dm=t!==null&&t instanceof yt?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.diagram=this.diagram,n.canStart()){t.doFocus(),t.currentTool=n,t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return n}return null}replaceTool(t,i){i!==null&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.name===t)return i!==null?this.mouseDownTools.setElt(n,i):this.mouseDownTools.removeAt(n),o}s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.name===t)return i!==null?this.mouseMoveTools.setElt(n,i):this.mouseMoveTools.removeAt(n),o}s=this.mouseUpTools.length;for(let n=0;n<s;n++){const o=this.mouseUpTools.elt(n);if(o.name===t)return i!==null?this.mouseUpTools.setElt(n,i):this.mouseUpTools.removeAt(n),o}return null}replaceStandardTool(t,i,s){this.Jt(t,i,s)}Jt(t,i,s){i!==null&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):i!==null&&s.add(i)}get mouseDownTools(){return this.KC}get mouseMoveTools(){return this.jC}get mouseUpTools(){return this.HC}get hoverDelay(){return this.nP}set hoverDelay(t){this.nP=t}get holdDelay(){return this.oP}set holdDelay(t){this.oP=t}get dragSize(){return this.rP}set dragSize(t){this.rP=t.P()}get toolTipDuration(){return this.lP}set toolTipDuration(t){this.lP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}g(Se,"WheelScroll",1),g(Se,"WheelZoom",2),g(Se,"WheelNone",3),g(Se,"GestureZoom",1),g(Se,"GestureCancel",2),g(Se,"GestureNone",3);const At=class At extends ce{constructor(t){super();g(this,"fP");g(this,"uP");g(this,"nn");g(this,"dP");g(this,"gP");g(this,"mP");g(this,"pP");g(this,"mc");g(this,"gm");g(this,"yP");g(this,"Xh");g(this,"cr");g(this,"qC");g(this,"wP");g(this,"fu");g(this,"uu");g(this,"xP");g(this,"bP");g(this,"kP");g(this,"PP");this.name="Dragging",this.fP=!0,this.PP=!0,this.uP=!0,this.nn=null,this.dP=null,this.gP=null,this.mP=null,this.pP=!1,this.fu=!1,this.mc=new S(NaN,NaN),this.gm=new S,this.yP=!0,this.Xh=100,this.cr=[],this.qC=new K().u(),this.wP=new zi,this.uu=null,this.xP="copy",this.bP="",this.kP="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.fP}set isCopyEnabled(t){this.fP=t}get copiesEffectiveCollection(){return this.uP}set copiesEffectiveCollection(t){this.uP=t}get dragOptions(){return this.wP}set dragOptions(t){this.wP=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.yP}set isComplexRoutingRealtime(t){this.yP=t;const i=this.diagram.findRouter("AvoidsLinks");i!==null&&(i.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.P(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.P(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.P(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){this.dragOptions.dragsTree=t}get copyCursor(){return this.xP}set copyCursor(t){this.xP=t}get moveCursor(){return this.bP}set moveCursor(t){this.bP=t}get nodropCursor(){return this.kP}set nodropCursor(t){this.kP=t}get currentPart(){return this.dP}set currentPart(t){this.dP=t}get copiedParts(){return this.mP}set copiedParts(t){this.mP=t}get draggedParts(){return this.gP}set draggedParts(t){this.gP=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.qC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){this.diagram.draggedLink=t}get isDragOutStarted(){return this.pP}set isDragOutStarted(t){this.pP=t}get startPoint(){return this.gm}set startPoint(t){this.gm.equals(t)||this.gm.a(t)}get delay(){return this.Xh}set delay(t){this.Xh=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const i=t.lastInput;return!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.Xh)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i===null)return null;for(;i!==null&&!i.canSelect();)i=i.containingGroup;return i!==null&&(i.canMove()||i.canCopy())?i:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i!==null){for(;i!==null&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,this.currentPart!==null&&!this.currentPart.isSelected){t.D("ChangingSelection",t.selection);const s=t.lastInput;!(b.tr?s.meta:s.control)&&!s.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.D("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.uu=null,this.currentPart===null&&this.standardMouseSelect();const i=this.currentPart;if(i===null||!i.canMove()&&!i.canCopy())return;t.cacheGroupExternalLinks(!0),At.dt=null,this.isActive=!0,this.mc.set(t.position),this.SP(t.selection),this.cr.length=0,t.animationManager.stopAnimation();const s=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=s,this.PP=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.du=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Vw(),t.WC(this.draggedParts),t.gu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.pF()}SP(t){if(!this.dragsLink)return;const i=this.diagram,s=i.model.mm(),n=t.first();s&&t.count===1&&n instanceof at&&this.mayDragLink(n)?(this.draggedLink=n,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.nn=i.toolManager.findTool("Relinking"),this.nn===null&&(this.nn=new _i,this.nn.diagram=i),this.nn.originalLink=this.draggedLink):(this.draggedLink=null,this.nn=null)}mayDragLink(t){const i=this.diagram;return i!==null&&i.allowRelink}computeEffectiveCollection(t,i){return this.diagram.commandHandler.computeEffectiveCollection(t,i)}Es(t){return t===void 0?new ni(S.xo):this.isGridSnapEnabled?new ni(new S(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new ni(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.PP,t.gu=!1,t.bl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.MP(),t.NP(this.draggedParts),this.uu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.fu=!1,At.yF(),this.JC(),this.mc.i(NaN,NaN),At.Yh!==null&&(At.Yh.currentCursor=""),At.Yh=null,At.dt=null,this.kl(),t.isMouseCaptured=!1,t.currentCursor="",t.du=!1,this.stopTransaction(),t.CP(!0)}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}MP(){const t=this.diagram,i=t.skipsUndoManager;t.skipsUndoManager=!0;const s=t.lastInput;this.$C(s,null),t.skipsUndoManager=i,this.cr.length=0}ZC(){this.kl(),this.LP();const t=this.diagram;this.mc.isReal()&&(t.position=this.mc),t.stopAutoScroll()}doCancel(){this.kl(),this.LP();const t=this.diagram;this.mc.isReal()&&(t.position=this.mc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const i=t.lastInput,s=t.previousInput;i.code==="Escape"?this.doCancel():(i.code!==s.code||i.modifiers!==s.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}wF(t,i){let s=1/0,n=1/0,o=-1/0,r=-1/0;const h=t.iterator;for(;h.next();){const a=h.value;if(!a.isVisible())continue;const l=a.location,u=l.x,c=l.y;isNaN(u)||isNaN(c)||(u<s&&(s=u),c<n&&(n=c),u>o&&(o=u),c>r&&(r=c))}return s===1/0?i.i(0,0,0,0):i.i(s,n,o-s,r-n),i}AP(t){if(this.copiedParts!==null)return;const i=this.diagram;if(t&&(i.isReadOnly||i.isModelReadOnly)||this.draggedParts===null)return;const s=i.undoManager;s.isEnabled&&s.isInTransaction?s.currentTransaction!==null&&s.currentTransaction.changes.count>0&&(i.undoManager.rollbackTransaction(),i.startTransaction("Drag")):this.LP(),i.skipsUndoManager=!t,i.partManager.addsToTemporaryLayer=!t,this.startPoint=i.firstInput.documentPoint;const n=this.copiesEffectiveCollection?this.draggedParts.toKeySet():i.selection,o=i.copyParts(n,i,!0),r=new bt,h=this.draggedParts.iterator;for(;h.next();){const l=h.key;if(l.ke()&&l.canCopy()){const u=o.get(l);if(u===null)continue;u.location=l.location,u.ensureBounds(),r.set(u,this.Es(u.location))}}const a=o.iterator;for(;a.next();){const l=a.value;l instanceof at&&l.canCopy()&&r.set(l,this.Es())}if(this.copiedParts=r,this.SP(r.toKeySet()),this.draggedLink!==null){const l=this.draggedLink,u=l.routeBounds;l.fr(this.startPoint.x-(u.x+u.width/2),this.startPoint.y-(u.y+u.height/2))}this.doUpdateCursor(null)}kl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const i=this.draggedParts.iterator;for(;i.next();)if(i.key instanceof at){const s=i.value;s.point=new S(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}JC(){this.draggedLink!==null&&(this.dragsLink&&this.nn!==null&&(this.nn.stopDraggingMouseMove(),this.nn.originalLink=null),this.draggedLink=null,this.nn=null)}pc(t,i){if(t===null)return;const s=this.diagram,n=this.startPoint,o=S.l();o.a(s.lastInput.documentPoint),this.moveParts(t,o.subtract(n),i),S.e(o),s.getRenderingHint("temporaryPixelRatio")===!0&&s.Pl===null&&s.avgSpf>30&&(s.Vw(),s.mu())}moveParts(t,i,s){s===void 0&&(s=!1);const n=this.diagram;n!==null&&n.TP(t,i,this.dragOptions,s)}LP(){if(this.draggedParts===null)return;const t=this.diagram;let i=this.draggedParts.iterator;for(;i.next();){const s=i.key;s.ke()&&(s.location=i.value.point)}for(i=this.draggedParts.iterator;i.next();){const s=i.key;if(s instanceof at&&s.suspendsRouting){const n=i.value.point;this.draggedParts.set(s,this.Es()),s.fr(-n.x,-n.y)}}t.maybeUpdate()}xF(t){var s;if(t===null)return!0;const i=t.part;return!!(i===null||i instanceof yt||(s=i.layer)!=null&&s.isTemporary||this.draggedParts&&this.draggedParts.has(i)||this.copiedParts&&this.copiedParts.has(i))}DP(t){const i=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.QC(!1));const s=this.findDragOverObject(t),n=i.lastInput;n.targetObject=s,this.doUpdateCursor(s);const o=i.skipsUndoManager;let r=!1;try{if(i.skipsUndoManager=!0,r=this.$C(n,s),!this.isActive&&At.dt===null)return;const h=s!==null?s.part:null;if(h===null||i.handlesDragDropForTopLevelParts&&h.isTopLevel&&!(h instanceof ut)){const a=i.mouseDragOver;a!==null&&(a(n),r=!0)}if(!this.isActive&&At.dt===null||(this.doDragOver(t,s),!this.isActive&&At.dt===null))return}finally{i.skipsUndoManager=o,r&&i.maybeUpdate()}this.uu=s,!i.isReadOnly&&(i.allowMove||i.allowCopy)&&(i.allowHorizontalScroll||i.allowVerticalScroll)&&i.doAutoScroll(n.viewPoint)}findDragOverObject(t){return this.diagram.FP(t,null,i=>!this.xF(i))}doUpdateCursor(t){const i=this.diagram;(t===null||this.uu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?i.currentCursor=this.copyCursor:this.mayMove()?i.currentCursor=this.moveCursor:this.mayDragOut()&&(i.currentCursor=this.nodropCursor))}$C(t,i){let s=!1,n=this.cr.length;const o=n>0?this.cr[0]:null;if(i===o)return!1;t.handled=!1;for(let h=0;h<n;h++){const a=this.cr[h],l=a.mouseDragLeave;if(l!==null&&(l(t,a,i),s=!0,t.handled))break}if(this.cr.length=0,!this.isActive&&At.dt===null||i===null)return s;t.handled=!1;let r=i;for(;r!==null;)this.cr.push(r),r=this._C(r);n=this.cr.length;for(let h=0;h<n;h++){const a=this.cr[h],l=a.mouseDragEnter;if(l!==null&&(l(t,a,o),s=!0,t.handled))break}return s}ME(t,i){var s;return t===null?!1:!!(t===i||t.isContainedBy(i)||i instanceof ut&&!(t instanceof ut)&&i.handlesDragDropForMembers&&((s=t.part)!=null&&s.isMemberOf(i)))}_C(t){const i=t.panel;if(i!==null)return i;if(t instanceof Lt&&!(t instanceof ut)){const s=t.containingGroup;if(s!==null&&s.handlesDragDropForMembers)return s}return null}tL(t,i){const s=this.diagram,n=this.nn;if(n===null)return null;const o=n.portGravity,r=s.findObjectsNear(t,o,u=>n.findValidLinkablePort(u,i)),h=S.l();let a=1/0,l=null;for(const u=r.iterator;u.next();){const c=u.value;if(c.part===null)continue;const d=c.getDocumentPoint(B.Center,h),f=t.distanceSquaredPoint(d);f<a&&(l=c,a=f)}return S.e(h),l}QC(t){const i=this.draggedLink;if(i!==null){if(i.pointsCount<2)return;const s=this.diagram;if(s.isReadOnly)return;const n=this.nn;if(n===null)return;let o=null,r=null;i.fromNode===null&&(o=this.tL(i.getPoint(0),!1),o!==null&&(r=o.part));let h=null,a=null;i.toNode===null&&(h=this.tL(i.getPoint(i.pointsCount-1),!0),h!==null&&(a=h.part)),n.isValidLink(r,o,a,h)?t?(i.defaultFromPoint=i.getPoint(0),i.defaultToPoint=i.getPoint(i.pointsCount-1),i.suspendsRouting=!1,i.fromNode=r,o!==null&&(i.fromPortId=o.portId),i.toNode=a,h!==null&&(i.toPortId=h.portId),i.fromPort!==s.RP&&s.D("LinkRelinked",i,s.RP),i.toPort!==s.vP&&s.D("LinkRelinked",i,s.vP)):n.doDraggingMouseMove(r,o,a,h):n.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,i){}iL(t){const i=this.diagram;this.dragsLink&&this.QC(!0),this.MP();const s=this.findDragOverObject(t),n=i.lastInput;if(n.targetObject=s,s!==null){n.handled=!1;let a=s;for(;a!==null;){const l=a.mouseDrop;if(l!==null&&(l(n,a),n.handled))break;this.bF(n,a),a=this._C(a)}}else{const a=i.mouseDrop;a!==null&&a(n)}if(!this.isActive&&At.dt===null)return;const o=this.copiedParts||this.draggedParts;if(o!==null){const a=o.iterator;for(;a.next();){const l=a.key;l instanceof st&&l.linksConnected.each(u=>u.suspendsRouting=!1)}}if(this.doDropOnto(t,s),!this.isActive&&At.dt===null)return;const r=z.l(),h=i.selection.iterator;for(;h.next();){const a=h.value;a instanceof st&&this.kF(i,a,r)}z.e(r)}bF(t,i){const s=this.diagram,n=i.part;if(s.handlesDragDropForTopLevelParts&&n!==null&&n.isTopLevel&&!(n instanceof ut)){const o=s.mouseDrop;o!==null&&o(t)}}kF(t,i,s){if(!i.canAvoid())return;let n=!1;s=i.getAvoidableRect(s),t.viewportBounds.containsRect(s)&&(n=!0);const o=this.copiedParts||this.draggedParts;if(o===null)return;const r=t.OP(s,a=>a.part,a=>a instanceof at,!0,a=>a instanceof at,n);if(r.count===0)return;const h=r.iterator;for(;h.next();){const a=h.value;o.has(a)&&o.has(i)||!a.isMemberOf(i)&&a.isAvoiding&&a.invalidateRoute()}}doDropOnto(t,i){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;this.simulatedMouseMove(i.event,i.documentPoint,i.targetDiagram)||this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.AP(!1),this.pc(this.copiedParts,!1)):this.mayMove()?(this.kl(),this.pc(this.draggedParts,!0)):this.mayDragOut()?(this.AP(!1),this.pc(this.copiedParts,!1)):this.kl(),this.DP(t.lastInput.documentPoint))}doMouseUp(){var o;if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram))return;let s=!1;const n=this.mayCopy();if(n&&this.copiedParts!==null?(this.kl(),this.AP(!0),this.pc(this.copiedParts,!1),this.copiedParts!==null&&(t.D("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(r=>{r.isSelected=!0}))):(s=!0,this.kl(),this.mayMove()&&(this.pc(this.draggedParts,!0),this.DP(t.lastInput.documentPoint))),this.fu=!0,this.iL(t.lastInput.documentPoint),this.isActive){const r=n&&this.copiedParts,h=r?(o=this.copiedParts)==null?void 0:o.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,s&&this.PF(),t.invalidateDocumentBounds(),t.NP(this.draggedParts),this.transactionResult=r?"Copy":"Move",t.D(r?"SelectionCopied":"SelectionMoved",h)}this.stopTool(),n&&t.D("ChangedSelection",t.selection)}simulatedMouseMove(t,i,s){if(At.dt===null)return!1;const n=At.dt.diagram;s instanceof kt||(s=null);const o=At.Yh;if(s!==o){if(o!==null&&o!==n){o.stopAutoScroll(),At.dt.isDragOutStarted=!1;const h=o.toolManager.findTool("Dragging");h!==null&&h.doSimulatedDragLeave()}if(At.Yh=s,s!==null&&s!==n){At.dt.ZC();const h=s.toolManager.findTool("Dragging");h!==null&&(h.eL(),h.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(s===null||s===n||!s.allowDrop||s.isReadOnly||!s.allowInsert)return!1;const r=s.toolManager.findTool("Dragging");if(r!==null){let h=i;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),h=s.getMouse(t)),s.lastInput.documentPoint=h,s.lastInput.viewPoint=s.transformDocToView(h),s.lastInput.down=!1,s.lastInput.up=!1,r.doSimulatedDragOver()}return!0}simulatedMouseUp(t,i,s){if(At.dt===null)return!1;const n=At.Yh,o=At.dt.diagram;if(s===null)return At.dt.doCancel(),!0;if(s!==n){if(n!==null){const h=n.toolManager.findTool("Dragging");if(n!==null&&n!==o&&h!==null)return n.stopAutoScroll(),At.dt.isDragOutStarted=!1,h.doSimulatedDragLeave(),!1}At.Yh=s;const r=s.toolManager.findTool("Dragging");r!==null&&(At.dt.ZC(),r.eL(),r.doSimulatedDragEnter())}if(s!==this.diagram){let r=i;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=s.getMouse(t)):r===null&&(r=new S),s.lastInput.documentPoint=r,s.lastInput.viewPoint=s.transformDocToView(r),s.lastInput.down=!1,s.lastInput.up=!0;const h=s.toolManager.findTool("Dragging");h!==null&&h.doSimulatedDrop();const a=At.dt;if(a!==null){const l=a.mayCopy();a.transactionResult=l?"Copy":"Move",a.stopTool()}return!0}return!1}PF(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const i=t.key;if(i instanceof st){const s=i.containingGroup;s!==null&&s.hasPlaceholder()&&!this.draggedParts.has(s)&&s.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(b.tr?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}eL(){At.zw.has(this)||At.zw.add(this)}static yF(){if(At.zw.count>0){const t=At.zw,i=t.length;for(let s=0;s<i;s++){const n=t.elt(s);n.JC(),n.kl(),n.MP(),n.diagram.stopAutoScroll()}t.clear()}}computeBorder(t,i,s){return!this.fu&&this.draggedParts!==null&&!this.draggedParts.has(t)?s.a(i):null}getDraggingSource(){return At.dt}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const i=At.dt;return!(i===null||i.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.ur(),t.animationManager.stopAnimation();const i=At.dt;i!==null&&(this.diagram.du=!0,t.lastInput.event===null&&(t.lastInput.event=i.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=At.dt;t!==null&&t.doSimulatedDragOut(),this.diagram.du=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.pu=!0;const i=At.dt;if(i!==null&&i.draggedParts!==null){if(!this.mayDragIn())return;this.sL(i.draggedParts.toKeySet(),!1,t.firstInput),this.pc(this.copiedParts,!1),this.DP(t.lastInput.documentPoint)}t.animationManager.pu=!1}doSimulatedDrop(){const t=this.diagram,i=At.dt;if(i!==null){const s=i.diagram;if(i.fu=!0,this.kl(),i.draggedParts===null||!this.mayDragIn())return;t.animationManager.pu=!0,t.D("ChangingSelection",t.selection),this.startTransaction("Drop"),this.sL(i.draggedParts.toKeySet(),!0,t.lastInput),this.pc(this.copiedParts,!1);const n=new K;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(o=>{o.isSelected=!0,n.add(o)})),this.iL(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.du=!1,t.D("ExternalObjectsDropped",n,s),this.stopTransaction(),t.D("ChangedSelection",t.selection)}t.animationManager.pu=!1}sL(t,i,s){if(this.copiedParts!==null)return;const n=this.diagram;if(n.isReadOnly||n.isModelReadOnly)return;n.skipsUndoManager=!i,n.partManager.addsToTemporaryLayer=!i,this.startPoint=s.documentPoint;const o=n.copyParts(t,n,!0),r=z.l();this.wF(t,r);const h=r.x+r.width/2,a=r.y+r.height/2;z.e(r);const l=this.gm,u=new bt,c=S.l(),d=t.iterator;for(;d.next();){const m=d.value;if(m instanceof at&&m.canCopy()){const p=o.get(m);if(p===null)continue;p.points=m.points,p.fr(l.x-h,l.y-a),p.suspendsRouting=!0,u.set(p,this.Es())}}const f=t.iterator;for(;f.next();){const m=f.value;if(m.ke()&&m.canCopy()){const p=o.get(m);if(p===null)continue;const y=m.location;c.i(l.x-(h-y.x),l.y-(a-y.y)),p.location=c,p.ensureBounds(),u.set(p,this.Es(c))}}if(S.e(c),this.copiedParts=u,this.SP(u.toKeySet()),this.draggedLink!==null){const m=this.draggedLink,p=m.routeBounds;m.fr(this.startPoint.x-(p.x+p.width/2),this.startPoint.y-(p.y+p.height/2))}this.doUpdateCursor(null)}pF(){this.isDragOutStarted=!0,this.fu=!1,At.dt=this,At.Yh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.uu=null}computeMove(t,i,s,n){const o=this.diagram;return o!==null?o.computeMove(t,i,this.dragOptions,n):new S}};g(At,"zw",new J),g(At,"dt",null),g(At,"Yh",null);let Ue=At;Se.prototype.doCancel=function(){Ue.dt!==null&&Ue.dt.doCancel(),ce.prototype.doCancel.call(this)};class Qi extends ce{constructor(){super();g(this,"IP");g(this,"EP");g(this,"Sl");g(this,"UP");g(this,"BP");g(this,"Gh");g(this,"VP");g(this,"Kh");g(this,"zP");g(this,"XP");g(this,"YP");g(this,"GP");g(this,"KP");g(this,"jP");g(this,"nL");g(this,"HP");g(this,"Ml");g(this,"qP");this.IP=100,this.EP=!1,this.Sl="pointer",this.UP=new at({layerName:"Tool"}).add(new dt({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new dt({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).Et(),this.Gh=new dt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:ot.Uk}).theme("stroke","tempPort"),this.BP=new st({selectable:!1,layerName:"Tool"}).add(this.Gh).Et(),this.Kh=new dt("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:ot.Uk}).theme("stroke","tempPort"),this.VP=new st({selectable:!1,layerName:"Tool"}).add(this.Kh).Et(),this.zP=null,this.XP=null,this.YP=null,this.GP=null,this.KP=null,this.jP=!0,this.nL=new bt,this.HP=null,this.Ml=null,this.qP=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.IP}set portGravity(t){t>=0&&(this.IP=t)}get isUnconnectedLinkValid(){return this.EP}set isUnconnectedLinkValid(t){this.EP=t}get linkingCursor(){return this.Sl}set linkingCursor(t){this.Sl=t}get temporaryLink(){return this.UP}set temporaryLink(t){t.Et(),this.UP=t}get temporaryFromNode(){return this.BP}set temporaryFromNode(t){t.Et(),this.BP=t,t&&(this.Gh=t.port)}get temporaryFromPort(){return this.Gh}set temporaryFromPort(t){if(this.Gh!==null){const i=this.Gh.panel;if(i!==null){const s=i.C.indexOf(this.Gh);i.removeAt(s),i.insertAt(s,t)}}this.Gh=t}get temporaryToNode(){return this.VP}set temporaryToNode(t){t.Et(),this.VP=t,t&&(this.Kh=t.port)}get temporaryToPort(){return this.Kh}set temporaryToPort(t){if(this.Kh!==null){const i=this.Kh.panel;if(i!==null){const s=i.C.indexOf(this.Kh);i.removeAt(s),i.insertAt(s,t)}}this.Kh=t}get originalLink(){return this.zP}set originalLink(t){this.zP=t}get originalFromNode(){return this.XP}set originalFromNode(t){this.XP=t}get originalFromPort(){return this.YP}set originalFromPort(t){this.YP=t}get originalToNode(){return this.GP}set originalToNode(t){this.GP=t}get originalToPort(){return this.KP}set originalToPort(t){this.KP=t}get isForwards(){return this.jP}set isForwards(t){this.jP=t}get validPortsCache(){return this.nL}get targetPort(){return this.HP}set targetPort(t){this.HP=t}copyPortProperties(t,i,s,n,o){if(t===null||i===null||s===null||n===null)return;const r=i.getDocumentScale(),h=ot.l();h.width=i.naturalBounds.width*r,h.height=i.naturalBounds.height*r,n.desiredSize=h,ot.e(h),o?(n.toSpot=i.toSpot,n.toEndSegmentLength=i.toEndSegmentLength):(n.fromSpot=i.fromSpot,n.fromEndSegmentLength=i.fromEndSegmentLength),s.locationSpot=B.Center;const a=S.l();s.location=i.getDocumentPoint(B.Center,a),S.e(a),n.angle=i.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,i,s,n,o)}setNoTargetPortProperties(t,i,s){i!==null&&(i.desiredSize=ot.Uk,i.fromSpot=B.None,i.toSpot=B.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,i,s)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof st){const i=this.targetPort.part;this.isForwards?this.copyPortProperties(i,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(i,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,i){if(t===null)return null;const s=t.part;if(!(s instanceof st))return null;for(;t!==null;){const n=i?t.toLinkable:t.fromLinkable;if(n===!0&&(t.portId!==null||t instanceof st)&&(i?this.isValidTo(s,t):this.isValidFrom(s,t)))return t;if(n===!1)return null;t=t.panel}return null}findTargetPort(t){const i=this.diagram,s=i.lastInput.documentPoint;let n=this.portGravity;const o=i.findObjectsNear(s,n,l=>this.findValidLinkablePort(l,t),null,!0);let r=1/0,h=null;const a=o.iterator;for(;a.next();){const l=a.value,u=l.part;if(!(u instanceof st))continue;const c=l.getDocumentPoint(B.Center,S.l()),d=s.x-c.x,f=s.y-c.y;S.e(c);const m=d*d+f*f;if(m<r){const p=this.validPortsCache.get(l);p!==null?p&&(h=l,r=m):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,u,l)||!t&&this.isValidLink(u,l,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(l,!0),h=l,r=m):this.validPortsCache.set(l,!1)}}if(h!==null){const l=h.part;if(l instanceof st&&(l.layer===null||l.layer.allowLink))return h}return null}isValidFrom(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.fromLinkable!==!0))return!1;const s=i.fromMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&i===this.originalFromPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksOutOf(n).count>=s)return!1}return!0}isValidTo(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.toLinkable!==!0))return!1;const s=i.toMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalToNode&&i===this.originalToPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksInto(n).count>=s)return!1}return!0}isInSameNode(t,i){if(t===null||i===null)return!1;if(t===i)return!0;const s=t.part,n=i.part;return s!==null&&s===n}isLinked(t,i){if(t===null||i===null)return!1;const s=t.part;if(!(s instanceof st))return!1;let n=t.portId;n===null&&(n="");const o=i.part;if(!(o instanceof st))return!1;let r=i.portId;r===null&&(r="");const h=o.findLinksInto(r);for(;h.next();){const a=h.value;if(a.fromNode===s&&a.fromPortId===n)return!0}return!1}isValidLink(t,i,s,n){if(!this.isValidFrom(t,i)||!this.isValidTo(s,n)||i!==null&&n!==null&&(!(i.fromLinkableSelfNode&&n.toLinkableSelfNode)&&this.isInSameNode(i,n)||!(i.fromLinkableDuplicates&&n.toLinkableDuplicates)&&this.isLinked(i,n))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||s!==null&&this.isLabelDependentOnLink(s,this.originalLink))||t!==null&&s!==null&&(t.data===null&&s.data!==null||t.data!==null&&s.data===null)||!this.isValidCycle(t,s,this.originalLink))return!1;let o;return t!==null&&i!==null&&(o=t.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))||s!==null&&n!==null&&(o=s.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))?!1:(o=this.linkValidation,o!==null?o(t,i,s,n,this.originalLink):!0)}isLabelDependentOnLink(t,i){if(t===null)return!1;const s=t.labeledLink;if(s===null)return!1;if(s===i)return!0;const n=new K;return n.add(t),this.WP(s,i,n)}WP(t,i,s){if(t===i)return!0;const n=t.fromNode;if(n!==null&&n.labeledLink&&(s.add(n),this.WP(n.labeledLink,i,s)))return!0;const o=t.toNode;return!!(o!==null&&o.labeledLink&&(s.add(o),this.WP(o.labeledLink,i,s)))}isValidCycle(t,i,s){if(s===void 0&&(s=null),t===null||i===null)return this.isUnconnectedLinkValid;const n=this.diagram;let o=1;if(n&&(n.model.pm()?o=n.isTreePathToChildren?5:6:o=n.validCycle),o===1)return!0;if(o===5){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const h=i.linksConnected;for(;h.next();){const a=h.value;if(a!==s&&a.isTreeLink&&a.toNode===i)return!1}return!this.yu(t,i,s,!0)}else if(o===6){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const h=t.linksConnected;for(;h.next();){const a=h.value;if(a!==s&&a.isTreeLink&&a.fromNode===t)return!1}return!this.yu(t,i,s,!0)}else{if(o===2)return!this.SF(t,i,s);if(o===3)return!this.yu(t,i,s,!1);if(o===4)return!this.MF(t,i,s)}return!0}yu(t,i,s,n){if(t===i)return!0;if(t===null||i===null)return!1;const o=t.linksConnected;for(;o.next();){const r=o.value;if(r===s||n&&!r.isTreeLink||r.toNode!==t)continue;const h=r.fromNode;if(!(h===t||h===null)&&this.yu(h,i,s,n))return!0}return!1}SF(t,i,s){if(t===i)return!0;const n=new K;return n.add(i),this.oL(n,t,i,s)}oL(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n||r.toNode!==i)continue;const h=r.fromNode;if(!(h===i||h===null)&&this.oL(t,h,s,n))return!0}return!1}MF(t,i,s){if(t===i)return!0;const n=new K;return n.add(i),this.rL(n,t,i,s)}rL(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n)continue;const h=r.fromNode,a=r.toNode,l=h===i?a:h;if(!(l===i||l===null)&&this.rL(t,l,s,n))return!0}return!1}get linkValidation(){return this.Ml}set linkValidation(t){this.Ml=t}get portTargeted(){return this.qP}set portTargeted(t){this.qP=t}}var Is=(w=>(w[w.Either=1]="Either",w[w.ForwardsOnly=2]="ForwardsOnly",w[w.BackwardsOnly=3]="BackwardsOnly",w))(Is||{});const ai=class ai extends Qi{constructor(t){super();g(this,"JP");g(this,"$P");g(this,"b");g(this,"ZP");this.name="Linking",this.JP={},this.$P=null,this.b=1,this.ZP=null,t&&Object.assign(this,t)}get archetypeLinkData(){return this.JP}set archetypeLinkData(t){t!==null&&b.ec(t,ai,"archetypeLinkData"),this.JP=t}get archetypeLabelNodeData(){return this.$P}set archetypeLabelNodeData(t){t!==null&&b.ec(t,ai,"archetypeLabelNodeData"),this.$P=t}get direction(){return this.b}set direction(t){this.b=t}get startObject(){return this.ZP}set startObject(t){this.ZP=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Xw()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(i===null&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),i===null)return null;const s=i.part;if(!(s instanceof st))return null;const n=this.direction;if(n===1||n===2){const o=this.findValidLinkablePort(i,!1);if(o!==null)return this.isForwards=!0,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!1))return this.isForwards=!0,r}}if(n===1||n===3){const o=this.findValidLinkablePort(i,!0);if(o!==null)return this.isForwards=!1,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!0))return this.isForwards=!1,r}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(i===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const s=this.originalFromPort.part;s instanceof st&&(this.originalFromNode=s),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const s=this.originalToPort.part;s instanceof st&&(this.originalToNode=s),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,s=null,n=null,o=null,r=null;try{this.targetPort=this.findTargetPort(this.isForwards);const h=this.targetPort;if(h!==null){const a=h.part;a instanceof st&&(this.isForwards?(this.originalFromNode!==null&&(i=this.originalFromNode,s=this.originalFromPort),n=a,o=h):(i=a,s=h,this.originalToNode!==null&&(n=this.originalToNode,o=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,s=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(n=this.originalToNode,o=this.originalToPort);i!==null||n!==null?(r=this.insertLink(i,s,n,o),r!==null?(h===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.D("ChangingSelection",t.selection),t.clearSelection(!0),r.isSelected=!0),this.transactionResult=this.name,t.D("LinkDrawn",r)):this.doNoLink(i,s,n,o)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),r&&t.allowSelect&&t.D("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof at)return t.isTreeLink;const i=this.diagram;if(i===null)return!0;const s=i.partManager.getLinkCategoryForData(t),n=i.partManager.findLinkTemplateForCategory(s);return n!==null?n.isTreeLink:!0}insertLink(t,i,s,n){return this.diagram.partManager.insertLink(t,i,s,n)}doNoLink(t,i,s,n){}};g(ai,"Either",1),g(ai,"ForwardsOnly",2),g(ai,"BackwardsOnly",3);let Bi=ai;class _i extends Qi{constructor(t){super();g(this,"lL",null);g(this,"hL",null);g(this,"QP",null);g(this,"_P",null);g(this,"fs");g(this,"tS");this.name="Relinking",this.fromHandleArchetype=new dt("Diamond",{desiredSize:ot.nu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new dt("Diamond",{desiredSize:ot.nu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.tS=new z,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof at))return;let i="RelinkFrom",s=null;if(t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null&&(s=this.makeAdornment(n,!1),t.addAdornment(i,s)))}if(s===null&&t.removeAdornment(i),i="RelinkTo",s=null,t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null?(s=this.makeAdornment(n,!0),t.addAdornment(i,s)):s.c())}s===null&&t.removeAdornment(i)}makeAdornment(t,i){let s=i?this._P:this.QP;return s&&(s=s.copy(),s.adornedObject=t),s}get fromHandleArchetype(){return this.lL}set fromHandleArchetype(t){this.lL=t,t!==null?this.QP=new yt(rt.Link).add(t).Et():this.QP=null}get toHandleArchetype(){return this.hL}set toHandleArchetype(t){this.hL=t,t!==null?this._P=new yt(rt.Link).add(t).Et():this._P=null}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof yt||b.o("new handle is not in an Adornment: "+t)),this.fs=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Xw()||!t.lastInput.left)return!1;let i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),i!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let s=this.handle;if(s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),s===null)return;const n=s.part;if(!(n instanceof yt)||!(n.adornedPart instanceof at))return;this.handle=s,this.isForwards=n===null||n.category==="RelinkTo",this.originalLink=n.adornedPart}const i=this.originalLink;i!==null&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=i.fromPort,this.originalFromNode=i.fromNode,this.originalToPort=i.toPort,this.originalToNode=i.toNode,this.tS.set(i.actualBounds),i.pointsCount>0&&(i.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=ot.sc),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=i.getPoint(0))),i.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=ot.sc),this.temporaryToNode!==null&&(this.temporaryToNode.location=i.getPoint(i.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(i,this.temporaryLink),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,i){if(t===null||i===null)return;i.adjusting=t.adjusting,i.corner=t.corner;let s=t.curve;(s===11||s===10)&&(s=0),i.curve=s,i.curviness=t.curviness,i.isTreeLink=t.isTreeLink,i.points=t.points,i.routing=t.routing,i.smoothness=t.smoothness,i.fromSpot=t.fromSpot,i.fromEndSegmentLength=t.fromEndSegmentLength,i.fromShortLength=t.fromShortLength,i.toSpot=t.toSpot,i.toEndSegmentLength=t.toEndSegmentLength,i.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=this.originalFromNode,s=this.originalFromPort,n=this.originalToNode,o=this.originalToPort,r=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const h=this.targetPort.part;h instanceof st&&(this.isForwards?(n=h,o=this.targetPort):(i=h,s=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(n=null,o=null):(i=null,s=null):r=null;r!==null?(this.reconnectLink(r,this.isForwards?n:i,this.isForwards?o:s,this.isForwards),this.targetPort===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint,r.invalidateRoute()),this.transactionResult=this.name,t.D("LinkRelinked",r,this.isForwards?this.originalToPort:this.originalFromPort)):this.originalLink!==null&&this.doNoRelink(this.originalLink,this.isForwards),this.originalLink!==null&&this.originalLink.invalidateOtherJumpOvers(this.tS)}finally{this.stopTool()}}}reconnectLink(t,i,s,n){const o=s!==null&&s.portId!==null?s.portId:"";return n?(t.toNode=i,t.toPortId=o):(t.fromNode=i,t.fromPortId=o),!0}doNoRelink(t,i){}doDraggingMouseMove(t,i,s,n){t!==null?(this.copyPortProperties(t,i,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),s!==null?(this.copyPortProperties(s,n,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var Vs=(w=>(w[w.None=0]="None",w[w.Horizontal=1]="Horizontal",w[w.Vertical=2]="Vertical",w[w.All=3]="All",w))(Vs||{});class ci extends ce{constructor(t){super();g(this,"dr");g(this,"iS");g(this,"eS");g(this,"fs");g(this,"Yw");g(this,"sS");g(this,"ym");this.name="LinkReshaping",this.dr=new dt("Rectangle",{desiredSize:ot.yC,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.iS=new dt("Diamond",{desiredSize:ot.nu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.eS=3,this.fs=null,this.Yw=null,this.sS=new S,this.ym=new J,t&&Object.assign(this,t)}getReshapingBehavior(t){return t?t.gr:0}setReshapingBehavior(t,i){t.gr=i}updateAdornments(t){if(t===null||!(t instanceof at))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.path;s!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(this.name),(i===null||i.nS!==t.pointsCount||i.oS!==t.resegmentable)&&(i=this.makeAdornment(s),i!==null&&(i.nS=t.pointsCount,i.oS=t.resegmentable,t.addAdornment(this.name,i))))}i===null&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,s=i.points,n=i.pointsCount,o=i.isOrthogonal;let r=null;if(s!==null&&n>1){r=new yt,r.type=rt.Link;const h=i.firstPickIndex,a=i.lastPickIndex,l=o?1:0;if(i.resegmentable&&i.computeCurve()!==9)for(let u=h+l;u<a-l;u++){const c=this.makeResegmentHandle(t,u);c!==null&&(c.segmentIndex=u,c.segmentFraction=.5,c.fromMaxLinks=999,r.add(c))}for(let u=h+1;u<a;u++){const c=this.makeHandle(t,u);if(c!==null){if(c.segmentIndex=u,u!==h)if(u===h+1&&o){const d=i.getPoint(h);let f=i.getPoint(h+1);A.f(d.x,f.x)&&A.f(d.y,f.y)?(f=i.getPoint(h-1),A.f(d.x,f.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.f(d.y,f.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):A.f(d.x,f.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.f(d.y,f.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else if(u===a-1&&o){let d=i.getPoint(a-1);const f=i.getPoint(a);A.f(d.x,f.x)&&A.f(d.y,f.y)?(d=i.getPoint(a+1),A.f(d.x,f.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.f(d.y,f.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):A.f(d.x,f.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):A.f(d.y,f.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else u===a||(this.setReshapingBehavior(c,3),c.cursor="move");r.add(c)}}r.adornedObject=t}return r}makeHandle(t,i){const s=this.handleArchetype;return s===null?null:s.copy().rS()}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t}makeResegmentHandle(t,i){const s=this.midHandleArchetype;return s===null?null:s.copy().rS()}get midHandleArchetype(){return this.iS}set midHandleArchetype(t){this.iS=t}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof yt||b.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedLink(){return this.Yw}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const i=this.handle.part.adornedPart;if(i instanceof at){if(this.Yw=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&this.handle.fromMaxLinks===999){const s=i.points.copy(),n=this.getResegmentingPoint();if(s.insertAt(this.handle.segmentIndex+1,n),i.isOrthogonal&&s.insertAt(this.handle.segmentIndex+1,n),i.points=s,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.sS=i.getPoint(this.handle.segmentIndex),this.ym=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Yw=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.ym),this.stopTool()}getResegmentingPoint(){return this.handle===null?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(B.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const s=this.adornedLink;if(s!==null&&s.resegmentable&&this.handle!==null){const n=this.handle.segmentIndex,o=s.getPoint(n-1),r=s.getPoint(n),h=s.getPoint(n+1);if(s.isOrthogonal){if(n>s.firstPickIndex+1&&n<s.lastPickIndex-1){let a=s.getPoint(n-2);if(this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(a,o,r,h,!0)||this.isInLineOrtho(a,o,r,h,!1))){const l=s.points.copy();this.isInLineOrtho(a,o,r,h,!0)?(l.setElt(n-2,new S(a.x,(h.y+a.y)/2)),l.setElt(n+1,new S(h.x,(h.y+a.y)/2))):(l.setElt(n-2,new S((h.x+a.x)/2,a.y)),l.setElt(n+1,new S((h.x+a.x)/2,h.y))),l.removeAt(n),l.removeAt(n-1),s.points=l,s.invalidateAdornments()}else if(a=s.getPoint(n+2),this.isWithinResegmentingDistance(r,h)&&(this.isInLineOrtho(o,r,h,a,!0)||this.isInLineOrtho(o,r,h,a,!1))){const l=s.points.copy();this.isInLineOrtho(o,r,h,a,!0)?(l.setElt(n-1,new S(o.x,(o.y+a.y)/2)),l.setElt(n+2,new S(a.x,(o.y+a.y)/2))):(l.setElt(n-1,new S((o.x+a.x)/2,o.y)),l.setElt(n+2,new S((o.x+a.x)/2,a.y))),l.removeAt(n+1),l.removeAt(n),s.points=l,s.invalidateAdornments()}}}else{const a=S.l();if(A.dl(o.x,o.y,h.x,h.y,r.x,r.y,a)&&a.distanceSquaredPoint(r)<this.resegmentingDistance*this.resegmentingDistance){const l=s.points.copy();l.removeAt(n),s.points=l,s.invalidateAdornments()}S.e(a)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("LinkReshaped",this.adornedLink,this.ym)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,s,n,o){return o?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance&&Math.abs(s.y-n.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance&&Math.abs(s.x-n.x)<this.resegmentingDistance}get resegmentingDistance(){return this.eS}set resegmentingDistance(t){this.eS=t}reshape(t){const i=this.adornedLink;if(i===null)return;const s=this.handle;if(s===null)return;i.startRoute();let n=s.segmentIndex;const o=this.getReshapingBehavior(s);if(i.isOrthogonal)if(n===i.firstPickIndex+1){const r=i.firstPickIndex+1;o===2?(i.setPointAt(r,i.getPoint(r-1).x,t.y),i.setPointAt(r+1,i.getPoint(r+2).x,t.y)):o===1&&(i.setPointAt(r,t.x,i.getPoint(r-1).y),i.setPointAt(r+1,t.x,i.getPoint(r+2).y))}else if(n===i.lastPickIndex-1){const r=i.lastPickIndex-1;o===2?(i.setPointAt(r-1,i.getPoint(r-2).x,t.y),i.setPointAt(r,i.getPoint(r+1).x,t.y)):o===1&&(i.setPointAt(r-1,t.x,i.getPoint(r-2).y),i.setPointAt(r,t.x,i.getPoint(r+1).y))}else{let r=n;const h=i.getPoint(r),a=i.getPoint(r-1),l=i.getPoint(r+1);A.f(a.x,h.x)&&A.f(h.y,l.y)?(A.f(a.x,i.getPoint(r-2).x)&&!A.f(a.y,i.getPoint(r-2).y)?(i.insertPointAt(r,t.x,a.y),n++,r++):i.setPointAt(r-1,t.x,a.y),A.f(l.y,i.getPoint(r+2).y)&&!A.f(l.x,i.getPoint(r+2).x)?i.insertPointAt(r+1,l.x,t.y):i.setPointAt(r+1,l.x,t.y)):A.f(a.y,h.y)&&A.f(h.x,l.x)?(A.f(a.y,i.getPoint(r-2).y)&&!A.f(a.x,i.getPoint(r-2).x)?(i.insertPointAt(r,a.x,t.y),n++,r++):i.setPointAt(r-1,a.x,t.y),A.f(l.x,i.getPoint(r+2).x)&&!A.f(l.y,i.getPoint(r+2).y)?i.insertPointAt(r+1,t.x,l.y):i.setPointAt(r+1,t.x,l.y)):A.f(a.x,h.x)&&A.f(h.x,l.x)?(A.f(a.x,i.getPoint(r-2).x)&&!A.f(a.y,i.getPoint(r-2).y)?(i.insertPointAt(r,t.x,a.y),n++,r++):i.setPointAt(r-1,t.x,a.y),A.f(l.x,i.getPoint(r+2).x)&&!A.f(l.y,i.getPoint(r+2).y)?i.insertPointAt(r+1,t.x,l.y):i.setPointAt(r+1,t.x,l.y)):A.f(a.y,h.y)&&A.f(h.y,l.y)&&(A.f(a.y,i.getPoint(r-2).y)&&!A.f(a.x,i.getPoint(r-2).x)?(i.insertPointAt(r,a.x,t.y),n++,r++):i.setPointAt(r-1,a.x,t.y),A.f(l.y,i.getPoint(r+2).y)&&!A.f(l.x,i.getPoint(r+2).x)?i.insertPointAt(r+1,l.x,t.y):i.setPointAt(r+1,l.x,t.y)),i.setPointAt(n,t.x,t.y)}else{i.setPointAt(n,t.x,t.y);let r=i.fromNode,h=i.fromPort;if(r!==null){const u=r.findVisibleNode();u!==null&&u!==r&&(r=u,h=r.port)}if(n===1&&h!==null&&i.computeSpot(!0,h).isNoSpot()){const u=h.getDocumentPoint(B.Center,S.l()),c=i.getLinkPointFromPoint(r,h,u,t,!0,S.l());i.setPointAt(0,c.x,c.y),S.e(u),S.e(c)}let a=i.toNode,l=i.toPort;if(a!==null){const u=a.findVisibleNode();u!==null&&u!==a&&(a=u,l=a.port)}if(n===i.pointsCount-2&&l!==null&&i.computeSpot(!1,l).isNoSpot()){const u=l.getDocumentPoint(B.Center,S.l()),c=i.getLinkPointFromPoint(a,l,u,t,!1,S.l());i.setPointAt(i.pointsCount-1,c.x,c.y),S.e(u),S.e(c)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink;if(i===null)return t;const s=this.handle;if(s===null)return t;const n=s.segmentIndex;switch(this.getReshapingBehavior(s)){case 3:return t;case 2:{const o=i.getPoint(n);return new S(o.x,t.y)}case 1:{const o=i.getPoint(n);return new S(t.x,o.y)}default:case 0:return i.getPoint(n)}}get originalPoint(){return this.sS}get originalPoints(){return this.ym}}g(ci,"None",0),g(ci,"Horizontal",1),g(ci,"Vertical",2),g(ci,"All",3);class zs extends ce{constructor(t){super();g(this,"pr");g(this,"yr");g(this,"Po");g(this,"yc");g(this,"lS");g(this,"us");g(this,"dr");g(this,"fs");g(this,"wm");g(this,"hS");g(this,"wc");g(this,"Gw");g(this,"Kw");g(this,"jw");this.name="Resizing",this.pr=new ot(1,1).u(),this.yr=new ot(9999,9999).u(),this.Po=new ot(NaN,NaN).u(),this.yc=!1,this.lS=!0,this.us=null,this.dr=new dt("Rectangle",{alignmentFocus:B.Center,desiredSize:ot.yC,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.wm=new S,this.hS=new ot,this.wc=new S,this.Gw=new ot(0,0),this.Kw=new ot(1/0,1/0),this.jw=new ot(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(!(t===null||t instanceof at)){if(t.isSelected&&!this.diagram.isReadOnly){const i=t.resizeObject;let s=t.findAdornment(this.name);if(i!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null)){const n=i.getDocumentAngle();t.Nl()&&this.updateResizeHandles(s,n),t.addAdornment(this.name,s);return}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.resizeAdornmentTemplate;if(s){if(i=s.copy(),i===null)return null}else{i=new yt,i.type=rt.Spot,i.locationSpot=B.Center;const o=new ve;o.isPanelMain=!0,i.add(o);let r=this.makeHandle(t,B.TopLeft);r!==null&&i.add(r),r=this.makeHandle(t,B.TopRight),r!==null&&i.add(r),r=this.makeHandle(t,B.BottomRight),r!==null&&i.add(r),r=this.makeHandle(t,B.BottomLeft),r!==null&&i.add(r),r=this.makeHandle(t,B.MiddleTop),r!==null&&i.add(r),r=this.makeHandle(t,B.MiddleRight),r!==null&&i.add(r),r=this.makeHandle(t,B.MiddleBottom),r!==null&&i.add(r),r=this.makeHandle(t,B.MiddleLeft),r!==null&&i.add(r)}return i.adornedObject=t,i}makeHandle(t,i){const s=this.handleArchetype;if(s===null)return null;const n=s.copy().rS();return n.alignment=i,n}updateResizeHandles(t,i){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.NF(t,i);else if(t instanceof rt){const s=t.elements;for(;s.next();){const n=s.value;this.updateResizeHandles(n,i)}}}}NF(t,i){let s=t.alignment;s.isNoSpot()&&(s=B.Center);let n=i;if(s.x<=0)s.y<=0?n+=225:s.y>=1?n+=135:n+=180;else if(s.x>=1)s.y<=0?n+=315:s.y>=1&&(n+=45);else if(s.y<=0)n+=270;else if(s.y>=1)n+=90;else return;n<0?n+=360:n>=360&&(n-=360),n<22.5?t.cursor="e-resize":n<67.5?t.cursor="se-resize":n<112.5?t.cursor="s-resize":n<157.5?t.cursor="sw-resize":n<202.5?t.cursor="w-resize":n<247.5?t.cursor="nw-resize":n<292.5?t.cursor="n-resize":n<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof yt||b.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedObject(){return this.us}set adornedObject(t){t!==null&&t.part instanceof yt&&b.o("new handle must not be in an Adornment: "+t),this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&this.adornedObject.part!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.gu=!0,this.startTransaction(this.name),this.wm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.wc.set(this.adornedObject.part.location),this.hS.set(this.adornedObject.desiredSize),this.jw=this.computeCellSize(),this.Gw=this.computeMinSize(),this.Kw=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.gu=!1,t.bl=!0,this.stopTransaction(),this.handle=null,this.us=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){this.adornedObject!==null&&this.adornedObject.part!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||this.adornedObject===null||this.handle===null)return;const i=this.Gw,s=this.Kw,n=this.jw,o=t.lastInput.documentPoint,r=this.adornedObject.getLocalPoint(o,S.l()),h=this.computeReshape(),a=this.computeResize(r,this.handle.alignment,i,s,n,h);this.resize(a),t.maybeUpdate(),S.e(r)}doMouseUp(){const t=this.diagram;if(this.isActive&&this.adornedObject!==null&&this.handle!==null){const i=this.Gw,s=this.Kw,n=this.jw,o=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,S.l()),r=this.computeReshape(),h=this.computeResize(o,this.handle.alignment,i,s,n,r);this.resize(h),S.e(o),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const i=this.diagram,s=this.adornedObject;if(s===null)return;s.desiredSize=t.size;const n=s.part;if(n===null||this.handle===null)return;n.ensureBounds();const o=s.getDocumentPoint(this.handle.alignment.opposite());if(n instanceof ut){const r=new J;r.add(n);let h;!this.dragsMembers&&!n.hasPlaceholder()&&(h=new zi,h.dragsMembers=!1),i.moveParts(r,this.oppositePoint.copy().subtract(o),!0,h)}else n.location=n.location.copy().subtract(o).add(this.oppositePoint);i.maybeUpdate()}computeResize(t,i,s,n,o,r){if(this.adornedObject===null)return z.Fg;i.isNoSpot()&&(i=B.Center);const h=this.adornedObject.naturalBounds,a=h.x,l=h.y,u=h.x+h.width,c=h.y+h.height;let d=1;if(!r){let p=h.width,y=h.height;p<=0&&(p=1),y<=0&&(y=1),d=y/p}const f=S.l();A.Dg(t.x,t.y,a,l,o.width,o.height,f);const m=h.copy();return i.x<=0?i.y<=0?(m.x=Math.max(f.x,u-n.width),m.x=Math.min(m.x,u-s.width),m.width=Math.max(u-m.x,s.width),m.y=Math.max(f.y,c-n.height),m.y=Math.min(m.y,c-s.height),m.height=Math.max(c-m.y,s.height),r||(m.height/m.width>=1?(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d):(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width),m.x=u-m.width,m.y=c-m.height)):i.y>=1?(m.x=Math.max(f.x,u-n.width),m.x=Math.min(m.x,u-s.width),m.width=Math.max(u-m.x,s.width),m.height=Math.max(Math.min(f.y-l,n.height),s.height),r||(m.height/m.width>=1?(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d):(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width),m.x=u-m.width)):(m.x=Math.max(f.x,u-n.width),m.x=Math.min(m.x,u-s.width),m.width=u-m.x,r||(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d,m.y=l+.5*(c-l-m.height))):i.x>=1?i.y<=0?(m.width=Math.max(Math.min(f.x-a,n.width),s.width),m.y=Math.max(f.y,c-n.height),m.y=Math.min(m.y,c-s.height),m.height=Math.max(c-m.y,s.height),r||(m.height/m.width>=1?(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d):(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width),m.y=c-m.height)):i.y>=1?(m.width=Math.max(Math.min(f.x-a,n.width),s.width),m.height=Math.max(Math.min(f.y-l,n.height),s.height),r||(m.height/m.width>=1?(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d):(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width))):(m.width=Math.max(Math.min(f.x-a,n.width),s.width),r||(m.height=Math.max(Math.min(d*m.width,n.height),s.height),m.width=m.height/d,m.y=l+.5*(c-l-m.height))):i.y<=0?(m.y=Math.max(f.y,c-n.height),m.y=Math.min(m.y,c-s.height),m.height=c-m.y,r||(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width,m.x=a+.5*(u-a-m.width))):i.y>=1&&(m.height=Math.max(Math.min(f.y-l,n.height),s.height),r||(m.width=Math.max(Math.min(m.height/d,n.width),s.width),m.height=d*m.width,m.x=a+.5*(u-a-m.width))),S.e(f),m}computeReshape(){let t=0;return this.adornedObject instanceof dt&&(t=this.adornedObject.aS()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){if(this.adornedObject===null)return ot.sc;const t=this.adornedObject.minSize.copy(),i=this.minSize;return!isNaN(i.width)&&i.width>t.width&&(t.width=i.width),!isNaN(i.height)&&i.height>t.height&&(t.height=i.height),t}computeMaxSize(){if(this.adornedObject===null)return ot.Bk;const t=this.adornedObject.maxSize.copy(),i=this.maxSize;return!isNaN(i.width)&&i.width<t.width&&(t.width=i.width),!isNaN(i.height)&&i.height<t.height&&(t.height=i.height),t}computeCellSize(){var o;const t=new ot(NaN,NaN),i=(o=this.adornedObject)==null?void 0:o.part;if(i){const r=i.resizeCellSize;!isNaN(r.width)&&r.width>0&&(t.width=r.width),!isNaN(r.height)&&r.height>0&&(t.height=r.height)}let s=this.cellSize;isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height);const n=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&n){const r=n.grid;r!==null&&r.visible&&this.isGridSnapEnabled&&(s=r.gridCellSize,isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.pr}set minSize(t){if(!this.pr.equals(t)){let i=t.width;isNaN(i)&&(i=0);let s=t.height;isNaN(s)&&(s=0),this.pr.i(i,s)}}get maxSize(){return this.yr}set maxSize(t){if(!this.yr.equals(t)){let i=t.width;isNaN(i)&&(i=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.yr.i(i,s)}}get cellSize(){return this.Po}set cellSize(t){this.Po.equals(t)||this.Po.a(t)}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}get dragsMembers(){return this.lS}set dragsMembers(t){this.lS=t}get oppositePoint(){return this.wm}set oppositePoint(t){this.wm.equals(t)||this.wm.a(t)}get originalDesiredSize(){return this.hS}get originalLocation(){return this.wc}}class Xs extends ce{constructor(t){super();g(this,"cS");g(this,"fS");g(this,"us",null);g(this,"dr",null);g(this,"Hw",null);g(this,"fs",null);g(this,"uS");g(this,"xm");g(this,"wc");g(this,"dS");g(this,"gS");this.name="Rotating",this.cS=45,this.fS=2,this.wc=new S,this.us=null,this.handleArchetype=new dt("Ellipse",{desiredSize:ot.nu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.uS=0,this.xm=new S(NaN,NaN),this.dS=0,this.gS=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Cl()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.rotateObject;if(i!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let s=t.findAdornment(this.name);if((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null){s.angle=i.getDocumentAngle(),s.hasPlaceholder()||(s.location=this.computeAdornmentLocation(i)),t.addAdornment(this.name,s);return}}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.rotateAdornmentTemplate;return s?i=s.copy():this.Hw!==null&&(i=this.Hw.copy()),i===null?null:(i.adornedObject=t,i)}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t,t!==null?this.Hw=new yt(rt.Position,{locationSpot:B.Center}).add(t).Et():this.Hw=null}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof yt||b.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedObject(){return this.us}set adornedObject(t){t!==null&&t.part instanceof yt&&b.o("new handle must not be in an Adornment: "+t),this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject===null||this.adornedObject.part===null||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.uS=this.adornedObject.angle,this.xm=this.computeRotationPoint(this.adornedObject),this.wc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const i=t.part;if(i!==null){const s=i.locationObject;if(i.rotationSpot.isSpot())return t.getDocumentPoint(i.rotationSpot);if(t===i||t===s)return s.getDocumentPoint(i.locationSpot)}return t.getDocumentPoint(B.Center)}computeAdornmentLocation(t){let i=this.rotationPoint;i.isReal()||(i=this.computeRotationPoint(t));const s=t.getLocalPoint(i);let n=this.handleAngle;n<0?n+=360:n>=360&&(n-=360),n=Math.round(Math.round(n/45)*45);const o=this.handleDistance;return n===0?s.x=t.naturalBounds.width+o:n===45?(s.x=t.naturalBounds.width+o,s.y=t.naturalBounds.height+o):n===90?s.y=t.naturalBounds.height+o:n===135?(s.x=-o,s.y=t.naturalBounds.height+o):n===180?s.x=-o:n===225?(s.x=-o,s.y=-o):n===270?s.y=-o:n===315&&(s.x=t.naturalBounds.width+o,s.y=-o),t.getDocumentPoint(s)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.us=null,this.xm=new S(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const i=this.adornedObject;if(i===null||i.part===null)return;i.angle=t;const s=i.part;s.ensureBounds();const n=s.locationObject,o=s.rotateObject;if(n===o||n.isContainedBy(o)){const r=this.wc.copy();s.location=r.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){var r;let i=this.rotationPoint.directionPoint(t)-this.handleAngle;const s=(r=this.adornedObject)==null?void 0:r.panel;s&&(i-=s.getDocumentAngle()),i>=360?i-=360:i<0&&(i+=360);const n=Math.min(Math.abs(this.snapAngleMultiple),180),o=Math.min(Math.abs(this.snapAngleEpsilon),n/2);return!this.diagram.lastInput.shift&&n>0&&o>0&&(i%n<o?i=Math.floor(i/n)*n:i%n>n-o&&(i=(Math.floor(i/n)+1)*n)),i>=360?i-=360:i<0&&(i+=360),i}get snapAngleMultiple(){return this.cS}set snapAngleMultiple(t){this.cS=t}get snapAngleEpsilon(){return this.fS}set snapAngleEpsilon(t){this.fS=t}get originalAngle(){return this.uS}get rotationPoint(){return this.xm}set rotationPoint(t){this.xm=t.copy()}get handleAngle(){return this.dS}set handleAngle(t){this.dS=t}get handleDistance(){return this.gS}set handleDistance(t){this.gS=t}}class Ks extends ce{constructor(e){super(),this.name="ClickSelecting",e&&Object.assign(this,e)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class js extends ce{constructor(t){super();g(this,"xc");this.name="Action",this.xc=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,i=t.lastInput,s=t.findObjectAt(i.documentPoint,n=>{for(;n.panel!==null;){if(n.isActionable)return n;n=n.panel}return n});return s!==null&&s.isActionable?(this.xc=s,t.gc=t.findObjectAt(i.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionDown!==null&&i.actionDown(t,i)}}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionMove!==null&&i.actionMove(t,i)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionUp!==null&&i.actionUp(t,i),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===i)return s;s=s.panel}return s},s=>s===i)}this.stopTool()}doCancel(){const t=this.diagram.lastInput,i=this.xc;i!==null&&(t.targetObject=i,i.actionCancel!==null&&i.actionCancel(t,i),this.stopTool())}doStop(){this.xc=null}}class Ei extends ce{constructor(t){super();g(this,"Ll");g(this,"mS");g(this,"yc");g(this,"pS");this.name="ClickCreating",this.Ll=null,this.mS=!0,this.yc=!1,this.pS=new S(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.pS=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.pS))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const i=this.diagram,s=this.archetypeNodeData;if(s===null)return null;let n=null;try{if(i.D("ChangingSelection",i.selection),this.startTransaction(this.name),s instanceof Lt)s.ke()&&(s.Et(),n=s.copy(),n!==null&&i.add(n));else if(s!==null){const o=i.model.copyNodeData(s);b.G(o)&&(i.model.addNodeData(o),n=i.findPartForData(o))}if(n!==null){const o=S.V(t.x,t.y);this.isGridSnapEnabled&&this.diagram.yS(n,t,o),n.location=o,i.allowSelect&&(i.clearSelection(!0),n.isSelected=!0),S.e(o)}i.invalidateDocumentBounds(),this.transactionResult=this.name,i.D("PartCreated",n)}finally{this.stopTransaction(),i.D("ChangedSelection",i.selection)}return n}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){t!==null&&b.ec(t,Ei,"archetypeNodeData"),this.Ll=t}get isDoubleClick(){return this.mS}set isDoubleClick(t){this.mS=t}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}}class Ys extends ce{constructor(t){super();g(this,"Xh");g(this,"wS");g(this,"Al");this.name="DragSelecting",this.Xh=175,this.wS=!1,this.Al=new Lt({layerName:"Tool",selectable:!1}).add(new dt("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).Et(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const i=t.lastInput;return!(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(i.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const i=this.computeBoxBounds();let s=this.box.findObject("SHAPE");s===null&&(s=this.box.findMainElement());const n=ot.l().i(i.width,i.height);s!==null&&(s.desiredSize=n),this.box.bc(i.x,i.y,!1),ot.e(n),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.D("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new z(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,s=i.lastInput,n=i.findPartsIn(t,this.isPartialInclusion);if(b.tr?s.meta:s.control)if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected&&(r.isSelected=!1)}}else{const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected=!r.isSelected}}else if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected||(r.isSelected=!0)}}else{const o=new J,r=i.selection.iterator;for(;r.next();){const l=r.value;n.has(l)||o.add(l)}const h=o.iterator;for(;h.next();){const l=h.value;l.isSelected=!1}const a=n.iterator;for(;a.next();){const l=a.value;l.isSelected||(l.isSelected=!0)}}}get delay(){return this.Xh}set delay(t){this.Xh=t}get isPartialInclusion(){return this.wS}set isPartialInclusion(t){this.wS=t}get box(){return this.Al}set box(t){t!==null&&t.Et(),this.Al=t}}class Gs extends ce{constructor(t){super();g(this,"qw");g(this,"aL");g(this,"ko");g(this,"xS");this.name="Panning",this.qw=new S,this.aL=new S,this.ko=!1;const i=this;this.xS=()=>{const s=i.diagram;s!==null&&s.Pi(_.document,"scroll",i.xS,!1),i.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.ko?(t.lastInput.bubbles=!0,t.Ut(_.document,"scroll",this.xS,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.qw.a(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.qw,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.cL()}doMouseUp(){this.cL(),this.stopTool()}cL(){const t=this.diagram;if(this.isActive&&t){if(this.ko){t.lastInput.bubbles=!0;return}const i=t.position,s=t.firstInput.documentPoint,n=t.lastInput.documentPoint;let o=i.x+s.x-n.x,r=i.y+s.y-n.y;t.allowHorizontalScroll||(o=i.x),t.allowVerticalScroll||(r=i.y),t.position=this.aL.i(o,r)}}get bubbles(){return this.ko}set bubbles(t){this.ko=t}get originalPosition(){return this.qw}}class qe{constructor(e){g(this,"Ww");g(this,"Jw");g(this,"bS");g(this,"kS");this.Ww=null,this.Jw=null,this.bS=null,this.kS=null,e&&Object.assign(this,e)}get mainElement(){return this.bS}set mainElement(e){this.bS=e}get show(){return this.Ww}set show(e){this.Ww!==e&&(this.Ww=e)}get hide(){return this.Jw}set hide(e){this.Jw!==e&&(this.Jw=e)}get valueFunction(){return this.kS}set valueFunction(e){this.kS=e}}class xe{constructor(e,t,i){g(this,"ri");g(this,"$w");g(this,"kc");this.ri=e,this.$w=t,this.kc=i}}const zt=class zt extends ce{constructor(t){super();g(this,"PS");g(this,"Zw");g(this,"SS");g(this,"MS");g(this,"Qw");g(this,"_w");g(this,"bm");this.name="ContextMenu",this.PS=null,this.Zw=null,this.SS=null,this.MS=new S,this.Qw=null,this.bm=!1;const i=this;this._w=()=>i.stopTool(),t&&Object.assign(this,t)}CF(){const t=new qe;t.show=(h,a,l)=>l.showDefaultContextMenu(),t.hide=(h,a)=>a.hideDefaultContextMenu(),zt.wu=t;const i=this;this._w=()=>i.stopTool();const s=b.hs("div"),n=b.hs("div");s.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",n.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const o=b.hs("style");_.document.getElementsByTagName("head")[0].appendChild(o),o.sheet.insertRule(".goCXul { list-style: none; }",0),o.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),o.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const r=this.diagram;r!==null&&(r.Ut(s,"contextmenu",zt.jh,!1),r.Ut(s,"selectstart",zt.jh,!1),r.Ut(n,"contextmenu",zt.jh,!1)),s.className="goCXforeground",n.className="goCXbackground",_.document.body&&(_.document.body.appendChild(s),_.document.body.appendChild(n)),zt.km=s,zt.Pm=n,zt.NS=!0}static jh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.MS.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.bm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const i=this.diagram,s=i.lastInput;let n=null;if(t instanceof kt||(t instanceof Ct?n=t:n=i.findObjectAt(s.documentPoint,null,o=>{var r;return!((r=o.layer)!=null&&r.isTemporary)})),n!==null){let o=n;for(;o!==null;){if(o.contextMenu!==null)return o;o=o.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return n.part}else if(i.contextMenu!==null)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof yt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof yt){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const i=this.currentContextMenu;if(i===null)return;let s=null;i instanceof qe||(s=t.findObjectAt(t.lastInput.documentPoint,null,null),s!==null&&s.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(s)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(i===void 0&&(i=null),this.bm)return;this.bm=!0,t&&this.standardMouseSelect();const s=this.standardMouseClick();if(this.bm=!1,!s){this.isActive=!0;const n=zt.wu;if(i===null&&(i=this.findObjectWithContextMenu()),i!==null){const o=i.contextMenu;o!==null?(this.currentObject=i instanceof Ct?i:null,this.showContextMenu(o,this.currentObject)):n!==null&&this.showContextMenu(n,this.currentObject)}else n!==null&&this.showContextMenu(n,null);this.currentContextMenu instanceof yt&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof yt){const n=t;n.layerName="Tool",n.selectable=!1,n.scale=1/s.scale,n.category=this.name,n.hasPlaceholder()&&(n.placeholder.scale=s.scale);const o=n.diagram;o!==null&&o!==s&&o.remove(n),s.add(n),i!==null?n.adornedObject=i:n.data=s.model,n.ensureBounds(),this.positionContextMenu(n,i)}else t instanceof qe&&t.show!==null&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,h=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>h.right&&(o.x-=r.width+5/n.scale),o.x<h.x&&(o.x=h.x),o.y+r.height>h.bottom&&(o.y-=r.height+5/n.scale),o.y<h.y&&(o.y=h.y),s.position=o}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;i!==null&&(i instanceof yt?(t.remove(i),this.Zw!==null&&this.Zw.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof qe&&(i.hide!==null?i.hide(t,this):i.mainElement!==null&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}LF(){const t=this,i=new J;return i.add(new xe("Copy",s=>s.commandHandler.copySelection(),s=>s.commandHandler.canCopySelection())),i.add(new xe("Cut",s=>s.commandHandler.cutSelection(),s=>s.commandHandler.canCutSelection())),i.add(new xe("Delete",s=>s.commandHandler.deleteSelection(),s=>s.commandHandler.canDeleteSelection())),i.add(new xe("Paste",s=>s.commandHandler.pasteSelection(t.mouseDownPoint),s=>s.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new xe("Select All",s=>s.commandHandler.selectAll(),s=>s.commandHandler.canSelectAll())),i.add(new xe("Undo",s=>s.commandHandler.undo(),s=>s.commandHandler.canUndo())),i.add(new xe("Redo",s=>s.commandHandler.redo(),s=>s.commandHandler.canRedo())),i.add(new xe("Scroll To Part",s=>s.commandHandler.scrollToPart(),s=>s.commandHandler.canScrollToPart())),i.add(new xe("Zoom To Fit",s=>s.commandHandler.zoomToFit(),s=>s.commandHandler.canZoomToFit())),i.add(new xe("Reset Zoom",s=>s.commandHandler.resetZoom(),s=>s.commandHandler.canResetZoom())),i.add(new xe("Group Selection",s=>s.commandHandler.groupSelection(),s=>s.commandHandler.canGroupSelection())),i.add(new xe("Ungroup Selection",s=>s.commandHandler.ungroupSelection(),s=>s.commandHandler.canUngroupSelection())),i.add(new xe("Edit Text",s=>s.commandHandler.editTextBlock(),s=>s.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;this.Qw===null&&(this.Qw=this.LF()),zt.km.innerHTML="",zt.Pm.addEventListener("pointerdown",this._w,!1);const i=this,s=b.hs("ul");s.className="goCXul",zt.km.appendChild(s),s.innerHTML="";const n=this.Qw.iterator;for(;n.next();){const o=n.value,r=o.$w,h=o.kc;if(!b.it(r)||b.it(h)&&!h(t))continue;const a=b.hs("li");a.className="goCXli";const l=b.hs("a");l.className="goCXa",l.href="#",l.$w=r,l.addEventListener("pointerdown",function(u){return this.$w(t),i.stopTool(),u.preventDefault(),!1},!1),l.textContent=o.ri,a.appendChild(l),s.appendChild(a)}zt.km.style.display="block",zt.Pm.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==zt.wu)return;zt.km.style.display="none",zt.Pm.style.display="none";const t=this.diagram;t!==null&&t.Pi(zt.Pm,"pointerdown",this._w,!1),this.currentContextMenu=null}get currentContextMenu(){return this.PS}set currentContextMenu(t){this.PS=t,this.Zw=t instanceof yt?t.adornedPart:null}get defaultTouchContextMenu(){return zt.NS===!1&&zt.wu===null&&kt.isUsingDOM()&&this.CF(),zt.wu}set defaultTouchContextMenu(t){t===null&&(zt.NS=!0),zt.wu=t}get currentObject(){return this.SS}set currentObject(t){this.SS=t}get mouseDownPoint(){return this.MS}};g(zt,"wu",null),g(zt,"NS",!1),g(zt,"Pm"),g(zt,"km");let Ii=zt;var Us=(w=>(w[w.LostFocus=1]="LostFocus",w[w.MouseDown=2]="MouseDown",w[w.Tab=3]="Tab",w[w.Enter=4]="Enter",w))(Us||{}),qs=(w=>(w[w.SingleClick=1]="SingleClick",w[w.SingleClickSelected=2]="SingleClickSelected",w[w.DoubleClick=3]="DoubleClick",w))(qs||{}),Hs=(w=>(w[w.None=1]="None",w[w.Active=2]="Active",w[w.Editing=3]="Editing",w[w.Validating=4]="Validating",w[w.Invalid=5]="Invalid",w[w.Validated=6]="Validated",w))(Hs||{});const Jt=class Jt extends ce{constructor(t){super();g(this,"Pe");g(this,"CS");g(this,"LS");g(this,"Tl");g(this,"Gt");g(this,"AS");g(this,"TS");g(this,"DS");g(this,"tx");g(this,"FS");this.name="TextEditing",this.Pe=new Kt,this.CS=null,this.LS=2,this.Tl=null,this.Gt=1,this.AS=1,this.TS=!0,this.DS=null,this.tx=new qe,this.AF(this.tx),t&&Object.assign(this,t)}AF(t){if(!kt.isUsingDOM())return;const i=b.hs("textarea");this.FS=i;const s=this;i.addEventListener("input",function(n){if(s.textBlock===null)return;const o=s.measureTemporaryTextBlock(this.value),r=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,o.measuredBounds.width)*r+"px",this.rows=Math.max(s.textBlock.lineCount,o.lineCount)},!1),i.addEventListener("keydown",function(n){if(n.isComposing||s.textBlock===null)return;const o=n.key;if(o==="Enter"){s.textBlock.isMultiline===!1&&n.preventDefault(),s.acceptText(4);return}else if(o==="Tab"){s.acceptText(3),n.preventDefault();return}else o==="Escape"&&(s.doCancel(),s.diagram!==null&&s.diagram.doFocus())},!1),i.addEventListener("focus",function(n){s.TF(n)},!1),i.addEventListener("blur",function(n){s.DF(n)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(n,o,r)=>{if(!(n instanceof Kt)||!o||!o.div||!(r instanceof Jt))return;if(r.state===5){i.style.border="3px solid red",i.focus();return}const h=n.getDocumentPoint(B.Center),a=o.position,l=o.scale;let u=n.getDocumentScale()*l;u<r.minimumEditorScale&&(u=r.minimumEditorScale);const c=n.naturalBounds.width*u+6,d=n.naturalBounds.height*u+2,f=(h.x-a.x)*l,m=(h.y-a.y)*l,p=n.verticalAlignment,y=(n.lineHeight+n.spacingAbove+n.spacingBelow)*n.lineCount*u,x=.5*d-.5*y,P=p.y*d-p.y*y+p.offsetY-x-y/2;i.value=n.text,o.div.style.font=n.font;const k=1;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=u*100+"%",i.style.lineHeight="normal",i.style.width=c+"px",i.style.left=(f-c/2|0)-k+"px",i.style.top=(m+P|0)-k+"px",i.style.textAlign=n.textAlign,i.style.margin="0",i.style.padding=k+"px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=n.lineCount,i.textScale=u,i.className="goTXarea",o.div.appendChild(i),i.focus(),r.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(n,o)=>{n.div&&n.div.removeChild(i)}}get textBlock(){return this.CS}set textBlock(t){this.CS=t}get currentTextEditor(){return this.DS}set currentTextEditor(t){this.DS=t}get defaultTextEditor(){return this.tx}set defaultTextEditor(t){this.tx=t}get starting(){return this.LS}set starting(t){this.LS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||Jt.Pc&&Jt.Pc!==this&&(Jt.Pc.acceptText(2),Jt.Pc&&Jt.Pc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const i=t.lastInput.documentPoint,s=t.findObjectAt(i);if(s===null||!(s instanceof Kt)||!s.editable||s.part===null||!s.part.canEdit())return!1;const n=s.part;return!(n===null||this.starting===2&&!n.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){Jt.Pc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let i=this.textBlock;if(i===null&&(i=t.findObjectAt(t.lastInput.documentPoint)),i===null||!(i instanceof Kt)||(this.textBlock=i,i.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;i.textEditor!==null&&(s=i.textEditor),this.Pe=this.textBlock.copy();const n=new z(this.textBlock.getDocumentPoint(B.TopLeft),this.textBlock.getDocumentPoint(B.BottomRight));t.scrollToRect(n),s!==null&&s.show!==null&&s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.fL());break;case 1:case 4:case 3:if(t===4&&this.textBlock!==null&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.fL());break}}fL(){const t=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(t!==null&&s!==null){const n=t.text;let o="";if(s.valueFunction!==null&&(o=s.valueFunction()),!this.isValidText(t,n,o)){this.Gt=5,this.doError(n,o);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=o,this.doSuccess(n,o),i!==null&&i.D("TextEdited",t,n),this.stopTransaction(),this.stopTool(),i!==null&&i.doFocus()}}doError(t,i){const s=this.textBlock;if(s===null)return;s.errorFunction!==null&&s.errorFunction(this,t,i);const n=this.currentTextEditor;n!==null&&n.show!==null&&n.show(s,this.diagram,this)}doSuccess(t,i){const s=this.textBlock;s!==null&&s.textEdited!==null&&s.textEdited(s,t,i)}doDeactivate(){const t=this.diagram;if(t!==null){if(this.Gt=1,this.currentTextEditor!==null){const i=this.currentTextEditor;i!==null&&i.hide!==null&&i.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){Jt.Pc=null}TF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.FS;this.Gt===2&&(this.Gt=3),b.it(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}DF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.FS;b.it(i.focus)&&i.focus(),b.it(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,s){const n=this.textValidation;if(n!==null&&!n(t,i,s))return!1;const o=t.textValidation;return!(o!==null&&!o(t,i,s))}get textValidation(){return this.Tl}set textValidation(t){this.Tl=t}get minimumEditorScale(){return this.AS}set minimumEditorScale(t){this.AS=t}get selectsTextOnActivate(){return this.TS}set selectsTextOnActivate(t){this.TS=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const i=this.Pe;return i.text=t,this.textBlock!==null&&i.ht(this.textBlock.Dl,1/0),i}};g(Jt,"LostFocus",1),g(Jt,"MouseDown",2),g(Jt,"Tab",3),g(Jt,"Enter",4),g(Jt,"SingleClick",1),g(Jt,"SingleClickSelected",2),g(Jt,"DoubleClick",3),g(Jt,"StateNone",1),g(Jt,"StateActive",2),g(Jt,"StateEditing",3),g(Jt,"StateValidating",4),g(Jt,"StateInvalid",5),g(Jt,"StateValidated",6),g(Jt,"Pc",null);let Vi=Jt;var Ws=(w=>(w[w.Default=1]="Default",w[w.AnimateLocations=2]="AnimateLocations",w[w.None=3]="None",w))(Ws||{});const _e=class _e{constructor(e){g(this,"N");g(this,"Si");g(this,"Oi");g(this,"wr");g(this,"zn");g(this,"So");g(this,"RS");g(this,"vS");g(this,"Sm");g(this,"pi");g(this,"Sc");g(this,"on");g(this,"Mm");g(this,"Hh");g(this,"ix");g(this,"Nm");g(this,"ex");g(this,"Mc");g(this,"pu");g(this,"Cm");this.N=kt.um(),this.Si=!1,this.Sm=!1,this.pi=!1,this.Sc=!1,this.ex=!0,this.Mc=1,this.pu=!1,this.Oi=!0,this.wr=!0,this.So=600,this.RS=!1,this.vS=!1,this.zn=new K,this.on=new di,this.Mm=new di,this.on.ds=this,this.Hh=new K,this.ix=new K,this.Nm=new K,this.Cm=new K,e&&Object.assign(this,e)}Mo(e){this.N=e}NE(){return this.N}canStart(e){return!0}Fl(e){return!this.Oi||!this.canStart(e)?!1:(this.zn.add(e),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.N.Mi(),this.pi=!0,!0)}getBundleAnimation(){return this.Mm}OS(){if(!this.Oi||(this.Mm.ce.count>0&&this.Mm.start(),!this.pi))return;const e=this.on,t=this.N,i=this.zn.has("Model");if(i&&(this.Sc=!0,this.Mc===1?(e.isViewportUnconstrained=!0,e.ce.clear(),e.add(t,"position",t.position.copy().offset(0,-200),t.position),e.add(t,"opacity",0,1)):this.Mc===3&&e.ce.clear(),this.Mc===2&&t.nx.equals(t.at)?this.ex=!0:this.ex=!1,t.D("InitialAnimationStarting",this)),i&&!this.wr||e.ce.count===0){this.zn.clear(),this.pi=!1,e.ce.clear(),e.lx(t),this.Sc=!1,t.S();return}this.zn.clear(),t.xr=!1;const s=e.ce.get(t);t.autoScale!==1&&s!==null&&(delete s.ei.scale,delete s.gs.scale);const n=this;_.requestAnimationFrame(()=>{n.pi===!1||e.Si||(t.getRenderingHint("temporaryPixelRatio")&&t.Vw(),t.IS(),n.pi=!1,e.start(),e.Si&&(n.xu(),t.invalidateDocumentBounds(),e.uL(0),t.ur(!0),n.bu(),t.D("AnimationStarting",n)))})}ES(){return this.zn.has("Trigger")&&this.zn.count===1}dL(e,t,i,s){this.isTicking||this.ES()||e instanceof at&&(e.fromNode!==null||e.toNode!==null)||this.on.add(e,"position",t,i,s)}hx(e){return this.on.hx(e)}US(e){return this.on.US(e)}FF(e){const t=this.Hh,i=this;function s(){if(i.Nm.count>0&&(t.addAll(i.Nm),i.Nm.clear(),i.Si=!0),i.Si===!1||t.count===0)return;i.ix.addAll(t);const n=i.ix.iterator;for(;n.next();){const o=n.value;o.Si!==!1&&(o.RF()?o.gL(!1):o.Nc=!0)}if(i.ix.clear(),i.Si===!1){_.requestAnimationFrame(s);return}i.xu(),i.N.ur(),i.bu(),_.requestAnimationFrame(s)}this.Si?this.vF(e):(this.Si=!0,t.add(e),_.requestAnimationFrame(()=>s()))}vF(e){this.Nm.add(e)}OF(){const e=this.Hh.iterator;for(;e.next();)e.value.Nc=!1}xu(){if(this.Sm)return;const e=this.N;this.RS=e.skipsUndoManager,this.vS=e.fe,e.skipsUndoManager=!0,e.fe=!0,this.Sm=!0}bu(){const e=this.N;e.skipsUndoManager=this.RS,e.fe=this.vS,this.Sm=!1}stopAnimation(e){const t=this.on;if(this.pi===!0&&(this.pi=!1,this.Sc=!1,this.zn.clear(),t.IF()&&this.N.requestUpdate()),!this.Si){t.ce.clear(),t.lx(this.N);return}if(t.ku(!0),t.lx(null),e===!0){const i=this.Hh.toArray();for(let s=0;s<i.length;s++)i[s].ku(!0)}}ku(e){this.Hh.delete(e),this.Hh.count===0&&(this.Si=!1,this.N.requestUpdate()),e===this.defaultAnimation&&this.N.D("AnimationFinished",this)}Cc(e,t){this.pi&&(!this.zn.has("Expand Tree")&&!this.zn.has("Expand SubGraph")||(this.on.Cc(e,t),this.mL(e)))}Lc(e,t){this.pi&&(!this.zn.has("Collapse Tree")&&!this.zn.has("Collapse SubGraph")||(this.on.Lc(e,t),this.on.BS(t,"position",t.position,t.position),this.mL(e)))}pL(e,t){!this.pi||e.equals(t)||this.ES()||(this.N.Vh||(e=t.copy()),this.on.BS(this.N,"position",e,t))}yL(e,t){this.pi&&(this.ES()||this.on.add(this.N,"scale",e,t))}VS(e,t){e.Se&&(e.br=t,this.Cm.add(e))}mL(e){const t=e.findLinksConnected();for(;t.next();){const i=t.value;i.Se&&(i.br=i.points.copy(),this.Cm.add(i))}}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e,e&&this.Hh.each(t=>{!t.isAnimating&&t.runCount===1/0&&t.start()})}get duration(){return this.So}set duration(e){e<1&&b.W(e,">= 1",_e,"duration"),this.So=e}get isAnimating(){return this.Si}get isTicking(){return this.Sm}get isInitial(){return this.wr}set isInitial(e){this.wr=e}get defaultAnimation(){return this.on}get activeAnimations(){return this.Hh}get initialAnimationStyle(){return this.Mc}set initialAnimationStyle(e){this.Mc=e}static defineAnimationEffect(e,t){_e.ax.set(e,t)}static zS(e,t,i,s,n){e===null&&(e=[0,0,0,0]),t===null&&(t=[0,0,0,0]);let o=e[0],r=e[1];const h=e[2],a=e[3];let l=t[0],u=t[1];const c=t[2],d=t[3];h===0||h===100?(o=l,r=u):(c===0||c===100)&&(l=o,u=r),Math.abs(l-o)>180&&(l>o?o+=360:l+=360);const f=n(i,o,l-o,s)%360,m=n(i,r,u-r,s),p=n(i,h,c-h,s),y=n(i,a,d-a,s);return"hsla("+f+", "+m+"%, "+p+"%, "+y+")"}};g(_e,"ax",new bt),g(_e,"Default",1),g(_e,"AnimateLocations",2),g(_e,"None",3);let Ie=_e;{const w=Ie.ax,e=(t,i,s,n,o,r)=>{t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))};w.set("position:diagram",e),w.set("position",e),w.set("position:part",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("location",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!0):t.location=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("position:placeholder",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new S(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("position:nodeCollapse",(t,i,s,n,o,r)=>{const h=t.actualBounds,a=s.actualBounds,l=a.x+a.width/2-h.width/2,u=a.y+a.height/2-h.height/2;o<r?t.bc(n(o,i.x,l-i.x,r),n(o,i.y,u-i.y,r),!1):t.position=new S(n(o,i.x,l-i.x,r),n(o,i.y,u-i.y,r))}),w.set("desiredSize",(t,i,s,n,o,r)=>{t.desiredSize=new ot(n(o,i.width,s.width-i.width,r),n(o,i.height,s.height-i.height,r))}),w.set("width",(t,i,s,n,o,r)=>{t.width=n(o,i,s-i,r)}),w.set("height",(t,i,s,n,o,r)=>{t.height=n(o,i,s-i,r)}),w.set("fill",(t,i,s,n,o,r)=>{t.fill=Ie.zS(i,s,o,r,n)}),w.set("stroke",(t,i,s,n,o,r)=>{t.stroke=Ie.zS(i,s,o,r,n)}),w.set("strokeWidth",(t,i,s,n,o,r)=>{t.strokeWidth=n(o,i,s-i,r)}),w.set("strokeDashOffset",(t,i,s,n,o,r)=>{t.strokeDashOffset=n(o,i,s-i,r)}),w.set("background",(t,i,s,n,o,r)=>{t.background=Ie.zS(i,s,o,r,n)}),w.set("opacity",(t,i,s,n,o,r)=>{t.opacity=n(o,i,s-i,r)}),w.set("scale",(t,i,s,n,o,r)=>{t.scale=n(o,i,s-i,r)}),w.set("angle",(t,i,s,n,o,r)=>{t.angle=n(o,i,s-i,r)})}const me=class me{constructor(e){g(this,"cx");g(this,"Lm");g(this,"Si");g(this,"Pu");g(this,"So");g(this,"ms");g(this,"wL");g(this,"Ac");g(this,"ce");g(this,"fx");g(this,"ei");g(this,"Xn");g(this,"Su");g(this,"Tc");g(this,"ux");g(this,"gx");g(this,"Nc");g(this,"XS");g(this,"mx");g(this,"ds");g(this,"N");g(this,"YS");g(this,"GS");g(this,"KS");this.N=null,this.ds=null,this.XS=null,this.mx=null,this.YS=!1,this.Si=!1,this.Nc=!1,this.ei=0,this.Xn=0,this.cx=me.EaseInOutQuad,this.Lm=me.EaseInOutQuad,this.Su=!1,this.Tc=!1,this.ux=1,this.gx=0,this.So=NaN,this.ms=NaN,this.GS=0,this.Pu=null,this.wL=S.xo,this.ce=new bt,this.fx=new bt,this.Ac=new K,this.KS=1,e&&Object.assign(this,e)}suspend(){this.Nc=!0}advanceTo(e,t){t&&(this.Nc=!1),this.Su&&e>=this.ms&&(this.Tc=!0,e=e-this.ms),this.GS=e,this.gL(!0),this.ds.xu(),this.N.ur(),this.ds.bu(),this.N.redraw()}lx(e){if(this.fx.clear(),this.Tc=!1,this.gx=0,this.ms=NaN,this.Ac.count>0&&this.Ac.clear(),e!==null){const t=e.links;for(;t.next();)t.value.br=null}}IF(){return this.ce.count>0}start(){if(this.ce.count===0)return this;if(this.Si)return this;let e=this.N;const t=this.ce.iterator;for(;t.next();){const s=t.key;e===null&&(s instanceof kt?e=s:s instanceof Ct&&(e=s.diagram))}if(e!==null)this.N=e,this.ds=e.animationManager;else return this;const i=this.ds;return i.isEnabled===!1?this:(this.ms=isNaN(this.So)?i.duration:this.So,this.Lm=this.cx,i.Sc&&i.Mc===1&&this===i.defaultAnimation&&(this.Lm=me.EaseOutExpo,this.ms=isNaN(this.So)?i.duration===600?900:i.duration:this.So),this.KS=e.scrollMode,this.isViewportUnconstrained&&(e.qh=2),i.xu(),this.Ac.each(s=>{s.data=null,e.add(s)}),i.bu(),this.Si=!0,this.ei=+new Date,this.Xn=this.ei+this.ms,i.FF(this),this)}addTemporaryPart(e,t){return e.ke()?(this.Ac.add(e),this.N=t,this):this}add(e,t,i,s,n){if(this.N===null&&(e instanceof kt?this.N=e:e instanceof Ct&&e.diagram!==null&&(this.N=e.diagram)),e instanceof Lt){if(!e.isAnimated)return this;t==="position"&&(t="position:part")}return this.BS(e,t,i,s,n),this}BS(e,t,i,s,n){const o=this.ce;let r,h,a;if(e instanceof kt&&t==="position"&&(t="position:diagram"),(t==="fill"||t==="stroke"||t==="background")&&(Ft.No(i),Ft.jS(),i=[Ft.Ii.n0,Ft.Ii.n1,Ft.Ii.n2,Ft.Ii.n3],Ft.No(s),Ft.jS(),s=[Ft.Ii.n0,Ft.Ii.n1,Ft.Ii.n2,Ft.Ii.n3]),o.has(e))r=o.get(e),h=r.ei,a=r.gs,h[t]===void 0&&(h[t]=this.Mu(i)),a[t]=this.Mu(s);else{if(t==="position"&&i.equalsApprox(s))return;h={},a={},h[t]=this.Mu(i),a[t]=this.Mu(s),r=new Mn(h,a,n),o.set(e,r)}const l=h[t];l instanceof S&&!l.isReal()&&l.a(this.wL),n&&t.indexOf("position:")===0&&e instanceof Lt?r.yx.location=this.Mu(e.location):n&&(r.yx[t]=this.Mu(i))}Mu(e){return e instanceof S||e instanceof ot?e.copy():e}EF(e){const t=this.ce;if(t.has(e)){const i=t.get(e);i.wx=!0}}hx(e){if(!this.Si)return!1;const t=this.ce.get(e);return t!==null&&t.wx}US(e){if(!this.Si)return!1;const t=this.ce.get(e);return t!==null&&!!(t.ei.position||t.ei["position:part"]||t.ei.location)}RF(){if(this.Ac.count>0)return!0;const e=this.ce.iterator;for(;e.next();){const t=e.key;if(t instanceof Ct&&t.diagram!==null||t instanceof kt)return!0}return!1}gL(e){if(this.Nc&&!e)return;const t=this.ds;if(this.Si===!1)return;const i=+new Date;let s=i>this.Xn?this.ms:i-this.ei;e&&(s=this.GS,s<this.ms?(this.ei=+new Date-s,this.Xn=this.ei+this.ms):s=this.ms),t.xu(),this.uL(s),this.N.ur(!0),t.bu(),i>this.Xn&&(this.Su&&!this.Tc?(this.ei=+new Date,this.Xn=this.ei+this.ms,this.Tc=!0):this.ku(!1))}uL(e){const t=this.ms,i=this.ce.iterator,s=this.Tc;for(;i.next();){const n=i.key;if(n instanceof Ct&&n.diagram===null)continue;const o=i.value,r=s?o.gs:o.ei,h=s?o.ei:o.gs,a=Ie.ax;for(const l in h)l==="position"&&(h["position:placeholder"]||h["position:nodeCollapse"])||a.get(l)!==null&&a.get(l)(n,r[l],h[l],this.Lm,e,t,this)}}stop(){return this.Si?(this.ku(!0),this):this}ku(e){if(this.mx!==null&&this.mx.UF(this.XS),!this.Si)return;const t=this.N,i=this.ds;i.Sc=!1,this.Si=!1,this.Nc=!1,i.xu();const s=this.ce,n=this.Ac.iterator;for(;n.next();)t.remove(n.value);const o=this.Su,r=s.iterator,h=Ie.ax;for(;r.next();){const l=r.key,u=r.value,c=o?u.gs:u.ei,d=o?u.ei:u.gs,f=u.yx;for(const m in d)if(h.get(m)!==null){let p=m;u.xx&&(p==="position:nodeCollapse"||p==="position:placeholder")&&(p="position"),h.get(p)(l,c[m],f[m]!==void 0?f[m]:u.xx?c[m]:d[m],this.Lm,this.ms,this.ms,this)}u.xx&&f.location!==void 0&&l instanceof Lt&&(l.location=f.location),u.wx&&l instanceof Lt&&l.Ei(!1)}this.gx++;const a=!e&&this.ux>this.gx;if(!a&&(this===i.Mm||this===i.defaultAnimation)&&this.ce.clear(),t.bx.clear(),t.CP(!1),t.invalidateDocumentBounds(),t.S(),t.ur(!0),i.defaultAnimation===this){const l=i.Cm.iterator;for(;l.next();)l.value.BF();i.Cm.clear()}if(t.ur(!0),this.isViewportUnconstrained&&(t.scrollMode=this.KS),i.bu(),a){this.Tc=!1,this.start();return}this.lx(null),t.xL(),i.ku(this),this.Pu&&this.Pu(this),t.requestUpdate()}Cc(e,t){const i=t.actualBounds;let s=null;if(t instanceof ut&&(s=t.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(B.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(e,"position",n,e.position,!1)}else this.add(e,"position",new S(i.x+i.width/2,i.y+i.height/2),e.position,!1);this.add(e,"scale",.01,e.scale,!1),e instanceof ut&&this.VF(e,t)}VF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof st&&this.Cc(s,t)}}Lc(e,t){if(!e.isVisible())return;let i=null;if(t instanceof ut&&(i=t.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(B.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(e,"position:placeholder",e.position,s,!0)}else this.add(e,"position:nodeCollapse",e.position,t,!0);this.add(e,"scale",e.scale,.01,!0),this.EF(e),e instanceof ut&&this.zF(e,t)}zF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof st&&this.Lc(s,t)}}get duration(){return this.So}set duration(e){b.s(e,"number",me,"duration"),e<1&&b.W(e,">= 1",me,"duration"),this.So=e}get reversible(){return this.Su}set reversible(e){this.Su=e}get runCount(){return this.ux}set runCount(e){e>0?this.ux=e:b.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Pu}set finished(e){this.Pu!==e&&(e!==null&&b.k(e,me,"finished"),this.Pu=e)}get easing(){return this.cx}set easing(e){this.cx=e}get isViewportUnconstrained(){return this.YS}set isViewportUnconstrained(e){this.YS=e}get isAnimating(){return this.Si}getTemporaryState(e){let t=this.fx.get(e);return t===null&&(t={},this.fx.set(e,t)),t}};g(me,"EaseLinear",(e,t,i,s)=>i*e/s+t),g(me,"EaseInOutQuad",(e,t,i,s)=>(e/=s/2,e<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t)),g(me,"EaseInQuad",(e,t,i,s)=>i*(e/=s)*e+t),g(me,"EaseOutQuad",(e,t,i,s)=>-i*(e/=s)*(e-2)+t),g(me,"EaseInExpo",(e,t,i,s)=>e===0?t:i*Math.pow(2,10*(e/s-1))+t),g(me,"EaseOutExpo",(e,t,i,s)=>e===s?t+i:i*(-Math.pow(2,-10*e/s)+1)+t);let di=me;class Mn{constructor(e,t,i){g(this,"ei");g(this,"gs");g(this,"yx");g(this,"xx");g(this,"wx");this.ei=e,this.gs=t,this.yx={},this.xx=i,this.wx=!1}}var Js=(w=>(w[w.Default=1]="Default",w[w.Immediate=2]="Immediate",w[w.Bundled=3]="Bundled",w))(Js||{});const bi=class bi{constructor(e,t,i){g(this,"be");g(this,"en");g(this,"Nu");g(this,"Dc");this.be=null,this.en=e,this.Nu=i||1,this.Dc=null,t!==void 0&&(this.Dc=t,i===void 0&&(this.Nu=2))}copy(){const e=new bi(this.en);e.Nu=this.Nu;const t=this.Dc;if(t!==null){const i={};t.duration!==void 0&&(i.duration=t.duration),t.finished!==void 0&&(i.finished=t.finished),t.easing!==void 0&&(i.easing=t.easing),e.Dc=i}return e}get propertyName(){return this.en}set propertyName(e){this.en=e}get animationSettings(){return this.Dc}set animationSettings(e){this.Dc=e}XF(e){const t=this.Dc;t!==null&&(t.duration&&(e.duration=t.duration),t.finished&&(e.finished=t.finished),t.easing&&(e.easing=t.easing))}get startCondition(){return this.Nu}set startCondition(e){this.Nu=e}};g(bi,"Default",1),g(bi,"Immediate",2),g(bi,"Bundled",3);let Si=bi;class de{constructor(e){g(this,"N");g(this,"St");g(this,"$t");g(this,"kr");g(this,"Rl");g(this,"vl");g(this,"Ol");g(this,"Il");g(this,"El");g(this,"Ul");g(this,"Bl");g(this,"Vl");g(this,"zl");g(this,"Xl");g(this,"Yl");g(this,"Gl");g(this,"kc");g(this,"Kl");g(this,"kx");g(this,"Am");g(this,"Cu");g(this,"Ct");K.Ki(this),this.N=null,this.Ct=new J,this.St="",this.$t=1,this.kr=!1,this.Rl=!0,this.vl=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.Ul=!0,this.Bl=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.Gl=!0,this.kc=!0,this.Kl=!0,this.kx=!0,this.Am=!1,this.Cu=[],e&&Object.assign(this,e)}YF(){const e=this.Ct;for(let t=0;t<e.length;t++)e.r[t].HS(null);e.clear(),this.Cu.length=0}Mo(e){this.N=e}toString(e){e===void 0&&(e=0);const t='Layer "'+this.name+'"';if(e<=0)return t;let i=0,s=0,n=0,o=0,r=0;const h=this.Ct.iterator;for(;h.next();){const l=h.value;l instanceof ut?n++:l instanceof st?s++:l instanceof at?o++:l instanceof yt?r++:i++}let a="";if(i>0&&(a+=i+" Parts "),s>0&&(a+=s+" Nodes "),n>0&&(a+=n+" Groups "),o>0&&(a+=o+" Links "),r>0&&(a+=r+" Adornments "),e>1){const l=this.Ct.iterator;for(;l.next();){const u=l.value;a+=`
    `+u.toString();const c=u.data;c!==null&&K.as(c)&&(a+=" #"+K.as(c)),u instanceof st?a+=" "+b.toString(c):u instanceof at&&(a+=" "+b.toString(u.fromNode)+" "+b.toString(u.toNode))}}return t+" "+this.Ct.count+": "+a}findObjectAt(e,t,i){if(t===void 0&&(t=null),i===void 0&&(i=null),this.Kl===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(s=!0);const n=S.l(),o=this.Ct.r,r=o.length;for(let h=r;h--;){const a=o[h];if(s===!0&&a.Nl()===!1||!a.isVisible())continue;n.a(e),n.Oe(a.Us);let l=a.bL(n,t,i);if(l!==null&&(t!==null&&(l=t(l)),l!==null&&(i===null||i(l))))return S.e(n),l}return S.e(n),null}findObjectsAt(e,t,i,s){if(t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Kl===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(n=!0);const o=S.l(),r=this.Ct.r,h=r.length;for(let a=h;a--;){const l=r[a];if(n===!0&&l.Nl()===!1||!l.isVisible())continue;o.a(e),o.Oe(l.Us);let u=l;l.kL(o,t,i,s)&&(t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&s.add(u))}return S.e(o),s}findObjectsIn(e,t,i,s,n){if(t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Kl===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(e)&&(o=!0);const r=this.Ct.r,h=r.length;for(let a=h;a--;){const l=r[a];if(o===!0&&l.Nl()===!1||!l.isVisible())continue;let u=l;l.Tm(e,t,i,s,n)&&(t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&n.add(u))}return n}OP(e,t,i,s,n,o,r){if(this.Kl===!1)return n;const h=this.Ct.r,a=h.length;for(let l=a;l--;){const u=h[l];if(r===!0&&u.Nl()===!1||!o(u)||!u.isVisible())continue;let c=u;u.Tm(e,t,i,s,n)&&(t!==null&&(c=t(c)),c!==null&&(i===null||i(c))&&n.add(c))}return n}findObjectsNear(e,t,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Kl===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(r=!0);const h=S.l(),a=S.l(),l=this.Ct.r,u=l.length;for(let c=u;c--;){const d=l[c];if(r===!0&&d.Nl()===!1||!d.isVisible())continue;h.a(e),h.Oe(d.Us),a.i(e.x+t,e.y),a.Oe(d.Us);let f=d;d.PL(h,a,i,s,n,o)&&(i!==null&&(f=i(f)),f!==null&&(s===null||s(f))&&o.add(f))}return S.e(h),S.e(a),o}qS(){return this.Ct.r}ps(e,t){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(s===0)return;const n=b.et(),o=b.et();for(let r=0;r<s;r++){const h=i[r];if(h.WS=r,h instanceof at){if(h.Se===!1)continue}else if(h instanceof yt&&h.adornedPart!==null)continue;const a=h.actualBounds;h.isVisible()&&a.intersectsRectPlus(t,10)?(h.ps(!0),n.push(h)):(h.ps(!1),h.adornments!==null&&h.adornments.count>0&&o.push(h))}for(let r=0;r<n.length;r++){const h=n[r];h.JS();const a=h.adornments;for(;a.next();){const l=a.value;l.ht(1/0,1/0),l.Bt(),l.ps(!0)}}for(let r=0;r<o.length;r++)o[r].JS();b.J(n),b.J(o)}Lu(e){let t=1;return this.$t!==1&&(t=e.globalAlpha,e.globalAlpha=t*this.$t),t}SL(e,t){for(let i=0;i<t;i++)e[i].Au()}Ui(e,t,i){if(!this.visible||this.$t===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(n===0)return;e.kr&&this.SL(s,n);const o=this.Lu(e),r=this.Cu;r.length=0;const h=t.scale,a=z.l();for(let l=0;l<n;l++){const u=s[l];this.Dm(e,u,t,r,h,a,!0)}z.e(a),e.kr&&this.SL(s,n),e.globalAlpha=o}CE(e,t,i){if(!this.visible||this.$t===0)return;const s=this.Ct.r,n=s.length;if(n===0)return;const o=this.Lu(e),r=this.Cu;r.length=0;const h=t.scale,a=z.l();for(let l=0;l<n;l++){const u=s[l];i.has(u)||this.Dm(e,u,t,r,h,a,!0)}z.e(a),e.globalAlpha=o}GF(e,t,i,s){if(!this.visible||this.$t===0||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(o===0)return;const r=this.Lu(e),h=this.Cu;h.length=0;const a=t.scale,l=z.l();for(let u=0;u<o;u++){const c=n[u];i.has(c)&&this.Dm(e,c,t,h,a,l,!1)}z.e(l),e.globalAlpha=r}KF(e,t,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Lu(e);o.Ui(e,i),e.globalAlpha=r}}else{const r=this.Lu(e),h=i.scale,a=z.l(),l=this.Ct.r,u=l.length;for(let c=0;c<u;c++){const d=l[c];!n&&d===o||this.Dm(e,d,i,null,h,a,!1)}z.e(a),e.globalAlpha=r}}LE(e,t,i){if(!this.visible||this.$t===0)return;const s=this.Lu(e),n=this.Cu;n.length=0;const o=t.scale,r=z.l(),h=this.Ct.r,a=h.length,l=i.length;for(let u=0;u<a;u++){const c=h[u],d=c.Wh(c.actualBounds);this.jF(d,i,l,o)&&this.Dm(e,c,t,n,o,r,!0)}z.e(r),e.globalAlpha=s}Dm(e,t,i,s,n,o,r){if(r&&!t.Nl()){e.removePartFromView(t);return}if(s!==null&&t instanceof at&&(t.isOrthogonal&&s.push(t),t.Se===!1)){e.removePartFromView(t);return}let h=!1,a=t.containingGroup;for(;a!==null;)h?a.si!==null&&o.intersectRect(a.si):a.si!==null&&(h=!0,o.a(a.si)),a=a.containingGroup;const l=t.actualBounds;let u=!1;if(h&&t.isVisible()){if(!o.intersectsRect(l)){e.removePartFromView(t);return}u=!o.containsRect(l)}u&&(e.save(),e instanceof ge?e.partClipRect=o.copy():(e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.clip())),l.width*n>i.Fm||l.height*n>i.Fm?t.Ui(e,i):this.HF(e,t,i),u&&(e.restore(),e.clearContextCache(!0))}HF(e,t,i){if(e instanceof ge){t.Ui(e,i);return}const s=t.actualBounds,n=t.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!t.isVisible())return;const o=t.T;if(t.background===null){t.rn(e,"rgba(0,0,0,0.3)",!0,!1,n,s),e.fillRect(s.x,s.y,s.width,s.height);return}if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),t.rn(e,t.background,!0,!1,n,s),e.fillRect(0,0,n.width/2,n.height/2),!o.Yk()){const r=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}jF(e,t,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const h=t[r];if(!(h.width===0||h.height===0)&&e.intersects(h.x-n,h.y-n,h.width+o,h.height+o))return!0}return!1}t(e,t,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,e,this,t,i,s,n)}Jh(e,t,i){const s=this.Ct;if(t.HS(this),e>=s.count)e=s.count;else if(s.elt(e)===t)return-1;s.insertAt(e,t),t.Rm(i);const n=this.diagram;return n!==null&&(i?n.S():n.Jh(t)),this.Px(e,t),e}te(e,t,i){if(!i&&t.layer!==this&&t.layer!==null)return t.layer.te(e,t,i);const s=this.Ct;if(e<0||e>=s.length){if(e=s.indexOf(t),e<0)return-1}else if(s.elt(e)!==t&&(e=s.indexOf(t),e<0))return-1;t.vm(i),s.removeAt(e);const n=this.diagram;return n!==null&&(i?n.S():n.te(t)),t.HS(null),e}Px(e,t){e=this.qF(e,t),t instanceof ut&&this.WF(e,t),t.svg!==null&&t.svg.remove()}qF(e,t){const i=t.zOrder;if(isNaN(i))return e;const s=this.Ct,n=s.count;if(n<=1)return e;if(e<0&&(e=s.indexOf(t)),e<0)return-1;let o=e-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let h=e+1,a=NaN;for(;h<n&&(a=s.elt(h).zOrder,!!isNaN(a));)h++;if(!isNaN(r)&&r>i)for(;;){if(o===-1||r<=i)return o++,o===e?e:(s.removeAt(e),s.insertAt(o,t),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(a)&&a<i)for(;;){if(h===n||a>=i)return h--,h===e?e:(s.removeAt(e),s.insertAt(h,t),h);for(a=NaN;++h<n&&(a=s.elt(h).zOrder,!!isNaN(a)););}return e}WF(e,t){if(t===null||!isNaN(t.zOrder))return;this.JF(e,t);const i=t.containingGroup;i!==null&&this.Px(-1,i)}JF(e,t){if(t.memberParts.count===0)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===t&&(e=o,i>=0)||i<0&&r.containingGroup===t&&(i=o,e>=0))break}if(!(i<0)&&i<e){const o=this.Ct;o.removeAt(e),o.insertAt(i,t)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.N}get name(){return this.St}set name(e){const t=this.St;if(t!==e){const i=this.diagram;if(i!==null){t===""&&b.o("Cannot rename default Layer to: "+e);const n=i.layers;for(;n.next();)n.value.name===e&&b.o("Layer.name is already present in this diagram: "+e)}this.St=e,this.t("name",t,e);const s=this.Ct.iterator;for(;s.next();){const n=s.value;n.layerName=this.St}}}get opacity(){return this.$t}set opacity(e){const t=this.$t;if(t!==e){(e<0||e>1)&&b.W(e,"0 <= value <= 1",de,"opacity"),this.$t=e;const i=this.diagram;i!==null&&i.S(),this.t("opacity",t,e)}}get isViewportAligned(){return this.Am}set isViewportAligned(e){const t=this.Am;t!==e&&(this.Am=e,this.diagram&&(this.ML(),this.diagram.S()),this.t("isViewportAligned",t,e),e&&(this.isInDocumentBounds=!1))}ML(){if(!this.Am)return;const e=this.diagram,t=this.Ct.r,i=t.length,s=e.xt,n=e.bt;for(let o=0;o<i;o++){const r=t[o],h=r.naturalBounds.width,a=r.naturalBounds.height;let l=r.alignment;(l.isDefault()||!l.isSpot())&&(l=B.BottomRight);let u=r.alignmentFocus;u.isDefault()&&(u=new B(l.x,l.y));const c=l.x*s+l.offsetX-(u.x*h+u.offsetX),d=l.y*n+l.offsetY-(u.y*a+u.offsetY),f=S.V(c,d);e.$F(f),r.bc(f.x,f.y,!0),S.e(f),r.tt=1/e.scale}}get isTemporary(){return this.kr}set isTemporary(e){const t=this.kr;t!==e&&(this.kr=e,this.t("isTemporary",t,e))}get visible(){return this.kc}set visible(e){const t=this.kc;if(t!==e){this.kc=e;const i=this.Ct.iterator;for(;i.next();)i.value.Ei(e);const s=this.diagram;s!==null&&s.S(),this.t("visible",t,e)}}get pickable(){return this.Kl}set pickable(e){const t=this.Kl;t!==e&&(this.Kl=e,this.t("pickable",t,e))}get isInDocumentBounds(){return this.kx}set isInDocumentBounds(e){const t=this.kx;t!==e&&(this.kx=e,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(this.vl=e,this.t("allowDelete",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(this.El=e,this.t("allowUngroup",t,e))}get allowLink(){return this.Ul}set allowLink(e){const t=this.Ul;t!==e&&(this.Ul=e,this.t("allowLink",t,e))}get allowRelink(){return this.Bl}set allowRelink(e){const t=this.Bl;t!==e&&(this.Bl=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Yl}set allowRotate(e){const t=this.Yl;t!==e&&(this.Yl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Gl}set allowSelect(e){const t=this.Gl;t!==e&&(this.Gl=e,this.t("allowSelect",t,e))}}var ts=(w=>(w[w.None=1]="None",w[w.Uniform=2]="Uniform",w[w.UniformToFill=3]="UniformToFill",w))(ts||{}),$s=(w=>(w[w.All=1]="All",w[w.NotDirected=2]="NotDirected",w[w.NotDirectedFast=3]="NotDirectedFast",w[w.NotUndirected=4]="NotUndirected",w[w.DestinationTree=5]="DestinationTree",w[w.SourceTree=6]="SourceTree",w))($s||{}),Zs=(w=>(w[w.Document=1]="Document",w[w.Infinite=2]="Infinite",w))(Zs||{}),Qs=(w=>(w[w.TreeParent=1]="TreeParent",w[w.AllParents=2]="AllParents",w[w.AnyParents=3]="AnyParents",w))(Qs||{});const Y=class Y{constructor(e,t){g(this,"ds");g(this,"Wt");g(this,"$S");g(this,"Sx");g(this,"Pr");g(this,"Tu");g(this,"Mx");g(this,"Nx");g(this,"Cx");g(this,"Lx");g(this,"Ax");g(this,"Tx");g(this,"$h");g(this,"qh");g(this,"Dx");g(this,"Fx");g(this,"Rx");g(this,"jl");g(this,"Fc");g(this,"Sr");g(this,"Om");g(this,"vx");g(this,"Ox");g(this,"Du");g(this,"Yn");g(this,"Mr");g(this,"Zh");g(this,"Co");g(this,"Im");g(this,"Rc");g(this,"Em");g(this,"vc");g(this,"Fu");g(this,"Nr");g(this,"Gn");g(this,"ZS");g(this,"QS");g(this,"Ix");g(this,"Ex");g(this,"_S");g(this,"Ux");g(this,"tM");g(this,"iM");g(this,"eM");g(this,"Bx");g(this,"Um");g(this,"Cr");g(this,"Lr");g(this,"Ar");g(this,"Tr");g(this,"Dr");g(this,"Fr");g(this,"Vx");g(this,"Rr");g(this,"zx");g(this,"vr");g(this,"Or");g(this,"Ir");g(this,"Er");g(this,"Xx");g(this,"sM");g(this,"Lo");g(this,"nM");g(this,"Yx");g(this,"Gx");g(this,"oM");g(this,"ki");g(this,"rM");g(this,"lM");g(this,"hM");g(this,"Os");g(this,"Ao");g(this,"Oi");g(this,"Kx");g(this,"Rl");g(this,"vl");g(this,"jx");g(this,"Hx");g(this,"Ol");g(this,"Il");g(this,"El");g(this,"qx");g(this,"Ul");g(this,"Bl");g(this,"Vl");g(this,"zl");g(this,"Xl");g(this,"Yl");g(this,"Gl");g(this,"Wx");g(this,"Jx");g(this,"aM");g(this,"Ru");g(this,"vu");g(this,"$x");g(this,"Zx");g(this,"Qx");g(this,"_x");g(this,"Bm");g(this,"tb");g(this,"ib");g(this,"eb");g(this,"Zt");g(this,"cM");g(this,"sb");g(this,"fM");g(this,"Ou");g(this,"ln");g(this,"Kn");g(this,"ie");g(this,"jn");g(this,"NL");g(this,"Hl");g(this,"uM");g(this,"dM");g(this,"Vm");g(this,"nb");g(this,"Iu");g(this,"zm");g(this,"ob");g(this,"Ur");g(this,"ql");g(this,"Qh");g(this,"gM");g(this,"mM");g(this,"Xm");g(this,"rb");g(this,"lb");g(this,"Ze");g(this,"Eu");g(this,"Ym");g(this,"Uu");g(this,"Wl");g(this,"Oc");g(this,"Gm");g(this,"Br");g(this,"_h");g(this,"pM");g(this,"Km");g(this,"Ht");g(this,"T");g(this,"Ue");g(this,"xr");g(this,"Bi");g(this,"ys");g(this,"yM");g(this,"Jl");g(this,"Vr");g(this,"bl");g(this,"zr");g(this,"ta");g(this,"Ic");g(this,"wM");g(this,"Bu");g(this,"ia");g(this,"Vu");g(this,"Xt");g(this,"$l");g(this,"at");g(this,"tt");g(this,"zu");g(this,"xt");g(this,"bt");g(this,"ft");g(this,"Ec");g(this,"Bw");g(this,"hb");g(this,"ea");g(this,"Uc");g(this,"ab");g(this,"cb");g(this,"fb");g(this,"ZF");g(this,"QF");g(this,"Vi");g(this,"Pl");g(this,"Fm");g(this,"jm");g(this,"xM");g(this,"bM");g(this,"CL");g(this,"Hm");g(this,"_F");g(this,"tR");g(this,"iR");g(this,"ub");g(this,"eR");g(this,"sR");g(this,"nR");g(this,"sa");g(this,"LL");g(this,"Zl");g(this,"na");g(this,"oa");g(this,"ra");g(this,"la");g(this,"mu");g(this,"jh");g(this,"Qt");g(this,"Mt");g(this,"Bc");g(this,"eP");g(this,"sP");g(this,"gc");g(this,"$t");g(this,"gu");g(this,"gb");g(this,"pb");g(this,"yb");g(this,"wb");g(this,"xb");g(this,"qm");g(this,"SM");g(this,"Wm");g(this,"Jm");g(this,"$m");g(this,"nx");g(this,"MM");g(this,"NM");g(this,"Vc");if(Y.mw||(Y.Gk(),Y.mw=!0),K.Ki(this),Y.TL(this),this.Ht=!0,this.Mt=null,this.xt=0,this.bt=0,this.ft=null,Y.isUsingDOM()){const s=this,n=()=>{s.Pi(_.document,"DOMContentLoaded",n,!1),s.setRTL()};_.document.body!==null?this.setRTL():s.Ut(_.document,"DOMContentLoaded",n,!1)}this.Ec=null,Y.CM("Model",ri);const i=this;return this.rM=s=>i.partManager.doModelDataChanged(s),this.lM=s=>i.partManager.doModelChanged(s),this.ab=null,this.cb=null,this.DL(),this.model=It.LM(),this.themeManager=new Li,this.Lo=!0,this.FL(),this.layout=new ne,this.Lo=!1,this._F=null,this.tR=null,this.iR=null,this.ub=null,this.eR=null,this.sR=null,this.nR=null,this.sa=null,this.LL=null,this.Zl=null,this.na=null,this.oa=null,this.ra=null,this.la=null,this.mu=()=>{},this.jh=null,this.Uu=!1,this.Bc=new Nn(this),e!==void 0&&(typeof e=="string"||_.Element&&e instanceof Element?this.AM(e):t=e),t&&this.setProperties(t),this.Ht=!1,this.requestUpdate(),this}mF(){return this.ft!==null}get renderer(){return this.Oc}set renderer(e){if(this instanceof Xi)return;e===""&&(e="default");const t=e.toLowerCase(),i=this.Oc;if(t===i)return;this.Oc=t;let s=null;t==="default"||t==="canvas"?(s=this.Wl.get("svg"),s!==null&&s.Tt.remove(),this.ft&&(this.Qt=this.ft.li),this.Qt.clearContextCache(!0)):t==="svg"?(this.Wl.has("svg")?s=this.Wl.get("svg"):(s=new Ni(this,_.document),this.addRenderer("svg",s)),this.div!==null&&this.div.appendChild(s.Tt),this.Qt=s.li,this.ft&&(this.ft.li.setTransform(this.Vi,0,0,this.Vi,0,0),this.ft.li.clearRect(0,0,this.xt,this.bt))):t==="debug"&&(this.Wl.has("SVG")||(s=new Ni(this,_.document),this.addRenderer("SVG",s),s.Tt.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.Tt))),this.Ht||this.redraw()}DL(){this.Vc=new J,this.setupRouters(),this.ds=new Ie,this.ds.Mo(this),this.Wt=17,this.$S=!1,this.zu=!1,this.Sx="default",this.Xt=new J,this.Wl=new bt,this.Oc="default",this.resetRenderingHints(),this.oR(),this.$t=1,this.at=new S(NaN,NaN).u(),this.nx=new S(NaN,NaN),this.tt=1,this.Km=1,this.Mx=new S(NaN,NaN).u(),this.Nx=NaN,this.Cx=1e-4,this.Lx=100,this.T=new Tt,this.Ax=new S(NaN,NaN).u(),this.Tx=new z(NaN,NaN,NaN,NaN).u(),this.$h=new Ot(0,0,0,0).u(),this.qh=1,this.Dx=!1,this.Fx=null,this.Rx=null,this.jl=1,this.Fc=B.Default,this.Sr=1,this.Om=B.Default,this.vx=B.None,this.Ox=B.None,this.Ue=!0,this.Du=!1,this.Yn=new Set,this.Mr=new K,this.Zh=new K,this.Co=!1,this.$l=new bt,this.Bu=!0,this.Im=250,this.Rc=-1,this.Em=new Ot(16,16,16,16).u(),this.xr=!1,this.vc=!1,this.Fu=!0,this.Gm=new Ge,this.Gm.diagram=this,this.Br=new Ge,this.Br.diagram=this,this._h=new Ge,this._h.diagram=this,this.Nr=null,this.Gn=null,this.Bw=!1,this.rR(),this.zr=new K,this.Ix=!0,this.Ex=1,this._S=!1,this.Ux=1,this.Bx="auto",this.Um="auto",this.Cr=null,this.Lr=null,this.Ar=null,this.Tr=null,this.Dr=null,this.Fr=null,this.Vx=null,this.Rr=null,this.zx=!1,this.vr=null,this.Or=null,this.Ir=null,this.Er=null,this.Xx=!1,this.hb={},this.ea=[null,null],this.Lo=!1,this.nM=!1,this.Yx=!1,this.Gx=!1,this.oM=!0,this.ys=!1,this.ia=!1,this.hM=!0,this.Os=-2,this.Jl=new bt,this.Vu=new J,this.Ao=!1,this.Oi=!0,this.Kx=!0,this.Rl=!0,this.vl=!0,this.jx=!1,this.Hx=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.qx=!0,this.Ul=!0,this.Bl=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.Gl=!0,this.Wx=!0,this.Jx=!0,this.aM=!1,this.Uc=!1,this.Ru=!0,this.vu=!0,this.$x=!0,this.Zx=!0,this.Qx=16,this._x=16,this.Bm=!1,this.tb=!1,this.ib=0,this.eb=0,this.Zt=new Ot(5).u(),this.cM=new K().u(),this.sb=999999999,this.fM=new K().u(),this.ta=!0,this.Ou=!0,this.Ic=!0,this.ln=!1,this.Kn=!1,this.Vr=!0,this.bl=!1,this.jn=!1,this.NL=new K,this.wM=new K,this.Hl=null,this.uM=new ot(8,8),this.dM=999,this.Vm=!1,this.eP=1,this.sP=0,this.Bi={scale:1,position:new S,bounds:new z,canvasSize:new ot,newCanvasSize:new ot,isScroll:!1},this.Bi.canvasSize=this.Bi.canvasSize,this.Bi.newCanvasSize=this.Bi.newCanvasSize,this.Bi.isScroll=!1,this.nb=new z(NaN,NaN,NaN,NaN).u(),this.Iu=new ot(NaN,NaN).u(),this.zm=new z(NaN,NaN,NaN,NaN).u(),this.ob=!1,this.lR(),this.Ze=null,this.Eu=!1,this.gc=null,this.partManager=new ri,this.toolManager=new Se,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.pb=null,this.yb=new zi,this.wb=null,this.xb=null,this.gb=!1,this.gu=!1,this.commandHandler=new we,this.Jm=null,this.$m=S.Ik,this.MM=!1,this.Vi=1,this.Pl=null,this.Fm=1,this.qm=0,this.SM=[0,0,0,0,0],this.Wm=0,this.jm=1,this.xM=0,this.bM=new S,this.CL=500,this.Ym=new S,this.Hm=!1}static isUsingDOM(){return Y.RL}static useDOM(e){Y.RL=e?_.document!==void 0:!1}clear(){this.animationManager.stopAnimation(),this.model.clear(),Y.vL(),this.OL(!1),this.Vu.clear(),this.IL(),this.Hl=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.S()}OL(e){this.animationManager.stopAnimation(!0),this.cM=new K().u(),this.fM=new K().u();const t=this.skipsUndoManager,i=this.ki!==null&&this.ki!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.Ze!==null&&(s=this.Ze.part,s!==null&&this.remove(s));const n=[],o=this.Xt.length;if(e){for(let r=0;r<o;r++){const h=this.Xt.r[r].parts;for(;h.next();){const a=h.value;a!==s&&a.data===null&&n.push(a)}}for(let r=0;r<n.length;r++){const h=n[r];this.remove(h)}}for(let r=0;r<o;r++)this.Xt.r[r].YF();return this.partManager.clear(),this.Yn.clear(),this.Mr.clear(),this.Zh.clear(),this.$l.clear(),this.zr.clear(),this.gc=null,this.Vu.clear(),this.IL(),b.vk=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=t),n}static vL(){Y.Zm=null,Y.bb=""}static AE(){return null}reset(){this.clear(),this.Ht=!0,this.DL(),this.themeManager=new Li,this.Ql(),this.Lo=!0,this.FL(),this.layout=new ne,this.Lo=!1,this.model=It.LM(),this.model.undoManager=new Ri,this.Uu=!1,this.Ht=!1,this.S()}lR(){this.Ur=new bt,this.gM=new st().add(new Kt({stroke:"black",font:"10pt sans-serif"}).bind("text","",b.toString).theme("stroke","text").theme("font","normal")),this.Ur.set("",this.gM),this.Ur.set("Comment",new st().add(new Kt({stroke:"brown",font:"10pt sans-serif"}).bind("text","",b.toString).theme("stroke","comment").theme("font","normal"))),this.Ur.set("LinkLabel",new st({selectable:!1,avoidable:!1}).add(new dt("Ellipse",{fill:"black",stroke:null,desiredSize:new ot(3,3).$()}).theme("fill","link"))),this.Qh=new bt,this.yM=new ut(rt.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new Kt({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",b.toString).theme("stroke","text").theme("font","bold"),new rt(rt.Auto,{name:"GROUPPPANEL"}).add(new dt({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new ve({padding:5}).theme("padding","group"))),this.Qh.set("",this.yM),this.ql=new bt,this.mM=new at().add(new dt({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new dt({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.ql.set("",this.mM),this.ql.set("Comment",new at().add(new dt({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.Xm=new yt(rt.Auto).add(new dt({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new ve({margin:1.5}).theme("margin","selection","numbers",null,e=>e?new Ot(e/2):1.5)),this.rb=this.Xm,this.lb=new yt(rt.Link).add(new dt({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(e){let t=e===void 0?this.div:e;t===null&&(t=_.document.body);const i=b.hs("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",t.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),t.removeChild(i),this.Sx=s}setScrollWidth(e){let t=e===void 0?this.div:e;t===null&&(t=_.document.body);let i=0;if(Y.isUsingDOM()){let s=Y.PM,n=Y.kM;s===null&&(Y.PM=b.hs("p"),s=Y.PM,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",Y.kM=b.hs("div"),n=Y.kM,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",t.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),t.removeChild(n),i=o-r,i===0&&!b.tr&&(i=11)}this.Wt=i,this.$S=!0}oi(e){e in ts?this.autoScale=e:b.er(this,e)}toString(e){e===void 0&&(e=0);let t="";this.div&&this.div.id&&(t=this.div.id);let i='Diagram "'+t+'"';if(e<=0)return i;const s=this.Xt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(e-1)}return i}static TL(e){Y.db=e}static um(){return Y.db}static fromDiv(e){let t=e;if(typeof e=="string"&&(t=_.document.getElementById(e)),t instanceof HTMLDivElement){const i=Y.Qe.get(t);if(i)return i}return null}get div(){return this.Mt}set div(e){if(this.Mt!==e){const t=this.Mt;if(t!==null){if(Y.Qe.delete(t),t.goDiagram=void 0,t.go=void 0,t.innerHTML="",this.ft!==null){const s=this.ft.Tt;this.Pi(s,"pointermove",this.na,!1),this.Pi(s,"pointerdown",this.Zl,!1),this.Pi(s,"pointerup",this.oa,!1),this.Pi(s,"pointerout",this.ra,!1),this.Pi(s,"pointercancel",this.la,!1),this.ft.dispose()}this.Ec&&(this.Ec.disconnect(),this.Ec=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.ft=null,this.Pi(_,"resize",this.ub,!1),this.Pi(_,"wheel",this.sa,!0),Y.um()===this&&Y.TL(null)}else this.Zl===null&&(this.jn=!1);if(this.Mt=null,e!==null){const i=Y.Qe.get(e);i&&(i.div=null),this.AM(e),this.mu(),this.themeManager&&this.themeManager.hR()}else this.themeManager&&this.themeManager.aR()}}setupRouters(){this.Vc.push(new Wn)}AM(e){const t=this;if(!Y.isUsingDOM())return;e==null&&b.o("Diagram setup requires an argument DIV."),t.Mt!==null&&b.o("Diagram has already completed setup."),typeof e=="string"?t.Mt=_.document.getElementById(e):e instanceof HTMLDivElement?t.Mt=e:b.o("No DIV or DIV id supplied: "+e),t.Mt===null&&b.o("Invalid DIV id; could not get element with id: "+e);const i=Y.Qe.get(t.Mt);if(i&&i!==this&&b.o("Invalid div id; div already has a Diagram associated with it."),!t.Ec&&_.ResizeObserver){const u=_.ResizeObserver,c=b.Rk(()=>t.requestUpdate(),250,!1);t.Ec=new u(()=>c()),t.Ec.observe(t.Mt)}_.getComputedStyle(t.Mt,null).position==="static"&&(t.Mt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,t.Mt.style["-webkit-tap-highlight-color"]=n,t.Mt.innerHTML="",Y.Qe.set(t.Mt,t),t.Mt.goDiagram=t,t.Mt.go=_.go;const o=new He(t);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",_.getComputedStyle(t.Mt,null).getPropertyValue("direction")==="rtl"&&(t.zu=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),t.ft=o,t.Qt=o.li;const r=t.Qt;t.Vi=t.computePixelRatio(),t.viewSize.isReal()||(t.xt=t.Mt.clientWidth||1,t.bt=t.Mt.clientHeight||1),t.EL(t.xt,t.bt);const h=t;t.Mt.insertBefore(o.Tt,t.Mt.firstChild);const a=new He(null);if(a.width=1,a.height=1,t.ZF=a,t.QF=a.li,Y.isUsingDOM()){const u=b.hs("div"),c=b.hs("div");u.style.position="absolute",u.style.overflow="auto",u.style.width=t.xt+"px",u.style.height=t.bt+"px",u.style.zIndex="1",c.style.position="absolute",c.style.width="1px",c.style.height="1px",t.Mt.appendChild(u),u.appendChild(c),u.onscroll=Y.cR,u.addEventListener("pointerdown",Y.fR),u.N=t,u.uR=!0,u.dR=!0,t.ab=u,t.cb=c}t.mu=b.Rk(()=>{t.Pl=null,t.S()},300,!1),t.ub=b.Rk(()=>{t.IS()},250,!1),t.jh=u=>(u.preventDefault(),!1),t.sa=u=>{if(!h.isEnabled)return;const c=h.zc(u,!0);c.bubbles=!0;let d=0,f=0;c.delta=0,u.deltaX!==void 0?(u.deltaX!==0&&(d=u.deltaX>0?1:-1),u.deltaY!==0&&(f=u.deltaY>0?1:-1),c.delta=Math.abs(u.deltaX)>Math.abs(u.deltaY)?-d:-f):u.wheelDeltaX!==void 0?(u.wheelDeltaX!==0&&(d=u.wheelDeltaX>0?-1:1),u.wheelDeltaY!==0&&(f=u.wheelDeltaY>0?-1:1),c.delta=Math.abs(u.wheelDeltaX)>Math.abs(u.wheelDeltaY)?-d:-f):u.wheelDelta!==void 0&&u.wheelDelta!==0&&(c.delta=u.wheelDelta>0?1:-1),h.doMouseWheel(),h.ha(c,u)},t.LL=u=>{if(!h.isEnabled)return;t.Uc=!1,h.zc(u,!0);const c=h.currentTool;c.cancelWaitAfter(),c.standardMouseOver()},t.Zl=u=>{if(!h.isEnabled)return;t.Uc=!0;const c=h.hb;c[u.pointerId]===void 0&&(c[u.pointerId]=u);const d=h.ea;let f=!1;if(d[0]!==null&&(d[0].pointerId===u.pointerId||d[0].pointerType!==u.pointerType))d[0]=u;else if(d[1]!==null&&d[1].pointerId===u.pointerId)d[1]=u,f=!0;else if(d[0]===null)d[0]=u;else if(d[1]===null)d[1]=u,f=!0;else{u.preventDefault();return}const m=u.pointerType==="touch"||u.pointerType==="pen";m&&(h.Bw=!1,h.Hm=!0);const p=h.gR(u,u,f),y=h.bM,x=m?25:10;if(u.timeStamp-h.xM<h.CL&&!(Math.abs(y.x-u.screenX)>x||Math.abs(y.y-u.screenY)>x)?h.jm++:h.jm=1,p.clickCount=h.jm,h.xM=u.timeStamp,h.bM.setTo(u.screenX,u.screenY),h.doMouseDown(),u.button===1){u.preventDefault();return}h.ha(p,u)},t.na=u=>{if(!h.isEnabled)return;t.Uc=!0;const c=h.ea;if(c[0]!==null&&(c[0].pointerId===u.pointerId||c[0].pointerType!==u.pointerType))c[0]=u;else if(c[1]!==null&&c[1].pointerId===u.pointerId){c[1]=u;return}else if(c[0]===null)c[0]=u;else return;if(c[0].pointerId!==u.pointerId)return;const d=h.mR(u,u,c[1]!==null);h.doMouseMove(),h.ha(d,u)},t.oa=u=>{if(!h.isEnabled)return;t.Uc=!0;const c=u.pointerType==="touch"||u.pointerType==="pen",d=h.hb;if(c&&h.Bw){delete d[u.pointerId],u.preventDefault();return}const f=h.ea;if(f[0]!==null&&(f[0].pointerId===u.pointerId||f[0].pointerType!==u.pointerType))f[0]=null;else if(f[1]!==null&&f[1].pointerId===u.pointerId){f[1]=null;return}else return;const m=h.TM(u,!1,!0,!1,!0,!1);let p=_.document.elementFromPoint(u.clientX,u.clientY)||null;p!==null&&p.shadowRoot!==void 0&&p.shadowRoot!==null&&(p=p.shadowRoot.elementFromPoint(u.clientX,u.clientY)),p!==null&&p.N instanceof Y&&p.N!==h&&p.N.Qm(u,m),p===null&&(p=u.target),h.Qm(u,m),m.clickCount=h.jm,m.targetDiagram=h.kb(u,p),m.targetObject=null,h.doMouseUp(),h.ha(m,u),c&&(h.Hm=!1)},t.ra=u=>{if(!h.isEnabled)return;t.Uc=!1;const c=h.hb;c[u.pointerId]&&delete c[u.pointerId];const d=h.ea;if(d[0]!==null&&d[0].pointerId===u.pointerId&&(d[0]=null),d[1]!==null&&d[1].pointerId===u.pointerId&&(d[1]=null),u.pointerType==="touch"||u.pointerType==="pen")return;const f=h.currentTool;f.cancelWaitAfter(),f.standardMouseOver()},t.la=u=>{const c=h.ea;c[0]!==null&&c[0].pointerId===u.pointerId?(c[0]=null,h.Hm=!1):c[1]!==null&&c[1].pointerId===u.pointerId&&(c[1]=null)};const l=r;if(t.fb=l.E[b.Ts("7eba17a4ca3b1a8346")][b.Ts("78a118b7")](l.E,Y.Xu,s,s),r.clearContextCache(!0),t.pR(),this.Oc==="svg"){const u=this.Wl.get("svg");this.Mt&&this.Mt.appendChild(u.Tt),this.Qt=u.li}}addEventListener(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}Ut(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}removeEventListener(e,t,i,s){e.removeEventListener(t,i,{capture:s})}Pi(e,t,i,s){e.removeEventListener(t,i,{capture:s})}pR(){const e=this;let t=this.ft.Tt;t instanceof HTMLCanvasElement||(t=e.div),this.Ut(t,"pointerdown",e.Zl,!1),this.Ut(t,"pointermove",e.na,!1),this.Ut(t,"pointerup",e.oa,!1),this.Ut(t,"pointerout",e.ra,!1),this.Ut(t,"pointercancel",e.la,!1),this.Ut(t,"pointerenter",e.yR,!1),this.Ut(t,"pointerleave",e.wR,!1),this.Ut(t,"wheel",e.sa,!1),this.Ut(t,"keydown",e.xR,!1),this.Ut(t,"keyup",e.bR,!1),this.Ut(t,"blur",e.kR,!1),this.Ut(t,"focus",e.PR,!1),this.Ut(t,"selectstart",i=>(i.preventDefault(),!1),!1),this.Ut(t,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Ut(_,"resize",e.ub,!1)}Vw(){this.qm>30&&(this.Pl=1)}CP(e){this.Pl!==null&&(this.Pl=null,e&&this.mu(),this.qm=0,this.SM=[0,0,0,0,0],this.Wm=0)}computePixelRatio(){return this.Pl!==null?this.Pl:_.devicePixelRatio||1}get avgSpf(){return this.qm}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.ft)if(this.scrollsPageOnFocus)this.ft.focus();else{const e=_.scrollX,t=_.scrollY;this.ft.focus(),_.scrollTo(e,t)}}PR(e){const t=Y.Qe.get(this);t&&t.D("GainedFocus")}kR(e){const t=Y.Qe.get(this);t&&t.D("LostFocus")}IS(){if(this.ft===null)return;const e=this.Mt;if(e===null||e.clientWidth===0||e.clientHeight===0)return;this.$S||this.setScrollWidth();const t=this.Kn?this.Wt:0,i=this.ln?this.Wt:0,s=this.Vi;if(this.Vi=this.computePixelRatio(),this.Vi!==s&&(this.Du=!0,this.requestUpdate()),e.clientWidth!==this.xt+t||e.clientHeight!==this.bt+i){this.aa(),this.Ue=!0;const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(this.vc=!0,n.invalidateLayout()),this.ys||this.requestUpdate()}}FL(){let e=0,t=new de;t.name="Grid",t.allowSelect=!1,t.pickable=!1,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new de,t.name="ViewportBackground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new de,t.name="Background",this.Xr(t,e++),t=new de,t.name="",this.Xr(t,e++),t=new de,t.name="Foreground",this.Xr(t,e++),t=new de,t.name="ViewportForeground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new de,t.name="Adornment",t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new de,t.name="Tool",t.isTemporary=!0,t.isInDocumentBounds=!0,this.Xr(t,e++)}UL(){const e=new rt(rt.Grid,{name:"GRID"}).add(new dt("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new dt("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new dt("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new dt("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new dt("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new dt("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),t=new Lt({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(e);return this.add(t),this.partManager.parts.delete(t),e.visible=!1,e}static cR(){const e=Y.Qe.get(this.parentElement||this);if(e){if(e.tb){e.tb=!1;return}if(!e.isEnabled){e.BL();return}e.diagramScroll(this)}}static fR(e){if(!this.N.isEnabled){this.N.updateScroll();return}this.N.ib=e.target.scrollTop,this.N.eb=e.target.scrollLeft}diagramScroll(e){if(this.ft===null)return;const t=this.ab,i=this.cb;this.Bm=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.$h;let r=s.x-o.left,h=s.y-o.top;const a=s.width+o.left+o.right,l=s.height+o.top+o.bottom;let u=s.right+o.right,c=s.bottom+o.bottom,d=n.x,f=n.y;const m=n.width,p=n.height;let y=n.right,x=n.bottom;const P=this.scale;let k,v=e.scrollLeft;if(this.zu)switch(this.Sx){case"negative":v=v+e.scrollWidth-e.clientWidth;break;case"reverse":v=e.scrollWidth-v-e.clientWidth;break}const N=v;if(m<a||p<l){k=S.V(this.position.x,this.position.y),this.allowHorizontalScroll&&this.eb!==N&&(k.x=N/P+r,this.eb=N),this.allowVerticalScroll&&this.ib!==e.scrollTop&&(k.y=e.scrollTop/P+h,this.ib=e.scrollTop),this.position=k,S.e(k),this.Bm=!1,this.Ou=!1;return}if(k=S.l(),e.uR&&this.allowHorizontalScroll&&(r<d&&(this.position=k.i(N+r,this.position.y)),u>y)){const M=t.scrollWidth-this.xt;this.position=k.i(-M+N-this.xt/P+u,this.position.y)}if(e.dR&&this.allowVerticalScroll&&(h<f&&(this.position=k.i(this.position.x,e.scrollTop+h)),c>x)){const M=t.scrollHeight-this.bt;this.position=k.i(this.position.x,-M+e.scrollTop-this.bt/P+c)}S.e(k),this._l(),this.Bm=!1,this.Ou=!1,s=this.documentBounds,n=this.viewportBounds,u=s.right,y=n.right,c=s.bottom,x=n.bottom,r=s.x,d=n.x,h=s.y,f=n.y,m>=a&&r>=d&&u<=y&&(i.style.width="1px"),p>=l&&h>=f&&c<=x&&(i.style.height="1px")}computeBounds(e){return e===void 0&&(e=new z),this.Mi(),this.VL(e)}VL(e){if(this.fixedBounds.isReal())return e.a(this.fixedBounds),e.addMargin(this.Zt),e;let t=!0;const i=this.Xt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.Ct.r,h=r.length;for(let a=0;a<h;a++){const l=r[a];if(!l.isInDocumentBounds||!l.isVisible())continue;const u=l.actualBounds;u.isReal()&&(t?(t=!1,e.a(u)):e.unionRect(u))}}return t&&e.i(0,0,0,0),e.addMargin(this.Zt),e}computePartsBounds(e,t){t===void 0&&(t=!1);let i=null;if(Array.isArray(e))for(let s=0;s<e.length;s++){const n=e[s];!t&&n instanceof at||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=e.iterator;for(;s.next();){const n=s.value;!t&&n instanceof at||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===null?new z(NaN,NaN,0,0):i}Bs(e){if(!e&&!this.jn||this.Ht||this.ft===null||!this.documentBounds.isReal())return;if(this.Ht=!0,e){const c=this.initialPosition;if(c.isReal()){this.Ht=!1,this.position=c;return}let d=this.initialDocumentSpot,f=this.initialViewportSpot;d.isNoSpot()&&(d=B.TopLeft),f.isNoSpot()&&(f=B.TopLeft);const m=S.l();m.setRectSpot(this.documentBounds,d);const p=this.viewportBounds,y=z.V(0,0,p.width,p.height),x=S.l();x.setRectSpot(y,f),x.i(m.x-x.x,m.y-x.y),this.Ht=!1,this.position=x,z.e(y),S.e(x)}let t=this.jl;e&&this.Sr!==1&&(t=this.Sr);const i=t!==1?this.Yu(t):this.scale,s=this.at.x,n=this.at.y,o=this.xt/i,r=this.bt/i;let h=this.Fc;const a=this.Om;if(e&&!h.isSpot()&&(a.isSpot()||a.isDefault())){const c=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();h=a.isDefault()&&!c?B.Center:a}this.DM(this.documentBounds,o,r,h,e);const l=this.scale;this.scale=i,this.Ht=!1;const u=this.viewportBounds;u.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new z(s,n,o,r),u,l,!1)}Yu(e){const t=this.Km;if(this.ft===null)return t;if(e===1)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return t;const s=i.width,n=i.height,o=this.xt+(this.Kn?this.Wt:0),r=this.bt+(this.ln?this.Wt:0);let h=o/s,a=r/n;const l=this.$h,u=l.left+l.right!==0,c=l.top+l.bottom!==0;(u||c)&&(a===h?(a=(r-this.Wt)/n,h=(o-this.Wt)/s):a>h?a=(r-this.Wt)/n:h=(o-this.Wt)/s);let d=0;return e===2?d=Math.min(a,h):e===3&&(a>h?d=(r-this.Wt)/n:d=(o-this.Wt)/s),d>t&&(d=t),d<this.minScale&&(d=this.minScale),d>this.maxScale&&(d=this.maxScale),d}zoomToFit(){const e=this.qh;this.qh=1,this.scale=this.Yu(2),this.alignDocument(B.Center,B.Center),e!==1&&(this.Bs(!1),this.DM(this.documentBounds,this.xt/this.tt,this.bt/this.tt,this.Fc,!1)),this.qh=e}zoomToRect(e,t){t===void 0&&(t=2);const i=e.width,s=e.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(t===2||t===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.xt,r=this.bt;t===3?r/s>o/i?n=(r-(this.ln?this.Wt:0))/s:n=(o-(this.Kn?this.Wt:0))/i:n=Math.min(r/s,o/i)}this.scale=n,this.position=new S(e.x,e.y)}get SR(){return this.Ht}set SR(e){this.Ht=e}alignDocument(e,t){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new S(i.x+(e.x*i.width+e.offsetX)-(t.x*s.width-t.offsetX),i.y+(e.y*i.height+e.offsetY)-(t.y*s.height-t.offsetY))}focusObject(e){if(e instanceof Ct){this.Jm=e;const t=S.l();this.$m=this.transformDocToView(e.getDocumentPoint(B.TopLeft,t)),S.e(t)}else this.Jm=null,this.$m=S.Ik}DM(e,t,i,s,n){const o=S.V(this.at.x,this.at.y);let r=o.x,h=o.y;if(this.Jm!==null){let a=S.l();a=this.Jm.getDocumentPoint(B.TopLeft,a),r=a.x-this.$m.x/this.scale,h=a.y-this.$m.y/this.scale,s=B.None,S.e(a)}if(n||this.scrollMode===1){s.isSpot()&&(t>e.width&&(r=e.x+(s.x*e.width+s.offsetX)-(s.x*t-s.offsetX)),i>e.height&&(h=e.y+(s.y*e.height+s.offsetY)-(s.y*i-s.offsetY)));const a=this.$h,l=t-e.width;if(t<e.width+a.left+a.right){let c=r+t/2;c=Math.min(c,e.right+Math.max(l,a.right)-t/2),c=Math.max(c,e.left-Math.max(l,a.left)+t/2),r=c-t/2}else r>e.left?r=e.left:r<e.right-t&&(r=e.right-t);const u=i-e.height;if(i<e.height+a.top+a.bottom){let c=h+i/2;c=Math.min(c,e.bottom+Math.max(u,a.bottom)-i/2),c=Math.max(c,e.top-Math.max(u,a.top)+i/2),h=c-i/2}else h>e.top?h=e.top:h<e.bottom-i&&(h=e.bottom-i)}if(o.x=isFinite(r)?r:-this.Zt.left,o.y=isFinite(h)?h:-this.Zt.top,this.positionComputation!==null){const a=this.positionComputation(this,o);o.x=a.x,o.y=a.y}this.ds.pL(this.at,o),this.at.i(o.x,o.y),this._m(),this.Ql(),this.MR(),S.e(o)}findPartAt(e,t){if(t===void 0&&(t=!0),t){const i=this.FP(e,s=>s.part,s=>s.canSelect());if(i instanceof Lt)return i}else{const i=this.FP(e,s=>s.part);if(i instanceof Lt)return i}return null}findObjectAt(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Mi();const s=this.Xt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}FP(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Mi();const s=this.Xt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}findPartsAt(e,t,i){return t===void 0&&(t=!0),this.NR(e,s=>s.part,t?s=>s instanceof Lt&&s.canSelect():null,i)}NR(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Mi();const n=this.Xt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(e,t,i,s)}return s}findObjectsAt(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof J)&&!(s instanceof K)&&(s=new K),this.Mi();const n=this.Xt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(e,t,i,s)}return s}findPartsIn(e,t,i,s){return t===void 0&&(t=!1),i===void 0&&(i=!0),this.CR(e,null,n=>n instanceof Lt&&(!i||n.canSelect()),t,s)}findObjectsIn(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Mi();const o=this.Xt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(e,t,i,s,n)}return n}OP(e,t,i,s,n,o){const r=new K;this.Mi();const h=this.Xt.iteratorBackwards;for(;h.next();){const a=h.value;a.visible&&a.OP(e,t,i,s,r,n,o)}return r}CR(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof J)&&!(n instanceof K)&&(n=new K),this.Mi();const o=this.Xt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(e,t,i,s,n)}return n}findPartsNear(e,t,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.LR(e,t,null,o=>o instanceof Lt&&(!s||o.canSelect()),i,n)}findObjectsNear(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Mi();const r=this.Xt.iteratorBackwards;for(;r.next();){const h=r.value;h.visible&&h.findObjectsNear(e,t,i,s,n,o)}return o}LR(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof J||n instanceof K)&&(o=n),n=!0),!(o instanceof J)&&!(o instanceof K)&&(o=new K),this.Mi();const r=this.Xt.iteratorBackwards;for(;r.next();){const h=r.value;!h.visible||h.isTemporary||h.findObjectsNear(e,t,i,s,n,o)}return o}acceptEvent(e){return this.zc(e,e instanceof MouseEvent)}zc(e,t){const i=this.Br;this.Br=this._h,this._h=i,i.diagram=this,i.event=e,t?this.Qm(e,i):(i.viewPoint=this.Br.viewPoint,i.documentPoint=this.Br.documentPoint);let s=0;const n=e;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),b.tr&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=e.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.kb(e,e.target),i.targetObject=null,i}kb(e,t){if(t===null)return null;const i=Y.Qe.get(t);if(i)return i;let s=e.path;if(!s&&b.it(e.composedPath)&&(s=e.composedPath()),s&&s[0]){const n=Y.Qe.get(s[0]);if(n)return n}return null}gR(e,t,i){const s=this.TM(e,!0,!1,!1,!0,i);return this.Qm(t,s),s.targetDiagram=this.kb(e,e.target),s.targetObject=null,i||s.clone(this.Gm),s}mR(e,t,i){const s=this.TM(e,!1,!1,!1,!1,i);let n=_.document.elementFromPoint(t.clientX,t.clientY)||null;n!==null&&n.shadowRoot!==void 0&&n.shadowRoot!==null&&(n=n.shadowRoot.elementFromPoint(t.clientX,t.clientY));let o=this,r=e;if(n){const h=this.kb(e,n);h&&(r=t,o=h)}return s.targetDiagram=o,this.Qm(r,s),s.targetObject=null,s}TM(e,t,i,s,n,o){const r=this.Br;this.Br=this._h,this._h=r,r.diagram=this,r.clickCount=1,r.delta=0;let h=0;return e.ctrlKey&&(h+=1),e.altKey&&(h+=2),e.shiftKey&&(h+=4),e.metaKey&&(h+=8),r.modifiers=h,r.event=e,r.timestamp=e.timeStamp,r.button=i?this.firstInput.button:e.button,r.buttons=e.buttons,b.tr&&e.button===0&&e.ctrlKey&&(r.button=2),r.down=t,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}ha(e,t){return e.bubbles?!0:(t.stopPropagation!==void 0&&t.stopPropagation(),t.cancelable!==!1&&t.preventDefault(),t.cancelBubble=!0,!1)}xR(e){const t=Y.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!1);return i.key=e.key,i.code=e.code,i.down=!0,t.doKeyDown(),t.ha(i,e)}bR(e){const t=Y.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!1);return i.key=e.key,i.code=e.code,i.up=!0,t.doKeyUp(),t.ha(i,e)}yR(e){const t=Y.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!0);return t.mouseEnter!==null&&t.mouseEnter(i),t.currentTool.standardMouseOver(),t.ha(i,e)}wR(e){const t=Y.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!0);return t.mouseLeave!==null&&t.mouseLeave(i),t.ha(i,e)}getMouse(e){const t=this.ft;if(t===null)return new S(0,0);const i=t.getBoundingClientRect(),s=(e.clientX-i.left)*(this.xt/i.width),n=(e.clientY-i.top)*(this.bt/i.height);return new S(s,n).Oe(this.T)}Qm(e,t){const i=this.ft;let s=0,n=0;if(i!==null){const r=i.getBoundingClientRect();s=(e.clientX-r.left)*(this.xt/r.width),n=(e.clientY-r.top)*(this.bt/r.height)}t.viewPoint.i(s,n);const o=S.V(s,n);this.T.$e(o),t.documentPoint.a(o),S.e(o)}BC(e,t,i){let s;if(this.ea[0]!==null)s=this.ea[t];else return;const n=this.ft;if(n!==null){const o=n.getBoundingClientRect();i.i((s.clientX-o.left)*(this.xt/o.width),(s.clientY-o.top)*(this.bt/o.height))}}invalidateDocumentBounds(){this.ta||(this.ta=!0,this.requestUpdate(!1))}AR(){this.ys||this.Mi(),this.ensureBounds()}redraw(){this.Ht||this.ys||(this.S(),this.maybeUpdate())}isUpdateRequested(){return this.xr}delayInitialization(e){e===void 0&&(e=null);const t=this.animationManager,i=t.isEnabled;t.stopAnimation(),t.isEnabled=!1,this.ur(),this.jn=!1,this.nx=new S(NaN,NaN),t.isEnabled=i,this.ys=!0;const s=this;e!==null&&b.ir(()=>{s.ys=!1,t.Fl("Model"),e(s)},1)}requestUpdate(e){if(e===void 0&&(e=!1),this.xr===!0||this.Ht||e===!1&&this.ys)return;this.xr=!0;const t=this;_.requestAnimationFrame(()=>{t.xr&&t.maybeUpdate()})}maybeUpdate(){this.Fu&&!this.xr||(this.Fu&&(this.Fu=!1),this.ur())}FM(e,t){!this.Ou||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.BL()||(e&&this.Mi(),t&&this.Bs(!1))}ur(e){if(this.ys||(this.xr=!1,this.Mt===null&&!this.Iu.isReal()))return;this.ys=!0;const t=this.animationManager,i=this.Vu;if(!t.isAnimating&&i.length!==0){const u=i.r,c=u.length;for(let d=0;d<c;d++){const f=u[d];f.ue(!1),f.c()}i.clear()}const s=this.wM;s.count>0&&(s.each(u=>u.RM()),s.clear());let n=!1,o=!1;t.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),t.pi||this.IS(),e||this.FM(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.bl||this.Vc.count!==0&&this.Mr.size!==0),h=!this.jn||this.Vr;this.Mi(!0);let a=!1;(h||r)&&(this.jn?this.vM(!this.vc,r):(this.startTransaction("Initial Layout"),t.isEnabled===!1&&t.stopAnimation(),this.vM(!1,r)),a=h),this.vc=!1,this.bl=!1,this.Mi(),this.Ze!==null&&(this.Ze.visible&&!this.Eu&&(this.th(),this.Eu=!0),!this.Ze.visible&&this.Eu&&(this.Eu=!1)),this.Yx||this.AR(),e||this.FM(!0,!1);let l=!1;if(a){const u=z.l();u.a(this.viewportBounds),this.jn||(this.jn=!0,l=!0,this.skipsUndoManager||(this.undoManager.Ew=!0),this.undoManager.Uw=!0,this.TR()),this.DR(),this.Mi(!1),e||this.FM(!0,!0),z.e(u)}else if(t.Sc&&t.ex){if(this.Sr!==1)this.scale=this.Yu(this.Sr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const u=this.initialScale;isFinite(u)&&u>0&&(this.scale=u)}this.Bs(!0)}a&&l&&this.commitTransaction("Initial Layout"),e||this.Ui(this.Qt),o&&(this.skipsUndoManager=n),this.ys=!1}get Vh(){return this.jn}TR(){if(this.Sr!==1)this.scale=this.Yu(this.Sr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Bs(!0);const e=this.Xt.r;this.ps(e,e.length,this,this.viewportBounds),this.D("InitialLayoutCompleted"),this.nx.a(this.at),this.th()}DR(){this.D("LayoutCompleted")}t0(e){this.Yn.add(e)}addInvalidRoute(e){this.Co?this.Zh.add(e):this.Mr.add(e)}Mi(e){if(this.Yn.size!==0&&!(!this.ys&&this.animationManager.isTicking)){if(this.ys||(this.bl=!0),e){this.zL(this.Yn);return}for(let t=0;t<23&&this.Yn.size!==0;t++){const i=new Set(this.Yn);this.Yn.clear(),this.RM(i,this.Yn)}this.nodes.each(t=>{t instanceof ut&&t.XL(!1)})}}zL(e,t){for(const i of e)!i.ke()||i instanceof ut||(i.Yr()?(i.ht(1/0,1/0),i.Bt()):t&&t.add(i));for(const i of e)if(i instanceof ut){if(!i.isVisible())continue;this.Pb(i)}}RM(e,t){this.zL(e,t);for(const i of e){if(!(i instanceof at))continue;const s=i;s.isVisible()&&(s.Yr()?(s.ht(1/0,1/0),s.Bt()):t.add(s))}for(const i of e)i instanceof yt&&i.isVisible()&&(i.Yr()?(i.ht(1/0,1/0),i.Bt()):t.add(i))}i0(e){const t=e instanceof Y,i=t?e.links:e.memberParts,s=this.Yn;if(t)this.Mi(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.ke()||n instanceof ut||n.Yr()&&(n.ht(1/0,1/0),n.Bt()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof ut){if(!n.isVisible())continue;this.Pb(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof at&&s.has(n)&&n.isVisible()&&n.Yr()&&(n.ht(1/0,1/0),n.Bt())}}Pb(e){const t=b.et(),i=b.et(),s=e.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof ut?(o.To()||o._e()||o.ih())&&this.Pb(o):o instanceof at?o.fromNode===e||o.toNode===e?i.push(o):t.push(o):(o.ht(1/0,1/0),o.Bt()))}let n=t.length;for(let o=0;o<n;o++){const r=t[o];r.ht(1/0,1/0),r.Bt()}b.J(t),e.ht(1/0,1/0),e.Bt(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ht(1/0,1/0),r.Bt()}b.J(i)}ps(e,t,i,s){if(!(!this.Ic&&!this.animationManager.isAnimating)){for(let n=0;n<t;n++)e[n].ps(i,s);this.Mi()}}Ui(e){this.Mt!==null&&(this.ft===null&&b.o("No canvas specified"),this.Oc==="svg"?this.FR(e):this.RR(e))}RR(e){const t=this.animationManager;if(t.pi||t.isAnimating&&!t.isTicking)return;const i=new Date;if(this.e0(),this.Mt&&this.Mt.style.opacity==="0")return;const s=e!==this.Qt,n=this.Xt.r,o=n.length,r=this;if(this.ps(n,o,r,r.viewportBounds),s)e.clearContextCache(!0),this._l();else if(!this.Ue&&!t.isAnimating)return;const h=this.T,a=this.Vi;e.setTransform(a,0,0,a,0,0),e.clearRect(0,0,this.xt,this.bt),this.$t!==1&&(e.globalAlpha=this.$t),this.OM(e);for(let f=0;f<o;f++)e.setTransform(a,0,0,a,0,0),e.transform(h.m11,h.m12,h.m21,h.m22,h.dx,h.dy),e.commitTransform(),n[f].Ui(e,r);let l=!1;this.Bc?this.Bc.Xu(this)&&(l=this.fb()):l=!0,l&&(Tt.prototype.$e=Tt.prototype.kw),s?(this.Qt.clearContextCache(!0),this._l()):(this.Ic=!1,this.Ue=!1);const u=+new Date-+i,c=!1,d=this.SM;if(this.Pl===null){d[this.Wm]=u,this.Wm=(this.Wm+1)%d.length;let f=0;for(let m=0;m<d.length;m++)f+=d[m];this.qm=f/d.length}this.$t!==1&&(e.globalAlpha=1)}FR(e){if(this.Mt===null)return;const t=this.animationManager;if(t.pi||t.isAnimating&&!t.isTicking)return;this.e0();const i=this.xt,s=this.bt;e.surface.resize(i,s,i,s);const n=this.Xt.r,o=n.length,r=this;if(this.ps(n,o,r,r.viewportBounds),!this.Ue&&!t.isAnimating)return;const h=this.T;e.lastDrawnPart=null,e.setDiagramPosScale(h.m11,h.m12,h.m21,h.m22,h.dx,h.dy),this.$t!==1&&(e.globalAlpha=this.$t),this.OM(e);const a=this.Vi;this.ft.li.setTransform(a,0,0,a,0,0),this.ft.li.clearRect(0,0,this.xt,this.bt);for(let u=0;u<o;u++)n[u].Ui(e,r);let l=!1;this.Bc?this.Bc.Xu(this)&&(l=this.fb()):l=!0,l&&(Tt.prototype.$e=Tt.prototype.kw),this.Ic=!1,this.Ue=!1}Sb(e,t,i,s,n,o,r,h,a){if(this.Mt===null)return;this.ft===null&&b.o("No canvas specified"),o===void 0&&(o=null),r===void 0&&(r=null),h===void 0&&(h=!1),a===void 0&&(a=!1),this.e0(),this.Qt.clearContextCache(!0),this._l(),this.ia=!0;const l=this.tt;this.tt=s;const u=this,c=this.Xt.r,d=c.length;try{const f=new z(n.x,n.y,i.width/s,i.height/s),m=f.copy();m.addMargin(t),this.th(m),this.Mi(),this.ps(c,d,u,f),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),r!==null&&r!==""&&(e.fillStyle=r,e.fillBackground(0,0,i.width,i.height));const p=this.Vi;e.scale(p,p);const y=Tt.l();y.Ri(),y.Fs(t.left,t.top),y.tt(s),(n.x!==0||n.y!==0)&&y.Fs(-n.x,-n.y),e.setTransform(y.m11,y.m12,y.m21,y.m22,y.dx,y.dy),e.commitTransform(),e instanceof ge&&e.setDiagramPosScale(y.m11,y.m12,y.m21,y.m22,y.dx,y.dy),Tt.e(y),this.OM(e),e.globalAlpha=this.$t;const x=this.findLayer("Grid");if(o){const P=new K,k=o.iterator;for(k.reset();k.next();){const v=k.value;v instanceof Lt&&(!a&&v.layer===x||(v.Au(),P.add(v)))}for(let v=0;v<d;v++)c[v].GF(e,u,P,h);P.each(v=>v.Au())}else for(let P=0;P<d;P++){const k=c[P];k===x?a&&k.Ui(e,u,!0):k.Ui(e,u,h)}this.ia=!1,this.Bc&&this.Bc.Xu(this)&&this.fb()}finally{this.tt=l,this.Qt.clearContextCache(!0),this._l(),this.ps(c,d,u,u.viewportBounds),this.th(),this.Qt instanceof ge&&(this.Qt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(e){return this.Pr[e]}setRenderingHint(e,t){e==="minDrawingLength"&&(this.Fm=t),this.Pr[e]=t,this.redraw()}resetRenderingHints(){this.Pr=new fe,this.Pr.drawShadows=!0,this.Pr.textGreeking=!0,this.Pr.viewportOptimizations=!b.tr,this.Pr.temporaryPixelRatio=!0,this.Pr.pictureRatioOptimization=!0,this.Pr.minDrawingLength=1,this.Fm=1}OM(e){const t=this.Pr;if(t===null)return;if(t.imageSmoothingEnabled!==void 0){const s=!!t.imageSmoothingEnabled;e.setImageSmoothingEnabled(s)}const i=t.defaultFont;i!=null&&(e.font=i)}getInputOption(e){return this.Tu[e]}setInputOption(e,t){this.Tu[e]=t}oR(){this.Tu=new fe,this.Tu.extraTouchArea=10,this.Tu.extraTouchThreshold=10,this.Tu.hasGestureZoom=!0}set(e){return Object.assign(this,e),this}attach(e){return this.setProperties(e)}setProperties(e){return Y.s0(this,e),this}static s0(e,t){const i=e instanceof rt,s=e instanceof Y;for(const n in t){n===""&&b.o("Setting properties requires non-empty property names");let o=e,r=n;if(i||s){const a=n.indexOf(".");if(a>0){const l=n.substring(0,a);i?o=e.findObject(l):(o=e[l],o==null&&(o=e.toolManager[l])),b.G(o)?r=n.substring(a+1):b.o("Unable to find object named: "+l+" in "+e.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!b.gw(o,r))if(s&&r==="ModelChanged"){e.addModelChangedListener(t[r]);continue}else if(s&&r==="Changed"){e.addChangedListener(t[r]);continue}else if(s&&b.gw(e.toolManager,r))o=e.toolManager;else if(s&&e.YL(r)){e.addDiagramListener(r,t[r]);continue}else if(e instanceof It&&r==="Changed"){e.addChangedListener(t[r]);continue}else b.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const h=t[n];o[r]=h,r[0]==="_"&&o instanceof Ct&&o.addCopyProperty(r)}}xL(){if(this.$l.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.$l.count>0;){const e=this.$l;this.$l=new bt;const t=e.iterator;for(;t.next();){const i=t.key;i.invalidateOtherJumpOvers(t.value),i.ee()}}this.S()}}S(e){if(e===void 0)this.Ue=!0,this.requestUpdate();else{const t=this.viewportBounds;e.isReal()&&t.intersectsRect(e)&&(this.Ue=!0,this.requestUpdate())}this.D("InvalidateDraw")}invalidateViewport(e,t){if(this.Ue!==!0){if(this.Ue=!0,this.Oc==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Vw(),this.maybeUpdate(),this.CP(!0)):this.maybeUpdate()}}aa(){this.Ou=!0}_l(){this.Ic=!0}e0(){this.Du!==!1&&(this.Du=!1,this.EL(this.xt,this.bt))}EL(e,t){this.Ql();const i=this.Vi,s=e*i,n=t*i;this.ft.resize(s,n,e,t)&&(this.Ue=!0,this.Qt.clearContextCache(!0))}BL(){const e=this.ft;if(e===null||this.Iu.isReal())return!0;const t=this.xt,i=this.bt,s=this.Mt;let n=!1,o=this.Kn?this.Wt:0,r=this.ln?this.Wt:0,h=s.clientWidth||t+o,a=s.clientHeight||i+r;const l=this.viewportBounds,u=l.x,c=l.y,d=l.width,f=l.height;if((h!==t+o||a!==i+r)&&(this.Kn=!1,this.ln=!1,o=0,r=0,this.xt=h,this.bt=a,this.Du=!0,n=!0,this.Ql()),!this.jn||!this.viewportBounds.isReal())return!0;const m=this.ab,p=this.cb;if(this.Ou=!1,!n&&!this.Kn&&!this.ln&&!this.Ru&&!this.vu)return!0;const y=this.documentBounds;let x=0,P=0,k=0,v=0;const N=l.width,M=l.height,C=this.$h;this.contentAlignment.isSpot()?(y.width>N&&(x=C.left,P=C.right),y.height>M&&(k=C.top,v=C.bottom)):(x=C.left,P=C.right,k=C.top,v=C.bottom);const F=y.width+x+P,T=y.height+k+v,L=this.scale,D=L;let O=F>h/L,R=T>a/L;if(!n&&!this.Kn&&!this.ln&&!O&&!R)return!0;const I=y.x-x,X=l.x,j=y.right+P;let V=l.right+o;const U=y.y-k,W=l.y,ct=y.bottom+v;let $=l.bottom+r,et="1px",tt="1px";if(this.scrollMode===1&&(O||R)){if(O&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let Z=1;I+1<X&&(Z=Math.max((X-I)*L+this.xt,Z)),j>V+1&&(Z=Math.max((j-V)*L+this.xt,Z)),N+o+1<F&&(Z=Math.max((F-N)*L+this.xt,Z)),et=Z.toString()+"px"}if(R&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let Z=1;U+1<W&&(Z=Math.max((W-U)*L+this.bt,Z)),ct>$+1&&(Z=Math.max((ct-$)*L+this.bt,Z)),M+r+1<T&&(Z=Math.max((T-M)*L+this.bt,Z)),tt=Z.toString()+"px"}}let it=et!=="1px",mt=tt!=="1px";if(!(it&&mt)&&(it||mt)){if(O=!(F<N+o),R=!(T<M+r),mt&&(V-=this.Wt),it&&($-=this.Wt),O&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let ht=1;I+1<X&&(ht=Math.max((X-I)*L+this.xt,ht)),j>V+1&&(ht=Math.max((j-V)*L+this.xt,ht)),N+1<F&&(ht=Math.max((F-N)*L+this.xt,ht)),et=ht.toString()+"px"}it=et!=="1px";let Z=this.bt;if(it!==this.ln&&(Z=it?this.bt-this.Wt:this.bt+this.Wt),R&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let ht=1;U+1<W&&(ht=Math.max((W-U)*L+Z,ht)),ct>$+1&&(ht=Math.max((ct-$)*L+Z,ht)),M+1<T&&(ht=Math.max((T-M)*L+Z,ht)),tt=ht.toString()+"px"}mt=tt!=="1px"}if(this.Bm&&!(it!==this.ln||mt!==this.Kn))return(t!==this.xt||i!==this.bt)&&this.maybeUpdate(),!1;if(it!==this.ln&&(et==="1px"?this.bt=this.bt+this.Wt:this.bt=Math.max(this.bt-this.Wt,1),n=!0),this.ln=it,p.style.width=et,mt!==this.Kn&&(tt==="1px"?this.xt=this.xt+this.Wt:this.xt=Math.max(this.xt-this.Wt,1),n=!0,this.zu)){const Z=S.l();mt?(e.style.left=this.Wt+"px",this.position=Z.i(this.at.x+this.Wt/this.scale,this.at.y)):(e.style.left="0px",this.position=Z.i(this.at.x-this.Wt/this.scale,this.at.y)),S.e(Z)}n&&this.Ql(),this.Kn=mt,p.style.height=tt,this.tb=!0,n&&(this.Du=!0);let ft=m.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(N+1<F?ft=(this.position.x-I)*L:I+1<X?ft=m.scrollWidth-m.clientWidth:j>V+1&&(ft=this.position.x*L)),this.zu)switch(this.Sx){case"negative":ft=-(m.scrollWidth-ft-m.clientWidth);break;case"reverse":ft=m.scrollWidth-ft-m.clientWidth;break}if(m.scrollLeft=ft,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(M+1<T?m.scrollTop=(this.position.y-U)*L:U+1<W?m.scrollTop=m.scrollHeight-m.clientHeight:ct>$+1&&(m.scrollTop=this.position.y*L)),h=this.xt,a=this.bt,m.style.width=h+(this.Kn?this.Wt:0)+"px",m.style.height=a+(this.ln?this.Wt:0)+"px",t!==h||i!==a||this.animationManager.pi){const Z=z.V(u,c,d,f);return this.onViewportBoundsChanged(Z,this.viewportBounds,D,n),z.e(Z),!1}return!0}add(e){const t=e.diagram;if(t===this)return;t!==null&&b.o("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+t.toString());let i=this.findLayer(e.layerName);if(i===null&&(i=this.findLayer("")),i===null&&b.o('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer===i)return;const s=i.Jh(99999999,e,e.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,e,null,s),i.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1);const n=e.layerChanged;n!==null&&n(e,null,i)}Jh(e){this.partManager.Jh(e);const t=this;e.Gr(i=>t.GL(i)),e.data||e.Do(),e.hasPlaceholder()&&e.c(),e.data!==null&&e.Gr(i=>t.partManager.IM(i,null)),(e._e()===!0||e.ih()===!0)&&this.t0(e),e.KL(!0,this),e.jL()?(e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.requestUpdate()}te(e){e.clearAdornments(),this.partManager.te(e);const t=this;e.data!==null&&e.Gr(i=>t.partManager.EM(i,t)),this.Yn.delete(e),e instanceof at&&this.Mr.delete(e),e.jL()?(e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.requestUpdate()}remove(e){this.UM(e,!0)}UM(e,t){const i=e.layer;if(i===null||i.diagram!==this)return;e.isSelected=!1,e.isHighlighted=!1,e.invalidateLayout(2),t&&e.Xc();const s=i.te(-1,e,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,e,null,s,null);const n=e.layerChanged;n!==null&&n(e,i,null)}removeParts(e,t){if(t===void 0&&(t=!1),Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t&&!n.canDelete()||this.remove(n)}}else{const i=new K;i.addAll(e);const s=i.iterator;for(;s.next();){const n=s.value;t&&!n.canDelete()||this.remove(n)}}}copyParts(e,t,i){i===void 0&&(i=!1);let s=null;const n=t||this,o=n.model;let r=!1,h=!1;try{o.pm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.mm()||o.Mb())&&(h=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(e,t,i)}finally{o.pm()&&(o.copiesParentKeyOfNodeData=r),(o.mm()||o.Mb())&&(o.copiesGroupKeyOfNodeData=h)}return s}moveParts(e,t,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.o0()),this.toolManager===null)return;const n=new bt;if(e!==null)if(Array.isArray(e))for(let o=0;o<e.length;o++)this.Kr(n,e[o],i,s);else{const o=e.iterator;for(;o.next();)this.Kr(n,o.value,i,s)}else{let o=this.parts;for(;o.next();){const r=o.value;this.Kr(n,r,i,s)}for(o=this.nodes;o.next();){const r=o.value;this.Kr(n,r,i,s)}for(o=this.links;o.next();){const r=o.value;this.Kr(n,r,i,s)}}this.TP(n,t,s,i)}Kr(e,t,i,s,n){if(!e.has(t)&&(n===void 0&&(n=!1),!(i&&!n&&!t.canMove()&&!t.canCopy())))if(s===void 0&&(s=this.o0()),t instanceof st){if(e.set(t,this.Es(s,t,t.location)),t instanceof ut&&(t.hasPlaceholder()||s.dragsMembers)){const r=t.memberParts;for(;r.next();){const h=r.value;this.Kr(e,h,i,s,s.groupsAlwaysMove)}}const o=t.linksConnected;for(;o.next();){const r=o.value;if(e.has(r))continue;const h=r.fromNode,a=r.toNode;h!==null&&e.has(h)&&a!==null&&e.has(a)&&this.Kr(e,r,i,s)}if(s.dragsTree){const r=t.findTreeChildrenNodes();for(;r.next();){const h=r.value;this.Kr(e,h,i,s)}}}else if(t instanceof at){e.set(t,this.Es(s,t));const o=t.labelNodes;for(;o.next();){const r=o.value;this.Kr(e,r,i,s)}}else t instanceof yt||e.set(t,this.Es(s,t,t.location))}TP(e,t,i,s){if(e===null||e.count===0)return;const n=S.l(),o=S.l();o.a(t),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.gb;r||this.WC(e);const h=b.et(),a=b.et(),l=e.iterator;let u=S.l();for(;l.next();){const p=l.key,y=l.value;if(p.ke()){const x=this.HL(p,e);if(x!==null)h.push(new Cn(p,y,x));else if(!s||p.canMove()){const P=y.point;n.a(P),this.computeMove(p,n.add(o),i,u),p.location=u,y.shifted===void 0&&(y.shifted=new S),y.shifted.a(u.subtract(P))}}else l.key instanceof at&&a.push(new Le(l.key,l.value))}S.e(u);const c=h.length;for(let p=0;p<c;p++){const y=h[p],x=y.qL.point;n.a(x),y.Nb.shifted===void 0&&(y.Nb.shifted=new S),y.Me.location=n.add(y.Nb.shifted)}const d=S.l(),f=S.l(),m=a.length;for(let p=0;p<m;p++){const y=a[p],x=y.key;if(x instanceof at){if(x.suspendsRouting){x.br=null;const P=x.fromNode,k=x.toNode;if(this.draggedLink!==null&&i.dragsLink){const v=y.value.point;if(x.dragComputation===null){e.set(x,this.Es(i,x,o));const N=o.x-v.x,M=o.y-v.y;x.fr(N,M)}else{const N=S.V(0,0),M=x.getPoint(0);M&&M.isReal()&&N.a(M),u=S.l().a(N).add(o);let C=u;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(C=S.l(),this.yS(x,u,C,i)),u.a(x.dragComputation(x,u,C)).subtract(N),e.set(x,this.Es(i,x,u));const F=u.x-v.x,T=u.y-v.y;x.fr(F,T),S.e(N),S.e(u),C!==u&&S.e(C)}}else{if(P!==null){d.a(P.location);const v=e.get(P);v!==null&&d.subtract(v.point)}if(k!==null){f.a(k.location);const v=e.get(k);v!==null&&f.subtract(v.point)}if(P!==null&&k!==null)if(d.equalsApprox(f)){const v=y.value.point,N=n;N.a(d),N.subtract(v),e.set(x,this.Es(i,x,d)),x.fr(N.x,N.y)}else x.suspendsRouting=!1,x.invalidateRoute();else{const v=y.value.point;let N;P!==null?N=d:k!==null?N=f:N=o,e.set(x,this.Es(i,x,N));const M=N.x-v.x,C=N.y-v.y;x.fr(M,C)}}}else if(x.fromNode===null||x.toNode===null){const P=y.value.point;e.set(x,this.Es(i,x,o));const k=o.x-P.x,v=o.y-P.y;x.fr(k,v)}}}S.e(n),S.e(o),S.e(d),S.e(f),b.J(h),b.J(a),r||(this.Mi(),this.NP(e))}computeMove(e,t,i,s){if(s===void 0&&(s=new S),s.a(t),e===null)return s;let n=t;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=S.l(),this.yS(e,t,n,i));const r=e.dragComputation!==null?e.dragComputation(e,t,n):n,h=e.minLocation;let a=h.x;isNaN(a)&&(a=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let l=h.y;isNaN(l)&&(l=o?Math.round(e.location.y*1e3)/1e3:e.location.y);const u=e.maxLocation;let c=u.x;isNaN(c)&&(c=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let d=u.y;return isNaN(d)&&(d=o?Math.round(e.location.y*1e3)/1e3:e.location.y),s.i(Math.max(a,Math.min(r.x,c)),Math.max(l,Math.min(r.y,d))),n!==t&&S.e(n),s}o0(){const e=this.toolManager.findTool("Dragging");return e instanceof Ue?e.dragOptions:this.yb}yS(e,t,i,s){if(s===void 0&&(s=this.o0()),i.a(t),e===null)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,h=o.height;const a=s.gridSnapOrigin;let l=a.x,u=a.y;const c=s.gridSnapCellSpot;if(n!==null){const f=n.gridCellSize;isNaN(r)&&(r=f.width),isNaN(h)&&(h=f.height);const m=n.gridOrigin;isNaN(l)&&(l=m.x),isNaN(u)&&(u=m.y)}const d=S.V(0,0);return d.setSpot(0,0,r,h,c),A.Dg(t.x,t.y,l+d.x,u+d.y,r,h,i),S.e(d),i}WC(e){if(e===null)return;this.gb=!0;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof at&&(i.suspendsRouting=!0)}}NP(e){if(e===null)return;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof at&&(i.suspendsRouting=!1,i.WL()&&i.invalidateRoute())}this.gb=!1}get draggedLink(){return this.pb}set draggedLink(e){this.pb!==e&&(this.pb=e,e!==null&&(this.wb=e.fromPort,this.xb=e.toPort))}get RP(){return this.wb}set RP(e){this.wb=e}get vP(){return this.xb}set vP(e){this.xb=e}HL(e,t){const i=e.containingGroup;if(i!==null){let s=this.HL(i,t);if(s!==null||(s=t.get(i),s!==null))return s}return null}Es(e,t,i){if(i===void 0)return new ni(S.xo);let s=e.isGridSnapEnabled;return!e.groupsSnapMembers&&t.containingGroup!==null&&(s=!1),s?new ni(new S(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new ni(i.copy())}BM(e,t){if(e.diagram!==null&&e.diagram!==this&&b.o("Cannot share a Layer with another Diagram: "+e+" of "+e.diagram),t===null?e.diagram!==null&&b.o("Cannot add an existing Layer to this Diagram again: "+e):(t.diagram!==this&&b.o("Existing Layer must be in this Diagram: "+t+" not in "+t.diagram),e===t&&b.o("Cannot move a Layer before or after itself: "+e)),e.diagram===this)return;const i=e.name,s=this.Xt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&b.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(e){this.BM(e,null),e.Mo(this);const t=this.Xt;let i=t.count-1;if(!e.isTemporary)for(;i>=0&&t.elt(i).isTemporary;)i--;return t.insertAt(i+1,e),this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,i+1),this.S(),this.invalidateDocumentBounds(),this}addLayerBefore(e,t){this.BM(e,t),e.Mo(this);const i=this.Xt,s=i.indexOf(e);s>=0&&(i.delete(e),this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o,e);break}return this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o),this.S(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(e,t){this.BM(e,t),e.Mo(this);const i=this.Xt,s=i.indexOf(e);s>=0&&(i.delete(e),this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o+1,e);break}return this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o+1),this.S(),s<0&&this.invalidateDocumentBounds(),this}Xr(e,t){e.Mo(this),this.Xt.insertAt(t,e)}JL(e){this.Xt.removeAt(e)}removeLayer(e){if(e.diagram!==this&&b.o("Cannot remove a Layer from another Diagram: "+e+" of "+e.diagram),e.name==="")return;const t=this.Xt,i=t.indexOf(e);if(t.delete(e)){const s=e.Ct.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;o!==e.name?n.layerName=o:n.layerName=""}this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,i,null),this.S(),this.invalidateDocumentBounds()}}findLayer(e){const t=this.layers;for(;t.next();){const i=t.value;if(i.name===e)return i}return null}findRouter(e){for(const t of this.Vc)if(t.name===e)return t;return null}addModelChangedListener(e){return b.k(e,Y,"addModelChangedListener:listener"),this.Gn===null&&(this.Gn=new J),this.Gn.add(e),this.model.addChangedListener(e),this}removeModelChangedListener(e){b.k(e,Y,"removeModelChangedListener:listener"),this.Gn!==null&&(this.Gn.delete(e),this.Gn.count===0&&(this.Gn=null)),this.model.removeChangedListener(e)}addChangedListener(e){return b.k(e,Y,"addChangedListener:listener"),this.Nr===null&&(this.Nr=new J),this.Nr.add(e),this}removeChangedListener(e){b.k(e,Y,"removeChangedListener:listener"),this.Nr!==null&&(this.Nr.delete(e),this.Nr.count===0&&(this.Nr=null))}VM(e){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(e),e.change!==1&&(this.isModified=!0),this.Nr!==null){const t=this.Nr,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}}raiseChangedEvent(e,t,i,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const h=new si;h.diagram=this,h.change=e,h.propertyName=t,h.object=i,h.oldValue=s,h.oldParam=o,h.newValue=n,h.newParam=r,this.VM(h)}raiseChanged(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}t(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}get animationManager(){return this.ds}get undoManager(){return this.ki.undoManager}get skipsUndoManager(){return this.Lo}set skipsUndoManager(e){b.s(e,"boolean",Y,"skipsUndoManager"),this.Lo=e,this.ki.skipsUndoManager=e}get delaysLayout(){return this.Gx}set delaysLayout(e){this.Gx=e}VC(e,t){if(e===null||e.diagram!==this)return;const i=this.fe;try{this.fe=!0;const s=e.change;if(s===2){const n=e.object,o=e.propertyName,r=e.getValue(t);if(e.diagram.model.Z(n,o,r),n instanceof Ct){const h=n.part;h!==null&&h.invalidateAdornments()}this.isModified=!0}else if(s===3){const n=e.object,o=e.newParam,r=e.newValue;if(n instanceof rt)if(typeof o=="number"&&r instanceof Ct){t?n.te(o):n.insertAt(o,r);const h=n.part;h!==null&&h.invalidateAdornments()}else typeof o=="number"&&r instanceof ee&&(r.isRow?n.$L(o,t?void 0:r):n.ZL(o,t?void 0:r));else if(n instanceof de){const h=e.oldParam===!0;typeof o=="number"&&r instanceof Lt&&(t?(h||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.te(h?o:-1,r,h)):n.Jh(o,r,h))}else n instanceof Y?typeof o=="number"&&r instanceof de&&(t?this.JL(o):this.Xr(r,o)):b.o("unknown ChangeType.Insert object: "+e.toString());this.isModified=!0}else if(s===4){const n=e.object,o=e.oldParam,r=e.oldValue;if(n instanceof rt)typeof o=="number"&&r instanceof Ct?t?n.insertAt(o,r):n.te(o):typeof o=="number"&&r instanceof ee&&(r.isRow?n.$L(o,t?r:void 0):n.ZL(o,t?r:void 0));else if(n instanceof de){const h=e.newParam===!0;typeof o=="number"&&r instanceof Lt&&(t?n.Ct.indexOf(r)<0&&n.Jh(o,r,h):(h||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.te(h?o:-1,r,h)))}else n instanceof Y?typeof o=="number"&&r instanceof de&&(t?this.Xr(r,o):this.JL(o)):b.o("unknown ChangeType.Remove object: "+e.toString());this.isModified=!0}else s===1||b.o("unknown ChangedEvent: "+e.toString())}finally{this.fe=i}}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(e){this.partManager.updateAllTargetBindings(e)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.Ze!==null){const e=this.Ze.part;e!==null&&e.Do()}}setDivBackground(e){this.div&&(this.div.style.backgroundColor=e)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}_m(){const e=this.T,t=this.tt,i=this.at;e.Ri(),t!==1&&e.tt(t),(i.x!==0||i.y!==0)&&e.Fs(-i.x,-i.y)}QL(e,t){const i=this.animationManager;if(this.Ht||this.ys){this.tt=t,this.Ql(),this.S(),this.aa(),i.yL(e,this.tt),this._m();return}if(this.ft===null){this.tt=t,this._m();return}this.Ht=!0;const s=this.viewportBounds.copy(),n=this.xt,o=this.bt;let r=this.zoomPoint.x,h=this.zoomPoint.y;const a=this.contentAlignment;isNaN(r)&&(a.isSide()?a.includesSide(B.LeftSide)?r=0:a.includesSide(B.RightSide)&&(r=n-1):a.isSpot()?r=a.x*(n-1):r=n/2),isNaN(h)&&(a.isSide()?a.includesSide(B.TopSide)?h=0:a.includesSide(B.BottomSide)&&(h=o-1):a.isSpot()?h=a.y*(o-1):h=o/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(t=this.scaleComputation(this,t)),t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale);const l=S.V(this.at.x+r/e-r/t,this.at.y+h/e-h/t);this.position=l,S.e(l),this.tt=t,this._m(),this.Ql(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,e,!1),this.Bs(!1),i.yL(e,this.tt),this.S()}MR(){const e=this.Xt.r;for(let t=0;t<e.length;t++)e[t].ML()}onViewportBoundsChanged(e,t,i,s){if(e.equals(t))return;s===void 0&&(s=!1),s||this.aa(),this._l();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(e.width!==t.width||e.height!==t.height)&&n.invalidateLayout();const o=this.currentTool;this.Uc===!0&&o instanceof Se&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.standardMouseActivity(this)),this.Ht||this.invalidateViewport(e,t),this.th(),this.Bi.scale=i,this.Bi.position.x=e.x,this.Bi.position.y=e.y,this.Bi.bounds.a(e),this.Bi.canvasSize.width=Math.round(e.width*i),this.Bi.canvasSize.height=Math.round(e.height*i),this.Bi.newCanvasSize.width=this.xt,this.Bi.newCanvasSize.height=this.bt,this.Bi.isScroll=s,this.D("ViewportBoundsChanged",this.Bi,e),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(t)&&r.invalidateRoute()})}th(e){const t=this.Ze;if(t===null||!t.visible||t.part===null||t.layer===null)return;const i=e!==void 0?e:this.nb;if(!i.isReal())return;const s=i.width,n=i.height;if(t.scale=1,t.angle=0,t.layer.isViewportAligned)t.width=s*this.scale,t.height=n*this.scale,t.part.alignment=B.TopLeft;else{t.yi===null&&(t.yi=new fi);const o=t.yi.Yc;if(!o.isReal())return;t.width=s+o.width*2,t.height=n+o.height*2;const r=S.l();A.Dg(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),t.part.location=r,S.e(r)}}clearSelection(e){e===void 0&&(e=!1);const t=this.selection;if(t.count===0)return;e||this.D("ChangingSelection",t);const i=t.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}t.Pt(),t.clear(),t.u(),e||this.D("ChangedSelection",t)}select(e){e!==null&&e.diagram===this&&(!e.isSelected||this.selection.count>1)&&(this.D("ChangingSelection",this.selection),this.clearSelection(!0),e.isSelected=!0,this.D("ChangedSelection",this.selection))}selectCollection(e){if(this.D("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s instanceof Lt||b.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const t=e.iterator;for(;t.next();){const i=t.value;i instanceof Lt||b.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.D("ChangedSelection",this.selection)}clearHighlighteds(){const e=this.highlighteds;if(e.count>0){const t=e.toArray(),i=t.length;for(let s=0;s<i;s++){const n=t[s];n.isHighlighted=!1}e.Pt(),e.clear(),e.u()}}highlight(e){e!==null&&e.diagram===this&&(!e.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),e.isHighlighted=!0)}highlightCollection(e){const t=new K().addAll(e),i=this.highlighteds.copy().removeAll(t).iterator;for(;i.next();){const n=i.value;n.isHighlighted=!1}const s=t.iterator;for(;s.next();){const n=s.value;n instanceof Lt||b.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(e,t,i){i===void 0&&(i=1);const s=t==="up"||t==="down";let n=0;const o=S.l();if(e==="pixel")n=i;else if(e==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(e==="page"){let h=s?this.viewportBounds.height:this.viewportBounds.width;if(h*=this.scale,h!==0){const a=Math.max(h-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*a}}else if(e==="document"){const h=this.documentBounds,a=this.viewportBounds;t==="up"?this.position=o.i(a.x,h.y):t==="left"?this.position=o.i(h.x,a.y):t==="down"?this.position=o.i(a.x,h.bottom-a.height):t==="right"&&(this.position=o.i(h.right-a.width,a.y)),S.e(o);return}else b.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+e);n/=this.scale;const r=this.position;t==="up"?this.position=o.i(r.x,r.y-n):t==="down"?this.position=o.i(r.x,r.y+n):t==="left"?this.position=o.i(r.x-n,r.y):t==="right"?this.position=o.i(r.x+n,r.y):b.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+t),S.e(o)}scrollToRect(e){const t=this.viewportBounds;if(t.containsRect(e))return;const i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}centerRect(e){const t=this.viewportBounds,i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}transformDocToView(e){return e.copy().T(this.T)}transformViewToDoc(e){return e.copy().Oe(this.T)}$F(e){return e.Oe(this.T)}get opacity(){return this.$t}set opacity(e){const t=this.$t;t!==e&&(b.s(e,"number",Y,"opacity"),(e<0||e>1)&&b.W(e,"0 <= value <= 1",Y,"opacity"),this.$t=e,this.t("opacity",t,e),this.S())}get validCycle(){return this.Ux}set validCycle(e){const t=this.Ux;t!==e&&(this.Ux=e,this.t("validCycle",t,e))}get layers(){return this.Xt.iterator}get isModelReadOnly(){const e=this.ki;return e===null?!1:e.isReadOnly}set isModelReadOnly(e){const t=this.ki;t!==null&&(t.isReadOnly=e)}get isReadOnly(){return this.Ao}set isReadOnly(e){const t=this.Ao;t!==e&&(b.s(e,"boolean",Y,"isReadOnly"),this.Ao=e,this.t("isReadOnly",t,e))}get isEnabled(){return this.Oi}set isEnabled(e){const t=this.Oi;t!==e&&(b.s(e,"boolean",Y,"isEnabled"),this.Oi=e,this.t("isEnabled",t,e))}get allowClipboard(){return this.Kx}set allowClipboard(e){const t=this.Kx;t!==e&&(b.s(e,"boolean",Y,"allowClipboard"),this.Kx=e,this.t("allowClipboard",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(b.s(e,"boolean",Y,"allowCopy"),this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(b.s(e,"boolean",Y,"allowDelete"),this.vl=e,this.t("allowDelete",t,e))}get allowDragOut(){return this.jx}set allowDragOut(e){const t=this.jx;t!==e&&(b.s(e,"boolean",Y,"allowDragOut"),this.jx=e,this.t("allowDragOut",t,e))}get allowDrop(){return this.Hx}set allowDrop(e){const t=this.Hx;t!==e&&(b.s(e,"boolean",Y,"allowDrop"),this.Hx=e,this.t("allowDrop",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(b.s(e,"boolean",Y,"allowTextEdit"),this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(b.s(e,"boolean",Y,"allowGroup"),this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(b.s(e,"boolean",Y,"allowUngroup"),this.El=e,this.t("allowUngroup",t,e))}get allowInsert(){return this.qx}set allowInsert(e){const t=this.qx;t!==e&&(b.s(e,"boolean",Y,"allowInsert"),this.qx=e,this.t("allowInsert",t,e))}get allowLink(){return this.Ul}set allowLink(e){const t=this.Ul;t!==e&&(b.s(e,"boolean",Y,"allowLink"),this.Ul=e,this.t("allowLink",t,e))}get allowRelink(){return this.Bl}set allowRelink(e){const t=this.Bl;t!==e&&(b.s(e,"boolean",Y,"allowRelink"),this.Bl=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(b.s(e,"boolean",Y,"allowMove"),this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(b.s(e,"boolean",Y,"allowReshape"),this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(b.s(e,"boolean",Y,"allowResize"),this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Yl}set allowRotate(e){const t=this.Yl;t!==e&&(b.s(e,"boolean",Y,"allowRotate"),this.Yl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Gl}set allowSelect(e){const t=this.Gl;t!==e&&(b.s(e,"boolean",Y,"allowSelect"),this.Gl=e,this.t("allowSelect",t,e))}get allowUndo(){return this.Wx}set allowUndo(e){const t=this.Wx;t!==e&&(b.s(e,"boolean",Y,"allowUndo"),this.Wx=e,this.t("allowUndo",t,e))}get allowZoom(){return this.Jx}set allowZoom(e){const t=this.Jx;t!==e&&(b.s(e,"boolean",Y,"allowZoom"),this.Jx=e,this.t("allowZoom",t,e))}get hasVerticalScrollbar(){return this.vu}set hasVerticalScrollbar(e){const t=this.vu;t!==e&&(b.s(e,"boolean",Y,"hasVerticalScrollbar"),this.vu=e,this.aa(),this.S(),this.t("hasVerticalScrollbar",t,e),this.Bs(!1))}get hasHorizontalScrollbar(){return this.Ru}set hasHorizontalScrollbar(e){const t=this.Ru;t!==e&&(b.s(e,"boolean",Y,"hasHorizontalScrollbar"),this.Ru=e,this.aa(),this.S(),this.t("hasHorizontalScrollbar",t,e),this.Bs(!1))}get allowHorizontalScroll(){return this.$x}set allowHorizontalScroll(e){const t=this.$x;t!==e&&(b.s(e,"boolean",Y,"allowHorizontalScroll"),this.$x=e,this.t("allowHorizontalScroll",t,e),this.Bs(!1))}get allowVerticalScroll(){return this.Zx}set allowVerticalScroll(e){const t=this.Zx;t!==e&&(b.s(e,"boolean",Y,"allowVerticalScroll"),this.Zx=e,this.t("allowVerticalScroll",t,e),this.Bs(!1))}get scrollHorizontalLineChange(){return this.Qx}set scrollHorizontalLineChange(e){const t=this.Qx;t!==e&&(b.s(e,"number",Y,"scrollHorizontalLineChange"),e<0&&b.W(e,">= 0",Y,"scrollHorizontalLineChange"),this.Qx=e,this.t("scrollHorizontalLineChange",t,e))}get scrollVerticalLineChange(){return this._x}set scrollVerticalLineChange(e){const t=this._x;t!==e&&(b.s(e,"number",Y,"scrollVerticalLineChange"),e<0&&b.W(e,">= 0",Y,"scrollVerticalLineChange"),this._x=e,this.t("scrollVerticalLineChange",t,e))}get lastInput(){return this._h}set lastInput(e){this._h=e}get previousInput(){return this.Br}set previousInput(e){this.Br=e}get firstInput(){return this.Gm}set firstInput(e){this.Gm=e}get currentCursor(){return this.Bx}set currentCursor(e){if(e===""&&(e=this.Um),this.Bx!==e){b.s(e,"string",Y,"currentCursor");const t=this.ft,i=this.Mt;if(t===null||i===null)return;this.Bx=e;const s=t.style.cursor;t.style.cursor=e,i.style.cursor=e,t.style.cursor===s&&(t.style.cursor="-webkit-"+e,i.style.cursor="-webkit-"+e,t.style.cursor===s&&(t.style.cursor="-moz-"+e,i.style.cursor="-moz-"+e,t.style.cursor===s&&(t.style.cursor=e,i.style.cursor=e)))}}get defaultCursor(){return this.Um}set defaultCursor(e){e===""&&(e="auto");const t=this.Um;t!==e&&(b.s(e,"string",Y,"defaultCursor"),this.Um=e,this.t("defaultCursor",t,e))}get click(){return this.Cr}set click(e){const t=this.Cr;t!==e&&(e!==null&&b.k(e,Y,"click"),this.Cr=e,this.t("click",t,e))}get doubleClick(){return this.Lr}set doubleClick(e){const t=this.Lr;t!==e&&(e!==null&&b.k(e,Y,"doubleClick"),this.Lr=e,this.t("doubleClick",t,e))}get contextClick(){return this.Ar}set contextClick(e){const t=this.Ar;t!==e&&(e!==null&&b.k(e,Y,"contextClick"),this.Ar=e,this.t("contextClick",t,e))}get mouseOver(){return this.Tr}set mouseOver(e){const t=this.Tr;t!==e&&(e!==null&&b.k(e,Y,"mouseOver"),this.Tr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.Dr}set mouseHover(e){const t=this.Dr;t!==e&&(e!==null&&b.k(e,Y,"mouseHover"),this.Dr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.Fr}set mouseHold(e){const t=this.Fr;t!==e&&(e!==null&&b.k(e,Y,"mouseHold"),this.Fr=e,this.t("mouseHold",t,e))}get mouseDragOver(){return this.Vx}set mouseDragOver(e){const t=this.Vx;t!==e&&(e!==null&&b.k(e,Y,"mouseDragOver"),this.Vx=e,this.t("mouseDragOver",t,e))}get mouseDrop(){return this.Rr}set mouseDrop(e){const t=this.Rr;t!==e&&(this.Rr=e,this.t("mouseDrop",t,e))}get handlesDragDropForTopLevelParts(){return this.zx}set handlesDragDropForTopLevelParts(e){const t=this.zx;t!==e&&(b.s(e,"boolean",Y,"handlesDragDropForTopLevelParts"),this.zx=e,this.t("handlesDragDropForTopLevelParts",t,e))}get mouseEnter(){return this.vr}set mouseEnter(e){const t=this.vr;t!==e&&(e!==null&&b.k(e,Y,"mouseEnter"),this.vr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.Or}set mouseLeave(e){const t=this.Or;t!==e&&(e!==null&&b.k(e,Y,"mouseLeave"),this.Or=e,this.t("mouseLeave",t,e))}get toolTip(){return this.Ir}set toolTip(e){const t=this.Ir;t!==e&&(this.Ir=e,this.t("toolTip",t,e))}get contextMenu(){return this.Er}set contextMenu(e){const t=this.Er;t!==e&&(this.Er=e,this.t("contextMenu",t,e))}get commandHandler(){return this.sM}set commandHandler(e){const t=this.sM;t!==e&&(t&&t.doStop(),this.sM=e,e.Mo(this),e.doStart())}get toolManager(){return this.tM}set toolManager(e){this.tM!==e&&(this.tM=e,e.diagram=this)}get defaultTool(){return this.iM}set defaultTool(e){const t=this.iM;t!==e&&(this.iM=e,e.diagram=this,this.currentTool===t&&(this.currentTool=e))}get currentTool(){return this.eM}set currentTool(e){const t=this.eM;t&&(t.isActive&&t.doDeactivate(),t.cancelWaitAfter(),t.doStop()),e===null&&(e=this.defaultTool),e!==null&&(this.eM=e,e.diagram=this,e.doStart())}get selection(){return this.cM}get maxSelectionCount(){return this.sb}set maxSelectionCount(e){const t=this.sb;if(t!==e)if(b.s(e,"number",Y,"maxSelectionCount"),e>=0&&!isNaN(e)){if(this.sb=e,this.t("maxSelectionCount",t,e),!this.undoManager.isUndoingRedoing){const i=this.selection.count-e;if(i>0){this.D("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.D("ChangedSelection",this.selection)}}}else b.W(e,">= 0",Y,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.Xm}set nodeSelectionAdornmentTemplate(e){const t=this.Xm;t!==e&&(this.Xm=e.Et(),this.t("nodeSelectionAdornmentTemplate",t,e))}get groupSelectionAdornmentTemplate(){return this.rb}set groupSelectionAdornmentTemplate(e){const t=this.rb;t!==e&&(this.rb=e.Et(),this.t("groupSelectionAdornmentTemplate",t,e))}get linkSelectionAdornmentTemplate(){return this.lb}set linkSelectionAdornmentTemplate(e){const t=this.lb;t!==e&&(this.lb=e.Et(),this.t("linkSelectionAdornmentTemplate",t,e))}get highlighteds(){return this.fM}get isModified(){const e=this.undoManager;return e.isEnabled?e.currentTransaction!==null?!0:this.Uu&&this.Os!==e.historyIndex:this.Uu}set isModified(e){if(this.Uu!==e){b.s(e,"boolean",Y,"isModified"),this.Uu=e;const t=this.undoManager;!e&&t.isEnabled&&(this.Os=t.historyIndex),e||this._L()}}_L(){const e=this.isModified;this.hM!==e&&(this.hM=e,this.D("Modified"))}get model(){return this.ki}set model(e){const t=this.ki;if(t!==e){this.currentTool.doCancel(),t&&t.undoManager!==e.undoManager&&t.undoManager.isInTransaction&&b.o("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);const i=this.OL(!0);this.jn=!1,this.Fu=!0,this.Os=-2,this.xr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Fl("Model"),t&&(this.Gn!==null&&this.Gn.each(n=>t.removeChangedListener(n)),t.removeChangedListener(this.lM)),this.ki=e,this.partManager=this.vR(this.ki.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);e.addChangedListener(this.rM),this.partManager.zM(),e.removeChangedListener(this.rM),e.addChangedListener(this.lM),this.Gn!==null&&this.Gn.each(n=>e.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.S(),t&&e.undoManager.copyProperties(t.undoManager)}}get themeManager(){return this.NM}set themeManager(e){const t=this.NM;t!==e&&(t&&t.removeDiagram(this),this.NM=e,e!==null&&e.addDiagram(this))}initializePartManager(e){}static CM(e,t){Y.AL.set(e,t)}static get licenseKey(){return Y.XM.last()}static set licenseKey(e){Y.XM.add(e.replace(/\s/g,""))}static get version(){return Y.OR}vR(e){const t=Y.AL.get(e);return t!==null?new t:new ri}get X(){return this.oM}set X(e){this.oM=e}get bx(){return this.NL}IR(e){if(e.model!==this.model)return;const t=e.change,i=e.propertyName;if(t===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.ys&&!this.jn&&(this.vc=!0,this.Fu&&(this.xr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.D("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.X){this.X=!1;try{if(e.modelChange===""&&t===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.D("ChangedSelection",this.selection),this.Mi());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this.xL(),this.vc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.OS(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.Os=Math.min(this.Os,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Uw&&b.ir(()=>{this.isModified=!1},1);const n=e.isTransactionFinished;if(n&&(this._L(),this.bx.clear(),this.animationManager.OF()),!this.Xx&&n&&this.lastInput.targetDiagram){this.Xx=!0;const o=this;b.ir(()=>{o.currentTool.standardMouseOver(),o.Xx=!1},10)}}}finally{this.X=!0}}}get fe(){return this.nM}set fe(e){this.nM=e}get du(){return this.Yx}set du(e){this.Yx=e}GL(e){const t=e.C.r;for(const i of t)i instanceof be&&this.YM(i)}YM(e){const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||(t.ts instanceof K&&t.ts.add(this),e.ER(),!t.r0))return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s===null){be.tA(e,t);const n=[];n.push(e),this.Jl.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}UR(e){const t=e.C.r,i=t.length;for(let s=0;s<i;s++)this.GM(t[s])}GM(e){if(!(e instanceof be))return;const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||!t.r0)return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&(this.Jl.delete(i),be.BR(t),t.ts instanceof K&&t.ts.delete(this),be.clearCache(i));return}}}IL(){be.clearCache(),this.Jl.clear()}rebuildParts(){this.partManager.rebuildParts()}Lc(e,t){this.ds.Lc(e,t)}Cc(e,t){this.ds.Cc(e,t)}findPartForKey(e){return this.partManager.findPartForKey(e)}findNodeForKey(e){return this.partManager.findNodeForKey(e)}findLinkForKey(e){return this.partManager.findLinkForKey(e)}findPartForData(e){return this.partManager.findPartForData(e)}findNodeForData(e){return this.partManager.findNodeForData(e)}findLinkForData(e){return this.partManager.findLinkForData(e)}findNodesByExample(...e){return this.partManager.findNodesByExample(...e)}findLinksByExample(...e){return this.partManager.findLinksByExample(...e)}get nodeTemplate(){return this.Ur.get("")}set nodeTemplate(e){const t=this.Ur.get("");t!==e&&(this.Ur.set("",e),this.t("nodeTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Ur}set nodeTemplateMap(e){const t=this.Ur;t!==e&&(this.Ur=e,this.t("nodeTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.Qh.get("")}set groupTemplate(e){const t=this.Qh.get("");t!==e&&(this.Qh.set("",e),this.t("groupTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.Qh}set groupTemplateMap(e){const t=this.Qh;t!==e&&(this.Qh=e,this.t("groupTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.ql.get("")}set linkTemplate(e){const t=this.ql.get("");t!==e&&(this.ql.set("",e),this.t("linkTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.ql}set linkTemplateMap(e){const t=this.ql;t!==e&&(this.ql=e,this.t("linkTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.aM}set isMouseCaptured(e){const t=this.ft;if(t===null)return;const i=t.Tt;i instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Pi(i,"pointermove",this.na,!1),this.Pi(i,"pointerdown",this.Zl,!1),this.Pi(i,"pointerup",this.oa,!1),this.Pi(i,"pointerout",this.ra,!1),this.Pi(i,"pointercancel",this.la,!1),this.Ut(_,"pointermove",this.na,!0),this.Ut(_,"pointerdown",this.Zl,!0),this.Ut(_,"pointerup",this.oa,!0),this.Ut(_,"pointerout",this.ra,!0),this.Ut(_,"pointercancel",this.la,!0),this.Pi(i,"wheel",this.sa,!1),this.Ut(_,"wheel",this.sa,!0),this.Ut(_,"selectstart",this.jh,!1)):(this.Pi(_,"pointermove",this.na,!0),this.Pi(_,"pointerdown",this.Zl,!0),this.Pi(_,"pointerup",this.oa,!0),this.Pi(_,"pointerout",this.ra,!0),this.Pi(_,"pointercancel",this.la,!0),this.Ut(i,"pointermove",this.na,!1),this.Ut(i,"pointerdown",this.Zl,!1),this.Ut(i,"pointerup",this.oa,!1),this.Ut(i,"pointerout",this.ra,!1),this.Ut(i,"pointercancel",this.la,!1),this.Pi(_,"wheel",this.sa,!0),this.Pi(_,"selectstart",this.jh,!1),this.Ut(i,"wheel",this.sa,!1)),this.aM=e)}get position(){return this.at}set position(e){if(this.at.equals(e))return;const t=S.l().a(this.at),i=this.viewportBounds.copy();if(this.at.a(e),this.animationManager.pL(t,this.at),!this.Ht&&!(this.ft===null&&!this.Iu.isReal())){this.Ht=!0;const s=this.scale,n=this.xt/s,o=this.bt/s;this.DM(this.zm,n,o,this.Fc,!1),this.Ht=!1}else this.Ql(),this._m();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.tt,!1)}S.e(t)}get initialPosition(){return this.Mx}set initialPosition(e){this.Mx.equals(e)||(this.Mx=e.P())}get initialScale(){return this.Nx}set initialScale(e){this.Nx!==e&&(b.s(e,"number",Y,"initialScale"),this.Nx=e)}get grid(){return this.Ze===null&&(this.Ze=this.UL()),this.Ze}set grid(e){let t=this.Ze;if(t!==e){t===null&&(this.Ze=this.UL(),t=this.Ze),e.type!==rt.Grid&&b.o("Diagram.grid must be a Panel of type Panel.Grid");const i=t.panel;i!==null&&i.remove(t),this.Ze=e,e.name="GRID",i!==null&&i.add(e),this.Eu=!1,this.S(),this.t("grid",t,e)}}get viewportBounds(){return this.nb}Ql(){const e=this.nb,t=this.at,i=this.tt;e.i(t.x,t.y,Math.max(this.xt,0)/i,Math.max(this.bt,0)/i),this._l()}get viewSize(){return this.Iu}set viewSize(e){const t=this.viewSize;if(!t.equals(e)){e=e.P(),this.Iu=e;let i=0,s=0;e.isReal()?(i=e.width,s=e.height):this.Mt!==null&&(i=this.Mt.clientWidth||1,s=this.Mt.clientHeight||1),this.xt=i,this.bt=s,this.Ql(),this.invalidateDocumentBounds(),this.t("viewSize",t,e),this.S()}}get fixedBounds(){return this.Tx}set fixedBounds(e){const t=this.Tx;t.equals(e)||((e.width===-1/0||e.height===1/0||e.height===-1/0)&&b.o("fixedBounds width/height must not be Infinity"),e=e.P(),this.Tx=e,this.invalidateDocumentBounds(),this.t("fixedBounds",t,e))}get scrollMargin(){return this.$h}set scrollMargin(e){typeof e=="number"&&(e=new Ot(e));const t=this.$h;t.equals(e)||(e=e.P(),this.$h=e,this.t("scrollMargin",t,e),this.mu())}get scrollMode(){return this.qh}set scrollMode(e){const t=this.qh;t!==e&&(this.qh=e,e===1&&this.Bs(!1),this.t("scrollMode",t,e),this.aa(),this.S())}get scrollsPageOnFocus(){return this.Dx}set scrollsPageOnFocus(e){const t=this.Dx;t!==e&&(b.s(e,"boolean",Y,"scrollsPageOnFocus"),this.Dx=e,this.t("scrollsPageOnFocus",t,e))}get positionComputation(){return this.Fx}set positionComputation(e){const t=this.Fx;t!==e&&(e!==null&&b.k(e,Y,"positionComputation"),this.Fx=e,this.Bs(!1),this.t("positionComputation",t,e))}get scaleComputation(){return this.Rx}set scaleComputation(e){const t=this.Rx;t!==e&&(e!==null&&b.k(e,Y,"scaleComputation"),this.Rx=e,this.QL(this.scale,this.scale),this.t("scaleComputation",t,e))}get documentBounds(){return this.zm}iA(e){this.ta=!1;let t=this.zm;t.equals(e)||(t=t.copy(),this.zm.a(e),this.Bs(!1),this.D("DocumentBoundsChanged",void 0,t),this.aa(),this.S())}ensureBounds(){if(this.ta){const e=z.l();this.iA(this.computeBounds(e)),z.e(e)}}get isVirtualized(){return this.ob}set isVirtualized(e){const t=this.ob;t!==e&&(b.s(e,"boolean",Y,"isVirtualized"),this.ob=e,this.t("isVirtualized",t,e))}get scale(){return this.tt}set scale(e){const t=this.tt;t!==e&&this.QL(t,e)}get defaultScale(){return this.Km}set defaultScale(e){this.Km=e}get autoScale(){return this.jl}set autoScale(e){const t=this.jl;t!==e&&(this.jl=e,this.t("autoScale",t,e),e!==1&&this.Bs(!1))}get initialAutoScale(){return this.Sr}set initialAutoScale(e){const t=this.Sr;t!==e&&(this.Sr=e,this.t("initialAutoScale",t,e))}get initialViewportSpot(){return this.Ox}set initialViewportSpot(e){const t=this.Ox;t!==e&&(e.isSpot()||b.o("initialViewportSpot must be a specific Spot: "+e),this.Ox=e,this.t("initialViewportSpot",t,e))}get initialDocumentSpot(){return this.vx}set initialDocumentSpot(e){const t=this.vx;t!==e&&(e.isSpot()||b.o("initialViewportSpot must be a specific Spot: "+e),this.vx=e,this.t("initialDocumentSpot",t,e))}get minScale(){return this.Cx}set minScale(e){const t=this.Cx;t!==e&&(e>0?(this.Cx=e,this.t("minScale",t,e),e>this.scale&&(this.scale=e)):b.W(e,"> 0",Y,"minScale"))}get maxScale(){return this.Lx}set maxScale(e){const t=this.Lx;t!==e&&(e>0?(this.Lx=e,this.t("maxScale",t,e),e<this.scale&&(this.scale=e)):b.W(e,"> 0",Y,"maxScale"))}get zoomPoint(){return this.Ax}set zoomPoint(e){this.Ax.equals(e)||(e=e.P(),this.Ax=e)}get contentAlignment(){return this.Fc}set contentAlignment(e){const t=this.Fc;t.equals(e)||(e=e.P(),this.Fc=e,this.t("contentAlignment",t,e),this.Bs(!1))}get initialContentAlignment(){return this.Om}set initialContentAlignment(e){const t=this.Om;t.equals(e)||(e=e.P(),this.Om=e,this.t("initialContentAlignment",t,e))}get padding(){return this.Zt}set padding(e){typeof e=="number"&&(e=new Ot(e));const t=this.Zt;t.equals(e)||(e=e.P(),this.Zt=e,this.invalidateDocumentBounds(),this.t("padding",t,e))}get partManager(){return this.pM}set partManager(e){const t=this.pM;t!==e&&(e.diagram!==null&&b.o("Cannot share PartManagers between Diagrams: "+e.toString()),t&&t.Mo(null),this.pM=e,e.Mo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const e=new K,t=this.nodes;for(;t.next();){const s=t.value;s.isTopLevel&&e.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&e.add(s)}return e.iterator}findTopLevelGroups(){return this.zr.iterator}get routers(){return this.Vc}doLinkRouting(e){this.Co=!0;const t=this.Vc.r;for(let i=0;i<t.length;i++)t[i].canRoute(e)&&t[i].routeLinks(this.Mr,e);this.Co=!1}get layout(){return this.ie}set layout(e){const t=this.ie;t!==e&&(this.ie=e,e.diagram=this,e.group=null,this.Vr=!0,this.t("layout",t,e),this.requestUpdate())}layoutDiagram(e){this.Mi(),e&&this.Cb(!0),this.ys?this.vM(!1,this.bl||this.Vc.count!==0&&this.Yn.size!==0):(this.vc=!0,this.ur())}Cb(e){const t=this.zr.iterator;for(;t.next();)this.eA(t.value,e);this.layout&&(e?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}eA(e,t){if(e===null)return;const i=e.ca.iterator;for(;i.next();){const s=i.value;this.eA(s,t)}e.layout!==null&&(t?e.layout.isValidLayout=!1:e.layout.invalidateLayout())}vM(e,t){if(this.Gx)return;const i=this.X;this.X=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.wl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.pi&&(e||r.Fl(s)),this.Vr=!1;let h=this.zr.iterator;for(;h.next();)this.sA(h.value,e,n,t);let a=!1;if(o.isValidLayout||(!e||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.i0(this),a=!0,o.isValidLayout=!0):this.Vr=!0),a||this.i0(this),this.doLinkRouting(this),this.Mr.clear(),this.Zh.size!==0){for(let l=0;l<23&&this.Zh.size!==0;l++){for(h=this.zr.iterator;h.next();)this.nA(h.value);const u=this.Mr;this.Mr=this.Zh,this.Zh=u,this.i0(this),this.doLinkRouting(this)}this.Mr.clear(),this.Zh.clear()}}finally{const h=this.undoManager.wl;n===0&&(this.commitTransaction(s),this.undoManager.wl=!1),h&&(n===0||n===1)&&r.OS(),this.Vr&&(this.Vr=!o.isValidLayout),this.X=i}}sA(e,t,i,s){const n=e.ca.iterator;for(;n.next();)this.sA(n.value,t,i,s);const o=e.layout;o!==null&&!o.isValidLayout?!t||o.isRealtime||i===0?(e.fa=!e.location.isReal(),o.doLayout(e),e.invalidateLayout(32),this.Pb(e),this.i0(e),this.doLinkRouting(e),o.isValidLayout=!0):(this.doLinkRouting(e),this.Vr=!0):s&&this.doLinkRouting(e)}nA(e){const t=e.ca.iterator;for(;t.next();)this.nA(t.value);this.i0(e),this.doLinkRouting(e)}get isTreePathToChildren(){return this.Ix}set isTreePathToChildren(e){const t=this.Ix;if(t!==e&&(b.s(e,"boolean",Y,"isTreePathToChildren"),this.Ix=e,this.t("isTreePathToChildren",t,e),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.l0()}}findTreeRoots(){const e=new J,t=this.nodes;for(;t.next();){const i=t.value;i.isTopLevel&&i.findTreeParentLink()===null&&e.add(i)}return e.iterator}get treeCollapsePolicy(){return this.Ex}set treeCollapsePolicy(e){const t=this.Ex;t!==e&&(e!==1&&e!==2&&e!==3&&b.o("Unknown Diagram.treeCollapsePolicy: "+e),this.Ex=e,this.t("treeCollapsePolicy",t,e))}get isCollapsingExpanding(){return this._S}set isCollapsingExpanding(e){this._S=e}rR(){const e=new bt,t=new bt;function i(s){const n=s.toLowerCase(),o=new J;e.set(s,o),e.set(n,o),t.set(s,s),t.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.ZS=e,this.QS=t}YL(e){const t=this.QS.get(e);return t!==null?t:this.QS.get(e.toLowerCase())}KM(e){let t=this.ZS.get(e);if(t!==null)return t;const i=e.toLowerCase();if(t=this.ZS.get(i),t!==null)return t;b.o("Unknown DiagramEvent name: "+e)}addDiagramListener(e,t){b.s(e,"string",Y,"addDiagramListener:name"),b.k(t,Y,"addDiagramListener:listener");const i=this.KM(e);return i!==null&&i.add(t),this}removeDiagramListener(e,t){b.s(e,"string",Y,"removeDiagramListener:name"),b.k(t,Y,"addDiagramListener:listener");const i=this.KM(e);i!==null&&i.delete(t)}raiseDiagramEvent(e,t,i){this.D(e,t,i)}D(e,t,i){const s=this.KM(e),n=new Oi;n.diagram=this;const o=this.YL(e);o!==null&&(n.name=o),t!==void 0&&(n.subject=t),i!==void 0&&(n.parameter=i);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const h=s.toArray();for(let a=0;a<r;a++){const l=h[a];l(n)}}}isUnoccupied(e,t){return this.getPositions(!1,null,t||null).isUnoccupied(e.x,e.y,e.width,e.height)}computeOccupiedArea(e){return this.isVirtualized?this.viewportBounds.copy():this.ta?this.VL(e):e.a(this.documentBounds)}getPositions(e,t,i){let s=this.Hl;s===null&&(this.Hl=s=new Xe(this.avoidanceCellSize));let n=t;if(s.Fo||s.ua!==n||s.jM!==i){if(s.HM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.qM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.oA(n)),n===null){const o=z.l();this.computeOccupiedArea(o),o.inflate(100,100),s.Lb(o);const r=this.nodes;for(;r.next();){const h=r.value,a=h.layer;a===null||!a.visible||a.isTemporary||this.WM(h,i,o)}z.e(o)}else{if(n.memberParts.count>0){const h=this.computePartsBounds(n.memberParts,!1);h.inflate(20,20),s.Lb(h)}const o=z.l(),r=n.memberParts;for(;r.next();){const h=r.value;h instanceof st&&this.WM(h,i,o)}z.e(o)}s.ua=n,s.jM=i,s.Fo=!1}else e&&s.rA();return s}get avoidanceCellSize(){return this.uM}set avoidanceCellSize(e){this.Hl=null,this.uM=new ot(Math.max(1,e.width),Math.max(1,e.height))}get avoidanceLimit(){return this.dM}set avoidanceLimit(e){this.dM=Math.max(1,e)}oA(e){return e.canAvoid()?e:e.containingGroup!==null?this.oA(e.containingGroup):null}WM(e,t,i){if(e===t||!e.isVisible())return;const s=e.canAvoid();if(s){const n=e.getAvoidableRect(i);this.Hl.VR(n.x,n.y,n.width,n.height)}if(e instanceof ut&&(!s||e.avoidableMembers)){const n=e.memberParts;for(;n.next();){const o=n.value;o instanceof st&&this.WM(o,t,i)}}}JM(e){this.Hl!==null&&!this.Hl.Fo&&(e===void 0||e.canAvoid())&&(this.Hl.Fo=!0)}get autoScrollInterval(){return this.Im}set autoScrollInterval(e){const t=this.Im;t!==e&&(this.Im=e,this.t("autoScrollInterval",t,e))}get autoScrollRegion(){return this.Em}set autoScrollRegion(e){typeof e=="number"&&(e=new Ot(e));const t=this.Em;t.equals(e)||(e=e.P(),this.Em=e,this.invalidateDocumentBounds(),this.t("autoScrollRegion",t,e))}doAutoScroll(e){this.Ym.a(e),this.computeAutoScrollPosition(this.Ym).equalsApprox(this.position)?this.stopAutoScroll():this.lA()}lA(){if(this.Rc!==-1)return;const e=this.Im,t=this;this.Rc=b.ir(()=>{if(t.Rc===-1||(t.stopAutoScroll(),t.lastInput.event===null))return;const i=t.computeAutoScrollPosition(t.Ym);if(i.equalsApprox(t.position))return;t.position=i,t.lastInput.documentPoint=t.transformViewToDoc(t.Ym),t.doMouseMove(),t.ta=!0;const s=z.l();t.computeBounds(s),s.unionRect(t.documentBounds),t.iA(s),z.e(s),t.Ue=!0,t.maybeUpdate(),t.lA()},e)}stopAutoScroll(){this.Rc!==-1&&(b.Tg(this.Rc),this.Rc=-1)}computeAutoScrollPosition(e){let t=this.position;const i=this.Em;if(i.top<=0&&i.left<=0&&i.right<=0&&i.bottom<=0)return t;const s=this.viewportBounds,n=this.scale,o=z.V(0,0,s.width*n,s.height*n),r=S.V(0,0);if(e.x>=o.x&&e.x<o.x+i.left&&this.allowHorizontalScroll){let h=Math.max(this.scrollHorizontalLineChange,1);h=h|0,r.x-=h,e.x<o.x+i.left/2&&(r.x-=h),e.x<o.x+i.left/4&&(r.x-=4*h)}else if(e.x<=o.x+o.width&&e.x>o.x+o.width-i.right&&this.allowHorizontalScroll){let h=Math.max(this.scrollHorizontalLineChange,1);h=h|0,r.x+=h,e.x>o.x+o.width-i.right/2&&(r.x+=h),e.x>o.x+o.width-i.right/4&&(r.x+=4*h)}if(e.y>=o.y&&e.y<o.y+i.top&&this.allowVerticalScroll){let h=Math.max(this.scrollVerticalLineChange,1);h=h|0,r.y-=h,e.y<o.y+i.top/2&&(r.y-=h),e.y<o.y+i.top/4&&(r.y-=4*h)}else if(e.y<=o.y+o.height&&e.y>o.y+o.height-i.bottom&&this.allowVerticalScroll){let h=Math.max(this.scrollVerticalLineChange,1);h=h|0,r.y+=h,e.y>o.y+o.height-i.bottom/2&&(r.y+=h),e.y>o.y+o.height-i.bottom/4&&(r.y+=4*h)}return r.equalsApprox(S.xo)||(t=new S(t.x+r.x/n,t.y+r.y/n)),z.e(o),S.e(r),t}makeSvg(e){this.Wl.has("SVG")||this.addRenderer("SVG",new Ni(this,_.document));const t=new Ni(this,_.document,!0);e===void 0&&(e={});const i=this;function s(n,o){const r=i.hA(n,"SVG",t),h=r!==null?r.svg:null;return b.it(o)?(o(h),null):h}return this.aA(s,e)}makeSVG(e){return this.makeSvg(e)}addRenderer(e,t){this.Wl.set(e,t)}removeRenderer(e){this.Wl.delete(e)}cacheGroupExternalLinks(e){this.MM=e,e||this.nodes.each(t=>{t instanceof ut&&(t.h0=null)})}aA(e,t){const i=t.callback;let s=!0;const n=this.Jl.iterator;for(;n.next();)if(!n.value[0].hn){s=!1;break}if(!b.it(i)||s)return e(t,i,this);const o=this;function r(){const l=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].hn){s=!1;break}if(s||l-a>h){e(t,i,o);return}_.requestAnimationFrame(r)}const h=t.callbackTimeout||300,a=+new Date;return _.requestAnimationFrame(()=>r()),null}makeImage(e){return Y.isUsingDOM()?(e===void 0&&(e={}),e.returnType="Image",this.makeImageData(e)):null}makeImageData(e){return e===void 0&&(e={}),this.aA(this.zR,e)}zR(e,t,i){const s=i.hA(e,"canvas",null);if(s===null)return null;const n=s.E.canvas;let o=null;if(n!==null){let r=e.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case Y.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case Y.img:const h=(e.document||document).createElement("img");h.src=n.toDataURL(e.type,e.details),o=h;break;case"blob":{const a=n;return b.it(t)||(o="",b.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),b.it(a.toBlob)?(a.toBlob(t,e.type,e.details),"toBlob"):(t(null),null)}case"string":default:o=n.toDataURL(e.type,e.details)}}return b.it(t)?(t(o),null):o}hA(e,t,i){if(this.animationManager.stopAnimation(),this.maybeUpdate(),this.ft===null)return null;b.G(e)||b.o("properties argument must be an Object.");let s=!1,n=e.size||null,o=e.scale||null;e.scale!==void 0&&isNaN(e.scale)&&(o="NaN");let r=e.maxSize;e.maxSize===void 0&&(s=!0,t==="SVG"?r=new ot(1/0,1/0):r=new ot(2e3,2e3));const h=e.position||null;let a=e.parts||null;Array.isArray(a)&&(a=new J(a));let l=e.padding===void 0?1:e.padding;const u=e.background||null;let c=e.omitTemporary;c===void 0&&(c=!0);const d=e.document||document,f=e.elementFinished||null;let m=e.showTemporary;m===void 0&&(m=!c);let p=e.showGrid;p===void 0&&(p=m),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof l=="number"?l=new Ot(l):l instanceof Ot||b.o("MakeImage padding must be a Margin or a number."),l.left=Math.max(l.left,0),l.right=Math.max(l.right,0),l.top=Math.max(l.top,0),l.bottom=Math.max(l.bottom,0),this.Qt.clearContextCache(!0);const y=new He(null,d,void 0,!0),x=y.li;if(!(n||o||a||h))return y.width=this.xt+Math.ceil(l.left+l.right),y.height=this.bt+Math.ceil(l.top+l.bottom),t==="SVG"?i===null?null:(i.resize(y.width,y.height,y.width,y.height),i.jr=d,i.Gu=f,this.Sb(i.li,l,new ot(y.width,y.height),this.tt,this.at,a,u,m,p),i.li):(this.Bu=!1,this.Sb(x,l,new ot(y.width,y.height),this.tt,this.at,a,u,m,p),this.Bu=!0,y.li);const P=this.Km,k=this.documentBounds.copy();if(k.subtractMargin(this.Zt),m){const D=this.Xt.r,O=D.length;for(let R=0;R<O;R++){const I=D[R];if(!I.visible||!I.isTemporary)continue;const X=I.Ct.r,j=X.length;for(let V=0;V<j;V++){const U=X[V];if(!U.isInDocumentBounds||!U.isVisible())continue;const W=U.actualBounds;W.isReal()&&k.unionRect(W)}}}let v=new S(k.x,k.y);if(a!==null){const D=new z(0,0,0,0);let O=!0;const R=a.iterator;for(R.reset();R.next();){const I=R.value;if(!(I instanceof Lt))continue;const X=I.layer;if(X!==null&&!X.visible||X!==null&&!m&&X.isTemporary||!I.isVisible())continue;const j=I.actualBounds;j.isReal()&&(O?(O=!1,D.a(j)):D.unionRect(j))}k.width=D.width,k.height=D.height,v.x=D.x,v.y=D.y}h!==null&&h.isReal()&&(v=h,o||(o=P));let N=0,M=0;l!==null&&(N=l.left+l.right,M=l.top+l.bottom);let C=0,F=0;n!==null&&(C=n.width,F=n.height,isFinite(C)&&(C=Math.max(0,C-N)),isFinite(F)&&(F=Math.max(0,F-M)));let T=0,L=0;if(n!==null&&o!==null?(o==="NaN"&&(o=P),n.isReal()?(T=C,L=F):isNaN(F)?(T=C,L=k.height*o):(T=k.width*o,L=F)):n!==null?n.isReal()?(o=Math.min(C/k.width,F/k.height),T=C,L=F):isNaN(F)?(o=C/k.width,T=C,L=k.height*o):(o=F/k.height,T=k.width*o,L=F):o!==null?o==="NaN"&&r.isReal()?(o=Math.min((r.width-N)/k.width,(r.height-M)/k.height),o>P?(o=P,T=k.width,L=k.height):(T=r.width,L=r.height)):(T=k.width*o,L=k.height*o):(o=P,T=k.width,L=k.height),l!==null?(T+=N,L+=M):l=new Ot(0),r!==null){let D=r.width,O=r.height;t!=="SVG"&&s&&Y.XR,isNaN(D)&&(D=2e3),isNaN(O)&&(O=2e3),isFinite(D)&&(T=Math.min(T,D)),isFinite(O)&&(L=Math.min(L,O))}return y.width=Math.ceil(T),y.height=Math.ceil(L),t==="SVG"?i===null?null:(i.resize(y.width,y.height,y.width,y.height),i.jr=d,i.Gu=f,this.Sb(i.li,l,new ot(Math.ceil(T),Math.ceil(L)),o,v,a,u,m,p),i.li):(this.Bu=!1,this.Sb(x,l,new ot(Math.ceil(T),Math.ceil(L)),o,v,a,u,m,p),this.Bu=!0,y.li)}};g(Y,"db",null),g(Y,"AL",new bt),g(Y,"kM"),g(Y,"PM",null),g(Y,"RL",_.document!==void 0),g(Y,"Qe",new WeakMap),g(Y,"Zm",null),g(Y,"bb",""),g(Y,"None",1),g(Y,"Uniform",2),g(Y,"UniformToFill",3),g(Y,"CycleAll",1),g(Y,"CycleNotDirected",2),g(Y,"CycleNotDirectedFast",3),g(Y,"CycleNotUndirected",4),g(Y,"CycleDestinationTree",5),g(Y,"CycleSourceTree",6),g(Y,"DocumentScroll",1),g(Y,"InfiniteScroll",2),g(Y,"TreeParentCollapsed",1),g(Y,"AllParentsCollapsed",2),g(Y,"AnyParentsCollapsed",3),g(Y,"XM",new J),g(Y,"OR","3.0.26"),g(Y,"img","image"),g(Y,"XR",!1),g(Y,"Xu",null),g(Y,"cA","5da73c80a36555d4038e4972187c3cae51fd22"),g(Y,"mw",!1),g(Y,"Gk",()=>{if(Y.cA[5]===void 0&&(Tt.prototype.$e=Tt.prototype.kw),!Y.isUsingDOM())return;const e=b.hs("canvas"),t=e.getContext("2d"),i=b.Ts("7ca11abfd022028846");t[i]=b.Ts("398c3597c01238");const s="7ca11abfd7330390",n=[Y.cA,b.mw+"4ae6247590da4bb21c324ba3a84e385776",Tt.Gk+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",A.za],o=10,r=0;for(let h=1;h<5;h++)t[b.Ts(s)](b.Ts(n[h-1]),o,h*15+r);t[i]=b.Ts("39f046ebb36e4b");for(let h=1;h<5;h++)t[b.Ts(s)](b.Ts(n[h-1]),o,h*15+r);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(Tt.prototype.$e=Tt.prototype.kw),Y.Xu=e});let kt=Y;class Nn{constructor(e){g(this,"fA");g(this,"uA");g(this,"$M");g(this,"Ne");if(this.fA=null,this.uA="63ad05bbe23a1786468a4c741b6d2",this.$M="@onz",this.uA===this._tk){this.$M=!0,this.Ne=this.$M;return}this.Ne=null}YR(e,t){let i="f";const s=_[b.Ts("76a715b2f73f148a")][b.Ts("72ba13b5")]||"",n=b.Ts;if(this.Ne=!0,!kt.isUsingDOM())return;let o=kt[n("76a115b6ed251eaf4692")];if(!o){const h=s[n("76ad18b4f73e")];for(let l=s[n("73a612b6fb191d")](n("35e7"))+2;l<h;l++)i+=s[l];const a=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ne=!(a>=0&&a<i[n("73a612b6fb191d")](n("35")));return}const r=kt.XM.iterator;for(;r.next();){o=r.value;const h=n(o).split(n("39e9"));if(h.length<6)return;const a=n(h[1]).split(".");if(h[4]!=="7da71ca0")return;const l=n(b[n("6cae19")]).split(".");if(!(a[0]>l[0]||a[0]===l[0]&&a[1]>=l[1]))continue;const u="73a612b6fb191d",c=_[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),d=c[n(u)](n("3aad1ab6e022098b4dc4")),f=n(h[2]);if(d>-1){const T=c[n(u)](f.toLowerCase()+"/");if(this.Ne=!(T>-1&&T<d),!this.Ne)return}const m=s[n("76ad18b4f73e")];for(let T=s[n(u)](n("35e7"))+2;T<m;T++)i+=s[T];let p=i[n(u)](f);if(p<0&&f!==n("7da71ca0ad381e90")&&(p=i[n(u)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(u)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(u)](n("2bfa41fdb3784bca12"))),p<0&&(p=s[n(u)](n("7baa19a6f76c1988428554"))),p<0&&(p=s[n(u)](n("7ea902b2b9221e9c57c45767196566"))),this.Ne=!(p>=0&&p<i[n(u)](n("35"))||i[n(u)](n("35"))===-1),!this.Ne||s[n(u)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ne=!(s[n(u)](f)>-1),!this.Ne))return;const y=_[b.Ts("76a715b2f73f148a")][b.Ts("69ad17a1e03e")],x=y[n(u)](n("7fb002b6ed25128b4da25b2e"));if(x>-1&&(this.Ne=!(y[n(u)](f)>x),!this.Ne))return;const P=f;if(P[0]!=="#")continue;const k=b.hs("div");let v=h[0].replace(/[A-Za-z]/g,"");for(;v.length<4;)v+="9";const N=v;v=v.substring(v.length-4);let M="";const C=["gsh","gsf"],F=["Header","Background","Display","Feedback"];if(M+=C[parseInt(v.substring(0,1),10)%2],M+=F[parseInt(v.substring(0,1),10)%4],k[n("79a417a0f0181a8946")]=M,_.document[n("78a712aa")]){_.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](k);const T=_.getComputedStyle(k).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),L=_.getComputedStyle(k).getPropertyValue(n("75b817b0ea2202"));if(_.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](k),!T)continue;const D=_[n("77a902b0eb1b1e804a8a")],O="0."+parseInt(N,10)%100;if(L===O||T.indexOf(parseInt(P[1]+P[2],16))!==-1&&T.indexOf(parseInt(P[3]+P[4],16))!==-1){this.Ne=!1;return}else if(D&&D(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){M="."+M;for(let R=0;R<document.styleSheets.length;R++){const I=document.styleSheets[R].rules||document.styleSheets[R].cssRules;for(const X in I)if(M===I[X].selectorText){this.Ne=!1;return}}}}else this.Ne=null,t&&(this.Ne=!1)}}Xu(e){return e.Qt.setTransform(e.Vi,0,0,e.Vi,0,0),e.Qt.commitTransform(),this.Ne===null&&this.YR(e,!0),0<this.Ne&&this!==this.fA}}class ni{constructor(e){g(this,"ZM");g(this,"QM");this.ZM=e===void 0?new S:e,this.QM=new S}get point(){return this.ZM}set point(e){this.ZM=e}get shifted(){return this.QM}set shifted(e){this.QM=e}}class Cn{constructor(e,t,i){g(this,"Me");g(this,"qL");g(this,"Nb");this.Me=e,this.qL=t,this.Nb=i}}class zi{constructor(e){g(this,"isGridSnapEnabled");g(this,"isGridSnapRealtime");g(this,"gridSnapCellSize");g(this,"gridSnapCellSpot");g(this,"gridSnapOrigin");g(this,"dragsLink");g(this,"dragsTree");g(this,"groupsSnapMembers");g(this,"groupsAlwaysMove");g(this,"dragsMembers");this.Ri(),e&&Object.assign(this,e)}Ri(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new ot(NaN,NaN).u(),this.gridSnapCellSpot=B.TopLeft,this.gridSnapOrigin=new S(NaN,NaN).u(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Tn extends kt{constructor(e,t){let i;return e===void 0||typeof e=="string"||_.Element&&e instanceof Element?i=e:b.G(e)&&(t=e),super(i),this.dA(),t&&this.setProperties(t),this}dA(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=B.TopCenter,this.layout=new Yi}setupRouters(){}reset(){super.reset(),this.dA()}}class Xi extends kt{constructor(t,i){let s;t===void 0||typeof t=="string"||_.Element&&t instanceof Element?s=t:b.G(t)&&(i=t);super(s);g(this,"Ab");g(this,"Tb");g(this,"Db");g(this,"Fb");g(this,"a0");g(this,"Kc");g(this,"Al");g(this,"_M");g(this,"t2");g(this,"Rb");g(this,"i2");return this.animationManager.isEnabled=!1,this.Ht=!0,this.Ab=null,this.Ru=!1,this.vu=!1,this.Tb=!0,this.Db=!0,this.Fb=0,this.a0=!1,this.Kc=null,this.setRenderingHint("drawShadows",!1),this.Al=new Lt({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new dt({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).Et(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new Ot(0,0,0,0),this.at.i(0,0),this.toolManager.Jt("Dragging",new Ln,this.toolManager.mouseMoveTools),this.click=()=>{const n=this.observed;if(n===null)return;const o=n.viewportBounds,r=this.lastInput.documentPoint;n.position=new S(r.x-o.width/2,r.y-o.height/2)},this._M=n=>{this.invalidateDocumentBounds(),this.c0()},this.t2=n=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.S())},this.Rb=n=>{this.updateDelay<1?this.S():this.a0||(this.a0=!0,b.ir(()=>this.redraw(),this.updateDelay))},this.i2=n=>{this.observed!==null&&this.c0()},this.autoScale=2,this.Ht=!1,i&&Object.assign(this,i),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.a0&&this.updateDelay>=1&&(this.a0=!1,this.GR()),super.redraw()}Ui(){if(this.Mt===null&&b.o("No div specified"),this.ft===null&&b.o("No canvas specified"),this.ft instanceof Ni||(this.box.JS(),!this.Ue))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Vh)return;this.e0();const i=this.ft,s=this.Qt;if(s.clearContextCache(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.gA();else if(this.Kc!==null){s.drawImage(this.Kc.Tt,0,0);const r=this.T;s.scale(this.Vi,this.Vi),s.transform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),s.commitTransform()}const n=this.Xt.r,o=n.length;for(let r=0;r<o;r++)n[r].Ui(s,this);this.Ic=!1,this.Ue=!1}GR(){const t=this.ft,i=this.Qt;if(!(t===null||i===null)){if(this.e0(),this.Kc===null){const s=new He(null);s.width=t.width,s.height=t.height,this.Kc=s}try{this.ft=this.Kc,this.Qt=this.ft.li,this.Qt.clearContextCache(!0),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.clearRect(0,0,this.ft.width,this.ft.height),this.gA()}finally{this.ft=t,this.Qt=i}}}gA(){const t=this.observed;if(t===null)return;const i=this.drawsTemporaryLayers,s=this.drawsGrid&&i,n=t.grid;if(s&&n!==null&&n.visible&&!(isNaN(n.width)||isNaN(n.height))){const c=z.l().a(this.viewportBounds).unionRect(t.viewportBounds);t.th(c),z.e(c),t.Mi()}const o=this.T,r=this.Qt;r.scale(this.Vi,this.Vi),r.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),r.commitTransform();const h=this.viewportBounds,a=t.Xt.r,l=a.length,u=this.Xt.r;this.ps(u,u.length,this,this.viewportBounds);for(let c=0;c<l;c++)a[c].KF(r,h,this,i,s)}get observed(){return this.Ab}set observed(t){const i=this.Ab;if(t instanceof Xi&&b.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(i!==null&&this.KR(i),this.Ab=t,t!==null&&this.jR(t),this.invalidateDocumentBounds(),t===null){this.Kc=null;const s=this.ft,n=this.Qt;s&&n&&(n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,s.width,s.height))}else this.Rb(null),this.c0(),this.S();this.t("observed",i,t)}}get box(){return this.Al}set box(t){const i=this.Al;i!==t&&(t.Et(),this.Al=t,this.remove(i),this.add(this.Al),this.c0(),this.t("box",i,t))}get drawsTemporaryLayers(){return this.Tb}set drawsTemporaryLayers(t){this.Tb!==t&&(this.Tb=t,this.redraw())}get drawsGrid(){return this.Db}set drawsGrid(t){this.Db!==t&&(this.Db=t,this.redraw())}get updateDelay(){return this.Fb}set updateDelay(t){t<0&&(t=0),this.Fb!==t&&(this.Fb=t)}jR(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this._M),t.addDiagramListener("DocumentBoundsChanged",this.t2),t.addDiagramListener("InvalidateDraw",this.Rb),t.addDiagramListener("AnimationFinished",this.i2),this.add(this.box))}KR(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this._M),t.removeDiagramListener("DocumentBoundsChanged",this.t2),t.removeDiagramListener("InvalidateDraw",this.Rb),t.removeDiagramListener("AnimationFinished",this.i2))}c0(){const t=this.box,i=this.observed;if(i===null)return;this.Ue=!0;const s=i.viewportBounds,n=t.selectionObject,o=ot.l();o.i(s.width,s.height),n.desiredSize=o,ot.e(o);const r=2/this.scale;n instanceof dt&&(n.strokeWidth=r),t.location=new S(s.x-r/2,s.y-r/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return z.Fg;const i=t.documentBounds.copy();return i.unionRect(t.viewportBounds),i}invalidateViewport(t,i){this.Ue!==!0&&(this.Ue=!0,this.requestUpdate())}onViewportBoundsChanged(t,i,s,n){this.Ht||(this._l(),this.S(),this.aa(),this.invalidateDocumentBounds(),this.c0(),this.Bi.scale=s,this.Bi.position.x=t.x,this.Bi.position.y=t.y,this.Bi.bounds.a(t),this.Bi.isScroll=n,this.D("ViewportBoundsChanged",this.Bi,t))}}class Ln extends Ue{constructor(){super();g(this,"eh");this.eh=null}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const i=t.observed;if(i===null)return!1;const s=t.lastInput;if(!s.left||t.currentTool!==this&&(!this.isBeyondDragSize()||s.isTouchEvent&&s.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=i.viewportBounds;this.eh=new S(n.width/2,n.height/2);const o=t.firstInput.documentPoint;i.position=new S(o.x-this.eh.x,o.y-this.eh.y)}return!0}doActivate(){this.eh=null,super.doActivate()}doUpdateCursor(t){const i=this.diagram,s=i.box;s!==null&&s.cursor&&(i.currentCursor=s.cursor)}moveParts(t,i,s){const n=this.diagram,o=n.observed;if(o===null)return;const r=n.box;if(r===null)return;if(this.eh===null){const a=n.firstInput.documentPoint,l=r.location;this.eh=new S(a.x-l.x,a.y-l.y)}const h=n.lastInput.documentPoint;o.position=new S(h.x-this.eh.x,h.y-this.eh.y)}}class we{constructor(e){g(this,"N");g(this,"e2");g(this,"s2");g(this,"o2");g(this,"l2");g(this,"h2");g(this,"a2");g(this,"c2");g(this,"f2");g(this,"nh");g(this,"u2");g(this,"vb");g(this,"Ob");g(this,"Ib");g(this,"Eb");g(this,"d2");g(this,"Ro");g(this,"g2");K.Ki(this),this.N=kt.um(),this.e2=!0,this.s2=!0,this.o2=!0,this.l2=!1,this.h2=!1,this.a2=!1,this.c2=!1,this.f2=null,this.nh=null,this.u2=1.05,this.vb=NaN,this.Ob=null,this.Ib=NaN,this.Eb=z.Fg,this.d2=!1,this.Ro=null,this.g2=200,e&&Object.assign(this,e)}toString(){return"CommandHandler"}get diagram(){return this.N}Mo(e){this.N=e}doStart(){}doStop(){}doKeyDown(){const e=this.diagram,t=e.lastInput,i=b.tr?t.meta:t.control,s=t.shift,n=t.alt,o=t.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||i&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():o==="ArrowUp"?e.allowVerticalScroll&&(i?e.scroll("pixel","up"):e.scroll("line","up")):o==="ArrowDown"?e.allowVerticalScroll&&(i?e.scroll("pixel","down"):e.scroll("line","down")):o==="ArrowLeft"?e.allowHorizontalScroll&&(i?e.scroll("pixel","left"):e.scroll("line","left")):o==="ArrowRight"?e.allowHorizontalScroll&&(i?e.scroll("pixel","right"):e.scroll("line","right")):o==="PageUp"?s&&e.allowHorizontalScroll?e.scroll("page","left"):e.allowVerticalScroll&&e.scroll("page","up"):o==="PageDown"?s&&e.allowHorizontalScroll?e.scroll("page","right"):e.allowVerticalScroll&&e.scroll("page","down"):o==="Home"?i&&e.allowVerticalScroll?e.scroll("document","up"):!i&&e.allowHorizontalScroll&&e.scroll("document","left"):o==="End"?i&&e.allowVerticalScroll?e.scroll("document","down"):!i&&e.allowHorizontalScroll&&e.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||i&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():t.bubbles=!0}doKeyUp(){const e=this.diagram.lastInput;e.bubbles=!0}stopCommand(){const e=this.diagram,t=e.currentTool;t instanceof Se&&e.allowSelect&&e.clearSelection(),t!==null&&t.doCancel()}canStopCommand(){return!0}selectAll(){const e=this.diagram;e.S();try{e.currentCursor="wait",e.D("ChangingSelection",e.selection);const t=e.parts;for(;t.next();){const n=t.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=e.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=e.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{e.D("ChangedSelection",e.selection),e.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){const e=this.diagram;try{e.currentCursor="wait",e.D("ChangingSelection",e.selection),e.startTransaction("Delete"),e.D("SelectionDeleting",e.selection);const t=new K,i=e.selection.iterator;for(;i.next();){const s=i.value;Lt.oh(t,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}e.removeParts(t,!0),e.D("SelectionDeleted",t)}finally{e.commitTransaction("Delete"),e.D("ChangedSelection",e.selection),e.currentCursor=""}}canDeleteSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||e.selection.count===0)}copySelection(){const e=this.diagram;try{const t=new K,i=e.selection.iterator;for(;i.next();){const s=i.value;Lt.oh(t,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(t)}finally{}}canCopySelection(){const e=this.diagram;return!(!e.allowCopy||!e.allowClipboard||e.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowCopy||!e.allowDelete||!e.allowClipboard||e.selection.count===0)}copyToClipboard(e){const t=this.diagram;let i=null;if(e===null)kt.vL();else{let s=null;try{s=t.copyParts(e,null,!0)}finally{i=new J,s!==null&&i.addAll(s.iteratorValues),kt.Zm=i,kt.bb=t.model.dataFormat}}t.D("ClipboardChanged",i)}pasteFromClipboard(){const e=new K,t=kt.Zm;if(t===null)return e;const i=this.diagram;if(kt.bb!==i.model.dataFormat)return e;let s=null;try{s=i.copyParts(t,i,!1)}finally{if(s!==null){const n=s.iterator;for(;n.next();){const o=n.value,r=n.key;o.location.isReal()||(r.location.isReal()?o.location=r.location:!o.position.isReal()&&r.position.isReal()&&(o.position=r.position)),e.add(o)}}}return e}pasteSelection(e){e===void 0&&(e=null);const t=this.diagram;try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),t.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&t.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(e!==null){const n=t.computePartsBounds(t.selection);if(n.isReal()){const o=this.computeEffectiveCollection(t.selection,t.yb);t.TP(o,new S(e.x-n.centerX,e.y-n.centerY),t.yb,!1)}}t.D("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.D("ChangedSelection",t.selection),t.currentCursor=""}}canPasteSelection(e){const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowClipboard||kt.Zm===null||kt.Zm.count===0||kt.bb!==t.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canRedo()}decreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canDecreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}increaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canIncreaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}resetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;e<t.minScale||e>t.maxScale||(t.scale=e)}canResetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;return e<t.minScale||e>t.maxScale?!1:t.allowZoom}zoomToFit(){const e=this.diagram,t=e.animationManager;t.stopAnimation(),e.redraw();const i=e.position,s=e.scale;t.Fl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.Ib&&!isNaN(this.vb)&&this.Ob!==null&&e.documentBounds.equals(this.Eb)?(e.scale=this.vb,e.position=this.Ob,this.Ib=NaN,this.Eb=z.Fg):(this.vb=s,this.Ob=i.copy(),e.zoomToFit(),this.Ib=e.scale,this.Eb=e.documentBounds.copy()),t.OS()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(e){e===void 0&&(e=null);const t=this.diagram;if(t.ensureBounds(),e===null){try{this.Ro!==null&&(this.Ro.next()?e=this.Ro.value:this.Ro=null)}catch{this.Ro=null}e===null&&(t.highlighteds.count>0?this.Ro=t.highlighteds.iterator:t.selection.count>0&&(this.Ro=t.selection.iterator),this.Ro!==null&&this.Ro.next()&&(e=this.Ro.value))}if(e!==null){const i=t.animationManager;i.Fl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.jc(e,[e]);if(n.length===1)t.startTransaction(),t.centerRect(e.actualBounds),t.commitTransaction("Scroll To Part");else{const o=()=>{t.startTransaction();let h=n.pop();for(;n.length>0&&h instanceof st&&h.isTreeExpanded&&(!(h instanceof ut)||h.isSubGraphExpanded);)h=n.pop();n.length>0?(h instanceof Lt&&t.scrollToRect(h.actualBounds),h instanceof st&&!h.isTreeExpanded&&(h.isTreeExpanded=!0),h instanceof ut&&!h.isSubGraphExpanded&&(h.isSubGraphExpanded=!0)):(h instanceof Lt&&t.centerRect(h.actualBounds),t.removeDiagramListener("LayoutCompleted",r)),t.commitTransaction("Scroll To Part")},r=()=>{b.ir(o,(i.isEnabled?i.duration:0)+s)};t.addDiagramListener("LayoutCompleted",r),o()}}else{const n=t.position.copy();t.centerRect(e.actualBounds),n.equalsApprox(t.position)&&i.stopAnimation()}}}jc(e,t){if(e.isVisible())return t;if(e instanceof yt){const i=e.adornedPart;i!==null&&this.jc(i,t)}else if(e instanceof at){const i=e.fromNode;i!==null&&this.jc(i,t);const s=e.toNode;s!==null&&this.jc(s,t)}else{if(e instanceof st){const s=e.labeledLink;s!==null&&this.jc(s,t);const n=e.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&t.push(n),this.jc(n,t))}const i=e.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&t.push(i),this.jc(i,t))}return t}canScrollToPart(e){if(e===void 0&&(e=null),e!==null&&!(e instanceof Lt))return!1;const t=this.diagram;return t.selection.count===0&&t.highlighteds.count===0?!1:t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&e.isTreeExpanded)e.collapseTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof st&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}t.D("TreeCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof st)||!e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof st){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(e){e===void 0&&(e=null);const t=this.diagram,i="Expand Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&!e.isTreeExpanded)e.expandTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof st&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}t.D("TreeExpanded",s)}finally{t.commitTransaction(i)}}canExpandTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof st)||e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof st){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const e=this.diagram,t=e.model;if(!t.Hc())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{e.currentCursor="wait",e.D("ChangingSelection",e.selection),e.startTransaction("Group");const n=new J,o=e.selection.iterator;for(;o.next();){const l=o.value;l.ke()&&l.canGroup()&&n.add(l)}const r=new J,h=n.iterator;for(;h.next();){const l=h.value;let u=!1;const c=n.iterator;for(;c.next();){const d=c.value;if(l.isMemberOf(d)){u=!0;break}}u||r.add(l)}const a=r.first();if(a!==null){let l=a.containingGroup;if(l!==null)for(;l!==null;){let u=!1;const c=r.iterator;for(;c.next();)if(!c.value.isMemberOf(l)){u=!0;break}if(u)l=l.containingGroup;else break}if(i instanceof ut)i.Et(),s=i.copy(),s!==null&&e.add(s);else if(t.isGroupForData(i)){const u=t.copyNodeData(i);b.G(u)&&(t.addNodeData(u),s=e.findNodeForData(u))}if(s!==null){l!==null&&this.isValidMember(l,s)&&(s.containingGroup=l);const u=r.iterator;for(;u.next();){const c=u.value;this.isValidMember(s,c)&&(c.containingGroup=s)}e.clearSelection(!0),s.isSelected=!0}}e.D("SelectionGrouped",s)}finally{e.commitTransaction("Group"),e.D("ChangedSelection",e.selection),e.currentCursor=""}}canGroupSelection(){const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowGroup||!e.model.Hc()||this.archetypeGroupData===null)return!1;const t=e.selection.iterator;for(;t.next();){const i=t.value;if(i.ke()&&i.canGroup())return!0}return!1}m2(e){const t=b.et();if(Array.isArray(e))e.forEach(n=>{n instanceof at||n instanceof Lt&&t.push(n)});else{const n=e.iterator;for(;n.next();){const o=n.value;o instanceof at||o instanceof Lt&&t.push(o)}}const i=new K,s=t.length;for(let n=0;n<s;n++){const o=t[n];let r=!0;for(let h=0;h<s;h++)if(o.isMemberOf(t[h])){r=!1;break}r&&i.add(o)}return b.J(t),i}isValidMember(e,t){if(t===null||e===t||t instanceof at)return!1;let i;return e!==null&&(e===t||e.isMemberOf(t)||(i=e.memberValidation,i!==null&&!i(e,t))||e.data===null&&t.data!==null||e.data!==null&&t.data===null)?!1:(i=this.memberValidation,i!==null?i(e,t):!0)}ungroupSelection(e){e===void 0&&(e=null);const t=this.diagram,i=t.model;if(i.Hc())try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),t.startTransaction("Ungroup");const s=new J;if(e!==null)s.add(e);else{const o=t.selection.iterator;for(;o.next();){const r=o.value;r instanceof ut&&r.canUngroup()&&s.add(r)}}const n=new J;if(s.count>0){t.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const h=r.containingGroup,a=h!==null&&h.data!==null?i.getKeyForNodeData(h.data):void 0;n.addAll(r.memberParts);const l=n.iterator;for(;l.next();){const u=l.value;if(u.isSelected=!0,u instanceof at)continue;const c=u.data;c!==null?i.setGroupForData(c,a):u.containingGroup=h}t.remove(r)}}t.D("SelectionUngrouped",s,n)}finally{t.commitTransaction("Ungroup"),t.D("ChangedSelection",t.selection),t.currentCursor=""}}canUngroupSelection(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||!t.allowUngroup||!t.model.Hc())return!1;if(e!==null){if(!(e instanceof ut))return!1;if(e.canUngroup())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof ut&&s.canUngroup())return!0}}return!1}addTopLevelParts(e,t){const i=this.m2(e);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!t||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse SubGraph";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new J;if(e!==null&&e.isSubGraphExpanded)e.collapseSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof ut&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}t.D("SubGraphCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof ut)||!e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof ut&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Expand SubGraph",s=new J;try{if(t.startTransaction(i),t.animationManager.Fl(i),e!==null&&!e.isSubGraphExpanded)e.expandSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof ut&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}t.D("SubGraphExpanded",s)}finally{for(const n of s)this.mA(t,n);e&&this.mA(t,e),t.commitTransaction(i)}}mA(e,t){for(const i of t.memberParts)i instanceof st&&e.Cc(i,t)}canExpandSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof ut)||e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof ut&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){e===void 0&&(e=null);const t=this.diagram,i=t.toolManager.findTool("TextEditing");if(i!==null){if(e===null){let s=null;const n=t.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;e=s.findInVisualTree(o=>o instanceof Kt&&o.editable)}e!==null&&(t.currentTool=null,i.textBlock=e,t.currentTool=i)}}canEditTextBlock(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowTextEdit||t.toolManager.findTool("TextEditing")===null)return!1;if(e!==null){if(!(e instanceof Kt))return!1;const i=e.part;if(i!==null&&i.canEdit())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(e=s.findInVisualTree(n=>n instanceof Kt&&n.editable),e!==null))return!0}}return!1}showContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");if(i===null)return;e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t);const s=i.findObjectWithContextMenu(e);if(s!==null){const n=t.lastInput;let o=null;if(s instanceof Ct)o=s.getDocumentPoint(B.Center);else if(!t.viewportBounds.containsPoint(n.documentPoint)){const r=t.viewportBounds;o=new S(r.x+r.width/2,r.y+r.height/2)}if(o!==null){const r=new Ge;r.diagram=t,r.viewPoint=t.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,t.lastInput=r}t.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");return!(i===null||(e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t),i.findObjectWithContextMenu(e)===null))}get copiesClipboardData(){return this.e2}set copiesClipboardData(e){b.s(e,"boolean",we,"copiesClipboardData"),this.e2=e}get copiesConnectedLinks(){return this.s2}set copiesConnectedLinks(e){b.s(e,"boolean",we,"copiesConnectedLinks"),this.s2=e}get deletesConnectedLinks(){return this.o2}set deletesConnectedLinks(e){b.s(e,"boolean",we,"deletesConnectedLinks"),this.o2=e}get copiesTree(){return this.l2}set copiesTree(e){b.s(e,"boolean",we,"copiesTree"),this.l2=e}get deletesTree(){return this.h2}set deletesTree(e){b.s(e,"boolean",we,"deletesTree"),this.h2=e}get copiesParentKey(){return this.a2}set copiesParentKey(e){b.s(e,"boolean",we,"copiesParentKey"),this.a2=e}get copiesGroupKey(){return this.c2}set copiesGroupKey(e){b.s(e,"boolean",we,"copiesGroupKey"),this.c2=e}get archetypeGroupData(){return this.f2}set archetypeGroupData(e){e!==null&&b.ec(e,we,"archetypeGroupData"),this.diagram,this.f2=e}get memberValidation(){return this.nh}set memberValidation(e){e!==null&&b.k(e,we,"memberValidation"),this.nh=e}get defaultScale(){return this.diagram.defaultScale}set defaultScale(e){this.diagram.defaultScale=e}get zoomFactor(){return this.u2}set zoomFactor(e){e>1||b.o("zoomFactor must be larger than 1.0, not: "+e),this.u2=e}get isZoomToFitRestoreEnabled(){return this.d2}set isZoomToFitRestoreEnabled(e){b.s(e,"boolean",we,"isZoomToFitRestoreEnabled"),this.d2=e}get scrollToPartPause(){return this.g2}set scrollToPartPause(e){this.g2=e}computeEffectiveCollection(e,t){const i=this.diagram,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;t===void 0&&(t=i.o0());const o=new bt;if(e===null)return o;let r=e.iterator;for(;r.next();){const h=r.value;i.Kr(o,h,n,t)}if(i.draggedLink!==null&&t.dragsLink)return o;for(r=e.iterator;r.next();){const h=r.value;if(h instanceof at){const a=h.fromNode;if(a!==null&&!o.has(a))o.delete(h);else{const l=h.toNode;l!==null&&!o.has(l)&&o.delete(h)}}}return o}}var es=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Vertical=4]="Vertical",w[w.Horizontal=5]="Horizontal",w[w.Fill=2]="Fill",w))(es||{}),is=(w=>(w[w.None=0]="None",w[w.Along=21]="Along",w[w.Plus90=22]="Plus90",w[w.Minus90=23]="Minus90",w[w.Opposite=24]="Opposite",w[w.Upright=25]="Upright",w[w.Plus90Upright=26]="Plus90Upright",w[w.Minus90Upright=27]="Minus90Upright",w[w.Upright45=28]="Upright45",w))(is||{}),_s=(w=>(w[w.None=0]="None",w[w.Vertical=1]="Vertical",w[w.Horizontal=2]="Horizontal",w[w.Both=3]="Both",w))(_s||{});const vt=class vt{constructor(){g(this,"n");g(this,"f0");g(this,"u0");g(this,"Hr");g(this,"p");g(this,"lh");g(this,"ct");g(this,"at");g(this,"se");g(this,"$t");g(this,"d0");g(this,"Vs");g(this,"Lt");g(this,"is");g(this,"qr");g(this,"hh");g(this,"wi");g(this,"da");g(this,"tt");g(this,"Yt");g(this,"Wr");g(this,"Ni");g(this,"zi");g(this,"Ku");g(this,"hi");g(this,"ju");g(this,"Ot");g(this,"si");g(this,"Jr");g(this,"Ub");g(this,"ah");g(this,"Hu");K.Ki(this),this.n=30723,this.$t=1,this.d0="",this.Vs=null,this.Lt=null,this.at=new S(NaN,NaN).u(),this.is=ot.ww,this.qr=new Tt,this.hh=new Tt,this.wi=null,this.da=1,this.tt=1,this.Yt=0,this.Wr=Ot.Rg,this.se=new z(NaN,NaN,NaN,NaN).u(),this.Ni=new z(NaN,NaN,NaN,NaN).u(),this.zi=new z(0,0,NaN,NaN).u(),this.Ku=null,this.f0=null,this.ct=null,this.hi=B.Default,this.ju=B.Default,this.u0=0,this.Hr=0,this.Ot=null,this.p=null,this.lh=null,this.si=null,this.Ub=null,this.ah=null,this.Jr=null,this.Hu=null}cloneProtected(e){e.n=(this.n|2048|4096)&-32769,e.$t=this.$t,e.d0=this.d0,e.Lt=this.Lt,e.at.a(this.at),e.is=this.is.P(),this.wi!==null?e.wi=this.wi.copy():e.wi=null,e.tt=this.tt,e.Yt=this.Yt,e.Wr=this.Wr.P(),e.se.a(this.se),e.Ni.a(this.Ni),e.zi.a(this.zi),e.f0=this.f0,this.ct!==null&&(e.ct=this.ct.copy()),e.hi=this.hi.P(),e.ju=this.ju.P(),e.u0=this.u0,e.Hr=this.Hr,this.Ot!==null&&(e.Ot=this.Ot.copy()),this.p!==null&&(this.p.fi?e.p=this.p:e.p=this.p.copy()),this.lh!==null&&(e.lh=this.lh.slice()),this.si!==null&&(e.si=this.si.copy())}addCopyProperty(e){let t=this.lh;if(!Array.isArray(t))t=[],this.lh=t;else for(let i=0;i<t.length;i++)if(t[i]===e)return;t.push(e)}vo(e){e.Ku=null,e.Jr=null,e.c()}clone(){const e=new this.constructor;if(this.cloneProtected(e),this.lh!==null)for(let t=0;t<this.lh.length;t++){const i=this.lh[t];e[i]=this[i]}return e}copy(){return this.clone()}rS(){const e=this.Ci;if(e!==null){this.Ci=null;for(const t of e)t.qu()&&(t.isToData?this.themeData(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):t.isToObject?this.themeObject(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter,t.sourceName):t.isToModel?this.themeModel(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):this.theme(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter))}return this}oi(e){e in is?this.segmentOrientation=e:e in es?this.stretch=e:b.er(this,e)}toString(){return b.Dn(this.constructor)+"#"+K.as(this)}ch(){this.p!==null&&(this.p.fi=!0)}Kt(){return this.p===null?this.p=new oi:this.p.fi&&(this.p=this.p.copy()),this.p}Be(){if(this.ct===null){const e=new ji;e.ga=B.None,e.ma=B.None,e.pa=10,e.ya=10,e.wa=0,e.xa=0,this.ct=e}return this.ct}raiseChangedEvent(e,t,i,s,n,o,r){const h=this.part;if(h!==null){h.qc(e,t,i,s,n,o,r),i===this&&e===2&&this.Wc()&&this.ba(h,t);const a=this.diagram;if(this.ws!==null&&a!==null&&a.Vh&&!a.undoManager.isUndoingRedoing&&!a.animationManager.pu){const l=this.ws.get(t);if(l!==null&&a.animationManager.isEnabled&&!a.animationManager.isTicking){this.Hu===null&&(this.Hu=new bt);let u=a.undoManager.transactionLevel===0;if(l.startCondition===2?u=!0:l.startCondition===3&&(u=!1),u){const c=new di;l.XF(c);const d=this.Hu.get(l);d!==null&&d.stop(),this.Hu.set(l,c),c.mx=this,c.XS=l,c.add(this,t,s,n),c.start()}else a.animationManager.getBundleAnimation().add(this,t,s,n)}}if(this instanceof rt&&i===h&&h.p2()&&h.data!==null){const l=this.C.r,u=l.length;for(let c=0;c<u;c++){const d=l[c];d instanceof rt&&d.Gr(f=>{f.data!==null&&f.p2()&&f.updateTargetBindings(t)})}}}}UF(e){this.Hu.delete(e)}Do(){if(this.diagram!==null&&this.findBindingPanel()===null&&this.Ci!==null){const e=this.diagram.model,t=this.Ci.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.pA(n));let o=this;const r=i.targetId;r!==-1&&(o=this.g0(r),o===null)||(n==="/"?s=o.part:n==="."?s=o:n===".."&&(s=o.panel),i.updateTarget(o,s,void 0,e))}}}ba(e,t){const i=this.findBindingPanel();if(i!==null){const s=e.diagram,n=this.Ci.iterator;for(;n.next();){const o=n.value;let r=null;if(o.isToObject){if(r=o.yA(i,this),r===null)continue;o.updateSource(this,r,t,null)}else if(o.isToModel)s!==null&&!s.fe&&o.updateSource(this,s.model.modelData,t,i);else if(!o.isToTheme){const h=i.data;if(h===null)continue;s!==null&&!s.fe&&o.updateSource(this,h,t,i)}if(r===this){const h=o.targetId,a=i.g0(h);a!==null&&o.updateTarget(a,r,t,s==null?void 0:s.model)}}}}g0(e){return this.Hn===e?this:null}pA(e){let t;return e===""?t=this:e==="/"?t=this:e==="."?t=this:e===".."?t=this:t=this.part.findObject(e),t}get Hn(){return this.p!==null?this.p.Hn:-1}set Hn(e){this.Hn!==e&&(this.p===null&&(this.p=new oi),this.p.Hn=e)}get Ci(){return this.p!==null?this.p.Ci:null}set Ci(e){this.Ci!==e&&(this.p===null&&(this.p=new oi),this.p.Ci=e)}get qn(){return this.p!==null?this.p.qn:null}set qn(e){this.qn!==e&&(this.p===null&&(this.p=new oi),this.p.qn=e)}raiseChanged(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}t(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}Wn(e,t,i,s){const n=this.se;if(n.i(e,t,i,s),this.tt!==1||this.Yt!==0){this.wi===null&&(this.wi=new Tt);const o=this.wi;o.Ri(),this.m0(o,e,t,i,s),o.vg(n)}}wA(e,t,i){return this.pickable===!1?!1:(i.nc(this.T),t?this.intersectsRect(e,i):this.containedInRect(e,i))}xA(e,t,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=e.distanceSquaredPoint(t);return i?S.distanceLineSegmentSquared(e.x,e.y,0,0,0,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,0,s.height,s.width,s.height)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,s.height,s.width,0)<=n||S.distanceLineSegmentSquared(e.x,e.y,s.width,0,0,0)<=n:e.distanceSquared(0,0)<=n&&e.distanceSquared(0,s.height)<=n&&e.distanceSquared(s.width,0)<=n&&e.distanceSquared(s.width,s.height)<=n}an(){return!0}containsPoint(e){const t=S.l();t.a(e),this.T.gt(t);const i=this.actualBounds;if(!i.isReal())return S.e(t),!1;const s=this.diagram;if(s!==null&&s.Hm){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),h=r/2,a=this.naturalBounds,l=this.getDocumentScale()*s.scale,u=1/l;if(a.width*l<o&&a.height*l<o){const c=z.contains(i.x-h*u,i.y-h*u,i.width+r*u,i.height+r*u,t.x,t.y);return S.e(t),c}}let n=!1;return(this instanceof yt||this instanceof dt?z.contains(i.x-5,i.y-5,i.width+10,i.height+10,t.x,t.y):i.containsPoint(t))&&(this.si&&!this.si.containsPoint(t)?n=!1:this.Lt!==null&&this.zi.containsPoint(e)?n=!0:n=this.fh(e)),S.e(t),n}fh(e){const t=this.naturalBounds;return z.contains(0,0,t.width,t.height,e.x,e.y)}containsRect(e){if(this.angle===0)return this.actualBounds.containsRect(e);const t=this.naturalBounds,i=z.V(0,0,t.width,t.height),s=this.T;let n=!1;const o=S.V(e.x,e.y);return i.containsPoint(s.$e(o))&&(o.i(e.x,e.bottom),i.containsPoint(s.$e(o))&&(o.i(e.right,e.bottom),i.containsPoint(s.$e(o))&&(o.i(e.right,e.y),i.containsPoint(s.$e(o))&&(n=!0)))),S.e(o),z.e(i),n}containedInRect(e,t){if(t===void 0)return e.containsRect(this.actualBounds);const i=this.naturalBounds,s=t;let n=!1;const o=S.V(0,0);return e.containsPoint(s.gt(o))&&(o.i(0,i.height),e.containsPoint(s.gt(o))&&(o.i(i.width,i.height),e.containsPoint(s.gt(o))&&(o.i(i.width,0),e.containsPoint(s.gt(o))&&(n=!0)))),S.e(o),n}intersectsRect(e,t){if(t===void 0&&(t=this.T,this.angle===0))return e.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=t,n=S.V(0,0),o=S.V(0,i.height),r=S.V(i.width,i.height),h=S.V(i.width,0);let a=!1;if(e.containsPoint(s.gt(n))||e.containsPoint(s.gt(o))||e.containsPoint(s.gt(r))||e.containsPoint(s.gt(h)))a=!0;else{const l=z.V(0,0,i.width,i.height),u=S.V(e.x,e.y);l.containsPoint(s.$e(u))?a=!0:(u.i(e.x,e.bottom),l.containsPoint(s.$e(u))?a=!0:(u.i(e.right,e.bottom),l.containsPoint(s.$e(u))?a=!0:(u.i(e.right,e.y),l.containsPoint(s.$e(u))&&(a=!0)))),S.e(u),z.e(l),a||(A.Mw(e,n,o)||A.Mw(e,o,r)||A.Mw(e,r,h)||A.Mw(e,h,n))&&(a=!0)}return S.e(n),S.e(o),S.e(r),S.e(h),a}getDocumentPoint(e,t){if(t===void 0&&(t=new S),e instanceof B){const i=e,s=this.naturalBounds;return t.i(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Us.gt(t),t}else return t.set(e),this.Us.gt(t),t}getDocumentBounds(e){e===void 0&&(e=new z);const t=this.naturalBounds,i=this.Us,s=S.V(0,0).T(i);return e.i(s.x,s.y,0,0),s.i(t.width,0).T(i),e.unionNoCheck(s.x,s.y,0,0),s.i(t.width,t.height).T(i),e.unionNoCheck(s.x,s.y,0,0),s.i(0,t.height).T(i),e.unionNoCheck(s.x,s.y,0,0),S.e(s),e}getDocumentAngle(){return this.Us.ZD()}getDocumentScale(){if(this.p0()===!1)return this.da;const e=this.tt;return this.panel!==null?e*this.panel.getDocumentScale():e}getLocalPoint(e,t){return t===void 0&&(t=new S),t.a(e),this.Us.$e(t),t}getNearestIntersectionPoint(e,t,i){return this.Jc(e.x,e.y,t.x,t.y,i)}Jc(e,t,i,s,n){const o=this.T,r=1/(o.m11*o.m22-o.m12*o.m21),h=o.m22*r,a=-o.m12*r,l=-o.m21*r,u=o.m11*r,c=r*(o.m21*o.dy-o.m22*o.dx),d=r*(o.m12*o.dx-o.m11*o.dy),f=e*h+t*l+c,m=e*a+t*u+d,p=i*h+s*l+c,y=i*a+s*u+d;n.i(0,0);const x=this.naturalBounds,P=A.gl(0,0,x.width,x.height,f,m,p,y,n);return n.T(o),P}ht(e,t,i,s){if(this.To()===!1)return;const n=this.Wr,o=n.right+n.left,r=n.top+n.bottom;e=Math.max(e-o,0),t=Math.max(t-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const h=this.angle;let a=0;const l=this.desiredSize,u=this.y0();h===90||h===270?(e=isFinite(l.height)?l.height+u:e,t=isFinite(l.width)?l.width+u:t):(e=isFinite(l.width)?l.width+u:e,t=isFinite(l.height)?l.height+u:t);let c=i||0,d=s||0;const f=this instanceof rt;switch(this.zs(!0)){case 0:c=0,d=0,f&&(e=1/0,t=1/0);break;case 2:isFinite(e)&&e>i&&(c=e),isFinite(t)&&t>s&&(d=t);break;case 5:isFinite(e)&&e>i&&(c=e),d=0,f&&(t=1/0);break;case 4:isFinite(t)&&t>s&&(d=t),c=0,f&&(e=1/0);break}const m=this.maxSize,p=this.minSize;c>m.width&&p.width<m.width&&(c=m.width),d>m.height&&p.height<m.height&&(d=m.height),i=Math.max(c,p.width),s=Math.max(d,p.height),m.width<i&&(i=Math.min(p.width,i)),m.height<s&&(s=Math.min(p.height,s)),e=Math.min(m.width,e),t=Math.min(m.height,t),e=Math.max(i,e),t=Math.max(s,t),(h===90||h===270)&&(a=e,e=t,t=a,a=i,i=s,s=a),this.se.Pt(),this.Wu(e,t,i,s),this.se.u(),this.se.isReal()||b.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.se.toString()),this.ue(!1)}Wu(e,t,i,s){}Xs(){return!1}Bt(e,t,i,s,n){this.$c();const o=z.l();o.a(this.Ni),this.Ni.Pt(),this._e()===!1?this.Ni.i(e,t,i,s):this.uh(e,t,i,s),this.Ni.u(),n===void 0?this.si=null:this.si=n;let r=!1;if(n!==void 0)r=!0;else{let h=this.panel;if(h!==null&&h.$r()&&(h=h.panel),h!==null){const a=h.zi,l=this.measuredBounds,u=t+l.height,c=e+l.width;if(r=!(0<=e+.05&&c<=a.width+.05&&0<=t+.05&&u<=a.height+.05),this instanceof Kt){const d=this.naturalBounds;(this.w0>d.height||this.ui>d.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.Ni.isReal()||b.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Ni.toString()),this.Ju(o,this.Ni),this.Jn(!1),z.e(o)}uh(e,t,i,s){}commonArrange(e,t,i,s){if(this.Ni.i(e,t,i,s),this.desiredSize.isReal())return;const n=this.se,o=this.Wr,r=o.right+o.left,h=o.top+o.bottom,a=n.width+r,l=n.height+h;i+=r,s+=h;let u=this.zs(!0);switch(a===i&&l===s&&(u=0),u){case 0:(a>i||l>s)&&(this.ue(!0),this.ht(a>i?i:a,l>s?s:l,0,0));break;case 2:this.ue(!0),this.ht(i,s,0,0);break;case 5:this.ue(!0),this.ht(i,l,0,0);break;case 4:this.ue(!0),this.ht(a,s,0,0);break}}Ju(e,t){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.w2(!0),this.S(),!e.equalsApproxClose(t)&&(i.dh(),this.x0(i)))}x0(e){this.portId!==null&&(e.w2(!0),e instanceof st&&e.bA(this))}get shadowVisible(){return this.p!==null?this.p.b0:null}set shadowVisible(e){const t=this.shadowVisible;t!==e&&(this.Kt().b0=e,this.Ve(!0),this.S(),this.t("shadowVisible",t,e))}HR(e,t){const i=this.naturalBounds,s=this.hh,n=s.m11,o=s.m21,r=s.dx,h=s.m12,a=s.m22,l=s.dy;let u=0,c=0,d=u,f=c;u=d*n+f*o+r,c=d*h+f*a+l;let m=u,p=c,y=0,x=0;d=i.width+t,f=0,u=d*n+f*o+r,c=d*h+f*a+l;let P=Math.min(m,u),k=Math.min(p,c);y=Math.max(m+y,u)-P,x=Math.max(p+x,c)-k,m=P,p=k,d=i.width+t,f=i.height+t,u=d*n+f*o+r,c=d*h+f*a+l,P=Math.min(m,u),k=Math.min(p,c),y=Math.max(m+y,u)-P,x=Math.max(p+x,c)-k,m=P,p=k,d=0,f=i.height+t,u=d*n+f*o+r,c=d*h+f*a+l,P=Math.min(m,u),k=Math.min(p,c),y=Math.max(m+y,u)-P,x=Math.max(p+x,c)-k,m=P,p=k;const v=e.viewportBounds,N=v.x,M=v.y,C=v.width,F=v.height;return m>C+N||N>y+m||p>F+M||M>x+p}Ui(e,t){if(this.qR(e,t)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=e.globalAlpha,e.globalAlpha=s*i);let n="";this.filter!==""&&(n=e.filter,e.filter=this.filter);const o=this.T,r=this.panel;this.p0()===!0&&this.Bb();const h=this.part;let a=!1,l=0;if(h&&t.getRenderingHint("drawShadows")&&(a=h.isShadowed,a)){const p=h.shadowOffset;l=Math.max(p.y,p.x)*t.scale*t.Vi}const u=this instanceof rt&&this.$r(),c=this.Ni;if(u&&(this.kA(a,e,!1,r),this.WR(e,t),this.PA(a,e,!1,r),this.SA(a,e,!1)),u||!u&&(c.width===0||c.height===0||isNaN(c.x)||isNaN(c.y))){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}const d=this.Xs();if(!t.ia&&d&&this.HR(t,l)){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}let f=(this.n&256)!==0;if(e.clipInsteadOfFill&&(f=!1),this instanceof Kt&&(e.font=this.font),f){const p=r.an()?r.naturalBounds:r.actualBounds;let y=Math.max(c.x,p.x),x=Math.max(c.y,p.y),P=Math.min(c.right,p.right)-y,k=Math.min(c.bottom,p.bottom)-x;const v=this.si;if(v!==null&&(y=v.x,x=v.y,P=v.width,k=v.height),y>c.width+c.x||c.x>p.width+p.x){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}e.save(),e.beginPath(),e.rect(y,x,P,k),e.clip()}if(d){if(!h.isVisible()){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}if(a){const p=h.shadowOffset;e.shadowsSet(p.x*t.scale*this.scale*t.Vi,p.y*t.scale*this.scale*t.Vi,h.shadowBlur),e.shadowsOn(),e.shadowColor=h.shadowColor}}const m=this.naturalBounds;if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.kA(a,e,d,r),this.Lt!==null&&(e.commitTransform(),this.Vb(e,m,c)),this.PA(a,e,d,r),this.gh(e,t),this.SA(a,e,d),f&&(e.restore(),e.clearContextCache(this instanceof rt)),!o.Yk()){const p=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*p,-o.m12*p,-o.m21*p,o.m11*p,p*(o.m21*o.dy-o.m22*o.dx),p*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n)}kA(e,t,i,s){e&&this.shadowVisible===!0?t.shadowsOn():e&&this.shadowVisible===!1&&t.shadowsOff(),e&&this.zb(s)&&this.shadowVisible===null&&t.shadowsOff()}PA(e,t,i,s){e&&(this.Lt!==null||this.zb(s))?(this.Xb(!0),this.shadowVisible===null&&t.shadowsOff()):this.Xb(!1)}SA(e,t,i){e&&this.b2()===!0&&t.shadowsOn(),i&&e&&t.shadowsOff()}JR(e,t,i){const s=this.part;let n=!1;s&&e.getRenderingHint("drawShadows")&&(n=s.isShadowed),t.clipInsteadOfFill&&(n=!1),this.Xs()&&n&&t.shadowsOn(),n&&this.shadowVisible===!0?t.shadowsOn():n&&this.shadowVisible===!1&&t.shadowsOff();const o=this.panel;if(n&&this.zb(o)&&this.shadowVisible===null&&t.shadowsOff(),t.Zr){const r=e.computePixelRatio(),h=`drop-shadow(${t.shadowOffsetX/r}px ${t.shadowOffsetY/r}px ${t.shadowBlur/r/2}px ${t.shadowColor})`;this.background!==null&&i.Lt.setAttributeNS(null,"filter",h)}return n&&(this.Lt!==null||this.zb(o))?(this.Xb(!0),this.shadowVisible===null&&t.shadowsOff()):this.Xb(!1),n}$R(e,t,i,s){if(i.Zr){const n=t.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.k2(e,o)}s&&this.b2()===!0&&i.shadowsOn(),this.Xs()&&i.shadowsOff()}zb(e){return e===null?!1:(e.$r()&&(e=e.panel),e.b2()||(e.type===rt.Auto||e.type===rt.Spot)&&e.findMainElement()!==this)}k2(e,t){}Vb(e,t,i){const s=this.y0(),n=t.x,o=t.y,r=t.width+s,h=t.height+s;this.rn(e,this.Lt,!0,!1,t,i),this.Lt instanceof Ft&&this.Lt.type===3?(e.beginPath(),e.rect(n-s/2,o-s/2,r,h),e.fillContext(this.Lt,!1,null)):e.fillRect(n-s/2,o-s/2,r,h)}MA(e,t){let i=e.ZR(this);const s=e.ah!==null?e.ah:e.svg;if(i!==-1)if(i===0)if(s.Lt)s.Lt.after(t);else if(e.type===rt.Table){const n=s.getElementsByClassName("gojs-ts"),o=n.length!==0?n[0]:null;o!==null&&o.after(t)}else s.prepend(t);else{for(;i!==0&&!e.elt(i-1).isVisibleObject();)i--;if(i===0)s.prepend(t);else{const n=e.elt(i-1).svg;n!==null?n.after(t):s.appendChild(t)}}}qR(e,t){if(!(e instanceof ge))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.Ni;if(this.Xs()&&(!this.isVisible()||i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const s=this.panel,n=this.$u(e);if(this.Zc(e,t,n))return this.NA(this.svg),this.svg.parentElement!==null?(this.Xs()&&(e.lastDrawnPart=this.svg),!0):(this.Xs()?(e.lastDrawnPart!==null?e.lastDrawnPart.after(this.svg):e.diagramGroup.prepend(this.svg),e.lastDrawnPart=this.svg):s&&this.MA(s,this.svg),!0);if(this.Ve(!1),this.Xs()&&this.isShadowed){const m=this.shadowOffset;e.shadowsSet(m.x*t.scale*this.scale*t.Vi,m.y*t.scale*this.scale*t.Vi,this.shadowBlur),e.shadowsOn(),e.shadowColor=this.shadowColor}this instanceof Kt&&(e.font=this.font),e.currentElement=null;const o=this.T,r=this instanceof rt,h=this instanceof rt?this.$r():!1,a=this.svg;if(this.p0()===!0&&this.Bb(),e.setCurrentTransform(1,0,0,1,0,0),e.outerGroup=!1,n)if(e.outerGroup=!0,r&&h)e.newGroup(1,0,0,1,0,0),this.svg=e.lastCreatedElement;else if(r&&this.isClipping){const m=this.findMainElement();let p=0,y=0;m!==null&&(p=m.actualBounds.x,y=m.actualBounds.y),e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+p,o.dy+y),this.svg=e.lastCreatedElement,m!==null&&e.createOrUpdateClipGroup(this,m.actualBounds),e.currentElement=e.lastCreatedElement}else r?(e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=e.lastCreatedElement):e.newGroup(1,0,0,1,0,0);const l=this.naturalBounds;r||e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(r?(h&&e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Vb(e,l,i),h&&e.setCurrentTransform(1,0,0,1,0,0)):(e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Vb(e,l,i)),e.currentElement.Lt=e.lastCreatedElement,e.currentElement.prepend(e.lastCreatedElement));const u=this.JR(t,e,e.currentElement);this.gh(e,t),r&&e.endGroup(),e.outerGroup&&e.endGroup();const c=e.surface.Gu,d=r?this.svg:e.currentElement;if(a!==null&&a.parentNode!==null&&d!==a&&a.parentNode===this.panel.svg){const m=this.svg.getAttribute("filter");return m!==null&&d.setAttribute("filter",m),this.filter!==""&&d.setAttributeNS(null,"filter",this.filter),a.replaceWith(d),this.svg=d,d!==null&&this.k0(e,s,i,d),!0}if(this.svg=d,c!==null&&d===null&&e.dummyGroup(),d===null)return!0;this.k0(e,s,i,d),this.$R(d,t,e,u);const f=this.Xs()?this.opacity*e.globalAlpha:this.opacity;if(f!==1&&d.setAttributeNS(null,"opacity",f.toString()),this.filter!==""&&d.setAttributeNS(null,"filter",this.filter),this.Xs()){if(a!==null&&d!==a&&a.parentNode===e.diagramGroup){const m=a.getAttribute("filter");m!==null&&d.setAttribute("filter",m),a.replaceWith(d)}else e.lastDrawnPart?e.lastDrawnPart.after(d):e.diagramGroup.prepend(d);e.lastDrawnPart=d}else s!==null&&this.MA(s,d);return c!==null&&c(this,d),this.NA(d),!0}NA(e){const t=this,i=e.dataset;t instanceof vt&&(t.portId!==null&&(i.portId=t.portId),t instanceof rt&&(isNaN(t.itemIndex)||(i.itemIndex=t.itemIndex.toString()),t instanceof Lt&&(i.className=b.Dn(t),t.key!==void 0&&(i.key=t.key.toString()),t.containingGroup!==null&&(i.group=t.containingGroup.key.toString()),t instanceof at&&(t.fromNode!==null&&t.fromNode.key!==void 0&&(i.fromKey=t.fromNode.key.toString()),t.fromPortId!==""&&(i.fromPortId=t.fromPortId),t.toNode!==null&&t.toNode.key!==void 0&&(i.toKey=t.toNode.key.toString()),t.toPortId!==""&&(i.toPortId=t.toPortId)))))}k0(e,t,i,s){let n=(this.n&256)!==0;if(e.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=t.an()?t.naturalBounds:t.actualBounds;let r=Math.max(i.x,o.x),h=Math.max(i.y,o.y),a=Math.min(i.right,o.right)-r,l=Math.min(i.bottom,o.bottom)-h;const u=this.si;u!==null&&(r=u.x,h=u.y,a=u.width,l=u.height);const c=new z(r,h,Math.max(a,0),Math.max(l,0));this instanceof rt&&this.T.copy().bw().vg(c),s.setAttributeNS(null,"clip-path",`path('      M ${c.x},${c.y}       L ${c.width+c.x} ${c.y}       L ${c.width+c.x} ${c.height+c.y}       L ${c.x} ${c.height+c.y} z') view-box`)}QR(){if(this.svg===null)return;const e=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),t=this.svg.ownerDocument;if(e!==null)for(const i of e){const s=t.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}WR(e,t){const i=this.Ni,s=this.zi,n=this.Lt;n!==null&&e.commitTransform(),n!==null&&(this.rn(e,n,!0,!1,s,i),n instanceof Ft&&n.type===3?(e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillContext(n,!1,null)):e.fillRect(i.x,i.y,i.width,i.height)),this.gh(e,t)}gh(e,t){}Qc(){this.Ve(!0)}Zc(e,t,i){const s=this.svg;if(this._R()){if(this.Qc(),this.Ve(!1),s===null)return!1;const u=s.getAttribute("clip-path");if(u!==null&&u.includes("url")){const c=e.svg.getElementById(u.split("#")[1].slice(0,-1));c!==null&&c.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.T,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof rt,h=r?this.$r():!1;if(!(r&&h))if(this instanceof be){const u=this.Yb;e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),u!==null&&e.amendImageTransform(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7]),i?s.lastElementChild.setAttributeNS(null,"transform",e.getCurrentTransform()):s.setAttributeNS(null,"transform",e.getCurrentTransform())}else if(i&&!r)if(this instanceof dt){const u=s.getElementsByTagName("path");for(let c=0;c<u.length;c++)u[c].setAttributeNS(null,"transform",o)}else if(this instanceof Kt){const u=s.getElementsByTagName("text"),c=typeof this.stroke=="string"?this.stroke:null;for(let d=0;d<u.length;d++)u[d].setAttributeNS(null,"transform",o),c&&u[d].setAttributeNS(null,"fill",c)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.ah){const u=this.findMainElement(),c=u!==null?u.actualBounds.x:0,d=u!==null?u.actualBounds.y:0;this.ah.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-c+", "+-d+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+c)+", "+(n.dy+d)+")")}else s.setAttributeNS(null,"transform",o);const a=this.Xs()?this.opacity*e.globalAlpha:this.opacity;a===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",a.toString()),e.setCurrentTransform(1,0,0,1,0,0);const l=this.ah?this.ah:this.Ub;if(this.background!==null||l.Lt!==void 0){const u=l.Lt;if(this.background===null)e.removeOldGradient(this,l.Lt,"fill"),l.Lt.remove(),l.Lt=void 0;else{if((h||i&&!(this instanceof rt))&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Vb(e,this.naturalBounds,this.actualBounds),l.Lt){e.removeOldGradient(this,l.Lt,"fill");const c=l.Lt.getAttribute("filter");c!==null&&e.lastCreatedElement.setAttribute("filter",c),l.Lt.replaceWith(e.lastCreatedElement)}else l.prepend(e.lastCreatedElement);l.Lt=e.lastCreatedElement}u&&e.removeOldGradient(this,u,"fill")}return this.k0(e,this.panel,this.actualBounds,s),!0}$u(e){if(this.background!==null)return!0;let t=(this.n&256)!==0;return e.clipInsteadOfFill&&(t=!1),!!t}static TE(e,t,i,s,n,o,r){let h=.001;const a=o.length;e.moveTo(t,i);let l=s-t;const u=n-i;l===0&&(l=.001);const c=u/l;let d=Math.sqrt(l*l+u*u),f=0,m=!0;h=o[f%a];let p=r!==0;for(;d>=.1;){if(p){for(h=o[f++%a],h-=r;h<0;)h+=o[f++%a],m=!m;p=!1}else h=o[f++%a];h>d&&(h=d);let y=Math.sqrt(h*h/(1+c*c));l<0&&(y=-y),t+=y,i+=c*y,m?e.lineTo(t,i):e.moveTo(t,i),d-=h,m=!m}}rn(e,t,i,s,n,o){let r=1,h=1;if(typeof t=="string"){i?e.fillStyle=t:e.strokeStyle=t;return}else if(t.type===1){i?e.fillStyle=t.color:e.strokeStyle=t.color;return}let a;const l=this.y0();r=n.width,h=n.height,s?(r=o.width,h=o.height):i||(r+=l,h+=l);const u=e instanceof Ci;if(u&&t.cn&&(t.type===4||t._c===r&&t.Gb===h))a=t.cn;else{let c=0,d=0,f=0,m=0,p=0,y=0,x=0,P=0;if(s?(x=o.x,P=o.y):i||(x-=l/2,P-=l/2),c=t.start.x*r+t.start.offsetX+x,d=t.start.y*h+t.start.offsetY+P,f=t.end.x*r+t.end.offsetX+x,m=t.end.y*h+t.end.offsetY+P,t.type===2)a=e.createLinearGradient(c,d,f,m);else if(t.type===3)y=isNaN(t.endRadius)?Math.max(r,h)/2:t.endRadius,isNaN(t.startRadius)?(p=0,y=Math.max(r,h)/2):p=t.startRadius,a=e.createRadialGradient(c,d,p,f,m,y);else if(t.type===4)try{a=e.createPattern(t.pattern,"repeat")}catch{a=null}else b.Zi(t.type,"Brush type");if(t.type!==4){const k=t.colorStops;if(k!==null){const v=k.iterator;for(;v.next();)a.addColorStop(v.key,v.value)}}if(u&&(t.cn=a,a!==null&&(t._c=r,t.Gb=h),a===null&&t.type===4&&t._c!==-1)){t._c=-1;const k=this.diagram;k!==null&&t._c===-1&&b.ir(()=>{k.redraw()},600)}}i?e.fillStyle=a:e.strokeStyle=a}isContainedBy(e){return e instanceof rt?this.tv(this,e):!1}tv(e,t){if(e===t||t===null)return!1;let i=e.panel;for(;i!==null;){if(i===t)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const e=this.panel;return e!==null?e.isVisibleObject():!0}isEnabledObject(){let e=this instanceof rt?this:this.panel;for(;e!==null&&e.isEnabled;)e=e.panel;return e===null}get enabledChanged(){return this.p!==null?this.p.P0:null}set enabledChanged(e){const t=this.enabledChanged;t!==e&&(e!==null&&b.k(e,vt,"enabledChanged"),this.Kt().P0=e,this.t("enabledChanged",t,e))}Bb(){if(this.Kb()===!0){const e=this.qr;if(e.Ri(),!this.Ni.isReal()||!this.se.isReal()){this.Zu(!1);return}if(e.Fs(this.Ni.x-this.se.x,this.Ni.y-this.se.y),this.scale!==1||this.angle!==0){const t=this.naturalBounds;this.m0(e,t.x,t.y,t.width,t.height)}this.Zu(!1),this.ka(!0)}if(this.p0()===!0){const e=this.panel;if(e===null)this.hh.set(this.qr),this.da=this.scale;else if(e.Us!==null){const t=this.hh;t.Ri(),e.an()?t.nc(e.hh):e.panel!==null&&t.nc(e.panel.hh),t.nc(this.qr),this.da=this.scale*e.da}this.ka(!1)}}m0(e,t,i,s,n){if(this.tt!==1&&e.tt(this.tt),this.Yt===0)return;const o=S.l();o.setSpot(t,i,s,n,B.Center),e.cs(this.Yt,o.x,o.y),S.e(o)}c(e){if(this.To())return;e===void 0&&(e=!1),this.ue(!0),this.Jn(!0);const t=this.panel;t!==null&&!e&&t.c()}tf(){this.To()||(this.ue(!0),this.Jn(!0))}ef(e){if(this._e())return;const t=this.panel;!e&&t!==null&&t.c(),this.Jn(!0)}$c(){this.Kb()===!1&&(this.Zu(!0),this.ka(!0))}P2(){this.ka(!0)}S(){const e=this.part;e!==null&&e.S()}zs(e){const t=this.stretch,i=this.panel;if(i===null)return this.Oo(t===1?0:t,e);if(i.type===rt.Table)return this.S0(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),e);if(i.type===rt.Auto&&i.findMainElement()===this)return this.Oo(2,e);if(t===1){if(i.type===rt.Spot&&i.findMainElement()===this)return this.Oo(2,e);const s=i.defaultStretch;return s===1?this.Oo(0,e):this.Oo(s,e)}return this.Oo(t,e)}S0(e,t,i){const s=this.stretch;if(s!==1)return this.Oo(s,i);let n=null,o=null;switch(e.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(t.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.Oo(2,i):n===!0?this.Oo(5,i):o===!0?this.Oo(4,i):this.Oo(0,i)}Oo(e,t){if(t)return e;if(e===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(e===5)return 0;if(e===2)return 4}else{if(e===4)return 0;if(e===2)return 5}if(n)if(o!==90&&o!==270){if(e===4)return 0;if(e===2)return 5}else{if(e===5)return 0;if(e===2)return 4}return e}get segmentOrientation(){return this.Ot!==null?this.Ot.M0:0}set segmentOrientation(e){const t=this.segmentOrientation;t!==e&&(this.Ot===null&&(this.Ot=new Je),this.Ot.M0=e,this.c(),this.t("segmentOrientation",t,e),e===0&&(this.angle=0))}iv(){this.segmentOrientation=21}get segmentIndex(){return this.Ot!==null?this.Ot.N0:-1/0}set segmentIndex(e){e=Math.round(e);const t=this.segmentIndex;t!==e&&(this.Ot===null&&(this.Ot=new Je),this.Ot.N0=e,this.c(),this.t("segmentIndex",t,e))}get segmentFraction(){return this.Ot!==null?this.Ot.C0:0}set segmentFraction(e){e<0?e=0:e>1&&(e=1);const t=this.segmentFraction;t!==e&&(this.Ot===null&&(this.Ot=new Je),this.Ot.C0=e,this.c(),this.t("segmentFraction",t,e))}get segmentOffset(){return this.Ot!==null?this.Ot.L0:S.xo}set segmentOffset(e){const t=this.segmentOffset;t.equals(e)||(e=e.P(),this.Ot===null&&(this.Ot=new Je),this.Ot.L0=e,this.c(),this.t("segmentOffset",t,e))}get stretch(){return this.p!==null?this.p.$n:1}set stretch(e){const t=this.stretch;t!==e&&(this.Kt().$n=e,this.c(),this.t("stretch",t,e))}get name(){return this.p!==null?this.p.St:""}set name(e){const t=this.name;t!==e&&(this.Kt().St=e,this.part!==null&&this.part.A0(),this.t("name",t,e))}get opacity(){return this.$t}set opacity(e){e<0?e=0:e>1&&(e=1);const t=this.opacity;if(t!==e){this.$t=e,this.t("opacity",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.S(s.Wh(s.actualBounds))}}get filter(){return this.d0}set filter(e){const t=this.filter;if(t!==e){this.d0=e,this.Ve(!0),this.t("filter",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.S(s.Wh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(e){const t=(this.n&1)!==0;if(t!==e){this.n=this.n^1,this.Qc(),this.t("visible",t,e);const i=this.panel;i!==null?i.c():this.Xs()&&this.Ei(e),this.S(),this.CA()}}get pickable(){return(this.n&2)!==0}set pickable(e){const t=(this.n&2)!==0;t!==e&&(this.n=this.n^2,this.t("pickable",t,e))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(e){const t=(this.n&4)!==0;t!==e&&(this.n=this.n^4,this.t("fromLinkableDuplicates",t,e))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(e){const t=(this.n&8)!==0;t!==e&&(this.n=this.n^8,this.t("fromLinkableSelfNode",t,e))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(e){const t=(this.n&16)!==0;t!==e&&(this.n=this.n^16,this.t("toLinkableDuplicates",t,e))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(e){const t=(this.n&32)!==0;t!==e&&(this.n=this.n^32,this.t("toLinkableSelfNode",t,e))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(e){const t=(this.n&64)!==0;t!==e&&(this.n=this.n^64,this.c(),this.t("isPanelMain",t,e))}get isActionable(){return(this.n&128)!==0}set isActionable(e){const t=(this.n&128)!==0;t!==e&&(this.n=this.n^128,this.t("isActionable",t,e))}get background(){return this.Lt}set background(e){const t=this.background;t!==e&&(e!==null&&Ft.Qu(e,"GraphObject.background"),e instanceof Ft&&e.u(),this.Lt=e,this.S(),this.t("background",t,e))}b2(){return(this.n&512)!==0}Xb(e){e?this.n|=512:this.n&=-513}Wc(){return(this.n&1024)!==0}S2(e){e?this.n|=1024:this.n&=-1025}Kb(){return(this.n&2048)!==0}Zu(e){e?this.n|=2048:this.n&=-2049}p0(){return(this.n&4096)!==0}ka(e){e?this.n|=4096:this.n&=-4097}To(){return(this.n&8192)!==0}ue(e){e?this.n|=8192:this.n&=-8193}_e(){return(this.n&16384)!==0}Jn(e){e?this.n|=16384:this.n&=-16385}_R(){return(this.n&32768)!==0}Ve(e){e?this.n|=32768:this.n&=-32769}get part(){if(this.Xs())return this;if(this.Jr!==null)return this.Jr;let e=this;for(e=e.panel;e;){if(e instanceof Lt)return this.Jr=e,e;e=e.panel}return null}get svg(){return this.Ub}set svg(e){this.Ub=e}Au(){this.svg=null}get panel(){return this.Vs}Pa(e){this.Vs=e,this.svg!==null&&this.svg.remove()}get layer(){const e=this.part;return e!==null?e.layer:null}get diagram(){const e=this.part;return e!==null?e.diagram:null}get position(){return this.at}set position(e){const t=e.x,i=e.y,s=this.position,n=s.x,o=s.y;n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i))?(e=e.copy(),this.M2(e,n,o)&&this.t("position",new S(n,o),e.copy())):this.N2()}N2(){}M2(e,t,i){return this.at=e,this.ef(),!0}bc(e,t,i){this.at.x===e&&this.at.y===t||(this.at.i(e,t),this.$c())}get actualBounds(){return this.Ni}get scale(){return this.tt}set scale(e){const t=this.scale;t!==e&&(e<=0&&b.o("GraphObject.scale for "+this+" must be greater than zero, not: "+e),this.tt=e,this.c(),this.t("scale",t,e))}get angle(){return this.Yt}set angle(e){const t=this.angle;if(t!==e){if(e=e%360,e<0&&(e+=360),t===e)return;this.Yt=e,this.CA(),this.c(),this.t("angle",t,e)}}get desiredSize(){return this.is}set desiredSize(e){const t=e.width,i=e.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(e=e.P(),this.is=e,this.c(),this instanceof dt&&this.ee(),this.t("desiredSize",s,e),this.Wc())){const r=this.part;r!==null&&(this.ba(r,"width"),this.ba(r,"height"))}}get width(){return this.is.width}set width(e){const t=this.is.width;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.is,s=new ot(e,this.is.height).u();if(this.is=s,this.c(),this instanceof dt&&this.ee(),this.t("desiredSize",i,s),this.Wc()){const n=this.part;n!==null&&this.ba(n,"width")}}}get height(){return this.is.height}set height(e){const t=this.is.height;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.is,s=new ot(this.is.width,e).u();if(this.is=s,this.c(),this instanceof dt&&this.ee(),this.t("desiredSize",i,s),this.Wc()){const n=this.part;n!==null&&this.ba(n,"height")}}}get minSize(){return this.p!==null?this.p.pr:ot.sc}set minSize(e){const t=this.minSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e.u(),this.Kt().pr=e,this.c(),this.t("minSize",t,e))}get maxSize(){return this.p!==null?this.p.yr:ot.Bk}set maxSize(e){const t=this.maxSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=1/0),isNaN(e.height)&&(e.height=1/0),e.u(),this.Kt().yr=e,this.c(),this.t("maxSize",t,e))}get measuredBounds(){return this.se}get naturalBounds(){return this.zi}y0(){return 0}get margin(){return this.Wr}set margin(e){typeof e=="number"&&(e=new Ot(e));const t=this.Wr;t.equals(e)||(e=e.P(),this.Wr=e,this.c(),this.t("margin",t,e))}get T(){return this.Kb()===!0&&this.Bb(),this.qr}get Us(){return this.p0()===!0&&this.Bb(),this.hh}trigger(e,t,i){let s=null;return typeof e=="string"?s=new Si(e,t,i):s=e,s.be=this,this.ws===null&&(this.ws=new bt),this.ws.set(s.propertyName,s),this}get ws(){return this.p!==null?this.p.ws:null}set ws(e){this.ws!==e&&(this.Kt().ws=e)}get gr(){return this.p!==null?this.p.gr:0}set gr(e){this.gr!==e&&(this.Kt().gr=e)}get alignment(){return this.hi}set alignment(e){const t=this.alignment;t.equals(e)||(e.isNoSpot()&&!e.isDefault()&&b.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+e),e=e.P(),this.hi=e,this.ef(),this.t("alignment",t,e))}get column(){return this.Hr}set column(e){e=Math.round(e);const t=this.column;t!==e&&(e<0&&b.W(e,">= 0",vt,"column"),this.Hr=e,this.c(),this.t("column",t,e),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.p!==null?this.p.T0:1}set columnSpan(e){e=Math.round(e);const t=this.columnSpan;t!==e&&(e<1&&b.W(e,">= 1",vt,"columnSpan"),this.Kt().T0=e,this.c(),this.t("columnSpan",t,e))}get row(){return this.u0}set row(e){e=Math.round(e);const t=this.row;t!==e&&(e<0&&b.W(e,">= 0",vt,"row"),this.u0=e,this.c(),this.t("row",t,e),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.p!==null?this.p.D0:1}set rowSpan(e){e=Math.round(e);const t=this.rowSpan;t!==e&&(e<1&&b.W(e,">= 1",vt,"rowSpan"),this.Kt().D0=e,this.c(),this.t("rowSpan",t,e))}get spanAllocation(){return this.p!==null?this.p.F0:null}set spanAllocation(e){const t=this.spanAllocation;t!==e&&(e!==null&&b.k(e,vt,"spanAllocation"),this.Kt().F0=e,this.c(),this.t("spanAllocation",t,e))}get alignmentFocus(){return this.ju}set alignmentFocus(e){const t=this.alignmentFocus;t.equals(e)||(e=e.P(),this.ju=e,this.c(),this.t("alignmentFocus",t,e))}get portId(){return this.f0}set portId(e){const t=this.portId;if(t!==e){const i=this.part;i!==null&&!(i instanceof st)&&b.o("Cannot set portID on a Link: "+e);const s=i;t!==null&&s!==null&&s.C2(this),this.f0=e,e!==null&&s!==null&&(s.fn=!0,s.LA(this)),this.t("portId",t,e)}}Sa(){const e=this.part;if(e instanceof st&&(this.portId!==null||this===e.port)){const t=e.diagram;t!==null&&!t.undoManager.isUndoingRedoing&&e.bA(this)}}CA(){const e=this.diagram;e===null||e.undoManager.isUndoingRedoing||(this instanceof rt?this instanceof st?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Sa()}):this.Sa())}get toSpot(){return this.ct!==null?this.ct.ma:B.None}set toSpot(e){const t=this.toSpot;t.equals(e)||(e=e.P(),this.Be().ma=e,this.t("toSpot",t,e),this.Sa())}get toEndSegmentLength(){return this.ct!==null?this.ct.ya:10}set toEndSegmentLength(e){const t=this.toEndSegmentLength;t!==e&&(e<0&&b.W(e,">= 0",vt,"toEndSegmentLength"),this.Be().ya=e,this.t("toEndSegmentLength",t,e),this.Sa())}get toShortLength(){return this.ct!==null?this.ct.xa:0}set toShortLength(e){const t=this.toShortLength;t!==e&&(this.Be().xa=e,this.t("toShortLength",t,e),this.Sa())}get toLinkable(){return this.ct!==null?this.ct.R0:null}set toLinkable(e){const t=this.toLinkable;t!==e&&(this.Be().R0=e,this.t("toLinkable",t,e))}get toMaxLinks(){return this.ct!==null?this.ct.v0:1/0}set toMaxLinks(e){const t=this.toMaxLinks;t!==e&&(e<0&&b.W(e,">= 0",vt,"toMaxLinks"),this.Be().v0=e,this.t("toMaxLinks",t,e))}get fromSpot(){return this.ct!==null?this.ct.ga:B.None}set fromSpot(e){const t=this.fromSpot;t.equals(e)||(e=e.P(),this.Be().ga=e,this.t("fromSpot",t,e),this.Sa())}get fromEndSegmentLength(){return this.ct!==null?this.ct.pa:10}set fromEndSegmentLength(e){const t=this.fromEndSegmentLength;t!==e&&(e<0&&b.W(e,">= 0",vt,"fromEndSegmentLength"),this.Be().pa=e,this.t("fromEndSegmentLength",t,e),this.Sa())}get fromShortLength(){return this.ct!==null?this.ct.wa:0}set fromShortLength(e){const t=this.fromShortLength;t!==e&&(this.Be().wa=e,this.t("fromShortLength",t,e),this.Sa())}get fromLinkable(){return this.ct!==null?this.ct.O0:null}set fromLinkable(e){const t=this.fromLinkable;t!==e&&(this.Be().O0=e,this.t("fromLinkable",t,e))}get fromMaxLinks(){return this.ct!==null?this.ct.I0:1/0}set fromMaxLinks(e){const t=this.fromMaxLinks;t!==e&&(e<0&&b.W(e,">= 0",vt,"fromMaxLinks"),this.Be().I0=e,this.t("fromMaxLinks",t,e))}get cursor(){return this.p!==null?this.p.Sl:""}set cursor(e){const t=this.cursor;t!==e&&(b.s(e,"string",vt,"cursor"),this.Kt().Sl=e,this.t("cursor",t,e))}get click(){return this.p!==null?this.p.Cr:null}set click(e){const t=this.click;t!==e&&(e!==null&&b.k(e,vt,"click"),this.Kt().Cr=e,this.t("click",t,e))}get doubleClick(){return this.p!==null?this.p.Lr:null}set doubleClick(e){const t=this.doubleClick;t!==e&&(e!==null&&b.k(e,vt,"doubleClick"),this.Kt().Lr=e,this.t("doubleClick",t,e))}get contextClick(){return this.p!==null?this.p.Ar:null}set contextClick(e){const t=this.contextClick;t!==e&&(e!==null&&b.k(e,vt,"contextClick"),this.Kt().Ar=e,this.t("contextClick",t,e))}get mouseEnter(){return this.p!==null?this.p.vr:null}set mouseEnter(e){const t=this.mouseEnter;t!==e&&(e!==null&&b.k(e,vt,"mouseEnter"),this.Kt().vr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.p!==null?this.p.Or:null}set mouseLeave(e){const t=this.mouseLeave;t!==e&&(e!==null&&b.k(e,vt,"mouseLeave"),this.Kt().Or=e,this.t("mouseLeave",t,e))}get mouseOver(){return this.p!==null?this.p.Tr:null}set mouseOver(e){const t=this.mouseOver;t!==e&&(e!==null&&b.k(e,vt,"mouseOver"),this.Kt().Tr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.p!==null?this.p.Dr:null}set mouseHover(e){const t=this.mouseHover;t!==e&&(e!==null&&b.k(e,vt,"mouseHover"),this.Kt().Dr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.p!==null?this.p.Fr:null}set mouseHold(e){const t=this.mouseHold;t!==e&&(e!==null&&b.k(e,vt,"mouseHold"),this.Kt().Fr=e,this.t("mouseHold",t,e))}get mouseDragEnter(){return this.p!==null?this.p.E0:null}set mouseDragEnter(e){const t=this.mouseDragEnter;t!==e&&(e!==null&&b.k(e,vt,"mouseDragEnter"),this.Kt().E0=e,this.t("mouseDragEnter",t,e))}get mouseDragLeave(){return this.p!==null?this.p.U0:null}set mouseDragLeave(e){const t=this.mouseDragLeave;t!==e&&(e!==null&&b.k(e,vt,"mouseDragLeave"),this.Kt().U0=e,this.t("mouseDragLeave",t,e))}get mouseDrop(){return this.p!==null?this.p.Rr:null}set mouseDrop(e){const t=this.mouseDrop;t!==e&&(e!==null&&b.k(e,vt,"mouseDrop"),this.Kt().Rr=e,this.t("mouseDrop",t,e))}get actionDown(){return this.p!==null?this.p.B0:null}set actionDown(e){const t=this.actionDown;t!==e&&(e!==null&&b.k(e,vt,"actionDown"),this.Kt().B0=e,this.t("actionDown",t,e))}get actionMove(){return this.p!==null?this.p.V0:null}set actionMove(e){const t=this.actionMove;t!==e&&(e!==null&&b.k(e,vt,"actionMove"),this.Kt().V0=e,this.t("actionMove",t,e))}get actionUp(){return this.p!==null?this.p.z0:null}set actionUp(e){const t=this.actionUp;t!==e&&(e!==null&&b.k(e,vt,"actionUp"),this.Kt().z0=e,this.t("actionUp",t,e))}get actionCancel(){return this.p!==null?this.p.X0:null}set actionCancel(e){const t=this.actionCancel;t!==e&&(e!==null&&b.k(e,vt,"actionCancel"),this.Kt().X0=e,this.t("actionCancel",t,e))}get toolTip(){return this.p!==null?this.p.Ir:null}set toolTip(e){const t=this.toolTip;t!==e&&(this.Kt().Ir=e,this.t("toolTip",t,e))}get contextMenu(){return this.p!==null?this.p.Er:null}set contextMenu(e){const t=this.contextMenu;t!==e&&(this.Kt().Er=e,this.t("contextMenu",t,e))}findBindingPanel(){let e=this instanceof rt?this:this.panel;for(;e!==null;){if(e.L2())return e;e=e.panel}return null}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){return this.sf(e,t,i,s).makeTwoWay(),this}bindModel(e,t,i,s){return this.sf(e,t,i,s).ofModel(),this}bindObject(e,t,i,s,n){return this.sf(e,t,i,s).ofObject(n),this}theme(e,t,i,s,n){return this.mh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.mh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.mh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.mh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n=null;return typeof e=="string"?n=new Ke(e,t,i,s):n=e,this.Y0(n),n}mh(e,t,i,s,n){let o=null;return typeof e=="string"?o=new yi(e,t,i,s,n):o=e,this.Y0(o),o}Y0(e){e.be=this;const t=this.findBindingPanel();t!==null&&t.AA()&&b.o("Cannot add a Binding to a template that has already been copied: "+e),this.Ci===null&&(this.Ci=new J),this.Ci.add(e)}set(e){return Object.assign(this,e),this}attach(e){return vt.A2(this,e),this}apply(e){return e(this),this}setProperties(e){return kt.s0(this,e),this}static make(e,...t){let i=arguments,s=null,n=null;if(b.it(e))n=e;else if(typeof e=="string"){const r=vt.jb.get(e);b.it(r)?(i=Array.prototype.slice.call(i),s=r(i),b.G(s)||b.o('GraphObject.make invoked object builder "'+e+'", but it did not return an Object')):n=_.go[e]}s===null&&((n==null||!n.constructor)&&b.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+e),s=new n);let o=1;if(s instanceof kt&&i.length>1){const r=s,h=i[1];(typeof h=="string"||h instanceof HTMLDivElement)&&(r.AM(h),o++)}for(let r=o;r<i.length;r++){const h=i[r];h===void 0?b.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):vt.A2(s,h)}return s}static A2(e,t){if(typeof t=="number")vt.ev(e,t);else if(typeof t=="string")vt.sv(e,t);else if(t instanceof vt)e instanceof rt||b.o("A GraphObject can only be added to a Panel, not to: "+e),e.add(t);else if(t instanceof ee){let i;t.isRow&&b.it(e.getRowDefinition)?i=e.getRowDefinition(t.index):!t.isRow&&b.it(e.getColumnDefinition)&&(i=e.getColumnDefinition(t.index)),i instanceof ee?i.Hb(t):b.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(t instanceof Nt){const i=e;i.type=t}else if(t instanceof Ke)e instanceof vt||e instanceof ee?e.bind(t):b.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(t instanceof Si)e instanceof vt?e.trigger(t):b.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(t instanceof qt)e instanceof Mt&&e.type===4?e.figures.add(t):b.o("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(t instanceof pt)e instanceof qt?e.segments.add(t):b.o("A PathSegment can only be added to a PathFigure, not to: "+e);else if(t instanceof ne)e instanceof kt||e instanceof ut?e.layout=t:b.o("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];vt.A2(e,s)}else b.G(t)?vt.nv(e,t):b.o('Unknown initializer "'+t+'" for object being constructed by GraphObject.make: '+e)}static sv(e,t){if(e instanceof Kt)e.text=t;else if(e instanceof dt)e.figure=t;else if(e instanceof be)e.source=t;else if(e instanceof rt){const i=Nt.es.get(t);i!==null&&(e.type=i)}else if(e instanceof Ft){const i=b.Uh(We,t);i!==null?e.type=i:b.o("Unknown Brush type as an argument to GraphObject.make: "+t)}else if(e instanceof Mt){const i=b.Uh(ii,t);i!==null&&(e.type=i)}else if(e instanceof pt){const i=b.Uh(ki,t);i!==null&&(e.type=i)}}static ev(e,t){b.it(e.oi)?e.oi(t):b.er(e,t)}static nv(e,t){if(e instanceof Ft){const i=new fe;for(const s in t){const n=parseFloat(s);isNaN(n)?i[s]=t[s]:e.addColorStop(n,t[s])}kt.s0(e,i)}else if(e instanceof ee){if(t.row!==void 0){const s=t.row;(s==null||s===1/0||isNaN(s)||s<0)&&b.o("Must specify non-negative integer row for RowColumnDefinition "+t+", not: "+s),e.isRow=!0,e.index=s}else if(t.column!==void 0){const s=t.column;(s==null||s===1/0||isNaN(s)||s<0)&&b.o("Must specify non-negative integer column for RowColumnDefinition "+t+", not: "+s),e.isRow=!1,e.index=s}const i=new fe;for(const s in t)s==="row"||s==="column"||(i[s]=t[s]);kt.s0(e,i)}else kt.s0(e,t)}static build(e,t,...i){const s=vt.jb.get(e);if(b.it(s)){const n=s([e].concat(i));if(n instanceof vt)return t&&n.setProperties(t),n}b.o('GraphObject.build invoked object builder "'+e+'", but it did not return an Object')}static defineBuilder(e,t){b.s(e,"string",vt,"defineBuilder:name"),b.k(t,vt,"defineBuilder:func"),e.toLowerCase(),vt.jb.set(e,t)}static isBuilderDefined(e){return vt.jb.has(e)}static takeBuilderArgument(e,t,i){i===void 0&&(i=null);const s=e[1];return(b.it(i)?i(s):typeof s=="string")?(e.splice(1,1),s):(t===void 0&&b.o("no "+(b.it(i)?"satisfactory":"string")+" argument for GraphObject builder "+e[0]),t)}};g(vt,"None",0),g(vt,"Default",1),g(vt,"Fill",2),g(vt,"Vertical"),g(vt,"Horizontal"),g(vt,"Uniform",6),g(vt,"UniformToFill",7),g(vt,"FlipVertical",1),g(vt,"FlipHorizontal",2),g(vt,"FlipBoth",3),g(vt,"jb",new bt);let Ct=vt;Ct.Vertical=4,Ct.Horizontal=5,Ct.defineBuilder("Button",w=>{const e="#f5f5f5",t="#737373",i="#d4d4d4",s="#737373",n="#a3a3a3",o=2.76142374915397,r=2.761423749153969,h=new rt(rt.Auto,{isActionable:!0,enabledChanged:(a,l)=>{if(a instanceof rt){const u=a.findObject("ButtonBorder");if(u!==null)if(a._buttonFillNormal===void 0&&(a._buttonFillNormal=u.fill),l){let c=null;a.layer!==null&&a.diagram!==null&&a.isVisibleObject()&&(c=a.layer.findObjectAt(a.diagram.lastInput.documentPoint)),c===a||c!==null&&c.isContainedBy(a)?u.fill=a._buttonFillOver:u.fill=a._buttonFillNormal}else u.fill=a._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:i,_buttonStrokeOver:s,_buttonFillDisabled:n}).add(new dt("RoundedRectangle",{name:"ButtonBorder",spot1:new B(0,0,o,r),spot2:new B(1,1,-o,-r),parameter1:2,fill:e,stroke:t}));return h.mouseEnter=(a,l,u)=>{if(!l.isEnabledObject()||!(l instanceof rt))return;const c=l.findObject("ButtonBorder");c instanceof dt&&(l._buttonFillNormal===void 0&&(l._buttonFillNormal=c.fill),c.fill=l._buttonFillOver,l._buttonStrokeNormal===void 0&&(l._buttonStrokeNormal=c.stroke),c.stroke=l._buttonStrokeOver)},h.mouseLeave=(a,l,u)=>{if(!l.isEnabledObject()||!(l instanceof rt))return;const c=l.findObject("ButtonBorder");c instanceof dt&&(l._buttonFillNormal!==void 0&&(c.fill=l._buttonFillNormal),l._buttonStrokeNormal!==void 0&&(c.stroke=l._buttonStrokeNormal))},h}),Ct.defineBuilder("TreeExpanderButton",w=>{const e=Ct.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new dt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:ot.nu}).bindObject("figure","isTreeExpanded",(t,i)=>{const s=i.panel;return t?s._treeExpandedFigure:s._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,i)=>{let s=i.part;if(s instanceof yt&&(s=s.adornedPart),!(s instanceof st))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;t.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},e}),Ct.defineBuilder("SubGraphExpanderButton",w=>{const e=Ct.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new dt("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:ot.nu}).bindObject("figure","isSubGraphExpanded",(t,i)=>{const s=i.panel;return t?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),e.click=(t,i)=>{let s=i.part;if(s instanceof yt&&(s=s.adornedPart),!(s instanceof ut))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;t.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},e}),Ct.defineBuilder("ToolTip",w=>new yt(rt.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2)}).add(new dt("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new B(0,0,4,6),spot2:new B(1,1,-4,-4)}))),Ct.defineBuilder("ContextMenu",w=>new yt(rt.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new S(0,2)}).bindObject("background","",e=>e.adornedPart!==null&&e.hasPlaceholder()?null:"#f5f5f5")),Ct.defineBuilder("ContextMenuButton",w=>{const e=Ct.build("Button");e.stretch=5;const t=e.findObject("ButtonBorder");return t instanceof dt&&(t.figure="Rectangle",t.strokeWidth=0,t.spot1=new B(0,0,4,6),t.spot2=new B(1,1,-4,-4)),e}),Ct.defineBuilder("PanelExpanderButton",w=>{const e=Ct.takeBuilderArgument(w,"COLLAPSIBLE"),t=Ct.build("Button");t.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),t.add(new dt({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?t._buttonExpandedFigure:t._buttonCollapsedFigure,void 0,e));const i=t.findObject("ButtonBorder");return i instanceof dt&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),t.click=(s,n)=>{if(!(n instanceof rt))return;const o=n.diagram;if(o===null||o.isReadOnly)return;let r=n.findBindingPanel();if(r===null&&(r=n.part),r!==null){const h=r.findObject(e);h!==null&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),h.visible=!h.visible,o.commitTransaction("Collapse/Expand Panel"))}},t}),Ct.defineBuilder("CheckBoxButton",w=>{const e=Ct.takeBuilderArgument(w),t=Ct.build("Button",{desiredSize:new ot(14,14)});t.attach({"ButtonBorder.spot1":new B(0,0,1,1),"ButtonBorder.spot2":new B(1,1,-1,-1)});const i=new dt({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return e!==""&&i.bindTwoWay("visible",e),t.add(i),t.click=(s,n)=>{if(!(n instanceof rt))return;const o=s.diagram;if(o===null||o.isReadOnly||e!==""&&o.model.isReadOnly)return;s.handled=!0;const r=n.findObject("ButtonIcon");o.startTransaction("checkbox"),r!==null&&(r.visible=!r.visible),b.it(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},t}),Ct.defineBuilder("CheckBox",w=>{const e=Ct.takeBuilderArgument(w),t=Ct.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new Ot(0,1,0,0)},e),i=new rt("Horizontal",{isActionable:!0,cursor:t.cursor,margin:new Ot(1),mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonFillNormal:t._buttonFillNormal,_buttonStrokeNormal:t._buttonStrokeNormal,_buttonFillOver:t._buttonFillOver,_buttonStrokeOver:t._buttonStrokeOver,_buttonFillDisabled:t._buttonFillDisabled,_buttonClick:t.click});return i.add(t),t.mouseEnter=null,t.mouseLeave=null,t.click=null,i});class oi{constructor(){g(this,"fi");g(this,"St");g(this,"Hn");g(this,"Ci");g(this,"qn");g(this,"Ys");g(this,"Sl");g(this,"Cr");g(this,"Lr");g(this,"Ar");g(this,"vr");g(this,"Or");g(this,"Tr");g(this,"Dr");g(this,"Fr");g(this,"E0");g(this,"U0");g(this,"Rr");g(this,"B0");g(this,"V0");g(this,"z0");g(this,"X0");g(this,"Ir");g(this,"Er");g(this,"P0");g(this,"F0");g(this,"ws");g(this,"pr");g(this,"yr");g(this,"$n");g(this,"D0");g(this,"T0");g(this,"gr");g(this,"b0");g(this,"G0");g(this,"K0");this.fi=!1,this.St="",this.Hn=-1,this.Ci=null,this.qn=null,this.Ys=null,this.Sl="",this.Cr=null,this.Lr=null,this.Ar=null,this.vr=null,this.Or=null,this.Tr=null,this.Dr=null,this.Fr=null,this.E0=null,this.U0=null,this.Rr=null,this.B0=null,this.V0=null,this.z0=null,this.X0=null,this.Ir=null,this.Er=null,this.P0=null,this.F0=null,this.ws=null,this.pr=ot.sc,this.yr=ot.Bk,this.$n=1,this.D0=1,this.T0=1,this.gr=0,this.b0=null,this.G0=null,this.K0="category"}copy(){const e=new oi;return e.St=this.St,e.Hn=this.Hn,e.Ci=this.Ci,e.Ys=this.Ys,e.Sl=this.Sl,e.Cr=this.Cr,e.Lr=this.Lr,e.Ar=this.Ar,e.vr=this.vr,e.Or=this.Or,e.Tr=this.Tr,e.Dr=this.Dr,e.Fr=this.Fr,e.E0=this.E0,e.U0=this.U0,e.Rr=this.Rr,e.B0=this.B0,e.V0=this.V0,e.z0=this.z0,e.X0=this.X0,e.Ir=this.Ir,e.Er=this.Er,e.P0=this.P0,e.F0=this.F0,e.ws=this.ws,e.pr=this.pr.P(),e.yr=this.yr.P(),e.$n=this.$n,e.D0=this.D0,e.T0=this.T0,e.gr=this.gr,e.b0=this.b0,e.G0=this.G0,e.K0=this.K0,e}}class Ki{constructor(){g(this,"m");this.m=[1,0,0,1,0,0]}copy(){const e=new Ki;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}rotate(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return;this.translate(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,h=this.m[0]*-n+this.m[2]*s,a=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=h,this.m[3]=a,this.translate(-t,-i)}}class Mi{constructor(e){g(this,"type");g(this,"x1");g(this,"y1");g(this,"r1");g(this,"x2");g(this,"y2");g(this,"r2");g(this,"colors");g(this,"pattern");this.type=e,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(e,t){this.colors.push({offset:e,color:t})}}class Ni{constructor(e,t,i){g(this,"Tt");g(this,"li");g(this,"jr");g(this,"Gu");g(this,"T2");const s=t===void 0?_.document:t;this.jr=s,this.T2="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.Tt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.Tt.setAttributeNS(n,"xmlns",this.T2),this.Tt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.Gu=null,this.li=new ge(this,i)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",this.Tt.setAttributeNS(null,"width",i+"px"),this.Tt.setAttributeNS(null,"height",s+"px"),this.Tt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this.li.D2.firstElementChild.setAttributeNS(null,"width",i+"px"),this.li.D2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(e,t,i){const s=this.jr.createElementNS(this.T2,e);if(b.G(t))for(const n in t)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,t[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.Tt.getBoundingClientRect()}focus(){this.Tt.focus()}get width(){return this.Tt.width.baseVal.value}set width(e){this.Tt.setAttribute("width",e+"px")}get height(){return this.Tt.height.baseVal.value}set height(e){this.Tt.setAttribute("height",e+"px")}dispose(){this.jr=null}get style(){return this.Tt.style}}class ge{constructor(e,t){g(this,"nf");g(this,"of");g(this,"un");g(this,"Li");g(this,"ze");g(this,"fillStyle");g(this,"font");g(this,"globalAlpha");g(this,"lineCap");g(this,"lineDashOffset");g(this,"lineJoin");g(this,"lineWidth");g(this,"miterLimit");g(this,"shadowBlur");g(this,"shadowColor");g(this,"shadowOffsetX");g(this,"shadowOffsetY");g(this,"strokeStyle");g(this,"textAlign");g(this,"imageSmoothingEnabled");g(this,"clipInsteadOfFill");g(this,"lastCreatedElement");g(this,"rf");g(this,"lf");g(this,"surface");g(this,"svg");g(this,"D2");g(this,"TA");g(this,"qb");g(this,"Io");g(this,"ph");g(this,"Ma");g(this,"currentElement");g(this,"clipPathGroup");g(this,"diagramGroup");g(this,"lastDrawnPart");g(this,"currentPath");g(this,"outerGroup");g(this,"pathAttributes");g(this,"Zr");g(this,"kr");g(this,"filter");g(this,"partClipRect");if(this.surface=e,this.svg=e.Tt,this.rf=[],this.lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.Zr=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.un=0,this.lastCreatedElement=null,this.currentElement=null,this.Li=[],this.pathAttributes={},this.qb=!1,this.Io=null,this.ph=0,this.ze=new Ki,e.jr===null||e.jr===void 0)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=K.pw++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:e.width,height:e.height};s.appendChild(this.makeElement("rect",n)),this.D2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")"),this.TA={},this.kr=!!t,this.filter="",this.partClipRect=null}setDiagramPosScale(e,t,i,s,n,o){this.diagramGroup===void 0?this.newGroup(e,t,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+e+", "+t+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(e,t,i,s,n,o,r,h){const a=2*Math.PI,l=1e-6,u=a-l,c=i*Math.cos(s),d=i*Math.sin(s),f=e+c,m=t+d,p=o?0:1;let y=o?s-n:n-s;(Math.abs(r-f)>l||Math.abs(h-m)>l)&&this.Li.push(["L",f,+m]),y<0&&(y=y%a+a),y>u?(this.Li.push(["A",i,i,0,1,p,e-c,t-d]),this.Li.push(["A",i,i,0,1,p,f,m])):y>l&&this.Li.push(["A",i,i,0,+(y>=Math.PI),p,e+i*Math.cos(n),t+i*Math.sin(n)])}beginPath(){this.Li=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(e){this.ov(this.Li,this.ze,e||0)}bezierCurveTo(e,t,i,s,n,o){this.Li.push(["C",e,t,i,s,n,o])}clearRect(e,t,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Li.push(["z"])}createLinearGradient(e,t,i,s){const n=new Mi("linear");return n.x1=e,n.y1=t,n.x2=i,n.y2=s,n}createPattern(e,t){let i="";e instanceof HTMLCanvasElement&&(i=e.toDataURL()),e instanceof HTMLImageElement&&(i=e.getAttribute("src"));const s=this.TA;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+K.pw++,o={width:e.width,height:e.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:e.width,height:e.height,href:i},h=this.makeElement("pattern",o);return h.appendChild(this.makeElement(kt.img,r)),this.svg.appendChild(h),s[i]=n,"url(#"+n+")"}createRadialGradient(e,t,i,s,n,o){const r=new Mi("radial");return r.x1=e,r.y1=t,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(e,t,i,s,n,o,r,h){const a=r/i,l=h/s;(n!==0||o!==0)&&this.ze.translate(n,o),(a!==1||l!==1)&&this.ze.scale(a,l),(e!==0||t!==0)&&this.ze.translate(-e,-t)}drawImage(e,t,i,s,n,o,r,h,a){let l="";e instanceof HTMLCanvasElement&&(l=e.toDataURL()),e instanceof HTMLImageElement&&(l=e.getAttribute("src"));const u=e instanceof HTMLImageElement?e.naturalWidth:e.width,c=e instanceof HTMLImageElement?e.naturalHeight:e.height;s===void 0&&(o=t,r=i,h=s=u,a=n=c),s=s||0,n=n||0,o=o||0,r=r||0,h=h||0,a=a||0,this.amendImageTransform(t,i,s,n,o,r,h,a);const d={x:0,y:0,width:u||s,height:c||n,href:l};!A.z(s,h)||!A.z(n,a)?d.preserveAspectRatio="none":l.toLowerCase().indexOf(".svg")===-1&&l.toLowerCase().indexOf("data:image/svg")===-1&&(d.preserveAspectRatio="xMidYMid slice"),(t!==0||i!==0||s!==u||n!==c)&&(s+=t,n+=i,d["clip-path"]=`path('M ${t},${i} L ${s} ${i} L ${s} ${n} L ${t} ${n} z')`),this.processCommon(kt.img,d,this.ze),this._u(kt.img,d)}fill(e,t){e&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(e,t,i){this.clipInsteadOfFill?this.clip():this.fill(t,i)}createOrUpdateClipGroup(e,t){const i=this.newGroup(1,0,0,1,-t.x,-t.y);i.setAttributeNS(null,"class","spotClip"),e.ah=i}fillRect(e,t,i,s){this.addRect("fill",[e,t,i,s],this.ze)}fillBackground(e,t,i,s){const n={x:e,y:t,width:i,height:s};this.processCommon("fill",n,this.ze),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(e,t,i){this.addText("fill",[e,t,i],this.ze)}lineTo(e,t){this.Li.push(["L",e,t])}moveTo(e,t){this.Li.push(["M",e,t])}quadraticCurveTo(e,t,i,s){this.Li.push(["Q",e,t,i,s])}rect(e,t,i,s){this.Li.push(["M",e,t],["L",e+i,t],["L",e+i,t+s],["L",e,t+s],["z"])}restore(){this.ze=this.rf.pop(),this.Li=this.rf.pop();const e=this.rf.pop();this.fillStyle=e.fillStyle,this.font=e.font,this.globalAlpha=e.globalAlpha,this.lineCap=e.lineCap,this.lineDashOffset=e.lineDashOffset,this.lineJoin=e.lineJoin,this.lineWidth=e.lineWidth,this.miterLimit=e.miterLimit,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.strokeStyle=e.strokeStyle,this.textAlign=e.textAlign,this.partClipRect=e.partClipRect}save(){const e={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.rf.push(e);const t=[];for(let i=0;i<this.Li.length;i++)t.push(this.Li[i]);this.rf.push(t),this.rf.push(this.ze.copy())}setTransform(e,t,i,s,n,o){e===1&&t===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(e,t,i,s,n,o)}setCurrentTransform(e,t,i,s,n,o){this.ze.m=[e,t,i,s,n,o]}getCurrentTransform(){const e=this.ze.m;return"matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}scale(e,t){this.ze.scale(e,t)}translate(e,t){this.ze.translate(e,t)}transform(e,t,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(e,t,i,s){this.addRect("stroke",[e,t,i,s],this.ze)}makeElement(e,t,i){return this.surface.makeElement(e,t,i)}_u(e,t,i){const s=this.makeElement(e,t,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(e,t,i){if(e==="fill"?this.setFill(t):e==="stroke"&&this.setStroke(t),i!==null){const s=i.m;t.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(e){if(this.fillStyle instanceof Mi){e.fill=this.addGradient(this.fillStyle,!0);return}if(/^rgba\(/.test(this.fillStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.fill="rgb("+t[1]+","+t[2]+","+t[3]+")",e["fill-opacity"]=t[4]}else e.fill=this.fillStyle}setFillOrStrokeInPlace(e,t){const i=t?"fill":"stroke";if(this.fillStyle instanceof Mi){e.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0));return}if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),e.setAttributeNS(null,i+"-opacity",s[4])}else e.setAttributeNS(null,i,this.fillStyle)}setStroke(e){if(this.strokeStyle instanceof Mi)e.stroke=this.addGradient(this.strokeStyle,!1);else if(/^rgba\(/.test(this.strokeStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);e.stroke="rgb("+t[1]+","+t[2]+","+t[3]+")",e["stroke-opacity"]=t[4]}else e.stroke=this.strokeStyle;e["stroke-width"]=this.lineWidth,e["stroke-linecap"]=this.lineCap,e["stroke-linejoin"]=this.lineJoin,e["stroke-miterlimit"]=this.miterLimit,this.qb&&(e["stroke-dasharray"]=this.Io.toString(),e["stroke-dashoffset"]=this.ph)}addGradient(e,t){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(t?"fill":"stroke"):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const a=this.svg.getElementById(i);a!==null&&a.remove()}else i="GRAD"+K.pw++;let n;if(e.type==="linear"){const a={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",a)}else if(e.type==="radial"){const a={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,r1:e.r1,r2:e.r2,id:i};n=this.makeElement("radialGradient",a)}else b.o("invalid gradient");const o=e.colors,r=o.length,h=[];for(let a=0;a<r;a++){const l=o[a],u=l.color,c={offset:l.offset,"stop-color":u};if(/^rgba\(/.test(u)){const d=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(u);c["stop-color"]="rgb("+d[1]+","+d[2]+","+d[3]+")",c["stop-opacity"]=d[4]}h.push(c)}h.sort((a,l)=>a.offset>l.offset?1:-1);for(let a=0;a<r;a++)n.appendChild(this.makeElement("stop",h[a]));return this.svg.appendChild(n),"url(#"+i+")"}addRect(e,t,i){const s={x:t[0],y:t[1],width:t[2],height:t[3]};this.processCommon(e,s,i),this._u("rect",s)}addText(e,t,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:t[1],y:t[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(e,n,i),this._u("text",n,t[0])}ov(e,t,i){const s=this.rv(e),n=this.pathAttributes;if(n.clipPath){this.lf.length>1&&this.lf[this.lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,t),this.currentPath!==null){const o=this.currentPath;if(o.nodeName!=="g")for(const r in n)r!=="transform"&&o.setAttributeNS(null,r,n[r]);else{const r=o.getElementsByTagName("path");for(const h in n)h!=="transform"&&r[i].setAttributeNS(null,h,n[h])}}else this._u("path",n)}rv(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());t.push(n.join(" "))}return t.join(" ")}newGroup(e,t,i,s,n,o){const r=new Ki;r.m=[e,t,i,s,n,o];const h={};this.processCommon("g",h,r);const a=this._u("g",h);return this.lf.push(a),a}newGroup2(e){const t={};e&&(t.class=e);const i=this._u("g",t);return this.lf.push(i),i}endGroup(){return this.lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(e,t,i){this.nf=e,this.of=t,this.un=i}shadowsOff(){this.Zr=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.Zr=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.un}enableDash(e,t){this.qb=!0,this.Io=e,this.ph=t}disableDash(){this.qb=!1}clearContextCache(e){}setImageSmoothingEnabled(e){}rotate(e){this.ze.rotate(e*57.2958,0,0)}getImageData(e,t,i,s){return null}measureText(e){return null}removeOldGradient(e,t,i){const s=t.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(e){e.svg!==null&&e.svg.parentNode===this.diagramGroup&&e.svg.remove()}}class He{constructor(e,t,i,s){g(this,"Tt");g(this,"li");g(this,"jr");g(this,"Gu");const n=t===void 0?_.document:t;this.jr=n,this.Gu=null;const o=n.createElement("canvas");o.tabIndex=0,this.Tt=o,this.li=new Ci(o,i,s),kt.Qe.set(o,e)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(e,t){return this.Tt.toDataURL(e,t)}getBoundingClientRect(){return this.Tt.getBoundingClientRect()}focus(){this.Tt.focus()}get width(){return this.Tt.width}set width(e){this.Tt.width=e}get height(){return this.Tt.height}set height(e){this.Tt.height=e}dispose(){kt.Qe.delete(this.Tt),this.jr=null}get style(){return this.Tt.style}}const Hi=class Hi{constructor(e,t,i){g(this,"E");g(this,"Wb");g(this,"Jb");g(this,"$b");g(this,"clipInsteadOfFill");g(this,"nf");g(this,"of");g(this,"un");g(this,"Ma");g(this,"Zr");g(this,"kr");this.E=e.getContext?e.getContext("2d",t):null,this.E===null&&b.o("Browser does not support HTML Canvas Element"),this.Wb="",this.Jb="",this.$b="",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.un=0,this.Zr=!1,this.Ma=new Tt,this.kr=!!i}createOrUpdateClipGroup(e,t){}setImageSmoothingEnabled(e){this.E.imageSmoothingEnabled=e}get fillStyle(){return this.E.fillStyle}set fillStyle(e){this.$b!==e&&(this.E.fillStyle=e,this.$b=e)}get font(){return this.E.font}set font(e){this.Wb!==e&&(this.E.font=e,this.Wb=e)}get globalAlpha(){return this.E.globalAlpha}set globalAlpha(e){this.E.globalAlpha=e}get lineCap(){return this.E.lineCap}set lineCap(e){this.E.lineCap=e}get lineDashOffset(){return this.E.lineDashOffset}set lineDashOffset(e){this.E.lineDashOffset=e}get lineJoin(){return this.E.lineJoin}set lineJoin(e){this.E.lineJoin=e}get lineWidth(){return this.E.lineWidth}set lineWidth(e){this.E.lineWidth=e}get miterLimit(){return this.E.miterLimit}set miterLimit(e){this.E.miterLimit=e}get shadowBlur(){return this.E.shadowBlur}set shadowBlur(e){this.E.shadowBlur=e}get shadowColor(){return this.E.shadowColor}set shadowColor(e){this.E.shadowColor=e}get shadowOffsetX(){return this.E.shadowOffsetX}set shadowOffsetX(e){this.E.shadowOffsetX=e}get shadowOffsetY(){return this.E.shadowOffsetY}set shadowOffsetY(e){this.E.shadowOffsetY=e}get strokeStyle(){return this.E.strokeStyle}set strokeStyle(e){this.Jb!==e&&(this.E.strokeStyle=e,this.Jb=e)}get textAlign(){return this.E.textAlign}set textAlign(e){this.E.textAlign=e}get imageSmoothingEnabled(){return this.E.imageSmoothingEnabled}set imageSmoothingEnabled(e){this.E.imageSmoothingEnabled=e}get filter(){return this.E.filter}set filter(e){e===""?this.E.filter="none":this.E.filter=e}arc(e,t,i,s,n,o,r,h){this.E.arc(e,t,i,s,n,o)}beginPath(){this.E.beginPath()}endPath(){}bezierCurveTo(e,t,i,s,n,o){this.E.bezierCurveTo(e,t,i,s,n,o)}clearRect(e,t,i,s){this.commitTransform(),this.E.clearRect(e,t,i,s)}clip(e){e?this.E.clip(e):this.E.clip()}closePath(){this.E.closePath()}createLinearGradient(e,t,i,s){return this.E.createLinearGradient(e,t,i,s)}createPattern(e,t){return this.E.createPattern(e,t)}createRadialGradient(e,t,i,s,n,o){return this.E.createRadialGradient(e,t,i,s,n,o)}drawImage(e,t,i,s,n,o,r,h,a){s===void 0?this.E.drawImage(e,t,i):this.E.drawImage(e,t,i,s,n,o,r,h,a)}fill(e,t){t?this.E.fill(t,e?"evenodd":"nonzero"):this.E.fill(e?"evenodd":"nonzero")}fillRect(e,t,i,s){this.E.fillRect(e,t,i,s)}fillBackground(e,t,i,s){this.E.fillRect(e,t,i,s)}fillText(e,t,i){this.E.fillText(e,t,i)}getImageData(e,t,i,s){return this.E.getImageData(e,t,i,s)}lineTo(e,t){this.E.lineTo(e,t)}measureText(e){return this.E.measureText(e)}moveTo(e,t){this.E.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this.E.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this.E.rect(e,t,i,s)}restore(){this.E.restore()}save(){this.commitTransform(),this.E.save()}rotate(e){this.Ma.cs(e*57.2958,0,0)}setTransform(e,t,i,s,n,o){this.Ma.setTo(e,t,i,s,n,o)}scale(e,t){this.Ma.tt(e,t)}translate(e,t){this.Ma.Fs(e,t)}stroke(e){e?this.E.stroke(e):this.E.stroke()}transform(e,t,i,s,n,o){if(e===1&&t===0&&i===0&&s===1&&n===0&&o===0)return;const r=this.Ma,h=r.m11*e+r.m21*t,a=r.m12*e+r.m22*t,l=r.m11*i+r.m21*s,u=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=h,r.m12=a,r.m21=l,r.m22=u}commitTransform(){const e=this.Ma;this.E.setTransform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy)}fillContext(e,t,i){this.radialFill(e,t,i)||this.fillOrClip(t,i)}radialFill(e,t,i){if(!(e instanceof Ft)||e.type!==3)return!1;const s=e._c,n=e.Gb;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(t,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(e,t){this.clipInsteadOfFill?this.clip(t):this.fill(e,t)}shadowsSet(e,t,i){this.nf=e,this.of=t,this.un=i}shadowsOff(){this.Zr=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.Zr=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.un}enableDash(e,t){const i=this.E;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}disableDash(){const e=this.E;e.setLineDash!==void 0&&(e.setLineDash(Hi.EmptyArray),e.lineDashOffset=0)}clearContextCache(e){e&&(this.Wb=""),this.Jb="",this.$b=""}removePartFromView(e){}};g(Hi,"EmptyArray",Object.freeze([]));let Ci=Hi;var We=(w=>(w[w.Solid=1]="Solid",w[w.Linear=2]="Linear",w[w.Radial=3]="Radial",w[w.Pattern=4]="Pattern",w))(We||{}),tn=(w=>(w[w.Lab=1]="Lab",w[w.HSL=2]="HSL",w[w.Oklch=3]="Oklch",w))(tn||{});class gi{constructor(){g(this,"n0");g(this,"n1");g(this,"n2");g(this,"n3");this.n0=0,this.n1=0,this.n2=0,this.n3=0}}const E=class E{constructor(e,t){g(this,"h");g(this,"H");g(this,"Na");g(this,"ei");g(this,"gs");g(this,"j0");g(this,"H0");g(this,"Eo");g(this,"q0");g(this,"cn");g(this,"_c");g(this,"Gb");if(K.Ki(this),this.h=!1,e===void 0)this.H=1,this.Na="black";else if(typeof e=="string"){const s=b.Uh(We,e);s!==null?(this.H=s,this.Na="black"):(this.H=1,this.Na=e)}else Object.keys(We).hasOwnProperty(e)?(this.H=e,this.Na="black"):typeof e=="object"&&(this.H=1,t=e);const i=this.H;if(i===2?(this.ei=B.TopCenter,this.gs=B.BottomCenter):i===3?(this.ei=B.Center,this.gs=B.Center):(this.ei=B.None,this.gs=B.None),this.j0=0,this.H0=NaN,this.Eo=null,this.q0=null,this.cn=null,this._c=0,this.Gb=0,t){const s={};for(const n in t)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),t[n]):s[n]=t[n];Object.assign(this,s)}}copy(){const e=new E;return e.H=this.H,e.Na=this.Na,e.ei=this.ei.P(),e.gs=this.gs.P(),e.j0=this.j0,e.H0=this.H0,this.Eo!==null&&(e.Eo=this.Eo.copy()),e.q0=this.q0,e}u(){return this.h=!0,this.Eo!==null&&this.Eo.u(),this}oi(e){e in We?this.type=e:b.er(this,e)}toString(){let e="Brush(";if(this.type===1)e+=this.color;else if(this.type===2?e+="Linear ":this.type===3?e+="Radial ":this.type===4?e+="Pattern ":e+="(unknown) ",e+=this.start+" "+this.end,this.colorStops!==null){const t=this.colorStops.iterator;for(;t.next();){const i=t.key,s=t.value;e+=" "+i+":"+s}}return e+=")",e}addColorStop(e,t){return this.h&&b.L(this),(typeof e!="number"||!isFinite(e)||e>1||e<0)&&b.W(e,"0 <= loc <= 1",E,"addColorStop:loc"),b.s(t,"string",E,"addColorStop:color"),this.Eo===null&&(this.Eo=new bt),this.Eo.set(e,t),this.H===1&&(this.type=2),this.cn=null,this}get type(){return this.H}set type(e){this.h&&b.L(this,e),this.H=e,this.start.isNoSpot()&&(e===2?this.start=B.TopCenter:e===3&&(this.start=B.Center)),this.end.isNoSpot()&&(e===2?this.end=B.BottomCenter:e===3&&(this.end=B.Center)),this.cn=null}get color(){return this.Na}set color(e){this.h&&b.L(this,e),this.Na=e,this.cn=null}get start(){return this.ei}set start(e){this.h&&b.L(this,e),this.ei=e.P(),this.cn=null}get end(){return this.gs}set end(e){this.h&&b.L(this,e),this.gs=e.P(),this.cn=null}get startRadius(){return this.j0}set startRadius(e){this.h&&b.L(this,e),e<0&&b.W(e,">= zero",E,"startRadius"),this.j0=e,this.cn=null}get endRadius(){return this.H0}set endRadius(e){this.h&&b.L(this,e),e<0&&b.W(e,">= zero",E,"endRadius"),this.H0=e,this.cn=null}get colorStops(){return this.Eo}set colorStops(e){this.h&&b.L(this,e),this.Eo=e,this.cn=null}get pattern(){return this.q0}set pattern(e){this.h&&b.L(this,e),this.q0=e,this.cn=null}static randomColor(e,t){e===void 0&&(e=128),t===void 0&&(t=Math.max(e,255));const i=Math.abs(t-e);let s=Math.floor(e+Math.random()*i).toString(16),n=Math.floor(e+Math.random()*i).toString(16),o=Math.floor(e+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return _.CSS?_.CSS.supports("color",e):!0}static lighten(e){return E.lightenBy(e)}lightenBy(e,t){this.h&&b.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)E.No(this.color),this.color=E.td(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)E.No(n.value),this.addColorStop(n.key,E.td(i,s))}return this}static lightenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return E.No(e),E.td(s,n)}static darken(e){return E.darkenBy(e)}darkenBy(e,t){this.h&&b.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)E.No(this.color),this.color=E.td(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)E.No(n.value),this.addColorStop(n.key,E.td(-i,s))}return this}static darkenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return E.No(e),E.td(-s,n)}static mix(e,t,i){E.No(e);const s=E.Y.n0,n=E.Y.n1,o=E.Y.n2,r=E.Y.n3;E.No(t),i===void 0&&(i=.5);const h=Math.round((E.Y.n0-s)*i+s),a=Math.round((E.Y.n1-n)*i+n),l=Math.round((E.Y.n2-o)*i+o),u=Math.round((E.Y.n3-r)*i+r);return`rgba(${h}, ${a}, ${l}, ${u})`}isDark(){if(this.type===1)return E.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const e=this.colorStops;if(this.type===3)return E.isDark(e.first().value);if(e.get(.5)!==null)return E.isDark(e.get(.5));if(e.count===2){const h=e.toArray();return E.isDark(E.mix(h[0].value,h[1].value))}const t=e.iterator;let i=-1,s=-1,n=1,o=1;for(;t.next();){const h=t.key,a=Math.abs(.5-t.key);n>o&&a<n?(i=h,n=a):o>=n&&a<o&&(s=h,o=a)}if(i>s){let h=i;i=s,s=h,h=n,n=o,o=h}const r=s-i;return E.isDark(E.mix(e.get(i),e.get(s),1-o/r))}return!1}static isDark(e){return e?e instanceof E?e.isDark():(E.No(e),(299*E.Y.n0+587*E.Y.n1+114*E.Y.n2)/1e3<128):!1}static td(e,t){switch(t){case 1:return E.lv(),E.Zn.n0=Math.min(100,Math.max(0,E.Zn.n0+100*e)),E.hv(),"rgba("+E.Y.n0+", "+E.Y.n1+", "+E.Y.n2+", "+E.Y.n3+")";case 2:return E.jS(),E.Ii.n2=Math.min(100,Math.max(0,E.Ii.n2+100*e)),"hsla("+E.Ii.n0+", "+E.Ii.n1+"%, "+E.Ii.n2+"%, "+E.Ii.n3+")";case 3:return E.av(),E.Qn.n0=Math.min(100,Math.max(0,E.Qn.n0+100*e)),E.cv(),"rgba("+E.Y.n0+", "+E.Y.n1+", "+E.Y.n2+", "+E.Y.n3+")";default:b.o("Unknown color space: "+t)}}static No(e){E.W0===!1&&(E.W0=!0,E._n=kt.isUsingDOM()?new He(null,void 0,{willReadFrequently:!0}).li:null);const t=E._n;if(t===null)return;t.clearRect(0,0,1,1),t.fillStyle="#000000";const i=t.fillStyle;if(t.fillStyle=e,t.fillStyle!==i){t.fillRect(0,0,1,1);const s=t.getImageData(0,0,1,1).data;E.Y.n0=s[0],E.Y.n1=s[1],E.Y.n2=s[2],E.Y.n3=s[3]/255}else t.fillStyle="#FFFFFF",t.fillStyle,t.fillStyle=e,t.fillStyle,E.Y.n0=0,E.Y.n1=0,E.Y.n2=0,E.Y.n3=1}static jS(){const e=E.Y.n0/255,t=E.Y.n1/255,i=E.Y.n2/255,s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n;let r,h;const a=(s+n)/2;if(o===0)r=h=0;else{switch(s){case e:r=(t-i)/o%6;break;case t:r=(i-e)/o+2;break;case i:r=(e-t)/o+4;break}r*=60,r<0&&(r+=360),h=o/(1-Math.abs(2*a-1))}E.Ii.n0=Math.round(r),E.Ii.n1=Math.round(h*100),E.Ii.n2=Math.round(a*100),E.Ii.n3=E.Y.n3}static DE(){const e=E.Ii.n0,t=E.Ii.n1/100,i=E.Ii.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*t,h=e/60,a=r*(1-Math.abs(h%2-1));h>=0&&h<1?(s=r,n=a,o=0):h>=1&&h<2?(s=a,n=r,o=0):h>=2&&h<3?(s=0,n=r,o=a):h>=3&&h<4?(s=0,n=a,o=r):h>=4&&h<5?(s=a,n=0,o=r):h>=5&&h<6&&(s=r,n=0,o=a);const l=i-.5*r;s+=l,n+=l,o+=l,E.Y.n0=Math.round(s*255),E.Y.n1=Math.round(n*255),E.Y.n2=Math.round(o*255),E.Y.n3=E.Ii.n3}static lv(){E.DA(),E.fv()}static hv(){E.uv(),E.FA()}static F2(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}static R2(e){return e<=.0031308?e*12.92:1.055*Math.pow(e,1/2.4)-.055}static DA(){const e=E.F2(E.Y.n0),t=E.F2(E.Y.n1),i=E.F2(E.Y.n2);E.Dt.n0=.4124564*e+.3575761*t+.1804375*i,E.Dt.n1=.2126729*e+.7151522*t+.072175*i,E.Dt.n2=.0193339*e+.119192*t+.9503041*i,E.Dt.n3=E.Y.n3}static FA(){const e=3.2404542*E.Dt.n0+-1.5371385*E.Dt.n1+-.4985314*E.Dt.n2,t=-.969266*E.Dt.n0+1.8760108*E.Dt.n1+.041556*E.Dt.n2,i=.0556434*E.Dt.n0+-.2040259*E.Dt.n1+1.0572252*E.Dt.n2;E.Y.n0=E.R2(e)*255,E.Y.n1=E.R2(t)*255,E.Y.n2=E.R2(i)*255,E.Y.n3=E.Dt.n3,E.Y.n0=Math.round(E.Y.n0),E.Y.n0>255?E.Y.n0=255:E.Y.n0<0&&(E.Y.n0=0),E.Y.n1=Math.round(E.Y.n1),E.Y.n1>255?E.Y.n1=255:E.Y.n1<0&&(E.Y.n1=0),E.Y.n2=Math.round(E.Y.n2),E.Y.n2>255?E.Y.n2=255:E.Y.n2<0&&(E.Y.n2=0)}static O2(e){return e>E.v2?Math.pow(e,1/3):(E.Zb*e+16)/116}static fv(){const e=E.O2(E.Dt.n0*100/E.ed[0]),t=E.O2(E.Dt.n1*100/E.ed[1]),i=E.O2(E.Dt.n2*100/E.ed[2]);E.Zn.n0=116*t-16,E.Zn.n1=500*(e-t),E.Zn.n2=200*(t-i),E.Zn.n3=E.Dt.n3}static RA(e){const t=e*e*e;return t>E.v2?t:(116*e-16)/E.Zb}static uv(){const e=(E.Zn.n0+16)/116,t=E.Zn.n1/500+e,i=e-E.Zn.n2/200;E.Dt.n0=E.ed[0]/100*E.RA(t),E.Dt.n1=E.ed[1]/100*(E.Zn.n0>E.Zb*E.v2?Math.pow(e,3):E.Zn.n0/E.Zb),E.Dt.n2=E.ed[2]/100*E.RA(i),E.Dt.n3=E.Zn.n3}static dv(){let e=.8190224*E.Dt.n0+.3619062*E.Dt.n1+-.1288737*E.Dt.n2,t=.03298366*E.Dt.n0+.9292868*E.Dt.n1+.03614466*E.Dt.n2,i=.04817719*E.Dt.n0+.2642395*E.Dt.n1+.6335478*E.Dt.n2;e=Math.cbrt(e),t=Math.cbrt(t),i=Math.cbrt(i),E.ai.n0=.2104542*e+.7936177*t+-.004072046*i,E.ai.n1=1.977998*e+-2.428592*t+.4505937*i,E.ai.n2=.02590403*e+.7827717*t+-.8086757*i,E.ai.n3=E.Dt.n3,E.ai.n0*=100}static gv(){E.ai.n0/=100;let e=.9999999*E.ai.n0+.3963377*E.ai.n1+.2158037*E.ai.n2,t=1.000000009*E.ai.n0+-.1055613*E.ai.n1+-.06385417*E.ai.n2,i=1.00000005*E.ai.n0+-.08948418*E.ai.n1+-1.291485*E.ai.n2;e=e**3,t=t**3,i=i**3,E.Dt.n0=1.2268798*e+-.5578149*t+.281391*i,E.Dt.n1=-.04057576*e+1.112286*t+-.07171106*i,E.Dt.n2=-.07637294*e+-.4214933*t+1.586924*i,E.Dt.n3=E.ai.n3}static mv(){const e=Math.atan2(E.ai.n2,E.ai.n1)*180/Math.PI;E.Qn.n0=E.ai.n0,E.Qn.n1=Math.sqrt(E.ai.n1**2+E.ai.n2**2),E.Qn.n2=e>=0?e:e+360,E.Qn.n3=E.ai.n3}static pv(){E.ai.n0=E.Qn.n0,E.ai.n1=E.Qn.n1*Math.cos(E.Qn.n2*Math.PI/180),E.ai.n2=E.Qn.n1*Math.sin(E.Qn.n2*Math.PI/180),E.ai.n3=E.Qn.n3}static av(){E.DA(),E.dv(),E.mv()}static cv(){E.pv(),E.gv(),E.FA()}static Qu(e,t){typeof e=="string"||e instanceof E||b.o("Value for "+t+" must be a color string or a Brush, not "+e)}};g(E,"v2",216/24389),g(E,"Zb",24389/27),g(E,"ed",[95.047,100,108.883]),g(E,"Solid",1),g(E,"Linear",2),g(E,"Radial",3),g(E,"Pattern",4),g(E,"Lab",1),g(E,"HSL",2),g(E,"_n",null),g(E,"W0",!1),g(E,"Y",new gi),g(E,"Ii",new gi),g(E,"Dt",new gi),g(E,"Zn",new gi),g(E,"ai",new gi),g(E,"Qn",new gi);let Ft=E;const Wi=class Wi{constructor(){g(this,"St","Base")}static dn(e,t){t.name=e,Wi.es.set(e,t)}get name(){return this.St}set name(e){this.St=e}get classType(){return rt}measure(e,t,i,s,n,o,r){}measureElement(e,t,i,s,n){e.ht(t,i,s,n)}arrange(e,t,i){}arrangeElement(e,t,i,s,n,o){e.Bt(t,i,s,n,o)}remeasureObject(e){e.tf()}Ui(e,t,i){}};g(Wi,"es",new bt);let Nt=Wi;class An extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length,a=e.Uo();for(let l=0;l<h;l++){const u=s[l];if(!u.visible&&u!==a)continue;const c=u.margin,d=c.right+c.left,f=c.top+c.bottom;u.ht(t,i,o,r);const m=u.measuredBounds,p=Math.max(m.width+d,0),y=Math.max(m.height+f,0);let x=u.position.x,P=u.position.y;if(isFinite(x)||(x=0),isFinite(P)||(P=0),u instanceof dt&&u.isGeometryPositioned){const k=u.strokeWidth/2;x-=k,P-=k}n.unionNoCheck(x,P,p,y)}}arrange(e,t,i){const s=t.length,n=e.padding,o=i.x-n.left,r=i.y-n.top;for(let h=0;h<s;h++){const a=t[h],l=a.measuredBounds,u=a.margin,c=a.position.x,d=a.position.y;let f=isNaN(c)?-o:c-o,m=isNaN(d)?-r:d-r;if(a instanceof dt&&a.isGeometryPositioned){const p=a.strokeWidth/2;f-=p,m-=p}a.visible&&a.Bt(f+u.left,m+u.top,l.width,l.height)}}}Nt.dn("Position",new An);class Dn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length,a=b.et(),l=e.Uo();for(let c=0;c<h;c++){const d=s[c];if(!d.visible&&d!==l)continue;const f=d.zs(!1);if(f!==0&&f!==5){a.push(d);continue}d.ht(1/0,i,0,r);const m=d.margin,p=d.measuredBounds,y=Math.max(p.width+m.right+m.left,0),x=Math.max(p.height+m.top+m.bottom,0);n.Fn(n.width+y,Math.max(n.height,x))}const u=a.length;e.desiredSize.height?i=Math.min(e.desiredSize.height,e.maxSize.height):n.height!==0&&(i=Math.min(n.height,e.maxSize.height));for(let c=0;c<u;c++){const d=a[c];if(!d.visible&&d!==l)continue;const f=d.margin,m=f.right+f.left,p=f.top+f.bottom;d.ht(1/0,i,0,r);const y=d.measuredBounds,x=Math.max(y.width+m,0),P=Math.max(y.height+p,0);n.width+=x,n.height=Math.max(n.height,P)}b.J(a)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.top,r=e.isOpposite;let h=r?i.width:n.left;for(let a=0;a<s;a++){const l=o,u=t[a];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,f=d.top+d.bottom,m=o+n.bottom;let p=c.height;const y=u.zs(!1);(isNaN(u.desiredSize.height)&&y===2||y===4)&&(p=Math.max(i.height-f-m,0));const x=p+f+m;let P=u.alignment;P.isDefault()&&(P=e.defaultAlignment),P.isSpot()||(P=B.Center),r&&(h-=c.width+d.left+d.right),u.Bt(h+P.offsetX+d.left,l+P.offsetY+d.top+(i.height*P.y-x*P.y),c.width,p),r||(h+=c.width+d.left+d.right)}}}Nt.dn("Horizontal",new Dn);class Fn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length,a=b.et(),l=e.Uo();for(let c=0;c<h;c++){const d=s[c];if(!d.visible&&d!==l)continue;const f=d.zs(!1);if(f!==0&&f!==4){a.push(d);continue}d.ht(t,1/0,o,0);const m=d.margin,p=d.measuredBounds,y=Math.max(p.width+m.right+m.left,0),x=Math.max(p.height+m.top+m.bottom,0);n.Fn(Math.max(n.width,y),n.height+x)}const u=a.length;e.desiredSize.width?t=Math.min(e.desiredSize.width,e.maxSize.width):n.width!==0&&(t=Math.min(n.width,e.maxSize.width));for(let c=0;c<u;c++){const d=a[c];if(!d.visible&&d!==l)continue;const f=d.margin,m=f.right+f.left,p=f.top+f.bottom;d.ht(t,1/0,o,0);const y=d.measuredBounds,x=Math.max(y.width+m,0),P=Math.max(y.height+p,0);n.width=Math.max(n.width,x),n.height+=P}b.J(a)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=e.isOpposite;let h=r?i.height:n.top;for(let a=0;a<s;a++){const l=o,u=t[a];if(!u.visible)continue;const c=u.measuredBounds,d=u.margin,f=d.left+d.right,m=o+n.right;let p=c.width;const y=u.zs(!1);(isNaN(u.desiredSize.width)&&y===2||y===5)&&(p=Math.max(i.width-f-m,0));const x=p+f+m;let P=u.alignment;P.isDefault()&&(P=e.defaultAlignment),P.isSpot()||(P=B.Center),r&&(h-=c.height+d.bottom+d.top),u.Bt(l+P.offsetX+d.left+(i.width*P.x-x*P.x),h+P.offsetY+d.top,p,c.height),r||(h+=c.height+d.bottom+d.top)}}}Nt.dn("Vertical",new Fn);const Di=class Di extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length;if(h===0)return;const a=e.findMainElement();let l=a.margin,u=0,c=0;const d=l.right+l.left,f=l.top+l.bottom;a.ht(t,i,o,r);let m=a.measuredBounds,p=m.width,y=m.height,x=Math.max(p+d,0),P=Math.max(y+f,0);const k=e.isClipping;k&&a.y0()!==0&&!Di.vA&&(Di.vA=!0,b.ni("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+e.toString()));const v=z.V(-l.left,-l.top,x,P);let N=z.V(0,0,p,y);this.I2(a,N,!0),p=N.width,y=N.height;let M=!0;const C=e.Uo();let F;for(let T=0;T<h;T++){const L=s[T];let D=t,O=i;if(L===a||!L.visible&&L!==C)continue;l=L.margin;let R=l.left,I=l.top;switch(u=l.right+l.left,c=l.top+l.bottom,F=L.zs(!1),F){case 2:D=p,O=y,u=0,c=0,R=0,I=0;break;case 5:D=p,u=0,R=0;break;case 4:O=y,c=0,I=0;break}L.ht(D,O,0,0),m=L.measuredBounds,x=Math.max(m.width+u,0),P=Math.max(m.height+c,0);let X=L.alignment;X.isDefault()&&(X=e.defaultAlignment),X.isSpot()||(X=B.Center);let j=L.alignmentFocus;j.isDefault()&&(j=B.Center);let V=null;L instanceof rt&&L.to!==""&&(V=L.findObject(L.to),V===L&&(V=null));let U=N.x-R,W=N.y-I;if(V!==null){L.Bt(0,0,m.width,m.height);const ct=V.actualBounds,$=S.V(ct.x+(j.x*ct.width-j.offsetX),ct.y+(j.y*ct.height-j.offsetY));for(V=V.panel;V!==L;)V.T.gt($),V=V.panel;U+=X.x*p+X.offsetX-$.x,W+=X.y*y+X.offsetY-$.y,S.e($)}else U+=X.x*p+X.offsetX-(j.x*m.width+j.offsetX),W+=X.y*y+X.offsetY-(j.y*m.height+j.offsetY);M?(M=!1,n.i(U,W,x,P)):n.unionNoCheck(U,W,x,P)}switch(M?n.a(v):k?n.intersect(N.x,N.y,N.width,N.height):n.unionNoCheck(v.x,v.y,v.width,v.height),z.e(v),z.e(N),F=a.stretch,F===1&&(F=a.zs(!1)),F){case 0:return;case 2:if(!isFinite(t)&&!isFinite(i))return;break;case 5:if(!isFinite(t))return;break;case 4:if(!isFinite(i))return;break}m=a.measuredBounds,p=m.width,y=m.height,x=Math.max(p+d,0),P=Math.max(y+f,0),l=a.margin,N=z.V(-l.left,-l.top,x,P),this.I2(a,N,!0),p=N.width,y=N.height;for(let T=0;T<h;T++){const L=s[T];if(L===a||!L.visible&&L!==C)continue;l=L.margin,u=l.right+l.left,c=l.top+l.bottom,m=L.measuredBounds,x=Math.max(m.width+u,0),P=Math.max(m.height+c,0);let D=L.alignment;D.isDefault()&&(D=e.defaultAlignment),D.isSpot()||(D=B.Center);let O=L.alignmentFocus;O.isDefault()&&(O=B.Center),M?(M=!1,n.i(D.x*p+D.offsetX-(O.x*m.width+O.offsetX)-l.left,D.y*y+D.offsetY-(O.y*m.height+O.offsetY)-l.top,x,P)):n.unionNoCheck(D.x*p+D.offsetX-(O.x*m.width+O.offsetX)-l.left,D.y*y+D.offsetY-(O.y*m.height+O.offsetY)-l.top,x,P)}M?n.a(v):k?n.intersect(N.x,N.y,N.width,N.height):n.unionNoCheck(v.x,v.y,v.width,v.height),z.e(N)}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=o.width,h=o.height,a=e.padding,l=a.left,u=a.top;let c=l-i.x,d=u-i.y;n.Bt(c,d,r,h);const f=z.V(0,0,r,h);this.I2(n,f,!1);for(let m=0;m<s;m++){const p=t[m];if(p===n)continue;const y=p.measuredBounds,x=y.width,P=y.height;let k=p.alignment;k.isDefault()&&(k=e.defaultAlignment),k.isSpot()||(k=B.Center);let v=p.alignmentFocus;v.isDefault()&&(v=B.Center);let N=null;if(p instanceof rt&&p.to!==""&&(N=p.findObject(p.to),N===p&&(N=null)),N!==null){const M=N.actualBounds,C=S.V(M.x+(v.x*M.width-v.offsetX),M.y+(v.y*M.height-v.offsetY));for(N=N.panel;N!==p;)N.T.gt(C),N=N.panel;c=k.x*f.width+k.offsetX-C.x,d=k.y*f.height+k.offsetY-C.y,S.e(C)}else c=k.x*f.width+k.offsetX-(v.x*x+v.offsetX),d=k.y*f.height+k.offsetY-(v.y*P+v.offsetY);c+=f.x-i.x,d+=f.y-i.y,p.visible&&p.Bt(l+c,u+d,x,P)}z.e(f)}I2(e,t,i){let s=null;if(e instanceof rt&&e.to!==""&&(s=e.findObject(e.to),s===e&&(s=null)),s!==null)for(i&&e.Bt(0,0,t.width,t.height),t.a(s.actualBounds),s=s.panel;s!==e;)s.T.vg(t),s=s.panel}};g(Di,"vA",!1);let ss=Di;Nt.dn("Spot",new ss);class On extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length;if(h===0)return;const a=e.findMainElement();let l=a.margin,u=t,c=i;const d=l.right+l.left,f=l.top+l.bottom;a.ht(t,i,o,r);let m=a.measuredBounds,p=0,y=null;a instanceof dt&&(y=a,p=y.strokeWidth*y.scale);let x=Math.max(m.width+d,0),P=Math.max(m.height+f,0),k=e.E2(a);const v=k.x*x+k.offsetX,N=k.y*P+k.offsetY;let M=e.U2(a);const C=M.x*x+M.offsetX,F=M.y*P+M.offsetY;isFinite(t)&&(u=Math.max(Math.abs(v-C)-p,0)),isFinite(i)&&(c=Math.max(Math.abs(N-F)-p,0));let T=0,L=0;o>0&&(T=Math.max(Math.abs(k.x*o+k.offsetX-(M.x*o+M.offsetX))-p,0)),r>0&&(L=Math.max(Math.abs(k.y*r+k.offsetY-(M.y*r+M.offsetY))-p,0));const D=ot.l();D.i(0,0);const O=e.Uo();for(let j=0;j<h;j++){const V=s[j];if(V===a||!V.visible&&V!==O)continue;l=V.margin;const U=l.right+l.left,W=l.top+l.bottom;V.ht(u,c,T,L),m=V.measuredBounds,x=Math.max(m.width+U,0),P=Math.max(m.height+W,0),D.i(Math.max(x,D.width),Math.max(P,D.height))}if(h===1){m=a.measuredBounds,n.width=x,n.height=P,ot.e(D);return}k=e.E2(a),M=e.U2(a);let R=0,I=0;M.x!==k.x&&M.y!==k.y&&(R=D.width/Math.abs(M.x-k.x),I=D.height/Math.abs(M.y-k.y)),ot.e(D),p=0,y!==null&&(p=y.strokeWidth*y.scale,y.aS()===6&&(R=I=Math.max(R,I))),R+=Math.abs(k.offsetX)+Math.abs(M.offsetX)+p,I+=Math.abs(k.offsetY)+Math.abs(M.offsetY)+p;let X=a.stretch;switch(X===1&&(X=a.zs(!1)),X){case 0:o=0,r=0;break;case 2:isFinite(t)&&(R=t),isFinite(i)&&(I=i);break;case 5:isFinite(t)&&(R=t),r=0;break;case 4:o=0,isFinite(i)&&(I=i);break}a.tf(),a.ht(R,I,o,r),n.width=a.measuredBounds.width+d,n.height=a.measuredBounds.height+f}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=z.l();r.i(0,0,1,1);let h=n.margin;const a=h.left,l=h.top,u=e.padding,c=u.left,d=u.top;let f=a,m=l,p=o.width,y=o.height;n.Bt(c+f,d+m,p,y);const x=e.E2(n),P=e.U2(n),k=0+x.x*o.width+x.offsetX,v=0+x.y*o.height+x.offsetY,N=0+P.x*o.width+P.offsetX,M=0+P.y*o.height+P.offsetY;r.x=k,r.y=v,r.unionNoCheck(N,M,0,0),r.x+=a+c,r.y+=l+d;for(let C=0;C<s;C++){const F=t[C];if(F===n)continue;const T=F.measuredBounds;h=F.margin;const L=Math.max(T.width+h.right+h.left,0),D=Math.max(T.height+h.top+h.bottom,0);let O=F.alignment;O.isDefault()&&(O=e.defaultAlignment),O.isSpot()||(O=B.Center),f=r.width*O.x+O.offsetX-L*O.x+h.left+r.x,m=r.height*O.y+O.offsetY-D*O.y+h.top+r.y,p=r.width,y=r.height,F.visible&&(z.contains(r.x,r.y,r.width,r.height,f,m,T.width,T.height)?F.Bt(f,m,T.width,T.height):F.Bt(f,m,T.width,T.height,new z(r.x,r.y,r.width,r.height)))}z.e(r)}}Nt.dn("Auto",new On);class Rn extends Nt{constructor(){super(),this.name="Table"}measure(e,t,i,s,n,o,r){let h=s.length;const a=b.et(),l=b.et();for(let Q=0;Q<h;Q++){const H=s[Q],lt=H instanceof rt?H:null;if(lt!==null&&lt.$r()&&H.visible){l.push(lt);const Pt=lt.C.r,Xt=Pt.length;for(let Ut=0;Ut<Xt;Ut++){const Zt=Pt[Ut];lt.type===rt.TableRow?Zt.row=H.row:lt.type===rt.TableColumn&&(Zt.column=H.column),a.push(Zt)}}else a.push(H)}h=a.length,h===0&&(e.getRowDefinition(0),e.getColumnDefinition(0));const u=[];for(let Q=0;Q<h;Q++){const H=a[Q];H.visible&&(H.ue(!0),H.Jn(!0),u[H.row]||(u[H.row]=[]),u[H.row][H.column]||(u[H.row][H.column]=[]),u[H.row][H.column].push(H))}b.J(a);const c=b.et(),d=b.et(),f=b.et(),m={count:0},p={count:0};let y=t,x=i;const P=e.Xe,k=e.Ye;let v=null;h=P.length;for(let Q=0;Q<h;Q++)v=P[Q],v!==void 0&&(v.actual=0,v.Ai=0);h=k.length;for(let Q=0;Q<h;Q++)v=k[Q],v!==void 0&&(v.actual=0,v.Ai=0);let N=u.length,M=0;for(let Q=0;Q<N;Q++)u[Q]&&(M=Math.max(M,u[Q].length));const C=Math.min(e.topIndex,N-1),F=Math.min(e.leftIndex,M-1);let T=0,L;N=u.length;const D=e.Uo();for(let Q=0;Q<N;Q++){if(!u[Q])continue;M=u[Q].length;const H=e.getRowDefinition(Q);H.actual=0,H.Ai=0;for(let lt=0;lt<M;lt++){if(!u[Q][lt])continue;const Pt=e.getColumnDefinition(lt);c[lt]===void 0&&(Pt.actual=0,Pt.Ai=0,c[lt]=!0);const Xt=u[Q][lt],Ut=Xt.length;for(let Zt=0;Zt<Ut;Zt++){const Qt=Xt[Zt];if(!Qt.visible&&Qt!==D)continue;const Re=Qt.rowSpan>1,ye=Qt.columnSpan>1;(Re||ye)&&!(Q<C)&&!(lt<F)&&d.push(Qt);const Pe=Qt.margin,te=Pe.right+Pe.left,se=Pe.top+Pe.bottom;L=Qt.S0(H,Pt,!1);const Te=Qt.desiredSize,Dt=!isNaN(Te.width),ze=!isNaN(Te.height);if(L!==0&&!(Dt&&ze)&&!(Q<C)&&!(lt<F)&&(!ye&&m[lt]===void 0&&(L===2||L===5)&&(m[lt]=-1,m.count++),!Re&&p[Q]===void 0&&(L===2||L===4)&&(p[Q]=-1,p.count++),!Re&&!ye&&f.push(Qt)),Qt.ht(1/0,1/0,0,0),Q<C||lt<F)continue;const ue=Qt.measuredBounds,Be=Math.max(ue.width+te,0),Ye=Math.max(ue.height+se,0);if(Qt.rowSpan===1&&(L===0||L===5)){v=e.getRowDefinition(Q);const Ee=v.computeEffectiveSpacing(),Fi=v._===0;T=Math.max(Ye-v.actual,0),T+(Fi?Ee:0)>x&&(T=Math.max(x-Ee,0)),v.Ai=v.Ai+T,v.actual=v._+T,x=Math.max(x-(T+(Fi?Ee:0)),0)}if(Qt.columnSpan===1&&(L===0||L===4)){v=e.getColumnDefinition(lt);const Ee=v.computeEffectiveSpacing(),Fi=v._===0;T=Math.max(Be-v.actual,0),T+(Fi?Ee:0)>y&&(T=Math.max(y-Ee,0)),v.Ai=v.Ai+T,v.actual=v._+T,y=Math.max(y-(T+(Fi?Ee:0)),0)}(Re||ye)&&Qt.tf()}}}b.J(c);let O=0,R=0;h=e.columnCount;for(let Q=0;Q<h;Q++){const H=k[Q];H!==void 0&&(O+=isNaN(H.de)?H.Ai:H.de,H.Ai!==0&&(O+=H.computeEffectiveSpacing()))}h=e.rowCount;for(let Q=0;Q<h;Q++){const H=P[Q];H!==void 0&&(R+=isNaN(H.de)?H.Ai:H.de,H.Ai!==0&&(R+=H.computeEffectiveSpacing()))}y=Math.max(t-O,0),x=Math.max(i-R,0);let I=x,X=y;h=f.length;for(let Q=0;Q<h;Q++){const H=f[Q],lt=e.getRowDefinition(H.row),Pt=e.getColumnDefinition(H.column),Xt=H.measuredBounds,Ut=H.margin,Zt=Ut.right+Ut.left,Qt=Ut.top+Ut.bottom;Pt.Ai===0&&m[H.column]!==void 0?m[H.column]=Math.max(Xt.width+Zt,m[H.column]):m[H.column]=null,lt.Ai===0&&p[H.row]!==void 0?p[H.row]=Math.max(Xt.height+Qt,p[H.row]):p[H.row]=null}let j=0,V=0,U;for(U in p)U!=="count"&&(j+=p[U]);for(U in m)U!=="count"&&(V+=m[U]);const W=ot.l();for(let Q=0;Q<h;Q++){const H=f[Q];if(!H.visible&&H!==D)continue;const lt=e.getRowDefinition(H.row),Pt=e.getColumnDefinition(H.column);let Xt=0;isFinite(Pt.width)?Xt=Pt.width:(isFinite(y)&&m[H.column]!==null?V===0?Xt=Pt.actual+y:Xt=m[H.column]/V*X:m[H.column]!==null?Xt=y:Xt=Pt.actual||y,Xt=Math.max(0,Xt-Pt.computeEffectiveSpacing()));let Ut=0;switch(isFinite(lt.height)?Ut=lt.height:(isFinite(x)&&p[H.row]!==null?j===0?Ut=lt.actual+x:Ut=p[H.row]/j*I:p[H.row]!==null?Ut=x:Ut=lt.actual||x,Ut=Math.max(0,Ut-lt.computeEffectiveSpacing())),W.i(Math.max(Pt.minimum,Math.min(Xt,Pt.maximum)),Math.max(lt.minimum,Math.min(Ut,lt.maximum))),L=H.S0(lt,Pt,!1),L){case 5:W.height=Math.max(W.height,lt.actual+x);break;case 4:W.width=Math.max(W.width,Pt.actual+y);break}const Zt=H.margin,Qt=Zt.right+Zt.left,Re=Zt.top+Zt.bottom;H.tf();let ye=Pt.minimum,Pe=lt.minimum;const te=H.measuredBounds;te.width===0&&m[H.column]!==null&&(ye=Math.max(ye,m[H.column])),te.height===0&&p[H.row]!==null&&(Pe=Math.max(ye,p[H.row])),H.ht(W.width,W.height,ye,Pe);const se=H.measuredBounds;let Te=Math.max(se.width+Qt,0),Dt=Math.max(se.height+Re,0);isFinite(y)&&(Te=Math.min(Te,W.width)),isFinite(x)&&(Dt=Math.min(Dt,W.height));let ze=0;ze=lt.actual,lt.actual=Math.max(lt.actual,Dt),lt.Ai=Math.max(lt.Ai,Dt),T=lt.actual-ze,x=Math.max(x-T,0),p[H.row]===null&&(I=Math.max(I-T,0)),ze=Pt.actual,Pt.actual=Math.max(Pt.actual,Te),Pt.Ai=Math.max(Pt.Ai,Te),T=Pt.actual-ze,y=Math.max(y-T,0),m[H.column]===null&&(X=Math.max(X-T,0))}b.J(f);const ct=ot.l(),$=b.et(),et=b.et();if(h=d.length,h!==0)for(let Q=0;Q<N;Q++){if(!u[Q])continue;M=u[Q].length;const H=e.getRowDefinition(Q);$[Q]=H.actual;for(let lt=0;lt<M;lt++){if(!u[Q][lt])continue;const Pt=e.getColumnDefinition(lt);et[lt]=Pt.actual}}for(let Q=0;Q<h;Q++){const H=d[Q];if(!H.visible&&H!==D)continue;const lt=e.getRowDefinition(H.row),Pt=e.getColumnDefinition(H.column);switch(W.i(Math.max(Pt.minimum,Math.min(t,Pt.maximum)),Math.max(lt.minimum,Math.min(i,lt.maximum))),L=H.S0(lt,Pt,!1),L){case 2:et[Pt.index]!==0&&(W.width=Math.min(W.width,et[Pt.index])),$[lt.index]!==0&&(W.height=Math.min(W.height,$[lt.index]));break;case 5:et[Pt.index]!==0&&(W.width=Math.min(W.width,et[Pt.index]));break;case 4:$[lt.index]!==0&&(W.height=Math.min(W.height,$[lt.index]));break}isFinite(Pt.width)&&(W.width=Pt.width),isFinite(lt.height)&&(W.height=lt.height),ct.i(0,0);let Xt=Pt.minimum,Ut=lt.minimum;for(let Dt=1;Dt<H.rowSpan&&!(H.row+Dt>=e.rowCount);Dt++)v=e.getRowDefinition(H.row+Dt),T=0,L===2||L===4?T=Math.max(v.minimum,$[H.row+Dt]===0?v.maximum:Math.min($[H.row+Dt],v.maximum)):T=Math.max(v.minimum,isNaN(v.de)?v.maximum:Math.min(v.de,v.maximum)),ct.height+=T,Ut+=v.minimum;for(let Dt=1;Dt<H.columnSpan&&!(H.column+Dt>=e.columnCount);Dt++)v=e.getColumnDefinition(H.column+Dt),T=0,L===2||L===5?T=Math.max(v.minimum,et[H.column+Dt]===0?v.maximum:Math.min(et[H.column+Dt],v.maximum)):T=Math.max(v.minimum,isNaN(v.de)?v.maximum:Math.min(v.de,v.maximum)),ct.width+=T,Xt+=v.minimum;W.width+=ct.width,W.height+=ct.height;const Zt=H.margin,Qt=Zt.right+Zt.left,Re=Zt.top+Zt.bottom;H.ht(W.width,W.height,Xt,Ut);const ye=H.measuredBounds,Pe=Math.max(ye.width+Qt,0),te=Math.max(ye.height+Re,0);let se=0;for(let Dt=0;Dt<H.rowSpan&&!(H.row+Dt>=e.rowCount);Dt++)v=e.getRowDefinition(H.row+Dt),se+=v.total||0;if(se<te){let Dt=te-se;const ze=te-se;if(H.spanAllocation!==null){const ue=H.spanAllocation;for(let Be=0;Be<H.rowSpan&&!(Dt<=0||H.row+Be>=e.rowCount);Be++){v=e.getRowDefinition(H.row+Be);const Ye=v._||0,Ee=ue(H,v,ze);v.actual=Math.min(v.maximum,Ye+Ee),v._!==Ye&&(Dt-=v._-Ye)}}for(;Dt>0;){const ue=v._||0;if(isNaN(v.height)&&v.maximum>ue&&(v.actual=Math.min(v.maximum,ue+Dt),v._!==ue&&(Dt-=v._-ue)),v.index===0)break;v=e.getRowDefinition(v.index-1)}}let Te=0;for(let Dt=0;Dt<H.columnSpan&&!(H.column+Dt>=e.columnCount);Dt++)v=e.getColumnDefinition(H.column+Dt),Te+=v.total||0;if(Te<Pe){let Dt=Pe-Te;const ze=Pe-Te;if(H.spanAllocation!==null){const ue=H.spanAllocation;for(let Be=0;Be<H.columnSpan&&!(Dt<=0||H.column+Be>=e.columnCount);Be++){v=e.getColumnDefinition(H.column+Be);const Ye=v._||0,Ee=ue(H,v,ze);v.actual=Math.min(v.maximum,Ye+Ee),v._!==Ye&&(Dt-=v._-Ye)}}for(;Dt>0;){const ue=v._||0;if(isNaN(v.width)&&v.maximum>ue&&(v.actual=Math.min(v.maximum,ue+Dt),v._!==ue&&(Dt-=v._-ue)),v.index===0)break;v=e.getColumnDefinition(v.index-1)}}}b.J(d),ot.e(ct),ot.e(W),$!==void 0&&b.J($),et!==void 0&&b.J(et);let tt=0,it=0;const mt=e.desiredSize,ft=e.maxSize;L=e.zs(!0),O=0,R=0;let Z=0,ht=0;h=e.columnCount;for(let Q=0;Q<h;Q++)if(k[Q]!==void 0){if(v=e.getColumnDefinition(Q),isFinite(v.width)){Z+=v.width,Z+=v.computeEffectiveSpacing();continue}else if(v.Qb()===2){Z+=v._,Z+=v.computeEffectiveSpacing();continue}v._!==0&&(O+=v._,O+=v.computeEffectiveSpacing())}isFinite(mt.width)?tt=Math.min(mt.width,ft.width):L!==0&&isFinite(t)?tt=t:tt=O,tt=Math.max(tt,isFinite(t)?Math.min(o,t):o),tt=Math.max(tt-Z,0);const Et=O===0?1:Math.max(tt/O,1);for(let Q=0;Q<h;Q++)k[Q]!==void 0&&(v=e.getColumnDefinition(Q),!isFinite(v.width)&&v.Qb()!==2&&(v.actual=v._*Et),v.position=n.width,v._!==0&&(n.width+=v._,n.width+=v.computeEffectiveSpacing()));h=e.rowCount;for(let Q=0;Q<h;Q++)if(P[Q]!==void 0){if(v=e.getRowDefinition(Q),isFinite(v.height)){ht+=v.height,ht+=v.computeEffectiveSpacing();continue}else if(v.Qb()===2){ht+=v._,ht+=v.computeEffectiveSpacing();continue}v._!==0&&(R+=v._,R+=v.computeEffectiveSpacing())}isFinite(mt.height)?it=Math.min(mt.height,ft.height):L!==0&&isFinite(i)?it=i:it=R,it=Math.max(it,isFinite(i)?Math.min(r,i):r),it=Math.max(it-ht,0);const xt=R===0?1:Math.max(it/R,1);for(let Q=0;Q<h;Q++)P[Q]!==void 0&&(v=e.getRowDefinition(Q),!isFinite(v.height)&&v.Qb()!==2&&(v.actual=v._*xt),v.position=n.height,v._!==0&&(n.height+=v._,n.height+=v.computeEffectiveSpacing()));h=l.length;for(let Q=0;Q<h;Q++){const H=l[Q];let lt=0,Pt=0;H.type===rt.TableRow?(lt=n.width,v=e.getRowDefinition(H.row),Pt=v.actual):(v=e.getColumnDefinition(H.column),lt=v.actual,Pt=n.height),H.measuredBounds.i(0,0,lt,Pt),H.ue(!1)}b.J(l),e.yh=u}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=n.top,h=e.yh;if(h===null)return;let a=0,l=0;const u=h.length;let c=0;for(let F=0;F<u;F++)h[F]&&(c=Math.max(c,h[F].length));const d=e.Xe,f=e.Ye;let m=0,p=0,y=Math.min(e.topIndex,u-1);if(d.length>0){for(;y!==u&&(d[y]===void 0||d[y]._===0);)y++;y=Math.max(Math.min(y,u-1),0),m=-d[y].position}let x=Math.min(e.leftIndex,c-1);if(f.length>0){for(;x!==c&&(f[x]===void 0||f[x]._===0);)x++;x=Math.max(Math.min(x,c-1),0),p=-f[x].position}let P=0,k=0;for(;P!==u&&d[P]===void 0;)P++;for(;k!==u&&f[k]===void 0;)k++;const v=e.part;let N=e.getRowDefinition(P),M=e.getColumnDefinition(k);for(let F=0;F<t.length;F++){const T=t[F];if(!(T instanceof rt&&T.visible&&T.$r()))continue;T.type===rt.TableRow?(N=e.getRowDefinition(T.row),M=e.getColumnDefinition(k)):(N=e.getRowDefinition(P),M=e.getColumnDefinition(T.column)),l=N.position+m+r,N._!==0&&(l+=N.computeEffectiveSpacingTop(Math.max(P,y))),a=M.position+p+o,M._!==0&&(a+=M.computeEffectiveSpacingTop(Math.max(k,x)));const L=T.measuredBounds;T.$c(),T.actualBounds.Pt();const D=T.actualBounds,O=z.V(D.x,D.y,D.width,D.height);if(D.x=T.type===rt.TableRow?o:a,D.y=T.type===rt.TableColumn?r:l,D.width=L.width,D.height=L.height,T.actualBounds.u(),T.Jn(!1),O.equalsApproxClose(D)){z.e(O);continue}v!==null&&(v.dh(),T.x0(v)),z.e(O)}const C=ot.l();for(let F=0;F<u;F++){if(!h[F])continue;c=h[F].length;const T=e.getRowDefinition(F);l=T.position+m+r,T._!==0&&(l+=T.computeEffectiveSpacingTop(Math.max(P,y)));for(let L=0;L<c;L++){if(!h[F][L])continue;const D=e.getColumnDefinition(L);a=D.position+p+o,D._!==0&&(a+=D.computeEffectiveSpacingTop(Math.max(k,x)));const O=h[F][L],R=O.length;for(let I=0;I<R;I++){const X=O[I],j=X.measuredBounds;C.i(0,0);for(let te=1;te<X.rowSpan&&!(F+te>=e.rowCount);te++){const se=e.getRowDefinition(F+te);se._!==0&&(C.height+=se.total)}for(let te=1;te<X.columnSpan&&!(L+te>=e.columnCount);te++){const se=e.getColumnDefinition(L+te);se._!==0&&(C.width+=se.total)}const V=D._+C.width,U=T._+C.height;let W=a,ct=l;const $=V,et=U,tt=a,it=l;let mt=V,ft=U;a+V>i.width&&(mt=Math.max(i.width-a,0)),l+U>i.height&&(ft=Math.max(i.height-l,0));let Z=X.alignment,ht=0,Et=0,xt=0,Q=0;if(Z.isDefault()){Z=e.defaultAlignment,Z.isSpot()||(Z=B.Center),ht=Z.x,Et=Z.y,xt=Z.offsetX,Q=Z.offsetY;const te=D.alignment,se=T.alignment;te.isSpot()&&(ht=te.x,xt=te.offsetX),se.isSpot()&&(Et=se.y,Q=se.offsetY)}else ht=Z.x,Et=Z.y,xt=Z.offsetX,Q=Z.offsetY;(isNaN(ht)||isNaN(Et))&&(ht=.5,Et=.5,xt=0,Q=0);let H=j.width,lt=j.height;const Pt=X.margin,Xt=Pt.left+Pt.right,Ut=Pt.top+Pt.bottom,Zt=X.S0(T,D,!1);isNaN(X.desiredSize.width)&&(Zt===2||Zt===5)&&(H=Math.max(V-Xt,0)),isNaN(X.desiredSize.height)&&(Zt===2||Zt===4)&&(lt=Math.max(U-Ut,0));const Qt=X.maxSize,Re=X.minSize;H=Math.min(Qt.width,H),lt=Math.min(Qt.height,lt),H=Math.max(Re.width,H),lt=Math.max(Re.height,lt);const ye=H+Xt,Pe=lt+Ut;W+=$*ht-ye*ht+xt+Pt.left,ct+=et*Et-Pe*Et+Q+Pt.top,X.visible&&(z.contains(tt,it,mt,ft,W,ct,j.width,j.height)?X.Bt(W,ct,H,lt):X.Bt(W,ct,H,lt,new z(tt,it,mt,ft)))}}}ot.e(C);for(let F=0;F<s;F++){const T=t[F],L=T instanceof rt?T:null;if(L!==null&&L.$r()){const D=T.actualBounds;T.naturalBounds.Pt(),T.naturalBounds.i(0,0,D.width,D.height),T.naturalBounds.u()}}}}Nt.dn("Table",new Rn);class Bn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Nt.dn("TableRow",new Bn);class En extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Nt.dn("TableColumn",new En);class In extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){s.length!==1&&b.o("Viewbox Panel must contain exactly one GraphObject.");const h=s[0];h.tt=1,h.tf(),h.ht(1/0,1/0,o,r);let a=h.measuredBounds;const l=h.margin,u=l.right+l.left,c=l.top+l.bottom;if(isFinite(t)||isFinite(i)){const d=h.scale,f=a.width,m=a.height,p=Math.max(t-u,0),y=Math.max(i-c,0);let x=1;e.viewboxStretch===6?(f!==0&&m!==0&&(x=Math.min(p/f,y/m)),x===0&&(x=1e-4),h.tt*=x):(f!==0&&m!==0&&(x=Math.max(p/f,y/m)),x===0&&(x=1e-4),h.tt*=x),d!==h.scale&&(h.ue(!0),h.ht(1/0,1/0,o,r))}a=h.measuredBounds,n.width=isFinite(t)?t:Math.max(a.width+u,0),n.height=isFinite(i)?i:Math.max(a.height+c,0)}arrange(e,t,i){const s=t[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,h=o.top+o.bottom,a=Math.max(n.width+r,0),l=Math.max(n.height+h,0);let u=s.alignment;u.isDefault()&&(u=e.defaultAlignment),u.isSpot()||(u=B.Center),s.Bt(i.width*u.x-a*u.x+u.offsetX,i.height*u.y-l*u.y+u.offsetY,n.width,n.height)}}Nt.dn("Viewbox",new In);class Vn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){e.yi===null&&(e.yi=new fi),this.yv(e),this.wv(e)}arrange(e,t,i){}Ui(e,t,i){const s=e.naturalBounds,n=s.width,o=s.height;t.save(),t.beginPath(),t.rect(0,0,n,o),t.clip(),t.endPath(),this.xv(e,t,i),t.restore(),t.clearContextCache(!1)}xv(e,t,i){let s=e.getDocumentScale()*i.scale;s<=0&&(s=1);const n=e.gridCellSize,o=n.width,r=n.height,h=e.naturalBounds,a=e.actualBounds,l=h.width,u=h.height,c=Math.ceil(l/o),d=Math.ceil(u/r),f=e.gridOrigin,m=f.x,p=f.y,y=e.yi.J0,x=e.C.r,P=x.length;for(let k=0;k<P;k++){const v=x[k];if(!v.visible)continue;const N=v.interval||1,M=Math.abs(N);if(o*M*s<2)continue;let C=v.segmentIndex;(!isFinite(C)||isNaN(C))&&(C=0),C<0&&(C=M-Math.min(-C,M)),C=Math.round(C%M);const F=v.opacity;let T=1;if(F!==1){if(F===0)continue;T=t.globalAlpha,t.globalAlpha=T*F}const L=y[k];let D=!1;const O=v.strokeDashArray;if(O!==null&&(D=!0,t.enableDash(O,v.strokeDashOffset)),v.stroke!==null&&v.strokeWidth>0&&(v.figure==="LineV"||v.figure==="LineH")){if(t.lineWidth=v.strokeWidth,e.rn(t,v.stroke,!1,!1,h,a),t.beginPath(),v.figure==="LineV"){const R=Math.floor((m-o)/o);for(let I=R;I<=R+c;I++){const X=I*o+m;0<=X&&X<=l&&this._b(I,N,C,L)&&(t.moveTo(X,0),t.lineTo(X,u))}}else if(v.figure==="LineH"){const R=Math.floor((p-r)/r);for(let I=R;I<=R+d;I++){const X=I*r+p;0<=X&&X<=u&&this._b(I,N,C,L)&&(t.moveTo(0,X),t.lineTo(l,X))}}t.stroke(),t.endPath()}else if(v.fill!==null){if(e.rn(t,v.fill,!0,!1,h,a),v.figure==="BarV"){let R=v.width;isNaN(R)&&(R=o);const I=Math.floor((m-o)/o);for(let X=I;X<=I+c;X++){const j=X*o+m;0<=j+R&&j<=l&&this._b(X,N,C,L)&&t.fillRect(j,0,R,u)}}else if(v.figure==="BarH"){let R=v.height;isNaN(R)&&(R=r);const I=Math.floor((p-r)/r);for(let X=I;X<=I+d;X++){const j=X*r+p;0<=j+R&&j<=u&&this._b(X,N,C,L)&&t.fillRect(0,j,l,R)}}}D&&t.disableDash(),F!==1&&(t.globalAlpha=T)}}_b(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(e%r===i)return!1}return!0}wv(e){const t=[],i=e.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const h=o.interval;if(h<0)continue;const a=o.figure,l=this.B2(a);for(let u=0;u<s;u++){if(u===n)continue;const c=i[u];if(!c.visible)continue;const d=c.figure;if(this.B2(d)!==l)continue;const f=c.interval;f>h&&r.push(f)}}e.yi.J0=t}B2(e){return e==="LineV"||e==="BarV"}yv(e){let t=1,i=1;const s=e.C.r,n=s.length;for(let h=0;h<n;h++){const a=s[h],l=Math.abs(a.interval);l<2||(this.B2(a.figure)?i=i*l/A.DC(i,l):t=t*l/A.DC(t,l))}const o=e.gridCellSize,r=e.yi;r.Yc.isReal()?r.Yc.i(i*o.width,t*o.height):r.Yc=new ot(i*o.width,t*o.height)}}Nt.dn("Grid",new Vn);class zn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=s.length;if(!(e instanceof yt||e instanceof at))return;let a=null,l=null;if(e instanceof at&&(a=e),e instanceof yt&&(l=e,a=l.adornedPart,e.hf===null&&(e.hf=[])),!(a instanceof at))return;const u=a;if(h===0){e.naturalBounds.Fn(0,0),e.measuredBounds.i(0,0,0,0);return}const c=e instanceof yt?null:a.path,d=a.routeBounds,f=e.Bo;f.i(0,0,d.width,d.height);const m=u.points,p=a.pointsCount;l!==null?l.sd(!1):a!==null&&a.sd(!1);const y=d.width,x=d.height,P=e.hf;if(P.length=0,c!==null){this.measureLinkPath(e,y,x,c);const M=c.measuredBounds;f.unionRect(M),P.push(M)}const k=Tt.l(),v=S.l(),N=S.l();for(let M=0;M<h;M++){const C=s[M];if(C===c)continue;let F=C.measuredBounds;if(C.isPanelMain&&C instanceof dt){this.measureLinkPath(e,y,x,C),F=C.measuredBounds,f.unionRect(F),P.push(F);continue}if(p<2){C.ht(1/0,1/0,0,0),F=C.measuredBounds,f.unionRect(F),P.push(F);continue}const T=C.segmentIndex,L=C.segmentFraction;let D=C.alignmentFocus;D.isNoSpot()&&(D=B.Center);const O=C.segmentOrientation,R=C.segmentOffset;let I=0,X=0,j=0,V=0;if(isNaN(T)){const Z=u.ot,ht=b.et();Z.getPointAndAngleAlongPath(L,ht);const Et=S.V(ht[0],ht[1]);V=ht[2],O!==0&&(j=u.computeAngle(C,O,V),C.Yt=j,C.ue(!0),C.Jn(!0)),I=Et.x,X=Et.y,S.e(Et),b.J(ht)}else if(T<-p||T>=p){const Z=S.l();u.OA(Z),V=u.midAngle,O!==0&&(j=u.computeAngle(C,O,V),C.Yt=j,C.ue(!0),C.Jn(!0)),I=Z.x-d.x,X=Z.y-d.y,S.e(Z)}else{let Z,ht,Et=0;if(T>=0?(Z=m.elt(T),ht=T<p-1?m.elt(T+1):Z):(Et=p+T,Z=m.elt(Et),ht=Et>0?m.elt(Et-1):Z),V=0,Z.equalsApprox(ht)){let xt,Q;T>=0?(xt=T>0?m.elt(T-1):Z,Q=T<p-2?m.elt(T+2):ht):(xt=Et<p-1?m.elt(Et+1):Z,Q=Et>1?m.elt(Et-2):ht);const H=xt.distanceSquaredPoint(Z),lt=ht.distanceSquaredPoint(Q);H>lt+10?V=T>=0?xt.directionPoint(Z):Z.directionPoint(xt):lt>H+10?V=T>=0?ht.directionPoint(Q):Q.directionPoint(ht):V=T>=0?xt.directionPoint(Q):Q.directionPoint(xt)}else V=T>=0?Z.directionPoint(ht):ht.directionPoint(Z);O!==0&&(j=u.computeAngle(C,O,V),C.Yt=j,C.ue(!0),C.Jn(!0)),I=Z.x+(ht.x-Z.x)*L-d.x,X=Z.y+(ht.y-Z.y)*L-d.y}C.ht(1/0,1/0,0,0),F=C.measuredBounds;const U=C.naturalBounds;let W=0;C instanceof dt&&(W=C.strokeWidth);const ct=U.width+W,$=U.height+W;k.Ri(),k.Fs(-F.x,-F.y),k.tt(C.scale,C.scale),k.cs(O===0?C.angle:V,ct/2,$/2),(O===22||O===26)&&k.cs(90,ct/2,$/2),(O===23||O===27)&&k.cs(-90,ct/2,$/2),O===28&&(V>45&&V<135||V>225&&V<315)&&k.cs(-V,ct/2,$/2);const et=new z(0,0,ct,$);v.setRectSpot(et,D),k.gt(v);const tt=-v.x+W/2*C.scale,it=-v.y+W/2*C.scale;N.a(R);const mt=isNaN(R.x),ft=isNaN(R.y);if(mt||ft){const Z=ct/2+3,ht=$/2+3,Et=V>=45&&V<=135,xt=V>=225&&V<=315;O===0&&(Et||xt)?(N.x=ft?Z:R.y,N.y=mt?ht:R.x,Et?T>=0||isNaN(T)&&L<.5||mt&&(N.y=-ht):xt&&((T>=0||isNaN(T)&&L<.5)&&mt&&(N.y=-ht),ft&&(N.x=-Z))):(mt&&(T>=0||isNaN(T)&&L<.5?N.x=Z:N.x=-Z),ft&&(N.y=-ht),N.rotate(V))}else N.rotate(V);I+=N.x,X+=N.y,et.i(I+tt,X+it,F.width,F.height),P.push(et),f.unionRect(et)}if(a!==null){const M=a.labelNodes;for(;M.next();)M.value.ht(1/0,1/0)}e.Bo=f,e.position.i(d.x+f.x,d.y+f.y),n.Fn(f.width||0,f.height||0),Tt.e(k),S.e(v),S.e(N)}arrange(e,t,i){const s=t.length;if(!(e instanceof yt||e instanceof at))return;let n=e,o=null;e instanceof yt&&(o=e,n=o.adornedPart);const r=e,h=e instanceof yt?null:n.path,a=e.hf;if(a.length!==0){let d=0;if(h!==null&&d<a.length){const f=a[d];d++,h.Bt(f.x-r.Bo.x,f.y-r.Bo.y,f.width,f.height)}for(let f=0;f<s;f++){const m=t[f];if(m!==h&&d<a.length){const p=a[d];d++,m.Bt(p.x-r.Bo.x,p.y-r.Bo.y,p.width,p.height)}}}const l=n.points,u=l.count;if(u>=2&&r instanceof at){const d=r.labelNodes;for(;d.next();){const f=d.value;r.bv(f,u,l)}}o!==null?o.sd(!1):n.sd(!1);const c=e.IA(S.l());e.location.i(e.position.x+c.x,e.position.y+c.y),S.e(c)}measureLinkPath(e,t,i,s){if(s.To()===!1)return;let n=s.strokeWidth;if(n===0&&e instanceof yt&&e.type===rt.Link&&e.adornedObject instanceof dt&&(n=e.adornedObject.strokeWidth),n=n*s.tt,e instanceof at&&e.ot!==null){const o=e.geometry.bounds;s.Wn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(e instanceof yt&&e.adornedPart.ot!==null){const o=e.adornedPart.ot.bounds;s.Wn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.Wn(-(n/2),-(n/2),t+n,i+n);s.kv(),s.ue(!1)}}Nt.dn("Link",new zn);class Xn extends Nt{constructor(){super()}measure(e,t,i,s,n,o,r){const h=e.findMainElement();e.Ge=[];const a=h.margin,l=a.right+a.left,u=a.top+a.bottom;h.ht(t,i,o,r);const c=h.measuredBounds,d=c.width,f=c.height,m=Math.max(d+l,0),p=Math.max(f+u,0),y=new z(-a.left,-a.top,m,p);e.Ge.push(y),n.a(y),this.determineGraduatedMarks(e,h);const x=e.xs;if(x===null)return;const P=s.length;for(let k=0;k<P;k++){const v=s[k],N=x[k];!v.visible||v===h||N.length===0||(v instanceof dt?this.measureGraduatedTicks(e,v,N,n):v instanceof Kt&&this.measureGraduatedLabels(e,v,N,n),v.ue(!1))}}arrange(e,t,i){if(e.Ge===null)return;const s=e.findMainElement(),n=e.xs;if(n===null)return;const o=e.Ge;let r=0,h=o[r];r++,s!==null&&s.Bt(h.x-i.x,h.y-i.y,h.width,h.height);const a=t.length;for(let l=0;l<a;l++){const u=t[l],c=n[l];!u.visible||u===s||c.length===0||(h=o[r],r++,u.Bt(h.x-i.x,h.y-i.y,h.width,h.height))}e.Ge=null}measureGraduatedTicks(e,t,i,s){let n=t.alignmentFocus;n.isNoSpot()&&(n=B.TopCenter);const o=t.angle;t.Yt=0,t.ht(1/0,1/0,0,0),t.Yt=o;const r=t.measuredBounds,h=r.width,a=r.height,l=z.V(0,0,h,a),u=S.l();u.setRectSpot(l,n),z.e(l);const c=-u.x,d=-u.y,f=new z,m=i.length;for(let p=0;p<m;p++){const y=i[p],x=y.pt.x,P=y.pt.y,k=y.angle;for(let v=0;v<4;v++){switch(v){case 0:u.i(c,d);break;case 1:u.i(c+h,d);break;case 2:u.i(c,d+a);break;case 3:u.i(c+h,d+a);break}u.rotate(k+t.angle),u.offset(x,P),p===0&&v===0?f.i(u.x,u.y,0,0):f.unionPoint(u),u.offset(-x,-P),u.rotate(-k-t.angle)}}S.e(u),e.Ge!==null&&e.Ge.push(f),s.unionNoCheck(f.x,f.y,f.width,f.height)}measureGraduatedLabels(e,t,i,s){e.Pe===null&&(e.Pe=new Kt);const n=e.Pe;this.EA(t,n);let o=t.alignmentFocus;o.isNoSpot()&&(o=B.TopCenter);const r=t.segmentOrientation,h=t.segmentOffset,a=new z;let l=0,u=0,c=0,d=0,f=0;const m=i.length;for(let p=0;p<m;p++){const y=i[p];l=y.pt.x,u=y.pt.y,c=y.angle,d=t.angle,f=t.angle,r!==0&&(r===21||r===25?f=c+t.angle:f=c,d=at.computeAngle(r,f)),n.Yt=d,n.text=y.text||"",n.ht(1/0,1/0,0,0);const x=n.measuredBounds,P=n.naturalBounds,k=P.width,v=P.height,N=Tt.l();N.Ri(),N.Fs(-x.x,-x.y),N.tt(n.scale,n.scale),N.cs(f,k/2,v/2),(r===22||r===26)&&N.cs(90,k/2,v/2),(r===23||r===27)&&N.cs(-90,k/2,v/2),r===28&&(c>45&&c<135||c>225&&c<315)&&N.cs(-c,k/2,v/2);const M=z.V(0,0,k,v),C=S.l();C.setRectSpot(M,o),N.gt(C);const F=-C.x,T=-C.y,L=S.l();L.a(h),isNaN(L.x)&&(L.x=k/2+3),isNaN(L.y)&&(L.y=-(v/2+3)),L.rotate(c),l+=L.x+F,u+=L.y+T;const D=new z(l,u,x.width,x.height),O=new z(x.x,x.y,x.width,x.height),R=new z(P.x,P.y,P.width,P.height);y.labelAngle=d,y.lineCount=n.lineCount,y.lines=n.getMetrics(),y.actualBounds=D,y.measuredBounds=O,y.naturalBounds=R,p===0?a.a(D):a.unionRect(D),S.e(L),S.e(C),z.e(M),Tt.e(N)}e.Ge!==null&&e.Ge.push(a),s.unionNoCheck(a.x,a.y,a.width,a.height)}determineGraduatedMarks(e,t){const i=t.geometry,s=t.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,h=n.length;let a=0,l=0;const u=b.et();for(let P=0;P<h;P++){const k=n[P],v=[];a=0,l=0;const N=k.length;for(let M=0;M<N;M+=2){const C=k[M],F=k[M+1];if(M===0){a=C,l=F;continue}let T=Math.atan2(F-l,C-a)*180/Math.PI;T<0&&(T+=360),v.push(T),a=C,l=F}u.push(v)}const c=this.Pv(e),d=e.C.r,f=d.length;let m=0,p=0,y=r;e.xs=[];let x;for(let P=0;P<f;P++){const k=d[P];if(x=[],!k.visible||k===t){e.xs.push(x);continue}const v=Math.abs(k.interval),N=e.graduatedTickUnit;if(N*v*r/e.graduatedRange<2&&k.graduatedSkip===null){e.xs.push(x);continue}let M=o[0][0],C=0,F=0;p=r*k.graduatedStart-1e-4,y=r*k.graduatedEnd+1e-4;const T=N*v;let L=e.graduatedTickBase;if(L<e.graduatedMin){let I=(e.graduatedMin-L)/T;I=I%1===0?I:Math.floor(I+1),L+=I*T}else if(L>e.graduatedMin+T){const I=Math.floor((L-e.graduatedMin)/T);L-=I*T}const D=c[P],O=L,R=e.graduatedMax*1e-6;for(let I=1;L<=e.graduatedMax+R;I++){if(this.Sv(e,L-e.graduatedTickBase,D)&&(L>e.graduatedMax&&(L=e.graduatedMax),(k.graduatedSkip===null||k instanceof Kt&&!k.graduatedSkip(L,k)||k instanceof dt&&!k.graduatedSkip(L,k))&&(m=(L-e.graduatedMin)*r/e.graduatedRange,m>r&&(m=r),p<=m&&m<=y))){let X=u[C][F],j=o[C][F];for(;C<o.length;){for(;m>M&&F<o[C].length-1;)F++,X=u[C][F],j=o[C][F],M+=j;if(m<=M)break;C++,F=0,X=u[C][F],j=o[C][F],M+=j}const V=n[C],U=V[F*2],W=V[F*2+1],ct=V[F*2+2],$=V[F*2+3],et=(m-(M-j))/j,tt=new S(U+(ct-U)*et+s/2-i.bounds.x,W+($-W)*et+s/2-i.bounds.y);if(tt.scale(t.scale,t.scale),X=this.Mv(X,et,V,u[C],F),k instanceof Kt){let it="";k.graduatedFunction!==null?(it=k.graduatedFunction(L,k),it=it!=null?it.toString():""):it=(+L.toFixed(2)).toString(),it!==""&&x.push({pt:tt,angle:X,text:it})}else x.push({pt:tt,angle:X})}L=O+I*T}e.xs.push(x)}b.J(u)}Mv(e,t,i,s,n){if(t<.5005&&t>.4995)return e;let o=e;if(t<.5?n>0?o=s[n-1]:A.z(i[0],i[i.length-2])&&A.z(i[1],i[i.length-1])&&(o=s[s.length-1]):t>.5&&(n+1<s.length?o=s[n+1]:A.z(i[0],i[i.length-2])&&A.z(i[1],i[i.length-1])&&(o=s[0])),e!==o){let r=Math.abs(e-o);if(r>180&&(e<o?e+=360:o+=360,r=Math.abs(e-o)),t<5e-4||t>.9995)return(e+o)/2%360;if(r<10){const h=1-Math.abs(.5-t);return(e*h+o*(1-h))%360}}return e}Pv(e){if(e.ss===null){const t=[],i=e.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const h=o.interval;if(!(h<0))for(let a=0;a<s;a++){if(a===n)continue;const l=i[a];if(!l.visible||o.constructor!==l.constructor)continue;const u=l.interval;u>h&&r.push(u)}}e.ss=t}return e.ss}Sv(e,t,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*e.graduatedTickUnit,r=t%o,h=e.graduatedTickUnit*1e-6;if(r<h&&r>-h)return!1}return!0}Ui(e,t,i){const s=i.ia;i.ia=!0;const n=e.naturalBounds,o=n.width,r=n.height,h=t instanceof ge;t.save(),t.beginPath(),t.rect(-1,-1,o+1,r+1),t.clip(),t.endPath();const a=e.findMainElement();a.Ui(t,i);let l=e.getDocumentScale()*i.scale;l<=0&&(l=1);const u=a.actualBounds,c=e.C.r,d=e.xs,f=c.length;for(let m=0;m<f;m++){const p=c[m],y=d[m],x=y.length;if(!(!p.visible||p===a||y.length===0)){if(p instanceof dt){if(e.graduatedTickUnit*p.interval*a.geometry.flattenedTotalLength/e.graduatedRange*l<2&&p.graduatedSkip===null)continue;const P=p.measuredBounds,k=p.strokeWidth*p.scale;let v=p.alignmentFocus;v.isNoSpot()&&(v=B.TopCenter);for(let N=0;N<x;N++){const M=y[N].pt,C=y[N].angle;this.Nv(p,M,u,C,P,k,v),p.Ui(t,i),h&&(e.svg.appendChild(p.svg),p.svg=null),p.qr.Ri()}}else if(p instanceof Kt){e.Pe===null&&(e.Pe=new Kt);const P=e.Pe;this.EA(p,P),P.V2=!0;for(let k=0;k<x;k++){const v=y[k];if(v.actualBounds&&v.measuredBounds&&v.naturalBounds){P.Cv(v);const N=v.actualBounds;P.Bt(N.x,N.y,N.width,N.height),this.Lv(P,u,N,v.measuredBounds,v.naturalBounds),P.Jr=p.part,P.Vs=p.panel,P.Ui(t,i),P.Vs=null,P.Jr=null,h&&(e.svg.appendChild(P.svg),P.svg=null)}}}}}i.ia=s,t.restore(),t.clearContextCache(!0)}Nv(e,t,i,s,n,o,r){const h=e.qr;h.Ri(),h.Fs(t.x+i.x,t.y+i.y),h.cs(s+e.angle,0,0),h.Fs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),h.tt(e.scale,e.scale),e.Zu(!1),e.hh.set(e.qr),e.da=e.scale,e.ka(!1)}Lv(e,t,i,s,n){const o=e.qr;o.Ri(),o.Fs(i.x+t.x,i.y+t.y),o.Fs(-s.x,-s.y),e.m0(o,n.x,n.y,n.width,n.height),e.Zu(!1),e.hh.set(e.qr),e.da=e.scale,e.ka(!1)}EA(e,t){t.Av(e)}}Nt.dn("Graduated",new Xn);var en=(w=>(w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(en||{});const nt=class nt extends Ct{constructor(t,i){super();g(this,"H");g(this,"C");g(this,"Zt");g(this,"nd");g(this,"Bn");g(this,"Qr");g(this,"to");g(this,"Bo");g(this,"z2");g(this,"F");g(this,"od");g(this,"st");g(this,"yi");g(this,"_t");g(this,"rd");g(this,"wh");g(this,"Gs");if(this.H=null,t===void 0)this.H=nt.Position;else if(typeof t=="string"){const s=Nt.es.get(t);s!==null&&(this.H=s)}else t instanceof Nt?this.H=t:t&&(this.H=nt.Position,i=t);this.H===null&&b.o("Panel type not specified or PanelLayout not loaded: "+t),this.n|=4194304|(this.H===nt.Grid?1048576:0),this.C=new J,this.Zt=Ot.Rg,this.nd=B.Default,this.Bn=1,this.Qr=null,this.to="",this.Bo=new z(NaN,NaN,NaN,NaN),this.z2=null,this.F=null,this.od=6,this.yi=null,this.st=null,this._t=null,this.rd=NaN,this.wh=null,this.Gs=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.H=this.H,t.Zt=this.Zt.P(),t.nd=this.nd.P(),t.Bn=this.Bn,t.to=this.to,t.Bo.a(this.Bo),this.F!==null&&(t.F=this.F.copy(t)),t.od=this.od,this.st!==null&&(t.st=this.st.copy()),this.yi!==null&&(t.yi=this.yi.copy()),t._t=this._t,t.rd=this.rd,t.wh=this.wh}vo(t){super.vo(t),t.C=this.C;const i=t.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.Vs=t}t.Qr=null}copy(){const t=super.copy();if(t!==null){const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].copy();t.Tv(o)}return t}else return null}toString(){return"Panel("+this.type.name+")#"+K.as(this)}get type(){return this.H}set type(t){const i=this.H;i!==t&&(this.H=t,this.af=this.H===nt.Grid,this.c(),this.t("type",i,t))}get elements(){return this.C.iterator}get naturalBounds(){return this.zi}get padding(){return this.Zt}set padding(t){typeof t=="number"?(t<0&&b.W(t,">= 0",nt,"padding"),t=new Ot(t)):(t.left<0&&b.W(t.left,">= 0",nt,"padding:value.left"),t.right<0&&b.W(t.right,">= 0",nt,"padding:value.right"),t.top<0&&b.W(t.top,">= 0",nt,"padding:value.top"),t.bottom<0&&b.W(t.bottom,">= 0",nt,"padding:value.bottom"));const i=this.Zt;i.equals(t)||(t=t.P(),this.Zt=t,this.c(),this.t("padding",i,t))}get defaultAlignment(){return this.nd}set defaultAlignment(t){const i=this.nd;i.equals(t)||(t=t.P(),this.nd=t,this.c(),this.t("defaultAlignment",i,t))}get defaultStretch(){return this.Bn}set defaultStretch(t){const i=this.Bn;i!==t&&(this.Bn=t,this.c(),this.t("defaultStretch",i,t))}get defaultSeparatorPadding(){return this.F!==null?this.F.$0:Ot.Rg}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new Ot(t));const i=this.defaultSeparatorPadding;i.equals(t)||(t=t.P(),this.F===null&&(this.F=new ae),this.F.$0=t,this.c(),this.t("defaultSeparatorPadding",i,t))}get defaultRowSeparatorStroke(){return this.F!==null?this.F.Z0:null}set defaultRowSeparatorStroke(t){const i=this.defaultRowSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Ft)&&(t instanceof Ft&&t.u(),this.F===null&&(this.F=new ae),this.F.Z0=t,this.S(),this.t("defaultRowSeparatorStroke",i,t))}get defaultRowSeparatorStrokeWidth(){return this.F!==null?this.F.Q0:1}set defaultRowSeparatorStrokeWidth(t){const i=this.defaultRowSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.F===null&&(this.F=new ae),this.F.Q0=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",i,t))}get defaultRowSeparatorDashArray(){return this.F!==null?this.F._0:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.Zi(t,"Array",nt,"defaultRowSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&b.o("defaultRowSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.F===null&&(this.F=new ae),this.F._0=t,this.S(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return this.F!==null?this.F.tp:null}set defaultColumnSeparatorStroke(t){const i=this.defaultColumnSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Ft)&&(t instanceof Ft&&t.u(),this.F===null&&(this.F=new ae),this.F.tp=t,this.S(),this.t("defaultColumnSeparatorStroke",i,t))}get defaultColumnSeparatorStrokeWidth(){return this.F!==null?this.F.ip:1}set defaultColumnSeparatorStrokeWidth(t){const i=this.defaultColumnSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.F===null&&(this.F=new ae),this.F.ip=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",i,t))}get defaultColumnSeparatorDashArray(){return this.F!==null?this.F.ep:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.Zi(t,"Array",nt,"defaultColumnSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&b.o("defaultColumnSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.F===null&&(this.F=new ae),this.F.ep=t,this.S(),this.t("defaultColumnSeparatorDashArray",i,t)}}get yh(){return this.F!==null?this.F.yh:null}set yh(t){this.F===null&&(this.F=new ae),this.F.yh=t}get viewboxStretch(){return this.od}set viewboxStretch(t){const i=this.od;i!==t&&(this.od=t,this.c(),this.t("viewboxStretch",i,t))}get gridCellSize(){return this.yi!==null?this.yi.ld:ot.wC}set gridCellSize(t){this.yi===null&&(this.yi=new fi);const i=this.yi.ld;if(!i.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&b.o("Invalid Panel.gridCellSize: "+t),this.yi.ld=t.P();const s=this.diagram;s!==null&&this===s.grid&&s.th(),this.S(),this.t("gridCellSize",i,t)}}get gridOrigin(){return this.yi!==null?this.yi.hd:S.xo}set gridOrigin(t){this.yi===null&&(this.yi=new fi);const i=this.yi.hd;if(!i.equals(t)){t.isReal()||b.o("Invalid Panel.gridOrigin: "+t),this.yi.hd=t.P();const s=this.diagram;s!==null&&this===s.grid&&s.th(),this.S(),this.t("gridOrigin",i,t)}}get graduatedMin(){return this.st!==null?this.st.sp:0}set graduatedMin(t){const i=this.graduatedMin;if(i!==t&&(this.st===null&&(this.st=new Ve),this.st.sp=t,this.c(),this.t("graduatedMin",i,t),this.Wc())){const s=this.part;s!==null&&this.ba(s,"graduatedRange")}}get graduatedMax(){return this.st!==null?this.st.np:100}set graduatedMax(t){const i=this.graduatedMax;if(i!==t&&(this.st===null&&(this.st=new Ve),this.st.np=t,this.c(),this.t("graduatedMax",i,t),this.Wc())){const s=this.part;s!==null&&this.ba(s,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.st!==null?this.st.op:10}set graduatedTickUnit(t){const i=this.graduatedTickUnit;i!==t&&t>0&&(this.st===null&&(this.st=new Ve),this.st.op=t,this.c(),this.t("graduatedTickUnit",i,t))}get graduatedTickBase(){return this.st!==null?this.st.rp:0}set graduatedTickBase(t){const i=this.graduatedTickBase;i!==t&&(this.st===null&&(this.st=new Ve),this.st.rp=t,this.c(),this.t("graduatedTickBase",i,t))}get xs(){return this.st!==null?this.st.xs:null}set xs(t){this.st!==null?this.st.xs=t:t!==null&&(this.st=new Ve,this.st.xs=t)}get Ge(){return this.st!==null?this.st.Ge:null}set Ge(t){this.st!==null?this.st.Ge=t:t!==null&&(this.st=new Ve,this.st.Ge=t)}get ss(){return this.st!==null?this.st.ss:null}set ss(t){this.st!==null?this.st.ss=t:t!==null&&(this.st=new Ve,this.st.ss=t)}get Pe(){return this.st!==null?this.st.Pe:null}set Pe(t){this.st!==null?this.st.Pe=t:t!==null&&(this.st=new Ve,this.st.Pe=t)}x0(t){super.x0(t);const i=this.C.r,s=i.length;for(let n=0;n<s;n++)i[n].x0(t)}gh(t,i){if(this.H===nt.Grid){t.commitTransform(),this.H.Ui(this,t,i);return}if(this.H===nt.Graduated){t.commitTransform(),this.H.Ui(this,t,i);return}if(this.H===nt.Table)if(t.commitTransform(),t instanceof ge){const h=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.X2(t,i),t.endGroup(),t.currentElement=h}else this.X2(t,i);const s=this.isClipping&&this.H===nt.Spot;s&&t.save();const n=this.findMainElement(),o=this.C.r,r=o.length;for(let h=0;h<r;h++){const a=o[h];s&&a===n&&(t.clipInsteadOfFill=!0),a.Ui(t,i),s&&a===n&&(t.clipInsteadOfFill=!1)}s&&(t.restore(),t.clearContextCache(!0))}X2(t,i){t.lineCap="butt";const s=this.rowCount>0?this.Xe:null,n=this.columnCount>0?this.Ye:null;s!==null&&this.t1(t,i,!0,s,!0),n!==null&&this.t1(t,i,!1,n,!0),s!==null&&this.UA(t,!0,s),n!==null&&this.UA(t,!1,n),s!==null&&this.t1(t,i,!0,s,!1),n!==null&&this.t1(t,i,!1,n,!1)}UA(t,i,s){const n=s.length,o=this.actualBounds,r=this.naturalBounds;let h=!0;for(let a=0;a<n;a++){const l=s[a];if(l===void 0||l.actual===0)continue;if(h){h=!1;continue}if(i){if(l.position>r.height)continue}else if(l.position>r.width)continue;let u=l.separatorStrokeWidth;isNaN(u)&&(u=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let c=l.separatorStroke;if(c===null&&(c=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),u===0||c===null)continue;this.rn(t,c,!1,!1,r,o);let d=!1,f=l.separatorDashArray;f===null&&(f=i?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),f!==null&&(d=!0,t.enableDash(f,0)),t.beginPath();const m=l.position+u;i?m>r.height&&(u-=m-r.height):m>r.width&&(u-=m-r.width);let p=l.position+u/2;t.lineWidth=u;const y=this.Zt;if(i){p+=y.top;const x=y.left,P=r.width-y.right;t.moveTo(x,p),t.lineTo(P,p)}else{p+=y.left;const x=y.top,P=r.height-y.bottom;t.moveTo(p,x),t.lineTo(p,P)}t.stroke(),t.endPath(),d&&t.disableDash()}}t1(t,i,s,n,o){const r=n.length,h=this.actualBounds,a=this.naturalBounds,l=this.BA(!0),u=this.BA(!1);for(let c=0;c<r;c++){const d=n[c];if(d===void 0||d.background===null||d.coversSeparators===o||d.actual===0)continue;const f=s?h.height:h.width;if(d.position>f)continue;let m=d.computeEffectiveSpacing(),p=d.separatorStrokeWidth;isNaN(p)&&(p=s?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let y=d.separatorStroke;y===null&&(y=s?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(y===null||d.index===(s?l:u))&&(p=0),m-=p;const x=d.position+p;let P=m+d.actual;if(x+P>f&&(P=f-x),P<=0)continue;const k=this.Zt;this.rn(t,d.background,!0,!1,a,h),s?t.fillRect(k.left,x+k.top,h.width-(k.left+k.right),P):t.fillRect(x+k.left,k.top,P,h.height-(k.top+k.bottom))}}BA(t){const i=t?this.rowCount:this.columnCount;for(let s=0;s<i;s++){const n=t?this.Xe[s]:this.Ye[s];if(n!==void 0)return n.index}return 0}Qc(){const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Qc();this.Ve(!0)}Zc(t,i,s){const n=this.svg;if(n===null)return!1;if(this.type===nt.Table){const h=n.getElementsByClassName("gojs-ts"),a=h.length!==0?h[0]:null;a!==null&&(a.innerHTML=""),t.currentElement=a,this.X2(t,i),t.currentElement=null}else{if(this.H===nt.Grid||this.H===nt.Graduated)return n.innerHTML="",n.remove(),!1;if(this.H===nt.Spot&&this.isClipping)return n.innerHTML="",n.remove(),this.ah=null,this.Qc(),!1}if(!super.Zc(t,i,s))return!1;const o=this.C.r,r=o.length;for(let h=0;h<r;h++)o[h].Ui(t,i);return!0}$u(t){return!0}k0(t,i,s,n){if(!this.isClipping){if(this.Xs()&&t.partClipRect!==null){const o=t.partClipRect,r=this.C.r;let h=0,a=0;for(let l=0;l<r.length;l++){if(!r[l].isVisibleObject())continue;const u=r[l].actualBounds;h=l===0?u.x:Math.min(u.x,h),a=l===0?u.y:Math.min(u.y,a)}n.setAttributeNS(null,"clip-path",`path('M ${o.x-s.x-h},${o.y-s.y-a} l ${o.width} 0 l 0 ${o.height} l -${o.width} 0 z')`);return}super.k0(t,i,s,n)}}Jc(t,i,s,n,o){const r=this.an(),h=this.T,a=1/(h.m11*h.m22-h.m12*h.m21);let l=h.m22*a,u=-h.m12*a,c=-h.m21*a,d=h.m11*a,f=a*(h.m21*h.dy-h.m22*h.dx),m=a*(h.m12*h.dx-h.m11*h.dy);if(this.background!==null){const p=t*l+i*c+f,y=t*u+i*d+m,x=s*l+n*c+f,P=s*u+n*d+m;o.i(0,0);const k=this.naturalBounds,v=A.gl(0,0,k.width,k.height,p,y,x,P,o);return o.T(h),v}else{r||(l=1,u=0,c=0,d=1,f=0,m=0);const p=t*l+i*c+f,y=t*u+i*d+m,x=s*l+n*c+f,P=s*u+n*d+m;o.i(x,P);let k=(x-p)**2+(P-y)**2,v=!1;const N=this.C.r,M=N.length,C=S.l();let F=null,T=1/0,L=null;const D=this.isClipping&&this.H===nt.Spot;D&&(L=S.l(),F=this.findMainElement(),v=F.Jc(p,y,x,P,L),v&&(T=(p-L.x)**2+(y-L.y)**2));for(let O=0;O<M;O++){const R=N[O];if(!R.visible||R===F||!R.Jc(p,y,x,P,C))continue;v=!0;const I=(p-C.x)**2+(y-C.y)**2;I<k&&(k=I,o.set(C))}return D&&(T>k&&o.set(L),S.e(L)),S.e(C),r&&o.T(h),v}}Au(){const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Au();super.Au()}c(t){if(this.To())return;super.c(t);let i=null;(this.H===nt.Auto||this.H===nt.Link)&&(i=this.findMainElement());const s=this.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if((r===i||r.isPanelMain)&&r.c(!0),r.desiredSize.isReal())continue;const h=r.zs(!1);!(r instanceof ve)&&!(r instanceof nt)&&!(r instanceof Kt)&&h===0||r.c(!0)}}tf(){if(this.To())return;this.ue(!0),this.Jn(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].tf()}$c(){if(this.Kb()===!1){this.Zu(!0),this.ka(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].P2()}}P2(){this.ka(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].P2()}Wu(t,i,s,n){const o=this.Bo;o.i(0,0,0,0);const r=this.desiredSize,h=this.minSize;s===void 0&&(s=h.width,n=h.height),s=Math.max(s,h.width),n=Math.max(n,h.height);const a=this.maxSize;isNaN(r.width)||(t=Math.min(r.width,a.width)),isNaN(r.height)||(i=Math.min(r.height,a.height)),t=Math.max(s,t),i=Math.max(n,i);const l=this.Zt;t=Math.max(t-l.left-l.right,0),i=Math.max(i-l.top-l.bottom,0);const u=this.C.r;this.H.measure(this,t,i,u,o,s,n);let c=o.width+l.left+l.right,d=o.height+l.top+l.bottom;isFinite(r.width)&&(c=r.width),isFinite(r.height)&&(d=r.height),c=Math.min(a.width,c),d=Math.min(a.height,d),c=Math.max(h.width,c),d=Math.max(h.height,d),c=Math.max(s,c),d=Math.max(n,d),o.Fn(c,d),this.naturalBounds.Fn(c,d),this.Wn(0,0,c,d)}findMainElement(){if(this.Qr===null){const t=this.C.r,i=t.length;if(i===0)return null;for(let s=0;s<i;s++){const n=t[s];if(n.isPanelMain===!0)return this.Qr=n,n}this.Qr=t[0]}return this.Qr}Uo(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.z2}set panelLayoutState(t){this.z2=t}uh(t,i,s,n){const o=this.C.r;if(this.actualBounds.i(t,i,s,n),!this.desiredSize.isReal()){let r=this.zs(!0);const h=this.measuredBounds,a=h.width,l=h.height,u=this.Wr,c=u.left+u.right,d=u.top+u.bottom;switch(a===s&&l===n&&(r=0),r){case 0:(a>s||l>n)&&(this.c(),this.ht(a>s?s:a,l>n?n:l,0,0));break;case 2:this.c(!0),this.ht(s+c,n+d,0,0);break;case 5:this.c(!0),this.ht(s+c,l+d,0,0);break;case 4:this.c(!0),this.ht(a+c,n+d,0,0);break}}this.H.arrange(this,o,this.Bo)}fh(t){const i=this.naturalBounds,s=this.Uo();if(z.contains(0,0,i.width,i.height,t.x,t.y)){const n=this.C.r,o=n.length,r=S.V(0,0);for(let h=o;h--;){const a=n[h];if(!(!a.visible&&a!==s)&&(r.set(t).Oe(a.T),a.containsPoint(r)))return S.e(r),!0}return S.e(r),this.Lt!==null}return!1}g0(t){if(this.Hn===t)return this;const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].g0(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,i){if(i(this,t),t instanceof nt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++)this.walkVisualTreeFrom(s[o],i)}}Gr(t){this.VA(this,t)}VA(t,i){i(t);const s=t.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r instanceof nt&&this.VA(r,i)}}Dv(t){this.zA(this,t)}zA(t,i){if(i(t),t instanceof nt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++)this.zA(s[o],i)}}findInVisualTree(t){return this.XA(this,t)}XA(t,i){if(i(t))return t;if(t instanceof nt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++){const r=this.XA(s[o],i);if(r!==null)return r}}return null}findObject(t){if(this.name===t)return this;const i=this.C.r;let s=i.length;this.Fv()&&(s=this.lp());for(let n=0;n<s;n++){const o=i[n];if(o instanceof nt){const r=o.findObject(t);if(r!==null)return r}if(o.name===t)return o}return null}YA(){const t=this.C.r,i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];o instanceof nt?s=Math.max(s,o.YA()):o instanceof dt&&(s=Math.max(s,o.Rv()))}return s}an(){return!(this.type===nt.TableRow||this.type===nt.TableColumn)}$r(){return this.type===nt.TableRow||this.type===nt.TableColumn}bL(t,i,s){if(this.pickable===!1||(i===void 0&&(i=null),s===void 0&&(s=null),this._e()))return null;const n=this.naturalBounds,o=1/this.getDocumentScale(),r=this.an(),h=r?t:S.V(t.x,t.y).Oe(this.T),a=this.diagram;let l=10,u=5;if(a!==null&&(l=a.getInputOption("extraTouchArea"),u=l/2),z.contains(-(u*o),-(u*o),n.width+l*o,n.height+l*o,h.x,h.y)){if(!this.af){const d=this.C.r,f=d.length,m=S.l(),p=this.isClipping&&this.H===nt.Spot,y=p?this.findMainElement():null;if(p&&(y.an()?m.set(t).Oe(y.T):m.set(t),!y.containsPoint(m)))return S.e(m),r||S.e(h),null;const x=this.Uo();for(let P=f;P--;){const k=d[P];if(!k.visible&&k!==x||(k.an()?m.set(t).Oe(k.T):m.set(t),p&&k===y))continue;let v=null;if(k instanceof nt?v=k.bL(m,i,s):k.pickable===!0&&k.containsPoint(m)&&(v=k),v!==null&&(i!==null&&(v=i(v)),v!==null&&(s===null||s(v))))return S.e(m),r||S.e(h),v}S.e(m)}if(this.background===null)return r||S.e(h),null;const c=z.contains(0,0,n.width,n.height,h.x,h.y)?this:null;return r||S.e(h),c}return r||S.e(h),null}kL(t,i,s,n){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const o=this.naturalBounds,r=this.an(),h=r?t:S.V(t.x,t.y).Oe(this.T),a=this.$r(),l=z.contains(0,0,o.width,o.height,h.x,h.y);if(a||l){if(!this.af){const u=this.C.r,c=u.length,d=S.l(),f=this.Uo();for(let m=c;m--;){const p=u[m];if(!p.visible&&p!==f)continue;p.an()?d.set(t).Oe(p.T):d.set(t);let y=p;const x=p instanceof nt?p:null;if(x!==null?x.kL(d,i,s,n):y.containsPoint(d)){if(y.pickable===!1)continue;i!==null&&(y=i(y)),y!==null&&(s===null||s(y))&&n.add(y)}}S.e(d)}return r||S.e(h),l&&this.background!==null}return r||S.e(h),!1}Tm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let h=r;if(h===void 0&&(h=Tt.l(),h.Ri()),h.nc(this.T),this.containedInRect(t,h))return this.Y2(i,s,o),r===void 0&&Tt.e(h),!0;if(this.intersectsRect(t,h)){if(!this.af){const a=this.Uo(),l=this.C.r,u=l.length;for(let c=u;c--;){const d=l[c];if(!d.visible&&d!==a)continue;const f=d.actualBounds,m=this.naturalBounds;if(f.x>m.width||f.y>m.height||f.x+f.width<0||f.y+f.height<0)continue;let p=d;const y=d instanceof nt?d:null,x=Tt.l();x.set(h),(y!==null?y.Tm(t,i,s,n,o,x):p.wA(t,n,x))&&(i!==null&&(p=i(p)),p!==null&&(s===null||s(p))&&o.add(p)),Tt.e(x)}}return r===void 0&&Tt.e(h),n}return r===void 0&&Tt.e(h),!1}Y2(t,i,s){const n=this.C.r,o=n.length;for(let r=o;r--;){const h=n[r];if(!h.visible)continue;const a=h.actualBounds,l=this.naturalBounds;if(a.x>l.width||a.y>l.height||a.x+a.width<0||a.y+a.height<0)continue;h instanceof nt&&h.Y2(t,i,s);let u=h;t!==null&&(u=t(u)),u!==null&&(i===null||i(u))&&s.add(u)}}PL(t,i,s,n,o,r){if(this.pickable===!1)return!1;s===void 0&&(s=null),n===void 0&&(n=null);const h=this.naturalBounds,a=this.an(),l=a?t:S.V(t.x,t.y).Oe(this.T),u=a?i:S.V(i.x,i.y).Oe(this.T),c=l.distanceSquaredPoint(u),d=l.x>0&&l.x<h.width&&l.y>0&&l.y<h.height||S.distanceLineSegmentSquared(l.x,l.y,0,0,0,h.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,0,h.height,h.width,h.height)<=c||S.distanceLineSegmentSquared(l.x,l.y,h.width,h.height,h.width,0)<=c||S.distanceLineSegmentSquared(l.x,l.y,h.width,0,0,0)<=c,f=l.distanceSquared(0,0)<=c&&l.distanceSquared(0,h.height)<=c&&l.distanceSquared(h.width,0)<=c&&l.distanceSquared(h.width,h.height)<=c;if(a||(S.e(l),S.e(u)),d){if(!this.af){const m=S.l(),p=S.l(),y=this.Uo(),x=this.C.r,P=x.length;for(let k=P;k--;){const v=x[k];if(!v.visible&&v!==y)continue;const N=v.actualBounds,M=this.naturalBounds;if(a&&(N.x>M.width||N.y>M.height||N.x+N.width<0||N.y+N.height<0))continue;if(v.an()){const T=v.T;m.set(t).Oe(T),p.set(i).Oe(T)}else m.set(t),p.set(i);let C=v;const F=v instanceof nt?v:null;(F!==null?F.PL(m,p,s,n,o,r):C.xA(m,p,o))&&(s!==null&&(C=s(C)),C!==null&&(n===null||n(C))&&r.add(C))}S.e(m),S.e(p)}return o?d:f}return!1}E2(t){let i=null;if(t instanceof dt){i=t.spot1,i===B.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot1)}return i===null&&(i=B.TopLeft),i}U2(t){let i=null;if(t instanceof dt){i=t.spot2,i===B.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot2)}return i===null&&(i=B.BottomRight),i}add(...t){for(let i=0;i<t.length;i++)this.insertAt(this.C.count,t[i]);return this}elt(t){return this.C.elt(t)}insertAt(t,i){i instanceof Lt&&b.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&b.o("Cannot make a Panel contain itself: "+this.toString()),b.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const s=i.panel;if(s!==null&&s!==this&&b.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.H===nt.Grid&&!(i instanceof dt)&&b.o("Can only add Shapes to a Grid Panel, not: "+i),this.H===nt.Graduated&&!(i instanceof dt||i instanceof Kt)&&b.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.Pa(this),i.Jr=null,this.itemArray!==null){const h=i.data;b.G(h)&&(this.Gs===null&&(this.Gs=new bt),this.Gs.set(h,i))}const n=this.C;let o=-1;if(s===this){let h=-1;const a=this.C.r,l=a.length;for(let u=0;u<l;u++)if(a[u]===i){h=u;break}if(h!==-1){if(h===t||h+1>=n.count&&t>=n.count)return;n.removeAt(h),o=h}else b.o("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),(t===0||i.isPanelMain)&&(this.Qr=null),this.To()||this.c(),i.c(!1),i.portId!==null?this.fn=!0:i instanceof nt&&i.fn===!0&&(this.fn=!0),this.ss=null,this.isEnabledObject()||this.i1(i,!1);const r=this.part;if(r!==null){r.A0(),r.cf(),this.fn&&r instanceof st&&(r.fn=!0),r.fn&&r instanceof st&&(r.ne=null);const h=this.diagram;if(h!==null&&h.undoManager.isUndoingRedoing)return;o!==-1&&r.raiseChangedEvent(4,"elements",this,i,null,o,null),r.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get fn(){return(this.n&8388608)!==0}set fn(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}p2(){return(this.n&16777216)!==0}G2(t){t?this.n|=16777216:this.n&=-16777217}Tv(t){t.Pa(this),t.Jr=null;const i=this.C,s=i.count;i.insertAt(s,t);const n=this.part;if(n!==null){n.A0(),t.portId!==null&&n instanceof st&&(n.fn=!0);const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(3,"elements",this,null,t,null,s)}}ZR(t){const i=this.C.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}return n}remove(t){const i=this.C.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}n!==-1&&this.te(n,!0)}removeAt(t){t>=0&&this.te(t,!0)}te(t,i){const s=this.C,n=s.elt(t);if(n.Jr=null,n.Pa(null),this.Gs!==null){const r=n.data;b.G(r)&&this.Gs.delete(r)}s.removeAt(t),this.ue(!1),this.c(),this.Qr===n&&(this.Qr=null),this.ss=null;const o=this.part;if(o!==null){o.A0(),o.cf(),o.invalidateAdornments(),o instanceof st&&(n instanceof nt?n.walkVisualTreeFrom(n,(h,a)=>o.C2(a,i)):o.C2(n,i));const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;o.raiseChangedEvent(4,"elements",this,n,null,t,null)}}get Xe(){return this.F===null&&(this.F=new ae),this.F.Xe}get rowCount(){return this.F===null?0:this.Xe.length}getRowDefinition(t){t<0&&b.W(t,">= 0",nt,"getRowDefinition:idx"),t=Math.round(t);const i=this.Xe;if(i[t]===void 0){const s=new ee;s.Pa(this),s.isRow=!0,s.index=t,i[t]=s,this.raiseChangedEvent(3,"rowdefs",this,null,s,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&b.W(t,">= 0",nt,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const i=this.Xe,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,t,null),this.c()}}$L(t,i){const s=this.Xe;if(!(t<0)){if(s[t]=i instanceof ee?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}get Ye(){return this.F===null&&(this.F=new ae),this.F.Ye}get columnCount(){return this.F===null?0:this.Ye.length}getColumnDefinition(t){t<0&&b.W(t,">= 0",nt,"getColumnDefinition:idx"),t=Math.round(t);const i=this.Ye;if(i[t]===void 0){const s=new ee;s.Pa(this),s.isRow=!1,s.index=t,i[t]=s,this.raiseChangedEvent(3,"coldefs",this,null,s,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&b.W(t,">= 0",nt,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const i=this.Ye,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,t,null),this.c()}}ZL(t,i){const s=this.Ye;if(!(t<0)){if(s[t]=i instanceof ee?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}addRowColumnDefinition(t){let i=null;return t.isRow?i=this.getRowDefinition(t.index):t.isRow||(i=this.getColumnDefinition(t.index)),i&&i.Hb(t),this}addRowDefinition(t,i){const s=this.getRowDefinition(t);return s&&s.Hb(new ee(i)),this}addColumnDefinition(t,i){const s=this.getColumnDefinition(t);return s&&s.Hb(new ee(i)),this}get rowSizing(){return this.F!==null?this.F.hp:3}set rowSizing(t){const i=this.rowSizing;i!==t&&(this.F===null&&(this.F=new ae),this.F.hp=t,this.c(),this.t("rowSizing",i,t))}get columnSizing(){return this.F!==null?this.F.ap:3}set columnSizing(t){const i=this.columnSizing;i!==t&&(this.F===null&&(this.F=new ae),this.F.ap=t,this.c(),this.t("columnSizing",i,t))}get topIndex(){return this.F!==null?this.F.cp:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&b.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.F===null&&(this.F=new ae),this.F.cp=t,this.c(),this.t("topIndex",i,t))}get leftIndex(){return this.F!==null?this.F.fp:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&b.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.F===null&&(this.F=new ae),this.F.fp=t,this.c(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==nt.Table||this.rowCount===0)return-1;let i=0;const s=this.Xe,n=s.length;let o=this.topIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}findColumnForLocalX(t){if(t<0||this.type!==nt.Table||this.columnCount===0)return-1;let i=0;const s=this.Ye,n=s.length;let o=this.leftIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}graduatedPointForValue(t,i){if(i===void 0&&(i=new S(NaN,NaN)),this.type!==nt.Graduated)return i.i(NaN,NaN),i;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const s=this.findMainElement();return s.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,i),s.T.gt(i)}graduatedValueForPoint(t){if(this.type!==nt.Graduated)return NaN;const i=this.findMainElement();return i.T.$e(t),i.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this._t}set data(t){const i=this._t;if(i!==t){const s=this instanceof Lt&&!(this instanceof yt);s&&b.s(t,"object",nt,"data"),this.Et(),this._t=t;const n=this.diagram;if(n!==null)if(s)n.partManager.vv(this,i,t);else{const o=this.panel;o!==null&&o.Gs!==null&&(i!==null&&o.Gs.delete(i),t!==null&&o.Gs.set(t,this))}if(this.t("data",i,t),n!==null&&n.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.rd}set itemIndex(t){const i=this.rd;i!==t&&(this.rd=t,this.t("itemIndex",i,t))}get Ys(){return this.p!==null?this.p.Ys:null}set Ys(t){this.Ci!==t&&(this.p===null&&(this.p=new oi),this.p.Ys=t)}L2(){return this.Ys!==null}AA(){const t=this.Ys;return t!==null&&t.h}freezeBindings(){return this.Et()}Et(){let t=this.Ys;if(t===null)this.data!==null&&b.o("Template cannot have .data be non-null: "+this),this.Ys=t=new J;else if(t.h)return this;const i=new J;this.G2(!1),this.walkVisualTreeFrom(this,(o,r)=>{r.ch();const h=r.Ci;if(h!==null){r.S2(!1);const a=h.iterator;for(;a.next();){const l=a.value;l.mode===2&&r.S2(!0);const u=l.sourceName;if(l.isToObject){u==="/"&&o.G2(!0);const c=l.yA(o,r);c!==null&&(i.add(c),c.qn===null&&(c.qn=new J),c.qn.add(l))}t.add(l)}}if(r instanceof nt&&r.type===nt.Table){if(r.rowCount>0){const a=r.Xe,l=a.length;for(let u=0;u<l;u++){const c=a[u];if(c!==void 0&&c.bs!==null){const d=c.bs.iterator;for(;d.next();){const f=d.value;f.be=c,f.ad=2,f.ff=c.index,t.add(f)}}}}if(r.columnCount>0){const a=r.Ye,l=a.length;for(let u=0;u<l;u++){const c=a[u];if(c!==void 0&&c.bs!==null){const d=c.bs.iterator;for(;d.next();){const f=d.value;f.be=c,f.ad=1,f.ff=c.index,t.add(f)}}}}}});const s=i.iterator;for(;s.next();){const o=s.value;if(o.qn!==null){o.S2(!0);const r=o.qn.iterator;for(;r.next();){const h=r.value;o.Ci===null&&(o.Ci=new J),o.Ci.add(h)}}o.qn=null}let n=t.iterator;for(;n.next();){const o=n.value;let r=o.be;if(r!==null){o.be=null;const h=o.targetProperty,a=h.indexOf(".");if(a>0&&r instanceof nt){const l=h.substring(0,a),u=h.substring(a+1),c=r.findObject(l);c!==null?(r=c,o.targetProperty=u):(b.ni('Warning: unable to find GraphObject named "'+l+'" for Binding: '+o.toString()),r=null)}if(r instanceof ee){const l=K.as(r.panel);o.targetId=l===void 0?-1:l,r.panel.Hn=o.targetId}else if(r instanceof Ct){const l=K.as(r);o.targetId=l===void 0?-1:l,r.Hn=o.targetId}else b.o("Unknown type of binding target: "+r);o.check(r)}}return t.u(),this instanceof Lt&&this.ke()&&this.ensureBounds(),this}copyTemplate(t){t===void 0&&(t=!1);const i=this.copy();return i.Dv(s=>{s instanceof nt&&(s.Ys=null,s._t=null);const n=s.Ci;n!==null&&(s.Ci=null,n.each(r=>s.bind(r.copy())));const o=s.ws;o!==null&&(s.ws=null,o.each(r=>s.trigger(r.value.copy())))}),t&&i.Et(),i}updateTargetBindings(t){var o;const i=this.Ys;if(i===null)return;t===void 0&&(t="");const s=(o=this.diagram)==null?void 0:o.model,n=i.iterator;for(;n.next();){const r=n.value,h=this.GA(r,t);if(h===null)continue;const{data:a,elt:l}=h;r.isToTheme&&this.diagram===null||l!==void 0&&r.updateTarget(l,a,void 0,s)}}Do(){if(this.diagram!==null)if(this.L2()){const t=this.diagram.model,i=this.Ys.iterator;for(;i.next();){const s=i.value;if(!s.isToTheme)continue;const n=this.GA(s);if(n===null)continue;const{data:o,elt:r}=n;r!==void 0&&s.updateTarget(r,o,void 0,t)}}else{const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Do()}}GA(t,i=""){const s=t.sourceProperty;if(i!==""&&s!==""&&s!==i)return null;const n=t.targetProperty;if(t.converter===null&&n==="")return null;let o=this.data;const r=t.sourceName;if(t.isToObject){if(o=this.pA(r),o===null)return null}else if(t.isToModel){const u=this.diagram;if(u===null)return null;o=u.model.modelData}let h=this;const a=t.targetId;if(a!==-1){if(h=this.g0(a),h===null)return null}else t.be!==null&&(h=t.be);r==="/"?o=h.part:r==="."?o=h:r===".."&&(o=h.panel);const l=t.ad;if(l!==0){if(!(h instanceof nt))return null;l===1?h=h.getColumnDefinition(t.ff):l===2&&(h=h.getRowDefinition(t.ff))}return{data:o,elt:h}}get itemArray(){return this.wh}set itemArray(t){const i=this.wh;if(i!==t||t!==null&&this.Ov(t)){const s=this.diagram;if(i!==t&&(s!==null&&i!==null&&s.partManager.EM(this,s),this.wh=t,s!==null&&t!==null&&s.partManager.IM(this,s)),this.t("itemArray",i,t),s!==null&&s.undoManager.isUndoingRedoing)return;this.KA(i,t)}}findItemPanelForData(t){return t==null||this.Gs===null?null:(b.ec(t,nt,"findItemPanelForData"),this.Gs.get(t))}Ov(t){const i=this.C.r,s=i.length,n=t.length;let o=0,r=null;for(;o<s&&(r=i[o],!(r instanceof nt)||r.data===null);)o++,r=i[o];if(s-o!==n)return!0;if(r===null)return n>0;let h=0;for(;o<s&&h<n;){if(r=i[o],!(r instanceof nt)||r.data!==t[h])return!0;o++,h++}return!1}lp(){if(this.type===nt.Spot||this.type===nt.Auto)return Math.min(this.C.length,1);if(this.type===nt.Link){const t=this.C,i=t.length;let s=0;for(;s<i;s++){const n=t.elt(s);if(!(n instanceof dt)||!n.isPanelMain)return s}return s}if(this.type===nt.Table&&this.C.length>0){const t=this.C.elt(0);if(t.isPanelMain&&t instanceof nt&&t.$r())return 1}return 0}rebuildItemElements(){const t=this.lp();for(;this.C.length>t;)this.te(this.C.length-1,!1);this.KA(null,this.itemArray)}KA(t,i){const s=this.lp(),n=i;if(n===null||n.length===0){for(;this.C.length>s;)this.te(this.C.length-1,!1);return}if(this.C.length<=s){const o=n.length;for(let r=0;r<o;r++)this.e1(n[r],r,!0)}else{let o=s;for(let h=0;h<n.length;h++,o++){const a=n[h],l=o<this.C.length?this.C.elt(o):null;if(l instanceof nt){if(l.data!==a){const u=this.K2(l.data,h),c=this.K2(a,h);let d=c!==u;if(!d){const f=this.j2(l.data,h,u);d=this.j2(a,h,c)!==f}d?(this.te(o,!1),this.e1(a,h,!1)):l.data=a}}else this.e1(a,h,!1)}for(;o<this.C.length;)this.te(o,!1);this.Qr=null,this.H2(s,0),this.To()||this.c(),this.ss=null,this.isEnabledObject()||this.i1(this,!1);const r=this.part;r!==null&&(r.A0(),r.cf(),this.fn&&r instanceof st&&(r.fn=!0),r.fn&&r instanceof st&&(r.ne=null))}}e1(t,i,s){if(t==null||i<0)return null;const n=this.K2(t,i),o=this.j2(t,i,n);if(o!==null){o.Et();const r=o.copy();if(r.p2()){const a=this.findBindingPanel();a!==null&&a.G2(!0)}b.G(t)&&(this.Gs===null&&(this.Gs=new bt),this.Gs.set(t,r));const h=i+this.lp();return this.insertAt(h,r),s&&(r._t=t,this.H2(h,i),r._t=null),r.data=t,r}return null}Iv(t){if(t<0)return;const i=t+this.lp();this.te(i,!0),this.H2(i,t)}H2(t,i){const s=this.C;let n=t,o=i;for(;n<s.length;){const r=s.elt(n);r instanceof nt&&r.Ev(n,o),n++,o++}}Ev(t,i){this.type===nt.TableRow?this.row=t:this.type===nt.TableColumn&&(this.column=t),this.itemIndex=i}Fv(){return this.wh!==null||this.itemTemplateMap!==null}get itemTemplate(){return this.itemTemplateMap===null?null:this.itemTemplateMap.get("")}set itemTemplate(t){if(this.itemTemplateMap===null){if(t===null)return;this.itemTemplateMap=new bt}const i=this.itemTemplateMap.get("");if(i!==t){(t instanceof Lt||t.isPanelMain)&&b.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.p!==null?this.p.G0:null}set itemTemplateMap(t){const i=this.itemTemplateMap;if(i!==t){const s=t.iterator;for(;s.next();)s.value;this.Kt().G0=t,this.t("itemTemplateMap",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.p!==null?this.p.K0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&(typeof t!="string"&&!b.it(t)&&b.Zi(t,"string or function",nt,"itemCategoryProperty"),this.Kt().K0=t,this.t("itemCategoryProperty",i,t))}K2(t,i){if(t===null)return"";const s=this.itemCategoryProperty;let n="";if(b.it(s))n=s(t);else if(typeof s=="string"&&b.G(t)){if(s==="")return"";const o=this.diagram,r=o!==null?o.model:null;r?n=r.yt(t,s):n=It.yt(t,s)}else return"";if(n===void 0)return"";if(typeof n=="string")return n;b.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+n)}j2(t,i,s){const n=this.itemTemplateMap;let o=null;return n!==null&&(o=n.get(s)),o===null&&(n!==null&&(o=n.get("")),o===null&&(nt.jA||(nt.jA=!0,b.ni('No item template Panel found for category "'+s+'" on '+this),b.ni("  Using default item template."),nt.HA=new nt().add(new Kt().bind("text","",b.toString).theme("stroke","text"))),o=nt.HA)),o}get af(){return(this.n&1048576)!==0}set af(t){const i=(this.n&1048576)!==0;i!==t&&(b.s(t,"boolean",nt,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",i,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const i=(this.n&2097152)!==0;i!==t&&(this.Qc(),this.n=this.n^2097152,this instanceof ut&&(this.si=null),this.c(),this.t("isClipping",i,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const i=(this.n&33554432)!==0;i!==t&&(this.n=this.n^33554432,this.c(),this.t("isOpposite",i,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const i=(this.n&4194304)!==0;if(i!==t){const s=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s&&this.i1(this,t)}}i1(t,i){const s=t.enabledChanged;if(s!==null&&s(t,i),t instanceof nt){const n=t.C.r,o=n.length;for(let r=0;r<o;r++){const h=n[r];i&&h instanceof nt&&!h.isEnabled||this.i1(h,i)}}}get alignmentFocusName(){return this.to}set alignmentFocusName(t){const i=this.to;i!==t&&(this.to=t,this.c(),this.t("alignmentFocusName",i,t))}static definePanelLayout(t,i){Nt.dn(t,i)}static isBuilderDefined(t){return Nt.es.has(t)}};g(nt,"FE",!1),g(nt,"jA",!1),g(nt,"HA",null),g(nt,"Position",Nt.es.get("Position")),g(nt,"Horizontal",Nt.es.get("Horizontal")),g(nt,"Vertical",Nt.es.get("Vertical")),g(nt,"Spot",Nt.es.get("Spot")),g(nt,"Auto",Nt.es.get("Auto")),g(nt,"Table",Nt.es.get("Table")),g(nt,"Viewbox",Nt.es.get("Viewbox")),g(nt,"TableRow",Nt.es.get("TableRow")),g(nt,"TableColumn",Nt.es.get("TableColumn")),g(nt,"Link",Nt.es.get("Link")),g(nt,"Grid",Nt.es.get("Grid")),g(nt,"Graduated",Nt.es.get("Graduated"));let rt=nt;rt.definePanelLayout=rt.definePanelLayout;class Ve{constructor(){g(this,"sp");g(this,"np");g(this,"op");g(this,"rp");g(this,"xs");g(this,"Ge");g(this,"ss");g(this,"Pe");this.sp=0,this.np=100,this.op=10,this.rp=0,this.xs=null,this.Ge=null,this.ss=null,this.Pe=null}copy(){const e=new Ve;return e.sp=this.sp,e.np=this.np,e.op=this.op,e.rp=this.rp,e.xs=this.xs,e.Ge=this.Ge,e.ss=this.ss,e.Pe=this.Pe,e}}class fi{constructor(){g(this,"ld");g(this,"hd");g(this,"Yc");g(this,"J0");this.ld=ot.wC,this.hd=S.xo,this.Yc=ot.ww,this.J0=[]}copy(){const e=new fi;return e.ld=this.ld.copy(),e.hd=this.hd.copy(),e.Yc=this.Yc.copy(),e.J0=this.J0,e}}class ae{constructor(){g(this,"Xe");g(this,"Ye");g(this,"hp");g(this,"ap");g(this,"cp");g(this,"fp");g(this,"$0");g(this,"Q0");g(this,"Z0");g(this,"_0");g(this,"ip");g(this,"tp");g(this,"ep");g(this,"yh");this.Xe=[],this.Ye=[],this.hp=3,this.ap=3,this.cp=0,this.fp=0,this.$0=Ot.Rg,this.Q0=1,this.Z0=null,this._0=null,this.ip=1,this.tp=null,this.ep=null,this.yh=null}copy(e){const t=new ae,i=this.Xe,s=i.length,n=t.Xe;for(let a=0;a<s;a++){if(i[a]===void 0)continue;const l=i[a].copy();l.Pa(e),n[a]=l}const o=this.Ye,r=o.length,h=t.Ye;for(let a=0;a<r;a++){if(o[a]===void 0)continue;const l=o[a].copy();l.Pa(e),h[a]=l}return t.hp=this.hp,t.ap=this.ap,t.cp=this.cp,t.fp=this.fp,t.$0=this.$0.P(),t.Q0=this.Q0,t.Z0=this.Z0,t._0=this._0,t.ip=this.ip,t.tp=this.tp,t.ep=this.ep,t.yh=this.yh,t}}var ns=(w=>(w[w.Default=1]="Default",w[w.None=2]="None",w[w.ProportionalExtra=3]="ProportionalExtra",w))(ns||{});const Ce=class Ce{constructor(e){g(this,"Vs");g(this,"dp");g(this,"At");g(this,"Ca");g(this,"La");g(this,"hi");g(this,"at");g(this,"cd");g(this,"$n");g(this,"_r");g(this,"fd");g(this,"ud");g(this,"Aa");g(this,"Lt");g(this,"dd");g(this,"bs");g(this,"_");g(this,"Ai");g(this,"de");K.Ki(this),this.Vs=null,this.dp=!0,this.At=0,this.de=NaN,this.Ca=0,this.La=1/0,this.hi=B.Default,this._=0,this.Ai=0,this.at=0,this.bs=null,this.cd=1,this.$n=1,this._r=null,this.fd=null,this.ud=NaN,this.Aa=null,this.Lt=null,this.dd=!1,e&&(Object.assign(this,e),e.column!==void 0?(this.isRow=!1,this.index=e.column):e.row!==void 0&&(this.isRow=!0,this.index=e.row))}copy(){const e=new Ce;return e.dp=this.dp,e.At=this.At,e.de=this.de,e.Ca=this.Ca,e.La=this.La,e.hi=this.hi,e._=this._,e.Ai=this.Ai,e.at=this.at,e.$n=this.$n,e.cd=this.cd,this._r===null?e._r=null:e._r=this._r.P(),e.fd=this.fd,e.ud=this.ud,e.Aa=null,this.Aa!==null&&(e.separatorDashArray=this.Aa.slice()),e.Lt=this.Lt,e.dd=this.dd,e.bs=this.bs,e}Hb(e){e.isRow?e.height!==void 0&&(this.height=e.height):e.width!==void 0&&(this.width=e.width),e.minimum!==void 0&&(this.minimum=e.minimum),e.maximum!==void 0&&(this.maximum=e.maximum),e.alignment!==void 0&&(this.alignment=e.alignment),e.stretch!==void 0&&(this.stretch=e.stretch),e.sizing!==void 0&&(this.sizing=e.sizing),e.separatorPadding!==void 0&&(this.separatorPadding=e.separatorPadding),e.separatorStroke!==void 0&&(this.separatorStroke=e.separatorStroke),e.separatorStrokeWidth!==void 0&&(this.separatorStrokeWidth=e.separatorStrokeWidth),e.separatorDashArray!==void 0&&(this.Aa=e.separatorDashArray),e.background!==void 0&&(this.background=e.background),e.coversSeparators!==void 0&&(this.coversSeparators=e.coversSeparators),e.bs!==void 0&&(this.bs=e.bs)}oi(e){e in ns?this.sizing=e:b.er(this,e)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+K.as(this)}Pa(e){this.Vs=e}computeEffectiveSpacingTop(e){let t=0;const i=this.Vs;if(this.index!==e){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(i!==null?t=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:t=0))}let s=this._r;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return t;return t+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let e=0;const t=this.Vs;let i=0;const s=this.isRow;if(t!==null&&t.type===rt.Table){const o=s?t.Xe.length:t.Ye.length;for(let r=0;r<o;r++){const h=s?t.Xe[r]:t.Ye[r];if(h!==void 0&&h._!==0){i=h.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&t!==null&&(o=s?t.defaultRowSeparatorStroke:t.defaultColumnSeparatorStroke),o!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(t!==null?e=s?t.defaultRowSeparatorStrokeWidth:t.defaultColumnSeparatorStrokeWidth:e=0))}let n=this._r;if(n===null)if(t!==null)n=t.defaultSeparatorPadding;else return e;return e+(this.isRow?n.top+n.bottom:n.left+n.right)}t(e,t,i,s,n){const o=this.Vs;if(o!==null&&(o.raiseChangedEvent(2,e,this,t,i,s,n),this.bs!==null)){const r=o.diagram;if(r!==null&&!r.fe){const h=o.findBindingPanel();if(h!==null){const a=h.data;if(a!==null){const l=this.bs.iterator;for(;l.next();)l.value.updateSource(this,a,e,h)}}}}}get panel(){return this.Vs}get isRow(){return this.dp}set isRow(e){this.dp=e}get index(){return this.At}set index(e){this.At=e}get height(){return this.de}set height(e){const t=this.de;t!==e&&(e<0&&b.W(e,">= 0",Ce,"height"),this.de=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("height",t,e))}get width(){return this.de}set width(e){const t=this.de;t!==e&&(e<0&&b.W(e,">= 0",Ce,"width"),this.de=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("width",t,e))}get minimum(){return this.Ca}set minimum(e){const t=this.Ca;t!==e&&((e<0||!isFinite(e))&&b.W(e,">= 0",Ce,"minimum"),this.Ca=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("minimum",t,e))}get maximum(){return this.La}set maximum(e){const t=this.La;t!==e&&(e<0&&b.W(e,">= 0",Ce,"maximum"),this.La=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("maximum",t,e))}get alignment(){return this.hi}set alignment(e){const t=this.hi;t.equals(e)||(this.hi=e.P(),this.panel!==null&&this.panel.c(),this.t("alignment",t,e))}get stretch(){return this.$n}set stretch(e){const t=this.$n;t!==e&&(this.$n=e,this.panel!==null&&this.panel.c(),this.t("stretch",t,e))}get separatorPadding(){return this._r}set separatorPadding(e){typeof e=="number"&&(e=new Ot(e));const t=this._r;(e===null||t===null||!t.equals(e))&&(e!==null&&(e=e.P()),this._r=e,this.panel!==null&&this.panel.c(),this.t("separatorPadding",t,e))}get separatorStroke(){return this.fd}set separatorStroke(e){const t=this.fd;t!==e&&(e!==null&&Ft.Qu(e,"RowColumnDefinition.separatorStroke"),e instanceof Ft&&e.u(),this.fd=e,this.panel!==null&&this.panel.c(),this.t("separatorStroke",t,e))}get separatorStrokeWidth(){return this.ud}set separatorStrokeWidth(e){const t=this.ud;t!==e&&(this.ud=e,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",t,e))}get separatorDashArray(){return this.Aa}set separatorDashArray(e){const t=this.Aa;if(t!==e){if(e!==null&&!Array.isArray(e)&&b.Zi(e,"Array",Ce,"separatorDashArray:value"),e!==null){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&b.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(t===null)return;e=null}}this.Aa=e,this.panel!==null&&this.panel.S(),this.t("separatorDashArray",t,e)}}get background(){return this.Lt}set background(e){const t=this.Lt;t!==e&&(e!==null&&Ft.Qu(e,"RowColumnDefinition.background"),e instanceof Ft&&e.u(),this.Lt=e,this.panel!==null&&this.panel.S(),this.t("background",t,e))}get coversSeparators(){return this.dd}set coversSeparators(e){const t=this.dd;t!==e&&(b.s(e,"boolean",Ce,"coversSeparators"),this.dd=e,this.panel!==null&&this.panel.S(),this.t("coversSeparators",t,e))}get sizing(){return this.cd}set sizing(e){const t=this.cd;t!==e&&(this.cd=e,this.panel!==null&&this.panel.c(),this.t("sizing",t,e))}Qb(){if(this.sizing===1){const e=this.Vs;return this.isRow?e.rowSizing:e.columnSizing}return this.sizing}get actual(){return this._}set actual(e){isNaN(this.de)?this._=Math.max(Math.min(this.La,e),this.Ca):this._=Math.max(Math.min(this.La,this.de),this.Ca)}get measured(){return this.Ai}set measured(e){this.Ai=e}get total(){return this._+this.computeEffectiveSpacing()}get position(){return this.at}set position(e){this.at=e}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){const n=this.sf(e,t,i,s);return s===void 0&&n.makeTwoWay(),this}theme(e,t,i,s,n){return this.mh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.mh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.mh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.mh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n;return typeof e=="string"?n=new Ke(e,t,i,s):n=e,this.Y0(n),n}mh(e,t,i,s,n){let o;return typeof e=="string"?o=new yi(e,t,i,s,n):o=e,this.Y0(o),o}Y0(e){e.be=this;const t=this.panel;if(t!==null){const i=t.findBindingPanel();i!==null&&i.AA()&&b.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+e+" on "+t)}this.bs===null&&(this.bs=new J),this.bs.add(e)}};g(Ce,"Default",1),g(Ce,"None",2),g(Ce,"ProportionalExtra",3);let ee=Ce;const Bt=class Bt extends Ct{constructor(t,i){super();g(this,"ot");g(this,"ks");g(this,"gd");g(this,"Ta");g(this,"ji");g(this,"Vo");g(this,"Io");g(this,"jt");g(this,"md");g(this,"pd");g(this,"K");this.ot=null,this.ks=null,this.gd="None",this.Ta="black",this.ji="black",this.Vo=1,this.Io=null,this.jt=null,this.md=NaN,this.pd=NaN,this.K=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.ot=this.ot,t.ks=this.ks,t.gd=this.gd,t.Ta=this.Ta,t.ji=this.ji,t.Vo=this.Vo,this.Io!==null&&(t.Io=this.Io.slice()),this.jt!==null&&(this.jt.fi?t.jt=this.jt:t.jt=this.jt.copy()),t.md=this.md,t.pd=this.pd,this.K!==null&&(t.K=this.K.copy())}Da(){return this.jt===null?this.jt=new os:this.jt.fi&&(this.jt=this.jt.copy()),this.jt}ch(){super.ch(),this.jt!==null&&(this.jt.fi=!0)}oi(t){t in $i?this.geometryStretch=t:super.oi(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+K.as(this)}Uv(t,i){const s=this.pathPattern;s.ht(1/0,1/0);const n=s.measuredBounds;s.Bt(0,0,n.width,n.height);const o=this.geometry;t.save(),t.beginPath();const r=b.et();if(o.type===1)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.endY),this.yd(t,i,r,s);else if(o.type===4){const h=o.figures.iterator;for(;h.next();){const a=h.value;r.length=0,r.push(a.startX),r.push(a.startY);let l=a.startX,u=a.startY,c=l,d=u;const f=a.segments.r,m=f.length;for(let p=0;p<m;p++){const y=f[p];switch(y.type){case 1:this.yd(t,i,r,s),r.length=0,r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY,c=l,d=u;break;case 2:r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY;break;case 3:A.vn(l,u,y.point1X,y.point1Y,y.point2X,y.point2Y,y.endX,y.endY,.5,r),l=y.endX,u=y.endY;break;case 4:A.Og(l,u,y.point1X,y.point1Y,y.endX,y.endY,.5,r),l=y.endX,u=y.endY;break;case 5:{const x=y.bo(a),P=x.length;if(P===0){r.push(y.centerX),r.push(y.centerY),l=y.centerX,u=y.centerY;break}for(let k=0;k<P;k++){const v=x[k];A.vn(l,u,v[2],v[3],v[4],v[5],v[6],v[7],.5,r),l=v[6],u=v[7]}break}case 6:{const x=y.Bh(a,l,u),P=x.length;if(P===0){r.push(y.endX),r.push(y.endY),l=y.endX,u=y.endY;break}for(let k=0;k<P;k++){const v=x[k];A.vn(l,u,v[2],v[3],v[4],v[5],v[6],v[7],.5,r),l=v[6],u=v[7]}break}default:b.o("Segment not of valid type: "+y.type)}y.isClosed&&(r.push(c),r.push(d),this.yd(t,i,r,s))}this.yd(t,i,r,s)}}else if(o.type===2)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.startY),r.push(o.endX),r.push(o.endY),r.push(o.startX),r.push(o.endY),r.push(o.startX),r.push(o.startY),this.yd(t,i,r,s);else if(o.type===3){const h=new qt;h.startX=o.endX,h.startY=(o.startY+o.endY)/2;const a=new pt(5);a.startAngle=0,a.sweepAngle=360,a.centerX=(o.startX+o.endX)/2,a.centerY=(o.startY+o.endY)/2,a.radiusX=Math.abs(o.startX-o.endX)/2,a.radiusY=Math.abs(o.startY-o.endY)/2,h.add(a);const l=a.bo(h),u=l.length;if(u===0)r.push(a.centerX),r.push(a.centerY);else{let c=h.startX,d=h.startY;for(let f=0;f<u;f++){const m=l[f];A.vn(c,d,m[2],m[3],m[4],m[5],m[6],m[7],.5,r),c=m[6],d=m[7]}}this.yd(t,i,r,s)}b.J(r),t.restore(),t.clearContextCache(!1)}Bv(t){let i=t.measuredBounds.width;return t instanceof Bt&&(i-=t.strokeWidth),i<1&&(i=1),i}yd(t,i,s,n){const o=s.length;if(o<4)return;const r=n.measuredBounds,h=Math.max(1,r.width),a=r.height;let l=s[0],u=s[1],c=0,d=0,f=0,m=0,p=0,y=0,x=0,P=0;const k=b.et();for(let D=2;D<o;D+=2)c=s[D],d=s[D+1],f=c-l,m=d-u,f===0&&(f=.001),p=m/f,y=Math.atan2(m,f),x=Math.sqrt(f*f+m*m),k.push([f,y,p,x]),P+=x,l=c,u=d;l=s[0],u=s[1];const v=this.Bv(n);let N=v;const M=h/2;let C=M!==0,F=0,T=k[F];f=T[0],y=T[1],p=T[2],x=T[3];let L=0;for(;P>=.1;){if(L===0&&(C?(N=v,N-=M,P-=M,C=!1):N=v,N===0&&(N=1)),N>P){N=P,b.J(k);return}N>x?(L=N-x,N=x):L=0;let D=Math.sqrt(N*N/(1+p*p));if(f<0&&(D=-D),l+=D,u+=p*D,t.translate(l,u),t.rotate(y),t.translate(-(h/2),-(a/2)),L===0&&n.gh(t,i),t.translate(h/2,a/2),t.rotate(-y),t.translate(-l,-u),P-=N,x-=N,L!==0){if(F++,F===k.length){b.J(k);return}T=k[F],f=T[0],y=T[1],p=T[2],x=T[3],N=L}}b.J(k)}gh(t,i){const s=t instanceof ge;let n=this.ji;const o=this.Ta;if(n===null&&o===null)return;const r=this.ot;if(r===null)return;t.commitTransform();const h=this.actualBounds,a=this.naturalBounds;o!==null&&this.rn(t,o,!0,!1,a,h);const l=this.part;let u=this.Vo;n!==null&&u===0&&l!==null&&(this.isPanelMain||l.findMainElement()===this)&&(u=l.Vv()),u===0&&(n=null),n!==null&&u!==0&&(this.rn(t,n,!1,!1,a,h),t.lineWidth=u,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let c=!1;l&&i.getRenderingHint("drawShadows")&&(c=l.isShadowed),t.Zr===!1&&(c=!1);let d=!0;n!==null&&(o===null||o==="transparent")&&(d=!1);let f=!1;const m=this.strokeDashArray;if(m!==null&&(f=!0,t.enableDash(m,this.strokeDashOffset)),r.type===1)t.beginPath(),t.moveTo(r.startX,r.startY),t.lineTo(r.endX,r.endY),n!==null&&t.strokeContext(),t.endPath();else if(r.type===2){const p=r.startX,y=r.startY,x=r.endX,P=r.endY,k=Math.min(p,x),v=Math.min(y,P),N=Math.abs(x-p),M=Math.abs(P-y);t.beginPath(),t.rect(k,v,N,M),o!==null&&t.fillContext(o,!1,null),n!==null&&(d&&c&&t.shadowsOff(),t.strokeContext(),d&&c&&t.shadowsOn()),t.endPath()}else if(r.type===3){const p=r.startX,y=r.startY,x=r.endX,P=r.endY,k=Math.abs(x-p)/2,v=Math.abs(P-y)/2,N=Math.min(p,x)+k,M=Math.min(y,P)+v;t.beginPath(),t.moveTo(N,M-v),t.bezierCurveTo(N+A.Rn*k,M-v,N+k,M-A.Rn*v,N+k,M),t.bezierCurveTo(N+k,M+A.Rn*v,N+A.Rn*k,M+v,N,M+v),t.bezierCurveTo(N-A.Rn*k,M+v,N-k,M+A.Rn*v,N-k,M),t.bezierCurveTo(N-k,M-A.Rn*v,N-A.Rn*k,M-v,N,M-v),t.closePath(),o!==null&&t.fillContext(o,!1,null),n!==null&&(d&&c&&t.shadowsOff(),t.strokeContext(),d&&c&&t.shadowsOn()),t.endPath()}else if(r.type===4){const p=r.figures,y=p.length;for(let x=0;x<y;x++){const P=p.r[x];s?(t.beginPath(),this.buildPath(t,P)):P.Ee===null&&(P.Ee=new Path2D,this.buildPath(P.Ee,P));const k=P.isFilled;c?P.isShadowed?(k===!0&&o!=="transparent"&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Ee),n!==null&&(k&&d&&t.shadowsOff(),t.stroke(P.Ee),k&&d&&t.shadowsOn())):(t.shadowsOff(),k&&o!=="transparent"&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Ee),n!==null&&t.stroke(P.Ee),t.shadowsOn()):(k&&o!==null&&t.fillContext(o,P.isEvenOdd,P.Ee),n!==null&&t.stroke(P.Ee)),t.endPath(x)}}f&&t.disableDash(),this.pathPattern!==null&&this.Uv(t,i)}buildPath(t,i){t.moveTo(i.startX,i.startY);const s=i.segments.r,n=s.length;let o=null;for(let r=0;r<n;r++){const h=s[r];switch(h.type){case 1:t.moveTo(h.endX,h.endY);break;case 2:t.lineTo(h.endX,h.endY);break;case 3:t.bezierCurveTo(h.point1X,h.point1Y,h.point2X,h.point2Y,h.endX,h.endY);break;case 4:t.quadraticCurveTo(h.point1X,h.point1Y,h.endX,h.endY);break;case 5:if(h.radiusX===h.radiusY){const a=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY,u=Math.PI/180;t.arc(h.point1X,h.point1Y,h.radiusX,h.startAngle*u,(h.startAngle+h.sweepAngle)*u,h.sweepAngle<0,a,l)}else{const a=h.bo(i),l=a.length;if(l===0){t.lineTo(h.centerX,h.centerY);break}for(let u=0;u<l;u++){const c=a[u];u===0&&t.lineTo(c[0],c[1]),t.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7])}}break;case 6:{let a=0,l=0,u;if(o!==null&&o.type===5){u=o.bo(i);const d=u.length;if(d===0){t.lineTo(h.endX,h.endY);break}const f=u[d-1]||null;f!==null&&(a=f[6],l=f[7])}else a=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY;u=h.Bh(i,a,l);const c=u.length;if(c===0){t.lineTo(h.endX,h.endY);break}for(let d=0;d<c;d++){const f=u[d];t.bezierCurveTo(f[2],f[3],f[4],f[5],f[6],f[7])}break}}h.isClosed&&t.closePath(),o=h}}Zc(t,i,s){if(!super.Zc(t,i,s)||this.ji===null&&this.Ta===null||this.ot===null||this.pathPattern!==null)return!1;const n=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==n.length?!1:(t.currentPath=this.svg,this.gh(t,i),t.currentPath=null,!0)}$u(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.$u(t)}k2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("path");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}getDocumentPoint(t,i){if(i===void 0&&(i=new S),t instanceof B){const s=t;s.isNoSpot()&&b.o("getDocumentPoint Spot must be a real, specific Spot, not: "+s.toString());const n=this.naturalBounds,o=this.strokeWidth;return i.i(s.x*(n.width+o)-o/2+n.x+s.offsetX,s.y*(n.height+o)-o/2+n.y+s.offsetY),this.Us.gt(i),i}else return i.set(t),this.Us.gt(i),i}getDocumentBounds(t){t===void 0&&(t=new z);const i=this.naturalBounds,s=this.Us,n=z.V(i.x,i.y,i.width,i.height),o=this.strokeWidth;n.inflate(o/2,o/2);const r=S.V(n.x,n.y).T(s);return t.i(r.x,r.y,0,0),r.i(n.right,n.y).T(s),t.unionNoCheck(r.x,r.y,0,0),r.i(n.right,n.bottom).T(s),t.unionNoCheck(r.x,r.y,0,0),r.i(n.x,n.bottom).T(s),t.unionNoCheck(r.x,r.y,0,0),z.e(n),S.e(r),t}fh(t,i){const s=this.geometry;if(s===null||this.fill===null&&this.stroke===null)return!1;const n=s.bounds;let o=this.strokeWidth/2;s.type===1&&!i&&(o+=2);const r=z.l();if(r.a(n),r.inflate(o+2,o+2),!r.containsPoint(t))return z.e(r),!1;const h=o+1e-4;if(s.type===1){if(this.stroke===null)return!1;const a=(s.startX-s.endX)*(t.x-s.endX)+(s.startY-s.endY)*(t.y-s.endY),l=(s.endX-s.startX)*(t.x-s.startX)+(s.endY-s.startY)*(t.y-s.startY);return a<0||l<0?!1:(z.e(r),A.vi(s.startX,s.startY,s.endX,s.endY,o,t.x,t.y))}else if(s.type===2){const a=s.startX,l=s.startY,u=s.endX,c=s.endY;if(r.x=Math.min(a,u),r.y=Math.min(l,c),r.width=Math.abs(u-a),r.height=Math.abs(c-l),this.fill===null){if(r.inflate(-h,-h),r.containsPoint(t))return z.e(r),!1;r.inflate(h,h)}this.stroke!==null&&r.inflate(o,o);const d=r.containsPoint(t);return z.e(r),d}else if(s.type===3){const a=s.startX,l=s.startY,u=s.endX,c=s.endY;let d=Math.min(a,u),f=Math.min(l,c);const m=Math.abs(u-a),p=Math.abs(c-l);let y=m/2,x=p/2;if(d=t.x-(d+y),f=t.y-(f+x),this.fill===null){if(y-=h,x-=h,y<=0||x<=0||d*d/(y*y)+f*f/(x*x)<=1)return z.e(r),!1;y+=h,x+=h}return this.stroke!==null&&(y+=h,x+=h),z.e(r),y<=0||x<=0?!1:d*d/(y*y)+f*f/(x*x)<=1}else{if(s.type===4)return z.e(r),this.fill===null?s.EC(t.x,t.y,o):s.qk(t,o,this.strokeWidth>1,i);b.o("Unknown Geometry type: "+s.type)}}Wu(t,i,s,n){const o=this.desiredSize,r=this.Vo;t=Math.max(t,0),i=Math.max(i,0);let h;if(this.ks!==null)h=this.geometry.bounds;else{const p=this.figure;let y=Bt.q2[p];if(y===void 0){let x=A.In[p];typeof x=="string"&&(x=A.In[x]),b.it(x)?(y=x(null,100,100),Bt.q2[p]=y):b.o("Unsupported Figure: "+p)}h=y.bounds}let a=h.width,l=h.height,u=h.width,c=h.height;switch(this.zs(!0)){case 0:s=0,n=0;break;case 2:u=Math.max(t-r,0),c=Math.max(i-r,0);break;case 5:u=Math.max(t-r,0),n=0;break;case 4:s=0,c=Math.max(i-r,0);break}isFinite(o.width)&&(u=o.width),isFinite(o.height)&&(c=o.height);const d=this.maxSize,f=this.minSize;s=Math.max(s-r,f.width),n=Math.max(n-r,f.height),u=Math.min(d.width,u),c=Math.min(d.height,c),u=isFinite(u)?Math.max(s,u):Math.max(a,s),c=isFinite(c)?Math.max(n,c):Math.max(l,n);const m=this.aS();switch(m){case 0:break;case 2:a=u,l=c;break;case 6:{let p=Math.min(u/a,c/l);isFinite(p)||(p=1),a=a*p,l=l*p;break}default:b.o(m+" is not a valid geometryStretch.")}if(this.ks!==null){a===0&&(a=.001),l===0&&(l=.001);const p=(this.ks!==null?this.ks:this.ot).cF(a,l);this.ot=p}else(this.ot===null||!A.z(this.ot.rc,t-r)||!A.z(this.ot.lc,i-r))&&(this.ot=Bt.zv(this,a,l));h=this.ot.bounds,t===1/0||i===1/0?this.Wn(h.x-r/2,h.y-r/2,t===0&&a===0?0:h.width+r,i===0&&l===0?0:h.height+r):this.Wn(-(r/2),-(r/2),u+r,c+r),o.isReal()?(u=o.width,c=o.height,u=Math.min(d.width,u),c=Math.min(d.height,c),u=Math.max(f.width,u),c=Math.max(f.height,c),this.zi.i(0,0,u,c)):this.zi.a(h)}aS(){const t=this.geometryStretch;return this.ks!==null?t===1?2:t:t===1?Bt.q2[this.figure].defaultStretch:t}uh(t,i,s,n){this.commonArrange(t,i,s,n)}getNearestIntersectionPoint(t,i,s){return this.Jc(t.x,t.y,i.x,i.y,s)}Jc(t,i,s,n,o){const r=this.T,h=1/(r.m11*r.m22-r.m12*r.m21),a=r.m22*h,l=-r.m12*h,u=-r.m21*h,c=r.m11*h,d=h*(r.m21*r.dy-r.m22*r.dx),f=h*(r.m12*r.dx-r.m11*r.dy),m=t*a+i*u+d,p=t*l+i*c+f,y=s*a+n*u+d,x=s*l+n*c+f,P=this.Vo/2;let k=this.ot;k===null&&(this.ht(1/0,1/0),k=this.ot);const v=k.bounds;let N=!1;if(k.type===1)if(this.strokeWidth<=1.5)N=A.On(k.startX,k.startY,k.endX,k.endY,m,p,y,x,o);else{let M=0,C=0;if(k.startX===k.endX)M=P,C=0;else{const O=(k.endY-k.startY)/(k.endX-k.startX);C=P/Math.sqrt(1+O*O),M=C*O}const F=b.et();let T=new S;A.On(k.startX+M,k.startY+C,k.endX+M,k.endY+C,m,p,y,x,T)&&F.push(T),T=new S,A.On(k.startX-M,k.startY-C,k.endX-M,k.endY-C,m,p,y,x,T)&&F.push(T),T=new S,A.On(k.startX+M,k.startY+C,k.startX-M,k.startY-C,m,p,y,x,T)&&F.push(T),T=new S,A.On(k.endX+M,k.endY+C,k.endX-M,k.endY-C,m,p,y,x,T)&&F.push(T);const L=F.length;if(L===0)return b.J(F),!1;N=!0;let D=1/0;for(let O=0;O<L;O++){const R=F[O],I=(R.x-m)**2+(R.y-p)**2;I<D&&(D=I,o.x=R.x,o.y=R.y)}b.J(F)}else if(k.type===2)N=A.gl(v.x-P,v.y-P,v.x+v.width+P,v.y+v.height+P,m,p,y,x,o);else if(k.type===3){const M=z.V(v.x,v.y,v.width,v.height).inflate(P,P);N=this.Xv(M,m,p,y,x,o),z.e(M)}else if(k.type===4){let M=0,C=0,F=0,T=0;const L=S.l();let D=y-m,O=x-p,R=D*D+O*O,I=m,X=p;if(R>0&&v.contains(I,X)&&(L.x=I,L.y=X,this.containsPoint(L)))for(D!==0&&Math.abs(D)<.5?(O*=.5/D,D=.5):O!==0&&Math.abs(O)<.5&&(D*=.5/O,O=.5),I-=D,X-=O;v.contains(I,X);)I-=D,X-=O;const j=.6;o.x=y,o.y=x;for(let ct=0;ct<k.figures.count;ct++){const $=k.figures.r[ct],et=$.isFilled?I:m,tt=$.isFilled?X:p,it=$.segments;M=$.startX,C=$.startY;let mt=M,ft=C;for(let Z=0;Z<it.count;Z++){const ht=it.r[Z],Et=ht.type;F=ht.endX,T=ht.endY;let xt=!1;switch(Et){case 1:mt=F,ft=T;break;case 2:xt=this.s1(M,C,F,T,et,tt,y,x,L);break;case 3:{xt=A.Ig(M,C,ht.point1X,ht.point1Y,ht.point2X,ht.point2Y,F,T,et,tt,y,x,j,L);break}case 4:{xt=A.Ig(M,C,M+2/3*(ht.point1X-M),C+2/3*(ht.point1Y-C),F+2/3*(ht.point1X-F),T+2/3*(ht.point1Y-T),F,T,et,tt,y,x,j,L);break}case 5:case 6:{const Q=ht.type===5?ht.bo($):ht.Bh($,M,C),H=Q.length;if(H===0){xt=this.s1(M,C,ht.type===5?ht.centerX:ht.endX,ht.type===5?ht.centerY:ht.endY,et,tt,y,x,L);break}let lt=null;for(let Pt=0;Pt<H;Pt++){if(lt=Q[Pt],Pt===0&&this.s1(M,C,lt[0],lt[1],et,tt,y,x,L)){const Xt=this.o1(et,tt,L,R,o);Xt<R&&(R=Xt,N=!0)}if(A.Ig(lt[0],lt[1],lt[2],lt[3],lt[4],lt[5],lt[6],lt[7],et,tt,y,x,j,L)){const Xt=this.o1(et,tt,L,R,o);Xt<R&&(R=Xt,N=!0)}}F=lt[6],T=lt[7];break}default:b.o("Unknown Segment type: "+Et)}if(M=F,C=T,xt){const Q=this.o1(et,tt,L,R,o);Q<R&&(R=Q,N=!0)}if(ht.isClosed&&(F=mt,T=ft,this.s1(M,C,F,T,et,tt,y,x,L))){const Q=this.o1(et,tt,L,R,o);Q<R&&(R=Q,N=!0)}}}let V=s-t,U=n-i;const W=Math.sqrt(V*V+U*U);W!==0&&(V/=W,U/=W),o.x-=V*P,o.y-=U*P,S.e(L)}else b.o("Unknown Geometry type: "+k.type);return N?(this.T.gt(o),!0):!1}o1(t,i,s,n,o){const r=s.x-t,h=s.y-i,a=r*r+h*h;return a<n?(o.x=s.x,o.y=s.y,a):n}s1(t,i,s,n,o,r,h,a,l){if(A.z(t,s)&&A.z(i,n)||A.z(o,h)&&A.z(r,a))return!1;let u=!1;const c=(o-h)*(i-n)-(r-a)*(t-s);if(c===0)return!1;if(l.x=((o*a-r*h)*(t-s)-(o-h)*(t*n-i*s))/c,l.y=((o*a-r*h)*(i-n)-(r-a)*(t*n-i*s))/c,(t>s?t-s:s-t)<(i>n?i-n:n-i)){const d=i<n?i:n,f=i<n?n:i;(l.y>d||A.z(l.y,d))&&(l.y<f||A.z(l.y,f))&&(u=!0)}else{const d=t<s?t:s,f=t<s?s:t;(l.x>d||A.z(l.x,d))&&(l.x<f||A.z(l.x,f))&&(u=!0)}return u}Yv(t,i,s){return this.pickable===!1?!1:(s.nc(this.T),i?this.Gv(t,s):this.containedInRect(t,s))}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);let s=this.ot;s===null&&(this.ht(1/0,1/0),s=this.ot);const n=s.bounds,o=this.strokeWidth/2;let r=!1;const h=S.l();return h.i(n.x-o,n.y-o),t.containsPoint(i.gt(h))&&(h.i(n.x-o,n.bottom+o),t.containsPoint(i.gt(h))&&(h.i(n.right+o,n.bottom+o),t.containsPoint(i.gt(h))&&(h.i(n.right+o,n.y-o),t.containsPoint(i.gt(h))&&(r=!0)))),S.e(h),r}intersectsRect(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.T,t.containsRect(this.actualBounds)))return!0;const s=Tt.l();s.set(i),s.bw();const n=t.left,o=t.right,r=t.top,h=t.bottom,a=S.l();if(a.i(n,r),s.gt(a),this.fh(a,!0)||(a.i(o,r),s.gt(a),this.fh(a,!0))||(a.i(n,h),s.gt(a),this.fh(a,!0))||(a.i(o,h),s.gt(a),this.fh(a,!0)))return S.e(a),!0;const l=S.l(),u=S.l();s.set(i),s.NC(this.T),s.bw(),l.x=o,l.y=r,l.T(s),a.x=n,a.y=r,a.T(s);let c=!1;return this.Fa(a,l,u)?c=!0:(a.x=o,a.y=h,a.T(s),this.Fa(a,l,u)?c=!0:(l.x=n,l.y=h,l.T(s),this.Fa(a,l,u)?c=!0:(a.x=n,a.y=r,a.T(s),this.Fa(a,l,u)&&(c=!0)))),S.e(a),Tt.e(s),S.e(l),S.e(u),c}Fa(t,i,s){if(!this.getNearestIntersectionPoint(t,i,s))return!1;const n=t.x,o=t.y,r=i.x,h=i.y,a=s.x,l=s.y;if(n===r){let u=0,c=0;return o<h?(u=o,c=h):(u=h,c=o),l>=u&&l<=c}else{let u=0,c=0;return n<r?(u=n,c=r):(u=r,c=n),a>=u&&a<=c}}Gv(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.T,t.containsRect(this.actualBounds)))return!0;const s=t.left,n=t.right,o=t.top,r=t.bottom,h=S.l(),a=S.l(),l=S.l(),u=Tt.l();u.set(i),u.NC(this.T),u.bw(),a.x=n,a.y=o,a.T(u),h.x=s,h.y=o,h.T(u);let c=!1;return this.Fa(h,a,l)?c=!0:(h.x=n,h.y=r,h.T(u),this.Fa(h,a,l)?c=!0:(a.x=s,a.y=r,a.T(u),this.Fa(h,a,l)?c=!0:(h.x=s,h.y=o,h.T(u),this.Fa(h,a,l)&&(c=!0)))),Tt.e(u),S.e(h),S.e(a),S.e(l),c}xA(t,i,s){if(s&&this.fill!==null&&this.fh(t,!0))return!0;let n=t.distanceSquaredPoint(i);const o=n;this.strokeWidth>1.5&&(n=this.strokeWidth/2+Math.sqrt(n),n*=n);let r=this.ot;if(r===null&&(this.ht(1/0,1/0),r=this.ot,r===null))return!1;if(!s){const d=r.bounds,f=d.x,m=d.y,p=d.x+d.width,y=d.y+d.height;if(S.distanceSquared(t.x,t.y,f,m)<=n&&S.distanceSquared(t.x,t.y,p,m)<=n&&S.distanceSquared(t.x,t.y,f,y)<=n&&S.distanceSquared(t.x,t.y,p,y)<=n)return!0}function h(d,f){const m=d.length;for(let p=0;p<m;p+=2)if(f.distanceSquared(d[p],d[p+1])>n)return!0;return!1}const a=r.startX,l=r.startY,u=r.endX,c=r.endY;if(r.type===1){const d=S.distanceLineSegmentSquared(t.x,t.y,a,l,u,c),f=(u-a)*(t.x-a)+(c-l)*(t.y-l),m=(a-u)*(t.x-u)+(l-c)*(t.y-c),p=f>=0&&m>=0?n:o;return d<=p}else if(r.type===2){let d=!1;return s&&(d=S.distanceLineSegmentSquared(t.x,t.y,a,l,a,c)<=n||S.distanceLineSegmentSquared(t.x,t.y,a,l,u,l)<=n||S.distanceLineSegmentSquared(t.x,t.y,u,l,u,c)<=n||S.distanceLineSegmentSquared(t.x,t.y,a,c,u,c)<=n),d}else if(r.type===3){const d=(a+u)/2,f=(l+c)/2,m=t.x-d,p=t.y-f,y=Math.abs(u-a)/2,x=Math.abs(c-l)/2;if(y===0||x===0)return S.distanceLineSegmentSquared(t.x,t.y,a,l,u,c)<=n;if(s){const P=A.iF(y,x,m,p);return P*P<=n}else return!(S.distanceSquared(m,p,-y,0)>=n||S.distanceSquared(m,p,0,-x)>=n||S.distanceSquared(m,p,0,x)>=n||S.distanceSquared(m,p,y,0)>=n)}else if(r.type===4){const d=r.bounds,f=d.x,m=d.y,p=d.x+d.width,y=d.y+d.height;if(t.x>p&&t.x<f&&t.y>y&&t.y<m&&S.distanceLineSegmentSquared(t.x,t.y,f,m,f,y)>n&&S.distanceLineSegmentSquared(t.x,t.y,f,m,p,m)>n&&S.distanceLineSegmentSquared(t.x,t.y,p,y,f,y)>n&&S.distanceLineSegmentSquared(t.x,t.y,p,y,p,m)>n)return!1;const x=Math.sqrt(n);if(s){if(this.fill===null?r.EC(t.x,t.y,x):r.qk(t,x,!0,!1))return!0}else{const P=r.figures;for(let k=0;k<P.count;k++){const v=P.r[k];let N=v.startX,M=v.startY;if(t.distanceSquared(N,M)>n)return!1;const C=v.segments.r,F=C.length;for(let T=0;T<F;T++){const L=C[T];switch(L.type){case 1:case 2:if(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n)return!1;break;case 3:{const D=b.et();A.vn(N,M,L.point1X,L.point1Y,L.point2X,L.point2Y,L.endX,L.endY,.8,D);const O=h(D,t);if(b.J(D),O||(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n))return!1;break}case 4:{const D=b.et();A.Og(N,M,L.point1X,L.point1Y,L.endX,L.endY,.8,D);const O=h(D,t);if(b.J(D),O||(N=L.endX,M=L.endY,t.distanceSquared(N,M)>n))return!1;break}case 5:case 6:{const D=L.type===5?L.bo(v):L.Bh(v,N,M),O=D.length;if(O===0){if(N=L.type===5?L.centerX:L.endX,M=L.type===5?L.centerY:L.endY,t.distanceSquared(N,M)>n)return!1;break}let R=null;const I=b.et();for(let X=0;X<O;X++)if(R=D[X],I.length=0,A.vn(R[0],R[1],R[2],R[3],R[4],R[5],R[6],R[7],.8,I),h(I,t))return b.J(I),!1;b.J(I),R!==null&&(N=R[6],M=R[7]);break}default:b.o("Unknown Segment type: "+L.type)}}}return!0}}return!1}Xv(t,i,s,n,o,r){if(t.width===0)return A.On(t.x,t.y,t.x,t.y+t.height,i,s,n,o,r);if(t.height===0)return A.On(t.x,t.y,t.x+t.width,t.y,i,s,n,o,r);{const h=t.width/2,a=t.height/2,l=t.x+h,u=t.y+a;let c=9999;if(i!==n&&(c=(s-o)/(i-n)),Math.abs(c)<9999){const d=s-u-c*(i-l);if(h*h*(c*c)+a*a-d*d<0)return r.x=NaN,r.y=NaN,!1;const f=Math.sqrt(h*h*(c*c)+a*a-d*d),m=(-(h*h*c*d)+h*a*f)/(a*a+h*h*(c*c))+l,p=(-(h*h*c*d)-h*a*f)/(a*a+h*h*(c*c))+l,y=c*(m-l)+d+u,x=c*(p-l)+d+u,P=Math.abs((i-m)**2)+Math.abs((s-y)**2),k=Math.abs((i-p)**2)+Math.abs((s-x)**2);P<k?(r.x=m,r.y=y):(r.x=p,r.y=x)}else{const d=a*a,f=h*h,m=i-l,p=d-d/f*(m*m);if(p<0)return r.x=NaN,r.y=NaN,!1;const y=Math.sqrt(p),x=u+y,P=u-y,k=Math.abs(x-s),v=Math.abs(P-s);k<v?(r.x=i,r.y=x):(r.x=i,r.y=P)}return!0}}Rv(){return this.Vo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ot!==null?this.ot:this.ks}set geometry(t){const i=this.ot,s=this.ks;if(i===t)return;t!==null?(this.ot=t.u(),this.ks=this.ot):(this.ot=null,this.ks=null);const n=this.part;if(n!==null&&n.cf(),this.c(),this.t("geometry",i||s,t),this.Wc()){const o=this.part;o!==null&&this.ba(o,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const i=Mt.parse(t),s=i.normalize();this.geometry=i;const n=S.V(-s.x,-s.y);this.position=n,S.e(n)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",i,t))}ee(){this.ot=null}get fill(){return this.Ta}set fill(t){const i=this.Ta;i!==t&&(t!==null&&Ft.Qu(t,"Shape.fill"),t instanceof Ft&&t.u(),this.Ta=t,this.S(),this.t("fill",i,t))}get stroke(){return this.ji}set stroke(t){const i=this.ji;i!==t&&(t!==null&&Ft.Qu(t,"Shape.stroke"),t instanceof Ft&&t.u(),this.ji=t,this.S(),this.t("stroke",i,t))}get strokeWidth(){return this.Vo}set strokeWidth(t){const i=this.Vo;if(i!==t)if(t>=0){this.Vo=t,this.c();const s=this.part;s!==null&&s.cf(),this.t("strokeWidth",i,t)}else b.W(t,"value >= 0",Bt,"strokeWidth:value")}y0(){return this.Vo}get strokeCap(){return this.jt!==null?this.jt.gp:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.Da().gp=t,this.S(),this.t("strokeCap",i,t)):b.W(t,'"butt", "round", or "square"',Bt,"strokeCap"))}get strokeJoin(){return this.jt!==null?this.jt.mp:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.Da().mp=t,this.S(),this.t("strokeJoin",i,t)):b.W(t,'"miter", "bevel", or "round"',Bt,"strokeJoin"))}get strokeMiterLimit(){return this.jt!==null?this.jt.pp:10}set strokeMiterLimit(t){const i=this.strokeMiterLimit;if(i!==t&&t>=1){this.Da().pp=t,this.S();const s=this.part;s!==null&&s.cf(),this.t("strokeMiterLimit",i,t)}}get strokeDashArray(){return this.Io}set strokeDashArray(t){const i=this.Io;if(i!==t){if(t!==null&&!Array.isArray(t)&&b.Zi(t,"Array",Bt,"strokeDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(!(r>=0)||!isFinite(r))&&b.o("strokeDashArray:value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.Io=t,this.S(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return this.jt!==null?this.jt.ph:0}set strokeDashOffset(t){const i=this.strokeDashOffset;i!==t&&t>=0&&(this.Da().ph=t,this.S(),this.t("strokeDashOffset",i,t))}get figure(){return this.gd}set figure(t){const i=this.gd;if(i!==t){let s=A.In[t];if(b.it(s)?s=t:(s=A.In[t.toLowerCase()],s||b.o("Unknown Shape.figure: "+t)),i!==s){const n=this.part;n!==null&&n.cf(),this.gd=s,this.ks=null,this.ee(),this.c(),this.t("figure",i,s)}}}get toArrow(){return this.Ot!==null?this.Ot.yp:"None"}set toArrow(t){const i=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Bt.qA(t);s===null?b.o("Unknown Shape.toArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new Je),this.Ot.yp=s,this.ks=null,this.ee(),this.c(),this.WA(s),this.t("toArrow",i,s))}}get fromArrow(){return this.Ot!==null?this.Ot.wp:"None"}set fromArrow(t){const i=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Bt.qA(t);s===null?b.o("Unknown Shape.fromArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new Je),this.Ot.wp=s,this.ks=null,this.ee(),this.c(),this.WA(s),this.t("fromArrow",i,s))}}WA(t){const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.iv();const s=B.MiddleRight;this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=s):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=new B(1-s.x,s.y))}get spot1(){return this.jt!==null?this.jt.En:B.Default}set spot1(t){const i=this.spot1;i.equals(t)||(t=t.P(),this.Da().En=t,this.c(),this.t("spot1",i,t))}get spot2(){return this.jt!==null?this.jt.Un:B.Default}set spot2(t){const i=this.spot2;i.equals(t)||(t=t.P(),this.Da().Un=t,this.c(),this.t("spot2",i,t))}get parameter1(){return this.md}set parameter1(t){const i=this.md;i!==t&&(this.md=t,this.ee(),this.c(),this.t("parameter1",i,t))}get parameter2(){return this.pd}set parameter2(t){const i=this.pd;i!==t&&(this.pd=t,this.ee(),this.c(),this.t("parameter2",i,t))}get naturalBounds(){return this.zi}kv(){const t=this.desiredSize;if(!t.isReal()&&this.ot!==null){const i=this.ot.bounds;this.zi.a(i)}else this.zi.i(0,0,t.width,t.height)}get pathPattern(){return this.jt!==null?this.jt.xp:null}set pathPattern(t){const i=this.pathPattern;i!==t&&(this.Da().xp=t,this.S(),this.t("pathPattern",i,t))}get geometryStretch(){return this.jt!==null?this.jt.bp:1}set geometryStretch(t){const i=this.geometryStretch;i!==t&&(this.Da().bp=t,this.c(),this.t("geometryStretch",i,t))}get interval(){return this.K!==null?this.K.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new Ae),this.K.uf=t;const s=this.diagram;s!==null&&this.panel===s.grid&&s.th(),this.c();const n=this.panel;n!==null&&(n.ss=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new Ae),this.K.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new Ae),this.K.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedSkip(){return this.K!==null?this.K.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&b.k(t,Bt,"graduatedSkip"),this.K===null&&(this.K=new Ae),this.K.mf=t,this.c(),this.t("graduatedSkip",i,t))}static zv(t,i,s){let n=null;if(t.toArrow!=="None")n=Bt.gn[t.toArrow];else if(t.fromArrow!=="None")n=Bt.gn[t.fromArrow];else{let o=A.In[t.figure];typeof o=="string"&&(o=A.In[o]),o===void 0&&b.o("Unknown Shape.figure: "+t.figure),n=o(t,i,s),n.rc=i,n.lc=s}if(n===null){const o=A.In.Rectangle;b.it(o)&&(n=o(t,i,s))}return n}static getFigureGenerators(){const t=new bt;for(const i in A.In){if(i===i.toLowerCase())continue;const s=A.In[i];t.set(i,s)}return t.u(),t}static defineFigureGenerator(t,i){b.s(t,"string",Bt,"defineFigureGenerator:name"),typeof i=="string"||b.k(i,Bt,"defineFigureGenerator:func");const s=t.toLowerCase(),n=A.In;n[t]=i,n[s]=t}static isFigureDefined(t){return A.In.has(t)}static getArrowheadGeometries(){const t=new bt;for(const i in A.Bg)if(Bt.gn[i]===void 0){const s=Mt.parse(A.Bg[i],!1);Bt.gn[i]=s;const n=i.toLowerCase();n!==i&&(Bt.gn[n]=i)}for(const i in Bt.gn){if(i===i.toLowerCase())continue;const s=Bt.gn[i];s instanceof Mt&&t.set(i,s)}return t.u(),t}static defineArrowheadGeometry(t,i){b.s(t,"string",Bt,"defineArrowheadGeometry:name");let s=null;typeof i=="string"?(b.s(i,"string",Bt,"defineArrowheadGeometry:pathstr"),s=Mt.parse(i,!1)):s=i;const n=t.toLowerCase();(n==="none"||t===n)&&b.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const o=Bt.gn;o[t]=s,o[n]=t}static isArrowheadDefined(t){return Bt.gn.has(t)}static qA(t){let i=Bt.gn[t];if(i===void 0){const s=t.toLowerCase();if(s==="none")return"None";if(i=Bt.gn[s],i===void 0){let n=null;for(const o in A.Bg)if(o.toLowerCase()===s){n=o;break}if(n!==null){const o=Mt.parse(A.Bg[n],!1);return Bt.gn[n]=o,s!==n&&(Bt.gn[s]=n),n}}}return typeof i=="string"?i:i instanceof Mt?t:null}};g(Bt,"gn",new fe),g(Bt,"q2",new fe);let dt=Bt;class os{constructor(){g(this,"fi");g(this,"gp");g(this,"mp");g(this,"pp");g(this,"ph");g(this,"xp");g(this,"bp");g(this,"En");g(this,"Un");this.fi=!1,this.gp="butt",this.mp="miter",this.pp=10,this.ph=0,this.xp=null,this.bp=1,this.En=B.Default,this.Un=B.Default}copy(){const e=new os;return e.gp=this.gp,e.mp=this.mp,e.pp=this.pp,e.ph=this.ph,e.xp=this.xp,e.bp=this.bp,e.En=this.En.P(),e.Un=this.Un.P(),e}}var rs=(w=>(w[w.None=0]="None",w[w.Fit=1]="Fit",w[w.DesiredSize=2]="DesiredSize",w[w.BreakAll=3]="BreakAll",w))(rs||{}),sn=(w=>(w[w.Clip=0]="Clip",w[w.Ellipsis=1]="Ellipsis",w))(sn||{}),hs=(w=>(w[w.Trim=0]="Trim",w[w.None=1]="None",w))(hs||{});const gt=class gt extends Ct{constructor(t,i){super();g(this,"ri");g(this,"ji");g(this,"mn");g(this,"ge");g(this,"ui");g(this,"w0");g(this,"wd");g(this,"K");g(this,"rt");g(this,"Dl");g(this,"io");g(this,"pn");g(this,"Ce");g(this,"Ti");g(this,"yn");return gt.W0===!1&&(gt.W0=!0,gt._n=kt.isUsingDOM()?new He(null).li:null),this.n|=2097152,this.ri="",this.ji="black",this.mn="13px sans-serif",this.ge=0,this.ui=0,this.w0=0,this.wd=null,this.K=null,this.rt=null,this.Dl=0,this.io=null,this.pn=0,this.Ce=null,this.Ti=null,this.yn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),i&&Object.assign(this,i),this}cloneProtected(t){super.cloneProtected(t),t.ri=this.ri,t.ji=this.ji,t.mn=this.mn,t.ge=this.ge,t.ui=this.ui,t.w0=this.w0,t.wd=this.wd,this.K!==null&&(t.K=this.K.copy()),this.rt!==null&&(this.rt.fi?t.rt=this.rt:t.rt=this.rt.copy()),t.Dl=this.Dl,t.io=this.io,t.pn=this.pn,t.Ce=this.Ce,t.Ti=this.Ti,t.yn=this.yn}wn(){return this.rt===null?this.rt=new as:this.rt.fi&&(this.rt=this.rt.copy()),this.rt}ch(){super.ch(),this.rt!==null&&(this.rt.fi=!0)}Av(t){this.n=t.n|2048|4096,this.$t=t.opacity,this.Lt=t.background,this.is=t.desiredSize.P(),this.minSize=t.minSize.P(),this.maxSize=t.maxSize.P(),t.wi!==null?this.wi=t.wi.copy():this.wi=null,this.tt=t.scale,this.Yt=t.angle,this.stretch=t.stretch,this.Wr=t.margin.P(),this.hi=t.alignment.P(),this.ju=t.alignmentFocus.P(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.P(),this.segmentOrientation=t.segmentOrientation,t.si!==null&&(this.si=t.si.copy()),this.shadowVisible=t.shadowVisible,this.ri=t.ri,this.ji=t.ji,this.mn=t.mn,this.K!==null&&(this.K=t.K.copy()),t.rt!==null&&(t.rt.fi?this.rt=t.rt:this.rt=t.rt.copy()),this.Dl=t.Dl}Cv(t){if(this.ri=t.text||"",this.Yt=t.labelAngle||0,this.ge=t.lineCount||0,this.Kv(t.lines),t.naturalBounds&&(this.zi=t.naturalBounds),t.actualBounds){const i=t.actualBounds;this.Bt(i.x,i.y,i.width,i.height)}}oi(t){t in rs?this.wrap=t:super.oi(t)}toString(){return this.ri.length>22?'TextBlock("'+this.ri.substring(0,20)+'"...)':'TextBlock("'+this.ri+'")'}static getEllipsis(){return gt.kp}static setEllipsis(t){gt.kp=t,gt.l1=new fe,gt.W2=0}static getBaseline(){return gt.h1}static setBaseline(t){gt.h1=t}static getUnderline(){return gt.a1}static setUnderline(t){gt.a1=t}c(){super.c(),this.Ve(!0)}get font(){return this.mn}set font(t){const i=this.mn;i!==t&&(this.mn=t,this.io=null,this.c(),this.t("font",i,t))}static isValidFont(t){return _.CSS?_.CSS.supports("font",t):!0}get text(){return this.ri}set text(t){const i=this.ri;t!=null?t=t.toString():t="",i!==t&&(this.ri=t,this.c(),this.t("text",i,t))}get textAlign(){return this.rt!==null?this.rt.Pp:"start"}set textAlign(t){const i=this.textAlign;i!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.wn().Pp=t,this.S(),this.t("textAlign",i,t))}get flip(){return this.rt!==null?this.rt.eo:0}set flip(t){const i=this.flip;i!==t&&(this.wn().eo=t,this.S(),this.t("flip",i,t))}get verticalAlignment(){return this.rt!==null?this.rt.tl:B.Top}set verticalAlignment(t){const i=this.verticalAlignment;i.equals(t)||(t=t.P(),this.wn().tl=t,this.ef(),this.t("verticalAlignment",i,t))}get naturalBounds(){if(!this.zi.isReal()){const t=ot.l();this.J2(this.ri,999999,t);let i=t.width;ot.e(t);let s=this.JA(i);const n=this.desiredSize;isNaN(n.width)||(i=n.width),isNaN(n.height)||(s=n.height),this.zi.Fn(i,s)}return this.zi}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const i=(this.n&2097152)!==0;i!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",i,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const i=(this.n&4194304)!==0;i!==t&&(this.n=this.n^4194304,this.Ve(!0),this.S(),this.t("isUnderline",i,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const i=(this.n&8388608)!==0;i!==t&&(this.n=this.n^8388608,this.Ve(!0),this.S(),this.t("isStrikethrough",i,t))}get wrap(){return this.rt!==null?this.rt.Sp:2}set wrap(t){const i=this.wrap;i!==t&&(this.wn().Sp=t,this.c(),this.t("wrap",i,t))}get overflow(){return this.rt!==null?this.rt.Mp:0}set overflow(t){const i=this.overflow;i!==t&&(this.wn().Mp=t,this.c(),this.t("overflow",i,t))}get isOverflowed(){return(this.n&16777216)!==0}$2(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.ji}set stroke(t){const i=this.ji;i!==t&&(t!==null&&Ft.Qu(t,"TextBlock.stroke"),t instanceof Ft&&t.u(),this.ji=t,typeof t!="string"&&this.Qc(),this.S(),this.t("stroke",i,t))}get lineCount(){return this.ge}get lineHeight(){return this.Np()}get editable(){return(this.n&1048576)!==0}set editable(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.t("editable",i,t))}get V2(){return(this.n&33554432)!==0}set V2(t){this.n=this.n^33554432}get textEditor(){return this.rt!==null?this.rt.Cp:null}set textEditor(t){const i=this.textEditor;i!==t&&(this.wn().Cp=t,this.t("textEditor",i,t))}get errorFunction(){return this.rt!==null?this.rt.ns:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(t!==null&&b.k(t,gt,"errorFunction"),this.wn().ns=t,this.t("errorFunction",i,t))}get interval(){return this.K!==null?this.K.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new Ae),this.K.uf=t,this.c();const s=this.panel;s!==null&&(s.ss=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new Ae),this.K.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new Ae),this.K.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedFunction(){return this.K!==null?this.K.Lp:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(t!==null&&b.k(t,gt,"graduatedFunction"),this.K===null&&(this.K=new Ae),this.K.Lp=t,this.c(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return this.K!==null?this.K.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&b.k(t,gt,"graduatedSkip"),this.K===null&&(this.K=new Ae),this.K.mf=t,this.c(),this.t("graduatedSkip",i,t))}gh(t,i){if(this.ji===null||this.ri.length===0||this.mn===null)return;const s=this.naturalBounds,n=this.actualBounds,o=s.width,r=s.height,h=this.Np();let a=t.textAlign=this.textAlign;const l=i.zu;a==="start"?a=l?"right":"left":a==="end"&&(a=l?"left":"right");const u=this.isUnderline,c=this.isStrikethrough;this.rn(t,this.ji,!0,!1,s,n),(u||c)&&this.rn(t,this.ji,!1,!1,s,n);const d=0;let f=0;const m=o;let p=!1;i.Qt===t&&!(i.Qt instanceof ge)&&!this.V2&&i.getRenderingHint("textGreeking")===!0&&h*this.da*i.scale<3&&(p=!0);const y=this.spacingAbove,x=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(o,0),t.scale(-1,1);break;case 1:t.translate(0,r),t.scale(1,-1);break;case 3:t.translate(o,r),t.scale(-1,-1);break}t.commitTransform();const P=this.ge,k=(y+h+x)*P;if(r>k){const v=this.verticalAlignment;f=v.y*r-v.y*k+v.offsetY}if(P===1&&this.yn!==null){let v=this.ui;v>m&&(v=m),f+=y,this.$A(this.yn,t,d,f,m,h,v,p,a,u,c)}else if(this.Ce!==null&&this.Ti!==null)for(let v=0;v<P;v++){let N=this.Ce[v];N>m&&(N=m),f+=y,this.$A(this.Ti[v],t,d,f,m,h,N,p,a,u,c),f+=h+x}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-o,0);break;case 1:t.scale(1,-1),t.translate(0,-r);break;case 3:t.scale(-1,-1),t.translate(-o,-r);break}}$A(t,i,s,n,o,r,h,a,l,u,c){let d=0;if(a){l==="left"?d=0:l==="right"?d=o-h:l==="center"&&(d=(o-h)/2);const p=i.globalAlpha;i.globalAlpha=p/2,i.fillRect(s+d,n+r/4,h,r/2),i.globalAlpha=p;return}l==="left"?d=0:l==="right"?d=o:l==="center"&&(d=o/2);const f=gt.h1!==null?gt.h1(this,r):r*.75;i.fillText(t,s+d,n+f);let m=r/20|0;if(m===0&&(m=1),l==="right"?d-=h:l==="center"&&(d-=h/2),u){const p=gt.a1!==null?gt.a1(this,r):r*.8;this.ZA(s+d,n+p,s+d+h,n+p,m,i),i instanceof ge&&i.lastCreatedElement.classList.add("gojs-td")}if(c){let p=n+r-r/2.2|0;m%2!==0&&(p+=.5),this.ZA(s+d,p,s+d+h,p,m,i),i instanceof ge&&i.lastCreatedElement.classList.add("gojs-td")}}ZA(t,i,s,n,o,r){r.beginPath(),r.lineWidth=o,r.moveTo(t,i),r.lineTo(s,n),r.stroke(),r.endPath()}Zc(t,i,s){if(!super.Zc(t,i,s))return!1;if(this.rn(t,this.ji,!0,!1,this.naturalBounds,this.actualBounds),s){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.jv(this.svg,this.text,t);return!0}jv(t,i,s){t.innerHTML=i,s.setFillOrStrokeInPlace(t,!0)}$u(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.$u(t)}k2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("text");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}Hv(){this.pn=0,this.ui=0,this.io=null,this.Ce=null,this.Ti=null,this.yn=null}Wu(t,i,s,n){const o=this.ge;this.Dl=t,this.$2(!1);const r=this.mn;gt._n!==null&&gt.QA!==r&&(gt._n.font=r,gt.QA=r),this.Hv();let h=0,a=0;isNaN(this.desiredSize.width)?(h=this.qv(),h=Math.min(h,t/this.scale)):h=this.desiredSize.width,this.panel!==null&&(h=Math.min(h,this.panel.maxSize.width)),a=this.JA(h),isNaN(this.desiredSize.height)?a=Math.min(a,i/this.scale):a=this.desiredSize.height,this.Wv(t,a),(this.wrap===1||isNaN(this.desiredSize.width))&&(h=isNaN(t)?this.ui:Math.min(t,this.ui)),h=Math.max(s,h),a=Math.max(n,a),this.zi.Fn(h,a),this.Wn(0,0,h,a),this.svg!==null&&o!==this.ge&&this.Ve(!0)}uh(t,i,s,n){this.commonArrange(t,i,s,n)}xn(t,i){this.yn===null?(this.yn=t,this.ui=i):((this.Ti===null||this.Ce===null)&&(this.Ti=[],this.Ce=[],this.Ti.push(this.yn),this.Ce.push(this.ui)),this.Ti.push(t),this.Ce.push(i),this.Ti.length>this.maxLines&&(this.n|=16777216))}J2(t,i,s){const n=this.formatting===0;n&&(t=t.trim());let o=0,r=0,h=0;const a=this.mn,l=this.spacingAbove+this.spacingBelow,u=Math.max(0,this.Np()+l),c=this.overflow===1?this._A(a):0;if(this.ge>=this.maxLines){s!==null&&s.i(0,u);return}let d=t;if(this.wrap===0){if(this.pn=1,r=this.getStringWidth(t),c===0||r<=i){this.ui=Math.max(this.ui,r),this.xn(t,this.ui),s!==null&&s.i(r,u);return}let m=this.xd(d);d=d.substring(m.length);let p=this.xd(d);for(r=this.getStringWidth(m+p),h=0;p.length>0&&r<=i;){m+=p,d=d.substring(p.length),p=this.xd(d),h=r;let y=m+p;n&&(y=y.trim()),r=this.getStringWidth(y)}for(n&&(p=p.trim()),m+=p,i=Math.max(1,i-c);this.getStringWidth(m)>i&&m.length>1;)m=m.substring(0,m.length-1);this.$2(!0),m+=gt.kp,h=this.getStringWidth(m),this.ui=h,this.xn(m,h),s!==null&&s.i(h,u);return}let f=0;for(d.length===0&&(f=1,this.xn(d,0));d.length>0;){let m=this.xd(d);for(d=d.substring(m.length);this.getStringWidth(m)>i;){let x=1;for(r=this.getStringWidth(m.substring(0,x)),h=0;r<=i;)x++,h=r,r=this.getStringWidth(m.substring(0,x));let P=0;x===1?(P=r,o=Math.max(o,r)):(P=h,o=Math.max(o,h)),x--,x<1&&(x=1);const k=m.substring(0,x);if(this.xn(k,P),f++,m=m.substring(x),this.ge+f>this.maxLines)break}let p=this.xd(d);for(r=this.getStringWidth(m+p),h=0;p.length>0&&r<=i;){m+=p,d=d.substring(p.length),p=this.xd(d),h=r;let x=m+p;n&&(x=x.trim()),r=this.getStringWidth(x)}if(n&&(m=m.trim()),m==="")continue;m[m.length-1]==="­"&&(m=m.substring(0,m.length-1)+"‐");let y=0;if(p.length===0?(y=r,o=Math.max(o,r)):(h=this.getStringWidth(m),y=h,o=Math.max(o,h)),this.xn(m,y),f++,this.ge+f>this.maxLines)break}this.pn=Math.min(this.maxLines-this.ge,f),this.ui=Math.max(this.ui,o),s!==null&&s.i(this.ui,u*this.pn)}Wv(t,i){if(this.ui===0||this.Ce===null||this.Ti===null||this.overflow!==1)return;const s=this.mn,n=this.overflow===1?this._A(s):0,o=this.spacingAbove+this.spacingBelow,r=Math.max(0,this.Np()+o),h=Math.min(this.maxLines-1,Math.max(Math.floor(i/r+.01)-1,0));if(h+1>=this.Ti.length)return;this.$2(!0);let a=this.Ti[h];const l=Math.max(1,t-n);for(;this.getStringWidth(a)>l&&a.length>1;)a=a.substring(0,a.length-1);a+=gt.kp;const u=this.getStringWidth(a);this.Ti[h]=a,this.Ti=this.Ti.slice(0,h+1),this.Ce[h]=u,this.Ce=this.Ce.slice(0,h+1),this.pn=this.Ti.length,this.ui=Math.max(this.ui,u),this.ge=this.pn,this.ge===1&&(this.yn=this.Ti[0])}xd(t){if(this.wrap===3)return t.substring(0,1);let i=t.length,s=0;const n=gt.Jv;for(;s<i&&!n.test(t.charAt(s));)s++;for(this.formatting===1&&(i=Math.min(i,s+1));s<i&&n.test(t.charAt(s));)s++;return s>=t.length?t:t.substring(0,s)}getStringWidth(t){return gt._n===null?t.length*8:gt._n.measureText(t).width}Np(){if(this.io!==null)return this.io;const t=this.mn;let i=0;return gt._n===null?(i=16,this.io=i,i):(gt.Z2[t]!==void 0&&gt.tT<5e3?i=gt.Z2[t]:(i=gt._n.measureText("M").width*1.3,gt.Z2[t]=i,gt.tT++),this.io=i,i)}_A(t){if(gt._n===null)return 6;let i=0;return gt.l1[t]!==void 0&&gt.W2<5e3?i=gt.l1[t]:(i=gt._n.measureText(gt.kp).width,gt.l1[t]=i,gt.W2++),i}c1(t,i){return t.indexOf(`
`,i)}JA(t){let i=this.ri.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const s=this.spacingAbove+this.spacingBelow,n=Math.max(0,this.Np()+s);if(i.length===0)return this.ui=0,this.ge=1,n;if(!this.isMultiline){const l=this.c1(i,0);l>=0&&(i=i.substring(0,l))}let o=0;this.ge=0;let r=0,h=-1,a=!1;for(;!a;){if(h=this.c1(i,r),h===-1&&(h=i.length,a=!0),r<=h){const l=i.substring(r,h);if(this.wrap!==0){this.pn=0;const u=ot.l();this.J2(l,t,u),o+=u.height,ot.e(u),this.ge+=this.pn}else this.J2(l,t,null),o+=n,this.ge++;this.ge===this.maxLines&&(a=!0)}r=h+1}return this.w0=o,o}qv(){let t=this.ri.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let i=0,s=0,n=!1;for(;!n;){let o=this.c1(t,s);o===-1&&(o=t.length,n=!0);let r=t.substring(s,o);this.formatting===0&&(r=r.trim()),i=Math.max(i,this.getStringWidth(r)),s=o+1}return i}else{const i=this.c1(t,0);return i>=0&&(t=t.substring(0,i)),this.getStringWidth(t)}}get textValidation(){return this.rt!==null?this.rt.Tl:null}set textValidation(t){const i=this.textValidation;i!==t&&(t!==null&&b.k(t,gt,"textValidation"),this.wn().Tl=t,this.t("textValidation",i,t))}get textEdited(){return this.rt!==null?this.rt.Ap:null}set textEdited(t){const i=this.textEdited;i!==t&&(t!==null&&b.k(t,gt,"textEdited"),this.wn().Ap=t,this.t("textEdited",i,t))}get spacingAbove(){return this.rt!==null?this.rt.Tp:0}set spacingAbove(t){const i=this.spacingAbove;i!==t&&(this.wn().Tp=t,this.c(),this.t("spacingAbove",i,t))}get spacingBelow(){return this.rt!==null?this.rt.Dp:0}set spacingBelow(t){const i=this.spacingBelow;i!==t&&(this.wn().Dp=t,this.c(),this.t("spacingBelow",i,t))}get formatting(){return this.rt!==null?this.rt.Fp:0}set formatting(t){const i=this.formatting;i!==t&&(this.wn().Fp=t,this.c(),this.t("formatting",i,t))}get maxLines(){return this.rt!==null?this.rt.Rp:1/0}set maxLines(t){const i=this.maxLines;i!==t&&(t=Math.floor(t),t<=0&&b.W(t,"> 0",gt,"maxLines"),this.wn().Rp=t,this.c(),this.t("maxLines",i,t))}getMetrics(){return[this.ui,this.Dl,this.io,this.pn,this.Ce,this.Ti,this.yn]}Kv(t){t!==void 0&&(this.ui=t[0],this.Dl=t[1],this.io=t[2],this.pn=t[3],this.Ce=t[4],this.Ti=t[5],this.yn=t[6])}get metrics(){return{arrSize:this.Ce!==null?this.Ce:[this.ui],arrText:this.Ti!==null?this.Ti:[this.yn],maxLineWidth:this.ui,fontHeight:this.io}}get choices(){return this.wd}set choices(t){const i=this.wd;i!==t&&(this.wd=t,this.t("choices",i,t))}};g(gt,"h1",null),g(gt,"a1",null),g(gt,"None",0),g(gt,"WrapFit",1),g(gt,"WrapDesiredSize",2),g(gt,"WrapBreakAll",3),g(gt,"OverflowClip",0),g(gt,"OverflowEllipsis",1),g(gt,"FormatTrim",0),g(gt,"FormatNone",1),g(gt,"Jv",new RegExp("[ ​­]")),g(gt,"Z2",new fe),g(gt,"tT",0),g(gt,"l1",new fe),g(gt,"W2",0),g(gt,"kp","..."),g(gt,"QA",""),g(gt,"_n",null),g(gt,"W0",!1);let Kt=gt;class as{constructor(){g(this,"fi");g(this,"ns");g(this,"eo");g(this,"Fp");g(this,"Rp");g(this,"Mp");g(this,"Tp");g(this,"Dp");g(this,"Pp");g(this,"Ap");g(this,"Cp");g(this,"Tl");g(this,"tl");g(this,"Sp");this.fi=!1,this.ns=null,this.eo=0,this.Fp=0,this.Rp=1/0,this.Mp=0,this.Tp=0,this.Dp=0,this.Pp="start",this.Ap=null,this.Cp=null,this.Tl=null,this.tl=B.Top,this.Sp=2}copy(){const e=new as;return e.ns=this.ns,e.eo=this.eo,e.Fp=this.Fp,e.Rp=this.Rp,e.Mp=this.Mp,e.Tp=this.Tp,e.Dp=this.Dp,e.Pp=this.Pp,e.Ap=this.Ap,e.Cp=this.Cp,e.Tl=this.Tl,e.tl=this.tl,e.Sp=this.Sp,e}}class Ae{constructor(){g(this,"uf");g(this,"df");g(this,"gf");g(this,"Lp");g(this,"mf");this.uf=1,this.df=0,this.gf=1,this.Lp=null,this.mf=null}copy(){const e=new Ae;return e.uf=this.uf,e.df=this.df,e.gf=this.gf,e.Lp=this.Lp,e.mf=this.mf,e}}var ls=(w=>(w[w.None=0]="None",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(ls||{});const Yt=class Yt extends Ct{constructor(t,i){super();g(this,"il");g(this,"dt");g(this,"el");g(this,"pf");g(this,"ns");g(this,"sl");g(this,"yf");g(this,"eo");g(this,"wf");g(this,"xf");g(this,"Yb");this.n|=2097152,this.il=null,this.dt="",this.el=z.$D,this.pf=2,this.ns=null,this.sl=null,this.yf=B.Center,this.eo=0,this.wf=null,this.xf=null,this.Yb=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.dt=this.dt,t.element=this.il,t.el=this.el.P(),t.pf=this.pf,t.eo=this.eo,t.ns=this.ns,t.sl=this.sl,t.yf=this.yf.P(),t.xf=this.xf}oi(t){t in ls?this.imageStretch=t:super.oi(t)}toString(){return"Picture("+this.source+")#"+K.as(this)}get bf(){return(this.n&1048576)!==0}set bf(t){this.bf!==t&&(this.n=this.n^1048576)}get vp(){return(this.n&2097152)!==0}set vp(t){this.vp!==t&&(this.n=this.n^2097152)}get hn(){return(this.n&4194304)!==0}set hn(t){this.hn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),b.s(t,"string",Yt,"clearCache:url"),t!==""?Yt.Op[t]&&(delete Yt.Op[t],Yt.f1--):(Yt.Op=new fe,Yt.f1=0)}static tA(t,i){i.iT||(i.u1=s=>{Yt.$v(i,s),t.desiredSize.isReal()||(t.ue(!1),t.c())},i.d1=s=>Yt.Zv(i,s),i.addEventListener("load",i.u1),i.addEventListener("error",i.d1),i.iT=!0)}static BR(t){t.u1&&t.removeEventListener("load",t.u1),t.d1&&t.removeEventListener("error",t.d1),delete t.u1,delete t.d1,delete t.iT}get element(){return this.il}set element(t){const i=this.il;if(this.Ve(!0),i!==t){this.bf=t instanceof HTMLCanvasElement;const s=t instanceof HTMLImageElement;t!==null&&!(s||t instanceof HTMLVideoElement||this.bf)&&b.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t);const n=this.diagram;n!==null&&n.GM(this),this.il=t,t!==null&&s&&t.ts===void 0&&(t.ts=new K),n!==null&&s&&n.YM(this),this.t("element",i,t),this.S()}}ER(){const t=this.il;if(t===null)return;const i=this.desiredSize.isReal();(this.bf||t.complete===!0)&&(t.r0&&(t.Ip instanceof Event&&this.ns!==null?this.ns(this,t.Ip):t.hn===!0&&!t.Ip&&this.sl!==null&&t.Q2&&this.sl(this,t.Q2)),t.hn=!0),t.hn&&i&&this.diagram!==null&&this.diagram.Vu.add(this)}Qv(){if(this.il===null){this.wf=!1;return}const t=new He(null).li;try{t.drawImage(this.il,0,0)}catch{this.vp=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.wf=!1),this.wf=!1}catch{this.wf=!0}}get source(){return this.dt}set source(t){const i=this.dt;if(i!==t){this.Ve(!0),b.s(t,"string",Yt,"source"),this.dt=t;let s=Yt.Op;if(!kt.isUsingDOM()){this.t("source",i,t);return}let n=null;if(s[t]!==void 0)n=s[t];else if(t!==""){Yt.f1>30&&(Yt.clearCache(),s=Yt.Op),n=b.hs("img"),n.r0=!0,Yt.tA(this,n);const o=this.xf;o!==null&&(n.crossOrigin=o(this)),n.src=t,s[t]=n,Yt.f1++}this.element=n,n!==null&&n.__goCache===void 0&&(n.__goCache=new Kn),this.c(),this.S(),this.t("source",i,t)}}static $v(t,i){t.hn=!0,t.Ip=!1;let s;const n=t.ts.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value;r.S();const h=t.getAttribute("src")||"",a=r.Jl.get(h);if(a===null)continue;const l=a.length;for(let u=0;u<l;u++)s=a[u],s.desiredSize.isReal()||r.Vu.add(s),s.Ve(!0),r.requestUpdate(),t.r0&&(t.Q2===void 0&&(t.Q2=i),s.sl!==null&&s.sl(s,i))}t.ts.clear()}static Zv(t,i){t.Ip=i;let s;const n=t.ts.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value,h=t.getAttribute("src")||"",a=r.Jl.get(h);if(a===null)continue;const l=a.length,u=b.et();for(let c=0;c<l;c++)u.push(a[c]);if(t.r0)for(let c=0;c<l;c++)s=u[c],s.ns!==null&&s.ns(s,i);b.J(u)}t.ts.clear()}reloadSource(){if(this.source==="")return;Yt.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.S(),this.Ve(!0)}get sourceCrossOrigin(){return this.xf}set sourceCrossOrigin(t){if(this.xf!==t&&(t!==null&&b.k(t,Yt,"sourceCrossOrigin"),this.xf=t,this.element!==null)){const i=this.element.getAttribute("src");t===null&&typeof i=="string"?this.element.crossOrigin=null:t!==null&&(this.element.crossOrigin=t(this)),this.element.src=i}}get sourceRect(){return this.el}set sourceRect(t){const i=this.el;i.equals(t)||(t=t.P(),this.el=t,this.S(),this.t("sourceRect",i,t))}get imageStretch(){return this.pf}set imageStretch(t){const i=this.pf;i!==t&&(this.pf=t,this.S(),this.t("imageStretch",i,t))}get flip(){return this.eo}set flip(t){const i=this.eo;i!==t&&(this.eo=t,this.S(),this.t("flip",i,t))}get imageAlignment(){return this.yf}set imageAlignment(t){const i=this.yf;i.equals(t)||(t=t.P(),this.yf=t,this.S(),this.t("imageAlignment",i,t))}get errorFunction(){return this.ns}set errorFunction(t){const i=this.ns;i!==t&&(t!==null&&b.k(t,Yt,"errorFunction"),this.ns=t,this.t("errorFunction",i,t))}get successFunction(){return this.sl}set successFunction(t){const i=this.sl;i!==t&&(t!==null&&b.k(t,Yt,"successFunction"),this.sl=t,this.t("successFunction",i,t))}gh(t,i){const s=this.il;if(s===null)return;const n=s.getAttribute("src");if(s instanceof HTMLImageElement&&(n===null||n==="")||s.Ip instanceof Event&&t instanceof Ci)return;const o=t instanceof ge,r=this.naturalBounds;let h=0,a=0;const l=this.bf;let u=l?+s.width:s.naturalWidth,c=l?+s.height:s.naturalHeight;if(u===void 0&&s.videoWidth&&(u=s.videoWidth),c===void 0&&s.videoHeight&&(c=s.videoHeight),u===0||c===0)return;const d=u,f=c;this.sourceRect.isReal()&&(h=this.el.x,a=this.el.y,u=this.el.width,c=this.el.height);let m=u,p=c;const y=this.pf,x=this.yf;switch(y){case 0:if(this.sourceRect.isReal())break;m>=r.width&&(h=h+x.offsetX+(m*x.x-r.width*x.x)),p>=r.height&&(a=a+x.offsetY+(p*x.y-r.height*x.y)),u=Math.min(r.width,m),c=Math.min(r.height,p);break;case 2:m=r.width,p=r.height;break;case 6:case 7:let R=0;y===6?(R=Math.min(r.height/p,r.width/m),m*=R,p*=R):y===7&&(R=Math.max(r.height/p,r.width/m),m*=R,p*=R,m>=r.width&&(h=(h+x.offsetX+(m*x.x-r.width*x.x)/m)*u),p>=r.height&&(a=(a+x.offsetY+(p*x.y-r.height*x.y)/p)*c),u*=1/(m/r.width),c*=1/(p/r.height),m=r.width,p=r.height);break}const P=u*c,k=this.getDocumentScale()*i.scale,v=m*k,N=p*k,M=v*N,C=P/M,F=s.__goCache;let T=null;const L=Yt._v;if(!o){if(s.hn&&F!==void 0&&d<8e3&&f<8e3&&M>4&&C>L*L){F.Vt===null&&(F.eT(4,d,f,s),F.eT(16,d,f,s));const R=F.Vt,I=R.length;for(let X=0;X<I&&R[X].bd*R[X].bd<C;X++)T=R[X]}if(!i.Bu&&(this.wf===null&&this.Qv(),this.wf))return}const D=m<r.width?x.offsetX+(r.width*x.x-m*x.x):0,O=p<r.height?x.offsetY+(r.height*x.y-p*x.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,m),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,p)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,m),Math.min(r.height,p)),t.scale(-1,-1);break}if(t.commitTransform(),i.getRenderingHint("pictureRatioOptimization")&&!i.ia&&F!==void 0&&T!==null&&T.bd!==1){t.save();const R=T.bd;try{t.drawImage(T.dt,h/R,a/R,Math.min(T.dt.width,u/R),Math.min(T.dt.height,c/R),D,O,Math.min(r.width,m),Math.min(r.height,p)),t instanceof ge&&(this.Yb=[h/R,a/R,Math.min(T.dt.width,u/R),Math.min(T.dt.height,c/R),D,O,Math.min(r.width,m),Math.min(r.height,p)])}catch{this.vp=!1}t.restore()}else try{t.drawImage(s,h,a,u,c,D,O,Math.min(r.width,m),Math.min(r.height,p)),t instanceof ge&&(this.Yb=[h,a,u,c,D,O,Math.min(r.width,m),Math.min(r.height,p)])}catch{this.vp=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,m),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,p));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,m),-Math.min(r.height,p));break}}get naturalBounds(){return this.zi}Wu(t,i,s,n){const o=this.desiredSize,r=this.zs(!0),h=this.il,a=this.bf;let l=0,u=0;(a||!this.hn&&h&&h.complete)&&(this.hn=!0),h===null?(isFinite(o.width)||(t=s),isFinite(o.height)||(i=n)):(l=a?+h.width:h.naturalWidth,u=a?+h.height:h.naturalHeight),!isFinite(o.width)&&r!==2&&r!==5?h!==null&&this.hn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=l):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:h!==null&&(t=l)),s=0),!isFinite(o.height)&&r!==2&&r!==4?h!==null&&this.hn!==!1&&(this.sourceRect.isReal()?i=this.sourceRect.height:i=u):(isFinite(i)||(this.sourceRect.isReal()?i=this.sourceRect.height:h!==null&&(i=u)),n=0),isFinite(o.width)&&(t=o.width),isFinite(o.height)&&(i=o.height);const c=this.maxSize,d=this.minSize;s=Math.max(s||0,d.width),n=Math.max(n||0,d.height),t=Math.min(c.width,t),i=Math.min(c.height,i),t=Math.max(s,t),i=Math.max(n,i),h!==null&&!h.complete&&(isFinite(t)||(t=0),isFinite(i)||(i=0)),this.zi.Fn(t,i),this.Wn(0,0,t,i)}uh(t,i,s,n){this.commonArrange(t,i,s,n)}};g(Yt,"Op",new fe),g(Yt,"f1",0),g(Yt,"_v",4);let be=Yt;class Kn{constructor(){g(this,"Vt");this.Vt=null}eT(e,t,i,s){this.Vt===null&&(this.Vt=[]);const n=new He(null),o=n.li,r=1/e;if(n.width=t/e,n.height=i/e,n.width===0||n.height===0)return;const h=new jn(n.Tt,e);let a=s,l=1;if(this.Vt.length>0){const u=this.Vt[this.Vt.length-1];a=u.dt,l=u.bd}o.setTransform(r*l,0,0,r*l,0,0),o.commitTransform(),o.drawImage(a,0,0),this.Vt.push(h)}}class jn{constructor(e,t){g(this,"dt");g(this,"bd");this.dt=e,this.bd=t}}const li=class li{constructor(){g(this,"bi");g(this,"Gg");this.Gg=new Mt,this.bi=null}Ri(e){e!==null?(this.Gg=e,e.figures.clear()):this.Gg=new Mt,this.bi=null}hu(e,t,i,s,n,o){if(s!==void 0&&s===!0){const r=new pt(1);r.endX=e,r.endY=t,this.bi.segments.add(r)}else this.bi=new qt,this.bi.startX=e,this.bi.startY=t,this.bi.isFilled=i,this.bi.isEvenOdd=o||!1,this.Gg.figures.add(this.bi);n!==void 0&&(this.bi.isShadowed=n)}rF(){const e=this.bi.segments.length;e>0&&this.bi.segments.elt(e-1).close()}lF(){this.bi.segments.length>0&&(this.bi.isFilled=!0)}hF(e){this.bi.isShadowed=e}RE(e){this.bi.isEvenOdd=e}sF(e,t,i){i===void 0&&(i=!1);const s=new pt(1);s.endX=e,s.endY=t,i&&s.close(),this.bi.segments.add(s)}lr(e,t,i){i===void 0&&(i=!1);const s=new pt(2);s.endX=e,s.endY=t,i&&s.close(),this.bi.segments.add(s)}hr(e,t,i,s,n,o,r){r===void 0&&(r=!1);const h=new pt(3);h.point1X=e,h.point1Y=t,h.point2X=i,h.point2Y=s,h.endX=n,h.endY=o,r&&h.close(),this.bi.segments.add(h)}Cw(e,t,i,s,n){n===void 0&&(n=!1);const o=new pt(4);o.point1X=e,o.point1Y=t,o.endX=i,o.endY=s,n&&o.close(),this.bi.segments.add(o)}nF(e,t,i,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const h=new pt(5);h.startAngle=e,h.sweepAngle=t,h.centerX=i,h.centerY=s,h.radiusX=n,o!==0?h.radiusY=o:h.radiusY=n,r&&h.close(),this.bi.segments.add(h)}oF(e,t,i,s,n,o,r,h){h===void 0&&(h=!1);const a=new pt(6,o,r,e,t,i,s,n);h&&a.close(),this.bi.segments.add(a)}static RC(e){const t=li._2;if(t!==null)return li._2=null,t.Ri(e),t;{const i=new li;return i.Ri(e),i}}static vC(e){li._2=e}};g(li,"_2",null);let mi=li;{const w=function(n,o){const r=n.toLowerCase(),h=A.In;h[n]=o,h[r]=n};w("Rectangle",(n,o,r)=>{const h="r"+o+","+r;let a=A.or[h];return a!==void 0||(a=new Mt(2),a.endX=o,a.endY=r,A.rr<A.Vg&&(A.or[h]=a,A.rr++)),a}),w("Square",(n,o,r)=>{const h="s"+o+","+r;let a=A.or[h];return a!==void 0||(a=new Mt(2),a.endX=o,a.endY=r,a.defaultStretch=6,A.rr<A.Vg&&(A.or[h]=a,A.rr++)),a});const e=(n,o,r,h,a)=>{(isNaN(h)||h<0)&&(h=5),isNaN(a)&&(a=15);const l="rr"+o+","+r+","+h+","+a;let u=A.or[l];if(u!==void 0)return u;let c=h;(a&1)===1?(c=Math.min(c,(a&2)===2?o/3:o),c=Math.min(c,(a&8)===8?r/3:r)):c=0;const d=new qt(c,0,!0);u=new Mt().add(d);const f=B.TopLeft.copy(),m=B.BottomRight.copy();if((a&2)===2){let p=h;p=Math.min(p,(a&1)===1?o/3:o),p=Math.min(p,(a&4)===4?r/3:r);const y=p*A.Rn;d.add(new pt(2,o-p,0)).add(new pt(3,o,p,o-y,0,o,y)),f.offsetY=y,m.offsetX=-y}else d.add(new pt(2,o,0));if((a&4)===4){let p=h;p=Math.min(p,(a&8)===8?o/3:o),p=Math.min(p,(a&2)===2?r/3:r);const y=p*A.Rn;d.add(new pt(2,o,r-p)).add(new pt(3,o-p,r,o,r-y,o-y,r)),m.offsetX=-y,m.offsetY=-y}else d.add(new pt(2,o,r));if((a&8)===8){let p=h;p=Math.min(p,(a&4)===4?o/3:o),p=Math.min(p,(a&1)===1?r/3:r);const y=p*A.Rn;d.add(new pt(2,p,r)).add(new pt(3,0,r-p,y,r,0,r-y)),f.offsetX=y,m.offsetY=-y}else d.add(new pt(2,0,r));if((a&1)===1){const p=c*A.Rn;d.add(new pt(2,0,c)).add(new pt(3,c,0,0,p,p,0).close()),f.offsetX=p,f.offsetY=p}else d.add(new pt(2,0,0).close());return u.spot1=f,u.spot2=m,A.rr<A.Vg&&(A.or[l]=u,A.rr++),u};w("RoundedRectangle",(n,o,r)=>{const h=n?n.parameter1:NaN,a=n?n.parameter2:NaN;return e(n,o,r,h,a)}),w("Border","RoundedRectangle"),w("RoundedTopRectangle",(n,o,r)=>{const h=n?n.parameter1:NaN;return e(n,o,r,h,3)}),w("RoundedBottomRectangle",(n,o,r)=>{const h=n?n.parameter1:NaN;return e(n,o,r,h,12)}),w("RoundedLeftRectangle",(n,o,r)=>{const h=n?n.parameter1:NaN;return e(n,o,r,h,9)}),w("RoundedRightRectangle",(n,o,r)=>{const h=n?n.parameter1:NaN;return e(n,o,r,h,6)}),w("Ellipse",(n,o,r)=>{const h="e"+o+","+r;let a=A.or[h];return a!==void 0||(a=new Mt(3),a.endX=o,a.endY=r,a.spot1=B.zk,a.spot2=B.Xk,A.rr<A.Vg&&(A.or[h]=a,A.rr++)),a}),w("Circle",(n,o,r)=>{const h="c"+o+","+r;let a=A.or[h];return a!==void 0||(a=new Mt(3),a.endX=o,a.endY=r,a.spot1=B.zk,a.spot2=B.Xk,a.defaultStretch=6,A.rr<A.Vg&&(A.or[h]=a,A.rr++)),a}),w("TriangleRight",(n,o,r)=>new Mt().add(new qt(0,0).add(new pt(2,o,.5*r)).add(new pt(2,0,r).close())).setSpots(0,.25,.5,.75)),w("TriangleDown",(n,o,r)=>new Mt().add(new qt(0,0).add(new pt(2,o,0)).add(new pt(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),w("TriangleLeft",(n,o,r)=>new Mt().add(new qt(o,r).add(new pt(2,0,.5*r)).add(new pt(2,o,0).close())).setSpots(.5,.25,1,.75)),w("TriangleUp",(n,o,r)=>new Mt().add(new qt(o,r).add(new pt(2,0,r)).add(new pt(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),w("Triangle","TriangleUp"),w("Diamond",(n,o,r)=>new Mt().add(new qt(.5*o,0).add(new pt(2,0,.5*r)).add(new pt(2,.5*o,r)).add(new pt(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),w("LineH",(n,o,r)=>{const h=new Mt(1);return h.startX=0,h.startY=r/2,h.endX=o,h.endY=r/2,h}),w("LineV",(n,o,r)=>{const h=new Mt(1);return h.startX=o/2,h.startY=0,h.endX=o/2,h.endY=r,h}),w("None","Rectangle"),w("BarH","Rectangle"),w("BarV","Rectangle"),w("MinusLine","LineH"),w("PlusLine",(n,o,r)=>new Mt().add(new qt(0,r/2,!1).add(new pt(2,o,r/2)).add(new pt(1,o/2,0)).add(new pt(2,o/2,r)))),w("XLine",(n,o,r)=>new Mt().add(new qt(0,r,!1).add(new pt(2,o,0)).add(new pt(1,0,0)).add(new pt(2,o,r)))),w("LineRight",(n,o,r)=>new Mt().add(new qt(.25*o,0,!1).add(new pt(2,.75*o,.5*r)).add(new pt(2,.25*o,r)))),w("LineDown",(n,o,r)=>new Mt().add(new qt(0,.25*r,!1).add(new pt(2,.5*o,.75*r)).add(new pt(2,o,.25*r)))),w("LineLeft",(n,o,r)=>new Mt().add(new qt(.75*o,0,!1).add(new pt(2,.25*o,.5*r)).add(new pt(2,.75*o,r)))),w("LineUp",(n,o,r)=>new Mt().add(new qt(0,.75*r,!1).add(new pt(2,.5*o,.25*r)).add(new pt(2,o,.75*r)))),w("Capsule",(n,o,r)=>{const h=new Mt;if(o<r){const a=o/2,l=new qt(0,a,!0);h.add(l),l.add(new pt(5,180,180,a,a,a,a)),l.add(new pt(2,o,r-a)),l.add(new pt(5,0,180,a,r-a,a,a)),l.add(new pt(2,0,a));const u=isFinite(n.parameter1)?n.parameter1:o*.156;return h.spot1=new B(0,0,0,u),h.spot2=new B(1,1,0,-u),h}else if(o>r){const a=r/2,l=new qt(a,0,!0);h.add(l),l.add(new pt(2,o-a,0)),l.add(new pt(5,270,180,o-a,a,a,a)),l.add(new pt(2,a,r)),l.add(new pt(5,90,180,a,a,a,a));const u=isFinite(n.parameter1)?n.parameter1:r*.156;return h.spot1=new B(0,0,u,0),h.spot2=new B(1,1,-u,0),h}else return h.type=3,h.endX=o,h.endY=r,h.spot1=B.zk,h.spot2=B.Xk,h});const t=(n,o)=>new qt(n,o,!1,!1),i=(n,o,r)=>n.add(new pt(2,o,r)),s=(n,o,r)=>n.add(new pt(1,o,r));w("Borders",(n,o,r)=>{let h=n?n.parameter1:NaN;isNaN(h)?h=10:h=h&15;const a=new Mt;let l;return h===10?(l=t(o,0),i(l,o,r),s(l,0,r),i(l,0,0)):h===5?(l=t(0,0),i(l,o,0),s(l,o,r),i(l,0,r)):h===1?(l=t(0,0),i(l,o,0),s(l,o,r)):h===2?(l=t(o,0),i(l,o,r)):h===4?(l=t(o,r),i(l,0,r)):h===8?(l=t(0,r),i(l,0,0),s(l,o,r)):h===3?(l=t(0,0),i(l,o,0),i(l,o,r)):h===6?(l=t(o,0),i(l,o,r),i(l,0,r)):h===12?(l=t(o,r),i(l,0,r),i(l,0,0)):h===9?(l=t(0,r),i(l,0,0),i(l,o,0)):h===7?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r)):h===14?(l=t(o,0),i(l,o,r),i(l,0,r),i(l,0,0)):h===13?(l=t(o,r),i(l,0,r),i(l,0,0),i(l,o,0)):h===11?(l=t(0,r),i(l,0,0),i(l,o,0),i(l,o,r)):h===15?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r),l.add(new pt(2,0,0).close())):(l=t(0,0),s(l,o,r)),a.add(l),a})}A.Bg={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var nn=(w=>(w[w.None=0]="None",w[w.Added=1]="Added",w[w.Removed=2]="Removed",w[w.Shown=4]="Shown",w[w.Hidden=8]="Hidden",w[w.NodeSized=16]="NodeSized",w[w.GroupLayout=32]="GroupLayout",w[w.NodeReplaced=64]="NodeReplaced",w[w.Standard=127]="Standard",w[w.All=16777215]="All",w))(nn||{});const Gt=class Gt extends rt{constructor(t,i){let s;t===void 0||t instanceof Nt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"w");g(this,"zo");g(this,"j");g(this,"nl");g(this,"ol");g(this,"Xo");g(this,"ri");g(this,"Yo");g(this,"xh");g(this,"Ks");g(this,"Go");g(this,"kd");g(this,"WS");g(this,"sT");g(this,"Ep");g(this,"Up");this.w=2408959,this.zo="",this.j=null,this.nl="",this.ol=null,this.Xo=null,this.ri="",this.Yo=null,this.xh=null,this.Ks=new S(NaN,NaN).u(),this.Go=null,this.kd=NaN,this.WS=-1,this.sT=new z,this.Ep=null,this.Up=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.w=this.w&-4097|16384|32768,t.zo=this.zo,this.j!==null&&(this.j.fi?t.j=this.j:t.j=this.j.copy()),t.nl=this.nl,t.Xo=null,t.ri=this.ri,t.Ks.a(this.Ks),t.kd=this.kd}vo(t){super.vo(t),t.dh(),t.ol=null,t.Go=null,t.Ep=null}toString(){let t=b.Dn(this.constructor)+"#"+K.as(this);return this.data!==null&&(t+="("+b.toString(this.data)+")"),t}Hi(){return this.j===null?this.j=new us:this.j.fi&&(this.j=this.j.copy()),this.j}ch(){super.ch(),this.j!==null&&(this.j.fi=!0)}qc(t,i,s,n,o,r,h){const a=this.diagram;a!==null&&(t===3&&i==="elements"?o instanceof rt?o.Gr(l=>{a.partManager.IM(l,a)}):o instanceof be&&a.YM(o):t===4&&i==="elements"&&(o instanceof rt?o.Gr(l=>a.partManager.EM(l,a)):o instanceof be&&a.GM(o)),a.raiseChangedEvent(t,i,s,n,o,r,h))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const i=this.C.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];r instanceof rt&&r.Gr(h=>{h.data!==null&&h.updateTargetBindings()})}const n=this.adornments;for(;n.next();)n.value.updateTargetBindings(t)}Do(){if(super.Do(),this.L2()){const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof rt&&o.Gr(r=>r.Do())}}const t=this.adornments;for(;t.next();)t.value.Do()}updateRelationshipsFromData(){var t;this.data!==null&&((t=this.diagram)==null||t.partManager.updateRelationshipsFromData(this))}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.Xo===null?he.instance:this.Xo.iteratorValues}findAdornment(t){const i=this.Xo;return i===null?null:i.get(t)}addAdornment(t,i){if(i===null)return;let s=null,n=this.Xo;if(n!==null&&(s=n.get(t)),s!==i){if(s!==null){const r=s.diagram;r!==null&&r.remove(s)}n===null&&(n=new bt,this.Xo=n),i.zo!==t&&(i.category=t),n.set(t,i);const o=this.diagram;if(o!==null){o.add(i);const r=i.adornedObject;if(r!==null){const h=r.findBindingPanel();h!==null&&(i.data=h.data)}}}}removeAdornment(t){const i=this.Xo;if(i===null)return;const s=i.get(t);if(s!==null){const n=s.diagram;n!==null&&(n.remove(s),s.data=null)}i.delete(t),i.count===0&&(this.Xo=null)}clearAdornments(){const t=this.Xo;if(t===null)return;const i=b.et(),s=t.iterator;for(;s.next();){const o=s.key;i.push(o)}const n=i.length;for(let o=0;o<n;o++)this.removeAdornment(i[o]);b.J(i)}updateAdornments(){var s;const t=this.diagram;if(t===null)return;this.tO(t),this.iO(t);let i=this.adornments;for(;i.next();){const n=i.value;n.c(),n.hasPlaceholder()&&((s=n.placeholder)==null||s.c())}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t._l(),this.nT()!==!0&&this.oT(!0))}JS(){this.nT()!==!1&&(this.updateAdornments(),this.oT(!1))}tO(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const s=this.selectionObject;if(s!==null&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let n=this.findAdornment(i);if(n===null){let o=this.selectionAdornmentTemplate;o===null&&(this.Cl()?o=t.linkSelectionAdornmentTemplate:this instanceof ut?o=t.groupSelectionAdornmentTemplate:o=t.nodeSelectionAdornmentTemplate),n=o.copy(),n!==null&&(this.Cl()&&this.selectionObject===this.path&&(n.type=rt.Link),n.adornedObject=s)}if(n!==null){n.type===rt.Link&&n.c(),this.addAdornment(i,n);return}}}this.removeAdornment(i)}iO(t){const i=this;t.toolManager.mouseDownTools.each(s=>{s.isEnabled&&s.updateAdornments(i)}),t.toolManager.updateAdornments(i)}HS(t){this.Yo=t,t===null&&this.QR()}get layer(){return this.Yo}get diagram(){const t=this.Yo;return t==null?null:t.diagram}get layerName(){return this.nl}set layerName(t){const i=this.nl;if(i===t)return;let s=this.diagram;if(s!==null&&(s.findLayer(t)===null||s.partManager.addsToTemporaryLayer))return;this.nl=t,s!==null&&s.invalidateDocumentBounds(),this.t("layerName",i,t);const n=this.layer;if(n===null||n.name===t||(s=n.diagram,s===null))return;const o=s.findLayer(t);if(o===null||o===n)return;let r=n.te(-1,this,!0);r>=0&&s.raiseChangedEvent(4,"parts",n,this,null,r,!0),r=o.Jh(99999999,this,!0),n.visible!==o.visible&&this.Ei(o.visible),r>=0&&s.raiseChangedEvent(3,"parts",o,null,this,!0,r);const h=this.layerChanged;if(h===null)return;const a=s.X;s.X=!0,h(this,n,o),s.X=a}get layerChanged(){return this.j!==null?this.j.Bp:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(t!==null&&b.k(t,Gt,"layerChanged"),this.Hi().Bp=t,this.t("layerChanged",i,t))}get zOrder(){return this.kd}set zOrder(t){const i=this.kd;if(i===t)return;this.kd=t;const s=this.layer;s!==null&&s.Px(-1,this),this.t("zOrder",i,t);const n=this.diagram;n!==null&&n.S()}eO(){const t=this.layer;t!==null&&t.Px(-1,this)}g1(){if(this.ih()!==!1)return;this.tN(!0),this.$c();const t=this.diagram;t!==null&&(t.t0(this),t.requestUpdate())}rT(){if(this.w|=2097152,this.ih()===!1)return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.lT(t,i);const s=this.Ni,n=z.l().a(s);s.Pt(),s.x=t.x,s.y=t.y,s.u(),this.Ju(n,s),z.e(n),this.tN(!1),this.$c()}Wn(t,i,s,n){const o=this.se;o.i(t,i,s,n),this.wi===null&&(this.wi=new Tt);const r=this.wi;r.Ri(),this.m0(r,t,i,s,n),this.wi=r,r.Yk()||r.vg(o)}m0(t,i,s,n,o){if(this.tt!==1&&t.tt(this.tt),this.Yt===0)return;let r=B.Center;this.locationSpot.isSpot()&&(r=this.locationSpot);const h=S.l();if(this.locationObject!==this){const a=this.locationObject,l=a.naturalBounds;h.setSpot(l.x,l.y,l.width,l.height,r),a.wi!==null&&a.wi.gt(h),h.offset(-a.measuredBounds.x,-a.measuredBounds.y);let u=a.panel;for(;u!==null&&u!==this;)u.wi!==null&&u.wi.gt(h),h.offset(-u.measuredBounds.x,-u.measuredBounds.y),u=u.panel}else h.setSpot(i,s,n,o,r);t.cs(this.Yt,h.x,h.y),S.e(h)}get locationObject(){var t;if(this.Go===null)if(this instanceof yt&&this.type!==rt.Link&&this.hasPlaceholder())this.Go=this.placeholder;else{const i=this.locationObjectName;if(i!==""){const s=this.findObject(i);s!==null?this.Go=s:this.Go=this}else this.Go=this}return(t=this.Go)!=null&&t.visible?this.Go:this}get minLocation(){return this.j!==null?this.j.Vp:S.gC}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.P(),this.Hi().Vp=t,this.t("minLocation",i,t))}get maxLocation(){return this.j!==null?this.j.zp:S.mC}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.P(),this.Hi().zp=t,this.t("maxLocation",i,t))}get locationObjectName(){return this.j!==null?this.j.Xp:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this.Hi().Xp=t,this.Go=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return this.j!==null?this.j.Yp:B.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.P(),this.Hi().Yp=t,this.c(),this.t("locationSpot",i,t))}move(t,i){i===!0?this.location=t:this.position=t}moveTo(t,i,s){const n=S.V(t,i);this.move(n,s),S.e(n)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const s=t.diagram;if(s!==null&&s.animationManager.hx(this))return!0}const i=this.containingGroup;return!(i!==null&&(!i.isSubGraphExpanded||!i.isVisible()))}Ei(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),i!==null&&i.t0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.dh(),i!==null&&(i.invalidateDocumentBounds(),i.S())}findObject(t){if(this.name===t)return this;let i=this.Ep;if(i===null&&(this.Ep=i=new bt),i.get(t)!==null)return i.get(t);const s=super.findObject(t);return s!==null?(i.set(t,s),s):(i.set(t,null),null)}A0(){this.Ep=null}getRelativePoint(t,i,s){s===void 0&&(s=new S);const n=i.isNoSpot()?B.Center:i,o=t.naturalBounds;if(s.i(o.width*n.x+n.offsetX,o.height*n.y+n.offsetY),t===null||t===this)return s;t.T.gt(s);let r=t.panel;for(;r!==null&&r!==this;)r.T.gt(s),r=r.panel;return this.wi!==null&&this.wi.gt(s),s.offset(-this.se.x,-this.se.y),s}getDocumentBounds(t){return t===void 0&&(t=new z),t.a(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Bt()}IA(t){const i=this.locationSpot,s=this.locationObject;let n=s.naturalBounds;n.isReal()||(n=z.Fg);const o=s instanceof dt?s.strokeWidth:0;if(t.setSpot(0,0,n.width+o,n.height+o,i),s!==this){t.offset(-o/2,-o/2),s.T.gt(t);let r=s.panel;for(;r!==null&&r!==this;)r.T.gt(t),r=r.panel}return this.wi!==null&&this.wi.gt(t),t.offset(-this.se.x,-this.se.y),t}Wh(t,i){const s=i===void 0?this.sT:i,n=this.sO(),o=n*2;if(!this.isShadowed)return s.i(t.x-1-n,t.y-1-n,t.width+2+o,t.height+2+o),s;let r=t.x,h=t.y,a=t.width,l=t.height;const u=this.shadowBlur,c=this.shadowOffset;return a+=u,l+=u,r-=u/2,h-=u/2,c.x>0?a+=c.x:(r+=c.x,a-=c.x),c.y>0?l+=c.y:(h+=c.y,l-=c.y),s.i(r-1,h-1,a+2,l+2),s}Vv(){return this.type===rt.Link&&this instanceof yt&&this.category==="Selection"&&this.adornedObject instanceof dt&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}sO(){return isNaN(this.Up)&&(this.Up=this.YA()),this.Up}cf(){this.Up=NaN}Bt(){if(this._e()===!1){this.rT();return}this.Jn(!1);const t=this.Ni,i=z.l();i.a(t);const s=this.Nl();this.uh(0,0,this.se.width,this.se.height);const n=this.position;this.lT(n,this.location),t.Pt(),t.x=n.x,t.y=n.y,t.u(),this.Ju(i,t),i.equals(t)?this.ps(s):this.ke()&&(!A.f(i.width,t.width)||!A.f(i.height,t.height))&&this.WS>=0&&this.invalidateLayout(16),z.e(i),this.tN(!1)}Ju(t,i){const s=this.diagram;if(s===null)return;let n=!1;if(s.ta===!1&&t.isReal()){const o=z.l();o.a(s.documentBounds),o.subtractMargin(s.padding),t.x>o.x&&t.y>o.y&&t.right<o.right&&t.bottom<o.bottom&&i.x>o.x&&i.y>o.y&&i.right<o.right&&i.bottom<o.bottom&&(n=!0),z.e(o)}(this.nO()===!0||!t.equals(i))&&this.KL(n,s),s.S(),!(!t.isReal()&&!i.isReal()||t.equalsApproxClose(i))&&(this instanceof st&&!s.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.dh())}get location(){return this.Ks}set location(t){const i=t.x,s=t.y,n=this.Ks;(n.x!==i&&(!isNaN(n.x)||!isNaN(i))||n.y!==s&&(!isNaN(n.y)||!isNaN(s)))&&(t=t.copy(),this.oO(t,n)&&this.t("location",n,t.copy()))}oO(t,i){if(this.Cl())return!1;if(this.Ks=t,this.w|=2097152,this._e()===!1){this.g1();const s=this.at;if(s.isReal()){const n=this.diagram;if(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing){const o=s.copy();s.i(s.x+(t.x-i.x),s.y+(t.y-i.y)),this.hT(n,s,o.x,o.y),this.t("position",o,s.copy())}}}return!0}M2(t,i,s){if(this.Cl()||!t.isReal())return!1;const n=this.diagram;if(n!==null&&this.hT(n,t,i,s),this.at=t,this.w&=-2097153,this.Ks.isReal()&&(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing)){const o=this.Ks;this.Ks=new S(o.x+(t.x-i),o.y+(t.y-s)),this.t("location",o,this.Ks.copy())}return this.ih()===!1&&this._e()===!1&&(this.g1(),this.rT()),!0}hT(t,i,s,n){if(t===null||this instanceof yt)return;const o=t.animationManager;o.pi&&o.dL(this,new S(s,n),i,!1)}bc(t,i,s){const n=this.Ks,o=this.at;if(s){if(n.x===t&&n.y===i)return;this.ih()||this._e()?o.i(NaN,NaN):o.i(o.x+t-n.x,o.y+i-n.y),n.i(t,i)}else{if(o.x===t&&o.y===i)return;n.i(n.x+t-o.x,n.y+i-o.y),o.i(t,i)}this.g1()}N2(){this.w&=-2097153,this.g1()}lT(t,i){const s=this.IA(S.l()),n=this.diagram,o=i.isReal(),r=t.isReal();o&&r?this.w&2097152?this.aT(t,i,n,s):this.cT(t,i,n,s):o?this.aT(t,i,n,s):r&&this.cT(t,i,n,s),this.w|=2097152,S.e(s),this.$c()}aT(t,i,s,n){const o=t.x,r=t.y;if(t.i(i.x-n.x,i.y-n.y),s!==null){const h=s.animationManager,a=h.defaultAnimation.isAnimating;!a&&h.pi&&!(this instanceof yt)&&h.dL(this,new S(o,r),t,!1),!a&&!(t.x===o&&t.y===r)&&this.t("position",new S(o,r),t.copy())}}cT(t,i,s,n){const o=i.copy();i.i(t.x+n.x,t.y+n.y),!i.equals(o)&&s!==null&&this.t("location",o,i.copy())}KL(t,i){this.w2(!1),this instanceof st&&i.JM(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const s=this.Ni,n=i.viewportBounds;n.isReal()?this.Nl()?(s.intersectsRectPlus(n,10)||this.ps(!1),this.updateAdornments()):this.isVisible()&&s.intersectsRect(n)?(this.ps(!0),this.updateAdornments()):this.invalidateAdornments():i.Ic=!0}Yr(){return!0}ke(){return!0}Cl(){return!1}Xs(){return!0}hasPlaceholder(){return!1}get category(){return this.zo}set category(t){const i=this.zo;if(i===t)return;this.svg!==null&&(this.svg.remove(),this.Ve(!0));const s=this.diagram,n=this.data;let o=null;if(s!==null&&n!==null&&!(this instanceof yt)){const r=s.model.undoManager;r.isEnabled&&!r.isUndoingRedoing&&(o=this.clone(),o.C.addAll(this.C))}if(this.zo=t,this.t("category",i,t),s!==null&&n!==null&&!(this instanceof yt)){const r=s.model;if(r.undoManager.isUndoingRedoing)return;if(this.Cl()){s.partManager.setLinkCategoryForData(n,t);const h=s.partManager.findLinkTemplateForCategory(t);if(h!==null){h.Et();const a=h.copy();a!==null&&this.iN(a,i,t)}}else{r!==null&&r.setCategoryForNodeData(n,t);const h=s.partManager.findTemplateForNodeData(n,t);if(h!==null){h.Et();const a=h.copy();if(a!==null&&!(a instanceof at)){const l=this.location.copy();this.iN(a,i,t),this.location.isReal()||(this.location=l)}}}if(o!==null){const h=this.clone();h.C.addAll(this.C),this.t("self",o,h)}}else if(this instanceof yt){const r=this.adornedPart;if(r!==null){const h=r.Xo;h!==null&&h.delete(i),r.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.iN(t,this.category,t.category)}iN(t,i,s){t.constructor!==this.constructor&&(Gt.fT||(Gt.fT=!0,b.ni('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),b.ni("  Old class: "+b.Dn(this.constructor)+", new class: "+b.Dn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,r=this.isSelected,h=this.isHighlighted;let a=!0,l=!0,u=!1;this instanceof st&&(a=this.isTreeLeaf,l=this.isTreeExpanded,u=this.wasTreeExpanded),t.vo(this),t.cloneProtected(this),this.zo=s,this.svg!==null&&(this.svg.remove(),this.svg=null,this.Ve(!0)),this.c(),this.S();const c=this.diagram;let d=!0;c!==null&&(d=c.skipsUndoManager,c.skipsUndoManager=!0),this._t=n,this.w=r?this.w|4096:this.w&-4097,this.w=h?this.w|524288:this.w&-524289,this instanceof st&&(this.v=a?this.v|4:this.v&-5,this.v=l?this.v|1:this.v&-2,this.v=u?this.v|2:this.v&-3),n!==null&&this.updateTargetBindings();const f=this.layerName;f!==o&&(this.nl=o,this.layerName=f),c!==null&&(c.skipsUndoManager=d),this.ke()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return i===null?!0:!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return i===null?!0:!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return i===null?!0:!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return i===null?!0:!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const i=t.diagram;return i===null?!0:!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return i===null?!0:!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const i=t.diagram;return i===null?!0:!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return i===null?!0:!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return i===null?!0:!!i.allowSelect}get copyable(){return(this.w&1)!==0}set copyable(t){const i=(this.w&1)!==0;i!==t&&(this.w=this.w^1,this.t("copyable",i,t))}get deletable(){return(this.w&2)!==0}set deletable(t){const i=(this.w&2)!==0;i!==t&&(this.w=this.w^2,this.t("deletable",i,t))}get textEditable(){return(this.w&4)!==0}set textEditable(t){const i=(this.w&4)!==0;i!==t&&(this.w=this.w^4,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return(this.w&8)!==0}set groupable(t){const i=(this.w&8)!==0;i!==t&&(this.w=this.w^8,this.t("groupable",i,t))}get movable(){return(this.w&16)!==0}set movable(t){const i=(this.w&16)!==0;i!==t&&(this.w=this.w^16,this.t("movable",i,t))}get selectionAdorned(){return(this.w&32)!==0}set selectionAdorned(t){const i=(this.w&32)!==0;i!==t&&(this.w=this.w^32,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.w&64)!==0}set isInDocumentBounds(t){const i=(this.w&64)!==0;if(i!==t){this.w=this.w^64;const s=this.diagram;s!==null&&s.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return(this.w&128)!==0}set isLayoutPositioned(t){const i=(this.w&128)!==0;i!==t&&(this.w=this.w^128,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.w&256)!==0}set selectable(t){const i=(this.w&256)!==0;i!==t&&(this.w=this.w^256,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return(this.w&512)!==0}set reshapable(t){const i=(this.w&512)!==0;i!==t&&(this.w=this.w^512,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return(this.w&1024)!==0}set resizable(t){const i=(this.w&1024)!==0;i!==t&&(this.w=this.w^1024,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return(this.w&2048)!==0}set rotatable(t){const i=(this.w&2048)!==0;i!==t&&(this.w=this.w^2048,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return(this.w&4096)!==0}set isSelected(t){const i=(this.w&4096)!==0;if(i!==t){const s=this.diagram;if(t){if(!this.canSelect())return;if(s!==null){const r=s.maxSelectionCount;if(s.selection.count>=r)return}}this.w=this.w^4096;let n=!1;if(s!==null){n=s.skipsUndoManager,s.skipsUndoManager=!0;const r=s.selection;r.Pt(),t?r.add(this):r.delete(this),r.u()}this.t("isSelected",i,t),this.invalidateAdornments();const o=this.selectionChanged;o!==null&&o(this),s!==null&&(s.requestUpdate(),s.skipsUndoManager=n)}}get isHighlighted(){return(this.w&524288)!==0}set isHighlighted(t){const i=(this.w&524288)!==0;if(i!==t){this.w=this.w^524288;const s=this.diagram;if(s!==null){const o=s.highlighteds;o.Pt(),t?o.add(this):o.delete(this),o.u()}this.t("isHighlighted",i,t),this.S();const n=this.highlightedChanged;n!==null&&n(this)}}get isShadowed(){return(this.w&8192)!==0}set isShadowed(t){const i=(this.w&8192)!==0;i!==t&&(this.w=this.w^8192,this.Ve(!0),this.t("isShadowed",i,t),this.S())}nT(){return(this.w&16384)!==0}oT(t){t?this.w|=16384:this.w&=-16385}ih(){return(this.w&32768)!==0}tN(t){t?this.w|=32768:this.w&=-32769}nO(){return(this.w&65536)!==0}w2(t){t?this.w|=65536:this.w&=-65537}Nl(){return(this.w&131072)!==0}ps(t){t?this.w|=131072:this.w&=-131073}uT(){return(this.w&1048576)!==0}m1(t){t?this.w|=1048576:this.w&=-1048577}get isAnimated(){return(this.w&262144)!==0}set isAnimated(t){const i=(this.w&262144)!==0;i!==t&&(this.w=this.w^262144,this.t("isAnimated",i,t))}get highlightedChanged(){return this.j!==null?this.j.Gp:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(t!==null&&b.k(t,Gt,"highlightedChanged"),this.Hi().Gp=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return this.j!==null?this.j.Kp:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this.Hi().Kp=t,this.ol=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return this.j!==null?this.j.jp:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(t!==null&&t.Et(),this.Hi().jp=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(this.ol===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const i=this.findObject(t);i!==null?this.ol=i:this.ol=this}else if(this instanceof at){const i=this.path;i!==null?this.ol=i:this.ol=this}else this.ol=this}return this.ol}get selectionChanged(){return this.j!==null?this.j.Hp:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(t!==null&&b.k(t,Gt,"selectionChanged"),this.Hi().Hp=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return this.j!==null?this.j.qp:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this.Hi().qp=t!==null?t.Et():null,this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return this.j!==null?this.j.Wp:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this.Hi().Wp=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get resizeCellSize(){return this.j!==null?this.j.Jp:ot.ww}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.P(),this.Hi().Jp=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return this.j!==null?this.j.$p:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this.Hi().$p=t!==null?t.Et():null,this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return this.j!==null?this.j.Zp:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this.Hi().Zp=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get rotationSpot(){return this.j!==null?this.j.Qp:B.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.P(),this.Hi().Qp=t,this.t("rotationSpot",i,t))}get text(){return this.ri}set text(t){const i=this.ri;i!==t&&(this.ri=t,this.t("text",i,t))}get containingGroup(){return this.xh}set containingGroup(t){if(this.ke()){const i=this.xh;if(i!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&b.o("Cannot make a Group a member of itself: "+this.toString()),b.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(i!==null?i.eN(this):this instanceof ut&&s!==null&&s.zr.delete(this),this.xh=t,t!==null?t.sN(this):this instanceof ut&&s!==null&&s.zr.add(this),this.invalidateLayout(1),s!==null&&s.X){const o=this.data,r=s.model;if(o!==null&&r.Hc()){const h=t!==null?t.data:null;r.setGroupForData(o,r.getKeyForNodeData(h))}}const n=this.containingGroupChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this,i,t),s!==null&&(s.X=o)}if(this instanceof ut){const o=new K;Gt.oh(o,this,!0,0,!0);const r=o.iterator;for(;r.next();){const h=r.value;if(h instanceof st){const a=h.linksConnected;for(;a.next();)a.value.Pd()}}}if(this instanceof st){const o=this.linksConnected;for(;o.next();)o.value.Pd();const r=this.labeledLink;r!==null&&r.Pd()}this.t("containingGroup",i,t),t!==null&&t.eO()}}else b.o("cannot set the Part.containingGroup of a Link or Adornment")}dh(){var i;const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&((i=t.placeholder)==null||i.c()),t.c(),t.invalidateConnectedLinks())}S(){const t=this.diagram;t!==null&&!this._e()&&!this.ih()&&this.isVisible()&&this.Ni.isReal()&&t.S(this.Wh(this.Ni))}c(){if(this.To())return;super.c();const t=this.diagram;t!==null&&(t.t0(this),this instanceof st&&this.labeledLink!==null&&this.labeledLink.ef(),t.requestUpdate(!0))}ef(t){if(this._e())return;const i=this.diagram;i!==null&&(i.t0(this),this instanceof st&&this.invalidateConnectedLinks(),i.requestUpdate()),this.Jn(!0)}Rm(t){if(!t){const i=this.xh;i!==null&&i.sN(this)}}vm(t){if(!t){const i=this.xh;i!==null&&i.eN(this)}}Xc(){const t=this.data;if(t!==null){const i=this.diagram;if(i!==null){const s=i.model;s!==null&&s.removeNodeData(t)}}}get containingGroupChanged(){return this.j!==null?this.j._p:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(t!==null&&b.k(t,Gt,"containingGroupChanged"),this.Hi()._p=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.nN(this)}nN(t){const i=t.containingGroup;if(i!==null)return 1+this.nN(i);if(t instanceof st){const s=t.labeledLink;if(s!==null)return this.nN(s)}return 0}findTopLevelPart(){return this.oN(this)}oN(t){const i=t.containingGroup;if(i!==null)return this.oN(i);if(t instanceof st){const s=t.labeledLink;if(s!==null)return this.oN(s)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof st&&this.labeledLink!==null)}isMemberOf(t){return t instanceof ut?this.rN(this,t):!1}rN(t,i){if(t===i||i===null)return!1;const s=t.containingGroup;if(s!==null&&(s===i||this.rN(s,i)))return!0;if(t instanceof st){const n=t.labeledLink;if(n!==null)return this.rN(n,i)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let i=this;for(;i!==null;){if(i instanceof ut&&i.m1(!0),i instanceof st){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}let s=null;for(i=t;i!==null;){if(i.uT()){s=i;break}if(i instanceof st){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}for(i=this;i!==null;){if(i instanceof ut&&i.m1(!1),i instanceof st){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}return s}get layoutConditions(){return this.j!==null?this.j.ty:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this.Hi().ty=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof st&&this.isLinkLabel)}rO(t){if(!this.isLayoutPositioned||!(t&this.layoutConditions))return!1;const i=this.layer;if(i!==null&&i.isTemporary||this instanceof st&&this.isLinkLabel)return!1;const s=this.diagram;return!(s!==null&&s.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.rO(t))return;const i=this.xh;if(i!==null){const s=i.layout;s!==null?s.invalidateLayout():i.invalidateLayout(t)}else{const s=this.diagram;if(s!==null){const n=s.layout;n!==null&&n.invalidateLayout()}}}jL(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static oh(t,i,s,n,o,r){if(r===void 0&&(r=null),!t.has(i)&&!(r!==null&&!r(i))&&!(i instanceof yt)){if(t.add(i),i instanceof st){if(s&&i instanceof ut){const h=i.memberParts;for(;h.next();){const a=h.value;Gt.oh(t,a,s,n,o,r)}}if(o!==!1){const h=i.linksConnected;for(;h.next();){const a=h.value;if(t.has(a))continue;const l=a.fromNode,u=a.toNode,c=l===null||t.has(l),d=u===null||t.has(u);(o?c&&d:c||d)&&Gt.oh(t,a,s,n,o,r)}}if(n>1){const h=i.findTreeChildrenNodes();for(;h.next();){const a=h.value;Gt.oh(t,a,s,n-1,o,r)}}}else if(i instanceof at){const h=i.labelNodes;for(;h.next();){const a=h.value;Gt.oh(t,a,s,n,o,r)}}}}get dragComputation(){return this.j!==null?this.j.iy:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(t!==null&&b.k(t,Gt,"dragComputation"),this.Hi().iy=t,this.t("dragComputation",i,t))}get shadowOffset(){return this.j!==null?this.j.ey:S.pC}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.P(),this.Hi().ey=t,this.S(),this.t("shadowOffset",i,t))}get shadowColor(){return this.j!==null?this.j.ny:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this.Hi().ny=t,this.S(),this.t("shadowColor",i,t))}get shadowBlur(){return this.j!==null?this.j.un:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this.Hi().un=t,this.S(),this.t("shadowBlur",i,t))}};g(Gt,"LayoutNone",0),g(Gt,"LayoutAdded",1),g(Gt,"LayoutRemoved",2),g(Gt,"LayoutShown",4),g(Gt,"LayoutHidden",8),g(Gt,"LayoutNodeSized",16),g(Gt,"LayoutGroupLayout",32),g(Gt,"LayoutNodeReplaced",64),g(Gt,"LayoutStandard",127),g(Gt,"LayoutAll",16777215),g(Gt,"fT",!1);let Lt=Gt;class us{constructor(){g(this,"fi");g(this,"Bp");g(this,"_p");g(this,"jp");g(this,"Kp");g(this,"Hp");g(this,"Gp");g(this,"qp");g(this,"Wp");g(this,"Jp");g(this,"$p");g(this,"Zp");g(this,"Qp");g(this,"Xp");g(this,"Yp");g(this,"Vp");g(this,"zp");g(this,"iy");g(this,"ty");g(this,"ey");g(this,"ny");g(this,"un");this.fi=!1,this.Bp=null,this._p=null,this.jp=null,this.Kp="",this.Hp=null,this.Gp=null,this.qp=null,this.Wp="",this.Jp=ot.ww,this.$p=null,this.Zp="",this.Qp=B.Default,this.Xp="",this.Yp=B.TopLeft,this.Vp=S.gC,this.zp=S.mC,this.iy=null,this.ty=127,this.ey=S.pC,this.ny="gray",this.un=4}copy(){const e=new us;return e.Bp=this.Bp,e._p=this._p,e.jp=this.jp,e.Kp=this.Kp,e.Hp=this.Hp,e.Gp=this.Gp,e.qp=this.qp,e.Wp=this.Wp,e.Jp=this.Jp.P(),e.$p=this.$p,e.Zp=this.Zp,e.Qp=this.Qp.P(),e.Xp=this.Xp,e.Yp=this.Yp.P(),e.Vp=this.Vp.P(),e.zp=this.zp.P(),e.iy=this.iy,e.ty=this.ty,e.ey=this.ey.P(),e.ny=this.ny,e.un=this.un,e}}class yt extends Lt{constructor(t,i){let s;t===void 0||t instanceof Nt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"us");g(this,"Ft");g(this,"nS");g(this,"oS");g(this,"hf");this.w&=-257,this.nl="Adornment",this.us=null,this.nS=0,this.oS=!1,this.Ft=null,this.hf=null,i&&Object.assign(this,i)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}sd(t){const i=this.adornedObject;if(!(i instanceof dt))return;const s=i.part;if(!(s instanceof at))return;const n=s.path;let o=n.geometry;s.sd(t),o=n.geometry;const r=this.C.r,h=r.length;for(let a=0;a<h;a++){const l=r[a];l.isPanelMain&&l instanceof dt&&(l.ot=o)}}hasPlaceholder(){return this.Ft!==null&&this.Ft.isVisibleObject()}get placeholder(){return this.Ft}get adornedObject(){return this.us}set adornedObject(t){const i=this.adornedPart;let s=null;t!==null&&(s=t.part),i!==null&&(t===null||i!==s)&&i.removeAdornment(this.category),this.us=t,s!==null&&s.addAdornment(this.category,this)}get adornedPart(){const t=this.us;return t!==null?t.part:null}Yr(){const t=this.us;if(t===null)return!0;const i=t.part;return i===null||!i._e()}ke(){return!1}get containingGroup(){return null}qc(t,i,s,n,o,r,h){if(t===3&&i==="elements"){if(o instanceof ve)this.Ft===null&&(this.Ft=o);else if(o instanceof rt){const a=o.findInVisualTree(l=>l instanceof ve);a instanceof ve&&this.Ft===null&&(this.Ft=a)}}else t===4&&i==="elements"&&this.Ft!==null&&(n===this.Ft?this.Ft=null:n instanceof rt&&this.Ft.isContainedBy(n)&&(this.Ft=null));super.qc(t,i,s,n,o,r,h)}updateAdornments(){}Xc(){}}var on=(w=>(w[w.None=0]="None",w[w.Evenly=1]="Evenly",w[w.Packed=2]="Packed",w))(on||{});const De=class De extends Lt{constructor(t,i){let s;t===void 0||t instanceof Nt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"v");g(this,"Rt");g(this,"kf");g(this,"rl");g(this,"bh");g(this,"ne");g(this,"ti");this.v=13,this.Rt=null,this.ti=new J,this.kf=null,this.rl=null,this.ne=null,this.bh=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.v=this.v,this.Rt!==null&&(this.Rt.fi?t.Rt=this.Rt:t.Rt=this.Rt.copy())}vo(t){super.vo(t),t.invalidateConnectedLinks(),t.rl=this.rl,t.ne=null}ll(){return this.Rt===null?this.Rt=new cs:this.Rt.fi&&(this.Rt=this.Rt.copy()),this.Rt}ch(){super.ch(),this.Rt!==null&&(this.Rt.fi=!0)}dT(t){t!==null&&(this.rl===null&&(this.rl=new K),this.rl.add(t))}gT(t){t!==null&&this.rl!==null&&this.rl.delete(t)}mT(t,i,s){if(t===null||this.rl===null)return null;const n=this.rl.iterator;for(;n.next();){const o=n.value;if(o.ly===this&&o.p1===t&&o.lN===i&&o.hN===s||o.ly===t&&o.p1===this&&o.lN===s&&o.hN===i)return o}return null}invalidateLinkBundle(t,i,s){i==null&&(i=""),s==null&&(s="");const n=this.mT(t,i,s);n!==null&&n.Sd()}qc(t,i,s,n,o,r,h){t===3&&i==="elements"?this.ne=null:t===4&&i==="elements"&&(this.ne=null),super.qc(t,i,s,n,o,r,h)}invalidateConnectedLinks(t){const i=this.linksConnected;for(;i.next();){const s=i.value;t!==void 0&&t.has(s)||(this.qi(s.fromPort),this.qi(s.toPort),s.invalidateRoute())}}bA(t){const i=this.linksConnected;for(;i.next();){const s=i.value;s.fromPort!==t&&s.toPort!==t||(this.qi(s.fromPort),this.qi(s.toPort),s.invalidateRoute())}}qi(t){if(t===null)return;const i=t.Ku;i!==null&&i.Sd();const s=t.part,n=s.containingGroup;n!==null&&!s.isVisible()&&n.qi(n.port)}Yr(){return!0}get portSpreading(){return this.Rt!==null?this.Rt.hy:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.ll().hy=t,this.t("portSpreading",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.v&8)!==0}set avoidable(t){const i=(this.v&8)!==0;if(i!==t){this.v=this.v^8;const s=this.diagram;s!==null&&s.JM(this),this.t("avoidable",i,t)}}get avoidableMargin(){return this.Rt!==null?this.Rt.ay:Ot.PC}set avoidableMargin(t){typeof t=="number"&&(t=new Ot(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.P(),this.ll().ay=t;const s=this.diagram;s!==null&&s.JM(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const s=this.diagram;if(s!==null){if(s.animationManager.hx(this))return!0;t=s.isTreePathToChildren,i=s.treeCollapsePolicy}if(i===1){const o=this.findTreeParentNode();if(o!==null&&!o.isTreeExpanded)return!1}else if(i===2){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,h=!1;for(;o.next();){const a=o.value;if(a.isTreeLink){r=!0;const l=t?a.fromNode:a.toNode;if(l&&l.isTreeExpanded){h=!0;break}}}if(r&&!h)return!1}else if(i===3){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,h=!1;for(;o.next();){const a=o.value;if(a.isTreeLink){r=!0;const l=t?a.fromNode:a.toNode;if(l&&!l.isTreeExpanded){h=!0;break}}}if(r&&h)return!1}const n=this.labeledLink;return n!==null?n.isVisible():!0}Ei(t){super.Ei(t);const i=this.linksConnected;for(;i.next();){const s=i.value;if(t&&this.containingGroup!==null){const n=s.getOtherNode(this);n!==null&&!n.isMemberOf(this.containingGroup)&&s.invalidateRoute()}s.Ei(t)}}get linksConnected(){return this.ti.iterator}findExternalTreeLinksConnected(){const t=new K,i=new K;return this.pT(this,t,i),i.iterator}pT(t,i,s){if(t===null||i.has(t))return;i.add(t);let n=!0;const o=this.diagram;o!==null&&(n=o.isTreePathToChildren),t.linksConnected.each(r=>{r.isTreeLink?(n?r.fromNode===t:r.toNode===t)&&this.pT(n?r.toNode:r.fromNode,i,s):s.add(r)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ti.iterator;const i=new ei(this.ti),s=this;return i.predicate=n=>n.fromNode===s&&n.fromPortId===t||n.toNode===s&&n.toPortId===t,i}findLinksOutOf(t){t===void 0&&(t=null);const i=new ei(this.ti),s=this;return i.predicate=n=>n.fromNode!==s?!1:t===null?!0:n.fromPortId===t,i}findLinksInto(t){t===void 0&&(t=null);const i=new ei(this.ti),s=this;return i.predicate=n=>n.toNode!==s?!1:t===null?!0:n.toPortId===t,i}findNodesConnected(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this){if(t===null||o.fromPortId===t){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}else if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new ti(s):he.instance}findNodesOutOf(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this&&(t===null||o.fromPortId===t)){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new ti(s):he.instance}findNodesInto(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new K,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new ti(s):he.instance}findLinksBetween(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new ei(this.ti),o=this;return n.predicate=r=>r.fromNode===o&&r.toNode===t&&(i===null||r.fromPortId===i)&&(s===null||r.toPortId===s)||r.fromNode===t&&r.toNode===o&&(s===null||r.fromPortId===s)&&(i===null||r.toPortId===i),n}findLinksTo(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new ei(this.ti),o=this;return n.predicate=r=>!(r.fromNode!==o||r.toNode!==t||i!==null&&r.fromPortId!==i||s!==null&&r.toPortId!==s),n}get linkConnected(){return this.Rt!==null?this.Rt.cy:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(t!==null&&b.k(t,De,"linkConnected"),this.ll().cy=t,this.t("linkConnected",i,t))}get linkDisconnected(){return this.Rt!==null?this.Rt.fy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(t!==null&&b.k(t,De,"linkDisconnected"),this.ll().fy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return this.Rt!==null?this.Rt.Ml:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(t!==null&&b.k(t,De,"linkValidation"),this.ll().Ml=t,this.t("linkValidation",i,t))}w1(t,i){this.qi(i);const s=this.ti.has(t);if(s||this.ti.add(t),!s||t.fromNode===t.toNode){const n=this.linkConnected;if(n!==null){let o=!0;const r=this.diagram;r!==null&&(o=r.X,r.X=!0),n(this,t,i),r!==null&&(r.X=o)}}if(!s){if(!t.isTreeLink)return;const n=t.fromNode,o=t.toNode;if(n!==null&&o!==null&&n!==o){let r=!0;const h=this.diagram;h!==null&&(r=h.isTreePathToChildren);const a=r?o:n,l=r?n:o;if(a.bh||(a.bh=l),l.isTreeLeaf){if(h!==null&&h.undoManager.isUndoingRedoing)return;r?n===l&&(l.isTreeLeaf=!1):o===l&&(l.isTreeLeaf=!1)}}}}b1(t,i){this.qi(i);const s=this.ti.delete(t);let n=null;if(s||t.toNode===t.fromNode){const o=this.linkDisconnected;if(n=this.diagram,o!==null){let r=!0;n!==null&&(r=n.X,n.X=!0),o(this,t,i),n!==null&&(n.X=r)}}if(s){if(!t.isTreeLink)return;let o=!0;n!==null&&(o=n.isTreePathToChildren);const r=o?t.toNode:t.fromNode,h=o?t.fromNode:t.toNode;if(r!==null&&(r.bh=!1),h!==null&&!h.isTreeLeaf)if(h.ti.count===0){if(h.bh=null,n!==null&&n.undoManager.isUndoingRedoing)return;h.isTreeLeaf=!0}else h.l0()}}l0(){if(this.bh=!1,this.ti.count===0)return;let t=!0;const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;i!==null&&(t=i.isTreePathToChildren);const s=this.ti.iterator;for(;s.next();){const n=s.value;if(n.isTreeLink){if(t){if(n.fromNode===this){this.isTreeLeaf=!1;return}}else if(n.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}Rm(t){if(super.Rm(t),!t){this.l0();const i=this.kf;i!==null&&i.yT(this)}}vm(t){if(super.vm(t),!t){const i=this.kf;i!==null&&i.wT(this)}}Xc(){if(this.ti.count>0){const t=this.diagram;if(t!==null){const i=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this.ti.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.Xc()}get isLinkLabel(){return this.kf!==null}get labeledLink(){return this.kf}set labeledLink(t){const i=this.kf;if(i!==t){const s=this.diagram,n=this.data;if(i!==null){if(i.wT(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=i.data,r=s.model;if(o!==null&&r.Ra()){const h=r.getKeyForNodeData(n);h!==void 0&&r.removeLabelKeyForLinkData(o,h)}}this.containingGroup=null}if(this.kf=t,t!==null){if(t.yT(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=t.data,r=s.model;if(o!==null&&r.Ra()){const h=r.getKeyForNodeData(n);h!==void 0&&r.addLabelKeyForLinkData(o,h)}}this.containingGroup=t.containingGroup}this.ef(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;i!==null&&(!i.actualBounds.isReal()||!i.isVisibleObject());)i=i.panel;return i===null?this.port:i}findPort(t){if(this.ne===null){if(t===""&&this.fn===!1)return this;this.xT()}let i=this.ne.get(t);return i!==null||t!==""&&(i=this.ne.get(""),i!==null)?i:this}get port(){return this.findPort("")}get ports(){return this.ne===null&&this.xT(),this.ne.iteratorValues}xT(){this.ne===null?this.ne=new bt:this.ne.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.LA(i)),this.ne.count===0&&this.ne.set("",this)}LA(t){const i=t.portId;i!==null&&this.ne!==null&&this.ne.set(i,t)}C2(t,i){const s=t.portId;if(s!==null){this.ne!==null&&this.ne.delete(s);const n=this.diagram;if(n!==null&&i){let o=null;const r=this.findLinksConnected(s);for(;r.next();){const h=r.value;o===null&&(o=b.et()),o.push(h)}if(o!==null){for(let h=0;h<o.length;h++){const a=o[h];n.remove(a)}b.J(o)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);let n=this;const o=t;let r;if(i)for(;n!==o;){r=null;const h=n.ti.iterator;for(;h.next();){const a=h.value;if(a.isTreeLink&&(r=a.fromNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}else for(;n!==o;){r=null;const h=n.ti.iterator;for(;h.next();){const a=h.value;if(a.isTreeLink&&(r=a.toNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}return!0}findTreeRoot(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=this,n;if(t)for(;;){n=null;const o=s.ti.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.fromNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}else for(;;){n=null;const o=s.ti.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.toNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let i=this;for(;i!==null;)i.m1(!0),i=i.findTreeParentNode();let s=null;for(i=t;i!==null;){if(i.uT()){s=i;break}i=i.findTreeParentNode()}for(i=this;i!==null;)i.m1(!1),i=i.findTreeParentNode();return s}findTreeParentLink(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=this.ti.iterator;if(t)for(;s.next();){const n=s.value;if(n.isTreeLink&&n.fromNode!==this)return n}else for(;s.next();){const n=s.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){const t=this.bh;if(t===null)return null;if(t instanceof De)return t;const i=this.diagram,s=i!==null?i.isTreePathToChildren:!0,n=this.ti.iterator;for(;n.next();){const o=n.value;if(!o.isTreeLink)continue;const r=s?o.fromNode:o.toNode;if(r!==this)return this.bh=r,r}return this.bh=null,null}findTreeParentChain(){function t(s,n){n.add(s);const o=s.findTreeParentLink();if(o!==null){n.add(o);const r=s.findTreeParentNode();if(r===null)return;t(r,n)}}const i=new K;return t(this,i),i}findTreeLevel(){return this.lO(this)}lO(t){let i=0,s=t.findTreeParentNode();for(;s!==null&&s!==t;)s=s.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=new ei(this.ti),n=this;return t?s.predicate=o=>!(!o.isTreeLink||o.fromNode!==n):s.predicate=o=>!(!o.isTreeLink||o.toNode!==n),s}findTreeChildrenNodes(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=null,n=null;const o=this.ti.iterator;if(t)for(;o.next();){const r=o.value;if(r.isTreeLink&&r.fromNode===this){const h=r.toNode;s!==null?s.add(h):n!==null&&n!==h?(s=new J,s.add(n),s.add(h)):n=h}}else for(;o.next();){const r=o.value;if(r.isTreeLink&&r.toNode===this){const h=r.fromNode;s!==null?s.add(h):n!==null&&n!==h?(s=new J,s.add(n),s.add(h)):n=h}}return s!==null?s.iterator:n!==null?new ti(n):he.instance}findTreeParts(t){t===void 0&&(t=1/0),b.s(t,"number",De,"findTreeParts:level");const i=new K;return Lt.oh(i,this,!1,t,!0),i}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new K;s.add(this),this.bT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}bT(t,i,s,n,o,r){if(s>1){const h=i?this.findLinksOutOf():this.findLinksInto();for(;h.next();){const a=h.value;if(!a.isTreeLink)continue;const l=a.getOtherNode(this);l!==null&&l!==this&&!t.has(l)&&(t.add(l),l.bT(t,i,s-1,n,o,r))}}else this.kT(t,i,n,o,r)}kT(t,i,s,n,o){const r=n===this?!0:this.isTreeExpanded,h=i?this.findLinksOutOf():this.findLinksInto();for(;h.next();){const a=h.value;if(!a.isTreeLink)continue;const l=a.getOtherNode(this);if(l!==null&&l!==this){const u=t.has(l);if(u||t.add(l),r){const c=i?l.findNodesInto():l.findNodesOutOf(),d=this;c.all(f=>f===d||!f.isTreeExpanded)&&s.Lc(l,n),l.dh(),l.Ei(!1)}l.isTreeExpanded&&(l.wasTreeExpanded=l.isTreeExpanded,u||l.kT(t,i,s,n,o))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new K;s.add(this),this.PT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}PT(t,i,s,n,o,r){const h=o===this?!1:this.isTreeExpanded,a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const l=a.value;if(!l.isTreeLink)continue;h||l.Se||l.invalidateRoute();const u=l.getOtherNode(this);if(u!==null&&u!==this&&!t.has(u)){if(t.add(u),!h){u.Ei(!0),u.dh();const c=i?u.findNodesInto():u.findNodesOutOf(),d=this;c.all(f=>f===d||!f.isTreeExpanded)&&n.Cc(u,o)}(s>2||u.wasTreeExpanded)&&(u.wasTreeExpanded=!1,u.PT(t,i,s-1,n,o,r))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.v&1)!==0}set isTreeExpanded(t){const i=(this.v&1)!==0;if(i!==t){this.v=this.v^1;const s=this.diagram;this.t("isTreeExpanded",i,t);const n=this.treeExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this),s!==null&&(s.X=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Ei(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.v&2)!==0}set wasTreeExpanded(t){const i=(this.v&2)!==0;i!==t&&(this.v=this.v^2,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return this.Rt!==null?this.Rt.uy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(t!==null&&b.k(t,De,"treeExpandedChanged"),this.ll().uy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return(this.v&4)!==0}set isTreeLeaf(t){const i=(this.v&4)!==0;i!==t&&(this.v=this.v^4,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return this.findTreeParentLink()===null}};g(De,"SpreadingNone",0),g(De,"SpreadingEvenly",1),g(De,"SpreadingPacked",2);let st=De;class cs{constructor(){g(this,"fi");g(this,"cy");g(this,"fy");g(this,"Ml");g(this,"uy");g(this,"ay");g(this,"hy");g(this,"gy");g(this,"my");g(this,"nh");g(this,"yy");this.fi=!1,this.cy=null,this.fy=null,this.Ml=null,this.uy=null,this.ay=Ot.PC,this.hy=1,this.gy=null,this.my=null,this.nh=null,this.yy=null}copy(){const e=new cs;return e.cy=this.cy,e.fy=this.fy,e.Ml=this.Ml,e.uy=this.uy,e.ay=this.ay.P(),e.hy=this.hy,e.gy=this.gy,e.my=this.my,e.nh=this.nh,e.yy=this.yy,e}}var ds=(w=>(w[w.None=0]="None",w[w.End=17]="End",w[w.Scale=18]="Scale",w[w.Stretch=19]="Stretch",w))(ds||{}),gs=(w=>(w[w.Normal=1]="Normal",w[w.Orthogonal=2]="Orthogonal",w[w.AvoidsNodes=6]="AvoidsNodes",w[w.AvoidsNodesStraight=7]="AvoidsNodesStraight",w))(gs||{}),fs=(w=>(w[w.None=0]="None",w[w.Bezier=9]="Bezier",w[w.JumpGap=10]="JumpGap",w[w.JumpOver=11]="JumpOver",w))(fs||{});const wt=class wt extends Lt{constructor(t){super(rt.Link);g(this,"Nt");g(this,"so");g(this,"no");g(this,"Md");g(this,"oo");g(this,"ro");g(this,"Nd");g(this,"Pf");g(this,"Cd");g(this,"Ld");g(this,"Ad");g(this,"va");g(this,"Td");g(this,"js");g(this,"xi");g(this,"hl");g(this,"br");g(this,"Sf");g(this,"Ko");g(this,"aN");g(this,"cN");g(this,"k1");g(this,"fN");g(this,"uN");g(this,"Oa");g(this,"P1");g(this,"ot");g(this,"jo");g(this,"hf");g(this,"dN");g(this,"gN");this.Nt=8,this.so=null,this.no="",this.Md=null,this.oo=null,this.ro="",this.Nd=null,this.Pf=0,this.Cd=0,this.Ld=0,this.Ad=NaN,this.va=1,this.Td=.5,this.js=null,this.xi=new J().u(),this.hl=null,this.br=null,this.Sf=new z,this.ot=new Mt,this.Ko=null,this.jo=null,this.aN=null,this.cN=null,this.dN=0,this.gN=0,this.k1=new S,this.fN=null,this.uN=null,this.Oa=null,this.P1=NaN,this.ct=null,this.hf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Nt=this.Nt&-113,t.no=this.no,t.Md=this.Md,t.ro=this.ro,t.Nd=this.Nd,t.Pf=this.Pf,t.Cd=this.Cd,t.Ld=this.Ld,t.Ad=this.Ad,t.va=this.va,t.Td=this.Td,this.ct!==null&&(t.ct=this.ct.copy())}vo(t){super.vo(t),this.no=t.no,this.ro=t.ro,t.hl=null,t.invalidateRoute(),t.jo=this.jo;const i=t.fromPort;i!==null&&t.fromNode.qi(i);const s=t.toPort;s!==null&&t.toNode.qi(s)}oi(t){t in gs||t in fs||t in ds?wt.mN(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||b.o("Unknown Link enum value for a Link property: "+t):super.oi(t)}Be(){return this.ct===null&&(this.ct=new ji),this.ct}bv(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let r=t.alignmentFocus;const h=t.segmentOrientation,a=t.segmentOffset;let l=0,u=0,c=0,d=0;if(isNaN(n)){const T=this.ot,L=b.et();T.getPointAndAngleAlongPath(o,L);const D=S.V(L[0],L[1]);if(D.add(this.getPoint(0)),T.type===1)D.offset(-T.startX,-T.startY);else{const O=T.figures.first();D.offset(-O.startX,-O.startY)}d=L[2],h!==0&&(c=this.computeAngle(t,h,d),t.angle=c),l=D.x,u=D.y,S.e(D),b.J(L)}else if(n<-i||n>=i){const T=S.l();this.OA(T),d=this.midAngle,h!==0&&(c=this.computeAngle(t,h,d),t.angle=c),l=T.x,u=T.y,S.e(T)}else{let T,L,D=0;if(n>=0?(T=s.r[n],L=n<i-1?s.r[n+1]:T):(D=i+n,T=s.r[D],L=D>0?s.r[D-1]:T),T.equalsApprox(L)){let O,R;n>=0?(O=n>0?s.r[n-1]:T,R=n<i-2?s.r[n+2]:L):(O=D<i-1?s.r[D+1]:T,R=D>1?s.r[D-2]:L);const I=O.distanceSquaredPoint(T),X=L.distanceSquaredPoint(R);I>X+10?d=n>=0?O.directionPoint(T):T.directionPoint(O):X>I+10?d=n>=0?L.directionPoint(R):R.directionPoint(L):d=n>=0?O.directionPoint(R):R.directionPoint(O)}else d=n>=0?T.directionPoint(L):L.directionPoint(T);h!==0&&(c=this.computeAngle(t,h,d),t.angle=c),l=T.x+(L.x-T.x)*o,u=T.y+(L.y-T.y)*o}if(r.isNone()){t.location=new S(l,u);return}else r.isNoSpot()&&(r=B.Center);const f=Tt.l();f.Ri(),f.tt(t.scale,t.scale),f.cs(t.angle,0,0);const m=t.naturalBounds,p=z.V(0,0,m.width,m.height),y=S.l();y.setRectSpot(p,r),f.gt(y);let x=-y.x,P=-y.y;const k=m.width,v=m.height,N=S.l();N.a(a);const M=isNaN(a.x),C=isNaN(a.y);if(M||C){const T=k/2+3,L=v/2+3,D=d>=45&&d<=135,O=d>=225&&d<=315;h===0&&(D||O)?(N.x=C?T:a.y,N.y=M?L:a.x,D?n>=0||isNaN(n)&&o<.5||M&&(N.y=-L):O&&((n>=0||isNaN(n)&&o<.5)&&M&&(N.y=-L),C&&(N.x=-T))):(M&&(n>=0||isNaN(n)&&o<.5?N.x=T:N.x=-T),C&&(N.y=-L),N.rotate(d))}else N.rotate(d);l+=N.x,u+=N.y,f.vg(p),x+=p.x,P+=p.y;const F=S.V(l+x,u+P);t.move(F),S.e(F),S.e(N),S.e(y),z.e(p),Tt.e(f)}Yr(){let t=this.fromNode;if(t!==null){const s=t.findVisibleNode();if(s!==null&&(t=s),t._e()||t.ih())return!1}let i=this.toNode;if(i!==null){const s=i.findVisibleNode();if(s!==null&&(i=s),i._e()||i.ih())return!1}return!0}M2(t,i,s){return!1}N2(){}ke(){return!1}computeAngle(t,i,s){return wt.computeAngle(i,s)}static computeAngle(t,i){let s=0;switch(t){default:case 0:s=0;break;case 21:s=i;break;case 22:s=i+90;break;case 23:s=i-90;break;case 24:s=i+180;break;case 25:s=A.Ug(i),s>90&&s<270&&(s-=180);break;case 26:s=A.Ug(i+90),s>90&&s<270&&(s-=180);break;case 27:s=A.Ug(i-90),s>90&&s<270&&(s-=180);break;case 28:if(s=A.Ug(i),s>45&&s<135||s>225&&s<315)return 0;s>90&&s<270&&(s-=180);break}return A.Ug(s)}get fromNode(){return this.so}set fromNode(t){const i=this.so;if(i!==t){const s=this.fromPort;i!==null&&(this.oo!==i&&i.b1(this,s),this.wy(),this.invalidateLayout(2)),this.so=t,t!==null&&this.Ei(t.isVisible()),this.Ko=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.X&&n.partManager.setFromNodeForLink(this,t,i);const o=this.fromPort,r=this.fromPortChanged;if(r!==null){let h=!0;n!==null&&(h=n.X,n.X=!0),r(this,s,o),n!==null&&(n.X=h)}t!==null&&(this.oo!==t&&t.w1(this,o),this.xy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Pd()}}get fromPortId(){return this.no}set fromPortId(t){var s,n;const i=this.no;if(i!==t){const o=this.fromPort;o!==null&&((s=this.fromNode)==null||s.qi(o)),this.wy(),this.no=t;const r=this.fromPort;r!==null&&((n=this.fromNode)==null||n.qi(r));const h=this.diagram;if(h!==null){const a=this.data,l=h.model;a!==null&&l.Ra()&&l.setFromPortIdForLinkData(a,t)}if(o!==r){this.Ko=null,this.invalidateRoute();const a=this.fromPortChanged;if(a!==null){let l=!0;h!==null&&(l=h.X,h.X=!0),a(this,o,r),h!==null&&(h.X=l)}}this.xy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.so;if(t===null)return null;const i=this.no;return t.findPort(i)}get fromPortChanged(){return this.Md}set fromPortChanged(t){const i=this.Md;i!==t&&(t!==null&&b.k(t,wt,"fromPortChanged"),this.Md=t,this.t("fromPortChanged",i,t))}get toNode(){return this.oo}set toNode(t){const i=this.oo;if(i!==t){const s=this.toPort;i!==null&&(this.so!==i&&i.b1(this,s),this.wy(),this.invalidateLayout(2)),this.oo=t,t!==null&&this.Ei(t.isVisible()),this.Ko=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.X&&n.partManager.setToNodeForLink(this,t,i);const o=this.toPort,r=this.toPortChanged;if(r!==null){let h=!0;n!==null&&(h=n.X,n.X=!0),r(this,s,o),n!==null&&(n.X=h)}t!==null&&(this.so!==t&&t.w1(this,o),this.xy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Pd()}}get toPortId(){return this.ro}set toPortId(t){var s,n;const i=this.ro;if(i!==t){const o=this.toPort;o!==null&&((s=this.toNode)==null||s.qi(o)),this.wy(),this.ro=t;const r=this.toPort;r!==null&&((n=this.toNode)==null||n.qi(r));const h=this.diagram;if(h!==null){const a=this.data,l=h.model;a!==null&&l.Ra()&&l.setToPortIdForLinkData(a,t)}if(o!==r){this.Ko=null,this.invalidateRoute();const a=this.toPortChanged;if(a!==null){let l=!0;h!==null&&(l=h.X,h.X=!0),a(this,o,r),h!==null&&(h.X=l)}}this.xy(),this.t("toPortId",i,t)}}get toPort(){const t=this.oo;if(t===null)return null;const i=this.ro;return t.findPort(i)}get toPortChanged(){return this.Nd}set toPortChanged(t){const i=this.Nd;i!==t&&(t!==null&&b.k(t,wt,"toPortChanged"),this.Nd=t,this.t("toPortChanged",i,t))}get fromSpot(){return this.ct!==null?this.ct.ga:B.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.P(),this.Be().ga=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const s=this.fromNode;s!==null&&s.qi(this.fromPort)}this.invalidateRoute()}}get fromEndSegmentLength(){return this.ct!==null?this.ct.pa:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&b.W(t,">= 0",wt,"fromEndSegmentLength"),this.Be().pa=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const s=this.fromNode;s!==null&&s.qi(this.fromPort)}this.invalidateRoute()}}get fromShortLength(){return this.ct!==null?this.ct.wa:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Be().wa=t,this.ee(),this.t("fromShortLength",i,t))}get toSpot(){return this.ct!==null?this.ct.ma:B.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.P(),this.Be().ma=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const s=this.toNode;s!==null&&s.qi(this.toPort)}this.invalidateRoute()}}get toEndSegmentLength(){return this.ct!==null?this.ct.ya:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&b.W(t,">= 0",wt,"toEndSegmentLength"),this.Be().ya=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const s=this.toNode;s!==null&&s.qi(this.toPort)}this.invalidateRoute()}}get toShortLength(){return this.ct!==null?this.ct.xa:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Be().xa=t,this.ee(),this.t("toShortLength",i,t))}Pd(){const t=this.fromNode,i=this.toNode;let s=null;if(t!==null?i!==null?s=t.findCommonContainingGroup(i):s=t.containingGroup:i!==null?s=i.containingGroup:s=null,this.fO(s),this.isLabeledLink){const n=this.labelNodes;for(;n.next();){const o=n.value;o.containingGroup=s}}}fO(t){const i=this.xh;if(i!==t){i!==null&&i.eN(this),this.xh=t,t!==null&&t.sN(this);const s=this.containingGroupChanged;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,i,t),o!==null&&(o.X=n)}this.Se&&(this.fN===i||this.uN===i)&&this.invalidateRoute()}}dh(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.dh()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return this.js===null?!1:this.js.count>0}get labelNodes(){return this.js===null?he.instance:this.js.iterator}yT(t){this.js===null&&(this.js=new K),this.js.add(t),this.c()}wT(t){this.js!==null&&(this.js.delete(t),this.c())}Rm(t){if(super.Rm(t),this.Ba()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.so;let s=null;i!==null&&(s=this.fromPort,i.w1(this,s));const n=this.oo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.w1(this,o)),this.xy()}}vm(t){if(super.vm(t),this.Ba()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.so;let s=null;i!==null&&(s=this.fromPort,i.b1(this,s));const n=this.oo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.b1(this,o)),this.wy()}}Xc(){if(this.Se=!0,this.js!==null){const t=this.diagram;if(t!==null){const i=this.js.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}if(this.data!==null){const t=this.diagram;t!==null&&t.partManager.pN(this)}}updateRelationshipsFromData(){if(this.data===null)return;const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}move(t,i){const s=i?this.location:this.position;let n=s.x;isNaN(n)&&(n=0);let o=s.y;isNaN(o)&&(o=0);const r=t.x-n,h=t.y-o;if(i===!0)super.move(t,!1);else{const l=S.V(s.x+r,s.y+h);super.move(l,!1),S.e(l)}this.fr(r,h);const a=this.labelNodes;for(;a.next();){const l=a.value,u=l.position;l.moveTo(u.x+r,u.y+h)}}get relinkableFrom(){return(this.Nt&1)!==0}set relinkableFrom(t){const i=(this.Nt&1)!==0;i!==t&&(this.Nt=this.Nt^1,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return(this.Nt&2)!==0}set relinkableTo(t){const i=(this.Nt&2)!==0;i!==t&&(this.Nt=this.Nt^2,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}get resegmentable(){return(this.Nt&4)!==0}set resegmentable(t){const i=(this.Nt&4)!==0;i!==t&&(this.Nt=this.Nt^4,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return(this.Nt&8)!==0}set isTreeLink(t){const i=(this.Nt&8)!==0;i!==t&&(this.Nt=this.Nt^8,this.t("isTreeLink",i,t),this.fromNode!==null&&this.fromNode.l0(),this.toNode!==null&&this.toNode.l0())}get path(){const t=this.findMainElement();return t instanceof dt?t:null}get routeBounds(){return this.updateRoute(),this.uO(this.Sf)}uO(t){let i=1/0,s=1/0;const n=this.pointsCount;if(n===0)return t.i(NaN,NaN,0,0),t;if(n===1){const o=this.getPoint(0);i=Math.min(o.x,i),s=Math.min(o.y,s),t.i(o.x,o.y,0,0)}else if(n===2){const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.i(o.x,o.y,0,0),t.unionPoint(r)}else if(this.computeCurve()===9&&n>=3&&!this.isOrthogonal){let o=this.getPoint(0);if(i=o.x,s=o.y,t.i(i,s,0,0),n===3){const r=this.getPoint(1);i=Math.min(r.x,i),s=Math.min(r.y,s);const h=this.getPoint(2);i=Math.min(h.x,i),s=Math.min(h.y,s),A.ou(o.x,o.y,r.x,r.y,r.x,r.y,h.x,h.y,.5,t)}else for(let r=3;r<n;r+=3){const h=this.getPoint(r-2);r+3>=n&&(r=n-1);const a=this.getPoint(r-1),l=this.getPoint(r);A.ou(o.x,o.y,h.x,h.y,a.x,a.y,l.x,l.y,.5,t),i=Math.min(l.x,i),s=Math.min(l.y,s),o=l}}else{const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.i(o.x,o.y,0,0),t.unionPoint(r);for(let h=2;h<n;h++){const a=this.getPoint(h);i=Math.min(a.x,i),s=Math.min(a.y,s),t.unionPoint(a)}}return this.k1.i(i-t.x,s-t.y),t}get midPoint(){return this.updateRoute(),this.computeMidPoint(new S)}OA(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(i===0)return t.a(S.Ik),t;if(i===1)return t.a(this.getPoint(0)),t;if(i===2){const u=this.getPoint(0),c=this.getPoint(1);return t.i((u.x+c.x)/2,(u.y+c.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ot.getPointAlongPath(.5,t),t.add(this.getPoint(0));const u=this.ot.figures.first();return t.offset(-u.startX,-u.startY),t}if(this.computeCurve()===9){if(i===3){const d=this.getPoint(0),f=this.getPoint(1),m=this.getPoint(2);return A.AC(d.x,d.y,f.x,f.y,f.x,f.y,m.x,m.y,t),t}const u=(i-1)/3|0,c=(u/2|0)*3;if(u%2===1){const d=this.getPoint(c),f=this.getPoint(c+1),m=this.getPoint(c+2),p=this.getPoint(c+3);return A.AC(d.x,d.y,f.x,f.y,m.x,m.y,p.x,p.y,t),t}else return t.a(this.getPoint(c)),t}const s=this.flattenedLengths,n=this.flattenedTotalLength;let o=0,r=0,h=0;for(;o<n/2&&r<i&&(h=s[r],!(o+h>n/2));)o+=h,r++;const a=this.getPoint(r),l=this.getPoint(r+1);if(Math.abs(a.x-l.x)<1)a.y>l.y?t.i(a.x,a.y-(n/2-o)):t.i(a.x,a.y+(n/2-o));else if(Math.abs(a.y-l.y)<1)a.x>l.x?t.i(a.x-(n/2-o),a.y):t.i(a.x+(n/2-o),a.y);else{const u=(n/2-o)/h,c=u*(l.x-a.x),d=u*(l.y-a.y);t.i(a.x+c,a.y+d)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const l=this.getPoint(0),u=this.getPoint(1);return l.directionPoint(u)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ot.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const l=(t-1)/3|0;let u=(l/2|0)*3;if(l%2===1){u=Math.floor(u);const c=this.getPoint(u),d=this.getPoint(u+1),f=this.getPoint(u+2),m=this.getPoint(u+3);return A._D(c.x,c.y,d.x,d.y,f.x,f.y,m.x,m.y)}else if(u>0&&u+1<t){const c=this.getPoint(u-1),d=this.getPoint(u+1);return c.directionPoint(d)}}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<t&&(r=i[o],!(n+r>s/2));)n+=r,o++;const h=this.getPoint(o),a=this.getPoint(o+1);if(Math.abs(h.x-a.x)<1&&Math.abs(h.y-a.y)<1){if(o>0&&o+2<t){const l=this.getPoint(o-1),u=this.getPoint(o+2);return l.directionPoint(u)}}else{if(Math.abs(h.x-a.x)<1)return h.y>a.y?270:90;if(Math.abs(h.y-a.y)<1)return h.x>a.x?180:0}return h.directionPoint(a)}get flattenedLengths(){return this.Oa!==null?this.Oa:(this.Se||this.S1(),this.dO())}get flattenedTotalLength(){let t=this.P1;if(isNaN(t)){const i=this.flattenedLengths,s=i.length;t=0;for(let n=0;n<s;n++)t+=i[n];this.P1=t}return t}dO(){this.Oa===null?this.Oa=[]:this.Oa.length=0;const t=this.Oa,i=this.pointsCount;for(let s=0;s<i-1;s++){let n=0;const o=this.getPoint(s),r=this.getPoint(s+1);A.z(o.x,r.x)?(n=r.y-o.y,n<0&&(n=-n),t.push(n)):A.z(o.y,r.y)?(n=r.x-o.x,n<0&&(n=-n),t.push(n)):(n=Math.sqrt(o.distanceSquaredPoint(r)),t.push(n))}return t}get points(){return this.xi}set points(t){const i=this.xi;if(i===t)return;let s=null;if(Array.isArray(t)){const o=t;let r=o.length%2===0;if(r){for(let h=0;h<o.length;h++)if(typeof o[h]!="number"||isNaN(o[h])){r=!1;break}}if(r){s=new J;for(let h=0;h<o.length/2;h++){const a=new S(o[h*2],o[h*2+1]).u();s.add(a)}}else{let h=!0;for(let a=0;a<o.length;a++){const l=o[a];if(!b.G(l)||typeof l.x!="number"||isNaN(l.x)||typeof l.y!="number"||isNaN(l.y)){h=!1;break}}if(h){s=new J;for(let a=0;a<o.length;a++){const l=o[a];s.add(new S(l.x,l.y).u())}}}}else if(t instanceof J){s=t.copy();const o=s.iterator;for(;o.next();)o.value.u()}else b.o("Link.points value is not an instance of List or Array: "+t);if(s===null)return;s.u(),this.xi=s,this.ee(),this.S1();const n=this.diagram;n!==null&&(!n.Vh&&!n.undoManager.isUndoingRedoing&&n.bx.add(this),n.animationManager.pi&&n.animationManager.VS(this,s)),this.t("points",i,s)}get pointsCount(){return this.xi.count}getPoint(t){return this.xi.r[t]}setPoint(t,i){this.xi.setElt(t,i)}setPointAt(t,i,s){this.xi.setElt(t,new S(i,s))}insertPoint(t,i){this.xi.insertAt(t,i)}insertPointAt(t,i,s){this.xi.insertAt(t,new S(i,s))}addPoint(t){this.xi.add(t)}addPointAt(t,i){this.xi.add(new S(t,i))}removePoint(t){this.xi.removeAt(t)}clearPoints(){this.xi.clear()}fr(t,i){if(t===0&&i===0)return;if(this.pointsCount===0){this.defaultFromPoint&&this.defaultFromPoint.offset(t,i),this.defaultToPoint&&this.defaultToPoint.offset(t,i);return}const s=this.Se,n=new J,o=this.xi.iterator;for(;o.next();){const a=o.value;n.add(new S(a.x+t,a.y+i).u())}n.u();const r=this.xi;this.xi=n;const h=this.diagram;isNaN(t)||isNaN(i)||h!==null&&h.animationManager.pi?this.c():(this.Ks.i(this.Ks.x+t,this.Ks.y+i),this.at.i(this.at.x+t,this.at.y+i),this.ef()),s?this.S1():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),h!==null&&h.animationManager.pi&&h.animationManager.VS(this,n),this.t("points",r,n)}startRoute(){this.hl===null&&(this.hl=this.xi,this.xi=this.xi.copy())}commitRoute(){if(this.hl===null)return;const t=this.hl,i=this.xi;let s=1/0,n=1/0;const o=t.r,r=o.length;for(let d=0;d<r;d++){const f=o[d];s=Math.min(f.x,s),n=Math.min(f.y,n)}let h=1/0,a=1/0;const l=i.r,u=l.length;for(let d=0;d<u;d++){const f=l[d];h=Math.min(f.x,h),a=Math.min(f.y,a),f.u()}if(i.u(),u===r)for(let d=0;d<u;d++){const f=o[d],m=l[d];if(f.x-s!==m.x-h||f.y-n!==m.y-a){this.ee();break}}else this.ee();this.hl=null;const c=this.diagram;c!==null&&c.animationManager.pi&&c.animationManager.VS(this,i),this.S1(),this.t("points",t,i)}rollbackRoute(){this.hl!==null&&(this.xi=this.hl,this.hl=null)}BF(){this.br!==null&&(this.points=this.br,this.br=null)}S1(){if(this.xi.count===0){this.Se=!1;return}this.Se=!0,this.Oa=null,this.P1=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.M1(!1)}invalidateRoute(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const i=this.diagram;if(i){if(i.bx.has(this)||i.undoManager.isUndoingRedoing)return;const s=i.animationManager;if(s.isTicking&&!s.isAnimating)return;this.br!==null&&!s.isTicking&&(this.br=null)}this.Se=!1,this.c(),t.c()}get Se(){return(this.Nt&16)!==0}set Se(t){(this.Nt&16)!==0!==t&&(this.Nt=this.Nt^16)}get suspendsRouting(){return(this.Nt&32)!==0}set suspendsRouting(t){(this.Nt&32)!==0!==t&&(this.Nt=this.Nt^32)}get by(){return(this.Nt&64)!==0}set by(t){(this.Nt&64)!==0!==t&&(this.Nt=this.Nt^64)}get yN(){return(this.Nt&512)!==0}set yN(t){(this.Nt&512)!==0!==t&&(this.Nt=this.Nt^512)}get defaultFromPoint(){return this.aN}set defaultFromPoint(t){this.aN=t!==null?t.copy():null}get defaultToPoint(){return this.cN}set defaultToPoint(t){this.cN=t!==null?t.copy():null}updateRoute(){if(this.Se||this.by)return;let t=!0;try{this.by=!0,this.startRoute(),t=this.computePoints()}catch{this.by=!1,this.rollbackRoute()}finally{this.by=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let i=this.fromNode,s=null;if(i===null?(wt.Ia||(wt.Ia=new st,wt.Ia.desiredSize=ot.sc,wt.Ia.ensureBounds()),this.defaultFromPoint&&(wt.Ia.location=this.defaultFromPoint,wt.Ia.ensureBounds(),i=wt.Ia,s=wt.Ia)):s=this.fromPort,s!==null&&!i.isVisible()){const p=i.findVisibleNode();p!==null&&p!==i?(i=p,s=p.port):i=p}if(this.fN=i,i===null||!i.location.isReal()||s===null||(s=i.findVisiblePort(s),s===null))return!1;let n=this.toNode,o=null;if(n===null?(wt.Ea||(wt.Ea=new st,wt.Ea.desiredSize=ot.sc,wt.Ea.ensureBounds()),this.defaultToPoint&&(wt.Ea.location=this.defaultToPoint,wt.Ea.ensureBounds(),n=wt.Ea,o=wt.Ea)):o=this.toPort,o!==null&&!n.isVisible()){const p=n.findVisibleNode();p!==null&&p!==n?(n=p,o=p.port):n=p}if(this.uN=n,n===null||!n.location.isReal()||o===null||(o=n.findVisiblePort(o),o===null))return!1;const r=this.pointsCount,h=this.computeSpot(!0,s),a=this.computeSpot(!1,o),l=this.Dd(h),u=this.Dd(a),c=s===o&&s!==null,d=this.isOrthogonal;let f=this.curve===9;c&&!d?(f=!0,this.Ko=!0):this.Ko=!1;const m=this.computeAdjusting()===0||c;if(!d&&!c&&l&&u){let p=!1;if(!m&&r>=3){let y=this.getLinkPoint(i,s,h,!0,!1,n,o),x=this.getLinkPoint(n,o,a,!1,!1,i,s);p=this.adjustPoints(0,y,r-1,x),p&&(y=this.getLinkPoint(i,s,h,!0,!1,n,o),x=this.getLinkPoint(n,o,a,!1,!1,i,s),this.adjustPoints(0,y,r-1,x))}p||(this.clearPoints(),f?this.gO(i,s,h,n,o,a):this.mO(i,s,h,n,o,a))}else{const p=this.isAvoiding;m&&(d&&p||c)&&this.clearPoints();const y=c?this.computeCurviness():0,x=this.getLinkPoint(i,s,h,!0,d,n,o);let P=0,k=0,v=0;if(d||!l||c){let D=this.computeEndSegmentLength(i,s,h,!0);if(v=this.getLinkDirection(i,s,x,h,!0,d,n,o),c&&(l||h.equals(a)||!d&&h.x+a.x===1&&h.y+a.y===1)&&(v-=d?90:30,y<0&&(v-=180)),v<0?v+=360:v>=360&&(v-=360),c&&(D+=Math.abs(y)*(d?1:2)),v===0?P=D:v===90?k=D:v===180?P=-D:v===270?k=-D:(P=D*Math.cos(v*Math.PI/180),k=D*Math.sin(v*Math.PI/180)),h.isNoSpot()&&c){const O=s.getDocumentPoint(B.Center,S.l()),R=S.V(O.x+P*1e3,O.y+k*1e3);this.getLinkPointFromPoint(i,s,O,R,!0,x),S.e(O),S.e(R)}}const N=this.getLinkPoint(n,o,a,!1,d,i,s);let M=0,C=0,F=0;if(d||!u||c){let D=this.computeEndSegmentLength(n,o,a,!1);if(F=this.getLinkDirection(n,o,N,a,!1,d,i,s),c&&(u||h.equals(a)||!d&&h.x+a.x===1&&h.y+a.y===1)&&(F+=d?0:30,y<0&&(F+=180)),F<0?F+=360:F>=360&&(F-=360),c&&(D+=Math.abs(y)*(d?1:2)),F===0?M=D:F===90?C=D:F===180?M=-D:F===270?C=-D:(M=D*Math.cos(F*Math.PI/180),C=D*Math.sin(F*Math.PI/180)),a.isNoSpot()&&c){const O=o.getDocumentPoint(B.Center,S.l()),R=S.V(O.x+M*1e3,O.y+C*1e3);this.getLinkPointFromPoint(n,o,O,R,!1,N),S.e(O),S.e(R)}}let T=x;(d||!l||c)&&(T=new S(x.x+P,x.y+k));let L=N;(d||!u||c)&&(L=new S(N.x+M,N.y+C)),!m&&!d&&l&&r>3&&this.adjustPoints(0,x,r-2,L)?this.setPoint(r-1,N):!m&&!d&&u&&r>3&&this.adjustPoints(1,T,r-1,N)?this.setPoint(0,x):!m&&(d?r>=6:r>4)&&this.adjustPoints(1,T,r-2,L)?(this.setPoint(0,x),this.setPoint(r-1,N)):(this.clearPoints(),this.addPoint(x),(d||!l||c)&&this.addPoint(T),d&&this.addOrthoPoints(T,v,L,F,i,n),(d||!u||c)&&this.addPoint(L),this.addPoint(N))}return t.addInvalidRoute(this),!0}wN(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x>=t.x?i.x=t.x+9e9:i.x=t.x-9e9,i.y=t.y):(i.y>=t.y?i.y=t.y+9e9:i.y=t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,s,n,o,r){if(r===void 0&&(r=new S),t===null||i===null)return r.a(s),r;if(!t.isVisible()){const f=t.findVisibleNode();f!==null&&f!==t&&(t=f,i=t.port)}let h=0,a=0,l=0,u=0,c=null,d=i.panel;if(d!==null&&!d.an()&&(d=d.panel),d===null)h=n.x,a=n.y,l=s.x,u=s.y;else{c=d.Us;const f=1/(c.m11*c.m22-c.m12*c.m21),m=c.m22*f,p=-c.m12*f,y=-c.m21*f,x=c.m11*f,P=f*(c.m21*c.dy-c.m22*c.dx),k=f*(c.m12*c.dx-c.m11*c.dy);h=n.x*m+n.y*y+P,a=n.x*p+n.y*x+k,l=s.x*m+s.y*y+P,u=s.x*p+s.y*x+k}return i.Jc(h,a,l,u,r),c!==null&&r.T(c),r}pO(t,i){const s=t.Ku;return s!==null?s.ST(i):null}N1(t){if(t===null)return null;let i=t.Ku;return i===null&&(i=new ms(t.part,t),t.Ku=i),i.ST(this)}getLinkPoint(t,i,s,n,o,r,h,a){if(a===void 0&&(a=new S),s.isSpot()&&!this.Dd(s))return i.getDocumentPoint(s,a),a;if(s.isSide()){const c=this.N1(i);if(c!==null){const d=c.Fd;if(a.a(d),o&&this.routing===7){const f=this.N1(h);if(f!==null&&c.Mf<f.Mf){const m=S.l(),p=S.l(),y=new z(i.getDocumentPoint(B.TopLeft,m),i.getDocumentPoint(B.BottomRight,p)),x=this.computeSpot(!n,h),P=this.getLinkPoint(r,h,x,!n,o,t,i,p);(s.includesSide(B.LeftSide)||s.includesSide(B.RightSide))&&P.y>=y.y&&P.y<=y.y+y.height?a.y=P.y:(s.includesSide(B.TopSide)||s.includesSide(B.BottomSide))&&P.x>=y.x&&P.x<=y.x+y.width&&(a.x=P.x),S.e(m),S.e(p)}}return a}}const l=i.getDocumentPoint(this.C1(s,n),S.l());let u=null;if(this.pointsCount>(o?6:2))u=n?this.getPoint(1):this.getPoint(this.pointsCount-2),o&&(u=this.wN(l,u.copy()));else{const c=this.computeSpot(!n,h),d=S.l();u=h.getDocumentPoint(this.C1(c,!n),d),o&&(u=this.wN(l,u)),S.e(d)}return this.getLinkPointFromPoint(t,i,l,u,n,a),S.e(l),a}getLinkDirection(t,i,s,n,o,r,h,a){let l=this.yO(t,i,s,n,o,r,h,a);if(h&&n.isNoSpot()&&h.isMemberOf(t)&&(l+=180,l>=360&&(l-=360)),this.Dd(n)||i===null)return l;const u=i.getDocumentAngle();return u===0||(45<=u&&u<135?l+=90:135<=u&&u<225?l+=180:225<=u&&u<315&&(l+=270),l>=360&&(l-=360)),l}yO(t,i,s,n,o,r,h,a){if(n.isSpot())return n.x>n.y?n.x>1-n.y?0:n.x<1-n.y?270:315:n.x<n.y?n.x>1-n.y?90:n.x<1-n.y?180:135:n.x<.5?225:n.x>.5?45:0;if(n.isSide()){const d=this.N1(i);if(d!==null)switch(d.me){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}else return n.includesSide(B.TopSide)?270:n.includesSide(B.BottomSide)?90:n.includesSide(B.LeftSide)?180:0}if(i===null||a===null)return 0;const l=i.getDocumentPoint(B.Center,S.l());let u=null;if(this.pointsCount>(r?6:2))u=o?this.getPoint(1):this.getPoint(this.pointsCount-2),r?u=this.wN(l,u.copy()):u=s;else{const d=S.l();u=a.getDocumentPoint(B.Center,d),S.e(d)}let c=0;return Math.abs(u.x-l.x)>Math.abs(u.y-l.y)?u.x>=l.x?c=0:c=180:u.y>=l.y?c=90:c=270,S.e(l),c}computeEndSegmentLength(t,i,s,n){if(i!==null&&s.isSide()){const r=this.N1(i);if(r!==null)return r.L1}let o=NaN;return n?o=this.fromEndSegmentLength:o=this.toEndSegmentLength,i!==null&&isNaN(o)&&(n?o=i.fromEndSegmentLength:o=i.toEndSegmentLength),isNaN(o)&&(o=10),o}computeSpot(t,i){return i===void 0&&(i=null),t?this.wO(i||this.fromPort):this.xO(i||this.toPort)}wO(t){if(t===null)return B.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===B.Default?B.None:i}xO(t){if(t===null)return B.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===B.Default?B.None:i}Dd(t){return t===B.None||t.x===.5&&t.y===.5}C1(t,i){return t.x===.5&&t.y===.5?t:B.Center}computeOtherPoint(t,i){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new S);{const s=this.pO(i,this);return s!==null?s.Fd:i.getDocumentPoint(B.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const s=this.fromPort;s!==null&&(i=s.fromShortLength)}return isNaN(i)?0:i}else{let i=this.toShortLength;if(isNaN(i)){const s=this.toPort;s!==null&&(i=s.toShortLength)}return isNaN(i)?0:i}}Tm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let h;if(r===void 0?(h=Tt.l(),h.Ri()):h=r,h.nc(this.T),this.containedInRect(t,h))return this.Y2(i,s,o),r===void 0&&Tt.e(h),!0;if(this.intersectsRect(t,h)){let a=!1;if(!this.af){const l=this.C.r,u=l.length;for(let c=u;c--;){const d=l[c];if(!d.visible&&d!==this.locationObject)continue;const f=d.actualBounds,m=this.naturalBounds;if(f.x>m.width||f.y>m.height||f.x+f.width<0||f.y+f.height<0)continue;const p=d,y=Tt.l();if(y.set(h),p instanceof rt?a=p.Tm(t,i,s,n,o,y):this.path===p?p instanceof dt&&(a=p.Yv(t,n,y)):a=p.wA(t,n,y),a){let x=p;i!==null&&(x=i(p)),x&&(s===null||s(x))&&o.add(x)}Tt.e(y)}}return r===void 0&&Tt.e(h),a||this.background!==null}return r===void 0&&Tt.e(h),!1}get isOrthogonal(){return(this.va&2)===2}static mN(t){return(t&2)===2}get isAvoiding(){return(this.va&4)===4}computeCurve(){if(this.Ko===null){const t=this.fromPort,i=t!==null&&t===this.toPort,s=this.isOrthogonal;this.Ko=i&&!s}return this.Ko?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=10),t}findMidLabel(){const t=this.path,i=this.C.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];if(!(r===t||r.isPanelMain)&&(r.segmentIndex===-1/0||isNaN(r.segmentIndex)))return r}const n=this.labelNodes;for(;n.next();){const o=n.value;if(o.segmentIndex===-1/0||isNaN(o.segmentIndex))return o}return null}computeSpacing(){if(!this.isVisible())return 0;let t=wt.cO;t=Math.max(t,this.computeThickness());const i=this.fromPort,s=this.toPort;if(i!==null&&s!==null){const n=this.findMidLabel();if(n!==null){const o=n.naturalBounds,r=n.margin,h=isNaN(o.width)?30:o.width*n.scale+r.left+r.right,a=isNaN(o.height)?14:o.height*n.scale+r.top+r.bottom,l=n.segmentOrientation;if(l===21||l===25||l===24)t=Math.max(t,a);else if(l===23||l===27||l===22||l===26)t=Math.max(t,h);else{const u=i.getDocumentPoint(B.Center).directionPoint(s.getDocumentPoint(B.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(u)*h)+Math.abs(Math.cos(u)*a)+1)}this.curve===9&&(t*=1.333)}}return t}arrangeBundledLinks(t,i){if(i)for(let s=0;s<t.length;s++){const n=t[s];n.computeAdjusting()===0&&n.invalidateRoute()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=wt.aO;const i=this.jo;if(i!==null){const s=b.et();let n=0;const o=i.Hs;for(let h=0;h<o.length;h++){const a=o[h].computeSpacing();s.push(a),n+=a}let r=-n/2;for(let h=0;h<o.length;h++){if(o[h]===this){t=r+s[h]/2;break}r+=s[h]}i.ly===this.fromNode&&(t=-t),b.J(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.jo!==null}mO(t,i,s,n,o,r){const h=this.getLinkPoint(t,i,s,!0,!1,n,o),a=this.getLinkPoint(n,o,r,!1,!1,t,i);if(this.hasCurviness()){const l=a.x-h.x,u=a.y-h.y,c=this.computeCurviness(),d=c,f=h.x+l/2,m=h.y+u/2;let p=f,y=m;if(A.f(u,0))l>0?y-=d:y+=d;else{const x=-l/u;let P=Math.sqrt(d*d/(x*x+1));c<0&&(P=-P),p=(u<0?-1:1)*P+f,y=x*(p-f)+m}this.addPoint(h),this.addPointAt(p,y),this.addPoint(a)}else{this.addPoint(h),this.addPoint(a);const l=z.l();i.getDocumentBounds(l);const u=l.containsPoint(a);o.getDocumentBounds(l);const c=l.containsPoint(h);if(u||c){const d=i.getDocumentPoint(this.C1(s,!0),new S);this.setPoint(0,this.getLinkPointFromPoint(t,i,d,a,!0,d));const f=o.getDocumentPoint(this.C1(r,!1),new S);this.setPoint(1,this.getLinkPointFromPoint(n,o,f,h,!1,f))}z.e(l)}}gO(t,i,s,n,o,r){const h=this.getLinkPoint(t,i,s,!0,!1,n,o),a=this.getLinkPoint(n,o,r,!1,!1,t,i),l=a.x-h.x,u=a.y-h.y,c=this.computeCurviness();let d=0,f=0,m=h.x+l/3,p=h.y+u/3,y=m,x=p;A.f(u,0)?l>0?x-=c:x+=c:(d=-l/u,f=Math.sqrt(c*c/(d*d+1)),c<0&&(f=-f),y=(u<0?-1:1)*f+m,x=d*(y-m)+p),m=h.x+2*l/3,p=h.y+2*u/3;let P=m,k=p;A.f(u,0)?l>0?k-=c:k+=c:(P=(u<0?-1:1)*f+m,k=d*(P-m)+p),this.clearPoints(),this.addPoint(h),this.addPointAt(y,x),this.addPointAt(P,k),this.addPoint(a),this.setPoint(0,this.getLinkPoint(t,i,s,!0,!1,n,o)),this.setPoint(3,this.getLinkPoint(n,o,r,!1,!1,t,i))}adjustPoints(t,i,s,n){let o=this.computeAdjusting();if(this.isOrthogonal){if(o===18)return!1;o===19&&(o=17)}switch(o){case 18:return this.bO(t,i,s,n);case 19:return this.kO(t,i,s,n);case 17:return this.PO(t,i,s,n);default:return!1}}bO(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const h=o.x,a=o.y,l=r.x,u=r.y;let c=l-h,d=u-a;const f=Math.sqrt(c*c+d*d);if(A.z(f,0))return!0;let m=0;A.z(c,0)?d<0?m=-Math.PI/2:m=Math.PI/2:(m=Math.atan(d/Math.abs(c)),c<0&&(m=Math.PI-m));const p=i.x,y=i.y,x=n.x,P=n.y,k=x-p,v=P-y,N=Math.sqrt(k*k+v*v);let M=0;A.z(k,0)?v<0?M=-Math.PI/2:M=Math.PI/2:(M=Math.atan(v/Math.abs(k)),k<0&&(M=Math.PI-M));const C=N/f,F=M-m;this.setPoint(t,i);for(let T=t+1;T<s;T++){const L=this.getPoint(T);c=L.x-h,d=L.y-a;const D=Math.sqrt(c*c+d*d);if(A.z(D,0))continue;let O=0;A.z(c,0)?d<0?O=-Math.PI/2:O=Math.PI/2:(O=Math.atan(d/Math.abs(c)),c<0&&(O=Math.PI-O));const R=O+F,I=D*C,X=p+I*Math.cos(R),j=y+I*Math.sin(R);this.setPointAt(T,X,j)}return this.setPoint(s,n),!0}kO(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const h=o.x,a=o.y,l=r.x,u=r.y,c=(l-h)**2+(u-a)**2,d=i.x,f=i.y,m=n.x,p=n.y;let y=0,x=1;m-d!==0?(y=(p-f)/(m-d),x=Math.sqrt(1+1/(y*y))):y=9e9,this.setPoint(t,i);for(let P=t+1;P<s;P++){const k=this.getPoint(P),v=k.x,N=k.y;let M=.5;c!==0&&(M=((h-v)*(h-l)+(a-N)*(a-u))/c);const C=h+M*(l-h),F=a+M*(u-a);let T=Math.sqrt((v-C)**2+(N-F)**2);N<y*(v-C)+F&&(T=-T),y>0&&(T=-T);const L=d+M*(m-d),D=f+M*(p-f);if(y!==0){const O=L+T/x,R=D-(O-L)/y;this.setPointAt(P,O,R)}else this.setPointAt(P,L,D+T)}return this.setPoint(s,n),!0}PO(t,i,s,n){if(this.isOrthogonal){let o=this.getPoint(t),r=this.getPoint(t+1),h=this.getPoint(t+2),a=r.x,l=r.y;const u=a,c=l;A.f(o.y,r.y)?A.f(r.x,h.x)?l=i.y:A.f(r.y,h.y)&&(a=i.x):A.f(o.x,r.x)&&(A.f(r.y,h.y)?a=i.x:A.f(r.x,h.x)&&(l=i.y)),this.setPointAt(t+1,a,l),o=this.getPoint(s),r=this.getPoint(s-1),h=this.getPoint(s-2);let d=r.x,f=r.y;const m=d,p=f;if(A.f(o.y,r.y)?A.f(r.x,h.x)?f=n.y:A.f(r.y,h.y)&&(d=n.x):A.f(o.x,r.x)&&(A.f(r.y,h.y)?d=n.x:A.f(r.x,h.x)&&(f=n.y)),this.setPointAt(s-1,d,f),this.WL())return this.setPointAt(t+1,u,c),this.setPointAt(s-1,m,p),!1}return this.setPoint(t,i),this.setPoint(s,n),!0}addOrthoPoints(t,i,s,n,o,r){i<0?i+=360:i>=360&&(i-=360),n<0?n+=360:n>=360&&(n-=360);const h=n;i>=315||i<45?i=0:45<=i&&i<135?i=90:135<=i&&i<225?i=180:i=270,n>=315||n<45?n=0:45<=n&&n<135?n=90:135<=n&&n<225?n=180:n=270;const a=t,l=s,u=o.actualBounds.copy(),c=r.actualBounds.copy();if(!u.isReal()||!c.isReal())return;u.inflate(wt.Ua,wt.Ua),c.inflate(wt.Ua,wt.Ua),u.unionPoint(t),c.unionPoint(s);const d=S.l(),f=S.l();i===0?l.x>a.x||n===270&&l.y<a.y&&c.right>a.x||n===90&&l.y>a.y&&c.right>a.x?(d.i(l.x,a.y),f.i(l.x,(a.y+l.y)/2),n===180?(d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1),f.x=d.x,f.y=l.y):n===270&&l.y<a.y||n===90&&l.y>a.y?(a.x<c.left?d.x=this.computeMidOrthoPosition(a.x,a.y,c.left,l.y,!1):a.x<c.right&&(n===270&&a.y<c.top||n===90&&a.y>c.bottom)?d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):d.x=c.right,f.x=d.x,f.y=l.y):n===0&&a.x<c.left&&a.y>c.top&&a.y<c.bottom&&(d.x=a.x,a.y<l.y?d.y=Math.min(l.y,c.top):d.y=Math.max(l.y,c.bottom),f.y=d.y)):(d.i(a.x,l.y),f.i((a.x+l.x)/2,l.y),(n===180||n===90&&l.y<u.top||n===270&&l.y>u.bottom)&&(n===180&&(c.containsPoint(a)||u.containsPoint(l))?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):l.y<a.y&&(n===180||n===90)?d.y=this.computeMidOrthoPosition(a.x,u.top,l.x,Math.max(l.y,c.bottom),!0):l.y>a.y&&(n===180||n===270)&&(d.y=this.computeMidOrthoPosition(a.x,u.bottom,l.x,Math.min(l.y,c.top),!0)),f.x=l.x,f.y=d.y),d.y>u.top&&d.y<u.bottom&&(l.x>=u.left&&l.x<=a.x||a.x<=c.right&&a.x>=l.x?(n===90||n===270)&&(d.i(Math.max((a.x+l.x)/2,a.x),a.y),f.i(d.x,l.y)):(n===270||(n===0||n===180)&&l.y<a.y?d.y=Math.min(l.y,n===0?u.top:Math.min(u.top,c.top)):d.y=Math.max(l.y,n===0?u.bottom:Math.max(u.bottom,c.bottom)),f.x=l.x,f.y=d.y))):i===180?l.x<a.x||n===270&&l.y<a.y&&c.left<a.x||n===90&&l.y>a.y&&c.left<a.x?(d.i(l.x,a.y),f.i(l.x,(a.y+l.y)/2),n===0?(d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1),f.x=d.x,f.y=l.y):n===270&&l.y<a.y||n===90&&l.y>a.y?(a.x>c.right?d.x=this.computeMidOrthoPosition(a.x,a.y,c.right,l.y,!1):a.x>c.left&&(n===270&&a.y<c.top||n===90&&a.y>c.bottom)?d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):d.x=c.left,f.x=d.x,f.y=l.y):n===180&&a.x>c.right&&a.y>c.top&&a.y<c.bottom&&(d.x=a.x,a.y<l.y?d.y=Math.min(l.y,c.top):d.y=Math.max(l.y,c.bottom),f.y=d.y)):(d.i(a.x,l.y),f.i((a.x+l.x)/2,l.y),(n===0||n===90&&l.y<u.top||n===270&&l.y>u.bottom)&&(n===0&&(c.containsPoint(a)||u.containsPoint(l))?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):l.y<a.y&&(n===0||n===90)?d.y=this.computeMidOrthoPosition(a.x,u.top,l.x,Math.max(l.y,c.bottom),!0):l.y>a.y&&(n===0||n===270)&&(d.y=this.computeMidOrthoPosition(a.x,u.bottom,l.x,Math.min(l.y,c.top),!0)),f.x=l.x,f.y=d.y),d.y>u.top&&d.y<u.bottom&&(l.x<=u.right&&l.x>=a.x||a.x>=c.left&&a.x<=l.x?(n===90||n===270)&&(d.i(Math.min((a.x+l.x)/2,a.x),a.y),f.i(d.x,l.y)):(n===270||(n===0||n===180)&&l.y<a.y?d.y=Math.min(l.y,n===180?u.top:Math.min(u.top,c.top)):d.y=Math.max(l.y,n===180?u.bottom:Math.max(u.bottom,c.bottom)),f.x=l.x,f.y=d.y))):i===90?l.y>a.y||n===180&&l.x<a.x&&c.bottom>a.y||n===0&&l.x>a.x&&c.bottom>a.y?(d.i(a.x,l.y),f.i((a.x+l.x)/2,l.y),n===270?(d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0),f.x=l.x,f.y=d.y):n===180&&l.x<a.x||n===0&&l.x>a.x?(a.y<c.top?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,c.top,!0):a.y<c.bottom&&(n===180&&a.x<c.left||n===0&&a.x>c.right)?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):d.y=c.bottom,f.x=l.x,f.y=d.y):n===90&&a.y<c.top&&a.x>c.left&&a.x<c.right&&(a.x<l.x?d.x=Math.min(l.x,c.left):d.x=Math.max(l.x,c.right),d.y=a.y,f.x=d.x)):(d.i(l.x,a.y),f.i(l.x,(a.y+l.y)/2),(n===270||n===0&&l.x<u.left||n===180&&l.x>u.right)&&(n===270&&(c.containsPoint(a)||u.containsPoint(l))?d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):l.x<a.x&&(n===270||n===0)?d.x=this.computeMidOrthoPosition(u.left,a.y,Math.max(l.x,c.right),l.y,!1):l.x>a.x&&(n===270||n===180)&&(d.x=this.computeMidOrthoPosition(u.right,a.y,Math.min(l.x,c.left),l.y,!1)),f.x=d.x,f.y=l.y),d.x>u.left&&d.x<u.right&&(l.y>=u.top&&l.y<=a.y||a.y<=c.bottom&&a.y>=l.y?(n===0||n===180)&&(d.i(a.x,Math.max((a.y+l.y)/2,a.y)),f.i(l.x,d.y)):(n===180||(n===90||n===270)&&l.x<a.x?d.x=Math.min(l.x,n===90?u.left:Math.min(u.left,c.left)):d.x=Math.max(l.x,n===90?u.right:Math.max(u.right,c.right)),f.x=d.x,f.y=l.y))):l.y<a.y||n===180&&l.x<a.x&&c.top<a.y||n===0&&l.x>a.x&&c.top<a.y?(d.i(a.x,l.y),f.i((a.x+l.x)/2,l.y),n===90?(d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0),f.x=l.x,f.y=d.y):n===180&&l.x<a.x||n===0&&l.x>=a.x?(a.y>c.bottom?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,c.bottom,!0):a.y>c.top&&(n===180&&a.x<c.left||n===0&&a.x>c.right)?d.y=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!0):d.y=c.top,f.x=l.x,f.y=d.y):n===270&&a.y>c.bottom&&a.x>c.left&&a.x<c.right&&(a.x<l.x?d.x=Math.min(l.x,c.left):d.x=Math.max(l.x,c.right),d.y=a.y,f.x=d.x)):(d.i(l.x,a.y),f.i(l.x,(a.y+l.y)/2),(n===90||n===0&&l.x<u.left||n===180&&l.x>u.right)&&(n===90&&(c.containsPoint(a)||u.containsPoint(l))?d.x=this.computeMidOrthoPosition(a.x,a.y,l.x,l.y,!1):l.x<a.x&&(n===90||n===0)?d.x=this.computeMidOrthoPosition(u.left,a.y,Math.max(l.x,c.right),l.y,!1):l.x>a.x&&(n===90||n===180)&&(d.x=this.computeMidOrthoPosition(u.right,a.y,Math.min(l.x,c.left),l.y,!1)),f.x=d.x,f.y=l.y),d.x>u.left&&d.x<u.right&&(l.y<=u.bottom&&l.y>=a.y||a.y>=c.top&&a.y<=l.y?(n===0||n===180)&&(d.i(a.x,Math.min((a.y+l.y)/2,a.y)),f.i(l.x,d.y)):(n===180||(n===90||n===270)&&l.x<a.x?d.x=Math.min(l.x,n===270?u.left:Math.min(u.left,c.left)):d.x=Math.max(l.x,n===270?u.right:Math.max(u.right,c.right)),f.x=d.x,f.y=l.y))),this.yN=n!==h,this.dN=i,this.gN=n,this.addPoint(d.copy()),this.addPoint(f.copy()),S.e(d),S.e(f)}computeMidOrthoPosition(t,i,s,n,o){let r=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(r=this.computeCurviness()),o?(i+n)/2+r:(t+s)/2+r}WL(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const s=this.diagram.getPositions(!1,this.containingGroup,null);for(let n=1;n<i-2;n++){const o=t[n],r=t[n+1];if(!s.isUnoccupied(Math.min(o.x,r.x),Math.min(o.y,r.y),Math.abs(o.x-r.x),Math.abs(o.y-r.y)))return!0}return!1}findClosestSegment(t){const i=t.x,s=t.y;let n=this.getPoint(0),o=this.getPoint(1),r=S.distanceLineSegmentSquared(i,s,n.x,n.y,o.x,o.y),h=0;for(let a=1;a<this.pointsCount-1;a++){n=this.getPoint(a+1);const l=S.distanceLineSegmentSquared(i,s,o.x,o.y,n.x,n.y);o=n,l<r&&(h=a,r=l)}return h}ee(){this.kh=!1,this.c()}get kh(){return(this.Nt&128)!==0}set kh(t){(this.Nt&128)!==0!==t&&(this.Nt=this.Nt^128)}get geometry(){if(!this.kh){if(this.updateRoute(),this.pointsCount<2)return this.kh=!0,this.ot;this.ot=this.makeGeometry()}return this.ot}sd(t){if(!t){if(this.Se===!1)return;const o=this.findMainElement();if(this.kh&&(o===null||o.geometry!==null))return}this.pointsCount<2?this.kh=!0:this.ot=this.makeGeometry();const i=this.path;if(i===null)return;i.ot=this.ot;const s=this.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r!==i&&r.isPanelMain&&r instanceof dt&&(r.ot=this.ot)}}SO(t){return this.Ba()&&t.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ot,i=this.pointsCount;let s=!1;const n=this.diagram;n!==null&&this.SO(n)&&(s=!0);let o=0,r=0,h=this.getPoint(0).copy();const a=h.copy(),l=this.xi.r,u=this.computeCurve();if(u===9&&i>=3&&!A.z(this.smoothness,0))if(i===3){let c=this.getPoint(1);o=Math.min(h.x,c.x),r=Math.min(h.y,c.y),c=this.getPoint(2),o=Math.min(o,c.x),r=Math.min(r,c.y)}else if(this.isOrthogonal){for(let c=0;c<i;c++){const d=l[c];a.x=Math.min(d.x,a.x),a.y=Math.min(d.y,a.y)}o=a.x,r=a.y}else{for(let c=3;c<i;c+=3){c+3>=i&&(c=i-1);const d=this.getPoint(c);a.x=Math.min(d.x,a.x),a.y=Math.min(d.y,a.y)}o=a.x,r=a.y}else{for(let c=0;c<i;c++){const d=l[c];a.x=Math.min(d.x,a.x),a.y=Math.min(d.y,a.y)}o=a.x,r=a.y}if(o-=this.k1.x,r-=this.k1.y,h.x-=o,h.y-=r,i===2&&!this.Ba()){let c=this.getPoint(1).copy();return c.x-=o,c.y-=r,this.computeShortLength(!0)!==0&&(h=this.Nf(h,!0,a)),this.computeShortLength(!1)!==0&&(c=this.Nf(c,!1,a)),t.type=1,t.startX=h.x,t.startY=h.y,t.endX=c.x,t.endY=c.y,this.kh=!0,t}else{t.type=4;const c=mi.RC(t);if(this.computeShortLength(!0)!==0&&(h=this.Nf(h,!0,a)),c.hu(h.x,h.y,!1,!1),u===9&&i>=3&&!A.z(this.smoothness,0))if(i===3){const d=this.getPoint(1),f=d.x-o,m=d.y-r;let p=this.getPoint(2).copy();p.x-=o,p.y-=r,this.computeShortLength(!1)!==0&&(p=this.Nf(p,!1,a)),c.hr(f,m,f,m,p.x,p.y)}else if(this.isOrthogonal){const d=S.V(o,r),f=S.l();f.a(this.getPoint(1));const m=S.V(o,r),p=S.V(o,r);let y=this.getPoint(0),x=null;const P=this.smoothness/3;for(let M=1;M<this.pointsCount-1;M++){x=this.getPoint(M);const C=y,F=x,T=this.getPoint(this.xN(x,M,!1));A.z(C.x,F.x)&&A.z(F.x,T.x)||A.z(C.y,F.y)&&A.z(F.y,T.y)||(this.MO(C,F,T,P,m,p),(M===1||M===2&&A.z(y.x,this.getPoint(0).x)&&A.z(y.y,this.getPoint(0).y))&&(f.x=(y.x+x.x)*.5,f.y=(y.y+x.y)*.5),c.hr(f.x-o,f.y-r,m.x-o,m.y-r,x.x-o,x.y-r),d.set(m),f.set(p),y=x)}let k=y.x,v=y.y,N=this.getPoint(this.pointsCount-1);this.computeShortLength(!1)!==0&&(N=this.Nf(N.copy(),!1,S.xo)),k=.5*(k+N.x),v=.5*(v+N.y),c.hr(p.x-o,p.y-r,k-o,v-r,N.x-o,N.y-r),S.e(d),S.e(f),S.e(m),S.e(p)}else for(let d=3;d<i;d+=3){const f=this.getPoint(d-2);d+3>=i&&(d=i-1);const m=this.getPoint(d-1);let p=this.getPoint(d);d===i-1&&this.computeShortLength(!1)!==0&&(p=this.Nf(p.copy(),!1,S.xo)),c.hr(f.x-o,f.y-r,m.x-o,m.y-r,p.x-o,p.y-r)}else{const d=S.l();d.a(this.getPoint(0));const f=S.l();f.a(d);const m=this.computeCorner();let p=1,y=0;for(;p<i;){p=this.xN(d,p,p>1);let x=this.getPoint(p);if(p>=i-1){if(!d.equals(x))this.computeShortLength(!1)!==0&&(x=this.Nf(x.copy(),!1,S.xo)),this.xn(c,-o,-r,d,x,s);else if(y===0)for(p=1;p<i;)f.a(d),x=this.getPoint(p++),this.xn(c,-o,-r,d,x,s),d.a(x);break}y=this.xN(x,p+1,p<i-3);const P=this.getPoint(y);this.NO(c,-o,-r,d,x,P,d,f,m,s),f.a(x),p=y}S.e(d)}return mi.vC(c),this.kh=!0,t}}A1(t,i,s,n){let o=s-t;if(isNaN(o)||o===1/0||o===-1/0)return NaN;o<0&&(o=-o);let r=n-i;return isNaN(r)||r===1/0||r===-1/0?NaN:(r<0&&(r=-r),A.z(o,0)?r:A.z(r,0)?o:Math.sqrt(o*o+r*r))}MO(t,i,s,n,o,r){isNaN(n)&&(n=this.smoothness/3);const h=t.x,a=t.y,l=i.x,u=i.y,c=s.x,d=s.y,f=n*this.A1(h,a,l,u),m=n*this.A1(l,u,c,d);if(A.z(a,u)&&A.z(l,c)&&(l>h?d>u?(o.x=l-f,o.y=u-f,r.x=l+m,r.y=u+m):(o.x=l-f,o.y=u+f,r.x=l+m,r.y=u-m):d>u?(o.x=l+f,o.y=u-f,r.x=l-m,r.y=u+m):(o.x=l+f,o.y=u+f,r.x=l-m,r.y=u-m)),A.z(h,l)&&A.z(u,d)&&(u>a?c>l?(o.x=l-f,o.y=u-f,r.x=l+m,r.y=u+m):(o.x=l+f,o.y=u-f,r.x=l-m,r.y=u+m):c>l?(o.x=l-f,o.y=u+f,r.x=l+m,r.y=u-m):(o.x=l+f,o.y=u+f,r.x=l-m,r.y=u-m)),A.z(h,l)&&A.z(l,c)||A.z(a,u)&&A.z(u,d)){const p=.5*(h+c),y=.5*(a+d);o.x=p,o.y=y,r.x=p,r.y=y}}Nf(t,i,s){const n=this.pointsCount;if(n<2)return t;if(i){const o=this.getPoint(1),r=o.x-s.x,h=o.y-s.y,a=this.A1(t.x,t.y,r,h);if(a===0)return t;const l=n===2?a*.5:a;let u=this.computeShortLength(!0);u>l&&(u=l);const c=u*(r-t.x)/a,d=u*(h-t.y)/a;t.x+=c,t.y+=d}else{const o=this.getPoint(n-2),r=o.x-s.x,h=o.y-s.y,a=this.A1(t.x,t.y,r,h);if(a===0)return t;const l=n===2?a*.5:a;let u=this.computeShortLength(!1);u>l&&(u=l);const c=u*(t.x-r)/a,d=u*(t.y-h)/a;t.x-=c,t.y-=d}return t}xN(t,i,s){const n=this.pointsCount;let o=t;for(;A.z(t.x,o.x)&&A.z(t.y,o.y);){if(i>=n)return n-1;o=this.getPoint(i++)}if(!A.z(t.x,o.x)&&!A.z(t.y,o.y))return i-1;let r=o;for(;A.z(t.x,o.x)&&A.z(o.x,r.x)&&(!s||(t.y>=o.y?o.y>=r.y:o.y<=r.y))||A.z(t.y,o.y)&&A.z(o.y,r.y)&&(!s||(t.x>=o.x?o.x>=r.x:o.x<=r.x));){if(i>=n)return n-1;r=this.getPoint(i++)}return i-2}NO(t,i,s,n,o,r,h,a,l,u){if(A.f(n.y,o.y)&&A.f(o.x,r.x)){let c=Math.min(l,Math.abs(o.x-a.x)/2);const d=Math.min(c,Math.abs(r.y-o.y)/2);if(c=d,A.f(c,0)){this.xn(t,i,s,n,o,u),h.a(o);return}let f=o.x;const m=o.y,p=f;let y=m;o.x>n.x?(f=o.x-c,r.y>o.y?y=o.y+d:y=o.y-d):(f=o.x+c,r.y>o.y?y=o.y+d:y=o.y-d);const x=S.V(f,m);this.xn(t,i,s,n,x,u),S.e(x),t.Cw(o.x+i,o.y+s,p+i,y+s),h.i(p,y)}else if(A.f(n.x,o.x)&&A.f(o.y,r.y)){let c=Math.min(l,Math.abs(o.y-a.y)/2);const d=Math.min(c,Math.abs(r.x-o.x)/2);if(c=d,A.f(d,0)){this.xn(t,i,s,n,o,u),h.a(o);return}const f=o.x;let m=o.y,p=f;const y=m;o.y>n.y?(m=o.y-c,r.x>o.x?p=o.x+d:p=o.x-d):(m=o.y+c,r.x>o.x?p=o.x+d:p=o.x-d);const x=S.V(f,m);this.xn(t,i,s,n,x,u),S.e(x),t.Cw(o.x+i,o.y+s,p+i,y+s),h.i(p,y)}else this.xn(t,i,s,n,o,u),h.a(o)}computeJumpLength(){return 10}xn(t,i,s,n,o,r){if(r||!this.Ba())t.lr(o.x+i,o.y+s);else{const h=this.computeJumpLength(),a=h/2,l=[];let u=0;this.isVisible()&&(u=this.CO(n,o,l));let c=n.x,d=n.y;if(u>0){if(A.f(n.y,o.y))if(n.x<o.x){let f=0;for(;f<u;){const m=Math.max(n.x,Math.min(l[f++]-a,o.x-h));t.lr(m+i,o.y+s),c=m+i,d=o.y+s;let p=Math.min(m+h,o.x);for(;f<u;){const k=l[f];if(k<p+h)f++,p=Math.min(k+a,o.x);else break}const y=o.y-h+s,x=p+i,P=o.y+s;this.curve===10?t.hu(x,P,!1,!1):t.hr(c,y,x,y,x,P),c=x,d=P}}else{let f=u-1;for(;f>=0;){const m=Math.min(n.x,Math.max(l[f--]+a,o.x+h));t.lr(m+i,o.y+s),c=m+i,d=o.y+s;let p=Math.max(m-h,o.x);for(;f>=0;){const k=l[f];if(k>p-h)f--,p=Math.max(k-a,o.x);else break}const y=o.y-h+s,x=p+i,P=o.y+s;this.curve===10?t.hu(x,P,!1,!1):t.hr(c,y,x,y,x,P),c=x,d=P}}else if(A.f(n.x,o.x))if(n.y<o.y){let f=0;for(;f<u;){const m=Math.max(n.y,Math.min(l[f++]-a,o.y-h));t.lr(o.x+i,m+s),c=o.x+i,d=m+s;let p=Math.min(m+h,o.y);for(;f<u;){const k=l[f];if(k<p+h)f++,p=Math.min(k+a,o.y);else break}const y=o.x-h+i,x=o.x+i,P=p+s;this.curve===10?t.hu(x,P,!1,!1):t.hr(y,d,y,P,x,P),c=x,d=P}}else{let f=u-1;for(;f>=0;){const m=Math.min(n.y,Math.max(l[f--]+a,o.y+h));t.lr(o.x+i,m+s),c=o.x+i,d=m+s;let p=Math.max(m-h,o.y);for(;f>=0;){const k=l[f];if(k>p-h)f--,p=Math.max(k-a,o.y);else break}const y=o.x-h+i,x=o.x+i,P=p+s;this.curve===10?t.hu(x,P,!1,!1):t.hr(y,d,y,P,x,P),c=x,d=P}}}t.lr(o.x+i,o.y+s)}}CO(t,i,s){const n=this.diagram;if(n===null||t.equals(i))return 0;const o=n.layers;for(;o.next();){const r=o.value;if(r!==null&&r.visible){const h=r.qS(),a=h.length;for(let l=0;l<a;l++){const u=h[l];if(!(u instanceof wt))continue;if(u===this)return s.length>0&&s.sort((f,m)=>f-m),s.length;if(!u.isVisible()||!u.Ba())continue;const c=u.routeBounds;if(!c.isReal()||!this.routeBounds.intersectsRect(c)||this.usesSamePort(u))continue;const d=u.path;d!==null&&d.isVisibleObject()&&this.LO(t,i,s,u)}}}return s.length>0&&s.sort((r,h)=>r-h),s.length}LO(t,i,s,n){const o=A.f(t.y,i.y),r=n.pointsCount;let h=n.getPoint(0);const a=S.l();for(let l=1;l<r;l++){const u=n.getPoint(l);if(l<r-1){const c=n.getPoint(l+1);if(h.y===u.y&&u.y===c.y){if(u.x>h.x&&c.x>=u.x||u.x<h.x&&c.x<=u.x)continue}else if(h.x===u.x&&u.x===c.x&&(u.y>h.y&&c.y>=u.y||u.y<h.y&&c.y<=u.y))continue}this.AO(t,i,h,u,a)&&(o?s.push(a.x):s.push(a.y)),h=u}S.e(a)}AO(t,i,s,n,o){const r=t.x,h=t.y,a=i.x,l=i.y,u=s.x,c=s.y,d=n.x,f=n.y;if(A.f(r,a)){if(!A.f(h,l)&&A.f(c,f)&&Math.min(h,l)<c&&Math.max(h,l)>c&&Math.min(u,d)<r&&Math.max(u,d)>r&&!A.f(u,d))return o.x=r,o.y=c,!0}else if(A.f(h,l)&&A.f(u,d)&&Math.min(r,a)<u&&Math.max(r,a)>u&&Math.min(c,f)<h&&Math.max(c,f)>h&&!A.f(c,f))return o.x=u,o.y=h,!0;return o.x=0,o.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.Dd(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.Dd(this.computeSpot(!1))?t-2:t-1}Ba(){const t=this.curve;return t===11||t===10}M1(t){if(t||this.Ba()){const i=this.diagram;i!==null&&!i.animationManager.isTicking&&!i.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&i.$l.set(this,this.Sf.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(i===null||!i.visible||i.isTemporary)return;const s=i.diagram;if(s===null||s.animationManager.isTicking)return;let n=!1;const o=s.layers;for(;o.next();){const r=o.value;if(r.visible){if(r===i){n=!0;let h=!1;const a=r.qS(),l=a.length;for(let u=0;u<l;u++){const c=a[u];c instanceof wt&&(c===this?h=!0:h&&this.MT(c,t))}}else if(n){const h=r.qS(),a=h.length;for(let l=0;l<a;l++){const u=h[l];u instanceof wt&&this.MT(u,t)}}}}}MT(t,i){if(t===null||!t.kh||!t.Se||!t.Ba())return;const s=t.routeBounds;s.isReal()&&(!this.routeBounds.intersectsRect(s)&&!i.intersectsRect(s)||this.usesSamePort(t)||t.ee())}usesSamePort(t){const i=this.pointsCount,s=t.pointsCount;if(i>0&&s>0){const n=this.getPoint(0),o=t.getPoint(0);if(n.equalsApprox(o))return!0;const r=this.getPoint(i-1),h=t.getPoint(s-1);if(r.equalsApprox(h)||n.equalsApprox(h)||r.equalsApprox(o))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);const n=this.fromNode;if(n!==null){if(this.isTreeLink&&i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let r=n;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const h=n.findVisibleNode();if(h===null||h===t)return!1}const o=this.toNode;if(o!==null){if(this.isTreeLink&&!i&&!o.isTreeExpanded)return!1;if(o===t)return!0;let r=o;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const h=o.findVisibleNode();if(h===null||h===t)return!1}return!0}Ei(t){if(super.Ei(t),t&&this.M1(!1),this.jo!==null&&this.jo.Sd(),this.js!==null){const i=this.js.iterator;for(;i.next();)i.value.Ei(t)}}get adjusting(){return this.Pf}set adjusting(t){const i=this.Pf;i!==t&&(this.Pf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Pf}get corner(){return this.Cd}set corner(t){const i=this.Cd;i!==t&&(this.Cd=t,this.ee(),this.t("corner",i,t))}get curve(){return this.Ld}set curve(t){const i=this.Ld;i!==t&&(this.Ld=t,this.invalidateRoute(),this.ee(),this.M1(i===10||i===11||t===10||t===11),this.t("curve",i,t))}get curviness(){return this.Ad}set curviness(t){const i=this.Ad;i!==t&&(this.Ad=t,this.invalidateRoute(),this.ee(),this.t("curviness",i,t))}get routing(){return this.va}set routing(t){const i=this.va;i!==t&&(this.va=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.Vm=!0),this.Ko=null,this.invalidateRoute(),this.M1(wt.mN(i)||wt.mN(t)),this.t("routing",i,t))}get smoothness(){return this.Td}set smoothness(t){const i=this.Td;i!==t&&(this.Td=t,this.ee(),this.t("smoothness",i,t))}xy(){const t=this.so;if(t===null)return;const i=this.oo;if(i===null||!isNaN(this.curviness))return;const s=this.no,n=this.ro;let o=null,r=null;const h=t.ti.r,a=h.length;for(let l=0;l<a;l++){const u=h[l];!(u.so===t&&u.no===s&&u.oo===i&&u.ro===n)&&!(u.so===i&&u.no===n&&u.oo===t&&u.ro===s)||(r===null?r=u:(o===null&&(o=[],o.push(r)),o.push(u)))}if(o!==null){let l=t.mT(i,s,n);l===null&&(l=new Yn(t,s,i,n),t.dT(l),i.dT(l)),l.Hs=o;for(let u=0;u<o.length;u++){const c=o[u];c.jo=l}l.Sd()}}wy(){const t=this.jo;if(t!==null){if(!isNaN(this.curviness))return;this.jo=null;const i=t.Hs.indexOf(this);i>=0&&(t.Hs.splice(i,1),t.Sd())}}Cl(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Ra()))return t.model.getKeyForLinkData(this.data)}};g(wt,"Ia",null),g(wt,"Ea",null),g(wt,"Normal",1),g(wt,"Orthogonal",2),g(wt,"AvoidsNodes",6),g(wt,"AvoidsNodesStraight",7),g(wt,"None",0),g(wt,"Bezier",9),g(wt,"JumpGap",10),g(wt,"JumpOver",11),g(wt,"End",17),g(wt,"Scale",18),g(wt,"Stretch",19),g(wt,"OrientAlong",21),g(wt,"OrientPlus90",22),g(wt,"OrientMinus90",23),g(wt,"OrientOpposite",24),g(wt,"OrientUpright",25),g(wt,"OrientPlus90Upright",26),g(wt,"OrientMinus90Upright",27),g(wt,"OrientUpright45",28),g(wt,"hO",8),g(wt,"aO",16),g(wt,"cO",14),g(wt,"Ua",8);let at=wt;class Yn{constructor(e,t,i,s){g(this,"Fo");g(this,"Is");g(this,"ly");g(this,"lN");g(this,"p1");g(this,"hN");g(this,"Hs");K.Ki(this),this.Fo=!1,this.Is=!1,this.ly=e,this.lN=t,this.p1=i,this.hN=s,this.Hs=[]}Sd(){if(!this.Fo){const e=this.Hs;if(e.length>0){const t=e[0].diagram;t!==null&&(t.wM.add(this),this.Is=t.undoManager.isUndoingRedoing)}}this.Fo=!0}RM(){if(this.Fo){this.Fo=!1;const e=this.Hs;if(e.length>0){const t=e[0],i=t.diagram,s=i===null||i.Vh&&!this.Is;this.Is=!1,t.arrangeBundledLinks(e,s),e.length===1&&(t.jo=null,e.length=0)}e.length===0&&(this.ly.gT(this),this.p1.gT(this))}}}const Rt=class Rt{constructor(e){g(this,"oe");g(this,"re");g(this,"Va");g(this,"za");g(this,"di");g(this,"gi");g(this,"Vt");g(this,"Ph");g(this,"Sh");g(this,"ua");g(this,"jM");g(this,"Fo");g(this,"ky");g(this,"Gc");g(this,"HM");g(this,"qM");K.Ki(this),this.ua=null,this.jM=null,this.Fo=!0,this.ky=!1,this.oe=1,this.re=1,this.Va=-1,this.za=-1,this.di=e.width,this.gi=e.height,this.Vt=[],this.Ph=0,this.Sh=0,this.Gc=11,this.HM=this.Gc*2,this.qM=this.Gc*2}Lb(e){if(e.width<=0||e.height<=0)return;const t=e.x,i=e.y,s=e.x+e.width,n=e.y+e.height;this.oe=Math.floor((t-this.di)/this.di)*this.di,this.re=Math.floor((i-this.gi)/this.gi)*this.gi,this.Va=Math.ceil((s+2*this.di)/this.di)*this.di,this.za=Math.ceil((n+2*this.gi)/this.gi)*this.gi;const o=1+(Math.ceil((this.Va-this.oe)/this.di)|0),r=1+(Math.ceil((this.za-this.re)/this.gi)|0);if(this.Vt.length===0||this.Ph<o-1||this.Sh<r-1){const h=[];for(let a=0;a<=o;a++)h[a]=new Uint32Array(r);this.Vt=h,this.Ph=o-1,this.Sh=r-1}this.TO(Rt.bN)}get bounds(){return new z(this.oe,this.re,this.Va-this.oe,this.za-this.re)}get cellWidth(){return this.di}set cellWidth(e){e>0&&e!==this.di&&(this.di=e,this.Lb(this.bounds))}get cellHeight(){return this.gi}set cellHeight(e){e>0&&e!==this.gi&&(this.gi=e,this.Lb(this.bounds))}vd(e,t){return this.oe<=e&&e<=this.Va&&this.re<=t&&t<=this.za}lo(e,t){if(!this.vd(e,t))return Rt.bN;e-=this.oe,e/=this.di,t-=this.re,t/=this.gi;const i=e|0,s=t|0;return this.Vt[i][s]}VR(e,t,i,s){if(!this.vd(e,t))return;const n=(e-this.oe)/this.di|0,o=(t-this.re)/this.gi|0,r=(e+i-this.oe)/this.di|0,h=(t+s-this.re)/this.gi|0,a=Math.min(r,this.Ph),l=Math.min(h,this.Sh);for(let u=n;u<=a;u++){const c=this.Vt[u];if(c.fill)c.fill(Rt.qs,o,l+1);else for(let d=o;d<=l;d++)c[d]=Rt.qs}}TO(e){for(let t=0;t<=this.Ph;t++){const i=this.Vt[t];if(i.fill)i.fill(e);else for(let s=0;s<=this.Sh;s++)i[s]=e}}rA(){for(let e=0;e<=this.Ph;e++){const t=this.Vt[e];for(let i=0;i<=this.Sh;i++)t[i]>=Rt.Xa&&(t[i]=Rt.bN)}}DO(e,t){return this.lo(e,t)===Rt.qs}isUnoccupied(e,t,i,s){if(e>this.Va||e+i<this.oe||t>this.za||t+s<this.re)return!0;let n=(e-this.oe)/this.di|0,o=(t-this.re)/this.gi|0,r=Math.max(0,i)/this.di+1|0,h=Math.max(0,s)/this.gi+1|0;if(n<0&&(r+=n,n=0),o<0&&(h+=o,o=0),r<0||h<0)return!0;const a=Math.min(n+r-1,this.Ph)|0,l=Math.min(o+h-1,this.Sh)|0;for(let u=n;u<=a;u++){const c=this.Vt[u];for(let d=o;d<=l;d++)if(c[d]===Rt.qs)return!1}return!0}maxAvoidsLinksSpaceH(e,t,i,s){if(e>this.Va||t<this.oe||i>this.za||i<this.re)return 0;const n=(e-this.oe)/this.di|0,o=(t-this.oe)/this.di|0,r=(i-this.re)/this.gi|0,h=s/this.gi+1|0;let a;for(a=0;a<h/2;a++){let l=!1;for(let u=n;u<=o;u++)if(this.Vt[u][r+a]===Rt.qs||this.Vt[u][r-a]===Rt.qs){l=!0;break}if(l)return Math.max(0,(2*a-1)*this.gi)}return s}maxAvoidsLinksSpaceV(e,t,i,s){if(e>this.za||t<this.re||i>this.Va||i<this.oe)return 0;const n=(e-this.re)/this.gi|0,o=(t-this.re)/this.gi|0,r=(i-this.oe)/this.di|0,h=s/this.di+1|0;let a;for(a=0;a<h/2;a++){let l=!1;for(let u=n;u<=o;u++)if(this.Vt[r+a][u]===Rt.qs||this.Vt[r-a][u]===Rt.qs){l=!0;break}if(l)return Math.max(0,(2*a-1)*this.di)}return s}FO(e,t,i,s,n,o,r,h){e=e|0,t=t|0;let a=this.Vt[e][t];if(a>=Rt.Xa&&a<Rt.Rd)for(s?t+=i:e+=i,a+=1;n<=e&&e<=o&&r<=t&&t<=h;){const l=this.Vt[e][t];if(a>=l)break;this.Vt[e][t]=a,a+=1,s?t+=i:e+=i}return s?t:e}ho(e,t,i,s,n,o,r,h){if(e<n||e>o||t<r||t>h)return;const a=this.FO(e,t,i,s,n,o,r,h);if(s)if(i>0)for(let l=t+i;l<a;l+=i)this.ho(e,l,1,!s,n,o,r,h),this.ho(e,l,-1,!s,n,o,r,h);else for(let l=t+i;l>a;l+=i)this.ho(e,l,1,!s,n,o,r,h),this.ho(e,l,-1,!s,n,o,r,h);else if(i>0)for(let l=e+i;l<a;l+=i)this.ho(l,t,1,!s,n,o,r,h),this.ho(l,t,-1,!s,n,o,r,h);else for(let l=e+i;l>a;l+=i)this.ho(l,t,1,!s,n,o,r,h),this.ho(l,t,-1,!s,n,o,r,h)}T1(e,t,i,s,n,o,r,h,a,l){let u=e|0,c=t|0,d=Rt.qs,f=Rt.Xa;for(this.Vt[u][c]=f;d===Rt.qs&&u>r&&u<h&&c>a&&c<l;)f+=1,this.Vt[u][c]=f,o?c+=n:u+=n,d=this.Vt[u][c];return o?c:u}D1(e,t,i,s,n,o,r,h,a,l){let u=i|0,c=s|0,d=Rt.qs;const f=Rt.Rd;for(this.Vt[u][c]=f;d===Rt.qs&&u>r&&u<h&&c>a&&c<l;)this.Vt[u][c]=f,o?c+=n:u+=n,d=this.Vt[u][c]}NT(e,t,i,s,n,o){this.ky=!1;let r=e.x,h=e.y;if(!this.vd(r,h))return;r-=this.oe,r/=this.di,h-=this.re,h/=this.gi;let a=i.x,l=i.y;if(!this.vd(a,l))return;if(a-=this.oe,a/=this.di,l-=this.re,l/=this.gi,Math.abs(r-a)<=1&&Math.abs(h-l)<=1){this.ky=!0;return}let u=n.x,c=n.y,d=n.x+n.width,f=n.y+n.height;u-=this.oe,u/=this.di,c-=this.re,c/=this.gi,d-=this.oe,d/=this.di,f-=this.re,f/=this.gi;const m=Math.max(0,Math.min(this.Ph,u|0)),p=Math.min(this.Ph,Math.max(0,d|0)),y=Math.max(0,Math.min(this.Sh,c|0)),x=Math.min(this.Sh,Math.max(0,f|0)),P=0,k=90,v=270,N=this.Vt,M=r|0,C=h|0,F=a|0,T=l|0,L=t===P||t===k?1:-1,D=t===k||t===v;N[M][C]===Rt.qs?(this.T1(M,C,F,T,L,D,m,p,y,x),this.T1(M,C,F,T,1,!D,m,p,y,x),this.T1(M,C,F,T,-1,!D,m,p,y,x)):this.T1(M,C,F,T,L,D,M,C,M,C),N[F][T]===Rt.qs?(this.D1(M,C,F,T,s===P||s===k?1:-1,s===k||s===v,m,p,y,x),this.D1(M,C,F,T,1,!(s===k||s===v),m,p,y,x),this.D1(M,C,F,T,-1,!(s===k||s===v),m,p,y,x)):this.D1(M,C,F,T,L,D,F,T,F,T);const O=b.et();if(o&&this.CT(F,T,s,M,C,O)){(O[0]!==F||O[1]!==T)&&(O.unshift(T),O.unshift(F)),(O[O.length-2]!==M||O[O.length-1]!==C)&&(O.push(M),O.push(C));let R=Rt.Xa,I=O[O.length-2],X=O[O.length-1];N[I][X]=R++;for(let j=O.length-4;j>=0;j-=2){I=O[j+2],X=O[j+3];const V=O[j],U=O[j+1];for(;V>I?I++:V<I?I--:U>X?X++:U<X&&X--,N[I][X]=R++,!(I===V&&X===U););}}else this.ho(M,C,1,!1,m,p,y,x),this.ho(M,C,-1,!1,m,p,y,x),this.ho(M,C,1,!0,m,p,y,x),this.ho(M,C,-1,!0,m,p,y,x);b.J(O)}CT(e,t,i,s,n,o){const r=this.Vt;let h=e,a=t;for(;;){if(h===s&&a===n)return!0;let l=h,u=a;if(i===0)if(l<s)l++;else break;else if(i===90)if(u<n)u++;else break;else if(i===180)if(l>s)l--;else break;else if(u>n)u--;else break;const c=r[l][u];if(c===0||c===Rt.kN)break;h=l,a=u}for(;;){let l=i,u=h,c=a;i===0?c<n?(l=90,c++):c>n&&(l=270,c--):i===90?u<s?(l=0,u++):u>s&&(l=180,u--):i===180?c<n?(l=90,c++):c>n&&(l=270,c--):u<s?(l=0,u++):u>s&&(l=180,u--);const d=r[u][c];if(l!==i&&d!==0&&d!==Rt.kN){if(o.push(h),o.push(a),this.CT(h,a,l,s,n,o))return!0;o.pop(),o.pop()}if(r[h][a]=Rt.kN,i===0){if(h===e)return!1;h--}else if(i===90){if(a===t)return!1;a--}else if(i===180){if(h===e)return!1;h++}else{if(a===t)return!1;a++}}}};g(Rt,"qs",0),g(Rt,"Xa",1),g(Rt,"Rd",999999),g(Rt,"bN",Rt.Rd+1),g(Rt,"kN",Rt.Rd+2);let Xe=Rt;class ms{constructor(e,t){g(this,"Me");g(this,"al");g(this,"os");g(this,"Od");K.Ki(this),this.Me=e,this.al=t,this.os=[],this.Od=!1}toString(){const e=this.os;let t=this.Me.toString()+" "+e.length.toString()+":";for(let i=0;i<e.length;i++){const s=e[i];s!==null&&(t+=`
  `+s.toString())}return t}RO(e,t,i,s){const n=t.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(e.height,e.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Sd(){this.os.length=0}ST(e){let t=this.os;t.length===0&&(this.vO(),t=this.os);for(let i=0;i<t.length;i++){const s=t[i];if(s!==null&&s.Ke===e)return s}return null}vO(){if(!this.Od){const e=this.Od;this.Od=!0;let t,i=null;const s=this.Me,n=s instanceof ut?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.Od=e,this.os;i=n,t=i.findExternalLinksConnected()}else s.isTreeExpanded?t=s.findLinksConnected(this.al.portId):t=s.findExternalTreeLinksConnected();this.os.length=0;let o=0;const r=this.al.getDocumentPoint(B.TopLeft,S.l()),h=this.al.getDocumentPoint(B.BottomRight,S.l()),a=z.V(r.x,r.y,0,0);a.unionPoint(h),S.e(r),S.e(h);const l=S.V(a.x+a.width/2,a.y+a.height/2),u=this.al.getDocumentAngle(),c=t.iterator;for(;c.next();){const p=c.value;if(!p.isVisible()||p.fromPort===p.toPort)continue;const y=p.fromPort===this.al||p.fromNode!==null&&i!==null&&p.fromNode.isMemberOf(i),x=p.computeSpot(y,this.al);if(!x.isSide())continue;let P;if(y?P=p.toPort:P=p.fromPort,P===null)continue;let k=P.part;if(k===null)continue;const v=k.findVisibleNode();v!==null&&v!==k&&(k=v,P=k.port);const N=p.computeOtherPoint(k,P);let M=l.directionPoint(N);M-=u,M<0?M+=360:M>=360&&(M-=360);const C=this.RO(a,x,M,p.isOrthogonal);let F=0;C===0?(F=4,M>180&&(M-=360)):C===90?(F=8,M>270&&(M-=360)):C===180?F=2:(F=1,M<90&&(M+=360));let T=this.os[o];T===void 0?(T=new Gn(p,M,F),this.os[o]=T):(T.Ke=p,T.Yt=M,T.me=F),T.F1.set(N),o++}S.e(l),this.OO();const d=this.os.length;let f=-1,m=0;for(o=0;o<d;o++){const p=this.os[o];p!==void 0&&(p.me!==f&&(f=p.me,m=0),p.Id=m,m++)}for(f=-1,m=0,o=d-1;o>=0;o--){const p=this.os[o];p!==void 0&&(p.me!==f&&(f=p.me,m=p.Id+1),p.Mf=m)}this.IO(this.os),this.EO(this.os),this.Od=e,z.e(a)}return this.os}UO(e,t){return e===t?0:e===null?-1:t===null?1:e.me<t.me?-1:e.me>t.me?1:e.Yt<t.Yt?-1:e.Yt>t.Yt?1:0}OO(){this.os.sort(ms.prototype.UO)}IO(e){const t=this.al,i=this.Me.portSpreading,s=S.l(),n=S.l(),o=S.l(),r=S.l();t.getDocumentPoint(B.TopLeft,s),t.getDocumentPoint(B.TopRight,n),t.getDocumentPoint(B.BottomRight,o),t.getDocumentPoint(B.BottomLeft,r);let h=0,a=0,l=0,u=0;if(i===2)for(let P=0;P<e.length;P++){const k=e[P];if(k===null)continue;const v=k.Ke.computeThickness();switch(k.me){case 8:l+=v;break;case 2:u+=v;break;case 1:h+=v;break;default:case 4:a+=v;break}}let c=0,d=0,f=1,m=n,p=o,y=0,x=0;for(let P=0;P<e.length;P++){const k=e[P];if(k===null)continue;if(c!==k.me){switch(c=k.me,c){case 8:m=o,p=r;break;case 2:m=r,p=s;break;case 1:m=s,p=n;break;default:case 4:m=n,p=o;break}switch(y=p.x-m.x,x=p.y-m.y,c){case 8:l>Math.abs(y)?(f=Math.abs(y)/l,l=Math.abs(y)):f=1;break;case 2:u>Math.abs(x)?(f=Math.abs(x)/u,u=Math.abs(x)):f=1;break;case 1:h>Math.abs(y)?(f=Math.abs(y)/h,h=Math.abs(y)):f=1;break;default:case 4:a>Math.abs(x)?(f=Math.abs(x)/a,a=Math.abs(x)):f=1;break}d=0}const v=k.Fd;if(i===2){let N=k.Ke.computeThickness();switch(N*=f,v.set(m),c){case 8:v.x=m.x+y/2+l/2-d-N/2;break;case 2:v.y=m.y+x/2+u/2-d-N/2;break;case 1:v.x=m.x+y/2-h/2+d+N/2;break;default:case 4:v.y=m.y+x/2-a/2+d+N/2;break}d+=N}else{let N=.5;i===1&&(N=(k.Id+1)/(k.Mf+1)),v.x=m.x+y*N,v.y=m.y+x*N}}S.e(s),S.e(n),S.e(o),S.e(r)}EO(e){for(let t=0;t<e.length;t++){const i=e[t];i!==null&&(i.L1=this.BO(i))}}BO(e){const t=e.Ke,i=t.fromPort===this.al,s=t.computeEndSegmentLength(this.Me,this.al,B.None,i);let n=e.Id;if(n<0)return s;const o=e.Mf;if(o<=1||!t.isOrthogonal)return s;const r=e.F1,h=e.Fd;(e.me===2||e.me===8)&&(n=o-1-n);const a=at.hO,l=e.me===2||e.me===4;return(l?r.y<h.y:r.x<h.x)?s+n*a:(l?r.y===h.y:r.x===h.x)?s:s+(o-1-n)*a}}class Gn{constructor(e,t,i){g(this,"Ke");g(this,"Yt");g(this,"me");g(this,"F1");g(this,"Id");g(this,"Mf");g(this,"Fd");g(this,"L1");this.Ke=e,this.Yt=t,this.me=i,this.F1=new S,this.Id=0,this.Mf=0,this.Fd=new S,this.L1=0}toString(){return this.Ke.toString()+" "+this.Yt.toString()+" "+this.me.toString()+":"+this.Id.toString()+"/"+this.Mf.toString()+" "+this.Fd.toString()+" "+this.L1.toString()+" "+this.F1.toString()}}class ji{constructor(){g(this,"ga");g(this,"ma");g(this,"pa");g(this,"ya");g(this,"wa");g(this,"xa");g(this,"O0");g(this,"R0");g(this,"I0");g(this,"v0");this.ga=B.Default,this.ma=B.Default,this.pa=NaN,this.ya=NaN,this.wa=NaN,this.xa=NaN,this.O0=null,this.R0=null,this.I0=1/0,this.v0=1/0}copy(){const e=new ji;return e.ga=this.ga.P(),e.ma=this.ma.P(),e.pa=this.pa,e.ya=this.ya,e.wa=this.wa,e.xa=this.xa,e.O0=this.O0,e.R0=this.R0,e.I0=this.I0,e.v0=this.v0,e}}class Je{constructor(){g(this,"N0");g(this,"C0");g(this,"L0");g(this,"M0");g(this,"yp");g(this,"wp");this.N0=-1/0,this.C0=0,this.L0=S.xo,this.M0=0,this.yp="None",this.wp="None"}copy(){const e=new Je;return e.N0=this.N0,e.C0=this.C0,e.L0=this.L0.P(),e.M0=this.M0,e.yp=this.yp,e.wp=this.wp,e}}class ut extends st{constructor(t,i){let s;t===void 0||t instanceof Nt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"Ed");g(this,"Ft");g(this,"ca");g(this,"h0");g(this,"si");g(this,"ie");this.v=this.v|4608,this.Ed=new K,this.Ft=null,this.ie=new ne,this.ie.group=this,this.ca=new K,this.h0=null,this.si=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),this.v=this.v&-32769;const i=t.findInVisualTree(s=>s instanceof ve);i instanceof ve?t.Ft=i:t.Ft=null,this.ie!==null?(t.ie=this.ie.copy(),t.ie.group=t):(t.ie!==null&&(t.ie.group=null),t.ie=null),this.si!==null&&(t.si=this.si.copy())}vo(t){super.vo(t);const i=t.findSubGraphParts(),s=t.memberParts;for(;s.next();){const n=s.value;if(n.c(),n.invalidateLayout(8),n.clearAdornments(),n instanceof st)n.invalidateConnectedLinks(i);else if(n instanceof at){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(i)}}}qc(t,i,s,n,o,r,h){if(t===3&&i==="elements"){if(o instanceof ve)this.Ft===null?this.Ft=o:this.Ft!==o&&b.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(o instanceof rt){const a=o.findInVisualTree(l=>l instanceof ve);a instanceof ve&&(this.Ft===null?this.Ft=a:this.Ft!==a&&b.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&i==="elements"&&this.Ft!==null&&(n===this.Ft?this.Ft=null:n instanceof rt&&this.Ft.isContainedBy(n)&&(this.Ft=null));super.qc(t,i,s,n,o,r,h)}Ju(t,i){if(super.Ju(t,i),this.isClipping&&this.type!==rt.Spot&&this.isSubGraphExpanded){let s=this.resizeObject;s instanceof rt&&(s=s.findMainElement()),this.si===null&&(this.si=new z),s.getDocumentBounds(this.si),s instanceof dt&&this.si.inflate(-s.strokeWidth,-s.strokeWidth)}}uh(t,i,s,n){this.hasPlaceholder()&&(this.Go=this.placeholder),super.uh(t,i,s,n)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}Yr(){if(!super.Yr())return!1;const t=this.memberParts;for(;t.next();){const i=t.value;if(i instanceof st){if(!i.isVisible())continue;if(i._e())return!1}else if(i instanceof at){if(!i.isVisible())continue;if(i._e()&&i.fromNode!==this&&i.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.Ft!==null&&this.Ft.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Ft}get computesBoundsAfterDrag(){return(this.v&2048)!==0}set computesBoundsAfterDrag(t){const i=(this.v&2048)!==0;i!==t&&(this.v=this.v^2048,this.t("computesBoundsAfterDrag",i,t))}get computesBoundsIncludingLinks(){return(this.v&4096)!==0}set computesBoundsIncludingLinks(t){const i=(this.v&4096)!==0;i!==t&&(this.v=this.v^4096,this.t("computesBoundsIncludingLinks",i,t))}get computesBoundsIncludingLocation(){return(this.v&8192)!==0}set computesBoundsIncludingLocation(t){const i=(this.v&8192)!==0;i!==t&&(this.v=this.v^8192,this.t("computesBoundsIncludingLocation",i,t))}get handlesDragDropForMembers(){return(this.v&16384)!==0}set handlesDragDropForMembers(t){const i=(this.v&16384)!==0;i!==t&&(this.v=this.v^16384,this.t("handlesDragDropForMembers",i,t))}get avoidableMembers(){return(this.v&131072)!==0}set avoidableMembers(t){const i=(this.v&131072)!==0;i!==t&&(this.v=this.v^131072,this.t("avoidableMembers",i,t))}get memberParts(){return this.Ed.iterator}sN(t){if(this.Ed.add(t)){t instanceof ut&&this.ca.add(t);const s=this.memberAdded;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,t),o!==null&&(o.X=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!1)}if(t instanceof at&&!this.computesBoundsIncludingLinks)return;let i=this.Ft;i===null&&(i=this),i.c()}eN(t){if(this.Ed.delete(t)){t instanceof ut&&this.ca.delete(t);const s=this.memberRemoved;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,t),o!==null&&(o.X=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!0)}if(t instanceof at&&!this.computesBoundsIncludingLinks)return;let i=this.Ft;i===null&&(i=this),i.c()}Xc(){if(this.Ed.count>0){const t=this.diagram;if(t!==null){const i=this.Ed.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}super.Xc()}get layout(){return this.ie}set layout(t){const i=this.ie;if(i!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&b.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),i!==null&&(i.diagram=null,i.group=null),this.ie=t;const s=this.diagram;t!==null&&(t.diagram=s,t.group=this),s!==null&&(s.Vr=!0),this.t("layout",i,t),s!==null&&s.requestUpdate()}}get memberAdded(){return this.Rt!==null?this.Rt.gy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(t!==null&&b.k(t,ut,"memberAdded"),this.ll().gy=t,this.t("memberAdded",i,t))}get memberRemoved(){return this.Rt!==null?this.Rt.my:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(t!==null&&b.k(t,ut,"memberRemoved"),this.ll().my=t,this.t("memberRemoved",i,t))}get memberValidation(){return this.Rt!==null?this.Rt.nh:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(t!==null&&b.k(t,ut,"memberValidation"),this.ll().nh=t,this.t("memberValidation",i,t))}canAddMembers(t){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.m2(t).iterator;for(;n.next();){const o=n.value;if(!s.isValidMember(this,o))return!1}return!0}addMembers(t,i){const s=this.diagram;if(s===null)return!1;const n=s.commandHandler,o=n.m2(t);let r=!0;const h=o.iterator;for(;h.next();){const a=h.value;!i||n.isValidMember(this,a)?a.containingGroup=this:r=!1}return r}get ungroupable(){return(this.v&256)!==0}set ungroupable(t){const i=(this.v&256)!==0;i!==t&&(this.v=this.v^256,this.t("ungroupable",i,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const i=t.diagram;return!(i!==null&&!i.allowUngroup)}invalidateConnectedLinks(t){const i=this.VO();if(super.invalidateConnectedLinks(t),i)return;this.XL(!0);const s=this.findExternalLinksConnected();for(;s.next();){const n=s.value;if(t!==void 0&&t.has(n))continue;const o=n.fromNode;if(o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible())o.qi(n.fromPort),o.qi(n.toPort),n.invalidateRoute();else{const r=n.toNode;r!==null&&r!==this&&r.isMemberOf(this)&&!r.isVisible()&&(r.qi(n.fromPort),r.qi(n.toPort),n.invalidateRoute())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.MM;if(t&&this.h0!==null)return this.h0.iterator;const i=this.findSubGraphParts();i.add(this);const s=new K,n=i.iterator;for(;n.next();){const o=n.value;if(!(o instanceof st))continue;const r=o.linksConnected;for(;r.next();){const h=r.value;i.has(h)||s.add(h)}}return t&&(this.h0=s),s.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const i=new K,s=t.iterator;for(;s.next();){const n=s.value;if(!(n instanceof st))continue;const o=n.linksConnected;for(;o.next();){const r=o.value,h=r.fromNode;h!==null&&(!t.has(h)||h===this)&&i.add(h);const a=r.toNode;a!==null&&(!t.has(a)||a===this)&&i.add(a)}}return i.iterator}vE(){function t(s,n){s!==null&&(n.add(s),t(s.containingGroup,n))}const i=new K;return t(this,i),i}findSubGraphParts(){const t=new K;return Lt.oh(t,this,!0,0,!0),t.delete(this),t}Ei(t){super.Ei(t);const i=this.memberParts;for(;i.next();)i.value.Ei(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.LT(i,t,this),t.isCollapsingExpanding=!1}LT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!1),o instanceof ut&&o.isSubGraphExpanded&&(o.wasSubGraphExpanded=o.isSubGraphExpanded,o.LT(t,i,s)),o instanceof st)o.invalidateConnectedLinks(t),i.Lc(o,s);else if(o instanceof at){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.AT(i,t,this),t.isCollapsingExpanding=!1}AT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!0),o instanceof ut&&o.wasSubGraphExpanded&&(o.wasSubGraphExpanded=!1,o.AT(t,i,s)),o instanceof st)o.invalidateConnectedLinks(t);else if(o instanceof at){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.v&512)!==0}set isSubGraphExpanded(t){const i=(this.v&512)!==0;if(i!==t){this.v=this.v^512;const s=this.diagram;this.t("isSubGraphExpanded",i,t);const n=this.subGraphExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this),s!==null&&(s.X=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Ft!==null&&this.Ft.c(),this.memberParts.each(o=>o.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.v&1024)!==0}set wasSubGraphExpanded(t){const i=(this.v&1024)!==0;i!==t&&(this.v=this.v^1024,this.t("wasSubGraphExpanded",i,t))}get subGraphExpandedChanged(){return this.Rt!==null?this.Rt.yy:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(t!==null&&b.k(t,ut,"subGraphExpandedChanged"),this.ll().yy=t,this.t("subGraphExpandedChanged",i,t))}move(t,i){i===void 0&&(i=!1);const s=i?this.location:this.position,n=s.x,o=s.y,r=t.x,h=t.y;if((n===r||isNaN(n)&&isNaN(r))&&(o===h||isNaN(o)&&isNaN(h)))return;const a=r-(isNaN(n)?0:n),l=h-(isNaN(o)?0:o),u=S.l();super.move(t,i);const c=new K,d=this.findSubGraphParts().iterator;for(;d.next();){const f=d.value;f instanceof at&&(f.suspendsRouting&&c.add(f),!(!f.Se&&(f.fromNode===this||f.toNode===this))&&(f.suspendsRouting=!0))}for(d.reset();d.next();){const f=d.value;if(f.Cl()||f instanceof st&&f.isLinkLabel)continue;const m=f.position,p=f.location;m.isReal()?(u.x=m.x+a,u.y=m.y+l,f.position=u):p.isReal()&&(u.x=p.x+a,u.y=p.y+l,f.location=u)}for(d.reset();d.next();){const f=d.value;if(!(f instanceof at)||(f.suspendsRouting=c.has(f),!f.Se&&(f.fromNode===this||f.toNode===this)))continue;const m=f.position;u.x=m.x+a,u.y=m.y+l,u.isReal()?f.move(u):f.invalidateRoute()}S.e(u)}VO(){return(this.v&65536)!==0}XL(t){(this.v&65536)!==0!==t&&(this.v=this.v^65536)}get fa(){return(this.v&32768)!==0}set fa(t){(this.v&32768)!==0!==t&&(this.v=this.v^32768)}}class ve extends Ct{constructor(t){super();g(this,"Zt");g(this,"Ud");this.Zt=Ot.Rg,this.Ud=new z(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Zt=this.Zt.P(),t.Ud=this.Ud.copy()}fh(t){if(this.background===null)return!1;const i=this.naturalBounds;return z.contains(0,0,i.width,i.height,t.x,t.y)}Wu(t,i,s,n){const o=this.part;if((o===null||!(o instanceof ut)&&!(o instanceof yt))&&b.o("Placeholder is not inside a Group or Adornment."),o instanceof ut){const r=this.computeBorder(this.Ud),h=this.minSize,a=isFinite(h.width)?Math.max(h.width,r.width):r.width,l=isFinite(h.height)?Math.max(h.height,r.height):r.height,u=this.zi;u.Fn(a||0,l||0),this.Wn(0,0,u.width,u.height);const c=o.memberParts;let d=!1;for(;c.next();)if(c.value.isVisible()){d=!0;break}const f=o.diagram;if(d&&f!==null&&!f.animationManager.US(o)&&!isNaN(r.x)&&!isNaN(r.y)){const m=S.l();m.setRectSpot(r,o.locationSpot),o.location=m,S.e(m)}}else{const r=o,h=this.zi,a=this.Zt,l=a.left+a.right,u=a.top+a.bottom,c=r.adornedObject,d=c.getDocumentAngle();r.angle=d;let f=0;c instanceof dt&&(f=c.strokeWidth);const m=c.getDocumentScale(),p=c.naturalBounds,y=(p.width+f)*m,x=(p.height+f)*m;if(r.type!==rt.Link){const P=r.category==="Selection"?B.TopLeft:r.locationSpot,k=c.getDocumentPoint(P,S.l());r.location=k,S.e(k)}if(!isNaN(y)&&!isNaN(x))h.Fn(y+l||0,x+u||0),this.Wn(-a.left,-a.top,h.width,h.height);else{const P=c.getDocumentPoint(B.TopLeft,S.l()),k=z.V(P.x,P.y,0,0);k.unionPoint(c.getDocumentPoint(B.BottomRight,P)),k.unionPoint(c.getDocumentPoint(B.TopRight,P)),k.unionPoint(c.getDocumentPoint(B.BottomLeft,P)),h.Fn(k.width+l||0,k.height+u||0),this.Wn(-a.left,-a.top,h.width,h.height),S.e(P),z.e(k)}}}uh(t,i,s,n){this.actualBounds.i(t,i,s,n)}computeBorder(t){const i=this.part,s=i.diagram,n=s===null||!s.animationManager.isAnimating;if(s!==null&&i instanceof ut&&!i.layer.isTemporary&&i.computesBoundsAfterDrag&&this.Ud.isReal()){const a=s.toolManager.findTool("Dragging");if(a===s.currentTool){const l=a.computeBorder(i,this.Ud,t);if(l!==null)return l}}const o=z.l(),r=this.computeMemberBounds(o),h=this.Zt;return i instanceof ut&&!i.isSubGraphExpanded?t.i(r.x-h.left,r.y-h.top,0,0):t.i(r.x-h.left,r.y-h.top,Math.max(r.width+h.left+h.right,0),Math.max(r.height+h.top+h.bottom,0)),z.e(o),n&&i instanceof ut&&i.computesBoundsIncludingLocation&&i.location.isReal()&&t.unionPoint(i.location),t}computeMemberBounds(t){if(!(this.part instanceof ut))return t.i(0,0,0,0),t;const i=this.part;let s=1/0,n=1/0,o=-1/0,r=-1/0;const h=i.memberParts;for(;h.next();){const a=h.value;if(!a.isVisible()||a instanceof at&&(!i.computesBoundsIncludingLinks||a.To()||a.fromNode===i||a.toNode===i))continue;const l=a.actualBounds;l.left<s&&(s=l.left),l.top<n&&(n=l.top),l.right>o&&(o=l.right),l.bottom>r&&(r=l.bottom)}if(!isFinite(s)||!isFinite(n)){const a=i.location;t.i(a.x,a.y,0,0)}else t.i(s,n,o-s,r-n);return t}get padding(){return this.Zt}set padding(t){typeof t=="number"&&(t=new Ot(t));const i=this.Zt;i.equals(t)||(t=t.P(),this.Zt=t,this.t("padding",i,t),this.c())}}class ne{constructor(e){g(this,"N");g(this,"ua");g(this,"Bd");g(this,"wr");g(this,"Vd");g(this,"zd");g(this,"Co");g(this,"cl");g(this,"Xd");g(this,"Yd");g(this,"ao");K.Ki(this),this.N=null,this.ua=null,this.Bd=!0,this.wr=!0,this.Vd=!1,this.zd=new S(0,0).u(),this.Co=!0,this.cl=null,this.Xd=null,this.Yd=!1,this.ao=null,e&&Object.assign(this,e)}cloneProtected(e){e.Bd=this.Bd,e.wr=this.wr,e.Vd=this.Vd,e.zd.a(this.zd),e.Co=this.Co,e.cl=this.cl,e.Xd=this.Xd,e.Yd=!0}copy(){const e=new this.constructor;return this.cloneProtected(e),e}oi(e){}toString(){let e=b.Dn(this.constructor);return e+="(",this.group!==null&&(e+=" in "+this.group),this.diagram!==null&&(e+=" for "+this.diagram),e+=")",e}get diagram(){return this.N}set diagram(e){this.N=e}get group(){return this.ua}set group(e){this.ua!==e&&(this.ua=e,e!==null&&(this.N=e.diagram))}get isOngoing(){return this.Bd}set isOngoing(e){this.Bd!==e&&(b.s(e,"boolean",ne,"isOngoing"),this.Bd=e)}get isInitial(){return this.wr}set isInitial(e){b.s(e,"boolean",ne,"isInitial"),this.wr=e,e||(this.Yd=!0)}get isViewportSized(){return this.Vd}set isViewportSized(e){this.Vd!==e&&(b.s(e,"boolean",ne,"isViewportSized"),this.Vd=e,e&&this.invalidateLayout())}get isRouting(){return this.Co}set isRouting(e){this.Co!==e&&(b.s(e,"boolean",ne,"isRouting"),this.Co=e)}get isRealtime(){return this.cl}set isRealtime(e){this.cl!==e&&(e!==null&&b.s(e,"boolean",ne,"isRealtime"),this.cl=e)}get isValidLayout(){return this.Yd}set isValidLayout(e){if(this.Yd!==e&&(b.s(e,"boolean",ne,"isValidLayout"),this.Yd=e,!e)){const t=this.diagram;t!==null&&(t.Vr=!0)}}invalidateLayout(){if(this.isValidLayout){const e=this.diagram;if(e===null||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;if(t.isTicking)return;t.defaultAnimation.isAnimating&&t.stopAnimation(),(this.isOngoing&&e.Vh||this.isInitial&&!e.Vh)&&(this.isValidLayout=!1,e.requestUpdate())}}get network(){return this.ao}set network(e){this.ao!==e&&(this.ao=e,e!==null&&(e.layout=this))}createNetwork(){return new $e(this)}makeNetwork(e){const t=this.createNetwork();return e instanceof kt?(t.addParts(e.nodes,!0),t.addParts(e.links,!0)):e instanceof ut?t.addParts(e.memberParts):t.addParts(e.iterator),t}updateParts(){this.isValidLayout=!0;let e=this.diagram;if(e===null&&this.network!==null){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value.node;if(i!==null&&(e=i.diagram,e!==null))break}}try{e!==null&&e.startTransaction("Layout"),this.commitLayout()}finally{e!==null&&e.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const e=this.network.vertexes.iterator;for(;e.next();)e.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(e){const t=new K;if(e instanceof kt?(this.Mh(t,e.nodes,!0,this.fa,!0,!1,!0),this.Mh(t,e.parts,!0,this.fa,!0,!1,!0)):e instanceof ut?this.Mh(t,e.memberParts,!1,this.fa,!0,!1,!0):t.addAll(e.iterator),t.count>0){const i=this.diagram;i!==null&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(t),i!==null&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(e){const t=e.count,i=Math.ceil(Math.sqrt(t));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,h=0,a=0;const l=e.iterator;for(;l.next();){const u=l.value;u.ensureBounds();const c=u.measuredBounds,d=c.width,f=c.height;u.moveTo(o,r),u instanceof ut&&(u.fa=!1),o+=Math.max(d,50)+20,a=Math.max(a,Math.max(f,50)),h>=i-1?(h=0,o=s,r+=a+20,a=0):h++}}fa(e){return!!(!e.location.isReal()&&!e.position.isReal()||e instanceof ut&&e.fa)}Mh(e,t,i,s,n,o,r){const h=t.iterator;for(;h.next();){const a=h.value;if(!(i&&!a.isTopLevel)&&!(s!==null&&!s(a))&&a.canLayout())if(n&&a instanceof st){if(a.isLinkLabel)continue;a instanceof ut&&a.layout===null?this.Mh(e,a.memberParts,!1,s,n,o,r):(a.ensureBounds(),e.add(a))}else o&&a instanceof at?e.add(a):r&&a.ke()&&!(a instanceof st)&&(a.ensureBounds(),e.add(a))}}getLayoutBounds(e,t){const i=this.boundsComputation;return i!==null?(t||(t=new z),i(e,this,t)):!t&&e.margin.equalTo(0,0,0,0)?e.actualBounds:(t||(t=new z),t.set(e.actualBounds),t.addMargin(e.margin),t)}get boundsComputation(){return this.Xd}set boundsComputation(e){this.Xd!==e&&(e!==null&&b.k(e,ne,"boundsComputation"),this.Xd=e,this.invalidateLayout())}collectParts(e){const t=new K;return e instanceof kt?(this.Mh(t,e.nodes,!0,null,!0,!0,!0),this.Mh(t,e.links,!0,null,!0,!0,!0),this.Mh(t,e.parts,!0,null,!0,!0,!0)):e instanceof ut?this.Mh(t,e.memberParts,!1,null,!0,!0,!0):this.Mh(t,e.iterator,!1,null,!0,!0,!0),t}get arrangementOrigin(){return this.zd}set arrangementOrigin(e){this.zd.equals(e)||(this.zd.a(e),this.invalidateLayout())}initialOrigin(e){const t=this.group;if(t!==null)if(t.hasPlaceholder()){const i=t.placeholder,s=i.getDocumentPoint(B.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(e);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=t.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(e),i}return e}}class $e{constructor(e){g(this,"ie");g(this,"co");g(this,"bn");g(this,"Py");g(this,"Sy");K.Ki(this),this.ie=e,this.co=new K,this.bn=new K,this.Py=new bt,this.Sy=new bt}clear(){if(this.co){const e=this.co.iterator;for(;e.next();)e.value.clear()}if(this.bn){const e=this.bn.iterator;for(;e.next();)e.value.clear()}this.co=new K,this.bn=new K,this.Py=new bt,this.Sy=new bt}toString(e){e===void 0&&(e=0);let t="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(e<=0)return t;if(t+=" vertexes: "+this.co.count+" edges: "+this.bn.count,e>1){const i=this.co.iterator;for(;i.next();){const n=i.value;t+=`
    `+n.toString(e-1)}const s=this.bn.iterator;for(;s.next();){const n=s.value;t+=`
    `+n.toString(e-1)}}return t}get layout(){return this.ie}set layout(e){e!==null&&(this.ie=e)}get vertexes(){return this.co}get edges(){return this.bn}createVertex(){return new Ze(this)}createEdge(){return new pi(this)}addParts(e,t,i){if(e===null)return;t===void 0&&(t=!1),b.s(t,"boolean",$e,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof st)return!n.isLinkLabel;if(n instanceof at){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=e.iterator;for(;s.next();){const n=s.value;if(n instanceof st&&!(t&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof ut&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof at)||t&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const h=this.findGroupVertex(o),a=this.findGroupVertex(r);this.linkVertexes(h,a,n)}}findGroupVertex(e){const t=e.findVisibleNode();if(t===null)return null;let i=this.findVertex(t);if(i!==null)return i;let s=t.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(e){this.co.add(e);const t=e.node;t!==null&&this.Py.set(t,e),e.network=this}addNode(e){let t=this.findVertex(e);return t===null&&(t=this.createVertex(),t.node=e,this.addVertex(t)),t}deleteVertex(e){if(this.TT(e)){let t=e.Ho;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}t=e.qo;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}}}TT(e){const t=this.co.delete(e);if(t){const i=e.node;i!==null&&this.Py.delete(i)}return t}deleteNode(e){const t=this.findVertex(e);t!==null&&this.deleteVertex(t)}findVertex(e){return this.Py.get(e)}addEdge(e){this.PN(e);const t=e.toVertex;t!==null&&t.addSourceEdge(e);const i=e.fromVertex;i!==null&&i.addDestinationEdge(e)}PN(e){this.bn.add(e);const t=e.link;t!==null&&this.findEdge(t)===null&&this.Sy.set(t,e),e.network=this}addLink(e){const t=e.fromNode,i=e.toNode;let s=this.findEdge(e);return s===null?(s=this.createEdge(),s.link=e,t!==null&&(s.fromVertex=this.addNode(t)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(t!==null?s.fromVertex=this.addNode(t):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(e){const t=e.toVertex;t!==null&&t.deleteSourceEdge(e);const i=e.fromVertex;i!==null&&i.deleteDestinationEdge(e),this.SN(e)}SN(e){const t=this.bn.delete(e);if(t){const i=e.link;i!==null&&this.Sy.delete(i)}return t}deleteLink(e){const t=this.findEdge(e);t!==null&&this.deleteEdge(t)}findEdge(e){return this.Sy.get(e)}linkVertexes(e,t,i){if(e===null||t===null)return null;if(e.network===this&&t.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=e,s.toVertex=t,this.addEdge(s),s}return null}reverseEdge(e){const t=e.fromVertex,i=e.toVertex;t===null||i===null||(t.deleteDestinationEdge(e),i.deleteSourceEdge(e),e.reverseEdge(),t.addSourceEdge(e),i.addDestinationEdge(e))}deleteSelfEdges(){const e=b.et(),t=this.bn.iterator;for(;t.next();){const s=t.value;s.fromVertex===s.toVertex&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);b.J(e)}deleteArtificialVertexes(){const e=b.et(),t=this.co.iterator;for(;t.next();){const o=t.value;o.node===null&&o.data===null&&e.push(o)}let i=e.length;for(let o=0;o<i;o++)this.deleteVertex(e[o]);const s=b.et(),n=this.bn.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);b.J(e),b.J(s)}deleteUselessEdges(){const e=b.et(),t=this.bn.iterator;for(;t.next();){const s=t.value;(s.fromVertex===null||s.toVertex===null)&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);b.J(e)}isSingleton(e){return!(e.Ho.count>0||e.qo.count>0)}splitIntoSubNetworks(e){e===void 0&&(e=!0),e&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const t=new J;let i=!0;for(;i;){i=!1;const s=this.co.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();t.add(o),this.zO(o,n),i=!0;break}}return t.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),t}zO(e,t){if(t===null)return;const i=new J;for(i.add(t);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===e)continue;this.TT(s),e.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==e&&(this.SN(o),e.PN(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==e&&(this.SN(o),e.PN(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const e=new K,t=this.co.iterator;for(;t.next();){const s=t.value;s.node&&e.add(s.node)}const i=this.bn.iterator;for(;i.next();){const s=i.value;s.link&&e.add(s.link)}return e}}class Ze{constructor(e){g(this,"ao");g(this,"_t");g(this,"Me");g(this,"Le");g(this,"je");g(this,"Ho");g(this,"qo");K.Ki(this),this.ao=e,this.Le=new z(0,0,10,10).u(),this.je=new S(5,5).u(),this._t=null,this.Me=null,this.Ho=new J,this.qo=new J}clear(){this._t=null,this.Me=null,this.Ho=new J,this.qo=new J}toString(e){e===void 0&&(e=0);let t="LayoutVertex#"+K.as(this);if(e>0&&(t+=this.node!==null?"("+this.node.toString()+")":"",e>1)){let i="",s=!0,n=this.Ho.iterator;for(;n.next();){const r=n.value;s?s=!1:i+=",",i+=r.toString(0)}let o="";for(s=!0,n=this.qo.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}t+=" sources: "+i+" destinations: "+o}return t}get fo(){return this.Ho.uC}get Wo(){return this.qo.uC}get data(){return this._t}set data(e){if(this._t=e,e!==null&&e.bounds){const t=e.bounds,i=t.x,s=t.y,n=t.width,o=t.height;this.je.i(n/2,o/2),this.Le.i(i,s,n,o)}}get node(){return this.Me}set node(e){if(this.Me!==e){if(this.Me=e,e===null)return;e.ensureBounds();const t=this.network.layout,i=z.l(),s=t.getLayoutBounds(e,i);let n=s.x,o=s.y;const r=s.width,h=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Le.i(n,o,r,h),z.e(i),!(e instanceof ut)){const a=e.locationObject.getDocumentPoint(B.Center);if(a.isReal()){this.je.i(a.x-n,a.y-o);return}}this.je.i(r/2,h/2)}}get bounds(){return this.Le}set bounds(e){this.Le.equals(e)||this.Le.a(e)}get focus(){return this.je}set focus(e){this.je.equals(e)||this.je.a(e)}get centerX(){return this.Le.x+this.je.x}set centerX(e){const t=this.Le;t.x+this.je.x!==e&&(t.Pt(),t.x=e-this.je.x,t.u())}get centerY(){return this.Le.y+this.je.y}set centerY(e){const t=this.Le;t.y+this.je.y!==e&&(t.Pt(),t.y=e-this.je.y,t.u())}get focusX(){return this.je.x}set focusX(e){const t=this.je;t.x!==e&&(t.Pt(),t.x=e,t.u())}get focusY(){return this.je.y}set focusY(e){const t=this.je;t.y!==e&&(t.Pt(),t.y=e,t.u())}get x(){return this.Le.x}set x(e){const t=this.Le;t.x!==e&&(t.Pt(),t.x=e,t.u())}get y(){return this.Le.y}set y(e){const t=this.Le;t.y!==e&&(t.Pt(),t.y=e,t.u())}get width(){return this.Le.width}set width(e){const t=this.Le;t.width!==e&&(t.Pt(),t.width=e,t.u())}get height(){return this.Le.height}set height(e){const t=this.Le;t.height!==e&&(t.Pt(),t.height=e,t.u())}commit(){const e=this._t;if(e!==null){const i=this.bounds,s=e.bounds;b.G(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):e.bounds=i.copy();return}const t=this.node;if(t!==null){const i=this.bounds;if(!(t instanceof ut)){const s=z.l();t.ensureBounds();const n=this.network.layout.getLayoutBounds(t,s),o=t.locationObject.getDocumentPoint(B.Center);if(n.isReal()&&o.isReal()){t.moveTo(i.x+this.focusX-(o.x-n.x)+t.margin.left,i.y+this.focusY-(o.y-n.y+t.margin.top)),z.e(s);return}z.e(s)}t.moveTo(i.x+t.margin.left,i.y+t.margin.top)}}addSourceEdge(e){e!==null&&(this.Ho.has(e)||this.Ho.add(e))}deleteSourceEdge(e){e!==null&&this.Ho.delete(e)}addDestinationEdge(e){e!==null&&(this.qo.has(e)||this.qo.add(e))}deleteDestinationEdge(e){e!==null&&this.qo.delete(e)}get network(){return this.ao}set network(e){this.ao=e}get sourceVertexes(){const e=new K,t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}return e.iterator}get destinationVertexes(){const e=new K,t=this.destinationEdges;for(;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get vertexes(){const e=new K;let t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}for(t=this.destinationEdges;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get sourceEdges(){return this.Ho.iterator}get destinationEdges(){return this.qo.iterator}get edges(){const e=new J;let t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i)}for(t=this.destinationEdges;t.next();){const i=t.value;e.add(i)}return e.iterator}get edgesCount(){return this.Ho.count+this.qo.count}static standardComparer(e,t){const i=e.Me,s=t.Me;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(e,t){if(e!==null)if(t!==null){const i=e.Me,s=t.Me;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),h=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let a=0;for(;a<r.length;a++)if(h[a]!==""&&h[a]!==void 0){const l=parseFloat(r[a]),u=parseFloat(h[a]);if(isNaN(l))if(isNaN(u)){if(r[a].localeCompare(h[a])!==0)return r[a].localeCompare(h[a]);continue}else return 1;else{if(isNaN(u))return-1;if(l-u!==0)return l-u;continue}}else{if(r[a]==="")continue;return 1}return h[a]!==""&&h[a]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return t!==null?-1:0}}class pi{constructor(e){g(this,"ao");g(this,"_t");g(this,"Ke");g(this,"He");g(this,"qe");K.Ki(this),this.ao=e,this._t=null,this.Ke=null,this.He=null,this.qe=null}clear(){this._t=null,this.Ke=null,this.He=null,this.qe=null}toString(e){e===void 0&&(e=0);let t="LayoutEdge#"+K.as(this);return e>0&&(t+=this.Ke!==null?"("+this.Ke.toString()+")":"",e>1&&(t+=" "+(this.He?this.He.toString():"null")+" --> "+(this.qe?this.qe.toString():"null"))),t}reverseEdge(){const e=this.He;this.He=this.qe,this.qe=e}commit(){}getOtherVertex(e){return this.qe===e?this.He:this.He===e?this.qe:null}get network(){return this.ao}set network(e){this.ao=e}get data(){return this._t}set data(e){this._t!==e&&(this._t=e)}get link(){return this.Ke}set link(e){this.Ke!==e&&(this.Ke=e)}get fromVertex(){return this.He}set fromVertex(e){this.He!==e&&(this.He=e)}get toVertex(){return this.qe}set toVertex(e){this.qe!==e&&(this.qe=e)}}var ps=(w=>(w[w.Position=0]="Position",w[w.Location=1]="Location",w))(ps||{}),ys=(w=>(w[w.LeftToRight=10]="LeftToRight",w[w.RightToLeft=11]="RightToLeft",w))(ys||{}),xs=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w))(xs||{});const Fe=class Fe extends ne{constructor(t){super();g(this,"Gd");g(this,"Kd");g(this,"Po");g(this,"kn");g(this,"hi");g(this,"Xi");g(this,"pe");g(this,"ye");this.isViewportSized=!0,this.Gd=NaN,this.Kd=NaN,this.Po=new ot(NaN,NaN).u(),this.kn=new ot(10,10).u(),this.hi=1,this.Xi=10,this.pe=22,this.ye=Fe.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Gd=this.Gd,t.Kd=this.Kd,t.Po.a(this.Po),t.kn.a(this.kn),t.hi=this.hi,t.Xi=this.Xi,t.pe=this.pe,t.ye=this.ye}oi(t){t in xs?this.sorting=t:t in ys?this.arrangement=t:t in ps?this.alignment=t:super.oi(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),s=this.diagram,n=i.copy().iterator;for(;n.next();){const m=n.value;if(m.Cl()&&(m.fromNode!==null||m.toNode!==null)){i.delete(m);continue}if(m.ensureBounds(),m instanceof ut){const p=m.memberParts;for(;p.next();){const y=p.value;i.delete(y)}}}const o=i.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let r=this.wrappingColumn;isNaN(r)&&(r=0);let h=this.wrappingWidth;if(isNaN(h)&&s!==null){const m=s.viewportBounds,p=s.padding;h=Math.max(m.width-p.left-p.right,0)}else h=Math.max(this.wrappingWidth,0);r<=0&&h<=0&&(r=1);let a=this.spacing.width;isFinite(a)||(a=0);let l=this.spacing.height;isFinite(l)||(l=0),s!==null&&s.startTransaction("Layout");const u=[];switch(this.alignment){case 0:this.XO(o,h,r,a,l,u);break;case 1:this.YO(o,h,r,a,l,u);break}let c=0,d=0,f=0;for(let m=0;m<u.length;m++){const p=u[m];c=Math.min(c,p.x),d=Math.min(d,p.y),f=Math.max(f,p.x+p.width)}this.arrangement===11?this.commitLayers(u,new S(c+a/2-(f+c),d-l/2)):this.commitLayers(u,new S(c-a/2,d-l/2)),s!==null&&s.commitTransaction("Layout"),this.isValidLayout=!0}XO(t,i,s,n,o,r){const h=z.l();let a=Math.max(this.cellSize.width,1);if(!isFinite(a)){a=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,h);a=Math.max(a,k.width)}}a+=n,a=Math.max(a,1);let l=Math.max(this.cellSize.height,1);if(!isFinite(l)){l=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,h);l=Math.max(l,k.height)}}l+=o,l=Math.max(l,1);const u=this.arrangement,c=this.arrangementOrigin.x,d=this.arrangementOrigin.y;let f=c,m=d,p=0,y=0;for(let x=0;x<t.length;x++){const P=t[x],k=this.getLayoutBounds(P,h),v=Math.ceil((k.width+n)/a),N=Math.ceil((k.height+o)/l),M=v*a,C=N*l;let F=0;switch(u){case 11:F=Math.abs(f-k.width);break;default:F=f+k.width;break}(s>0&&p>s-1||i>0&&p>0&&F-c>i)&&(r.push(new z(0,m,i+n,y)),p=0,f=c,m+=y,y=0),y=Math.max(y,C);let T=0;switch(u){case 11:T=-k.width;break;default:T=0;break}switch(P.moveTo(f+T+P.margin.left,m+P.margin.top),u){case 11:f-=M;break;default:f+=M;break}p++}r.push(new z(0,m,i+n,y)),z.e(h)}YO(t,i,s,n,o,r){const h=z.l();let a=Math.max(this.cellSize.width,1),l=0,u=0,c=0;const d=S.l();for(let T=0;T<t.length;T++){const L=t[T],D=this.getLayoutBounds(L,h),O=L.getRelativePoint(L.locationObject,L.locationSpot,d);l=Math.max(l,O.x),u=Math.max(u,D.width-O.x),c=Math.max(c,O.y)}const f=this.arrangement;switch(f){case 11:l+=n;break;default:u+=n;break}isFinite(a)?a=Math.max(a+n,1):a=Math.max(l+u,1);const m=this.arrangementOrigin.x,p=this.arrangementOrigin.y;let y=m,x=p,P=0;i>=l&&(i-=l);let k=0,v=0;const N=Math.max(this.cellSize.height,1);c=0;let M=0,C=!0;const F=S.l();for(let T=0;T<t.length;T++){const L=t[T],D=this.getLayoutBounds(L,h),O=L.getRelativePoint(L.locationObject,L.locationSpot,d);if(P>0)switch(f){case 11:{let I=(y-m-(D.width-O.x))/a;A.z(Math.round(I),I)?I=Math.round(I):I=Math.floor(I),y=I*a+m;break}default:{let I=(y-m+O.x)/a;A.z(Math.round(I),I)?I=Math.round(I):I=Math.ceil(I),y=I*a+m;break}}else switch(f){case 11:k=y+O.x+D.width;break;default:k=y-O.x;break}let R=0;switch(f){case 11:R=-(y+O.x)+k;break;default:R=y+D.width-O.x-k;break}if(s>0&&P>s-1||i>0&&P>0&&R>i){r.push(new z(0,C?x-c:x,i+n,M+c+o));for(let I=0;I<P&&T!==P;I++){const X=t[T-P+I],j=X.getRelativePoint(X.locationObject,X.locationSpot,F);X.moveTo(X.position.x,X.position.y+c-j.y)}M+=o,C?x+=M:x+=M+c,c=0,M=0,P=0,y=m,C=!1}switch(y===m&&(f===11?v=Math.max(v,D.width-O.x):v=Math.min(v,-O.x)),c=Math.max(c,O.y),M=Math.max(M,D.height-O.y),isFinite(N)&&(M=Math.max(M,Math.max(D.height,N)-O.y)),C?L.moveTo(y-O.x,x-O.y):L.moveTo(y-O.x,x),f){case 11:y-=O.x+n;break;default:y+=D.width-O.x+n;break}P++}if(r.push(new z(0,x,i+n,(C?M:M+c)+o)),t.length!==P)for(let T=0;T<P;T++){const L=t[t.length-P+T],D=L.getRelativePoint(L.locationObject,L.locationSpot,d);L.moveTo(L.position.x,L.position.y+c-D.y)}if(S.e(d),S.e(F),f===11)for(let T=0;T<r.length;T++){const L=r[T];L.width+=v,L.x-=v}else for(let T=0;T<r.length;T++){const L=r[T];L.x>v&&(L.width+=L.x-v,L.x=v)}z.e(h)}commitLayers(t,i){}get wrappingWidth(){return this.Gd}set wrappingWidth(t){this.Gd!==t&&(t>0||isNaN(t))&&(this.Gd=t,this.isViewportSized=isNaN(t),this.invalidateLayout())}get wrappingColumn(){return this.Kd}set wrappingColumn(t){this.Kd!==t&&(t>0||isNaN(t))&&(this.Kd=t,this.invalidateLayout())}get cellSize(){return this.Po}set cellSize(t){this.Po.equals(t)||(this.Po.a(t),this.invalidateLayout())}get spacing(){return this.kn}set spacing(t){this.kn.equals(t)||(this.kn.a(t),this.invalidateLayout())}get alignment(){return this.hi}set alignment(t){this.hi!==t&&(t===1||t===0)&&(this.hi=t,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===10||t===11)&&(this.Xi=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(t===20||t===21||t===22||t===23)&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}static standardComparer(t,i){const s=t.text,n=i.text;return s<n?-1:s>n?1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const s=t.text.toLocaleLowerCase(),n=i.text.toLocaleLowerCase(),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let h=0;for(;h<o.length;h++)if(r[h]!==""&&r[h]!==void 0){const a=parseFloat(o[h]),l=parseFloat(r[h]);if(isNaN(a))if(isNaN(l)){if(o[h].localeCompare(r[h])!==0)return o[h].localeCompare(r[h]);continue}else return 1;else{if(isNaN(l))return-1;if(a-l!==0)return a-l;continue}}else{if(o[h]==="")continue;return 1}return r[h]!==""&&r[h]!==void 0?-1:0}else return 1;else return i!==null?-1:0}};g(Fe,"Position",0),g(Fe,"Location",1),g(Fe,"LeftToRight",10),g(Fe,"RightToLeft",11),g(Fe,"Forward",20),g(Fe,"Reverse",21),g(Fe,"Ascending",22),g(Fe,"Descending",23);let Yi=Fe;const Oe=class Oe{constructor(){g(this,"jd");g(this,"Hs");g(this,"Ct");g(this,"uo");g(this,"Hd");g(this,"qd");g(this,"N");g(this,"MN");this.jd=new K,this.Hs=new K,this.Ct=new K,this.uo=new bt,this.Hd=new bt,this.qd=new bt,this.N=null,this.MN=!1}clear(){this.jd.clear(),this.Hs.clear(),this.Ct.clear(),this.uo.clear(),this.Hd.clear(),this.qd.clear()}Mo(e){this.N=e}Jh(e){if(e instanceof st){if(this.jd.add(e),e instanceof ut){const i=e.containingGroup;i===null?this.diagram.zr.add(e):i.ca.add(e);const s=e.layout;s!==null&&(s.diagram=this.diagram)}}else e instanceof at?(this.Hs.add(e),e.isAvoiding&&(this.diagram.Vm=!0)):e instanceof yt||this.Ct.add(e);const t=e.data;t!==null&&(e instanceof yt||(e instanceof at?this.DT(t,e):this.uo.set(t,e)))}te(e){if(e.clearAdornments(),e instanceof st){if(this.jd.delete(e),e instanceof ut){const i=e.containingGroup;i===null?this.diagram.zr.delete(e):i.ca.delete(e);const s=e.layout;s!==null&&(s.diagram=null)}}else e instanceof at?this.Hs.delete(e):e instanceof yt||this.Ct.delete(e);const t=e.data;t!==null&&(e instanceof yt||(e instanceof at?this.FT(t,e):this.uo.delete(t)))}DT(e,t){this.Hd.set(e,t)}FT(e,t){this.Hd.delete(e)}rebuildParts(){const e=this.diagram;if(e===null)return;const t=e.nodeTemplateMap.iterator;for(;t.next();){const d=t.value,f=t.key;(!d.ke()||d instanceof ut)&&b.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${f}" must be a Node or a simple Part, not a Group or Link: ${d}`)}const i=e.groupTemplateMap.iterator;for(;i.next();){const d=i.value,f=i.key;d instanceof ut||b.o(`Invalid group template in Diagram.groupTemplateMap: template for "${f}" must be a Group, not a normal Node or Link: ${d}`)}const s=e.linkTemplateMap.iterator;for(;s.next();){const d=s.value,f=s.key;d instanceof at||b.o(`Invalid link template in Diagram.linkTemplateMap: template for "${f}" must be a Link, not a normal Node or simple Part: ${d}`)}const n=b.et(),o=e.selection.iterator;for(;o.next();){const d=o.value.data;d&&n.push(d)}const r=b.et(),h=e.highlighteds.iterator;for(;h.next();){const d=h.value.data;d&&r.push(d)}const a=b.et(),l=this.nodes.iterator;for(;l.next();){const d=l.value;d.data!==null&&(a.push(d.data),a.push(d.location))}const u=this.links.iterator;for(;u.next();){const d=u.value;d.data!==null&&(a.push(d.data),a.push(d.location))}const c=this.parts.iterator;for(;c.next();){const d=c.value;d.data!==null&&(a.push(d.data),a.push(d.location))}this.RT(),this.zM();for(let d=0;d<n.length;d++){const f=this.findPartForData(n[d]);f!==null&&(f.isSelected=!0)}for(let d=0;d<r.length;d++){const f=this.findPartForData(r[d]);f!==null&&(f.isHighlighted=!0)}for(let d=0;d<a.length;d+=2){const f=this.findPartForData(a[d]);f!==null&&(f.location=a[d+1])}b.J(n),b.J(r),b.J(a)}zM(){const e=this.diagram.model;this.My(e.nodeDataArray)}My(e,t){const i=this.diagram.model;e.forEach(s=>{i.containsNodeData(s)&&this.vT(s,!1)}),e.forEach(s=>{i.containsNodeData(s)&&this.R1(s)}),t!==!1&&this.diagram.Cb(!1)}vT(e,t){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.uo.has(e))return null;t===void 0&&(t=!0);const i=this.GO(e);return i!==null&&t&&this.R1(e),i}GO(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.uo.has(e))return null;const t=this.KO(e),i=this.findTemplateForNodeData(e,t);if(i!==null){i.Et();const s=i.copy();if(s!==null){const n=this.diagram.fe;return this.diagram.fe=!0,s.zo=t,s._t=e,this.addsToTemporaryLayer&&(s.nl="Tool"),this.diagram.add(s),s._t=null,s.data=e,this.diagram.fe=n,s}}return null}insertLink(e,t,i,s){return null}R1(e){}KO(e){return this.diagram.model.getCategoryForNodeData(e)}findTemplateForNodeData(e,t){const i=this.diagram,s=i.model,n=s.Hc()&&s.isGroupForData(e);let o=null;return n?(o=i.groupTemplateMap.get(t),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(Oe.IT||(Oe.IT=!0,b.ni('No Group template found for category "'+t+'"'),b.ni("  Using default group template")),o=i.yM))):(o=i.nodeTemplateMap.get(t),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(Oe.OT||(Oe.OT=!0,b.ni('No Node template found for category "'+t+'"'),b.ni("  Using default node template")),o=i.gM))),o}getLinkCategoryForData(e){return""}setLinkCategoryForData(e,t){}setFromNodeForLink(e,t,i){}setToNodeForLink(e,t,i){}findLinkTemplateForCategory(e){const t=this.diagram;let i=t.linkTemplateMap.get(e);return i===null&&(i=t.linkTemplateMap.get(""),i===null&&(Oe.ET||(Oe.ET=!0,b.ni('No Link template found for category "'+e+'"'),b.ni("  Using default link template")),i=t.mM)),i}vv(e,t,i){e instanceof at?(t!==null&&this.FT(t,e),i!==null&&this.DT(i,e)):e instanceof Lt&&(t!==null&&this.uo.delete(t),i!==null&&this.uo.set(i,e))}RT(){const e=this.diagram.model;this.NN(e.nodeDataArray)}NN(e){e.forEach(t=>{this.v1(t)})}v1(e){const t=this.findPartForData(e);t!==null&&(this.diagram.UM(t,!1),this.CN(t))}CN(e){}pN(e){}findPartForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);return t!==null?this.uo.get(t):null}findNodeForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);if(t===null)return null;const i=this.uo.get(t);return i instanceof st?i:null}findLinkForKey(e){return null}findPartForData(e){if(e===null)return null;let t=this.uo.get(e);return t!==null||(t=this.Hd.get(e)),t}findNodeForData(e){if(e===null)return null;const t=this.uo.get(e);return t instanceof st?t:null}findLinkForData(e,t){return e===null?null:this.Hd.get(e)}findNodesByExample(...e){const t=new K,i=this.jd.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(b.G(r)&&this.LN(n,r)){t.add(s);break}}}return t.iterator}findLinksByExample(...e){const t=new K,i=this.Hs.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(b.G(r)&&this.LN(n,r)){t.add(s);break}}}return t.iterator}LN(e,t){for(const i in t){const s=e[i],n=t[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let h=0;h<o.length;h++){const a=o[h],l=r[h];if(l!==void 0&&!this.UT(a,l))return!1}}else if(!this.UT(s,n))return!1}return!0}UT(e,t){if(b.it(t)){if(!t(e))return!1}else if(t instanceof RegExp){if(!e||!t.test(e.toString()))return!1}else if(b.G(e)&&b.G(t)){if(!this.LN(e,t))return!1}else if(e!==t)return!1;return!0}doModelDataChanged(e){if(e.model===this.diagram.model&&this.diagram.X){this.diagram.X=!1;try{const t=e.change;e.modelChange===""&&e.object!==null&&t===2&&this.Ny(e.object,e.propertyName)}finally{this.diagram.X=!0}}}doModelChanged(e){const t=this.diagram;if(!t||e.model!==t.model)return;const i=e.change;if(t.IR(e),!!t.X){t.X=!1;try{const s=e.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=e.object;if(n!==null){const o=this.findPartForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}}else if(s==="nodeDataArray"){const n=e.oldValue;this.NN(n);const o=e.newValue;this.My(o)}t.isModified=!0}else if(i===3){const n=e.newValue;s==="nodeDataArray"&&b.G(n)&&this.vT(n),t.isModified=!0}else if(i===4){const n=e.oldValue;s==="nodeDataArray"&&b.G(n)&&this.v1(n),t.isModified=!0}else i===1&&(s==="SourceChanged"?e.object!==null?this.Ny(e.object,e.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()):o!==null&&this.Ny(o,n),t.isModified=!0}else(i===3||i===4)&&(this.jO(e,t.model),t.isModified=!0)}finally{t.X=!0}}}updateAllTargetBindings(e){e===void 0&&(e="");let t=this.parts.iterator;for(;t.next();)t.value.updateTargetBindings(e);for(t=this.nodes.iterator;t.next();)t.value.updateTargetBindings(e);for(t=this.links.iterator;t.next();)t.value.updateTargetBindings(e)}updateAllThemeBindings(){let e=this.parts.iterator;for(;e.next();)e.value.Do();for(e=this.nodes.iterator;e.next();)e.value.Do();for(e=this.links.iterator;e.next();)e.value.Do()}updateAllRelationshipsFromData(){const e=this.diagram.model,t=new K,i=e.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o];t.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),s.forEach(o=>e.BT(o,!1));for(let o=0;o<i.length;o++){const r=i[o];this.findPartForData(r)===null&&e.VT(r,!1)}this.zT();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}zT(){}updateRelationshipsFromData(e){}Ny(e,t){if(typeof t=="string"){const i=this.findPartForData(e);if(i!==null)i.updateTargetBindings(t);else{const s=this.HO(e);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(t);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(t)}b.J(s)}}e===this.diagram.model.modelData&&this.updateAllTargetBindings(t)}}HO(e){let t=null;const i=this.qd.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const o=s[n].findItemPanelForData(e);o!==null&&(t===null&&(t=b.et()),t.push(o))}if(t!==null)break}return t}AN(e){return this.qd.get(e)}jO(e,t){const i=e.object;if(!Array.isArray(i))return;const s=e.change===3,n=s?e.newParam:e.oldParam,o=s?e.newValue:e.oldValue,r=this.AN(i);if(Array.isArray(r))for(let h=0;h<r.length;h++){const a=r[h];s?a.e1(o,n,!0):a.Iv(n)}}IM(e,t){t!==null&&e.Gr(s=>t.GL(s));const i=e.wh;if(Array.isArray(i)){const s=this.AN(i);if(s===null)this.qd.set(i,[e]);else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}}EM(e,t){e.Gr(s=>t.UR(s));const i=e.wh;if(Array.isArray(i)){const s=this.AN(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&this.qd.delete(i);return}}}}copyParts(e,t,i){i===void 0&&(i=!1);const s=new bt;if(Array.isArray(e))for(let o=0;o<e.length;o++)this.O1(e[o],t,s,i);else{const o=e.iterator;for(;o.next();)this.O1(o.value,t,s,i)}if(t!==null){const o=t.model,r=t.o0().dragsLink,h=new K,a=new bt,l=s.iterator;for(;l.next();){const u=l.value;if(u instanceof at)!r&&(u.fromNode===null||u.toNode===null)&&h.add(u);else if(u instanceof st&&u.data!==null){if(o.pm()){const c=u,d=l.key,f=d.findTreeParentNode();if(f!==null){const m=s.get(f);if(m!==null){o.setParentKeyForNodeData(c.data,o.getKeyForNodeData(m.data));const p=t.findLinkForData(c.data),y=d.findTreeParentLink();y!==null&&p!==null&&a.set(y,p)}}}else if(o.Mb()){const c=u,d=l.key,f=o.isRelatedKeysPathTo?d.findNodesOutOf():d.findNodesInto();for(;f.next();){const m=f.value,p=s.get(m);if(p!==null){o.addRelatedKeyForNodeData(c.data,p.key);const y=t.partManager.findLinkForData(c.data,p.key),x=this.findLinkForData(d.data,m.key);x!==null&&y!==null&&a.set(x,y)}else o.removeRelatedKeyForNodeData(c.data,m.key)}}}}if(h.count>0&&t.removeParts(h,!1),a.count>0){const u=a.iterator;for(;u.next();){const c=u.key,d=u.value;s.set(c,d)}}}if(t!==null&&this.diagram!==null){const o=t.model,r=o.afterCopyFunction;if(r!==null){const h=new bt;s.each(l=>{l.key.data!==null&&h.set(l.key.data,l.value.data)});const a=this.diagram.model;r(h,o,a)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}O1(e,t,i,s){if(e===null||s&&!e.canCopy())return null;if(i.has(e))return i.get(e);const n=this.TN(e,t);if(!(n instanceof Lt))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(e,n),e instanceof st){const o=e.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===e){const h=i.get(r);h!==null&&(h.fromNode=n)}if(r.toNode===e){const h=i.get(r);h!==null&&(h.toNode=n)}}if(e instanceof ut&&n instanceof ut){const r=e.memberParts;for(;r.next();){const h=r.value,a=this.O1(h,t,i,s);a instanceof at||a!==null&&(a.containingGroup=n)}}}else if(e instanceof at&&n instanceof at){const o=e.fromNode;if(o!==null){const a=i.get(o);a!==null&&(n.fromNode=a)}const r=e.toNode;if(r!==null){const a=i.get(r);a!==null&&(n.toNode=a)}const h=e.labelNodes;for(;h.next();){const a=h.value,l=this.O1(a,t,i,s);l!==null&&l instanceof st&&(l.labeledLink=n)}}return n}TN(e,t){let i=null;const s=e.data;if(s!==null&&t!==null){const n=t.model;if(!(e instanceof at)){const o=n.copyNodeData(s);b.G(o)&&(n.addNodeData(o),i=t.findPartForData(o))}}else if(e.Et(),i=e.copy(),i!==null){const n=this.diagram;if(t!==null)t.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;i instanceof at||(r=o.copyNodeData(s)),b.G(r)&&(i.data=r)}}return i}get nodes(){return this.jd}get links(){return this.Hs}get parts(){return this.Ct}get diagram(){return this.N}get addsToTemporaryLayer(){return this.MN}set addsToTemporaryLayer(e){this.MN=e}};g(Oe,"OT",!1),g(Oe,"IT",!1),g(Oe,"ET",!1);let ri=Oe;class Un extends ri{zM(){const e=this.diagram.model;this.My(e.nodeDataArray),this.XT(e.linkDataArray)}My(e){super.My(e,!1);const t=this.links.iterator;for(;t.next();)t.value.Pd();this.diagram.Cb(!1)}XT(e){e.forEach(t=>{this.YT(t)}),this.diagram.Cb(!1)}YT(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(e))return null;const t=this.getLinkCategoryForData(e),i=this.findLinkTemplateForCategory(t);if(i!==null){i.Et();const s=i.copy();if(s!==null){const n=this.diagram.fe;this.diagram.fe=!0,s.zo=t,s._t=e;const o=this.diagram.model,r=o.I1(e,!0);r!==""&&(s.fromPortId=r);const h=o.Ae(e,!0);if(h!==void 0){const c=this.findNodeForKey(h);c instanceof st&&(s.fromNode=c)}const a=o.I1(e,!1);a!==""&&(s.toPortId=a);const l=o.Ae(e,!1);if(l!==void 0){const c=this.findNodeForKey(l);c instanceof st&&(s.toNode=c)}const u=o.getLabelKeysForLinkData(e);return Array.isArray(u)&&u.forEach(c=>{const d=this.findNodeForKey(c);d!==null&&(d.labeledLink=s)}),this.addsToTemporaryLayer&&(s.nl="Tool"),this.diagram.add(s),s._t=null,s.data=e,this.diagram.fe=n,s}}return null}RT(){const e=this.diagram.model;this.GT(e.linkDataArray),this.NN(e.nodeDataArray)}GT(e){e.forEach(t=>{this.v1(t)})}getLinkCategoryForData(e){return this.diagram.model.getCategoryForLinkData(e)}setLinkCategoryForData(e,t){return this.diagram.model.setCategoryForLinkData(e,t)}setFromNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setFromKeyForLinkData(e.data,i.getKeyForNodeData(s))}setToNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setToKeyForLinkData(e.data,i.getKeyForNodeData(s))}pN(e){this.diagram.model.removeLinkData(e.data)}findPartForKey(e){const t=super.findPartForKey(e);if(t===null){const i=this.diagram.model.findLinkDataForKey(e);if(i!==null)return this.findLinkForData(i)}return t}findLinkForKey(e){if(e==null)return null;const t=this.diagram.model.findLinkDataForKey(e);return t!==null?this.findLinkForData(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.X){t.X=!1;try{const s=e.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,h=this.findNodeForKey(r);o.fromNode=h}}else if(s==="linkToKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,h=this.findNodeForKey(r);o.toNode=h}}else if(s==="linkFromPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=e.object,o=this.findPartForData(n);if(o!==null){const r=e.newValue;if(r!==void 0){const h=this.findNodeForKey(r);h instanceof ut?o.containingGroup=h:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.oldValue,h=e.newValue;Array.isArray(r)&&r.forEach(a=>{if(h.indexOf(a)>=0)return;const l=this.findNodeForKey(a);l!==null&&(l.labeledLink=null)}),Array.isArray(h)&&h.forEach(a=>{const l=this.findNodeForKey(a);l!==null&&(l.labeledLink=o)})}}else if(s==="linkCategory"){const n=e.object,o=this.findLinkForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=e.oldValue;this.GT(n);const o=e.newValue;this.XT(o)}t.isModified=!0}else if(i===3){const n=e.newValue;if(s==="linkDataArray"&&b.G(n))this.YT(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=e.object,r=this.findLinkForData(o),h=this.findNodeForKey(n);r!==null&&h!==null&&(h.labeledLink=r)}t.isModified=!0}else if(i===4){const n=e.oldValue;if(s==="linkDataArray"&&b.G(n))this.v1(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}t.isModified=!0}}else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0}}finally{t.X=!0}}}zT(){const e=this.diagram.model,t=new K,i=e.linkDataArray;i.forEach(n=>{t.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!t.has(n.data)&&s.push(n.data)}),s.forEach(n=>{e.KT(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&e.jT(n,!1)})}updateRelationshipsFromData(e){const t=e.data;if(t===null)return;const i=e.diagram;if(i===null)return;const s=i.model;if(e instanceof at){let n=s.Ae(t,!0),o=i.findNodeForKey(n);e.fromNode=o,n=s.Ae(t,!1),o=i.findNodeForKey(n),e.toNode=o;const r=s.getLabelKeysForLinkData(t);if(r.length>0||e.labelNodes.count>0){if(r.length===1&&e.labelNodes.count===1){const c=r[0],d=e.labelNodes.first();if(s.getKeyForNodeData(d.data)===c)return}const h=new K().addAll(r),a=new K;e.labelNodes.each(c=>{if(c.data!==null){const d=s.getKeyForNodeData(c.data);d!==void 0&&a.add(d)}});const l=a.copy();l.removeAll(h);const u=h.copy();if(u.removeAll(a),l.count>0||u.count>0){const c=e;l.each(d=>{const f=i.findNodeForKey(d);f!==null&&f.labeledLink===c&&(f.labeledLink=null)}),u.each(d=>{const f=i.findNodeForKey(d);f!==null&&f.labeledLink!==c&&(f.labeledLink=c)})}}}else if(!(e instanceof yt)){const n=s.getGroupKeyForNodeData(t),o=i.findPartForKey(n);(o===null||o instanceof ut)&&(e.containingGroup=o)}}R1(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(i!==void 0){const s=t.Cy(i),n=this.findPartForData(e);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const h=r.value;if(t.containsNodeData(h)){if(n instanceof ut&&t.getGroupKeyForNodeData(h)===i){const a=this.findPartForData(h);a!==null&&(a.containingGroup=n)}}else{const a=this.findLinkForData(h);if(a!==null&&n instanceof st){t.Ae(h,!0)===i&&(a.fromNode=n),t.Ae(h,!1)===i&&(a.toNode=n);const l=t.getLabelKeysForLinkData(h);Array.isArray(l)&&l.some(u=>u===i?(n.labeledLink=a,!0):!1)}}}t.Ws(i)}const o=t.getGroupKeyForNodeData(e);if(o!==void 0){const r=this.findNodeForKey(o);r instanceof ut&&(n.containingGroup=r)}}}CN(e){const t=this.diagram.model;if(e instanceof st){const i=t.getKeyForNodeData(e.data);if(i!==void 0){const s=e.linksConnected;for(;s.next();){const n=s.value;t.Js(i,n.data)}if(e.isLinkLabel){const n=e.labeledLink;n!==null&&t.Js(i,n.data)}if(e instanceof ut){const n=e.memberParts;for(;n.next();){const o=n.value.data;t.containsNodeData(o)&&t.Js(i,o)}}}}}TN(e,t){let i=super.TN(e,t);if(e instanceof at){const s=e.data;if(s!==null&&t!==null){const n=t.model,o=n.copyLinkData(s);b.G(o)&&(n.addLinkData(o),i=t.findLinkForData(o))}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);b.G(o)&&(i.data=o)}}}return i}insertLink(e,t,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let h="";e!==null&&(t===null&&(t=e),h=t.portId,h===null&&(h=""));let a="";i!==null&&(s===null&&(s=i),a=s.portId,a===null&&(a=""));const l=r.archetypeLinkData;if(l instanceof at){l.Et();const u=l.copy();if(u!==null){u.fromNode=e,u.fromPortId=h,u.toNode=i,u.toPortId=a,n.add(u);const c=r.archetypeLabelNodeData;if(c instanceof st){c.Et();const d=c.copy();d!==null&&(d.labeledLink=u,n.add(d))}return u}}else if(l!==null){const u=o.copyLinkData(l);if(b.G(u)){e!==null&&o.Wd(u,o.getKeyForNodeData(e.data),!0),o.Jd(u,h,!0),i!==null&&o.Wd(u,o.getKeyForNodeData(i.data),!1),o.Jd(u,a,!1),o.addLinkData(u);const c=r.archetypeLabelNodeData;if(c!==null&&!(c instanceof st)){const d=o.copyNodeData(c);if(b.G(d)){o.addNodeData(d);const f=o.getKeyForNodeData(d);f!==void 0&&o.addLabelKeyForLinkData(u,f)}}return n.findLinkForData(u)}}return null}}class qn extends ri{constructor(){super(...arguments);g(this,"Nh",null)}E1(t,i){if(t===null||i===null||i.findTreeParentLink()!==null)return null;const s=this.diagram.toolManager.findTool("Linking");let n=t,o=i;if(this.diagram.isTreePathToChildren){if(s!==null&&s.yu(n,o,null,!0))return null}else if(n=i,o=t,s!==null&&s.yu(n,o,null,!0))return null;const r=this.getLinkCategoryForData(i.data),h=this.findLinkTemplateForCategory(r);if(h!==null){h.Et();const a=h.copy();if(a!==null){const l=this.diagram.fe;return this.diagram.fe=!0,a.zo=r,a._t=i.data,a.fromNode=n,a.toNode=o,this.diagram.add(a),a._t=null,a.data=i.data,this.diagram.fe=l,a}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,i){this.diagram.model.setParentLinkCategoryForNodeData(t,i)}setFromNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren)n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o));else{const r=this.Nh;this.Nh=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const h=t.toNode!==null?t.toNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(h)),this.Nh=r}}setToNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren){const r=this.Nh;this.Nh=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const h=t.fromNode!==null?t.fromNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(h)),this.Nh=r}else n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o))}pN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.findLinkForData(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const s=t.change;if(i.X){i.X=!1;try{const n=t.modelChange;if(n!==""){if(s===2){if(n==="nodeParentKey"){const o=t.object,r=t.newValue,h=this.findNodeForKey(r),a=this.findNodeForData(o);if(this.Nh!==null)h!==null&&(this.Nh.data=o,this.Nh.category=this.getLinkCategoryForData(o));else if(a!==null){const l=a.findTreeParentLink();l!==null?h===null?i.remove(l):i.isTreePathToChildren?l.fromNode=h:l.toNode=h:this.E1(h,a)}}else if(n==="parentLinkCategory"){const o=t.object,r=this.findNodeForData(o),h=t.newValue;if(r!==null&&typeof h=="string"){const a=r.findTreeParentLink();a!==null&&(a.category=h)}}i.isModified=!0}}else if(s===2){const o=t.propertyName,r=t.object,h=i.model;r===h&&o==="nodeParentKeyProperty"&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.X=!0}}}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const s=t.diagram;if(s===null)return;const n=s.model;if(t instanceof st){const o=n.getParentKeyForNodeData(i),r=s.findNodeForKey(o),h=t.findTreeParentNode();if(r!==h){const a=t.findTreeParentLink();r!==null?a!==null?s.isTreePathToChildren?a.fromNode=r:a.toNode=r:this.E1(r,t):a!==null&&s.UM(a,!1)}}}Ny(t,i){if(super.Ny(t,i),typeof i=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(i)}}R1(t){const i=this.diagram.model,s=i.getKeyForNodeData(t);if(s!==void 0){const n=i.Cy(s),o=this.findPartForData(t);if(n!==null&&o!==null){const h=n.iterator;for(;h.next();){const a=h.value;if(i.containsNodeData(a)&&o instanceof st&&i.getParentKeyForNodeData(a)===s){const l=this.findNodeForData(a);this.E1(o,l)}}i.Ws(s)}const r=i.getParentKeyForNodeData(t);if(r!==void 0&&o instanceof st){const h=this.findNodeForKey(r);this.E1(h,o)}}}CN(t){const i=this.diagram.model;if(t instanceof st){const s=i.getKeyForNodeData(t.data),n=this.findLinkForData(t.data);if(n!==null){n.isSelected=!1,n.isHighlighted=!1;const h=n.layer;if(h!==null){const a=h.te(-1,n,!1);a>=0&&this.diagram.raiseChangedEvent(4,"parts",h,n,null,a,null);const l=n.layerChanged;l!==null&&l(n,h,null)}}const o=this.diagram.isTreePathToChildren,r=t.linksConnected;for(;r.next();){const h=r.value,a=(o?h.toNode:h.fromNode).data;i.containsNodeData(a)&&i.Js(s,a)}}}insertLink(t,i,s,n){const o=this.diagram.model;let r=t,h=s;if(this.diagram.isTreePathToChildren||(r=s,h=t),r!==null&&h!==null){const a=r.data,l=h.data;return o.setParentKeyForNodeData(l,o.getKeyForNodeData(a)),h.findTreeParentLink()}return null}}var Gi=(w=>(w[w.OneWay=1]="OneWay",w[w.TwoWay=2]="TwoWay",w))(Gi||{});const pe=class pe{constructor(e,t,i,s){g(this,"n");g(this,"DN");g(this,"Ya");g(this,"Cf");g(this,"Ch");g(this,"Lf");g(this,"Af");g(this,"Tf");g(this,"U1");g(this,"be");g(this,"ad");g(this,"ff");K.Ki(this),e===void 0?e="":b.s(e,"string",pe,"constructor:targetprop"),t===void 0?t=e:b.s(t,"string",pe,"constructor:sourceprop"),i===void 0?i=null:i!==null&&b.k(i,pe,"constructor:conv"),this.DN=-1,this.be=null,this.Ya=e,this.ad=0,this.ff=0,this.Cf=null,this.Ch=t,this.Lf=i,s===void 0?(this.Af=1,this.Tf=null):(this.Af=2,this.Tf=s),this.U1=new K,this.n=2}copy(){const e=new this.constructor;return this.cloneProtected(e),e}cloneProtected(e){e.Ya=this.Ya,e.ad=this.ad,e.ff=this.ff,e.Cf=this.Cf,e.Ch=this.Ch,e.Lf=this.Lf,e.Af=this.Af,e.Tf=this.Tf,e.n=this.n&-2}static parseEnum(e,t){return b.k(e,pe,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=b.Uh(e,i),s===null)?t:s}}oi(e){e in Gi?this.mode=e:b.er(this,e)}static toString(e){return b.toString(e)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+Gi[this.mode]+")"}u(){return this.n=this.n|1,this}get targetId(){return this.DN}set targetId(e){this.h&&b.L(this),this.DN=e}get targetProperty(){return this.Ya}set targetProperty(e){this.h&&b.L(this),b.s(e,"string",pe,"targetProperty"),this.Ya=e}get sourceProperty(){return this.Ch}set sourceProperty(e){this.h&&b.L(this),b.s(e,"string",pe,"sourceProperty"),this.Ch=e}get h(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get FN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}qu(){return!1}get sourceName(){return this.Cf}set sourceName(e){this.h&&b.L(this),e!==null&&b.s(e,"string",pe,"sourceName"),this.Cf=e,e!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.Lf}set converter(e){this.h&&b.L(this),e!==null&&b.k(e,pe,"converter"),this.Lf=e}get backConverter(){return this.Tf}set backConverter(e){this.h&&b.L(this),e!==null&&b.k(e,pe,"backConverter"),this.Tf=e}get mode(){return this.Af}set mode(e){this.h&&b.L(this),this.isToTheme&&e===2&&b.o("Theme Bindings cannot be TwoWay."),this.Af=e}makeTwoWay(e){return this.isToTheme&&b.o("Theme Bindings cannot be TwoWay."),this.mode=2,e&&(b.k(e,pe,"makeTwoWay"),this.backConverter=e),this}ofObject(e){return this.h&&b.L(this),e===void 0&&(e=""),this.sourceName=e,this}ofModel(){return this.h&&b.L(this),this.n=this.n&-3&-5|8,this.Cf=null,this}yA(e,t){const i=this.sourceName;let s=null;return i===null||i===""?s=e:i==="/"?s=t.part:i==="."?s=t:i===".."?s=t.panel:s=e.findObject(i),s}check(e){const t=this.Ya,i=this.Ch,s=this.Lf;(this.qu()&&s===null&&this.Lh===null&&t===""||s===null&&t==="")&&b.ni("Binding error: target property is the empty string: "+this.toString()),this.qu()&&this.FN&&i===""&&s===null&&this.Lh===null&&b.ni("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),e&&typeof t=="string"&&(!b.it(["setAttribute"])&&t.length>0&&t[0]!=="_"&&!b.gw(e,t)?b.ni("Binding error: undefined target property: "+t+" on "+e.toString()):t==="name"&&e instanceof Ct&&b.ni("Binding error: cannot modify GraphObject.name on "+e.toString()))}updateTarget(e,t,i,s){var l;const n=this.Ch;if(i!==void 0&&n!==""&&n!==i)return;const o=this.Ya,r=this.Lf;let h=t;if(n!==""&&!this.FN&&(s?h=s.yt(t,n):h=It.yt(t,n)),h===void 0)return;const a=(l=e.diagram)==null?void 0:l.themeManager;if(r===null){if(o!==""){if(this.qu()&&(h=this.HT(a,h,e,o),h===void 0))return;s?s.Z(e,o,h):(t instanceof Ct||t instanceof ee)&&It.Z(e,o,h)}}else try{if(o!==""){let u=r(h,e);if(this.qu()&&(u=this.HT(a,u,e,o),u===void 0))return;s?s.Z(e,o,u):(t instanceof Ct||t instanceof ee)&&It.Z(e,o,u)}else r(h,e)}catch{}}updateSource(e,t,i,s){if(this.Af!==2)return;const n=this.Ya;if(i!==void 0&&n!==i)return;const o=this.Ch,r=this.Tf,h=s!==null?s.diagram:null,a=h!==null?h.model:null;let l=e;if(n!==""&&(a?l=a.yt(e,n):l=It.yt(e,n)),l!==void 0&&!this.U1.has(e))try{if(this.U1.add(e),r===null){if(o!=="")a!==null?a.setDataProperty(t,o,l):(t instanceof Ct||t instanceof ee)&&(t[o]=l);else if(a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const u=s.itemIndex,c=s.panel.itemArray;a.removeArrayItem(c,u),a.insertArrayItem(c,u,l)}}else try{if(o!==""){const u=r(l,t,a);a!==null?a.setDataProperty(t,o,u):(t instanceof Ct||t instanceof ee)&&(t[o]=u)}else{const u=r(l,t,a);if(u!==void 0&&a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,d=s.panel.itemArray;a.removeArrayItem(d,c),a.insertArrayItem(d,c,u)}}}catch{}}finally{this.U1.delete(e)}}};g(pe,"OneWay",1),g(pe,"TwoWay",2);let Ke=pe;class yi extends Ke{constructor(t,i,s,n,o){super(t,i,n);g(this,"Ly");g(this,"Lh");g(this,"Ga");s==null&&(s=""),o===void 0&&(o=null),this.Ly=s,this.Lh=o,this.Ga=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.Ly=this.Ly,t.Lh=this.Lh,t.Ga=this.Ga}qu(){return!0}get themeSource(){return this.Ly}set themeSource(t){this.h&&b.L(this),t!==null&&b.s(t,"string",yi,"themeSource"),this.Ly=t,this.Ga=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Lh}set themeConverter(t){this.h&&b.L(this),t!==null&&b.k(t,yi,"themeConverter"),this.Lh=t}ofData(){return this.h&&b.L(this),this.n=this.n|2,this.Cf=null,this}HT(t,i,s,n){if(!t||(this.FN&&(i=this.Ch),!i&&i!==0))return;let o=this.themeSource;this.Ga!==null?o=this.Ga:typeof o=="string"&&o.includes(".")&&(this.Ga=o.split("."),o=this.Ga);let r=t.findValue(i,o,n);return r===void 0&&b.ni(`Theme warning: ${i} could not be found when setting target property ${n}.`),b.it(this.Lh)&&(r=this.Lh(r,s)),r}}const St=class St{constructor(e,t){g(this,"St");g(this,"$d");g(this,"Ao");g(this,"RN");g(this,"Te");g(this,"mi");g(this,"Ah");g(this,"Df");g(this,"Ff");g(this,"Zd");g(this,"Qd");g(this,"_d");g(this,"tg");g(this,"Ay");g(this,"Ka");g(this,"Jo");g(this,"Ty");g(this,"Lo");g(this,"B1");if(K.Ki(this),this.St="",this.$d="",this.Ao=!1,this.RN={},this.Te=[],this.mi=new bt,this.Ah="key",this.Df=null,this.Ff=null,this.Zd=!1,this.Qd=!1,this._d=!1,this.tg=null,this.Ay=100,this.Ka="category",this.Jo=new bt,this.Ty=[],this.Lo=!1,this.B1=null,this.undoManager=new Ri,e!==void 0&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){e.St=this.St,e.$d=this.$d,e.Ao=this.Ao,e.Ah=this.Ah,e.Df=this.Df,e.Ff=this.Ff,e.Zd=this.Zd,e.Qd=this.Qd,e._d=this._d,e.tg=this.tg,e.Ay=this.Ay,e.Ka=this.Ka}copy(){const e=new this.constructor;return this.cloneProtected(e),e}clear(){this.Te=[],this.mi.clear(),this.Jo.clear(),this.undoManager.clear()}toString(e){if(e===void 0&&(e=0),e>1)return this.toJson();{let t=(this.name!==""?this.name:"")+" Model";if(e>0){t+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+b.toString(o)}}return t}}toIncrementalData(e){e.change!==1&&b.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+e.toString());const t=e.object;if(!e.isTransactionFinished||!(t instanceof Pi))return null;const i=this.qT(t);return this.vN(t,e.propertyName==="FinishedUndo",i)}vN(e,t,i){const s=this;let n=!1;const o=new K,r=new K,h=new K;e.changes.each(d=>{if(d.model===s){if(d.modelChange==="nodeDataArray")d.change===3?o.add(d.newValue):d.change===4&&h.add(d.oldValue);else if(s.containsNodeData(d.object))r.add(d.object);else if(d.change===2&&(s.modelData===d.object||d.propertyName==="modelData"))n=!0;else if(d.object!==null)if(i.has(d.object))i.get(d.object).each(f=>{s.containsNodeData(f)&&r.add(f)});else{if(d.object instanceof St||s.Ra()&&s.containsLinkData(d.object))return;s.WT(d.object).each(f=>{r.add(f)})}}});const a=new K;o.each(d=>{a.add(s.getKeyForNodeData(d)),t||r.add(d)});const l=new K;h.each(d=>{l.add(s.getKeyForNodeData(d)),t&&r.add(d)});const u=s.cloneDeep(r.toArray());let c=null;return n&&(c===null&&(c={}),c.modelData=this.cloneDeep(this.modelData)),a.count>0&&(c===null&&(c={}),t?c.removedNodeKeys=a.toArray():c.insertedNodeKeys=a.toArray()),u.length>0&&(c===null&&(c={}),c.modifiedNodeData=u),l.count>0&&(c===null&&(c={}),t?c.insertedNodeKeys=l.toArray():c.removedNodeKeys=l.toArray()),c}cloneDeep(e){return this.ig(e,!0)}ig(e,t,i,s){if(!b.G(e))return e;i||(i=new bt);const n=i.get(e);if(n)return n;let o;if(Array.isArray(e)){o=[],i.set(e,o);for(let r=0;r<e.length;r++){const h=e[r];o.push(this.ig(h,!1,i,s))}}else if(e instanceof S||e instanceof ot||e instanceof z||e instanceof Ot||e instanceof B)o=e.copy(),i.set(e,o);else{if(e instanceof Ft||e instanceof Mt)return e;if(e instanceof J)o=new J().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof K)o=new K().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof bt)o=new bt().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof Date)o=new Date(e),i.set(e,o);else if(e instanceof RegExp)o=new RegExp(e),i.set(e,o),o.lastIndex=e.lastIndex;else if(St.ON(null,"",e))o=e;else if(b.it(e.copy))o=e.copy(),i.set(e,o);else{o={},i.set(e,o);for(const r in e){if(r==="__gohashid")continue;const h=e[r];o[r]=this.ig(h,!1,i,s)}}}return o}De(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,t=>{const i="0000"+t.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}eg(){let e="";return this.name!==""&&(e+=`,
  "name": `+this.De(this.name)),this.dataFormat!==""&&(e+=`,
  "dataFormat": `+this.De(this.dataFormat)),this.isReadOnly&&(e+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(e+=`,
  "nodeKeyProperty": `+this.De(this.nodeKeyProperty)),this.copiesArrays&&(e+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(e+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(e+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(e+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(e+=`,
  "nodeCategoryProperty": `+this.De(this.nodeCategoryProperty)),e}Dy(e){e.name&&(this.name=e.name),e.dataFormat&&(this.dataFormat=e.dataFormat),e.isReadOnly&&(this.isReadOnly=!0),e.nodeKeyProperty&&(this.nodeKeyProperty=e.nodeKeyProperty),e.copiesArrays&&(this.copiesArrays=!0),e.copiesArrayObjects&&(this.copiesArrayObjects=!0),e.copiesKey!==void 0&&(this.copiesKey=e.copiesKey),e.pointsDigits!==void 0&&(this.pointsDigits=parseInt(e.pointsDigits)),e.nodeCategoryProperty&&(this.nodeCategoryProperty=e.nodeCategoryProperty)}JT(){const e=this.modelData;return`,
  "modelData": `+this.$T(e)}ZT(e){const t=e.modelData;b.G(t)&&(this.replaceJsonObjects(t),this.modelData=t)}IN(){const e=this.modelData;let t=!1;for(const s in e)if(!this.V1(e,s,e[s])){t=!0;break}let i="";return t&&(i=this.JT()),i+`,
  "nodeDataArray": `+this.Th(this.nodeDataArray,!0)}EN(e){this.ZT(e);const t=e.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}UN(e,t,i){if(e===t)return!0;if(typeof e!=typeof t||b.it(e)||b.it(t))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(i.get(e)===t)return!0;if(i.set(e,t),e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!this.UN(e[s],t[s],i))return!1;return!0}else if(b.G(e)&&b.G(t)){if(i.get(e)===t)return!0;i.set(e,t);for(const s in e){const n=e[s];if(this.V1(e,s,n))continue;const o=t[s];if(o===void 0||!this.UN(n,o,i))return!1}for(const s in t){const n=t[s];if(this.V1(t,s,n))continue;const o=e[s];if(o===void 0||!this.UN(o,n,i))return!1}return!0}return!1}qT(e){let t=new bt;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let h=t.get(s);h===null?(h=new K,h.add(r),t.set(s,h)):h.add(r)};return e.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),t}WT(e){const t=new K;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.z1(e,s,s,t)}return t}z1(e,t,i,s){if(Array.isArray(t))for(let n=0;n<t.length;n++){const o=t[n];if(o===e)return s.add(i),!0;if(this.z1(e,o,i,s))return!0}else if(b.G(t)&&Object.getPrototypeOf(t)===Object.prototype)for(const n in t){const o=t[n];if(o===e)return s.add(i),!0;if(this.z1(e,o,i,s))return!0}return!1}BN(e,t,i){const s=this;let n=!1;const o=new K,r=new K,h=new K;e.changes.each(c=>{if(c.model===s){if(c.modelChange==="nodeDataArray")c.change===3?o.add(c.newValue):c.change===4&&h.add(c.oldValue);else if(s.containsNodeData(c.object))r.add(c.object);else if(c.change===2&&(s.modelData===c.object||c.propertyName==="modelData"))n=!0;else if(c.object!==null)if(i.has(c.object))i.get(c.object).each(d=>{s.containsNodeData(d)&&r.add(d)});else{if(c.object instanceof St||s.Ra()&&s.containsLinkData(c.object))return;s.WT(c.object).each(d=>{r.add(d)})}}});const a=new K;o.each(c=>{a.add(s.getKeyForNodeData(c)),t||r.add(c)});const l=new K;h.each(c=>{l.add(s.getKeyForNodeData(c)),t&&r.add(c)});let u="";return n&&(u+=this.JT()),a.count>0&&(u+=(t?St._T:St.QT)+this.Th(a.toArray(),!0)),r.count>0&&(u+=St.qO+this.Th(r.toArray(),!0)),l.count>0&&(u+=(t?St.QT:St._T)+this.Th(l.toArray(),!0)),u}Fy(e){(e.name!==void 0&&e.name!==this.name||e.dataFormat!==void 0&&e.dataFormat!==this.dataFormat||e.isReadOnly!==void 0&&e.isReadOnly!==this.isReadOnly||e.nodeKeyProperty!==void 0&&e.nodeKeyProperty!==this.nodeKeyProperty||e.copiesArrays!==void 0&&e.copiesArrays!==this.copiesArrays||e.copiesArrayObjects!==void 0&&e.copiesArrayObjects!==this.copiesArrayObjects||e.copiesKey!==void 0&&e.copiesKey!==this.copiesKey||e.nodeCategoryProperty!==void 0&&e.nodeCategoryProperty!==this.nodeCategoryProperty)&&b.o("applyIncrementalJson cannot change Model properties"),this.ZT(e);const t=e.insertedNodeKeys,i=e.modifiedNodeData,s=new bt;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],h=this.getKeyForNodeData(r);h!=null&&s.set(h,r)}if(Array.isArray(t)){const o=t.length;for(let r=0;r<o;r++){const h=t[r];let a=this.findNodeDataForKey(h);a===null&&(a=s.get(h)||this.copyNodeData({}),this.setKeyForNodeData(a,h),this.addNodeData(a))}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const h=i[r],a=this.getKeyForNodeData(h),l=this.findNodeDataForKey(a);if(l!==null){for(const u in h)u==="__gohashid"||u===this.nodeKeyProperty||(this.mm()||this.Mb())&&u===this.nodeIsGroupProperty||this.setDataProperty(l,u,h[u]);this.sg(h,l)}}}const n=e.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const h=n[r],a=this.findNodeDataForKey(h);a!==null&&this.removeNodeData(a)}}}toIncrementalJson(e,t){e.change!==1&&b.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+e.toString());const i=e.object;if(!e.isTransactionFinished||!(i instanceof Pi))return'{ "incremental": 0 }';t===void 0&&(t=b.Dn(this));const s=this.qT(i),n=this.BN(i,e.propertyName==="FinishedUndo",s);return'{ "class": '+this.De(t)+', "incremental": 1'+this.eg()+n+"}"}toIncrementalJSON(e,t){return this.toIncrementalJson(e,t)}toJson(e){return e===void 0&&(e=b.Dn(this)),'{ "class": '+this.De(e)+this.eg()+this.IN()+"}"}toJSON(e){return this.toJson(e)}applyIncrementalJson(e){let t=null;if(typeof e=="string")try{t=_.JSON.parse(e)}catch{}else b.G(e)?t=e:b.o("Unable to modify a Model from: "+e);const i=t.incremental;typeof i!="number"&&b.o("Unable to apply non-incremental changes to Model: "+e),i!==0&&(this.startTransaction("applyIncrementalJson"),this.Fy(t),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(e){return this.applyIncrementalJson(e)}static fromJson(e,t){t===void 0&&(t=null);let i=null;if(typeof e=="string")try{i=_.JSON.parse(e)}catch{}else b.G(e)?i=e:b.o("Unable to construct a Model from: "+e);if(t===null){const s=St.WO(i);s===null||s instanceof St?t=s:b.o("Unable to construct a Model of declared class: "+i.class)}return t===null&&(t=St.tD()),t.Dy(i),t.EN(i),t}static fromJSON(e,t){return this.fromJson(e,t)}static tD(){return new St}static WO(e){let t=null,i=e.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?s=St.VN(i.substring(3)):(s=St.VN(i),s===null&&(s=_[i])),b.it(s)&&(t=new s)}catch{}return t}replaceJsonObjects(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];b.G(s)&&this.iD(e,i,this.replaceJsonObjects(s))}}else if(b.G(e)){for(const t in e){const i=e[t];if(b.G(i)){const s=this.replaceJsonObjects(i);if(e[t]=s,t==="points"&&Array.isArray(s)){let n=s.length%2===0;for(let o=0;o<s.length;o++)if(typeof s[o]!="number"){n=!1;break}if(n){const o=new J;for(let r=0;r<s.length/2;r++)o.add(new S(s[r*2],s[r*2+1]));o.u(),e[t]=o}}}}return this.JO(e)}return e}writeJsonValue(e){return e===void 0?"undefined":e===null?"null":e===!0?"true":e===!1?"false":typeof e=="string"?this.De(e):typeof e=="number"?e===1/0?"9e9999":e===-1/0?"-9e9999":isNaN(e)?'{"class":"NaN"}':e.toString():e instanceof Boolean?this.writeJsonValue(e.valueOf()):e instanceof String?this.writeJsonValue(e.valueOf()):e instanceof Number?this.writeJsonValue(e.valueOf()):e instanceof Date?'{"class":"Date", "value":"'+e.toJSON()+'"}':Array.isArray(e)?this.Th(e):b.G(e)?this.$T(e):b.it(e)?"null":'"'+e.toString()+'"'}Th(e,t){t===void 0&&(t=!1);const i=e.length;if(i<=0)return"[]";const s=new ui;s.add("["),t&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=e[n];o!==void 0&&(n>0&&(s.add(","),t&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return t&&i>1&&s.add(`
`),s.add("]"),s.toString()}V1(e,t,i){return!!(i===void 0||t==="__gohashid"||t[0]==="_"||b.it(i))}Yi(e){return isNaN(e)?"NaN":e===1/0?"9e9999":e===-1/0?"-9e9999":e}$T(e){const t=e;if(t instanceof S)e={class:"go.Point",x:this.Yi(t.x),y:this.Yi(t.y)};else if(t instanceof ot)e={class:"go.Size",width:this.Yi(t.width),height:this.Yi(t.height)};else if(t instanceof z)e={class:"go.Rect",x:this.Yi(t.x),y:this.Yi(t.y),width:this.Yi(t.width),height:this.Yi(t.height)};else if(t instanceof Ot)e={class:"go.Margin",top:this.Yi(t.top),right:this.Yi(t.right),bottom:this.Yi(t.bottom),left:this.Yi(t.left)};else if(t instanceof B)t.isSpot()?e={class:"go.Spot",x:this.Yi(t.x),y:this.Yi(t.y),offsetX:this.Yi(t.offsetX),offsetY:this.Yi(t.offsetY)}:e={class:"go.Spot",enum:t.toString()};else if(t instanceof Ft){if(e={class:"go.Brush",type:We[t.type]},t.type===1?e.color=t.color:(t.type===2||t.type===3)&&(e.start=t.start,e.end=t.end,t.type===3&&(t.startRadius!==0&&(e.startRadius=this.Yi(t.startRadius)),isNaN(t.endRadius)||(e.endRadius=this.Yi(t.endRadius)))),t.colorStops!==null){const n={},o=t.colorStops.iterator;for(;o.next();){const r=o.key,h=o.value;n[r]=h}e.colorStops=n}}else if(t instanceof Mt)e={class:"go.Geometry",type:ii[t.type]},t.startX!==0&&(e.startX=this.Yi(t.startX)),t.startY!==0&&(e.startY=this.Yi(t.startY)),t.endX!==0&&(e.endX=this.Yi(t.endX)),t.endY!==0&&(e.endY=this.Yi(t.endY)),t.spot1.equals(B.TopLeft)||(e.spot1=t.spot1),t.spot2.equals(B.BottomRight)||(e.spot2=t.spot2),t.type===4&&(e.path=Mt.stringify(t));else if(St.ON(null,"",t))return"{}";let i="{",s=!0;for(const n in e){const o=this.yt(e,n);if(!this.V1(e,n,o))if(s?s=!1:i+=",",i+=this.De(n)+":",n==="points"&&o instanceof J){const r=o;let h="[";const a=r.iterator;for(;a.next();){const l=a.value;h.length>1&&(h+=","),h+=this.eD(l.x),h+=",",h+=this.eD(l.y)}h+="]",i+=h}else i+=this.writeJsonValue(o)}return i+="}",i}eD(e){if(e===1/0)return"9e9999";if(e===-1/0)return"-9e9999";if(isNaN(e))return"0";const t=this.pointsDigits;return t>16?e.toString():e.toFixed(t)}get pointsDigits(){return this.Ay}set pointsDigits(e){e<0?e=0:e>100&&(e=100),this.Ay=e}Gi(e){return typeof e=="number"?e:e==="NaN"?NaN:e==="9e9999"?1/0:e==="-9e9999"?-1/0:parseFloat(e)}JO(e){if(!b.G(e))return e;let t=e.class||"";if(typeof t!="string"||t==="")return e;if(t==="NaN")return NaN;if(t==="Date")return new Date(e.value);if(t.indexOf("go.")!==0)return e;t=t.substring(3);let i=e;if(t==="Point")i=new S(this.Gi(e.x),this.Gi(e.y));else if(t==="Size")i=new ot(this.Gi(e.width),this.Gi(e.height));else if(t==="Rect")i=new z(this.Gi(e.x),this.Gi(e.y),this.Gi(e.width),this.Gi(e.height));else if(t==="Margin")i=new Ot(this.Gi(e.top),this.Gi(e.right),this.Gi(e.bottom),this.Gi(e.left));else if(t==="Spot")typeof e.enum=="string"?i=B.parse(e.enum):i=new B(this.Gi(e.x),this.Gi(e.y),this.Gi(e.offsetX),this.Gi(e.offsetY));else if(t==="Brush"){const s=new Ft;s.type=b.Uh(We,e.type)??1,typeof e.color=="string"&&(s.color=e.color),e.start instanceof B&&(s.start=e.start),e.end instanceof B&&(s.end=e.end),typeof e.startRadius=="number"&&(s.startRadius=this.Gi(e.startRadius)),typeof e.endRadius=="number"&&(s.endRadius=this.Gi(e.endRadius));const n=e.colorStops;if(b.G(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if(t==="Geometry"){let s=null;typeof e.path=="string"?s=Mt.parse(e.path):s=new Mt,s.type=b.Uh(ii,e.type)??1,typeof e.startX=="number"&&(s.startX=this.Gi(e.startX)),typeof e.startY=="number"&&(s.startY=this.Gi(e.startY)),typeof e.endX=="number"&&(s.endX=this.Gi(e.endX)),typeof e.endY=="number"&&(s.endY=this.Gi(e.endY)),e.spot1 instanceof B&&(s.spot1=e.spot1),e.spot2 instanceof B&&(s.spot2=e.spot2),i=s}else if(t==="EnumValue"){let s=e.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=St.VN(s);b.it(n)&&(i=b.Uh(n,e.name))}return i}get name(){return this.St}set name(e){const t=this.St;t!==e&&(b.s(e,"string",St,"name"),this.St=e,this.t("name",t,e))}get dataFormat(){return this.$d}set dataFormat(e){const t=this.$d;t!==e&&(b.s(e,"string",St,"dataFormat"),this.$d=e,this.t("dataFormat",t,e))}get isReadOnly(){return this.Ao}set isReadOnly(e){const t=this.Ao;t!==e&&(b.s(e,"boolean",St,"isReadOnly"),this.Ao=e,this.t("isReadOnly",t,e))}get modelData(){return this.RN}set modelData(e){const t=this.modelData;t!==e&&(b.ec(e,St,"modelData"),this.containsNodeData(e)&&b.o("Model.modelData Object must not be used by the rest of the model: "+e),this.RN=e,this.t("modelData",t,e),this.updateTargetBindings(e))}addChangedListener(e){return b.k(e,St,"addChangedListener:listener"),this.Ty.push(e),this}removeChangedListener(e){b.k(e,St,"removeChangedListener:listener");const t=this.Ty.indexOf(e);t>=0&&this.Ty.splice(t,1)}VM(e){this.skipsUndoManager||this.undoManager.handleChanged(e),this.sD(e)}sD(e){this.Ty.forEach(t=>t(e))}dF(e){this.sD(e)}raiseChangedEvent(e,t,i,s,n,o,r){this.vt("",e,t,i,s,n,o,r)}raiseChanged(e,t,i,s,n){this.vt("",2,e,this,t,i,s,n)}t(e,t,i,s,n){this.vt("",2,e,this,t,i,s,n)}raiseDataChanged(e,t,i,s,n,o){this.vt("",2,t,e,i,s,n,o)}vt(e,t,i,s,n,o,r,h){r===void 0&&(r=null),h===void 0&&(h=null);const a=new si;a.model=this,a.change=t,a.modelChange=e,a.propertyName=i,a.object=s,a.oldValue=n,a.oldParam=r,a.newValue=o,a.newParam=h,this.VM(a)}get undoManager(){return this.B1}set undoManager(e){const t=this.B1;t!==e&&(t!==null&&t.removeModel(this),this.B1=e,e!==null&&e.addModel(this))}get skipsUndoManager(){return this.Lo}set skipsUndoManager(e){b.s(e,"boolean",St,"skipsUndoManager"),this.Lo=e}changeState(e,t){if(e!==null&&e.model===this)if(e.change===2){const i=e.object,s=e.propertyName,n=e.getValue(t);if(s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=e.getValue(!t);o!==void 0&&this.mi.delete(o),n!==void 0&&this.mi.set(n,i)}this.Z(i,s,n)}else if(e.change===3){const i=e.newParam;if(e.modelChange==="nodeDataArray"){const s=e.newValue;if(b.G(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Te[i]===s&&this.go(this.Te,i),n!==void 0&&this.mi.delete(n)):(this.Te[i]!==s&&this.$o(this.Te,i,s),n!==void 0&&this.mi.set(n,s))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.yt(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.newValue;t?this.go(s,i):this.$o(s,i,n)}}else b.o("unknown ChangeType.Insert modelChange: "+e.toString())}else if(e.change===4){const i=e.oldParam;if(e.modelChange==="nodeDataArray"){const s=e.oldValue;if(b.G(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Te[i]!==s&&this.$o(this.Te,i,s),n!==void 0&&this.mi.set(n,s)):(this.Te[i]===s&&this.go(this.Te,i),n!==void 0&&this.mi.delete(n))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.yt(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.oldValue;t?this.$o(s,i,n):this.go(s,i)}}else b.o("unknown ChangeType.Remove modelChange: "+e.toString())}else e.change===1||b.o("unknown ChangedEvent: "+e.toString())}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(e,t){t===void 0&&(t=""),this.vt("SourceChanged",1,t,e,null,null)}get nodeKeyProperty(){return this.Ah}set nodeKeyProperty(e){const t=this.Ah;t!==e&&(this.Pn(e,St,"nodeKeyProperty"),e===""&&b.o("Model.nodeKeyProperty may not be the empty string"),this.mi.count>0&&b.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Ah=e,this.t("nodeKeyProperty",t,e))}Pn(e,t,i){}getKeyForNodeData(e){if(e===null)return;const t=this.Ah;if(t==="")return;const i=this.yt(e,t);if(i!==void 0){if(this.isKeyType(i))return i;b.o("Key value for node data "+e+" is not a number or a string: "+i)}}setKeyForNodeData(e,t){if((t==null||!this.isKeyType(t))&&b.Zi(t,"number or string",St,"setKeyForNodeData:key"),e===null)return;const i=this.Ah;if(i==="")return;if(!this.containsNodeData(e)){this.Z(e,i,t);return}const s=this.yt(e,i);if(s!==t){if(this.findNodeDataForKey(t)!==null)return;this.Z(e,i,t),s!==void 0&&this.mi.delete(s),this.mi.set(t,e),this.vt("nodeKey",2,i,e,s,t),typeof i=="string"&&this.updateTargetBindings(e,i),this.Ry(s,t)}}get makeUniqueKeyFunction(){return this.Df}set makeUniqueKeyFunction(e){const t=this.Df;t!==e&&(e!==null&&b.k(e,St,"makeUniqueKeyFunction"),this.Df=e,this.t("makeUniqueKeyFunction",t,e))}isKeyType(e){return typeof e=="number"||typeof e=="string"}containsNodeData(e){if(e===null)return!1;const t=this.getKeyForNodeData(e);return t===void 0?!1:this.mi.get(t)===e}findNodeDataForKey(e){return e===null&&b.o("Model.findNodeDataForKey:key must not be null"),e===void 0||!this.isKeyType(e)?null:this.mi.get(e)}get nodeDataArray(){return this.Te}set nodeDataArray(e){const t=this.Te;if(t!==e){this.zN(e,St,"nodeDataArray"),this.mi.clear(),this.XN();const i=e.length;for(let o=0;o<i;o++){const r=e[o];b.G(r)||b.o("Model.nodeDataArray must only contain Objects, not: "+r),r===this.modelData&&b.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Te=e;const s=new J;for(let o=0;o<i;o++){const r=e[o],h=this.getKeyForNodeData(r);h===void 0||this.mi.get(h)!==null?s.add(r):this.mi.set(h,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.mi.set(r,o)}this.vt("nodeDataArray",2,"nodeDataArray",this,t,e);for(let o=0;o<i;o++){const r=e[o];this.ng(r),this.og(r)}}}X1(e){return e===void 0?!1:this.mi.has(e)}makeNodeDataKeyUnique(e){if(e===null)return;const t=this.Ah;if(t==="")return;let i=this.getKeyForNodeData(e);if(i!==void 0&&!this.X1(i))return;const s=this.Df;if(s!==null&&(i=s(this,e),i!=null&&!this.X1(i))){this.Z(e,t,i);return}if(typeof i=="string"){let n=2;for(;this.X1(i+n);)n++;this.Z(e,t,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.mi.count-1;for(;this.X1(n);)n--;this.Z(e,t,n)}}addNodeData(e){e!==null&&(e===this.modelData&&b.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(e)||this.VT(e,!0))}VT(e,t){let i=this.getKeyForNodeData(e);if(i===void 0)this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e);else{if(this.mi.get(i)===e)return;this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e)}i===void 0&&b.o("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.mi.set(i,e);let s=null;t&&(s=this.Te.length,this.$o(this.Te,s,e)),this.vt("nodeDataArray",3,"nodeDataArray",this,null,e,null,s),this.ng(e),this.og(e)}addNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.addNodeData(i)}}}removeNodeData(e){e!==null&&this.BT(e,!0)}BT(e,t){const i=this.getKeyForNodeData(e);i!==void 0&&this.mi.delete(i);let s=null;if(t){if(s=this.Te.indexOf(e),s<0)return;this.go(this.Te,s)}this.vt("nodeDataArray",4,"nodeDataArray",this,e,null,s,null),this.vy(e)}removeNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.removeNodeData(i)}}}mergeNodeDataArray(e){if(e===this.nodeDataArray||!Array.isArray(e))return;const t=new K;t.addAll(this.mi.iteratorKeys);const i=new K,s=e.length;for(let o=0;o<s;o++){const r=e[o],h=this.getKeyForNodeData(r);if(h!==void 0){i.add(h);const a=this.findNodeDataForKey(h);if(a===r)continue;if(a!==null)this.assignAllDataProperties(a,r),this.sg(r,a);else{const l=this.cloneDeep(r);this.setKeyForNodeData(l,h),this.addNodeData(l)}}else{const a=this.cloneDeep(r);this.addNodeData(a),i.add(this.getKeyForNodeData(a))}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}}Ry(e,t){if(t===void 0)return;const i=this.Cy(e);i instanceof K&&this.Jo.set(t,i)}XN(){}ng(e){}og(e){}vy(e){}Js(e,t){if(e===void 0)return;let i=this.Jo.get(e);i===null&&(i=new K,this.Jo.set(e,i)),i.add(t)}Ws(e,t){if(e===void 0)return;const i=this.Jo.get(e);i instanceof K&&(t==null?this.Jo.delete(e):(i.delete(t),i.count===0&&this.Jo.delete(e)))}Cy(e){if(e===void 0)return null;const t=this.Jo.get(e);return t instanceof K?t:null}OE(e){e===void 0?this.Jo.clear():this.Jo.delete(e)}get copyNodeDataFunction(){return this.Ff}set copyNodeDataFunction(e){const t=this.Ff;t!==e&&(e!==null&&b.k(e,St,"copyNodeDataFunction"),this.Ff=e,this.t("copyNodeDataFunction",t,e))}get copiesArrays(){return this.Zd}set copiesArrays(e){const t=this.Zd;t!==e&&(e!==null&&b.s(e,"boolean",St,"copiesArrays"),this.Zd=e,this.t("copiesArrays",t,e))}get copiesArrayObjects(){return this.Qd}set copiesArrayObjects(e){const t=this.Qd;t!==e&&(e!==null&&b.s(e,"boolean",St,"copiesArrayObjects"),this.Qd=e,this.t("copiesArrayObjects",t,e))}get copiesKey(){return this._d}set copiesKey(e){const t=this._d;t!==e&&(e!==null&&b.s(e,"boolean",St,"copiesKey"),this._d=e,this.t("copiesKey",t,e))}copyNodeData(e){if(e===null)return null;let t=null;const i=this.Ff;return i!==null?t=i(e,this):t=this.Y1(e,!0),t}Y1(e,t){if(b.G(e))if(Array.isArray(e))if(this.copiesArrays){const i=e,s=[];for(let n=0;n<i.length;n++){const o=i[n],r=this.Y1(o,this.copiesArrayObjects);s.push(r)}return s}else return e;else{if(e instanceof S||e instanceof ot||e instanceof z||e instanceof Ot||e instanceof B)return e.copy();if(t){const i=e,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in i){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const h=this.yt(i,r);if(!b.G(h))n[r]=h;else if(St.ON(i,r,h))this.Z(n,r,h);else{const a=this.Y1(h,!1);this.Z(n,r,a)}}return n}else return e}else return e}get afterCopyFunction(){return this.tg}set afterCopyFunction(e){const t=this.tg;t!==e&&(e!==null&&b.k(e,St,"afterCopyFunction"),this.tg=e,this.t("afterCopyFunction",t,e))}static ON(e,t,i){const s=b.Dn(i);return i instanceof St||i instanceof Ri||i instanceof Pi||i instanceof si||i instanceof Ct||i instanceof ee||i instanceof kt||i instanceof EventTarget||s==="Layer"||s==="RowColumnDefinition"||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty){this.setKeyForNodeData(e,i);return}else if(t===this.nodeCategoryProperty){this.setCategoryForNodeData(e,i);return}}else!St.nD&&e instanceof Ct&&(St.nD=!0,b.ni('Model.setDataProperty is modifying a GraphObject, "'+e.toString()+'"'),b.ni("  Is that really your intent?"));const s=this.yt(e,t);s!==i&&(this.Z(e,t,i),this.raiseDataChanged(e,t,s,i))}set(e,t,i){this.setDataProperty(e,t,i)}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e);for(const s in t)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(e,s,t[s]))}addArrayItem(e,t){this.insertArrayItem(e,-1,t)}insertArrayItem(e,t,i){t<0&&(t=e.length),e=this.$o(e,t,i),this.vt("",3,"",e,null,i,null,t)}removeArrayItem(e,t){t===void 0&&(t=-1),e===this.Te&&b.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),t===-1&&(t=e.length-1);const i=e[t];e=this.go(e,t),this.vt("",4,"",e,i,null,t,null)}get nodeCategoryProperty(){return this.Ka}set nodeCategoryProperty(e){const t=this.Ka;t!==e&&(this.Pn(e,St,"nodeCategoryProperty"),this.Ka=e,this.t("nodeCategoryProperty",t,e))}getCategoryForNodeData(e){if(e===null)return"";const t=this.Ka;if(t==="")return"";const i=this.yt(e,t);if(i===void 0)return"";if(typeof i=="string")return i;b.o("getCategoryForNodeData found a non-string category for "+e+": "+i)}setCategoryForNodeData(e,t){if(b.s(t,"string",St,"setCategoryForNodeData:cat"),e===null)return;const i=this.Ka;if(i==="")return;if(!this.containsNodeData(e)){this.Z(e,i,t);return}let s=this.yt(e,i);s===void 0&&(s=""),s!==t&&(this.Z(e,i,t),this.vt("nodeCategory",2,i,e,s,t))}sg(e,t){this.setCategoryForNodeData(t,this.getCategoryForNodeData(e))}get type(){return"Model"}pm(){return!1}mm(){return!1}Mb(){return!1}Ra(){return!1}Xw(){return!1}Hc(){return!1}static LM(){return new St}yt(e,t){return St.yt(e,t)}static yt(e,t){if(!e||!t)return null;let i;try{b.it(t)?i=t(e):b.it(e.getAttribute)?(i=e.getAttribute(t),i===null&&(i=void 0)):i=e[t]}catch{}return i}Z(e,t,i){St.Z(e,t,i)}static Z(e,t,i){if(!(!e||!t)){try{b.it(t)?t(e,i):b.it(e.setAttribute)?e.setAttribute(t,i):e[t]=i}catch{}return e}}zN(e,t,i){}iD(e,t,i){return e[t]=i,e}$o(e,t,i){return t>=e.length?e.push(i):e.splice(t,0,i),e}go(e,t){return t>=e.length?e.pop():e.splice(t,1),e}static VN(e){return St.YN[e]?St.YN[e]:_.go!==void 0&&_.go[e]?_.go[e]:null}static fl(e,t){St.YN[t]=e}};g(St,"QT",`,
  "insertedNodeKeys": `),g(St,"qO",`,
  "modifiedNodeData": `),g(St,"_T",`,
  "removedNodeKeys": `),g(St,"nD",!1),g(St,"YN",{});let It=St;It.fromJSON=It.fromJson=It.fromJson,It.fl(Ft,"Brush"),It.fl(Mt,"Geometry"),It.fl(Ot,"Margin"),It.fl(S,"Point"),It.fl(z,"Rect"),It.fl(ot,"Size"),It.fl(B,"Spot"),It.fl(It,"Model");const $t=class $t extends It{constructor(t,i,s){super();g(this,"Ps");g(this,"Zo");g(this,"Di");g(this,"Dh");g(this,"Rf");g(this,"vf");g(this,"Ll");g(this,"mo");g(this,"po");g(this,"ja");g(this,"Ha");g(this,"qa");g(this,"$s");g(this,"Of");g(this,"Sn");g(this,"rg");g(this,"rD",`,
  "insertedLinkKeys": `);g(this,"$O",`,
  "modifiedLinkData": `);g(this,"lD",`,
  "removedLinkKeys": `);if(this.Ps=[],this.Zo=new K,this.Di=new bt,this.Dh="",this.Rf=null,this.vf=null,this.Ll=null,this.mo="from",this.po="to",this.ja="",this.Ha="",this.qa="category",this.$s="",this.Of="isGroup",this.Sn="group",this.rg=!1,i!==void 0&&(this.linkDataArray=i),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:s=t),s){Object.assign(this,s);const n=s.Changed;n&&(delete this.Changed,this.addChangedListener(n))}}cloneProtected(t){super.cloneProtected(t),t.Dh=this.Dh,t.Rf=this.Rf,t.vf=this.vf,t.mo=this.mo,t.po=this.po,t.ja=this.ja,t.Ha=this.Ha,t.qa=this.qa,t.$s=this.$s,t.Of=this.Of,t.Sn=this.Sn,t.rg=this.rg}clear(){this.Ps=[],this.Di.clear(),this.Zo.clear(),super.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){i+=`
 node data:`;let s=this.nodeDataArray,n=s.length,o=0;for(o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+Ke.toString(r)}for(i+=`
 link data:`,s=this.linkDataArray,n=s.length,o=0;o<n;o++){const r=s[o];i+=" "+this.Ae(r,!0)+"-->"+this.Ae(r,!1)}}return i}}vN(t,i,s){if(this.linkKeyProperty===""){const d=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=d}let n=super.vN(t,i,s);const o=this,r=new K,h=new K,a=new K;t.changes.each(d=>{if(d.model===o){if(d.modelChange==="linkDataArray")d.change===3?r.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(o.containsLinkData(d.object))h.add(d.object);else if(d.object!==null)if(d.object!==null&&s.has(d.object))s.get(d.object).each(f=>{o.containsLinkData(f)&&h.add(f)});else{if(d.object instanceof It||o.containsNodeData(d.object))return;o.oD(d.object).each(f=>h.add(f))}}});const l=new K;r.each(d=>{l.add(o.getKeyForLinkData(d)),i||h.add(d)});const u=new K;a.each(d=>{u.add(o.getKeyForLinkData(d)),i&&h.add(d)});const c=o.cloneDeep(h.toArray());return l.count>0&&(n===null&&(n={}),i?n.removedLinkKeys=l.toArray():n.insertedLinkKeys=l.toArray()),c.length>0&&(n===null&&(n={}),n.modifiedLinkData=c),u.count>0&&(n===null&&(n={}),i?n.insertedLinkKeys=u.toArray():n.removedLinkKeys=u.toArray()),n}eg(){const t=super.eg();let i="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(i+=`,
  "linkCategoryProperty": `+this.De(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(i+=`,
  "linkKeyProperty": `+this.De(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(i+=`,
  "linkFromKeyProperty": `+this.De(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(i+=`,
  "linkToKeyProperty": `+this.De(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(i+=`,
  "linkFromPortIdProperty": `+this.De(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(i+=`,
  "linkToPortIdProperty": `+this.De(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(i+=`,
  "linkLabelKeysProperty": `+this.De(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(i+=`,
  "nodeIsGroupProperty": `+this.De(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(i+=`,
  "nodeGroupKeyProperty": `+this.De(this.nodeGroupKeyProperty)),t+i}Dy(t){super.Dy(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}IN(){const t=super.IN(),i=`,
  "linkDataArray": `+this.Th(this.linkDataArray,!0);return t+i}EN(t){super.EN(t);const i=t.linkDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.linkDataArray=i)}oD(t){const i=new K;for(let s=0;s<this.linkDataArray.length;s++){const n=this.linkDataArray[s];this.z1(t,n,n,i)}return i}BN(t,i,s){if(this.linkKeyProperty===""){const d=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=d}const n=super.BN(t,i,s),o=this,r=new K,h=new K,a=new K;t.changes.each(d=>{if(d.model===o){if(d.modelChange==="linkDataArray")d.change===3?r.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(o.containsLinkData(d.object))h.add(d.object);else if(d.object!==null)if(d.object!==null&&s.has(d.object))s.get(d.object).each(f=>{o.containsLinkData(f)&&h.add(f)});else{if(d.object instanceof It||o.containsNodeData(d.object))return;o.oD(d.object).each(f=>h.add(f))}}});const l=new K;r.each(d=>{l.add(o.getKeyForLinkData(d)),i||h.add(d)});const u=new K;a.each(d=>{u.add(o.getKeyForLinkData(d)),i&&h.add(d)});let c=n;return l.count>0&&(c+=(i?this.lD:this.rD)+this.Th(l.toArray(),!0)),h.count>0&&(c+=this.$O+this.Th(h.toArray(),!0)),u.count>0&&(c+=(i?this.rD:this.lD)+this.Th(u.toArray(),!0)),c}Fy(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&b.o("applyIncrementalJson cannot change Model properties"),super.Fy(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const h=i[r];let a=this.findLinkDataForKey(h);a===null&&(a=this.copyLinkData({}),this.setKeyForLinkData(a,h),this.addLinkData(a))}}const s=t.modifiedLinkData;if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const h=s[r],a=this.getKeyForLinkData(h),l=this.findLinkDataForKey(a);if(l!==null){for(const u in h)u==="__gohashid"||u===this.linkKeyProperty||this.setDataProperty(l,u,h[u]);this.hD(h,l)}}}const n=t.removedLinkKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const h=n[r],a=this.findLinkDataForKey(h);a!==null&&this.removeLinkData(a)}}}changeState(t,i){if(!(t===null||t.model!==this)){if(t.change===2){const s=t.object,n=t.propertyName;if(n===this.linkKeyProperty&&this.containsLinkData(s)){const o=t.getValue(i),r=t.getValue(!i);r!==void 0&&this.Di.delete(r),o!==void 0&&this.Di.set(o,s),this.Z(s,n,o);return}}else if(t.change===3){let s=t.newParam;if(t.modelChange==="linkDataArray"){const n=t.newValue;if(b.G(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.Zo.delete(n),this.Ps[s]===n&&this.go(this.linkDataArray,s),o!==void 0&&this.Di.delete(o)):(this.Zo.add(n),this.Ps[s]!==n&&this.$o(this.Ps,s,n),o!==void 0&&this.Di.set(o,n))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=this.getLabelKeysForLinkData(n);Array.isArray(o)&&typeof s=="number"&&(i?(s=o.indexOf(t.newValue),s>=0&&this.go(o,s)):o.indexOf(t.newValue)<0&&this.$o(o,s,t.newValue));return}}else if(t.change===4){let s=t.oldParam;if(t.modelChange==="linkDataArray"){const n=t.oldValue;if(b.G(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.Zo.add(n),this.Ps[s]!==n&&this.$o(this.Ps,s,n),o!==void 0&&this.Di.set(o,n)):(this.Zo.delete(n),this.Ps[s]===n&&this.go(this.linkDataArray,s),o!==void 0&&this.Di.delete(o))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=this.getLabelKeysForLinkData(n);Array.isArray(o)&&typeof s=="number"&&(i?o.indexOf(t.oldValue)<0&&this.$o(o,s,t.oldValue):(s=o.indexOf(t.oldValue),s>=0&&this.go(o,s)));return}}super.changeState(t,i)}}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){const i=this.Ll;i!==t&&(t!==null&&b.ec(t,$t,"archetypeNodeData"),this.Ll=t,this.t("archetypeNodeData",i,t))}GN(t){if(t===void 0)return;const i=this.Ll;if(i!==null){let s=this.findNodeDataForKey(t);s===null&&(s=this.copyNodeData(i),this.Z(s,this.nodeKeyProperty,t),this.addNodeData(s))}return t}get linkFromKeyProperty(){return this.mo}set linkFromKeyProperty(t){const i=this.mo;i!==t&&(this.Pn(t,$t,"linkFromKeyProperty"),this.mo=t,this.t("linkFromKeyProperty",i,t))}getFromKeyForLinkData(t){return this.Ae(t,!0)}setFromKeyForLinkData(t,i){this.Wd(t,i,!0)}get linkToKeyProperty(){return this.po}set linkToKeyProperty(t){const i=this.po;i!==t&&(this.Pn(t,$t,"linkToKeyProperty"),this.po=t,this.t("linkToKeyProperty",i,t))}getToKeyForLinkData(t){return this.Ae(t,!1)}setToKeyForLinkData(t,i){this.Wd(t,i,!1)}Ae(t,i){if(t===null)return;const s=i?this.mo:this.po;if(s==="")return;const n=this.yt(t,s);if(n!==void 0){if(this.isKeyType(n))return n;b.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+n)}}Wd(t,i,s){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.Zi(i,"number or string",$t,s?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const n=s?this.mo:this.po;if(n==="")return;if(i=this.GN(i),!this.containsLinkData(t)){this.Z(t,n,i);return}const o=this.yt(t,n);o!==i&&(this.Ws(o,t),this.Z(t,n,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt(s?"linkFromKey":"linkToKey",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkFromPortIdProperty(){return this.ja}set linkFromPortIdProperty(t){const i=this.ja;i!==t&&(this.Pn(t,$t,"linkFromPortIdProperty"),this.ja=t,this.t("linkFromPortIdProperty",i,t))}getFromPortIdForLinkData(t){return this.I1(t,!0)}setFromPortIdForLinkData(t,i){this.Jd(t,i,!0)}get linkToPortIdProperty(){return this.Ha}set linkToPortIdProperty(t){const i=this.Ha;i!==t&&(this.Pn(t,$t,"linkToPortIdProperty"),this.Ha=t,this.t("linkToPortIdProperty",i,t))}getToPortIdForLinkData(t){return this.I1(t,!1)}setToPortIdForLinkData(t,i){this.Jd(t,i,!1)}I1(t,i){if(t===null)return"";const s=i?this.ja:this.Ha;if(s==="")return"";const n=this.yt(t,s);return n===void 0?"":n}Jd(t,i,s){if(t===null)return;const n=s?this.ja:this.Ha;if(n==="")return;if(!this.containsLinkData(t)){this.Z(t,n,i);return}let o=this.yt(t,n);o===void 0&&(o=""),o!==i&&(this.Z(t,n,i),this.vt(s?"linkFromPortId":"linkToPortId",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkLabelKeysProperty(){return this.$s}set linkLabelKeysProperty(t){const i=this.$s;i!==t&&(this.Pn(t,$t,"linkLabelKeysProperty"),this.$s=t,this.t("linkLabelKeysProperty",i,t))}getLabelKeysForLinkData(t){if(t===null)return $t.EmptyArray;const i=this.$s;if(i==="")return $t.EmptyArray;const s=this.yt(t,i);return s===void 0?$t.EmptyArray:s}setLabelKeysForLinkData(t,i){if(this.zN(i,$t,"setLabelKeysForLinkData:arr"),t===null)return;const s=this.$s;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);if(n===void 0&&(n=$t.EmptyArray),n!==i){if(Array.isArray(n)){const r=n.length;for(let h=0;h<r;h++){const a=n[h];this.Ws(a,t)}}this.Z(t,s,i);const o=i.length;for(let r=0;r<o;r++){const h=i[r];this.findNodeDataForKey(h)===null&&this.Js(h,t)}this.vt("linkLabelKeys",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}addLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||b.Zi(i,"number or string",$t,"addLabelKeyForLinkData:key"),t===null))return;const s=this.$s;if(s==="")return;const n=this.yt(t,s);if(n===void 0){const o=[];o.push(i),this.setLabelKeysForLinkData(t,o)}else if(Array.isArray(n)){let o=n.indexOf(i);if(o>=0)return;o=n.length,n.push(i),this.containsLinkData(t)&&(this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("linkLabelKeys",3,s,t,null,i,null,o))}else b.o(s+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||b.Zi(i,"number or string",$t,"removeLabelKeyForLinkData:key"),t===null))return;const s=this.$s;if(s==="")return;const n=this.yt(t,s);if(Array.isArray(n)){const o=n.indexOf(i);if(o<0)return;this.go(n,o),this.containsLinkData(t)&&(this.Ws(i,t),this.vt("linkLabelKeys",4,s,t,i,null,o,null))}else n!==void 0&&b.o(s+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Ps}set linkDataArray(t){const i=this.Ps;if(i!==t){this.zN(t,$t,"linkDataArray"),this.Di.clear();const s=t.length;for(let o=0;o<s;o++){const r=t[o];b.G(r)||b.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+r)}if(this.Ps=t,this.linkKeyProperty!==""){const o=new J;for(let h=0;h<s;h++){const a=t[h],l=this.getKeyForLinkData(a);l===void 0||this.Di.get(l)!==null?o.add(a):this.Di.set(l,a)}const r=o.iterator;for(;r.next();){const h=r.value;this.makeLinkDataKeyUnique(h);const a=this.getKeyForLinkData(h);a!==void 0&&this.Di.set(a,h)}}const n=new K;for(let o=0;o<s;o++){const r=t[o];n.add(r)}this.Zo=n,this.vt("linkDataArray",2,"linkDataArray",this,i,t);for(let o=0;o<s;o++){const r=t[o];this.KN(r)}}}get linkKeyProperty(){return this.Dh}set linkKeyProperty(t){const i=this.Dh;if(i!==t){this.Pn(t,$t,"linkKeyProperty"),this.Dh=t,this.Di.clear();const s=this.linkDataArray.length;for(let n=0;n<s;n++){const o=this.linkDataArray[n];let r=this.getKeyForLinkData(o);r===void 0&&(this.makeLinkDataKeyUnique(o),r=this.getKeyForLinkData(o)),r!==void 0&&this.Di.set(r,o)}this.t("linkKeyProperty",i,t)}}getKeyForLinkData(t){if(t===null)return;const i=this.Dh;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("Key value for link data "+t+" is not a number or a string: "+s)}}setKeyForLinkData(t,i){if((i==null||!this.isKeyType(i))&&b.Zi(i,"number or string",$t,"setKeyForLinkData:key"),t===null)return;const s=this.Dh;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);if(n!==i){if(this.findLinkDataForKey(i)!==null)return;this.Z(t,s,i),n!==void 0&&this.Di.delete(n),this.Di.set(i,t),this.vt("linkKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}get makeUniqueLinkKeyFunction(){return this.Rf}set makeUniqueLinkKeyFunction(t){const i=this.Rf;i!==t&&(this.Rf=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return t===null&&b.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.Di.get(t)}G1(t){return t===void 0?!1:this.Di.has(t)}makeLinkDataKeyUnique(t){if(t===null)return;const i=this.Dh;if(i==="")return;let s=this.getKeyForLinkData(t);if(s!==void 0&&!this.G1(s))return;const n=this.Rf;if(n!==null&&(s=n(this,t),s!=null&&!this.G1(s))){this.Z(t,i,s);return}if(typeof s=="string"){let o=2;for(;this.G1(s+o);)o++;this.Z(t,i,s+o)}else if(s===void 0||typeof s=="number"){let o=-this.Di.count-1;for(;this.G1(o);)o--;this.Z(t,i,o)}}containsLinkData(t){return t===null?!1:this.Zo.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.jT(t,!0))}jT(t,i){if(this.linkKeyProperty!==""){let n=this.getKeyForLinkData(t);if(n===void 0)this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t);else{if(this.Di.get(n)===t)return;this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t)}n===void 0&&b.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Di.set(n,t)}this.Zo.add(t);let s=null;i&&(s=this.Ps.length,this.$o(this.Ps,s,t)),this.vt("linkDataArray",3,"linkDataArray",this,null,t,null,s),this.KN(t)}addLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.addLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.addLinkData(s)}}}removeLinkData(t){t!==null&&this.KT(t,!0)}KT(t,i){this.Zo.delete(t);const s=this.getKeyForLinkData(t);s!==void 0&&this.Di.delete(s);let n=null;if(i){if(n=this.Ps.indexOf(t),n<0)return;this.go(this.Ps,n)}this.vt("linkDataArray",4,"linkDataArray",this,t,null,n,null),this.ZO(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.removeLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.removeLinkData(s)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&b.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const i=new K;i.addAll(this.Di.iteratorKeys);const s=new K,n=t.length;for(let r=0;r<n;r++){const h=t[r],a=this.getKeyForLinkData(h);if(a!==void 0){s.add(a);const l=this.findLinkDataForKey(a);if(l===h)continue;if(l!==null)this.assignAllDataProperties(l,h),this.hD(h,l);else{const u=this.cloneDeep(h);this.setKeyForLinkData(u,a),this.addLinkData(u)}}else{const l=this.cloneDeep(h);this.addLinkData(l),s.add(this.getKeyForLinkData(l))}}const o=i.iterator;for(;o.next();){const r=o.value;if(!s.has(r)){const h=this.findLinkDataForKey(r);h&&this.removeLinkData(h)}}}KN(t){let i=this.Ae(t,!0);i=this.GN(i),this.findNodeDataForKey(i)===null&&this.Js(i,t),i=this.Ae(t,!1),i=this.GN(i),this.findNodeDataForKey(i)===null&&this.Js(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.findNodeDataForKey(i)===null&&this.Js(i,t)}}ZO(t){let i=this.Ae(t,!0);this.Ws(i,t),i=this.Ae(t,!1),this.Ws(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.Ws(i,t)}}get copyLinkDataFunction(){return this.vf}set copyLinkDataFunction(t){const i=this.vf;i!==t&&(this.vf=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){if(t===null)return null;let i=null;const s=this.vf;return s!==null?i=s(t,this):i=this.Y1(t,!0),b.G(i)&&(this.mo!==""&&this.Z(i,this.mo,void 0),this.po!==""&&this.Z(i,this.po,void 0),this.$s!==""&&this.Z(i,this.$s,[])),i}get nodeIsGroupProperty(){return this.Of}set nodeIsGroupProperty(t){const i=this.Of;i!==t&&(this.Pn(t,$t,"nodeIsGroupProperty"),this.Of=t,this.t("nodeIsGroupProperty",i,t))}isGroupForNodeData(t){if(t===null)return!1;const i=this.Of;return i===""?!1:!!this.yt(t,i)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Sn}set nodeGroupKeyProperty(t){const i=this.Sn;i!==t&&(this.Pn(t,$t,"nodeGroupKeyProperty"),this.Sn=t,this.t("nodeGroupKeyProperty",i,t))}get copiesGroupKeyOfNodeData(){return this.rg}set copiesGroupKeyOfNodeData(t){this.rg!==t&&(this.rg=t)}getGroupKeyForNodeData(t){if(t===null)return;const i=this.Sn;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("GroupKey value for node data "+t+" is not a number or a string: "+s)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.Zi(i,"number or string",$t,"setGroupKeyForNodeData:key"),t===null)return;const s=this.Sn;if(s==="")return;if(!this.containsNodeData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);n!==i&&(this.Ws(n,t),this.Z(t,s,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("nodeGroupKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setGroupForData(t,i){this.setGroupKeyForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Sn!==""&&this.yt(i,this.Sn)!==void 0&&this.Z(i,this.Sn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,s);return}}else if(this.containsLinkData(t)){if(i===this.linkFromKeyProperty){this.Wd(t,s,!0);return}else if(i===this.linkToKeyProperty){this.Wd(t,s,!1);return}else if(i===this.linkFromPortIdProperty){this.Jd(t,s,!0);return}else if(i===this.linkToPortIdProperty){this.Jd(t,s,!1);return}else if(i===this.linkKeyProperty){this.setKeyForLinkData(t,s);return}else if(i===this.linkCategoryProperty){this.setCategoryForLinkData(t,s);return}else if(i===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,s);return}}const n=this.yt(t,i);n!==s&&(this.Z(t,i,s),this.raiseDataChanged(t,i,n,s))}assignAllDataProperties(t,i){if(!i)return;const s=this.containsNodeData(t),n=this.containsLinkData(t);for(const o in i)if(o!=="__gohashid"&&!(s&&o===this.nodeKeyProperty)){if(s&&o===this.nodeIsGroupProperty&&this.yt(t,o)===i[o]||n&&o===this.linkKeyProperty)continue;this.setDataProperty(t,o,i[o])}}Ry(t,i){super.Ry(t,i);const s=this.mi.iterator;for(;s.next();){const o=s.value;this.jN(o,t,i)}const n=this.Zo.iterator;for(;n.next();){const o=n.value;this.QO(o,t,i)}}jN(t,i,s){if(this.getGroupKeyForNodeData(t)===i){const n=this.Sn;this.Z(t,n,s),this.vt("nodeGroupKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}QO(t,i,s){if(this.Ae(t,!0)===i){const o=this.mo;this.Z(t,o,s),this.vt("linkFromKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}if(this.Ae(t,!1)===i){const o=this.po;this.Z(t,o,s),this.vt("linkToKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}const n=this.getLabelKeysForLinkData(t);if(Array.isArray(n)){const o=n.length,r=this.$s;for(let h=0;h<o;h++)n[h]===i&&(this.iD(n,h,s),this.vt("linkLabelKeys",3,r,t,i,s,h,h))}}XN(){super.XN();const t=this.linkDataArray,i=t.length;for(let s=0;s<i;s++){const n=t[s];this.KN(n)}}ng(t){super.ng(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=b.et(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)){if(this.getGroupKeyForNodeData(r)===i){const h=this.Sn;this.vt("nodeGroupKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}}else{if(this.Ae(r,!0)===i){const a=this.mo;this.vt("linkFromKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}if(this.Ae(r,!1)===i){const a=this.po;this.vt("linkToKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}const h=this.getLabelKeysForLinkData(r);if(Array.isArray(h)){const a=h.length,l=this.$s;for(let u=0;u<a;u++)h[u]===i&&(this.vt("linkLabelKeys",3,l,r,i,i,u,u),n.push(r))}}}for(let r=0;r<n.length;r++)this.Ws(i,n[r]);b.J(n)}}og(t){super.og(t);const i=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(i)===null&&this.Js(i,t)}vy(t){super.vy(t);const i=this.getGroupKeyForNodeData(t);this.Ws(i,t)}get linkCategoryProperty(){return this.qa}set linkCategoryProperty(t){const i=this.qa;i!==t&&(this.Pn(t,$t,"linkCategoryProperty"),this.qa=t,this.t("linkCategoryProperty",i,t))}getCategoryForLinkData(t){if(t===null)return"";const i=this.qa;if(i==="")return"";const s=this.yt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;b.o("getCategoryForLinkData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(t===null)return;const s=this.qa;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);n===void 0&&(n=""),n!==i&&(this.Z(t,s,i),this.vt("linkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setCategoryForLinkData(t,i)}sg(t,i){super.sg(t,i),this.setGroupKeyForNodeData(i,this.getGroupKeyForNodeData(t))}hD(t,i){this.setCategoryForLinkData(i,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(i,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(i,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(i,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(i,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(i,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}mm(){return!0}Ra(){return!0}Xw(){return!0}Hc(){return!0}};g($t,"EmptyArray",Object.freeze([]));let xi=$t;It.fl(xi,"GraphLinksModel"),It.tD=()=>new xi,It.LM=()=>new xi;class wi extends It{constructor(t,i){super();g(this,"Mn");g(this,"lg");g(this,"Wa");if(this.Mn="parent",this.lg=!1,this.Wa="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Mn=this.Mn,t.lg=this.lg,t.Wa=this.Wa}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" TreeModel";if(t>0){i+=`
 node data:`;const s=this.nodeDataArray,n=s.length;for(let o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+Ke.toString(r)}}return i}}eg(){const t=super.eg();let i="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(i+=`,
  "nodeParentKeyProperty": `+this.De(this.nodeParentKeyProperty)),t+i}Dy(t){super.Dy(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Fy(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&b.o("applyIncrementalJson cannot change Model properties"),super.Fy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Mn}set nodeParentKeyProperty(t){const i=this.Mn;i!==t&&(this.Pn(t,wi,"nodeParentKeyProperty"),this.Mn=t,this.t("nodeParentKeyProperty",i,t))}get copiesParentKeyOfNodeData(){return this.lg}set copiesParentKeyOfNodeData(t){this.lg!==t&&(this.lg=t)}getParentKeyForNodeData(t){if(t===null)return;const i=this.Mn;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;b.o("ParentKey value for node data "+t+" is not a number or a string: "+s)}}setParentKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&b.Zi(i,"number or string",wi,"setParentKeyForNodeData:key"),t===null)return;const s=this.Mn;if(s==="")return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);n!==i&&(this.Ws(n,t),this.Z(t,s,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("nodeParentKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get parentLinkCategoryProperty(){return this.Wa}set parentLinkCategoryProperty(t){const i=this.Wa;i!==t&&(this.Pn(t,wi,"parentLinkCategoryProperty"),this.Wa=t,this.t("parentLinkCategoryProperty",i,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const i=this.Wa;if(i==="")return"";const s=this.yt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;b.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(t===null)return;const s=this.Wa;if(s==="")return;if(!this.containsNodeData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);n===void 0&&(n=""),n!==i&&(this.Z(t,s,i),this.vt("parentLinkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setParentLinkCategoryForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Mn!==""&&this.yt(i,this.Mn)!==void 0&&this.Z(i,this.Mn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,s);return}else if(i===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,s);return}}const n=this.yt(t,i);n!==s&&(this.Z(t,i,s),this.raiseDataChanged(t,i,n,s))}Ry(t,i){super.Ry(t,i);const s=this.mi.iterator;for(;s.next();){const n=s.value;this.jN(n,t,i)}}jN(t,i,s){if(this.getParentKeyForNodeData(t)===i){const n=this.Mn;this.Z(t,n,s),this.vt("nodeParentKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}ng(t){super.ng(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=b.et(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)&&this.getParentKeyForNodeData(r)===i){const h=this.Mn;this.vt("nodeParentKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}}for(let r=0;r<n.length;r++)this.Ws(i,n[r]);b.J(n)}}og(t){super.og(t);let i=this.getParentKeyForNodeData(t);i=this.maybeEnsureLinkReference(i),this.findNodeDataForKey(i)===null&&this.Js(i,t)}vy(t){super.vy(t);const i=this.getParentKeyForNodeData(t);this.Ws(i,t)}sg(t,i){super.sg(t,i),this.setParentLinkCategoryForNodeData(i,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(i,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}pm(){return!0}Xw(){return!0}}It.fl(wi,"TreeModel");var ws=(w=>(w[w.ConstantSpacing=0]="ConstantSpacing",w[w.ConstantDistance=1]="ConstantDistance",w[w.ConstantAngle=2]="ConstantAngle",w[w.Packed=3]="Packed",w))(ws||{}),bs=(w=>(w[w.Clockwise=10]="Clockwise",w[w.Counterclockwise=11]="Counterclockwise",w[w.BidirectionalLeft=12]="BidirectionalLeft",w[w.BidirectionalRight=13]="BidirectionalRight",w))(bs||{}),vs=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w[w.Optimized=24]="Optimized",w))(vs||{}),ks=(w=>(w[w.Pythagorean=30]="Pythagorean",w[w.Circular=31]="Circular",w))(ks||{});class le extends ne{constructor(t){super();g(this,"le");g(this,"If");g(this,"K1");g(this,"hg");g(this,"j1");g(this,"Fh");g(this,"HN");g(this,"qN");g(this,"WN");g(this,"Ss");g(this,"Oy");g(this,"Iy");g(this,"Ja");g(this,"Ey");g(this,"aD");g(this,"ag");g(this,"cg");g(this,"fg");g(this,"Ef");g(this,"Xi");g(this,"b");g(this,"pe");g(this,"ye");g(this,"kn");g(this,"ug");this.le=0,this.If=0,this.K1=0,this.hg=360,this.j1=0,this.Fh=0,this.HN=new S,this.qN=30,this.WN=0,this.Ss=0,this.Oy=0,this.Iy=new rn,this.Ja=0,this.Ey=0,this.aD=600,this.ag=NaN,this.cg=1,this.fg=0,this.Ef=360,this.Xi=0,this.b=10,this.pe=24,this.ye=Ze.standardComparer,this.kn=6,this.ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ag=this.ag,t.cg=this.cg,t.fg=this.fg,t.Ef=this.Ef,t.Xi=this.Xi,t.b=this.b,t.pe=this.pe,t.ye=this.ye,t.kn=this.kn,t.ug=this.ug}oi(t){t in vs?this.sorting=t:t in bs?this.direction=t:t in ws?this.arrangement=t:t in ks?this.nodeDiameterFormula=t:super.oi(t)}createNetwork(){return new hn(this)}_O(t,i,s){t=this.tI(t);let n=this.j1,o=this.qN,r=this.le,h=this.If,a=this.K1,l=this.hg,u=this.Fh,c=this.WN,d=this.Ss,f=this.Oy;if(n=this.arrangement,o=this.nodeDiameterFormula,r=this.radius,(!isFinite(r)||r<=0)&&(r=NaN),h=this.aspectRatio,(!isFinite(h)||h<=0)&&(h=1),a=this.startAngle,isFinite(a)||(a=0),l=this.sweepAngle,(!isFinite(l)||l>360||l<1)&&(l=360),u=this.spacing,isFinite(u)||(u=NaN),n===3&&o===31?n=0:n===3&&o!==31&&(o=31,n=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let y=0;!(y>=t.length||(i.add(t.elt(y)),y+1>=t.length));y+=2)s.add(t.elt(y+1));this.direction===12?(this.arrangement===3&&i.reverse(),t=new J,t.addAll(i),t.addAll(s)):(this.arrangement===3&&s.reverse(),t=new J,t.addAll(s),t.addAll(i))}const m=t.length;c=0;let p=0;for(let y=0;y<t.length;y++){const x=a+l*p*(this.direction===10?1:-1)/m;let P=t.elt(y).diameter;isNaN(P)&&(P=t.elt(y).Rh(x)),l<360&&(y===0||y===t.length-1)&&(P/=2),c+=P,p++}if(isNaN(r)||n===3){if(isNaN(u)&&(u=6),n!==0&&n!==3){let y=-1/0;for(let x=0;x<m;x++){const P=t.elt(x),k=t.elt(x===m-1?0:x+1);isNaN(P.diameter)&&P.Rh(0),isNaN(k.diameter)&&k.Rh(0),y=Math.max(y,(P.diameter+k.diameter)/2)}if(f=y+u,n===2){const x=2*Math.PI/m,P=(y+u)/x;h>1?(r=P,d=r*h):(d=P,r=d)}else r=this.H1(f*(l>=360?m:m-1),h,a*Math.PI/180,l*Math.PI/180)}else r=this.H1(c+(l>=360?m:m-1)*(n!==3?u:u*1.6),h,a*Math.PI/180,l*Math.PI/180);d=r*h}else{d=r*h;const y=this.JN(r,d,a*Math.PI/180,l*Math.PI/180);if(isNaN(u))n===0&&(u=(y-c)/(l>=360?m:m-1));else if(n===0){const x=(y-c)/(l>=360?m:m-1);x<u?(r=this.H1(c+u*(l>=360?m:m-1),h,a*Math.PI/180,l*Math.PI/180),d=r*h):u=x}else{let x=-1/0;for(let v=0;v<m;v++){const N=t.elt(v),M=t.elt(v===m-1?0:v+1);isNaN(N.diameter)&&N.Rh(0),isNaN(M.diameter)&&M.Rh(0),x=Math.max(x,(N.diameter+M.diameter)/2)}const P=x+u,k=this.H1(P*(l>=360?m:m-1),h,a*Math.PI/180,l*Math.PI/180);k>r?(r=k,d=r*h,f=P):f=y/(l>=360?m:m-1)}}return this.j1=n,this.qN=o,this.le=r,this.If=h,this.K1=a,this.hg=l,this.Fh=u,this.WN=c,this.Ss=d,this.Oy=f,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(i.count===1){const f=i.first();f.centerX=0,f.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let s=new J;s.addAll(i.iterator);const n=new J,o=new J;s=this._O(s,n,o);const r=this.j1,h=this.le,a=this.K1,l=this.hg,u=this.Fh,c=this.Ss,d=this.Oy;if((this.direction===12||this.direction===13)&&r===3)this.cD(s,l,a-l/2,10);else if(this.direction===12||this.direction===13){let f=0;switch(r){case 1:f=this.q1(h,c,a,d)*180/Math.PI;break;case 0:{let m=0,p=0;const y=n.first();y!==null&&(m=y.Rh(Math.PI/2));const x=o.first();x!==null&&(p=x.Rh(Math.PI/2)),f=this.q1(h,c,a,u+(m+p)/2)*180/Math.PI;break}case 2:f=l/s.length;break}if(this.direction===12){switch(r){case 1:this.Uy(n,l/2,a,11);break;case 0:this.By(n,l/2,a,11);break;case 2:this.Vy(n,l/2,a,11);break}switch(r){case 1:this.Uy(o,l/2,a+f,10);break;case 0:this.By(o,l/2,a+f,10);break;case 2:this.Vy(o,l/2,a+f,10);break}}else{switch(r){case 1:this.Uy(o,l/2,a,11);break;case 0:this.By(o,l/2,a,11);break;case 2:this.Vy(o,l/2,a,11);break}switch(r){case 1:this.Uy(n,l/2,a+f,10);break;case 0:this.By(n,l/2,a+f,10);break;case 2:this.Vy(n,l/2,a+f,10);break}}}else switch(r){case 1:this.Uy(s,l,a,this.direction);break;case 0:this.By(s,l,a,this.direction);break;case 2:this.Vy(s,l,a,this.direction);break;case 3:this.cD(s,l,a,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}Vy(t,i,s,n){const o=this.hg,r=this.le,h=this.Ss,a=s*Math.PI/180,l=i*Math.PI/180,u=t.length;for(let c=0;c<u;c++){const d=a+(n===10?c*l/(o>=360?u:u-1):-(c*l)/u),f=t.elt(c),m=r*Math.tan(d)/h,p=Math.sqrt((r*r+h*h*m*m)/(1+m*m));f.centerX=p*Math.cos(d),f.centerY=p*Math.sin(d),f.actualAngle=d*180/Math.PI}}By(t,i,s,n){const o=this.le,r=this.Ss,h=this.Fh;let a=s*Math.PI/180;const l=t.length;for(let u=0;u<l;u++){const c=t.elt(u),d=t.elt(u===l-1?0:u+1),f=o*Math.cos(a),m=r*Math.sin(a);c.centerX=f,c.centerY=m,c.actualAngle=a*180/Math.PI,isNaN(c.diameter)&&c.Rh(0),isNaN(d.diameter)&&d.Rh(0);const p=(c.diameter+d.diameter)/2,y=this.q1(o,r,n===10?a:-a,p+h);a+=n===10?y:-y}}Uy(t,i,s,n){const o=this.le,r=this.Ss,h=this.Oy;let a=s*Math.PI/180;const l=t.length;for(let u=0;u<l;u++){const c=t.elt(u);c.centerX=o*Math.cos(a),c.centerY=r*Math.sin(a),c.actualAngle=a*180/Math.PI;const d=this.q1(o,r,n===10?a:-a,h);a+=n===10?d:-d}}cD(t,i,s,n){let o=this.Ey;const r=this.hg;if(this.Ja=0,this.Iy=new rn,i<360){for(o=s+(n===10?r:-r);o<0;)o+=360;o%=360,o>180&&(o-=360),o*=Math.PI/180,this.Ey=o,this.fD(t,i,s,n)}else this.uD(t,i,s,n);this.Iy.commit(t)}uD(t,i,s,n){const o=this.le,r=this.Ss,h=this.Fh,a=this.If;let l=o*Math.cos(s*Math.PI/180),u=r*Math.sin(s*Math.PI/180);const c=t.toArray();if(c.length===3){c[0].centerX=o,c[0].centerY=0,c[1].centerX=c[0].centerX-c[0].width/2-c[1].width/2-h,c[1].y=c[0].y,c[2].centerX=(c[0].centerX+c[1].centerX)/2,c[2].y=c[0].y-c[2].height-h;return}else if(c.length===4){c[0].centerX=o,c[0].centerY=0,c[2].centerX=-c[0].centerX,c[2].centerY=c[0].centerY,c[1].centerX=0,c[1].y=Math.min(c[0].y,c[2].y)-c[1].height-h,c[3].centerX=0,c[3].y=Math.max(c[0].y+c[0].height+h,c[2].y+c[2].height+h);return}const d=S.l();for(let N=0;N<c.length&&(c[N].centerX=l,c[N].centerY=u,!(N>=c.length-1));N++)this.dD(l,u,c,N,n,d)||this.gD(l,u,c,N,n,d),l=d.x,u=d.y;if(S.e(d),this.Ja++,this.Ja>23)return;const f=c[0].centerX,m=c[0].centerY,p=c[c.length-1].centerX,y=c[c.length-1].centerY;let x=Math.abs(f-p)-((c[0].width+c[c.length-1].width)/2+h);const P=Math.abs(m-y)-((c[0].height+c[c.length-1].height)/2+h);let k=0;if(Math.abs(P)<1){const N=Math.abs(f-p),M=(c[0].width+c[c.length-1].width)/2;N<M&&(k=0),x=N-M}else P>0?k=P:Math.abs(x)<1?k=0:k=x;let v=!1;Math.abs(p)>Math.abs(y)?v=p>0!=m>y:v=y>0!=f<p,v=n===10?v:!v,v&&(k=-Math.abs(k),k=Math.min(k,-c[c.length-1].width),k=Math.min(k,-c[c.length-1].height)),this.Iy.iI(k,c),Math.abs(k)>1&&(this.Ja<8?this.le-=k/(2*Math.PI):c.length<5&&k>10?this.le/=2:this.le-=k>0?1.7:-2.3,this.Ss=this.le*a,this.uD(t,i,s,n))}fD(t,i,s,n){const o=this.le,r=this.Ss,h=this.If;let a=o*Math.cos(s*Math.PI/180),l=r*Math.sin(s*Math.PI/180);const u=S.l(),c=t.toArray();for(let p=0;p<c.length&&(c[p].centerX=a,c[p].centerY=l,!(p>=c.length-1));p++)this.dD(a,l,c,p,n,u)||this.gD(a,l,c,p,n,u),a=u.x,l=u.y;if(S.e(u),this.Ja++,this.Ja>23)return;const d=Math.atan2(l,a);let f=n===10?this.Ey-d:d-this.Ey;f=Math.abs(f)<Math.abs(f-2*Math.PI)?f:f-2*Math.PI;const m=f*(o+r)/2;this.Iy.eI(m,c),Math.abs(m)>1&&(this.Ja<8?this.le-=m/(2*Math.PI):this.le-=m>0?1.7:-2.3,this.Ss=this.le*h,this.fD(t,i,s,n))}dD(t,i,s,n,o,r){const h=this.Fh,a=this.le,l=this.Ss;let u=0,c=0;const d=(s[n].width+s[n+1].width)/2+h;let f=!1;if(i>=0!=(o===10)){if(u=t+d,u>a){if(u=t-d,u<-a)return r.x=u,r.y=c,!1;f=!0}}else if(u=t-d,u<-a){if(u=t+d,u>a)return r.x=u,r.y=c,!1;f=!0}return c=Math.sqrt(1-Math.min(1,u*u/(a*a)))*l,i<0!==f&&(c=-c),Math.abs(i-c)>(s[n].height+s[n+1].height)/2?(r.x=u,r.y=c,!1):(r.x=u,r.y=c,!0)}gD(t,i,s,n,o,r){const h=this.Fh,a=this.le,l=this.Ss;let u=0,c=0;const d=(s[n].height+s[n+1].height)/2+h;let f=!1;if(t>=0!=(o===10)){if(c=i-d,c<-l){if(c=i+d,c>l)return r.x=u,r.y=c,!1;f=!0}}else if(c=i+d,c>l){if(c=i-d,c<-l)return r.x=u,r.y=c,!1;f=!0}return u=Math.sqrt(1-Math.min(1,c*c/(l*l)))*a,t<0!==f&&(u=-u),Math.abs(t-u)>(s[n].width+s[n+1].width)/2?(r.x=u,r.y=c,!1):(r.x=u,r.y=c,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let s=this.actualCenter;t?s=new S(0,0):(s.x=this.arrangementOrigin.x+this.le,s.y=this.arrangementOrigin.y+this.Ss);const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;o.x+=s.x,o.y+=s.y,o.commit()}if(t){this.group.ensureBounds();const o=this.group.position.copy(),r=this.group.location.copy(),h=i.subtract(r.subtract(o));this.group.move(h),this.HN=h.subtract(o)}}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}JN(t,i,s,n){const o=this.aD;if(Math.abs(this.If-1)<.001)return s!==void 0&&n!==void 0?n*t:2*Math.PI*t;const r=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let h=0,a=0;s!==void 0&&n!==void 0?a=n/(o+1):a=Math.PI/(2*(o+1));let l=0;for(let u=0;u<=o;u++){s!==void 0&&n!==void 0?l=s+u*n/o:l=u*Math.PI/(2*o);const c=Math.sin(l);h+=Math.sqrt(1-r*r*c*c)*a}return s!==void 0&&n!==void 0?(t>i?t:i)*h:4*(t>i?t:i)*h}H1(t,i,s,n){let o=0;return s!==void 0&&n!==void 0?o=this.JN(1,i,s,n):o=this.JN(1,i),t/o}q1(t,i,s,n){if(Math.abs(this.If-1)<.001)return n/t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let r=0;const h=2*Math.PI/(this.network.vertexes.count*700);t>i&&(s+=Math.PI/2);for(let a=0;;a++){const l=s+a*h,u=Math.sin(l);if(r+=(t>i?t:i)*Math.sqrt(1-o*o*u*u)*h,r>=n)return a*h}}tI(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.sI(this.nI(t));default:b.o("Invalid sorting type.")}return t}nI(t){const i=[];for(let n=0;n<t.length;n++)i.push(0);const s=new J;for(let n=0;n<t.length;n++){let o=-1,r=-1;if(n===0)for(let c=0;c<t.length;c++){const d=t.elt(c).edgesCount;d>o&&(o=d,r=c)}else for(let c=0;c<t.length;c++){const d=i[c];d>o&&(o=d,r=c)}s.add(t.elt(r)),i[r]=-1;const h=t.elt(r);let a=0;const l=h.sourceEdges;for(;l.next();){const c=l.value.fromVertex;a=t.indexOf(c),!(a<0)&&i[a]>=0&&i[a]++}const u=h.destinationEdges;for(;u.next();){const c=u.value.toVertex;a=t.indexOf(c),!(a<0)&&i[a]>=0&&i[a]++}}return s}sI(t){const i=[];for(let d=0;d<t.length;d++){const f=t.elt(d);i[d]=[];let m=0;const p=f.destinationEdges;for(;p.next();){const x=p.value.toVertex;m=t.indexOf(x),m!==d&&i[d].indexOf(m)<0&&i[d].push(m)}const y=f.sourceEdges;for(;y.next();){const x=y.value.fromVertex;m=t.indexOf(x),m!==d&&i[d].indexOf(m)<0&&i[d].push(m)}}const s=[];for(let d=0;d<i.length;d++)s[d]=0;const n=[],o=[],r=[],h=[],a=new J;let l=0;for(let d=0;d<i.length;d++){const f=i[d].length;if(f===1){h.push(d);continue}if(f===0){a.add(t.elt(d));continue}if(l===0){n.push(d),l++;continue}let m=1/0,p=1/0,y=-1;const x=[];for(let P=0;P<n.length;P++)i[n[P]].indexOf(n[P===n.length-1?0:P+1])<0&&x.push(P===n.length-1?0:P+1);if(x.length===0)for(let P=0;P<n.length;P++)x.push(P);for(let P=0;P<x.length;P++){const k=x[P],v=this.oI(i[d],o,r,s,k,n);let N=0;for(let M=0;M<i[d].length;M++){const C=i[d][M],F=n.indexOf(C);if(F>=0){const T=Math.abs(k-(F>=k?F+1:F));N+=T<n.length+1-T?T:n.length+1-T}}for(let M=0;M<o.length;M++){let C=s[o[M]],F=s[r[M]];if(C>=k&&C++,F>=k&&F++,C>F){const T=F;F=C,C=T}F-C<(n.length+2)/2==(C<k&&k<=F)&&N++}(v<m||v===m&&N<p)&&(m=v,p=N,y=k)}n.splice(y,0,d);for(let P=0;P<n.length;P++)s[n[P]]=P;for(let P=0;P<i[d].length;P++){const k=i[d][P];n.indexOf(k)>=0&&(o.push(d),r.push(k))}l++}let u=!1;const c=n.length;for(;;){u=!0;for(let d=0;d<h.length;d++){const f=h[d],m=i[f][0],p=n.indexOf(m);if(p>=0){let y=0;for(let x=0;x<i[m].length;x++){const P=i[m][x],k=n.indexOf(P);if(k<0||k===p)continue;const v=k>p?k-p:p-k,N=c-v;y+=k<p!=v>N?1:-1}n.splice(y<0?p:p+1,0,f),h.splice(d,1),d--}else u=!1}if(u)break;n.push(h[0]),h.splice(0,1)}for(let d=0;d<n.length;d++){const f=n[d];a.add(t.elt(f))}return a}oI(t,i,s,n,o,r){let h=0;for(let a=0;a<i.length;a++){const l=i[a],u=s[a],c=n[l],d=n[u];let f=0,m=0;if(c<d?(f=c,m=d):(f=d,m=c),f<o&&o<=m)for(let p=0;p<t.length;p++){const y=t[p];r.indexOf(y)<0||f<n[y]&&n[y]<m||f===n[y]||m===n[y]||h++}else for(let p=0;p<t.length;p++){const y=t[p];r.indexOf(y)<0||!(f<n[y]&&n[y]<m)||f===n[y]||m===n[y]||h++}}return h}get radius(){return this.ag}set radius(t){this.ag!==t&&(t>0||isNaN(t))&&(this.ag=t,this.invalidateLayout())}get aspectRatio(){return this.cg}set aspectRatio(t){this.cg!==t&&t>0&&(this.cg=t,this.invalidateLayout())}get startAngle(){return this.fg}set startAngle(t){this.fg!==t&&(this.fg=t,this.invalidateLayout())}get sweepAngle(){return this.Ef}set sweepAngle(t){this.Ef!==t&&(t>0&&t<=360?this.Ef=t:this.Ef=360,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===3||t===0||t===1||t===2)&&(this.Xi=t,this.invalidateLayout())}get direction(){return this.b}set direction(t){this.b!==t&&(t===10||t===11||t===12||t===13)&&(this.b=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}get spacing(){return this.kn}set spacing(t){this.kn!==t&&(this.kn=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.ug}set nodeDiameterFormula(t){this.ug!==t&&(t===30||t===31)&&(this.ug=t,this.invalidateLayout())}get actualXRadius(){return this.le}get actualYRadius(){return this.Ss}get actualSpacing(){return this.Fh}get actualCenter(){return this.HN}}g(le,"ConstantSpacing",0),g(le,"ConstantDistance",1),g(le,"ConstantAngle",2),g(le,"Packed",3),g(le,"Clockwise",10),g(le,"Counterclockwise",11),g(le,"BidirectionalLeft",12),g(le,"BidirectionalRight",13),g(le,"Forwards",20),g(le,"Reverse",21),g(le,"Ascending",22),g(le,"Descending",23),g(le,"Optimized",24),g(le,"Pythagorean",30),g(le,"Circular",31);class rn{constructor(){g(this,"Uf");g(this,"$a");g(this,"Bf");this.Uf=-1/0,this.$a=null,this.Bf=null}iI(e,t){if(e>0&&this.Uf<0||Math.abs(e)<Math.abs(this.Uf)&&!(e<0&&this.Uf>0)){this.Uf=e,this.$a=[],this.Bf=[];for(let i=0;i<t.length;i++)this.$a[i]=t[i].bounds.x,this.Bf[i]=t[i].bounds.y}}eI(e,t){if(Math.abs(e)<Math.abs(this.Uf)){this.Uf=e,this.$a=[],this.Bf=[];for(let i=0;i<t.length;i++)this.$a[i]=t[i].bounds.x,this.Bf[i]=t[i].bounds.y}}commit(e){if(!(this.$a===null||this.Bf===null))for(let t=0;t<this.$a.length;t++){const i=e.elt(t);i.x=this.$a[t],i.y=this.Bf[t]}}}class hn extends $e{constructor(e){super(e)}createVertex(){return new an(this)}createEdge(){return new ln(this)}}class an extends Ze{constructor(t){super(t);g(this,"yo");g(this,"W1");this.yo=NaN,this.W1=NaN}Rh(t){const i=this.network;if(i===null)return NaN;const s=i.layout;if(s===null)return NaN;if(s.arrangement===3){if(s.nodeDiameterFormula===31)return this.yo=Math.max(this.width,this.height),this.yo;{const n=Math.abs(Math.sin(t)),o=Math.abs(Math.cos(t));return n===0?this.width:o===0?this.height:(this.yo=Math.min(this.height/n,this.width/o),this.yo)}}else return s.nodeDiameterFormula===31?(this.yo=Math.max(this.width,this.height),this.yo):(this.yo=Math.sqrt(this.width*this.width+this.height*this.height),this.yo)}get diameter(){return this.yo}set diameter(t){this.yo!==t&&(this.yo=t)}get actualAngle(){return this.W1}set actualAngle(t){this.W1!==t&&(this.W1=t)}}class ln extends pi{constructor(e){super(e)}}class Hn extends ne{constructor(t){super();g(this,"zy");g(this,"vh");g(this,"Ms");g(this,"dg");g(this,"Nn");g(this,"Fe");g(this,"gg");g(this,"mg");g(this,"pg");g(this,"Vf");g(this,"yg");g(this,"wg");g(this,"zf");g(this,"Xf");g(this,"Yf");g(this,"Gf");g(this,"xg");g(this,"bg");g(this,"Kf");g(this,"Za");this.zy=0,this.vh=0,this.Ms=new ot(100,100).u(),this.dg=!1,this.Nn=!0,this.Fe=!1,this.gg=100,this.mg=300,this.pg=1,this.Vf=1e3,this.yg=10,this.wg=Math,this.zf=.05,this.Xf=50,this.Yf=150,this.Gf=0,this.xg=10,this.bg=5,this.Kf=NaN,this.Za=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ms.a(this.Ms),t.dg=this.dg,t.Nn=this.Nn,t.Fe=this.Fe,t.gg=this.gg,t.mg=this.mg,t.pg=this.pg,t.Vf=this.Vf,t.yg=this.yg,t.wg=this.wg,t.zf=this.zf,t.Xf=this.Xf,t.Yf=this.Yf,t.Gf=this.Gf,t.xg=this.xg,t.bg=this.bg,t.Kf=this.Kf,t.Za=this.Za}createNetwork(){return new un(this)}doLayout(t){this.network=this.makeNetwork(t);let i=this.network.vertexes.iterator;const s=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),i=this.network.vertexes.iterator;i.next();){const o=i.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const n=this.network.edges.iterator;for(;n.next();){const o=n.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.$N(),this.vh=0,this.needsPrelayout()){const o=this.network,r=o.splitIntoSubNetworks(!1);let h=r.iterator;for(;h.next();){const a=h.value;this.doConnectedSubnetLayout(a)}for(h=r.iterator,this.rI(h,o),h=r.iterator;h.next();){const a=h.value,l=a.vertexes.iterator;for(;l.next();){const c=l.value;o.addVertex(c)}const u=a.edges.iterator;for(;u.next();){const c=u.value;o.addEdge(c)}}}else this.mD(this.network,this.maxIterations);this.updateParts()}this.maxIterations=s,this.isValidLayout=!0}needsPrelayout(){if(this.network===null||this.network.vertexes.count<3)return!1;let t=0,i=0;const s=this.network.vertexes.first().bounds,n=this.network.vertexes.iterator;for(;n.next();){const o=n.value,r=o.bounds;if(isNaN(o.x)||isNaN(o.y)||r.intersectsRect(s)&&(t++,t>2))return!0;if(i>10)return!1;i++}return!1}doConnectedSubnetLayout(t){let i=t.vertexes.iterator;for(;i.next();){const a=i.value;a.hierarchicalVertexes.add(a)}let s=t,n=this.Kf;if(isNaN(n)&&(n=t.edges.count/t.vertexes.count),n<t.vertexes.count)for(;s.vertexes.count>Math.max(100,Math.sqrt(n*t.vertexes.count));)s=this.coarsenNetwork(s);let o=0;i=s.vertexes.iterator;let r=this.randomNumberGenerator;for(r===null&&(this.randomNumberGenerator=r=new gn(0));i.next();){i.value.idInCluster=o++;const a=10*(r.random()-.5),l=10*(r.random()-.5);this.isFixed(i.value)||(i.value.x=a,i.value.y=l);const u=i.value.hierarchicalVertexes.iterator;for(;u.next();)this.isFixed(u.value)||(u.value.x=a,u.value.y=l)}const h=this.computePairwiseDistances(s);this.lI(s,h,this.maxPrelayoutIterations,t.vertexes.count),this.mD(t,this.maxIterations)}computePairwiseDistances(t){const i=t.vertexes.count,s=new Array(i);for(let h=0;h<i;h++)s[h]=new Array(i).fill(-1),s[h][h]=0;const n=t.vertexes.iterator;let o=new Map,r=[];for(;n.next();){const h=n.value;for(r=[h],o=new Map,o.set(h.idInCluster,0);r.length>0;){const a=r.shift(),l=a.vertexes.iterator;for(;l.next();){const u=l.value;o.has(u.idInCluster)||(o.set(u.idInCluster,o.get(a.idInCluster)+1),r.push(u))}}for(let a=0;a<i;a++){const l=Math.min(s[h.idInCluster][a],s[a][h.idInCluster]),u=o.get(a);(l<0||u<l)&&(s[h.idInCluster][a]=u,s[a][h.idInCluster]=u)}}return s}coarsenNetwork(t){const i=this.createNetwork(),s=new Map;let n=0,o=t.vertexes.iterator;for(;o.next();)o.value.idInCluster=n++;for(o=t.vertexes.iterator;o.next();){const h=o.value;if(s.has(h.idInCluster))continue;let a=Number.MAX_SAFE_INTEGER,l=null;const u=h.vertexes.iterator;for(;u.next();){const d=u.value;s.has(d.idInCluster)||d.hierarchicalVertexes.length<a&&(a=d.hierarchicalVertexes.length,l=d)}const c=i.createVertex();c.hierarchicalVertexes.addAll(h.hierarchicalVertexes),l!=null&&c.hierarchicalVertexes.addAll(l.hierarchicalVertexes),s.set(h.idInCluster,c),l!=null&&s.set(l.idInCluster,c),i.addVertex(c)}const r=t.edges.iterator;for(;r.next();){const h=r.value,a=s.get(h.fromVertex.idInCluster),l=s.get(h.toVertex.idInCluster);if(a===l)continue;const u=i.createEdge();u.fromVertex=a||null,u.toVertex=l||null,i.addEdge(u)}return i}Lw(t,i){let s=!0;const n=t.vertexes.iterator;for(;n.next();){const o=n.value;s?(s=!1,i.set(o.bounds)):i.unionRect(o.bounds)}return i}rI(t,i){const s=this.arrangementSpacing,n=t.count;let o=!0,r=0,h=0;const a=b.et();for(let d=0;d<n+i.vertexes.count+2;d++)a[d]=null;let l=0;t.reset();const u=z.l();let c;for(;t.next();){const d=t.value;if(this.Lw(d,u),o)o=!1,r=u.x+u.width/2,h=u.y+u.height/2,a[0]=new S(u.x+u.width+s.width,u.y),a[1]=new S(u.x,u.y+u.height+s.height),l=2;else{const f=this.pD(a,l,r,h,u.width,u.height,s),m=a[f],p=new S(m.x+u.width+s.width,m.y),y=new S(m.x,m.y+u.height+s.height);f+1<l&&a.splice(f+1,0,null),a[f]=p,a[f+1]=y,l++;const x=m.x-u.x,P=m.y-u.y;for(c=d.vertexes.iterator;c.next();){const k=c.value;this.isFixed(k)||(k.centerX+=x,k.centerY+=P)}}}for(z.e(u),c=i.vertexes.iterator;c.next();){const d=c.value,f=d.bounds;if(l<2){r=f.x+f.width/2,h=f.y+f.height/2,a[0]=new S(f.x+f.width+s.width,f.y),a[1]=new S(f.x,f.y+f.height+s.height),l=2;continue}const m=this.pD(a,l,r,h,f.width,f.height,s),p=a[m],y=new S(p.x+f.width+s.width,p.y),x=new S(p.x,p.y+f.height+s.height);m+1<l&&a.splice(m+1,0,null),a[m]=y,a[m+1]=x,l++,this.isFixed(d)||(d.centerX=p.x+d.width/2,d.centerY=p.y+d.height/2)}b.J(a)}pD(t,i,s,n,o,r,h){let a=9e19,l=-1;t:for(let u=0;u<i;u++){const c=t[u],d=c.x-s,f=c.y-n,m=d*d+f*f;if(m<a){for(let p=u-1;p>=0;p--)if(t[p].y>c.y&&t[p].x-c.x<o+h.width)continue t;for(let p=u+1;p<i;p++)if(t[p].x>c.x&&t[p].y-c.y<r+h.height)continue t;l=u,a=m}}return l}$N(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.node;if(i!==null){const s=i.findNodesConnected();for(;s.next();){const n=s.value;if(n.category!=="Comment"||!n.isVisible())continue;let o=this.network.findVertex(n);o===null&&(o=this.network.addNode(n)),o.charge=this.defaultCommentElectricalCharge;let r=null;const h=o.destinationEdges;for(;h.next();){const a=h.value;if(a.toVertex===t){r=a;break}}if(r===null){const a=o.sourceEdges;for(;a.next();){const l=a.value;if(l.fromVertex===t){r=l;break}}}r===null&&(r=this.network.linkVertexes(t,o,null)),r.length=this.defaultCommentSpringLength}}}yD(t,i){const s=t.bounds,n=s.x,o=s.y,r=s.width,h=s.height,a=i.bounds,l=a.x,u=a.y,c=a.width,d=a.height;if(n+r<l)if(o>u+d){const f=n+r-l,m=o-u-d;return A.Pw(f*f+m*m)}else if(o+h<u){const f=n+r-l,m=o+h-u;return A.Pw(f*f+m*m)}else return l-(n+r);else if(n>l+c)if(o>u+d){const f=n-l-c,m=o-u-d;return A.Pw(f*f+m*m)}else if(o+h<u){const f=n-l-c,m=o+h-u;return A.Pw(f*f+m*m)}else return n-(l+c);else return o>u+d?o-(u+d):o+h<u?u-(o+h):.1}mD(t,i){const s=this.vh+i;for(;this.vh<s&&(this.vh++,!!this.hI(t)););}hI(t){const i=t.vertexes.toArray();if(i.length<=0)return!1;const s=i[0];s.forceX=0,s.forceY=0;let n=s.centerX,o=n,r=s.centerY,h=r;for(let p=1;p<i.length;p++){const y=i[p];y.forceX=0,y.forceY=0;const x=y.centerX,P=y.centerY;n=Math.min(n,x),o=Math.max(o,x),r=Math.min(r,P),h=Math.max(h,P)}const a=o-n>h-r;a?i.sort((p,y)=>p===null||y===null||p===y?0:p.centerX-y.centerX):i.sort((p,y)=>p===null||y===null||p===y?0:p.centerY-y.centerY);const l=this.Vf;let u=0,c=0,d=0;for(let p=0;p<i.length;p++){const y=i[p],x=y.bounds,P=y.focus,k=x.x+P.x,v=x.y+P.y;c=y.charge*this.electricalFieldX(k,v),d=y.charge*this.electricalFieldY(k,v),c+=y.mass*this.gravitationalFieldX(k,v),d+=y.mass*this.gravitationalFieldY(k,v),y.forceX+=c,y.forceY+=d;for(let N=p+1;N<i.length;N++){const M=i[N];if(!this.shouldInteract(y,M)||N===p)continue;const C=M.bounds,F=M.focus,T=C.x+F.x,L=C.y+F.y;if(k-T>l||T-k>l){if(a)break;continue}if(v-L>l||L-v>l){if(!a)break;continue}const D=this.yD(y,M),O=2*y.charge,R=2*M.charge;if(D>1)u=O*R/(D*D),c=u*(k-T)/D,d=u*(v-L)/D;else{let I=this.randomNumberGenerator;I===null&&(this.randomNumberGenerator=I=new gn(0));const X=I.random(),j=I.random();if(k>T)c=Math.abs(M.bounds.right-y.bounds.x),c=O*R*(1+c)*X;else if(k<T)c=Math.abs(M.bounds.x-y.bounds.right),c=-(O*R)*(1+c)*X;else{const V=Math.max(M.width,y.width);c=O*R*((1+V)*X-V/2)}if(v>L)d=Math.abs(M.bounds.bottom-y.bounds.y),d=O*R*(1+d)*j;else if(k<T)d=Math.abs(M.bounds.y-y.bounds.bottom),d=-(O*R)*(1+d)*j;else{const V=Math.max(M.height,y.height);d=O*R*((1+V)*j-V/2)}}y.forceX+=c,y.forceY+=d,M.forceX-=c,M.forceY-=d}}const f=t.edges.iterator;for(;f.next();){const p=f.value,y=p.fromVertex,x=p.toVertex,P=y.bounds,k=y.focus,v=P.x+k.x,N=P.y+k.y,M=x.bounds,C=x.focus,F=M.x+C.x,T=M.y+C.y,L=this.yD(y,x);L>1&&(u=.1*p.stiffness*(L-p.length),c=u*.5*(y.width+x.height)*(v-F)/L,d=u*.5*(y.width+x.height)*(N-T)/L),y.forceX-=c,y.forceY-=d,x.forceX+=c,x.forceY+=d}let m=0;for(let p=0;p<i.length;p++){const y=i[p];this.isFixed(y)?this.moveFixedVertex(y):m=Math.max(m,this.moveVertex(y)||0)}return m>this.epsilonDistance*this.epsilonDistance}lI(t,i,s,n){const o=this.vh+s,r=Math.sqrt(n);this.zy=this.Za*t.vertexes.count;const h=t.vertexes.toArray();let a=0,l=0,u=0;for(;this.vh<o;){this.vh++,l=a,a=0;for(let c=0;c<h.length;c++){h[c].forceX=0,h[c].forceY=0;for(let f=0;f<h.length;f++){if(c===f)continue;const m=Math.sqrt((h[c].centerX-h[f].centerX)**2+(h[c].centerY-h[f].centerY)**2),p=i[h[c].idInCluster][h[f].idInCluster],y=(m-this.Za*r*p)/m;h[c].forceX+=y*(h[f].x-h[c].x),h[c].forceY+=y*(h[f].y-h[c].y)}const d=Math.sqrt(h[c].forceX*h[c].forceX+h[c].forceY*h[c].forceY);if(d>0){h[c].forceX=this.zy*h[c].forceX/d,h[c].forceY=this.zy*h[c].forceY/d,this.isFixed(h[c])||(h[c].x+=h[c].forceX,h[c].y+=h[c].forceY);const f=h[c].hierarchicalVertexes.iterator;for(;f.next();){const m=f.value;this.isFixed(m)||(m.centerX+=h[c].forceX,m.centerY+=h[c].forceY)}}a+=d*d}if(a>=l){if(u++,u>=5)break}else u=0;this.zy*=.95}}moveVertex(t){let i=t.forceX,s=t.forceY;const n=this.moveLimit;return i<-n?i=-n:i>n&&(i=n),s<-n?s=-n:s>n&&(s=n),t.centerX+=i,t.centerY+=s,i*i+s*s}shouldInteract(t,i){return!0}moveFixedVertex(t){}commitLayout(){this.Xy(),this.commitNodes(),this.isRouting&&this.commitLinks()}Xy(){if(!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const i=t.value.link;i!==null&&(i.fromSpot=B.Default,i.toSpot=B.Default)}}commitNodes(){let t=0,i=0;if(this.arrangesToOrigin){const o=z.l();this.Lw(this.network,o);const r=this.arrangementOrigin;t=r.x-o.x,i=r.y-o.y,z.e(o)}const s=z.l(),n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;(t!==0||i!==0)&&(s.a(o.bounds),s.x+=t,s.y+=i,o.bounds=s),o.commit()}z.e(s)}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const i=t.stiffness;return isNaN(i)?this.zf:i}springLength(t){const i=t.length;return isNaN(i)?this.Xf:i}electricalCharge(t){const i=t.charge;return isNaN(i)?this.Yf:i}electricalFieldX(t,i){return 0}electricalFieldY(t,i){return 0}gravitationalMass(t){const i=t.mass;return isNaN(i)?this.Gf:i}gravitationalFieldX(t,i){return 0}gravitationalFieldY(t,i){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.vh}get arrangementSpacing(){return this.Ms}set arrangementSpacing(t){this.Ms.equals(t)||(this.Ms.a(t),this.invalidateLayout())}get arrangesToOrigin(){return this.dg}set arrangesToOrigin(t){this.dg!==t&&(this.dg=t,this.invalidateLayout())}get setsPortSpots(){return this.Nn}set setsPortSpots(t){this.Nn!==t&&(this.Nn=t,this.invalidateLayout())}get comments(){return this.Fe}set comments(t){this.Fe!==t&&(this.Fe=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.gg}set maxPrelayoutIterations(t){this.gg!==t&&t>=0&&(this.gg=t,this.invalidateLayout())}get maxIterations(){return this.mg}set maxIterations(t){this.mg!==t&&t>=0&&(this.mg=t,this.invalidateLayout())}get epsilonDistance(){return this.pg}set epsilonDistance(t){this.pg!==t&&t>0&&(this.pg=t,this.invalidateLayout())}get infinityDistance(){return this.Vf}set infinityDistance(t){this.Vf!==t&&t>1&&(this.Vf=t,this.invalidateLayout())}get moveLimit(){return this.yg}set moveLimit(t){this.yg!==t&&(this.yg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.wg}set randomNumberGenerator(t){this.wg!==t&&(t!==null&&!b.it(t.random)&&b.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.wg=t)}get defaultSpringStiffness(){return this.zf}set defaultSpringStiffness(t){this.zf!==t&&(this.zf=t,this.invalidateLayout())}get defaultSpringLength(){return this.Xf}set defaultSpringLength(t){this.Xf!==t&&(this.Xf=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.Yf}set defaultElectricalCharge(t){this.Yf!==t&&(this.Yf=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Gf}set defaultGravitationalMass(t){this.Gf!==t&&(this.Gf=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.xg}set defaultCommentSpringLength(t){this.xg!==t&&(this.xg=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.bg}set defaultCommentElectricalCharge(t){this.bg!==t&&(this.bg=t,this.invalidateLayout())}get prelayoutQuality(){return this.Kf}set prelayoutQuality(t){this.Kf!==t&&(this.Kf=t,this.invalidateLayout())}get prelayoutSpread(){return this.Za}set prelayoutSpread(t){this.Za!==t&&(this.Za=t,this.invalidateLayout())}}class un extends $e{constructor(e){super(e)}createVertex(){return new cn(this)}createEdge(){return new dn(this)}}class cn extends Ze{constructor(t){super(t);g(this,"J1");g(this,"$1");g(this,"Z1");g(this,"Q1");g(this,"_1");g(this,"hierarchicalVertexes");g(this,"idInCluster");this.J1=!1,this.$1=NaN,this.Z1=NaN,this.Q1=0,this._1=0,this.hierarchicalVertexes=new J,this.idInCluster=-1}get isFixed(){return this.J1}set isFixed(t){this.J1!==t&&(this.J1=t)}get charge(){return this.$1}set charge(t){this.$1!==t&&(this.$1=t)}get mass(){return this.Z1}set mass(t){this.Z1!==t&&(this.Z1=t)}get forceX(){return this.Q1}set forceX(t){this.Q1!==t&&(this.Q1=t)}get forceY(){return this._1}set forceY(t){this._1!==t&&(this._1=t)}}class dn extends pi{constructor(t){super(t);g(this,"tk");g(this,"ik");this.tk=NaN,this.ik=NaN}get stiffness(){return this.tk}set stiffness(t){this.tk!==t&&(this.tk=t)}get length(){return this.ik}set length(t){this.ik!==t&&(this.ik=t)}}class gn{constructor(e){g(this,"I");g(this,"R");g(this,"Q");g(this,"M");g(this,"A");g(this,"seed");e===void 0&&(e=42),this.seed=e,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const e=this.seed/this.Q,t=this.seed%this.Q,i=this.A*t-this.R*e;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var Ps=(w=>(w[w.DepthFirst=0]="DepthFirst",w[w.Greedy=1]="Greedy",w[w.FromLayers=2]="FromLayers",w))(Ps||{}),Ss=(w=>(w[w.OptimalLinkLength=10]="OptimalLinkLength",w[w.LongestPathSink=11]="LongestPathSink",w[w.LongestPathSource=12]="LongestPathSource",w))(Ss||{}),Ms=(w=>(w[w.DepthFirstOut=20]="DepthFirstOut",w[w.DepthFirstIn=21]="DepthFirstIn",w[w.Naive=22]="Naive",w))(Ms||{}),Ns=(w=>(w[w.None=30]="None",w[w.Less=31]="Less",w[w.More=32]="More",w))(Ns||{}),fn=(w=>(w[w.None=0]="None",w[w.Expand=1]="Expand",w[w.Straighten=2]="Straighten",w[w.Median=4]="Median",w[w.MaybeExpand=8]="MaybeExpand",w[w.All=15]="All",w))(fn||{}),mn=(w=>(w[w.None=0]="None",w[w.UpperLeft=1]="UpperLeft",w[w.UpperRight=2]="UpperRight",w[w.LowerLeft=4]="LowerLeft",w[w.LowerRight=8]="LowerRight",w[w.All=15]="All",w))(mn||{});class Ht extends ne{constructor(t){super();g(this,"Ns");g(this,"Wi");g(this,"b");g(this,"jf");g(this,"Hf");g(this,"qf");g(this,"Qa");g(this,"Wf");g(this,"Qo");g(this,"Jf");g(this,"Nn");g(this,"kt");g(this,"Yy");g(this,"zt");g(this,"kg");g(this,"Cs");g(this,"ci");g(this,"Zs");g(this,"Ls");g(this,"As");g(this,"It");g(this,"Pg");g(this,"_a");g(this,"Sg");g(this,"Qs");g(this,"$f");g(this,"_o");g(this,"Cn");g(this,"Ln");g(this,"ZN");this.Ns=25,this.Wi=25,this.b=0,this.jf=0,this.Hf=10,this.qf=20,this.Qa=4,this.Wf=31,this.Qo=15,this.Jf=10,this.Nn=!0,this.kt=-1,this.Yy=-1,this.zt=-1,this.kg=0,this.Cs=0,this.ci=null,this.Zs=null,this.Ls=null,this.As=null,this.It=null,this.Pg=0,this._a=null,this.Sg=null,this.Qs=0,this.$f=null,this._o=new S,this.Cn=[],this.Cn.length=100,this.Ln=15,this.ZN=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ns=this.Ns,t.Wi=this.Wi,t.b=this.b,t.jf=this.jf,t.Hf=this.Hf,t.qf=this.qf,t.Qa=this.Qa,t.Wf=this.Wf,t.Qo=this.Qo,t.Jf=this.Jf,t.Nn=this.Nn,t.Ln=this.Ln}oi(t){t in Ns?this.aggressiveOption=t:t in Ps?this.cycleRemoveOption=t:t in Ms?this.initializeOption=t:t in Ss?this.layeringOption=t:super.oi(t)}createNetwork(){return new pn(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.aI(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.cI(),this.cycleRemoveOption===2&&this.removeCycles(),this.fI(),this.uI(),this.dI(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,s=t.toVertex.node||t.toVertex.data;return i===null&&s===null?8:i===null||s===null?4:1}nodeMinLayerSpace(t,i){return t.node===null&&t.data===null?0:this.b===90||this.b===270?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(t.node===null&&t.data===null)return 0;const s=i?t.ek:t.sk;if(s!==null)return s;const n=this.b;return n===90||n===270?i?t.ek=t.focus.x/this.Wi+1|0:t.sk=(t.bounds.width-t.focus.x)/this.Wi+1|0:i?t.ek=t.focus.y/this.Wi+1|0:t.sk=(t.bounds.height-t.focus.y)/this.Wi+1|0}Ji(){this._a===null&&(this._a=[]);let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;this._a[t]=s.layer,t++,this._a[t]=s.column,t++,this._a[t]=s.index,t++}return this._a}We(t){let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.layer=t[i],i++,n.column=t[i],i++,n.index=t[i],i++}}wD(t,i){const s=this.Oh(t),n=this.ci[t];(this.Sg===null||this.Sg.length<n*n)&&(this.Sg=[]);const o=this.Sg;for(let r=0;r<n;r++){let h=0;const a=s[r],l=a.near;let u=0;l!==null&&l!==a&&l.layer===a.layer&&(h+=Math.max(0,Math.abs(l.index-a.index)-1));let c,d=0,f,m=0,p=0,y=0,x,P=0,k,v=0,N=0,M=0,C;if(i>=0){for(c=s[r].fo,d=0;d<c.length;d++)if(f=c[d],f.valid&&f.fromVertex.layer!==t)for(m=f.fromVertex.index,p=f.portToPos,y=f.portFromPos,P=d+1;P<c.length;P++)k=c[P],k.valid&&k.fromVertex.layer!==t&&(v=k.fromVertex.index,N=k.portToPos,M=k.portFromPos,p<N&&(m>v||m===v&&y>M)&&h++,N<p&&(v>m||v===m&&M>y)&&h++)}if(i<=0){for(c=s[r].Wo,d=0;d<c.length;d++)if(f=c[d],f.valid&&f.toVertex.layer!==t)for(m=f.toVertex.index,p=f.portToPos,y=f.portFromPos,P=d+1;P<c.length;P++)k=c[P],k.valid&&k.toVertex.layer!==t&&(v=k.toVertex.index,N=k.portToPos,M=k.portFromPos,y<M&&(m>v||m===v&&p>N)&&h++,M<y&&(v>m||v===m&&N>p)&&h++)}for(o[r*n+r]=h,u=r+1;u<n;u++){let F=0,T=0;if(i>=0){for(x=s[r].fo,C=s[u].fo,d=0;d<x.length;d++)if(f=x[d],f.valid&&f.fromVertex.layer!==t)for(m=f.fromVertex.index,p=f.portToPos,y=f.portFromPos,P=0;P<C.length;P++)k=C[P],k.valid&&k.fromVertex.layer!==t&&(v=k.fromVertex.index,N=k.portToPos,M=k.portFromPos,(m<v||m===v&&y<M)&&T++,(v<m||v===m&&M<y)&&F++)}if(i<=0){for(x=s[r].Wo,C=s[u].Wo,d=0;d<x.length;d++)if(f=x[d],f.valid&&f.toVertex.layer!==t)for(m=f.toVertex.index,p=f.portToPos,y=f.portFromPos,P=0;P<C.length;P++)k=C[P],k.valid&&k.toVertex.layer!==t&&(v=k.toVertex.index,N=k.portToPos,M=k.portFromPos,(m<v||m===v&&p<N)&&T++,(v<m||v===m&&N<p)&&F++)}o[r*n+u]=F,o[u*n+r]=T}}return this.Ih(t,s),o}countCrossings(){let t=0;for(let i=0;i<=this.kt;i++){const s=this.wD(i,1),n=this.ci[i];for(let o=0;o<n;o++)for(let r=o;r<n;r++)t+=s[o*n+r]}return t}gI(t,i,s){const n=this.Oh(t),o=this.ci[t];let r=0;for(let h=0;h<o;h++){let a=null;i<=0&&(a=n[h].fo);let l=null;i>=0&&(l=n[h].Wo);let u,c=0,d=0;if(a!==null)for(let f=0;f<a.length;f++)u=a[f],u.valid&&u.fromVertex.layer!==t&&(c=u.fromVertex.column+u.portFromColOffset,d=u.toVertex.column+u.portToColOffset,s?r+=Math.abs(c-d)*this.linkStraightenWeight(u):r+=Math.abs(c-d));if(l!==null)for(let f=0;f<l.length;f++)u=l[f],u.valid&&u.toVertex.layer!==t&&(c=u.fromVertex.column+u.portFromColOffset,d=u.toVertex.column+u.portToColOffset,s?r+=(Math.abs(c-d)+1)*this.linkStraightenWeight(u):r+=Math.abs(c-d))}return this.Ih(t,n),r}nk(t){let i=0;for(let s=0;s<=this.kt;s++)i+=this.gI(s,1,t);return i}Gy(){let t=1/0;this.zt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=Math.min(t,s.column-this.nodeMinColumnSpace(s,!0)),this.zt=Math.max(this.zt,s.column+this.nodeMinColumnSpace(s,!1))}for(i.reset();i.next();){const s=i.value;s.column-=t}this.zt-=t}Ky(t,i){const s=this.Oh(t),n=this.ci[t],o=[];for(let r=0;r<n;r++){const h=s[r];let a=null;i<=0&&(a=h.fo);let l=null;i>=0&&(l=h.Wo);let u=0,c=0;const d=h.near;d!==null&&d.layer===h.layer&&(u+=d.column-1,c++);let f;if(a!==null)for(let m=0;m<a.length;m++){f=a[m];const p=f.fromVertex;f.valid&&!f.rev&&p.layer!==t&&(u+=p.column,c++)}if(l!==null)for(let m=0;m<l.length;m++){f=l[m];const p=f.toVertex;f.valid&&!f.rev&&p.layer!==t&&(u+=p.column,c++)}c===0?o[r]=-1:o[r]=u/c}return this.Ih(t,s),o}xD(t,i){const s=this.Oh(t),n=this.ci[t],o=[];for(let r=0;r<n;r++){const h=s[r];let a=null;i<=0&&(a=h.fo);let l=null;i>=0&&(l=h.Wo);let u=0;const c=[],d=h.near;d!==null&&d.layer===h.layer&&(c[u]=d.column-1,u++);let f;if(a!==null)for(let m=0;m<a.length;m++){f=a[m];const p=f.fromVertex;f.valid&&!f.rev&&p.layer!==t&&(c[u]=p.column+f.portFromColOffset,u++)}if(l!==null)for(let m=0;m<l.length;m++){f=l[m];const p=f.toVertex;f.valid&&!f.rev&&p.layer!==t&&(c[u]=p.column+f.portToColOffset,u++)}if(u===0)o[r]=-1;else{c.sort((p,y)=>p-y);const m=u>>1;u&1?o[r]=c[m]:o[r]=c[m-1]+c[m]>>1}}return this.Ih(t,s),o}jy(t,i,s,n,o){if(t.component===s){t.component=i;let r=0,h=0;if(n){const a=t.destinationEdges;for(;a.next();){const l=a.value,u=l.toVertex;r=t.layer-u.layer,h=this.linkMinLength(l),r===h&&this.jy(u,i,s,n,o)}}if(o){const a=t.sourceEdges;for(;a.next();){const l=a.value,u=l.fromVertex;r=u.layer-t.layer,h=this.linkMinLength(l),r===h&&this.jy(u,i,s,n,o)}}}}QN(t,i,s,n,o){if(t.component===s){if(t.component=i,n){const r=t.destinationEdges;for(;r.next();){const h=r.value.toVertex;this.QN(h,i,s,n,o)}}if(o){const r=t.sourceEdges;for(;r.next();){const h=r.value.fromVertex;this.QN(h,i,s,n,o)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const i=t.value;i.rev=!1}switch(this.jf){default:case 1:this.mI();break;case 0:this.pI();break;case 2:this.yI();break}}yI(){const t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();){const n=i.value;s=Math.min(s,n.layer)}if(s<1/0){if(s<0)for(i.reset();i.next();){const h=i.value;h.layer-=s}const n=[];for(i.reset();i.next();){const h=i.value,a=n[h.layer];a===void 0?n[h.layer]=[h]:a.push(h)}let o=0;for(let h=0;h<n.length;h++){const a=n[h];if(!a||a.length===0)o++;else if(h>0)for(let l=0;l<a.length;l++){const u=a[l];u.layer-=o}}const r=t.edges.iterator;for(;r.next();){const h=r.value,a=h.fromVertex,l=h.toVertex;a.layer<l.layer&&(t.reverseEdge(h),h.rev=!0)}}}mI(){const t=this.network;let i=0,s=t.vertexes.count-1;const n=[];n.length=s+1;const o=t.vertexes.iterator;for(;o.next();){const h=o.value;h.$i=!0}for(;this.wI(t)!==null;){let h;for(h=this.bD(t);h!==null;)n[s]=h,s--,h.$i=!1,h=this.bD(t);for(h=this.kD(t);h!==null;)n[i]=h,i++,h.$i=!1,h=this.kD(t);h=this.xI(t),h!==null&&(n[i]=h,i++,h.$i=!1)}for(let h=0;h<t.vertexes.count;h++)n[h].index=h;const r=t.edges.iterator;for(;r.next();){const h=r.value,a=h.fromVertex,l=h.toVertex;a.index>l.index&&(t.reverseEdge(h),h.rev=!0)}}wI(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i)return s}return null}bD(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i){let n=!0;const o=s.destinationEdges;for(;o.next();)if(o.value.toVertex.$i){n=!1;break}if(n)return s}}return null}kD(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i){let n=!0;const o=s.sourceEdges;for(;o.next();)if(o.value.fromVertex.$i){n=!1;break}if(n)return s}}return null}xI(t){let i=null,s=0;const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;if(o.$i){let r=0;const h=o.destinationEdges;for(;h.next();)h.value.toVertex.$i&&r++;let a=0;const l=o.sourceEdges;for(;l.next();)l.value.fromVertex.$i&&a++;(i===null||s<r-a)&&(i=o,s=r-a)}}return i}pI(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.Zf=-1,s.Xn=-1}const i=this.network.edges.iterator;for(;i.next();){const s=i.value;s.forest=!1}for(this.Pg=0,t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this._N(s)}for(t.reset();t.next();){const s=t.value;s.Zf===-1&&this._N(s)}for(i.reset();i.next();){const s=i.value;if(!s.forest){const n=s.fromVertex,o=n.Zf,r=n.Xn,h=s.toVertex,a=h.Zf,l=h.Xn;a<o&&r<l&&(this.network.reverseEdge(s),s.rev=!0)}}}_N(t){t.Zf=this.Pg,this.Pg++;const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex;n.Zf===-1&&(s.forest=!0,this._N(n))}t.Xn=this.Pg,this.Pg++}cI(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.layer=-1}for(this.kt=-1,this.assignLayers(),t.reset();t.next();){const i=t.value;this.kt=Math.max(this.kt,i.layer)}}assignLayers(){switch(this.Hf){case 11:this.PD();break;case 12:this.bI();break;default:case 10:this.kI();break}}PD(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value,s=this.SD(i);this.kt=Math.max(s,this.kt)}}SD(t){let i=0;if(t.layer===-1){const s=t.destinationEdges;for(;s.next();){const n=s.value,o=n.toVertex,r=this.linkMinLength(n);i=Math.max(i,this.SD(o)+r)}t.layer=i}else i=t.layer;return i}bI(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=this.MD(s),this.kt=Math.max(t,this.kt)}for(i.reset();i.next();){const s=i.value;s.layer=this.kt-s.layer}}MD(t){let i=0;if(t.layer===-1){const s=t.sourceEdges;for(;s.next();){const n=s.value,o=n.fromVertex,r=this.linkMinLength(n);i=Math.max(i,this.MD(o)+r)}t.layer=i}else i=t.layer;return i}kI(){this.PD();const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.$i=!1}for(t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.ND(s)}let i=1/0;for(t.reset();t.next();){const s=t.value;i=Math.min(i,s.layer)}for(this.kt=-1,t.reset();t.next();){const s=t.value;s.layer-=i,this.kt=Math.max(this.kt,s.layer)}}ND(t){if(!t.$i){t.$i=!0;const i=t.destinationEdges;for(;i.next();){const s=i.value.toVertex;this.ND(s)}this.SI(t),this.MI(t)}}SI(t){const i=this.network.vertexes.iterator;for(;i.next();){const h=i.value;h.component=-1}const s=0,n=1,o=t.fo;let r=o.length;for(let h=0;h<r;h++){const a=o[h],l=a.fromVertex,u=a.toVertex,c=this.linkMinLength(a);l.layer-u.layer>c&&this.jy(l,s,-1,!0,!1)}for(this.jy(t,n,-1,!0,!0);t.component!==s;){let h=0,a=1/0,l=0,u=null;const c=this.network.vertexes.iterator;for(;c.next();){const d=c.value;if(d.component===n){let f=0,m=!1;const p=d.fo;r=p.length;for(let x=0;x<r;x++){const P=p[x],k=P.fromVertex;if(f+=this.linkLengthWeight(P),k.component!==n){h+=this.linkLengthWeight(P);const v=k.layer-d.layer,N=this.linkMinLength(P);a=Math.min(a,v-N)}}const y=d.Wo;r=y.length;for(let x=0;x<r;x++){const P=y[x],k=P.toVertex;f-=this.linkLengthWeight(P),k.component!==n?h-=this.linkLengthWeight(P):m=!0}(u===null||f<l)&&!m&&(u=d,l=f)}}if(h>0){for(i.reset();i.next();){const d=i.value;d.component===n&&(d.layer+=a)}t.component=s}else u.component=s}}MI(t){const i=this.network.vertexes.iterator;for(;i.next();){const o=i.value;o.component=-1}const s=0,n=1;for(this.jy(t,n,-1,!0,!1);t.component!==s;){let o=0,r=1/0,h=0,a=null;const l=this.network.vertexes.iterator;for(;l.next();){const u=l.value;if(u.component===n){let c=0,d=!1;const f=u.fo;let m=f.length;for(let y=0;y<m;y++){const x=f[y],P=x.fromVertex;c+=this.linkLengthWeight(x),P.component!==n?o+=this.linkLengthWeight(x):d=!0}const p=u.Wo;m=p.length;for(let y=0;y<m;y++){const x=p[y],P=x.toVertex;if(c-=this.linkLengthWeight(x),P.component!==n){o-=this.linkLengthWeight(x);const k=u.layer-P.layer,v=this.linkMinLength(x);r=Math.min(r,k-v)}}(a===null||c>h)&&!d&&(a=u,h=c)}}if(o<0){for(i.reset();i.next();){const u=i.value;u.component===n&&(u.layer-=r)}t.component=s}else a.component=s}}fI(){const t=this.network,i=[],s=t.edges.iterator;for(;s.next();){const n=s.value;n.valid=!1,i.push(n)}for(let n=0;n<i.length;n++){const o=i[n];let r=o.fromVertex;const h=o.toVertex;if(o.valid||(r.node===null&&r.data===null||h.node===null&&h.data===null)&&r.layer===h.layer)continue;let a=0,l=0,u=0,c=0;if(o.link!==null){const M=o.link;if(M===null)continue;const C=r.node,F=h.node;if(C===null||F===null)continue;let T=M.fromNode,L=M.toNode,D=M.fromPort;for(;D!==null&&!D.isVisibleObject();)D=D.panel;let O=M.toPort;for(;O!==null&&!O.isVisibleObject();)O=O.panel;if(o.rev){const W=T,ct=D;T=L,D=O,L=W,O=ct}const R=r.focus,I=h.focus,X=o.rev?h.bounds:r.bounds,j=S.l();C!==T?X.isReal()&&T.isVisible()?T.actualBounds.isReal()?(T.getRelativePoint(D,B.Center,j),j.x+=T.actualBounds.x-X.x,j.y+=T.actualBounds.y-X.y):(T.getRelativePoint(D,B.Center,j),j.isReal()||j.a(R)):j.a(R):X.isReal()?(T.getRelativePoint(D,B.Center,j),j.isReal()||j.a(R)):j.a(R);const V=o.rev?r.bounds:h.bounds,U=S.l();F!==L?V.isReal()&&L.isVisible()?L.actualBounds.isReal()?(L.getRelativePoint(O,B.Center,U),U.x+=L.actualBounds.x-V.x,U.y+=L.actualBounds.y-V.y):(L.getRelativePoint(O,B.Center,U),U.isReal()||U.a(I)):U.a(I):V.isReal()?(L.getRelativePoint(O,B.Center,U),U.isReal()||U.a(I)):U.a(I),this.b===90||this.b===270?(a=Math.round((j.x-R.x)/this.Wi),u=j.x,l=Math.round((U.x-I.x)/this.Wi),c=U.x):(a=Math.round((j.y-R.y)/this.Wi),u=j.y,l=Math.round((U.y-I.y)/this.Wi),c=U.y),S.e(j),S.e(U),o.portFromColOffset=a,o.portFromPos=u,o.portToColOffset=l,o.portToPos=c}else o.portFromColOffset=0,o.portFromPos=0,o.portToColOffset=0,o.portToPos=0;let d=r.layer;const f=h.layer,m=this.NI(o),p=m===1||m===3,y=m===2||m===3;let x,P,k=null,v;y&&(k=this.CI(r,h),v=1,P=t.createVertex(),P.node=null,P.ok=1,P.layer=d,P.near=r,t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!1,x.rev=o.rev,x.portFromColOffset=a,x.portToColOffset=0,x.portFromPos=u,x.portToPos=0,r=P);let N=1;if(p&&N--,d-f>N&&d>0){for(o.valid=!1,P=t.createVertex(),P.node=null,P.ok=2,P.layer=d-1,k&&v<k.length&&P.layer===k[v].layer&&(P.near=k[v++]),t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=y?0:a,x.portToColOffset=0,x.portFromPos=y?0:u,x.portToPos=0,r=P,d--;d-f>N&&d>0;)P=t.createVertex(),P.node=null,P.ok=3,P.layer=d-1,k&&v<k.length&&P.layer===k[v].layer&&(P.near=k[v++]),t.addVertex(P),x=t.linkVertexes(r,P,o.link),x.valid=!0,x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=0,x.portFromPos=0,x.portToPos=0,r=P,d--;x=t.linkVertexes(P,h,o.link),x.valid=!p,p&&(P.near=h),x.rev=o.rev,x.portFromColOffset=0,x.portToColOffset=l,x.portFromPos=0,x.portToPos=c}else o.valid=!0}}NI(t){let i=0;const s=t.link;if(s!==null){const n=s.fromPort,o=s.toPort;if(n!==null&&o!==null){const r=s.fromNode,h=s.toNode;if(r!==null&&h!==null){const a=this.rk(!0),l=this.rk(!1),u=this.setsPortSpots?a:s.computeSpot(!0,n),c=this.setsPortSpots?l:s.computeSpot(!1,o),d=s.isOrthogonal;if(u.isSide()&&u.includesSide(l)&&c.isSide()&&c.includesSide(a))return 0;const f=s.getLinkPoint(r,n,u,!0,d,h,o,S.l()),m=s.getLinkDirection(r,n,f,u,!0,d,h,o);S.e(f),(!u.isNone()&&m===this.CD(t,!0)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(i+=1);const p=s.getLinkPoint(h,o,c,!1,d,r,n,S.l()),y=s.getLinkDirection(h,o,p,c,!1,d,r,n);S.e(p),(!c.isNone()&&y===this.CD(t,!1)||this.setsPortSpots&&h!==null&&h.ports.count===1&&t.rev)&&(i+=2)}}}return i}CD(t,i){return this.b===90?i&&!t.rev||!i&&t.rev?270:90:this.b===180?i&&!t.rev||!i&&t.rev?0:180:this.b===270?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}CI(t,i){const s=[];return s.push(i),this.LD(t,s)?s.reverse():[]}LD(t,i){const s=i[i.length-1].sourceEdges.iterator;for(;s.next();){const n=s.value;if(n.rev||!n.valid)continue;const o=n.fromVertex;if(i.push(o),o===t||this.LD(t,i))return!0;i.pop()}return!1}uI(){const t=this.ci=[];for(let s=0;s<=this.kt;s++)t[s]=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.index=-1}this.initializeIndices(),this.Yy=-1,this.kg=0,this.Cs=0;for(let s=0;s<=this.kt;s++)t[s]>t[this.Cs]&&(this.Yy=t[s]-1,this.Cs=s),t[s]<t[this.kg]&&(this.kg=s);this.$f=[];for(let s=0;s<t.length;s++)this.$f[s]=[];for(i.reset();i.next();){const s=i.value,n=s.layer,o=this.$f[n];o[s.index]=s}}initializeIndices(){switch(this.qf){default:case 22:this.LI();break;case 20:this.AI();break;case 21:this.TI();break}}LI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(i.reset();i.next();){const s=i.value;if(s.near)continue;const n=s.layer;if(s.index=this.ci[n],this.ci[n]++,!t)continue;const o=t.get(s);Array.isArray(o)&&o.forEach(r=>{r.index=this.ci[n],this.ci[n]++})}}AI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=this.kt;s>=0;s--)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.AD(n,t)}}AD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ci[s],this.ci[s]++,i){const r=i.get(t);Array.isArray(r)&&r.forEach(h=>{h.index=this.ci[s],this.ci[s]++})}const n=t.Wo;let o=!0;for(;o;){o=!1;for(let r=0;r<n.length-1;r++){const h=n[r],a=n[r+1];h.portFromColOffset>a.portFromColOffset&&(o=!0,n[r]=a,n[r+1]=h)}}for(let r=0;r<n.length;r++){const h=n[r];if(h.valid){const a=h.toVertex;a.index===-1&&this.AD(a,i)}}}TI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=0;s<=this.kt;s++)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.TD(n,t)}}TD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ci[s],this.ci[s]++,i){const l=i.get(t);Array.isArray(l)&&l.forEach(u=>{u.index=this.ci[s],this.ci[s]++})}const n=t.fo;let o=!0,r=0;for(;o;)for(o=!1,r=0;r<n.length-1;r++){const l=n[r],u=n[r+1];l.portToColOffset>u.portToColOffset&&(o=!0,n[r]=u,n[r+1]=l)}let h,a;for(r=0;r<n.length;r++)a=n[r],a.valid&&(h=a.fromVertex,h.index===-1&&this.TD(h,i))}dI(){this.zt=-1;for(let t=0;t<=this.kt;t++){const i=this.Oh(t);let s=0;const n=this.ci[t];for(let o=0;o<n;o++){const r=i[o];s+=this.nodeMinColumnSpace(r,!0),r.column=s,s+=1,s+=this.nodeMinColumnSpace(r,!1)}this.zt=Math.max(this.zt,s-1),this.Ih(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.Ji(),s=0,n=0,o=0;for(s=0;s<this.Qa;s++){for(n=0;n<=this.kt;n++)this.lk(n,1),this.rs(n,1,!1,1);for(o=this.countCrossings(),o<t&&(t=o,i=this.Ji()),n=this.kt;n>=0;n--)this.lk(n,-1),this.rs(n,-1,!1,-1);o=this.countCrossings(),o<t&&(t=o,i=this.Ji())}for(this.We(i),s=0;s<this.Qa;s++){for(n=0;n<=this.kt;n++)this.lk(n,0),this.rs(n,0,!1,0);for(o=this.countCrossings(),o<t&&(t=o,i=this.Ji()),n=this.kt;n>=0;n--)this.lk(n,0),this.rs(n,0,!1,0);o=this.countCrossings(),o<t&&(t=o,i=this.Ji())}this.We(i);let r=!1,h=0,a=0,l=0,u=0;switch(this.Wf){case 30:break;case 32:for(l=t+1;(u=this.countCrossings())<l;)for(l=u,h=this.kt;h>=0;h--)for(a=0;a<=h;a++){for(r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,1,!1,1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,-1,!1,-1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,0,!1,0)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,0,!1,0)||r;o>=t?this.We(i):(t=o,i=this.Ji())}break;default:case 31:for(h=this.kt,a=0,l=t+1;(u=this.countCrossings())<l;){for(l=u,r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,1,!1,1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,-1,!1,-1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n>=a;n--)r=this.rs(n,0,!1,0)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n<=h;n++)r=this.rs(n,0,!1,0)||r;o>=t?this.We(i):(t=o,i=this.Ji())}break}this.We(i)}lk(t,i){let s=0,n=!1;const o=this.Oh(t),r=this.ci[t],h=this.xD(t,i),a=this.Ky(t,i);for(s=0;s<r;s++)a[s]===-1&&(a[s]=o[s].column),h[s]===-1&&(h[s]=o[s].column);let l=!0,u;for(;l;)for(l=!1,s=0;s<r-1;s++)if(h[s+1]<h[s]||h[s+1]===h[s]&&a[s+1]<a[s]){n=!0,l=!0;const d=h[s];h[s]=h[s+1],h[s+1]=d;const f=a[s];a[s]=a[s+1],a[s+1]=f,u=o[s],o[s]=o[s+1],o[s+1]=u}let c=0;for(s=0;s<r;s++)u=o[s],u.index=s,c+=this.nodeMinColumnSpace(u,!0),u.column=c,c+=1,c+=this.nodeMinColumnSpace(u,!1);return this.Ih(t,o),n}rs(t,i,s,n){const o=this.Oh(t),r=this.ci[t],h=this.wD(t,i);let a=0,l;if(!s||n>0)for(l=[],a=0;a<r;a++)l[a]=-1;else l=this.Ky(t,-1);let u;if(!s||n<0)for(u=[],a=0;a<r;a++)u[a]=-1;else u=this.Ky(t,1);let c=!1,d=!0;for(;d;)for(d=!1,a=0;a<r-1;a++){const f=h[o[a].index*r+o[a+1].index],m=h[o[a+1].index*r+o[a].index];let p=0,y=0;const x=o[a].column,P=o[a+1].column,k=this.nodeMinColumnSpace(o[a],!0),v=this.nodeMinColumnSpace(o[a],!1),N=this.nodeMinColumnSpace(o[a+1],!0),M=this.nodeMinColumnSpace(o[a+1],!1),C=x-k+N,F=P-v+M;let T=0,L=0,D=0,O=0,R=0,I=0,X=0,j,V=0,U,W=0;const ct=o[a].sourceEdges.iterator;if(s&&n<=0)for(;ct.next();){const xt=ct.value;j=xt.fromVertex,xt.valid&&j.layer!==t&&(D=this.linkStraightenWeight(xt),O=xt.portFromColOffset,R=xt.portToColOffset,I=j.column,T+=(Math.abs(x+R-(I+O))+1)*D,L+=(Math.abs(F+R-(I+O))+1)*D)}for(ct.reset();ct.next();){const xt=ct.value;if(j=xt.fromVertex,xt.valid&&j.layer===t){for(V=0;V<o.length&&o[V]!==j;)V++;V<a&&(p+=2*(a-V),y+=2*(a+1-V)),V===a+1&&(p+=1),V>a+1&&(p+=4*(V-a),y+=4*(V-(a+1)))}}const $=o[a].destinationEdges.iterator;if(s&&n>=0)for(;$.next();){const xt=$.value;U=xt.toVertex,xt.valid&&U.layer!==t&&(D=this.linkStraightenWeight(xt),O=xt.portFromColOffset,R=xt.portToColOffset,X=U.column,T+=(Math.abs(x+O-(X+R))+1)*D,L+=(Math.abs(F+O-(X+R))+1)*D)}for($.reset();$.next();){const xt=$.value;if(U=xt.toVertex,xt.valid&&U.layer===t){for(W=0;W<o.length&&o[W]!==U;)W++;W===a+1&&(y+=1)}}const et=o[a+1].sourceEdges.iterator;if(s&&n<=0)for(;et.next();){const xt=et.value;j=xt.fromVertex,xt.valid&&j.layer!==t&&(D=this.linkStraightenWeight(xt),O=xt.portFromColOffset,R=xt.portToColOffset,I=j.column,T+=(Math.abs(P+R-(I+O))+1)*D,L+=(Math.abs(C+R-(I+O))+1)*D)}for(et.reset();et.next();){const xt=et.value;if(j=xt.fromVertex,xt.valid&&j.layer===t){for(V=0;V<o.length&&o[V]!==j;)V++;V<a&&(p+=2*(a+1-V),y+=2*(a-V)),V===a&&(y+=1),V>a+1&&(p+=4*(V-(a+1)),y+=4*(V-a))}}const tt=o[a+1].destinationEdges.iterator;if(s&&n>=0)for(;tt.next();){const xt=tt.value;U=xt.toVertex,xt.valid&&U.layer!==t&&(D=this.linkStraightenWeight(xt),O=xt.portFromColOffset,R=xt.portToColOffset,X=U.column,T+=(Math.abs(P+O-(X+R))+1)*D,L+=(Math.abs(C+O-(X+R))+1)*D)}for(tt.reset();tt.next();){const xt=tt.value;if(U=xt.toVertex,xt.valid&&U.layer===t){for(W=0;W<o.length&&o[W]!==U;)W++;W===a&&(p+=1)}}let it=0,mt=0;const ft=l[o[a].index],Z=u[o[a].index],ht=l[o[a+1].index],Et=u[o[a+1].index];if(ft!==-1&&(it+=Math.abs(ft-x),mt+=Math.abs(ft-F)),Z!==-1&&(it+=Math.abs(Z-x),mt+=Math.abs(Z-F)),ht!==-1&&(it+=Math.abs(ht-P),mt+=Math.abs(ht-C)),Et!==-1&&(it+=Math.abs(Et-P),mt+=Math.abs(Et-C)),y<p-.5||y===p&&m<f-.5||y===p&&m===f&&L<T-.5||y===p&&m===f&&L===T&&mt<it-.5){c=!0,d=!0,o[a].column=F,o[a+1].column=C;const xt=o[a];o[a]=o[a+1],o[a+1]=xt}}for(a=0;a<r;a++)o[a].index=a;return this.Ih(t,o),c}straightenAndPack(){if(this.Ln!==0){this.DI();return}let t=0,i=!1,s=(this.Qo&1)!==0;const n=(this.Qo&8)!==0;if(this.network.edges.count>1e3&&n&&(s=!1),s){const o=[];let r=0;for(r=0;r<=this.kt;r++)o[r]=0;let h=0;const a=this.network.vertexes.iterator;for(;a.next();){const u=a.value;t=u.layer,h=u.column;const c=this.nodeMinColumnSpace(u,!1);o[t]=Math.max(o[t],h+c)}const l=8;for(a.reset();a.next();){const u=a.value;t=u.layer,h=u.column,u.column=((this.zt-o[t])*l>>1)+h*l}this.zt*=l}if(this.Qo&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,t=this.Cs+1;t<=this.kt;t++)i=this.Mg(t,1)||i;for(t=this.Cs-1;t>=0;t--)i=this.Mg(t,-1)||i;i=this.Mg(this.Cs,0)||i,o++}}if(this.Qo&4){for(t=this.Cs+1;t<=this.kt;t++)this.tC(t,1);for(t=this.Cs-1;t>=0;t--)this.tC(t,-1);this.tC(this.Cs,0)}if(s&&(this.DD(-1),this.DD(1)),this.Qo&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,i=this.Mg(this.Cs,0)||i,t=this.Cs+1;t<=this.kt;t++)i=this.Mg(t,0)||i;for(t=this.Cs-1;t>=0;t--)i=this.Mg(t,0)||i;o++}}}Mg(t,i){let s=!1;for(;this.FI(t,i);)s=!0;return s}FI(t,i){let s=0;const n=this.Oh(t),o=this.ci[t],r=this.Ky(t,-1);if(i>0)for(s=0;s<o;s++)r[s]=-1;const h=this.Ky(t,1);if(i<0)for(s=0;s<o;s++)h[s]=-1;let a=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const u=n[s].column,c=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let f=0;s-1<0||u-n[s-1].column-1>c+this.nodeMinColumnSpace(n[s-1],!1)?f=u-1:f=u;let m=0;s+1>=o||n[s+1].column-u-1>d+this.nodeMinColumnSpace(n[s+1],!0)?m=u+1:m=u;let p=0,y=0,x=0,P=0,k=0,v=0;if(i<=0){const L=n[s].sourceEdges.iterator;for(;L.next();){const D=L.value,O=D.fromVertex;if(D.valid&&O.layer!==t){P=this.linkStraightenWeight(D),k=D.portFromColOffset,v=D.portToColOffset;const R=O.column;p+=(Math.abs(u+v-(R+k))+1)*P,y+=(Math.abs(f+v-(R+k))+1)*P,x+=(Math.abs(m+v-(R+k))+1)*P}}}if(i>=0){const L=n[s].destinationEdges.iterator;for(;L.next();){const D=L.value,O=D.toVertex;if(D.valid&&O.layer!==t){P=this.linkStraightenWeight(D),k=D.portFromColOffset,v=D.portToColOffset;const R=O.column;p+=(Math.abs(u+k-(R+v))+1)*P,y+=(Math.abs(f+k-(R+v))+1)*P,x+=(Math.abs(m+k-(R+v))+1)*P}}}let N=0,M=0,C=0;const F=r[n[s].index],T=h[n[s].index];F!==-1&&(N+=Math.abs(F-u),M+=Math.abs(F-f),C+=Math.abs(F-m)),T!==-1&&(N+=Math.abs(T-u),M+=Math.abs(T-f),C+=Math.abs(T-m)),y<p||y===p&&M<N?(a=!0,l=!0,n[s].column=f):(x<p||x===p&&C<N)&&(a=!0,l=!0,n[s].column=m)}return this.Ih(t,n),this.Gy(),a}tC(t,i){let s=0;const n=this.Oh(t),o=this.ci[t],r=this.xD(t,i),h=[];for(s=0;s<o;s++)h[s]=r[s];let a=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const u=n[s].column,c=this.nodeMinColumnSpace(n[s],!0),d=this.nodeMinColumnSpace(n[s],!1);let f=0,m=0,p=0,y=0,x=0;h[s]===-1?s===0&&s===o-1?f=u:s===0?(m=n[s+1].column,m-u===d+this.nodeMinColumnSpace(n[s+1],!0)?f=u-1:f=u):s===o-1?(p=n[s-1].column,u-p===c+this.nodeMinColumnSpace(n[s-1],!1)?f=u+1:f=u):(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,m=n[s+1].column,y=m-this.nodeMinColumnSpace(n[s+1],!0)-d-1,f=(x+y)/2|0):s===0&&s===o-1?f=h[s]:s===0?(m=n[s+1].column,y=m-this.nodeMinColumnSpace(n[s+1],!0)-d-1,f=Math.min(h[s],y)):s===o-1?(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,f=Math.max(h[s],x)):(p=n[s-1].column,x=p+this.nodeMinColumnSpace(n[s-1],!1)+c+1,m=n[s+1].column,y=m-this.nodeMinColumnSpace(n[s+1],!0)-d-1,x<h[s]&&h[s]<y?f=h[s]:x>=h[s]?f=x:y<=h[s]&&(f=y)),f!==u&&(a=!0,l=!0,n[s].column=f)}return this.Ih(t,n),this.Gy(),a}RI(){for(let t=0;t<=this.zt;t++)for(;this.vI(t,1););this.Gy()}vI(t,i){let s=!0;const n=this.network.vertexes.iterator;for(;n.next();){const r=n.value,h=this.nodeMinColumnSpace(r,!0),a=this.nodeMinColumnSpace(r,!1);if(r.column-h<=t&&r.column+a>=t){s=!1;break}}let o=!1;if(s){if(i>0)for(n.reset();n.next();){const r=n.value;r.column>t&&(r.column-=1,o=!0)}if(i<0)for(n.reset();n.next();){const r=n.value;r.column<t&&(r.column+=1,o=!0)}}return o}OI(){this.RI();for(let t=0;t<this.zt;t++)for(;this.II(t,1););this.Gy()}II(t,i){let s=t;i>0&&(s=t+1),i<0&&(s=t-1);let n=0;const o=[],r=[];for(n=0;n<=this.kt;n++)o[n]=!1,r[n]=!1;const h=this.network.vertexes.iterator;for(;h.next();){const u=h.value,c=u.column-this.nodeMinColumnSpace(u,!0),d=u.column+this.nodeMinColumnSpace(u,!1);c<=t&&d>=t&&(o[u.layer]=!0),c<=s&&d>=s&&(r[u.layer]=!0)}let a=!0,l=!1;for(n=0;n<=this.kt;n++)a=a&&!(o[n]&&r[n]);if(a){if(i>0)for(h.reset();h.next();){const u=h.value;u.column>t&&(u.column-=1,l=!0)}if(i<0)for(h.reset();h.next();){const u=h.value;u.column<t&&(u.column+=1,l=!0)}}return l}DD(t){this.OI();let i=0,s,n=0,o=0,r=0;if(t>0)for(i=0;i<=this.zt;i++)for(s=this.Ji(),n=this.nk(!0),o=n+1;n<o;)o=n,this.FD(i,1),r=this.nk(!0),r>n?this.We(s):r<n&&(n=r,s=this.Ji());if(t<0)for(i=this.zt;i>=0;i--)for(s=this.Ji(),n=this.nk(!0),o=n+1;n<o;)o=n,this.FD(i,-1),r=this.nk(!0),r>n?this.We(s):r<n&&(n=r,s=this.Ji());this.Gy()}FD(t,i){this.Qs=0;const s=this.network.vertexes.iterator;for(;s.next();){const c=s.value;c.component=-1}if(i>0)for(s.reset();s.next();){const c=s.value;c.column-this.nodeMinColumnSpace(c,!0)<=t&&(c.component=this.Qs)}if(i<0)for(s.reset();s.next();){const c=s.value;c.column+this.nodeMinColumnSpace(c,!1)>=t&&(c.component=this.Qs)}for(this.Qs++,s.reset();s.next();){const c=s.value;c.component===-1&&(this.QN(c,this.Qs,-1,!0,!0),this.Qs++)}let n=0;const o=[];for(n=0;n<this.Qs*this.Qs;n++)o[n]=!1;const r=[];for(n=0;n<(this.kt+1)*(this.zt+1);n++)r[n]=-1;for(s.reset();s.next();){const c=s.value,d=c.layer,f=Math.max(0,c.column-this.nodeMinColumnSpace(c,!0)),m=Math.min(this.zt,c.column+this.nodeMinColumnSpace(c,!1));for(let p=f;p<=m;p++)r[d*(this.zt+1)+p]=c.component}for(let c=0;c<=this.kt;c++){if(i>0)for(let d=0;d<this.zt;d++)r[c*(this.zt+1)+d]!==-1&&r[c*(this.zt+1)+d+1]!==-1&&r[c*(this.zt+1)+d]!==r[c*(this.zt+1)+d+1]&&(o[r[c*(this.zt+1)+d]*this.Qs+r[c*(this.zt+1)+d+1]]=!0);if(i<0)for(let d=this.zt;d>0;d--)r[c*(this.zt+1)+d]!==-1&&r[c*(this.zt+1)+d-1]!==-1&&r[c*(this.zt+1)+d]!==r[c*(this.zt+1)+d-1]&&(o[r[c*(this.zt+1)+d]*this.Qs+r[c*(this.zt+1)+d-1]]=!0)}const h=[];for(n=0;n<this.Qs;n++)h[n]=!0;const a=[];a.push(0);let l=0;for(;a.length!==0;)if(l=a[a.length-1],a.pop(),h[l])for(h[l]=!1,n=0;n<this.Qs;n++)o[l*this.Qs+n]&&a.splice(0,0,n);let u=!1;if(i>0)for(s.reset();s.next();){const c=s.value;h[c.component]&&(c.column-=1,u=!0)}if(i<0)for(s.reset();s.next();){const c=s.value;h[c.component]&&(c.column+=1,u=!0)}return u}DI(){const t=b.et(),i=this.$f.length;for(let f=0;f<=i;f++)t[f]=[];const s=this.network.vertexes.iterator;for(;s.next();){const f=s.value,m=i-f.layer,p=t[m];p[f.index]=f}const n=new K;this.EI(t,n);let o=null,r=null,h=null,a=null;const l=(this.Ln&1)!==0,u=(this.Ln&2)!==0,c=(this.Ln&4)!==0,d=(this.Ln&8)!==0;l&&(this.tl(t,n,!0),o=this.hk(t,!0,!1)),t.reverse(),c&&(this.tl(t,n,!1),h=this.hk(t,!1,!1));for(const f of t)f.reverse();d&&(this.tl(t,n,!1),a=this.hk(t,!1,!0)),t.reverse(),u&&(this.tl(t,n,!0),r=this.hk(t,!0,!0)),b.J(t),this.UI(o,r,h,a),this.network.vertexes.each(f=>{const m=f,p=b.et();l&&p.push(o.get(m)),u&&p.push(r.get(m)),c&&p.push(h.get(m)),d&&p.push(a.get(m)),p.sort((v,N)=>v-N);const y=p.length,x=Math.floor((y-1)/2),P=Math.ceil((y-1)/2),k=(p[x]+p[P])/2;b.J(p),m.he=k})}EI(t,i){const s=t.length;for(let n=1;n<s-1;n++){let o=0,r=0;const h=t[n],a=t[n+1];for(let l=0;r<a.length;l++){const u=a[l],c=this.BI(u);if(l===a.length-1||c){let d=h.length-1;for(c&&(d=u.getProperSourceVertexes()[0].index);r<=l;){const f=a[r].getProperSourceEdges();for(const m of f){const p=m.fromVertex.index;(p<o||p>d)&&i.add(m)}r++}o=d}}}}BI(t){if(t.node===null){const i=t.getProperSourceVertexes();if(i.length>0)return i[0].node===null}return!1}tl(t,i,s){this.VI(t);for(const n of t){let o=-1;for(const r of n){const h=s?r.getProperSourceVertexes():r.getProperDestinationVertexes(),a=h.length;if(a>0){h.sort((u,c)=>u.Eh-c.Eh);const l=(a-1)/2;for(let u=Math.floor(l),c=Math.ceil(l);u<=c;u++)if(r.An===r){const d=h[u];let f;s?f=d.getDestinationEdge(r):f=r.getDestinationEdge(d),!i.has(f)&&o<d.Eh&&(d.An=r,r.tc=d.tc,r.An=d.tc,o=d.Eh)}}}}}VI(t){for(let i=0;i<t.length;i++){const s=t[i];for(let n=0;n<s.length;n++){const o=s[n];o.tc=o,o.An=o,o.RD=i,o.Eh=n}}}hk(t,i,s){const n=this.b===90||this.b===270;for(const r of t)for(const h of r)h.Je=h,h.Qf=1/0,h.he=NaN,h.Tn=0;this.zI(t,i,s);for(const r of t)for(const h of r)h.tc===h&&this.vD(h,t);for(let r=0;r<t.length;r++){if(t[r].length<=0)continue;const h=t[r][0];if(h.Je===h){h.Je.Qf===1/0&&(h.Je.Qf=0);let a=r,l=0,u;do{for(u=t[a][l];u.An!==u.tc;)if(u=u.An,a++,u.Eh>0){const c=this.OD(u,t),d=n?c.width:c.height,f=u.Je.Qf+u.he+u.Tn-(c.he+c.Tn+d+this.columnSpacing);c.Je.Qf=Math.min(c.Je.Qf,f)}l=u.Eh+1}while(a<t.length&&l<t[a].length&&u.Je===t[a][l].Je)}}const o=new bt;for(const r of t)for(const h of r){h.he=h.he+h.Je.Qf+h.Tn;const a=n?h.width:h.height;o.set(h,s?-h.he-a:h.he)}return o}zI(t,i,s){const n=this.b===90||this.b===270;for(const o of t)for(const r of o)if(r.tc===r){let h=0,a=r;for(;a.An!==r;){const l=a.An,u=n?a.width:a.height,c=n?l.width:l.height;let d,f,m,p;i?(m=a.getDestinationEdge(l),d=m.portFromPos,f=m.portToPos,m.link!==null&&(a.node&&a.node!==m.link.fromNode&&(d=n?a.focusX:a.focusY),l.node&&l.node!==m.link.toNode&&(f=n?l.focusX:l.focusY)),s?p=a.Tn+(u-d)-(c-f):p=a.Tn+d-f):(m=l.getDestinationEdge(a),d=m.portToPos,f=m.portFromPos,m.link!==null&&(a.node&&a.node!==m.link.toNode&&(d=n?a.focusX:a.focusY),l.node&&l.node!==m.link.fromNode&&(f=n?l.focusX:l.focusY)),s?p=a.Tn+(u-d)-(c-f):p=a.Tn+d-f),l.Tn=p,h=Math.min(h,p),a=a.An}a=r;do a.Tn=a.Tn-h,a=a.An;while(a!==r)}}vD(t,i){if(!isNaN(t.he))return;t.he=0;let s=t;do{if(s.Eh>0){const n=this.OD(s,i),o=n.tc;this.vD(o,i),t.Je===t&&(t.Je=o.Je);const r=this.b===90||this.b===270?n.width:n.height;if(t.Je===o.Je){const h=o.he+n.Tn+r-s.Tn+this.columnSpacing;t.he=Math.max(t.he,h)}}s=s.An}while(s!==t);for(;s.An!==t;)s=s.An,s.he=t.he,s.Je=t.Je}OD(t,i){const s=t.RD,n=t.Eh;return n<1&&b.o("Could not determine previous vertex in layer"),i[s][n-1]}UI(...t){let i=-1;const s=b.et(),n=b.et();let o=1/0;for(let r=0;r<4;r++){if(!t[r])continue;const h=this.XI(t[r],s,n,r);h<o&&(i=r,o=h)}for(let r=0;r<4;r++){const h=t[r];if(!h)continue;const a=r===0||r===2?s[i]-s[r]:n[i]-n[r];a!==0&&h.each(l=>{h.set(l.key,l.value+a)})}b.J(s),b.J(n)}XI(t,i,s,n){if(!t||t.count===0)return i[n]=0,s[n]=0,1/0;let o=1/0,r=-1/0;return t.each(h=>{const a=h.key,l=h.value,u=this.b===90||this.b===270?a.width:a.height;l<o&&(o=l),l+u>r&&(r=l+u)}),i[n]=o,s[n]=r,r-o}commitLayout(){this.Xy(),this.commitNodes(),this.iC(),this.isRouting&&this.commitLinks()}Xy(){if(!this.setsPortSpots)return;const t=this.rk(!0),i=this.rk(!1),s=this.network.edges.iterator;for(;s.next();){const n=s.value.link;n!==null&&(n.fromSpot=t,n.toSpot=i)}}rk(t){return this.b===270?t?B.MiddleTop:B.MiddleBottom:this.b===90?t?B.MiddleBottom:B.MiddleTop:this.b===180?t?B.MiddleLeft:B.MiddleRight:t?B.MiddleRight:B.MiddleLeft}commitNodes(){this.Zs=[],this.Ls=[],this.As=[],this.It=[];for(let m=0;m<=this.kt;m++)this.Zs[m]=0,this.Ls[m]=0,this.As[m]=0,this.It[m]=0;const t=this.network.vertexes.iterator;for(;t.next();){const m=t.value,p=m.layer;this.Zs[p]=Math.max(this.Zs[p],this.nodeMinLayerSpace(m,!0)),this.Ls[p]=Math.max(this.Ls[p],this.nodeMinLayerSpace(m,!1))}let i=0;const s=this.Ns;for(let m=0;m<=this.kt;m++){let p=s;this.Zs[m]+this.Ls[m]<=0&&(p=0),m>0&&(i+=p/2),this.b===90||this.b===0?(i+=this.Ls[m],this.As[m]=i,i+=this.Zs[m]):(i+=this.Zs[m],this.As[m]=i,i+=this.Ls[m]),m<this.kt&&(i+=p/2),this.It[m]=i}const n=i,o=this.arrangementOrigin;for(let m=0;m<=this.kt;m++)this.b===270?this.As[m]=o.y+this.As[m]:this.b===90?(this.As[m]=o.y+n-this.As[m],this.It[m]=n-this.It[m]):this.b===180?this.As[m]=o.x+this.As[m]:(this.As[m]=o.x+n-this.As[m],this.It[m]=n-this.It[m]);const r=this.Ln!==0;t.reset();const h=this.b===270||this.b===90;let a=1/0,l=1/0,u=1/0,c=-1/0;for(;t.next();){const m=t.value,p=m.layer,y=m.column|0;let x=0,P=0;h?(x=o.x+this.Wi*y,P=this.As[p]):(x=this.As[p],P=o.y+this.Wi*y),m.centerX=x,m.centerY=P,r&&isFinite(m.he)&&(h?m.node?m.x=o.x+m.he:m.centerX=o.x+m.he:m.node?m.y=o.y+m.he:m.centerY=o.y+m.he),a=Math.min(m.x,a),l=Math.min(m.y,l),h?(u=a,c=Math.max(c,m.bounds.right)):(u=l,c=Math.max(c,m.bounds.bottom))}this.ZN=c-u;const d=o.x-a,f=o.y-l;for(this._o=new S(r&&h?0:d,r&&!h?0:f),t.reset();t.next();){const m=t.value;m.x+=d,m.y+=f,m.commit()}}iC(){let t=0;const i=this.Ns;for(let o=0;o<=this.kt;o++)t+=this.Zs[o],t+=this.Ls[o];t+=this.kt*i;const s=[],n=this.Ln!==0?this.ZN:this.Wi*this.zt;for(let o=this.maxLayer;o>=0;o--)this.b===270?o===0?s.push(new z(0,0,n,Math.abs(this.It[0]))):s.push(new z(0,this.It[o-1],n,Math.abs(this.It[o-1]-this.It[o]))):this.b===90?o===0?s.push(new z(0,this.It[0],n,Math.abs(this.It[0]-t))):s.push(new z(0,this.It[o],n,Math.abs(this.It[o-1]-this.It[o]))):this.b===180?o===0?s.push(new z(0,0,Math.abs(this.It[0]),n)):s.push(new z(this.It[o-1],0,Math.abs(this.It[o-1]-this.It[o]),n)):o===0?s.push(new z(this.It[0],0,Math.abs(this.It[0]-t),n)):s.push(new z(this.It[o],0,Math.abs(this.It[o-1]-this.It[o]),n));this.commitLayers(s,this._o)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i;for(;t.next();)i=t.value.link,i!==null&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,i!==null&&i.updateRoute();for(t.reset();t.next();){const s=t.value;if(i=s.link,i===null||i.pointsCount===0)continue;i.startRoute();const n=i;let o=n.fromNode,r=n.toNode,h=n.fromPort,a=n.toPort;if(o!==null){const D=o.findVisibleNode();D!==null&&D!==o&&(o=D,h=D.port)}if(r!==null){const D=r.findVisibleNode();D!==null&&D!==r&&(r=D,a=D.port)}const l=i.computeSpot(!0,h),u=i.computeSpot(!1,a);let c=s.fromVertex,d=s.toVertex;if(s.valid){if(i.curve===9&&i.pointsCount===4)if(c.column===d.column&&this.alignOption===0){const D=i.getLinkPoint(o,h,l,!0,!1,r,a),O=i.getLinkPoint(r,a,u,!1,!1,o,h);D.isReal()||D.set(o.actualBounds.center),O.isReal()||O.set(r.actualBounds.center),i.clearPoints(),i.addPointAt(D.x,D.y),i.addPointAt((2*D.x+O.x)/3,(2*D.y+O.y)/3),i.addPointAt((D.x+2*O.x)/3,(D.y+2*O.y)/3),i.addPointAt(O.x,O.y)}else{let D=!1,O=!1;if(h!==null&&l===B.None&&(D=!0),a!==null&&u===B.None&&(O=!0),D||O){let R=null;D&&(R=i.getLinkPointFromPoint(o,h,h.getDocumentPoint(B.Center),i.getPoint(3),!0),R.isReal()||R.set(o.actualBounds.center),i.setPointAt(0,R.x,R.y));let I=null;if(O&&(I=i.getLinkPointFromPoint(r,a,a.getDocumentPoint(B.Center),i.getPoint(0),!1),I.isReal()||I.set(r.actualBounds.center),i.setPointAt(3,I.x,I.y)),R){const X=i.getPoint(2);i.setPointAt(1,(R.x*2+X.x)/3,(R.y*2+X.y)/3)}if(I){const X=i.getPoint(1);i.setPointAt(2,(I.x*2+X.x)/3,(I.y*2+X.y)/3)}}}i.commitRoute();continue}if(c.layer===d.layer){i.commitRoute();continue}let f=!1,m=!1;const p=this.Ns;let y=0,x=i.firstPickIndex+1;if(i.isOrthogonal)m=!0,y=i.pointsCount,y>4&&i.points.removeRange(2,y-3);else if(i.curve===9)f=!0,y=i.pointsCount,y>4&&i.points.removeRange(2,y-3),y===4&&(x=2);else{y=i.pointsCount;const D=l===B.None,O=u===B.None;y>2&&D&&O?i.points.removeRange(1,y-2):y>3&&D&&!O?i.points.removeRange(1,y-3):y>3&&!D&&O?i.points.removeRange(2,y-2):y>4&&!D&&!O&&i.points.removeRange(2,y-3)}let P,k,v=0,N=0,M=0,C=0,F=0,T=0,L=0;if(s.rev){let D=0;for(;d!==null&&c!==d;){P=null,k=null;const O=d.sourceEdges.iterator;for(;O.next();){const R=O.value;if(R.link===s.link&&(P=R.fromVertex,k=R.toVertex,P.node===null))break}if(P===null)break;if(P!==c)if(v=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=P.centerX,C=P.centerY,m)this.b===180||this.b===0?x===i.firstPickIndex+1?(i.insertPointAt(x++,v,N),i.insertPointAt(x++,v,C)):(k!==null?k.centerY:N)!==C&&(F=this.It[P.layer-1]+this._o.x,i.insertPointAt(x++,F,N),i.insertPointAt(x++,F,C)):x===i.firstPickIndex+1?(i.insertPointAt(x++,v,N),i.insertPointAt(x++,M,N)):(k!==null?k.centerX:v)!==M&&(F=this.It[P.layer-1]+this._o.y,i.insertPointAt(x++,v,F),i.insertPointAt(x++,M,F));else if(x===i.firstPickIndex+1)if(T=Math.max(10,this.Zs[d.layer]),L=Math.max(10,this.Ls[d.layer]),f)this.b===180?M<=d.bounds.x?(D=d.bounds.x,i.insertPointAt(x++,D-T,C),i.insertPointAt(x++,D,C),i.insertPointAt(x++,D+L,C)):(i.insertPointAt(x++,M-T,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M+L,C)):this.b===90?C>=d.bounds.bottom?(D=d.bounds.y+d.bounds.height,i.insertPointAt(x++,M,D+L),i.insertPointAt(x++,M,D),i.insertPointAt(x++,M,D-T)):(i.insertPointAt(x++,M,C+L),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C-T)):this.b===270?C<=d.bounds.y?(D=d.bounds.y,i.insertPointAt(x++,M,D-T),i.insertPointAt(x++,M,D),i.insertPointAt(x++,M,D+L)):(i.insertPointAt(x++,M,C-T),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C+L)):this.b===0&&(M>=d.bounds.right?(D=d.bounds.x+d.bounds.width,i.insertPointAt(x++,D+L,C),i.insertPointAt(x++,D,C),i.insertPointAt(x++,D-T,C)):(i.insertPointAt(x++,M+L,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M-T,C)));else{i.insertPointAt(x++,v,N);let R=0;this.b===180||this.b===0?((this.b===180?M>=d.bounds.right:M<=d.bounds.x)&&(R=(this.b===0?-T:L)/2),i.insertPointAt(x++,v+R,C)):((this.b===270?C>=d.bounds.bottom:C<=d.bounds.y)&&(R=(this.b===90?-T:L)/2),i.insertPointAt(x++,M,N+R)),i.insertPointAt(x++,M,C)}else T=Math.max(10,this.Zs[P.layer]),L=Math.max(10,this.Ls[P.layer]),f?this.b===180?(i.insertPointAt(x++,M-T-p,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M+L+p,C)):this.b===90?(i.insertPointAt(x++,M,C+L+p),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C-T-p)):this.b===270?(i.insertPointAt(x++,M,C-T-p),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C+L+p)):(i.insertPointAt(x++,M+L+p,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M-T-p,C)):(this.b===180||this.b===90||this.b,i.insertPointAt(x++,M,C));d=P}if(a===null||l!==B.None||m)if(v=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=i.getPoint(x).x,C=i.getPoint(x).y,m){const O=this.Ls[c.layer];let R=0;this.b===180||this.b===0?(R=N,R>=c.bounds.y&&R<=c.bounds.bottom&&(this.b===180?M>=c.bounds.x:M<=c.bounds.right)&&(D=c.centerX+(this.b===180?-O:O),R<c.bounds.y+c.bounds.height/2?R=c.bounds.y-this.Wi/2:R=c.bounds.bottom+this.Wi/2,i.insertPointAt(x++,D,N),i.insertPointAt(x++,D,R)),i.insertPointAt(x++,M,R),i.insertPointAt(x++,M,C)):(R=v,R>=c.bounds.x&&R<=c.bounds.right&&(this.b===270?C>=c.bounds.y:C<=c.bounds.bottom)&&(D=c.centerY+(this.b===270?-O:O),R<c.bounds.x+c.bounds.width/2?R=c.bounds.x-this.Wi/2:R=c.bounds.right+this.Wi/2,i.insertPointAt(x++,v,D),i.insertPointAt(x++,R,D)),i.insertPointAt(x++,R,C),i.insertPointAt(x++,M,C))}else if(f)T=Math.max(10,this.Zs[c.layer]),L=Math.max(10,this.Ls[c.layer]),this.b===180&&M>=c.bounds.x?(D=c.bounds.x+c.bounds.width,i.setPointAt(x-2,D,N),i.setPointAt(x-1,D+L,N)):this.b===90&&C<=c.bounds.bottom?(D=c.bounds.y,i.setPointAt(x-2,v,D),i.setPointAt(x-1,v,D-T)):this.b===270&&C>=c.bounds.y?(D=c.bounds.y+c.bounds.height,i.setPointAt(x-2,v,D),i.setPointAt(x-1,v,D+L)):this.b===0&&M<=c.bounds.right&&(D=c.bounds.x,i.setPointAt(x-2,D,N),i.setPointAt(x-1,D-T,N));else{T=Math.max(10,this.Zs[c.layer]),L=Math.max(10,this.Ls[c.layer]);let O=0;this.b===180||this.b===0?((this.b===180?M<=c.bounds.x:M>=c.bounds.right)&&(O=(this.b===0?L:-T)/2),i.insertPointAt(x++,M+O,N)):((this.b===270?C<=c.bounds.y:C>=c.bounds.bottom)&&(O=(this.b===90?L:-T)/2),i.insertPointAt(x++,v,C+O)),i.insertPointAt(x++,M,C)}}else{for(;c!==null&&c!==d;){P=null,k=null;const D=c.destinationEdges.iterator;for(;D.next();){const O=D.value;if(O.link===s.link&&(P=O.toVertex,k=O.fromVertex,k.node!==null&&(k=null),P.node===null))break}if(P===null)break;P!==d&&(v=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=P.centerX,C=P.centerY,m?this.b===180||this.b===0?(k!==null?k.centerY:N)!==C&&(F=this.It[P.layer]+this._o.x,x===i.firstPickIndex+1&&(this.b===0?F=Math.max(F,v):F=Math.min(F,v)),i.insertPointAt(x++,F,N),i.insertPointAt(x++,F,C)):(k!==null?k.centerX:v)!==M&&(F=this.It[P.layer]+this._o.y,x===i.firstPickIndex+1&&(this.b===90?F=Math.max(F,N):F=Math.min(F,N)),i.insertPointAt(x++,v,F),i.insertPointAt(x++,M,F)):(T=Math.max(10,this.Zs[P.layer]),L=Math.max(10,this.Ls[P.layer]),f?this.b===180?(i.insertPointAt(x++,M+L+p,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M-T-p,C)):this.b===90?(i.insertPointAt(x++,M,C-T-p),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C+L+p)):this.b===270?(i.insertPointAt(x++,M,C+L+p),i.insertPointAt(x++,M,Math.max(C+L-p/2,C)),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,Math.min(C-T+p/2,C)),i.insertPointAt(x++,M,C-T-p)):(i.insertPointAt(x++,M-T-p,C),i.insertPointAt(x++,Math.min(M-T+p/2,M),C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,M,C),i.insertPointAt(x++,Math.max(M+L-p/2,M),C),i.insertPointAt(x++,M+L+p,C)):this.b===180?(i.insertPointAt(x++,M+L,C),i.insertPointAt(x++,M-T,C)):this.b===90?(i.insertPointAt(x++,M,C-T),i.insertPointAt(x++,M,C+L)):this.b===270?(i.insertPointAt(x++,M,C+L),i.insertPointAt(x++,M,C-T)):(i.insertPointAt(x++,M-T,C),i.insertPointAt(x++,M+L,C)))),c=P}m&&(v=i.getPoint(x-1).x,N=i.getPoint(x-1).y,M=i.getPoint(x).x,C=i.getPoint(x).y,this.b===180||this.b===0?N!==C&&(this.b===0?F=Math.min(Math.max((M+v)/2,this.It[d.layer]+this._o.x),M):F=Math.max(Math.min((M+v)/2,this.It[d.layer]+this._o.x),M),i.insertPointAt(x++,F,N),i.insertPointAt(x++,F,C)):v!==M&&(this.b===90?F=Math.min(Math.max((C+N)/2,this.It[d.layer]+this._o.y),C):F=Math.max(Math.min((C+N)/2,this.It[d.layer]+this._o.y),C),i.insertPointAt(x++,v,F),i.insertPointAt(x++,M,F)))}if(n!==null&&f&&i.pointsCount>=4){if(h!==null){const D=l===B.None?i.getLinkPointFromPoint(o,h,h.getDocumentPoint(B.Center),i.getPoint(3),!0):i.getPoint(0);if(l===B.None){const O=i.getPoint(2),R=i.getPoint(3);this.direction===90||this.direction===270?(i.setPointAt(1,(D.x+O.x)/2,O.y),i.setPointAt(2,R.x,(O.y+R.y)/2)):(i.setPointAt(1,O.x,(D.y+O.y)/2),i.setPointAt(2,(O.x+R.x)/2,R.y))}D.isReal()||D.set(o.actualBounds.center),i.setPointAt(0,D.x,D.y)}if(a!==null){const D=u===B.None?i.getLinkPointFromPoint(r,a,a.getDocumentPoint(B.Center),i.getPoint(i.pointsCount-4),!1):i.getPoint(i.pointsCount-1);if(u===B.None){const O=i.getPoint(i.pointsCount-3),R=i.getPoint(i.pointsCount-4);this.direction===90||this.direction===270?(i.setPointAt(i.pointsCount-2,(D.x+O.x)/2,O.y),i.setPointAt(i.pointsCount-2,R.x,(O.y+R.y)/2)):(i.setPointAt(i.pointsCount-2,O.x,(D.y+O.y)/2),i.setPointAt(i.pointsCount-3,(O.x+R.x)/2,R.y))}D.isReal()||D.set(r.actualBounds.center),i.setPointAt(i.pointsCount-1,D.x,D.y)}}i.commitRoute(),s.commit()}}aI(){this.Yy=-1,this.kg=0,this.Cs=0,this._a=null,this.Sg=null,this.$f=null;for(let t=0;t<this.Cn.length;t++)this.Cn[t]=null}Oh(t){let i;const s=this.ci[t];if(s>=this.Cn.length){const o=[];for(let r=0;r<this.Cn.length;r++)o[r]=this.Cn[r];this.Cn=o}this.Cn[s]===void 0||this.Cn[s]===null?i=[]:(i=this.Cn[s],this.Cn[s]=null);const n=this.$f[t];for(let o=0;o<n.length;o++){const r=n[o];i[r.index]=r}return i}Ih(t,i){this.Cn[this.ci[t]]=i}get layerSpacing(){return this.Ns}set layerSpacing(t){this.Ns!==t&&t>=0&&(this.Ns=t,this.invalidateLayout())}get columnSpacing(){return this.Wi}set columnSpacing(t){this.Wi!==t&&t>0&&(this.Wi=t,this.invalidateLayout())}get direction(){return this.b}set direction(t){this.b!==t&&(t===0||t===90||t===180||t===270?(this.b=t,this.invalidateLayout()):b.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.jf}set cycleRemoveOption(t){this.jf!==t&&(t===1||t===0||t===2)&&(this.jf=t,this.invalidateLayout())}get layeringOption(){return this.Hf}set layeringOption(t){this.Hf!==t&&(t===10||t===11||t===12)&&(this.Hf=t,this.invalidateLayout())}get initializeOption(){return this.qf}set initializeOption(t){this.qf!==t&&(t===20||t===21||t===22)&&(this.qf=t,this.invalidateLayout())}get iterations(){return this.Qa}set iterations(t){this.Qa!==t&&t>=0&&(this.Qa=t,this.invalidateLayout())}get aggressiveOption(){return this.Wf}set aggressiveOption(t){this.Wf!==t&&(t===30||t===31||t===32)&&(this.Wf=t,this.invalidateLayout())}get packOption(){return this.Qo}set packOption(t){this.Qo!==t&&t>=0&&t<8&&(this.Qo=t,this.invalidateLayout())}get packIterations(){return this.Jf}set packIterations(t){this.Jf=t}get alignOption(){return this.Ln}set alignOption(t){this.Ln!==t&&t>=0&&t<16&&(this.Ln=t,this.invalidateLayout())}get setsPortSpots(){return this.Nn}set setsPortSpots(t){this.Nn!==t&&(this.Nn=t,this.invalidateLayout())}get maxLayer(){return this.kt}get maxIndex(){return this.Yy}get maxColumn(){return this.zt}get minIndexLayer(){return this.kg}get maxIndexLayer(){return this.Cs}}g(Ht,"CycleDepthFirst",0),g(Ht,"CycleGreedy",1),g(Ht,"CycleFromLayers",2),g(Ht,"LayerOptimalLinkLength",10),g(Ht,"LayerLongestPathSink",11),g(Ht,"LayerLongestPathSource",12),g(Ht,"InitDepthFirstOut",20),g(Ht,"InitDepthFirstIn",21),g(Ht,"InitNaive",22),g(Ht,"AggressiveNone",30),g(Ht,"AggressiveLess",31),g(Ht,"AggressiveMore",32),g(Ht,"PackNone",0),g(Ht,"PackExpand",1),g(Ht,"PackStraighten",2),g(Ht,"PackMedian",4),g(Ht,"PackAll",15),g(Ht,"AlignNone",0),g(Ht,"AlignUpperLeft",1),g(Ht,"AlignUpperRight",2),g(Ht,"AlignLowerLeft",4),g(Ht,"AlignLowerRight",8),g(Ht,"AlignAll",15);class pn extends $e{constructor(e){super(e)}createVertex(){return new Ti(this)}createEdge(){return new yn(this)}}class Ti extends Ze{constructor(t){super(t);g(this,"Yo");g(this,"Hr");g(this,"At");g(this,"ak");g(this,"ck");g(this,"$i");g(this,"Zf");g(this,"Xn");g(this,"ok");g(this,"ek");g(this,"sk");g(this,"tc");g(this,"An");g(this,"RD");g(this,"Eh");g(this,"Je");g(this,"Qf");g(this,"he");g(this,"Tn");g(this,"Hy",null);g(this,"qy",null);g(this,"Wy",null);g(this,"Jy",null);this.Yo=-1,this.Hr=-1,this.At=-1,this.ak=NaN,this.ck=null,this.$i=!1,this.Zf=NaN,this.Xn=NaN,this.ok=0,this.ek=null,this.sk=null}static ID(t,i){return t.index-i.index}getProperSourceEdges(){if(!this.Wy){const t=[];for(const i of this.fo){const s=i;s.valid&&t.push(s)}this.Wy=t}return this.Wy}getProperDestinationEdges(){if(!this.Jy){const t=[];for(const i of this.Wo){const s=i;s.valid&&t.push(s)}this.Jy=t}return this.Jy}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const s of i)if(s.toVertex===t)return s;b.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Hy){const t=[];for(const i of this.fo){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.fromVertex)}t.sort(Ti.ID),this.Hy=t}return this.Hy}getProperDestinationVertexes(){if(!this.qy){const t=[];for(const i of this.Wo){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.toVertex)}t.sort(Ti.ID),this.qy=t}return this.qy}addSourceEdge(t){super.addSourceEdge(t),this.Hy=null,this.Wy=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Hy=null,this.Wy=null}addDestinationEdge(t){super.addDestinationEdge(t),this.qy=null,this.Jy=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.qy=null,this.Jy=null}get layer(){return this.Yo}set layer(t){this.Yo!==t&&(this.Yo=t)}get column(){return this.Hr}set column(t){this.Hr!==t&&(this.Hr=t)}get index(){return this.At}set index(t){this.At!==t&&(this.At=t)}get component(){return this.ak}set component(t){this.ak!==t&&(this.ak=t)}get near(){return this.ck}set near(t){this.ck!==t&&(this.ck=t)}}class yn extends pi{constructor(t){super(t);g(this,"$i");g(this,"fk");g(this,"uk");g(this,"dk");g(this,"gk");g(this,"mk");g(this,"pk");this.$i=!1,this.fk=!1,this.uk=!1,this.dk=NaN,this.gk=NaN,this.mk=0,this.pk=0}get fromVertex(){return this.He}set fromVertex(t){this.He!==t&&(this.He=t)}get toVertex(){return this.qe}set toVertex(t){this.qe!==t&&(this.qe=t)}get valid(){return this.$i}set valid(t){this.$i!==t&&(this.$i=t)}get rev(){return this.fk}set rev(t){this.fk!==t&&(this.fk=t)}get forest(){return this.uk}set forest(t){this.uk!==t&&(this.uk=t)}get portFromPos(){return this.dk}set portFromPos(t){this.dk!==t&&(this.dk=t)}get portToPos(){return this.gk}set portToPos(t){this.gk!==t&&(this.gk=t)}get portFromColOffset(){return this.mk}set portFromColOffset(t){this.mk!==t&&(this.mk=t)}get portToColOffset(){return this.pk}set portToColOffset(t){this.pk!==t&&(this.pk=t)}}var Cs=(w=>(w[w.Default=0]="Default",w[w.Destination=1]="Destination",w[w.Source=2]="Source",w))(Cs||{}),Ts=(w=>(w[w.Forwards=10]="Forwards",w[w.Reverse=11]="Reverse",w[w.Ascending=12]="Ascending",w[w.Descending=13]="Descending",w))(Ts||{}),Ls=(w=>(w[w.CenterSubtrees=20]="CenterSubtrees",w[w.CenterChildren=21]="CenterChildren",w[w.Start=22]="Start",w[w.End=23]="End",w[w.Bus=24]="Bus",w[w.BusBranching=25]="BusBranching",w[w.TopLeftBus=26]="TopLeftBus",w[w.BottomRightBus=27]="BottomRightBus",w[w.Custom=28]="Custom",w))(Ls||{}),As=(w=>(w[w.None=30]="None",w[w.Block=31]="Block",w))(As||{}),Ds=(w=>(w[w.Layered=40]="Layered",w[w.LastParents=41]="LastParents",w[w.Alternating=42]="Alternating",w[w.RootOnly=43]="RootOnly",w))(Ds||{}),Fs=(w=>(w[w.Vertical=50]="Vertical",w[w.Horizontal=51]="Horizontal",w[w.FixedRoots=52]="FixedRoots",w))(Fs||{}),xn=(w=>(w[w.Individual=60]="Individual",w[w.Siblings=61]="Siblings",w[w.Uniform=62]="Uniform",w))(xn||{});class Vt extends ne{constructor(t){super();g(this,"Fi");g(this,"Li");g(this,"_f");g(this,"Ng");g(this,"eC");g(this,"Fe");g(this,"Xi");g(this,"Ms");g(this,"U");g(this,"B");g(this,"yk");g(this,"ls");this.Fi=new K,this.Li=0,this.ls=1,this._f=40,this.Ng=60,this.eC=[],this.Fe=!0,this.Xi=50,this.Ms=new ot(10,10).u();const i=new Os(this);this.U=new Me(i),this.B=new Me(i),this.yk=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Li=this.Li,t._f=this._f,t.Ng=this.Ng,t.Fe=this.Fe,t.Xi=this.Xi,t.Ms.a(this.Ms),t.U.copyInheritedPropertiesFrom(this.U),t.B.copyInheritedPropertiesFrom(this.B)}oi(t){t in Ls?this.alignment=t:t in Fs?this.arrangement=t:t in As?this.compaction=t:t in Cs?this.path=t:t in Ts?this.sorting=t:t in Ds?this.treeStyle=t:super.oi(t)}createNetwork(){return new Os(this)}makeNetwork(t){const i=this.createNetwork(),s=n=>{if(n instanceof st)return!n.isLinkLabel&&n.category!=="Comment";if(n instanceof at){const o=n.fromNode;if(o===null||o.isLinkLabel||o.category==="Comment")return!1;const r=n.toNode;return!(r===null||r.isLinkLabel||r.category==="Comment")}return!1};return t instanceof kt?(i.addParts(t.nodes,!0,s),i.addParts(t.links,!0,s)):t instanceof ut?i.addParts(t.memberParts,!1,s):i.addParts(t.iterator,!1,s),i}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;i===null&&t instanceof kt&&(i=t),this.path===0&&i!==null?this.ls=i.isTreePathToChildren?1:2:this.ls=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.HI(),this.qI(),this.WI(),this.JI(),this.$N(),this.$I(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Fi=new K,this.isValidLayout=!0}HI(){this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const o=t.value;o.initialized=!1,o.level=0,o.parent=null,o.children=[]}if(this.Fi.count>0){const o=new K,r=this.Fi.iterator;for(;r.next();){const h=r.value;if(h instanceof st){const a=this.network.findVertex(h);a!==null&&o.add(a)}else h instanceof Me&&o.add(h)}this.Fi=o}this.Fi.count===0&&this.findRoots();const i=this.Fi.copy().iterator;for(;i.next();){const o=i.value;o.initialized||(o.initialized=!0,this.sC(o))}let s=this.network.vertexes,n=null;for(;n=this.ZI(s),n.count>0;){const o=this.ED(n);o!==null&&this.Fi.add(o),o.initialized=!0,this.sC(o),s=n}}ZI(t){const i=new K,s=t.iterator;for(;s.next();){const n=s.value;n.initialized||i.add(n)}return i}findRoots(){const t=this.network.vertexes,i=t.iterator;for(;i.next();){const s=i.value;switch(this.ls){case 1:s.sourceEdges.count===0&&this.Fi.add(s);break;case 2:s.destinationEdges.count===0&&this.Fi.add(s);break;default:b.o("Unhandled path value "+this.ls.toString())}}if(this.Fi.count===0){const s=this.ED(t);s!==null&&this.Fi.add(s)}}ED(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const o=n.value;switch(this.ls){case 1:o.sourceEdges.count<i&&(i=o.sourceEdges.count,s=o);break;case 2:o.destinationEdges.count<i&&(i=o.destinationEdges.count,s=o);break;default:b.o("Unhandled path value "+this.ls.toString())}}return s}sC(t){if(t===null)return;switch(this.ls){case 1:if(t.destinationEdges.count>0){const n=new J,o=t.destinationVertexes;for(;o.next();){const r=o.value;this.UD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;case 2:if(t.sourceEdges.count>0){const n=new J,o=t.sourceVertexes;for(;o.next();){const r=o.value;this.UD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;default:b.o("Unhandled path value"+this.ls.toString())}const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.initialized=!0,o.level=t.level+1,o.parent=t,this.Fi.delete(o)}for(let n=0;n<s;n++){const o=i[n];this.sC(o)}}UD(t,i){return i.initialized?this.QI(i,t)||i.level>t.level?!1:(this._I(i.parent,i),!0):!0}QI(t,i){if(i===null)return!1;let s=i.parent;for(;s!==null&&s!==t;)s=s.parent;return s===t}_I(t,i){if(t===null||i===null)return;const s=t.children;let n=0;for(let o=0;o<s.length;o++)s[o]===i&&n++;if(n>0){const o=new Array(s.length-n);let r=0;for(let h=0;h<s.length;h++)s[h]!==i&&(o[r++]=s[h]);t.children=o}}qI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof Me&&this.BD(i)}}BD(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let i=0,s=t.childrenCount,n=0;const o=t.children,r=o.length;for(let h=0;h<r;h++){const a=o[h];this.BD(a),i+=a.descendantCount+1,s=Math.max(s,a.maxChildrenCount),n=Math.max(n,a.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=s,t.maxGenerationCount=s>0?n+1:0}tE(t){switch(this._f){default:case 40:return t.parent!==null?t.parent:this.U;case 43:return t.parent===null?this.U:t.parent.parent===null?this.B:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.B:this.U;case 41:{let i=!0;if(t.childrenCount===0)i=!1;else{const s=t.children,n=s.length;for(let o=0;o<n;o++)if(s[o].childrenCount>0){i=!1;break}}return i&&t.parent!==null?this.B:t.parent!==null?t.parent:this.U}}}initializeTreeVertexValues(t){const i=this.tE(t);if(t.copyInheritedPropertiesFrom(i),t.parent!==null&&t.parent.alignment===25){let s=t.angle;const n=t.parent.children;let o=0;for(;o<n.length&&t!==n[o];)o++;o%2===0?o!==n.length-1&&(s===90?s=180:s===180?s=270:s===270?s=180:s=270):s===90?s=0:s===180?s=90:s===270?s=0:s=90,t.angle=s}t.initialized=!0}WI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof Me&&this.VD(i)}}VD(t){if(t===null)return;this.assignTreeVertexValues(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.VD(o)}}assignTreeVertexValues(t){}JI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof Me&&this.zD(i)}}zD(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.zD(o)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}$N(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.angle,s=t.parent;let n=0,o=21,r=!1;s!==null&&(n=s.angle,o=s.alignment,r=this.isBusAlignment(o));const h=i===90||i===270,a=n===90||n===270,l=t.childrenCount===0;let u=0,c=0,d=0;const f=t.commentSpacing;if(t.node!==null){const m=t.node.findNodesConnected();for(;m.next();){const p=m.value;if(p.category!=="Comment"||!p.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(p),p.ensureBounds();const y=p.measuredBounds;h&&!l||!r&&!a&&l||r&&a&&l?(u=Math.max(u,y.width),c+=y.height+Math.abs(d)):(u+=y.width+Math.abs(d),c=Math.max(c,y.height)),d=f}}if(t.comments!==null){h&&!l||!r&&!a&&l||r&&a&&l?(u+=Math.abs(t.commentMargin),c=Math.max(0,c-t.height)):(c+=Math.abs(t.commentMargin),u=Math.max(0,u-t.width));const m=z.V(0,0,t.bounds.width+u,t.bounds.height+c);t.bounds=m,z.e(m)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}$y(t){return t===24||t===25}nC(t){const i=t.parent;if(i!==null){const s=i.alignment;if(this.isBusAlignment(s))if(this.$y(s)){const n=i.children;let o=0;for(;o<n.length&&t!==n[o];)o++;return o%2===0}else return s===26}return!1}layoutComments(t){if(t.comments!==null){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,h=!1;s!==null&&(o=s.angle,r=s.alignment,h=this.isBusAlignment(r));const a=n===90||n===270,l=o===90||o===270,u=t.childrenCount===0,c=this.nC(t);let d=0;const f=t.comments,m=f.length,p=S.l();for(let x=0;x<m;x++){const P=f[x],k=P.measuredBounds;if(a&&!u||!h&&!l&&u||h&&l&&u){if(o>135&&!h||l&&c)if(t.commentMargin>=0){p.i(t.bounds.x-t.commentMargin-k.width,t.bounds.y+d),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleLeft,N.toSpot=B.MiddleRight}}else{p.i(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+d),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleRight,N.toSpot=B.MiddleLeft}}else if(t.commentMargin>=0){p.i(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+d),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleRight,N.toSpot=B.MiddleLeft}}else{p.i(t.bounds.x+t.commentMargin-k.width,t.bounds.y+d),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleLeft,N.toSpot=B.MiddleRight}}t.commentSpacing>=0?d+=k.height+t.commentSpacing:d+=t.commentSpacing-k.height}else{if(o>135&&!h||!l&&c)if(t.commentMargin>=0){p.i(t.bounds.x+d,t.bounds.y-t.commentMargin-k.height),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleTop,N.toSpot=B.MiddleBottom}}else{p.i(t.bounds.x+d,t.bounds.y+t.focus.y*2-t.commentMargin),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleBottom,N.toSpot=B.MiddleTop}}else if(t.commentMargin>=0){p.i(t.bounds.x+d,t.bounds.y+t.focus.y*2+t.commentMargin),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleBottom,N.toSpot=B.MiddleTop}}else{p.i(t.bounds.x+d,t.bounds.y+t.commentMargin-k.height),P.move(p);const v=P.findLinksInto();for(;v.next();){const N=v.value;N.fromSpot=B.MiddleTop,N.toSpot=B.MiddleBottom}}t.commentSpacing>=0?d+=k.width+t.commentSpacing:d+=t.commentSpacing-k.width}}S.e(p);const y=d-t.commentSpacing-(a?i.height:i.width);if(this.ls===1){const x=t.destinationEdges;for(;x.next();){const P=x.value.link;P!==null&&!P.isAvoiding&&(P.fromEndSegmentLength=y>0?y:NaN)}}else{const x=t.sourceEdges;for(;x.next();){const P=x.value.link;P!==null&&!P.isAvoiding&&(P.toEndSegmentLength=y>0?y:NaN)}}}}$I(){if(this.layerStyle===62){const i=[];let s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n);const r=o.angle===0||o.angle===180;let h=i[n.level];h===void 0&&(h=0),i[n.level]=Math.max(h,r?n.width:n.height)}for(let n=0;n<i.length;n++)i[n]===void 0&&(i[n]=0);for(this.eC=i,s=this.network.vertexes.iterator;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n),o.angle===0||o.angle===180?(o.angle===180&&(n.focusX+=i[n.level]-n.width),n.width=i[n.level]):(o.angle===270&&(n.focusY+=i[n.level]-n.height),n.height=i[n.level])}}else if(this.layerStyle===61){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value,n=s.angle===0||s.angle===180;let o=-1;for(let r=0;r<s.children.length;r++){const h=s.children[r];o=Math.max(o,n?h.width:h.height)}if(o>=0)for(let r=0;r<s.children.length;r++){const h=s.children[r];n?(s.angle===180&&(h.focusX+=o-h.width),h.width=o):(s.angle===270&&(h.focusY+=o-h.height),h.height=o)}}}const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof Me&&this.layoutTree(i)}}layoutTree(t){if(t===null)return;const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.layoutTree(o)}switch(t.compaction){case 30:this.XD(t);break;default:case 31:t.alignment===25?this.XD(t):this.iE(t);break}}XD(t){if(t.childrenCount===0){let j=!1,V=0,U=21;t.parent!==null&&(V=t.parent.angle,U=t.parent.alignment,j=this.isBusAlignment(U));const W=this.nC(t);t.O.i(0,0),t.ut.i(t.width,t.height),t.parent!==null&&t.comments!==null&&((V===180||V===270)&&!j||W)?V===180&&!j||(V===90||V===270)&&W?t.lt.i(t.width-t.focus.x*2,0):t.lt.i(0,t.height-t.focus.y*2):t.lt.i(0,0);return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let j=0;j<r;j++){const V=o[j];n=Math.max(n,s?V.ut.width:V.ut.height)}const h=t.alignment,a=h===22,l=h===23,u=this.isBusAlignment(h),c=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),f=t.nodeSpacing,m=this.computeNodeIndent(t),p=a||l?0:m/2,y=t.rowSpacing;let x=0;(a||l)&&(x=Math.max(0,t.rowIndent));const P=t.width,k=t.height;let v=0,N=0,M=0,C=0,F=0,T=0,L=0,D=0,O=0,R=0;if(u&&!this.$y(h)&&i>135&&o.reverse(),this.$y(h))if(r>1)for(let j=0;j<r;j++){const V=o[j],U=V.ut;j%2===0&&j!==r-1?O=Math.max(O,(s?U.width:U.height)+this.computeBusNodeSpacing(V)-f):j%2!==0&&(R=Math.max(R,(s?U.width:U.height)+this.computeBusNodeSpacing(V)-f))}else r===1&&(O=s?o[0].ut.width:o[0].ut.height);if(u)switch(h){case 24:case 25:let j;i<135?j=this.YD(t,o,O,R,v,N):j=this.GD(t,o,O,R,v,N),O=j.x,v=j.width,N=j.height;break;case 26:for(let V=0;V<r;V++){const U=o[V],W=U.ut,ct=L===0?0:y;s?(U.O.i(n-W.width,F+ct),v=Math.max(v,W.width),N=Math.max(N,F+ct+W.height),F+=ct+W.height):(U.O.i(C+ct,n-W.height),v=Math.max(v,C+ct+W.width),N=Math.max(N,W.height),C+=ct+W.width),L++}break;case 27:for(let V=0;V<r;V++){const U=o[V],W=U.ut,ct=L===0?0:y;s?(U.O.i(f/2+t.focus.x,F+ct),v=Math.max(v,W.width),N=Math.max(N,F+ct+W.height),F+=ct+W.height):(U.O.i(C+ct,f/2+t.focus.y),v=Math.max(v,C+ct+W.width),N=Math.max(N,W.height),C+=ct+W.width),L++}break}else for(let j=0;j<r;j++){const V=o[j],U=V.ut;if(s){c>0&&L>0&&C+f+U.width>c&&(C<n&&this.ic(t,h,n-C,0,D,j-1),T++,L=0,D=j,M=N,C=0,F=i>135?-N-y:N+y);const W=L===0?p:f;this.wk(V,0,F),V.O.i(C+W,F),v=Math.max(v,C+W+U.width),N=Math.max(N,M+(T===0?0:y)+U.height),C+=W+U.width}else{c>0&&L>0&&F+f+U.height>c&&(F<n&&this.ic(t,h,0,n-F,D,j-1),T++,L=0,D=j,M=v,F=0,C=i>135?-v-y:v+y);const W=L===0?p:f;this.wk(V,C,0),V.O.i(C,F+W),N=Math.max(N,F+W+U.height),v=Math.max(v,M+(T===0?0:y)+U.width),F+=W+U.height}L++}T>0&&(s?(N+=Math.max(0,d),C<v&&this.ic(t,h,v-C,0,D,r-1),x>0&&(l||this.tu(t,x,0,0,r-1),v+=x)):(v+=Math.max(0,d),F<N&&this.ic(t,h,0,N-F,D,r-1),x>0&&(l||this.tu(t,0,x,0,r-1),N+=x)));let I=0,X=0;switch(h){case 20:s?I+=v/2-t.focus.x-m/2:X+=N/2-t.focus.y-m/2;break;default:case 21:if(T>0)s?I+=v/2-t.focus.x-m/2:X+=N/2-t.focus.y-m/2;else{const V=r;if(s){const U=o[0].O.x+o[0].lt.x,W=o[V-1].O.x+o[V-1].lt.x+o[V-1].focus.x*2;I+=U+(W-U)/2-t.focus.x-m/2}else{const U=o[0].O.y+o[0].lt.y,W=o[V-1].O.y+o[V-1].lt.y+o[V-1].focus.y*2;X+=U+(W-U)/2-t.focus.y-m/2}}break;case 22:s?(I-=m,v+=m):(X-=m,N+=m);break;case 23:s?(I+=v-t.width+m,v+=m):(X+=N-t.height+m,N+=m);break;case 24:case 25:s?r>1?I+=O+f/2-t.focus.x:I+=o[0].focus.x-t.focus.x+o[0].lt.x:r>1?X+=O+f/2-t.focus.y:X+=o[0].focus.y-t.focus.y+o[0].lt.y;break;case 26:s?I+=v+f/2-t.focus.x:X+=N+f/2-t.focus.y;break;case 27:break;case 28:const j=this.customAlignment(t,I,X,v,N);I=j[0],X=j[1],v=j[2],N=j[3];break}for(let j=0;j<r;j++){const V=o[j];s?V.O.i(V.O.x+V.lt.x-I,V.O.y+(i>135?(u?-N:-V.ut.height)+V.lt.y-d:k+d+V.lt.y)):V.O.i(V.O.x+(i>135?(u?-v:-V.ut.width)+V.lt.x-d:P+d+V.lt.x),V.O.y+V.lt.y-X)}s?(v=this.oC(t,v,I),I<0&&(I=0),i>135&&(X+=N+d),N=Math.max(Math.max(N,k),N+k+d)):(i>135&&(I+=v+d),v=Math.max(Math.max(v,P),v+P+d),N=this.rC(t,N,X),X<0&&(X=0)),t.lt.i(I,X),t.ut.i(v,N)}customAlignment(t,i,s,n,o){return[i,s,n,o]}YD(t,i,s,n,o,r){const h=i.length;if(h===0)return new z(s,0,o,r);if(h===1){const y=i[0];return o=y.ut.width,r=y.ut.height,new z(s,0,o,r)}const a=t.nodeSpacing,l=t.rowSpacing,u=this.orthoAngle(t)===90;let c=0,d=0,f=0;for(let y=0;y<h;y++){if(y%2!==0||h>1&&y===h-1)continue;const x=i[y],P=x.ut,k=c===0?0:l;if(u){const v=this.computeBusNodeSpacing(x)-a;x.O.i(s-(P.width+v),f+k),o=Math.max(o,P.width+v),r=Math.max(r,f+k+P.height),f+=k+P.height}else{const v=this.computeBusNodeSpacing(x)-a;x.O.i(d+k,s-(P.height+v)),r=Math.max(r,P.height+v),o=Math.max(o,d+k+P.width),d+=k+P.width}c++}c=0;const m=d,p=f;u?(d=s+a,f=0):(d=0,f=s+a);for(let y=0;y<h;y++){if(y%2===0)continue;const x=i[y],P=x.ut,k=c===0?0:l;if(u){const v=this.computeBusNodeSpacing(x)-a;x.O.i(d+v,f+k),o=Math.max(o,d+P.width+v),r=Math.max(r,f+k+P.height),f+=k+P.height}else{const v=this.computeBusNodeSpacing(x)-a;x.O.i(d+k,f+v),o=Math.max(o,d+k+P.width),r=Math.max(r,f+P.height+v),d+=k+P.width}c++}if(h>1&&h%2===1){const y=i[h-1],x=y.ut,P=this.computeBusLastRowSpacing(y,u?Math.max(Math.abs(p),Math.abs(f)):Math.max(Math.abs(m),Math.abs(d)));if(u){y.O.i(s+a/2-y.focus.x-y.lt.x,r+P);const k=s+a/2-y.focus.x-y.lt.x;o=Math.max(o,k+x.width),k<0&&(o-=k),r=Math.max(r,Math.max(p,f)+P+x.height),y.O.x<0&&(s=this.xk(t,y.O.x,!1,s,a))}else{y.O.i(o+P,s+a/2-y.focus.y-y.lt.y),o=Math.max(o,Math.max(m,d)+P+x.width);const k=s+a/2-y.focus.y-y.lt.y;r=Math.max(r,k+x.height),k<0&&(r-=k),y.O.y<0&&(s=this.xk(t,y.O.y,!0,s,a))}}return new z(s,0,o,r)}GD(t,i,s,n,o,r){const h=i.length;if(h===0)return new z(s,0,o,r);if(h===1){const y=i[0];return o=y.ut.width,r=y.ut.height,new z(s,0,o,r)}const a=t.nodeSpacing,l=t.rowSpacing,u=this.orthoAngle(t)===270;let c=0,d=0,f=0;for(let y=0;y<h;y++){if(y%2!==0||h>1&&y===h-1)continue;const x=i[y],P=x.ut,k=c===0?0:l;if(u){const v=this.computeBusNodeSpacing(x)-a;f-=k+P.height,x.O.i(s-(P.width+v),f),o=Math.max(o,P.width+v),r=Math.max(r,Math.abs(f))}else{const v=this.computeBusNodeSpacing(x)-a;d-=k+P.width,x.O.i(d,s-(P.height+v)),r=Math.max(r,P.height+v),o=Math.max(o,Math.abs(d))}c++}c=0;const m=d,p=f;u?(d=s+a,f=0):(d=0,f=s+a);for(let y=0;y<h;y++){if(y%2===0)continue;const x=i[y],P=x.ut,k=c===0?0:l;if(u){const v=this.computeBusNodeSpacing(x)-a;f-=k+P.height,x.O.i(d+v,f),o=Math.max(o,d+P.width+v),r=Math.max(r,Math.abs(f))}else{const v=this.computeBusNodeSpacing(x)-a;d-=k+P.width,x.O.i(d,f+v),r=Math.max(r,f+P.height+v),o=Math.max(o,Math.abs(d))}c++}if(h>1&&h%2===1){const y=i[h-1],x=y.ut,P=this.computeBusLastRowSpacing(y,u?Math.max(Math.abs(p),Math.abs(f)):Math.max(Math.abs(m),Math.abs(d)));if(u){y.O.i(s+a/2-y.focus.x-y.lt.x,-r-x.height-P);const k=s+a/2-y.focus.x-y.lt.x;o=Math.max(o,k+x.width),k<0&&(o-=k),r=Math.max(r,Math.abs(Math.min(p,f))+P+x.height),y.O.x<0&&(s=this.xk(t,y.O.x,!1,s,a))}else{y.O.i(-o-x.width-P,s+a/2-y.focus.y-y.lt.y),o=Math.max(o,Math.abs(Math.min(m,d))+P+x.width);const k=s+a/2-y.focus.y-y.lt.y;r=Math.max(r,k+x.height),k<0&&(r-=k),y.O.y<0&&(s=this.xk(t,y.O.y,!0,s,a))}}for(let y=0;y<h;y++){const x=i[y];u?x.O.i(x.O.x,x.O.y+r):x.O.i(x.O.x+o,x.O.y)}return new z(s,0,o,r)}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return t.parent===null?0:t.parent.rowSpacing}xk(t,i,s,n,o){const r=t.children,h=r.length;for(let l=0;l<h;l++)s?r[l].O.i(r[l].O.x,r[l].O.y-i):r[l].O.i(r[l].O.x-i,r[l].O.y);const a=r[h-1];return Math.max(n,s?a.lt.y+a.focus.y-o/2:a.lt.x+a.focus.x-o/2)}oC(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.width>n&&(n=s+t.width),s<0&&(n-=s),n;case 22:return t.width>i?t.width:i;case 23:return t.focus.x*2>i?t.width:i+t.width-t.focus.x*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.width);return Math.max(t.width,r-o);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}rC(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.height>n&&(n=s+t.height),s<0&&(n-=s),n;case 22:return t.height>i?t.height:i;case 23:return t.focus.y*2>i?t.height:i+t.height-t.focus.y*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.height);return Math.max(t.height,r-o);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}lC(t,i,s){switch(t){case 20:i/=2,s/=2;break;case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:b.o("Unhandled alignment value "+t.toString())}return new S(i,s)}ic(t,i,s,n,o,r){const h=this.lC(i,s,n);this.tu(t,h.x,h.y,o,r)}tu(t,i,s,n,o){if(i===0&&s===0)return;const r=t.children;for(let h=n;h<=o;h++){const a=r[h].O;a.x+=i,a.y+=s}}wk(t,i,s){const n=t.parent;switch(this.ls){case 1:{const o=t.sourceEdges;for(;o.next();){const r=o.value;r.fromVertex===n&&r.relativePoint.i(i,s)}break}case 2:{const o=t.destinationEdges;for(;o.next();){const r=o.value;r.toVertex===n&&r.relativePoint.i(i,s)}break}default:b.o("Unhandled path value "+this.ls.toString())}}iE(t){if(t.childrenCount===0){const tt=t.parent;let it=!1,mt=0,ft=21;tt!==null&&(mt=tt.angle,ft=tt.alignment,it=this.isBusAlignment(ft));const Z=this.nC(t);t.O.i(0,0),t.ut.i(t.width,t.height),t.parent!==null&&t.comments!==null&&((mt===180||mt===270)&&!it||Z)?mt===180&&!it||(mt===90||mt===270)&&Z?t.lt.i(t.width-t.focus.x*2,0):t.lt.i(0,t.height-t.focus.y*2):t.lt.i(0,0),t.Cg=null,t.Lg=null;return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let tt=0;tt<r;tt++){const it=o[tt];n=Math.max(n,s?it.ut.width:it.ut.height)}const h=t.alignment,a=h===22,l=h===23,u=this.isBusAlignment(h),c=Math.max(0,t.breadthLimit),d=this.computeLayerSpacing(t),f=t.nodeSpacing,m=this.computeNodeIndent(t),p=t.rowSpacing;let y=0;(a||l)&&(y=Math.max(0,t.rowIndent));const x=t.width,P=t.height;let k=0,v=0,N=0,M=null,C=null,F=0,T=0,L=0,D=0,O=0,R=0,I=0,X=0,j=0;if(u&&!this.$y(h)&&i>135&&o.reverse(),this.$y(h))if(r>1)for(let tt=0;tt<r;tt++)tt%2===0&&tt!==r-1?X=Math.max(X,s?o[tt].ut.width:o[tt].ut.height):tt%2!==0&&(j=Math.max(j,s?o[tt].ut.width:o[tt].ut.height));else r===1&&(X=s?o[0].ut.width:o[0].ut.height);if(u){switch(h){case 24:let tt;i<135?tt=this.YD(t,o,X,j,k,v):tt=this.GD(t,o,X,j,k,v),X=tt.x,k=tt.width,v=tt.height;break;case 26:for(let it=0;it<r;it++){const mt=o[it],ft=mt.ut,Z=R===0?0:p;s?(mt.O.i(n-ft.width,D+Z),k=Math.max(k,ft.width),v=Math.max(v,D+Z+ft.height),D+=Z+ft.height):(mt.O.i(L+Z,n-ft.height),k=Math.max(k,L+Z+ft.width),v=Math.max(v,ft.height),L+=Z+ft.width),R++}break;case 27:for(let it=0;it<r;it++){const mt=o[it],ft=mt.ut,Z=R===0?0:p;s?(mt.O.i(f/2+t.focus.x,D+Z),k=Math.max(k,ft.width),v=Math.max(v,D+Z+ft.height),D+=Z+ft.height):(mt.O.i(L+Z,f/2+t.focus.y),k=Math.max(k,L+Z+ft.width),v=Math.max(v,ft.height),L+=Z+ft.width),R++}break}M=this.ae(2),C=this.ae(2),s?(M[0].i(0,0),M[1].i(0,v),C[0].i(k,0),C[1].i(k,v)):(M[0].i(0,0),M[1].i(k,0),C[0].i(0,v),C[1].i(k,v))}else for(let tt=0;tt<r;tt++){const it=o[tt],mt=it.ut;if(s){c>0&&R>0&&L+f+mt.width>c&&(L<n&&this.ic(t,h,n-L,0,I,tt-1),O++,R=0,I=tt,N=v,L=0,D=i>135?-v-p:v+p),this.wk(it,0,D);let ft=0;if(R===0)M=it.Cg,C=it.Lg,F=mt.width,T=mt.height,(M===null||C===null||i!==this.orthoAngle(it))&&(M=this.ae(2),C=this.ae(2),M[0].i(0,0),M[1].i(0,T),C[0].i(F,0),C[1].i(F,T));else{const Z=b.et(),ht=this.KD(t,it,M,C,F,T,Z);ft=ht.x,M=Z[0],C=Z[1],F=ht.width,T=ht.height,b.J(Z),L<mt.width&&ft<0&&(this.tu(t,-ft,0,I,tt-1),this.bk(M,-ft,0),this.bk(C,-ft,0),ft=0)}it.O.i(ft,D),k=Math.max(k,F),v=Math.max(v,N+(O===0?0:p)+mt.height),L=F}else{c>0&&R>0&&D+f+mt.height>c&&(D<n&&this.ic(t,h,0,n-D,I,tt-1),O++,R=0,I=tt,N=k,D=0,L=i>135?-k-p:k+p),this.wk(it,L,0);let ft=0;if(R===0)M=it.Cg,C=it.Lg,F=mt.width,T=mt.height,(M===null||C===null||i!==this.orthoAngle(it))&&(M=this.ae(2),C=this.ae(2),M[0].i(0,0),M[1].i(F,0),C[0].i(0,T),C[1].i(F,T));else{const Z=b.et(),ht=this.KD(t,it,M,C,F,T,Z);ft=ht.x,M=Z[0],C=Z[1],F=ht.width,T=ht.height,b.J(Z),D<mt.height&&ft<0&&(this.tu(t,0,-ft,I,tt-1),this.bk(M,0,-ft),this.bk(C,0,-ft),ft=0)}it.O.i(L,ft),v=Math.max(v,T),k=Math.max(k,N+(O===0?0:p)+mt.width),D=T}R++}O>0&&(s?(v+=Math.max(0,d),L<k&&this.ic(t,h,k-L,0,I,r-1),y>0&&(l||this.tu(t,y,0,0,r-1),k+=y)):(k+=Math.max(0,d),D<v&&this.ic(t,h,0,v-D,I,r-1),y>0&&(l||this.tu(t,0,y,0,r-1),v+=y)));let V=0,U=0;switch(h){case 20:s?V+=k/2-t.focus.x-m/2:U+=v/2-t.focus.y-m/2;break;default:case 21:if(O>0)s?V+=k/2-t.focus.x-m/2:U+=v/2-t.focus.y-m/2;else{const it=r;if(s){const mt=o[0].O.x+o[0].lt.x,ft=o[it-1].O.x+o[it-1].lt.x+o[it-1].focus.x*2;V+=mt+(ft-mt)/2-t.focus.x-m/2}else{const mt=o[0].O.y+o[0].lt.y,ft=o[it-1].O.y+o[it-1].lt.y+o[it-1].focus.y*2;U+=mt+(ft-mt)/2-t.focus.y-m/2}}break;case 22:s?(V-=m,k+=m):(U-=m,v+=m);break;case 23:s?(V+=k-t.width+m,k+=m):(U+=v-t.height+m,v+=m);break;case 24:s?r>1?V+=X+f/2-t.focus.x:V+=o[0].focus.x-t.focus.x+o[0].lt.x:r>1?U+=X+f/2-t.focus.y:U+=o[0].focus.y-t.focus.y+o[0].lt.y;break;case 26:s?V+=k+f/2-t.focus.x:U+=v+f/2-t.focus.y;break;case 27:break;case 28:const tt=this.customAlignment(t,V,U,k,v);V=tt[0],U=tt[1],k=tt[2],v=tt[3];break}for(let tt=0;tt<r;tt++){const it=o[tt];s?it.O.i(it.O.x+it.lt.x-V,it.O.y+(i>135?(u?-v:-it.ut.height)+it.lt.y-d:P+d+it.lt.y)):it.O.i(it.O.x+(i>135?(u?-k:-it.ut.width)+it.lt.x-d:x+d+it.lt.x),it.O.y+it.lt.y-U)}let W=0,ct=0;if(u)s?(k=this.oC(t,k,V),V<0&&(V=0),i>135&&(U+=v+d),v+=P+d,h===27&&(W+=f/2+t.focus.x),ct+=P+d):(i>135&&(V+=k+d),k+=x+d,v=this.rC(t,v,U),U<0&&(U=0),h===27&&(ct+=f/2+t.focus.y),W+=x+d);else if(s){if(t.comments===null){if(x>k){const tt=this.lC(h,x-k,0);W=tt.x,ct=tt.y,k=x,V=0}}else k=this.oC(t,k,V);V<0&&(W-=V,V=0),i>135&&(U+=v+d),v=Math.max(Math.max(v,P),v+P+d),ct+=P+d}else{if(i>135&&(V+=k+d),k=Math.max(Math.max(k,x),k+x+d),t.comments===null){if(P>v){const tt=this.lC(h,0,P-v);W=tt.x,ct=tt.y,v=P,U=0}}else v=this.rC(t,v,U);U<0&&(ct-=U,U=0),W+=x+d}let $,et;if(O>0)$=this.ae(4),et=this.ae(4),s?($[2].i(0,P+d),$[3].i($[2].x,v),et[2].i(k,$[2].y),et[3].i(et[2].x,$[3].y)):($[2].i(x+d,0),$[3].i(k,$[2].y),et[2].i($[2].x,v),et[3].i($[3].x,et[2].y));else{$=this.ae(M.length+2),et=this.ae(C.length+2);for(let tt=0;tt<M.length;tt++){const it=M[tt];$[tt+2].i(it.x+W,it.y+ct)}for(let tt=0;tt<C.length;tt++){const it=C[tt];et[tt+2].i(it.x+W,it.y+ct)}}s?($[0].i(V,0),$[1].i($[0].x,P),$[2].y<$[1].y&&($[2].x>$[0].x?$[2].a($[1]):$[1].a($[2])),$[3].y<$[2].y&&($[3].x>$[0].x?$[3].a($[2]):$[2].a($[3])),et[0].i(V+x,0),et[1].i(et[0].x,P),et[2].y<et[1].y&&(et[2].x<et[0].x?et[2].a(et[1]):et[1].a(et[2])),et[3].y<et[2].y&&(et[3].x<et[0].x?et[3].a(et[2]):et[2].a(et[3])),$[2].y-=d/2,et[2].y-=d/2):($[0].i(0,U),$[1].i(x,$[0].y),$[2].x<$[1].x&&($[2].y>$[0].y?$[2].a($[1]):$[1].a($[2])),$[3].x<$[2].x&&($[3].y>$[0].y?$[3].a($[2]):$[2].a($[3])),et[0].i(0,U+P),et[1].i(x,et[0].y),et[2].x<et[1].x&&(et[2].y<et[0].y?et[2].a(et[1]):et[1].a(et[2])),et[3].x<et[2].x&&(et[3].y<et[0].y?et[3].a(et[2]):et[2].a(et[3])),$[2].x-=d/2,et[2].x-=d/2),this._s(M),this._s(C),t.Cg=$,t.Lg=et,t.lt.i(V,U),t.ut.i(k,v)}bk(t,i,s){for(let n=0;n<t.length;n++){const o=t[n];o.x+=i,o.y+=s}}KD(t,i,s,n,o,r,h){const a=this.orthoAngle(t),l=a===90||a===270,u=t.nodeSpacing,c=s,d=n,f=o,m=r;let p=i.Cg,y=i.Lg;const x=i.ut,P=l?Math.max(m,x.height):Math.max(f,x.width);if((p===null||a!==this.orthoAngle(i))&&(p=this.ae(2),y=this.ae(2),l?(p[0].i(0,0),p[1].i(0,x.height),y[0].i(x.width,0),y[1].i(y[0].x,p[1].y)):(p[0].i(0,0),p[1].i(x.width,0),y[0].i(0,x.height),y[1].i(p[1].x,y[0].y))),l){const k=f;let v=k-this.eE(d,p,k);return v+=u,s=this.sE(c,p,v),n=this.nE(d,y,v),o=Math.max(0,v)+x.width,r=P,this._s(c),this._s(p),this._s(d),this._s(y),h[0]=s,h[1]=n,new z(v,0,o,r)}else{const k=m;let v=k-this.oE(d,p,k);return v+=u,s=this.rE(c,p,v),n=this.lE(d,y,v),o=P,r=Math.max(0,v)+x.height,this._s(c),this._s(p),this._s(d),this._s(y),h[0]=s,h[1]=n,new z(v,0,o,r)}}rE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,h=0;for(;r<i.length&&i[r].x<t[0].x;){const u=i[r++];n[h++].i(u.x,u.y+s)}for(;o<t.length;){const u=t[o++];n[h++].i(u.x,u.y)}const a=t[t.length-1].x;for(;r<i.length&&i[r].x<=a;)r++;for(;r<i.length&&i[r].x>a;){const u=i[r++];n[h++].i(u.x,u.y+s)}const l=this.ae(h);for(o=0;o<h;o++)l[o].a(n[o]);return this._s(n),l}sE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,h=0;for(;r<i.length&&i[r].y<t[0].y;){const u=i[r++];n[h++].i(u.x+s,u.y)}for(;o<t.length;){const u=t[o++];n[h++].i(u.x,u.y)}const a=t[t.length-1].y;for(;r<i.length&&i[r].y<=a;)r++;for(;r<i.length&&i[r].y>a;){const u=i[r++];n[h++].i(u.x+s,u.y)}const l=this.ae(h);for(o=0;o<h;o++)l[o].a(n[o]);return this._s(n),l}lE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,h=0;for(;o<t.length&&t[o].x<i[0].x;){const u=t[o++];n[h++].i(u.x,u.y)}for(;r<i.length;){const u=i[r++];n[h++].i(u.x,u.y+s)}const a=i[i.length-1].x;for(;o<t.length&&t[o].x<=a;)o++;for(;o<t.length&&t[o].x>a;){const u=t[o++];n[h++].i(u.x,u.y)}const l=this.ae(h);for(o=0;o<h;o++)l[o].a(n[o]);return this._s(n),l}nE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,h=0;for(;o<t.length&&t[o].y<i[0].y;){const u=t[o++];n[h++].i(u.x,u.y)}for(;r<i.length;){const u=i[r++];n[h++].i(u.x+s,u.y)}const a=i[i.length-1].y;for(;o<t.length&&t[o].y<=a;)o++;for(;o<t.length&&t[o].y>a;){const u=t[o++];n[h++].i(u.x,u.y)}const l=this.ae(h);for(o=0;o<h;o++)l[o].a(n[o]);return this._s(n),l}oE(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const h=t[o],a=i[r],l=a.x;let u=a.y;u+=s;let c=h;o+1<t.length&&(c=t[o+1]);let d=a,f=d.x,m=d.y;r+1<i.length&&(d=i[r+1],f=d.x,m=d.y,m+=s);let p=n;h.x===l?p=u-h.y:h.x>l&&h.x<f?p=u+(h.x-l)/(f-l)*(m-u)-h.y:l>h.x&&l<c.x&&(p=u-(h.y+(l-h.x)/(c.x-h.x)*(c.y-h.y))),p<n&&(n=p),c.x<=h.x?o++:f<=l?r++:(c.x<=f&&o++,f<=c.x&&r++)}return n}eE(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const h=t[o],a=i[r];let l=a.x;const u=a.y;l+=s;let c=h;o+1<t.length&&(c=t[o+1]);let d=a,f=d.x,m=d.y;r+1<i.length&&(d=i[r+1],f=d.x,m=d.y,f+=s);let p=n;h.y===u?p=l-h.x:h.y>u&&h.y<m?p=l+(h.y-u)/(m-u)*(f-l)-h.x:u>h.y&&u<c.y&&(p=l-(h.x+(u-h.y)/(c.y-h.y)*(c.x-h.x))),p<n&&(n=p),c.y<=h.y?o++:m<=u?r++:(c.y<=m&&o++,m<=c.y&&r++)}return n}ae(t){const i=this.yk[t];if(i!==void 0){const n=i.pop();if(n!==void 0)return n}const s=[];for(let n=0;n<t;n++)s[n]=new S;return s}_s(t){if(!t)return;const i=t.length;let s=this.yk[i];s===void 0&&(s=[],this.yk[i]=s),s.push(t)}arrangeTrees(){if(this.Xi===52){const t=this.Fi.iterator;for(;t.next();){const i=t.value;if(!(i instanceof Me))continue;const s=i.node;if(s===null)continue;const n=s.position;let o=n.x,r=n.y;isFinite(o)||(o=0),isFinite(r)||(r=0),this.hC(i,o,r)}}else{const t=[],i=this.Fi.iterator;for(;i.next();){const r=i.value;r instanceof Me&&t.push(r)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const s=this.arrangementOrigin;let n=s.x,o=s.y;for(let r=0;r<t.length;r++){const h=t[r];switch(this.hC(h,n+h.lt.x,o+h.lt.y),this.Xi){case 50:o+=h.ut.height+this.Ms.height;break;default:case 51:n+=h.ut.width+this.Ms.width;break}}}}hC(t,i,s){if(t===null)return;t.x=i,t.y=s;const n=t.children,o=n.length;for(let r=0;r<o;r++){const h=n[r];this.hC(h,i+h.O.x,s+h.O.y)}}commitLayout(){this.Xy(),this.commitNodes(),this.iC(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const i=t.value;this.layoutComments(i)}}iC(){if(this.layerStyle!==62)return;const t=this.eC,i=[];let s=null;const n=this.network.vertexes.iterator;for(;n.next();){const l=n.value;s===null?s=l.bounds.copy():s.unionRect(l.bounds);let u=i[l.level];u===void 0?u=this.computeLayerSpacing(l):u=Math.max(u,this.computeLayerSpacing(l)),i[l.level]=u}for(let l=0;l<i.length;l++)i[l]===void 0&&(i[l]=0);let o;this.angle===90||this.angle===270?(s.inflate(this.nodeSpacing/2,this.layerSpacing),o=new S(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),o=new S(-this.layerSpacing/2,-this.nodeSpacing/2));const r=[],h=this.angle===90||this.angle===270?s.width:s.height;let a=0;if(this.angle===180||this.angle===270)for(let l=0;l<t.length;l++)a+=t[l]+i[l];for(let l=0;l<t.length;l++){const u=t[l]+i[l];this.angle===270?(a-=u,r.push(new z(0,a,h,u))):this.angle===90?(r.push(new z(0,a,h,u)),a+=u):this.angle===180?(a-=u,r.push(new z(a,0,u,h))):(r.push(new z(a,0,u,h)),a+=u)}this.commitLayers(r,o)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Xy(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof Me&&this.jD(i)}}jD(t){if(t===null)return;this.setPortSpots(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.jD(o)}}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.hE(t,i);else{const s=this.orthoAngle(t);if(this.ls===1){const n=t.destinationEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.fromSpot=B.MiddleRight;break;case 90:o.fromSpot=B.MiddleBottom;break;case 180:o.fromSpot=B.MiddleLeft;break;default:o.fromSpot=B.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.toSpot=B.MiddleLeft;break;case 90:o.toSpot=B.MiddleTop;break;case 180:o.toSpot=B.MiddleRight;break;default:o.toSpot=B.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const n=t.sourceEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.toSpot=B.MiddleRight;break;case 90:o.toSpot=B.MiddleBottom;break;case 180:o.toSpot=B.MiddleLeft;break;default:o.toSpot=B.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.fromSpot=B.MiddleLeft;break;case 90:o.fromSpot=B.MiddleTop;break;case 180:o.fromSpot=B.MiddleRight;break;default:o.fromSpot=B.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}hE(t,i){const s=this.ls===1,n=this.orthoAngle(t);let o;switch(n){case 0:o=B.MiddleRight;break;case 90:o=B.MiddleBottom;break;case 180:o=B.MiddleLeft;break;default:o=B.MiddleTop;break}const r=t.children,h=r.length;switch(i){case 24:case 25:{for(let a=0;a<h;a++){const l=r[a],u=(s?l.sourceEdges:l.destinationEdges).first();if(u===null)continue;const c=u.link;if(c!==null){let d=n===90||n===270?B.MiddleLeft:B.MiddleTop;if(h===1||a===h-1&&h%2===1)switch(n){case 0:d=B.MiddleLeft;break;case 90:d=B.MiddleTop;break;case 180:d=B.MiddleRight;break;default:d=B.MiddleBottom;break}else a%2===0&&(d=n===90||n===270?B.MiddleRight:B.MiddleBottom);s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=d)):(t.setsPortSpot&&(c.fromSpot=d),t.setsChildPortSpot&&(c.toSpot=o))}}break}case 26:{const a=n===90||n===270?B.MiddleRight:B.MiddleBottom,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const u=l.value.link;u!==null&&(s?(t.setsPortSpot&&(u.fromSpot=o),t.setsChildPortSpot&&(u.toSpot=a)):(t.setsPortSpot&&(u.fromSpot=a),t.setsChildPortSpot&&(u.toSpot=o)))}break}case 27:{const a=n===90||n===270?B.MiddleLeft:B.MiddleTop,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const u=l.value.link;u!==null&&(s?(t.setsPortSpot&&(u.fromSpot=o),t.setsChildPortSpot&&(u.toSpot=a)):(t.setsPortSpot&&(u.fromSpot=a),t.setsChildPortSpot&&(u.toSpot=o)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const o=Math.min(1,t.layerSpacingParentOverlap);n-=s?t.height*o:t.width*o}return n<(s?-t.height:-t.width)&&(n=s?-t.height:-t.width),n}computeNodeIndent(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.nodeIndent;if(t.nodeIndentPastParent>0){const o=Math.min(1,t.nodeIndentPastParent);n+=s?t.width*o:t.height*o}return n=Math.max(0,n),n}get roots(){return this.Fi}set roots(t){this.Fi!==t&&(this.Fi=t,this.invalidateLayout())}get path(){return this.Li}set path(t){this.Li!==t&&(this.Li=t,this.invalidateLayout())}get treeStyle(){return this._f}set treeStyle(t){this._f!==t&&(t===40||t===42||t===41||t===43)&&(this._f=t,this.invalidateLayout())}get layerStyle(){return this.Ng}set layerStyle(t){this.Ng!==t&&(t===60||t===61||t===62)&&(this.Ng=t,this.invalidateLayout())}get comments(){return this.Fe}set comments(t){this.Fe!==t&&(this.Fe=t,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===50||t===51||t===52)&&(this.Xi=t,this.invalidateLayout())}get arrangementSpacing(){return this.Ms}set arrangementSpacing(t){this.Ms.equals(t)||(this.Ms.a(t),this.invalidateLayout())}get rootDefaults(){return this.U}set rootDefaults(t){this.U!==t&&(this.U=t,this.invalidateLayout())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.invalidateLayout())}get sorting(){return this.U.sorting}set sorting(t){this.U.sorting!==t&&(this.U.sorting=t,this.invalidateLayout())}get comparer(){return this.U.comparer}set comparer(t){this.U.comparer!==t&&(this.U.comparer=t,this.invalidateLayout())}get angle(){return this.U.angle}set angle(t){this.U.angle!==t&&(t===0||t===90||t===180||t===270?(this.U.angle=t,this.invalidateLayout()):b.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.U.alignment}set alignment(t){this.U.alignment!==t&&(this.U.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.U.nodeIndent}set nodeIndent(t){this.U.nodeIndent!==t&&t>=0&&(this.U.nodeIndent=t,this.invalidateLayout())}get nodeIndentPastParent(){return this.U.nodeIndentPastParent}set nodeIndentPastParent(t){this.U.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.U.nodeIndentPastParent=t,this.invalidateLayout())}get nodeSpacing(){return this.U.nodeSpacing}set nodeSpacing(t){this.U.nodeSpacing!==t&&(this.U.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.U.layerSpacing}set layerSpacing(t){this.U.layerSpacing!==t&&(this.U.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.U.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.U.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.U.layerSpacingParentOverlap=t,this.invalidateLayout())}get compaction(){return this.U.compaction}set compaction(t){this.U.compaction!==t&&(t===30||t===31)&&(this.U.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.U.breadthLimit}set breadthLimit(t){this.U.breadthLimit!==t&&t>=0&&(this.U.breadthLimit=t,this.invalidateLayout())}get rowSpacing(){return this.U.rowSpacing}set rowSpacing(t){this.U.rowSpacing!==t&&(this.U.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.U.rowIndent}set rowIndent(t){this.U.rowIndent!==t&&t>=0&&(this.U.rowIndent=t,this.invalidateLayout())}get commentSpacing(){return this.U.commentSpacing}set commentSpacing(t){this.U.commentSpacing!==t&&(this.U.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.U.commentMargin}set commentMargin(t){this.U.commentMargin!==t&&(this.U.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.U.setsPortSpot}set setsPortSpot(t){this.U.setsPortSpot!==t&&(this.U.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.U.portSpot}set portSpot(t){this.U.portSpot.equals(t)||(this.U.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.U.setsChildPortSpot}set setsChildPortSpot(t){this.U.setsChildPortSpot!==t&&(this.U.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.U.childPortSpot}set childPortSpot(t){this.U.childPortSpot.equals(t)||(this.U.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(this.B.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(t===0||t===90||t===180||t===270)&&(this.B.angle=t,this.invalidateLayout())}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&t>=0&&(this.B.nodeIndent=t,this.invalidateLayout())}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.invalidateLayout())}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(this.B.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(this.B.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.invalidateLayout())}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(t===30||t===31)&&(this.B.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&t>=0&&(this.B.breadthLimit=t,this.invalidateLayout())}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(this.B.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&t>=0&&(this.B.rowIndent=t,this.invalidateLayout())}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(this.B.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(this.B.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(this.B.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(this.B.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.invalidateLayout())}}g(Vt,"PathDefault",0),g(Vt,"PathDestination",1),g(Vt,"PathSource",2),g(Vt,"SortingForwards",10),g(Vt,"SortingReverse",11),g(Vt,"SortingAscending",12),g(Vt,"SortingDescending",13),g(Vt,"AlignmentCenterSubtrees",20),g(Vt,"AlignmentCenterChildren",21),g(Vt,"AlignmentStart",22),g(Vt,"AlignmentEnd",23),g(Vt,"AlignmentBus",24),g(Vt,"AlignmentBusBranching",25),g(Vt,"AlignmentTopLeftBus",26),g(Vt,"AlignmentBottomRightBus",27),g(Vt,"CompactionNone",30),g(Vt,"CompactionBlock",31),g(Vt,"StyleLayered",40),g(Vt,"StyleLastParents",41),g(Vt,"StyleAlternating",42),g(Vt,"StyleRootOnly",43),g(Vt,"ArrangementVertical",50),g(Vt,"ArrangementHorizontal",51),g(Vt,"ArrangementFixedRoots",52),g(Vt,"LayerIndividual",60),g(Vt,"LayerSiblings",61),g(Vt,"LayerUniform",62);class Os extends $e{constructor(e){super(e)}createVertex(){return new Me(this)}createEdge(){return new wn(this)}}class Me extends Ze{constructor(t){super(t);g(this,"O");g(this,"ut");g(this,"lt");g(this,"kk");g(this,"Pk");g(this,"Sk");g(this,"Mk");g(this,"Nk");g(this,"Ck");g(this,"Lk");g(this,"Fe");g(this,"Cg");g(this,"Lg");g(this,"pe");g(this,"ye");g(this,"Yt");g(this,"hi");g(this,"Zy");g(this,"Qy");g(this,"_y");g(this,"Ns");g(this,"tw");g(this,"iw");g(this,"ew");g(this,"nw");g(this,"ow");g(this,"lw");g(this,"hw");g(this,"aw");g(this,"cw");g(this,"fw");g(this,"uw");this.kk=!1,this.Pk=null,this.Sk=[],this.Mk=0,this.Nk=0,this.Ck=0,this.Lk=0,this.Fe=null,this.O=new S(0,0),this.ut=new ot(0,0),this.lt=new S(0,0),this.Cg=null,this.Lg=null,this.pe=10,this.ye=Ze.standardComparer,this.Yt=0,this.hi=21,this.Zy=0,this.Qy=0,this._y=20,this.Ns=50,this.tw=0,this.iw=31,this.ew=0,this.nw=25,this.ow=10,this.lw=10,this.hw=20,this.aw=!0,this.cw=B.Default,this.fw=!0,this.uw=B.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.pe=t.sorting,this.ye=t.comparer,this.Yt=t.angle,this.hi=t.alignment,this.Zy=t.nodeIndent,this.Qy=t.nodeIndentPastParent,this._y=t.nodeSpacing,this.Ns=t.layerSpacing,this.tw=t.layerSpacingParentOverlap,this.iw=t.compaction,this.ew=t.breadthLimit,this.nw=t.rowSpacing,this.ow=t.rowIndent,this.lw=t.commentSpacing,this.hw=t.commentMargin,this.aw=t.setsPortSpot,this.cw=t.portSpot,this.fw=t.setsChildPortSpot,this.uw=t.childPortSpot)}get initialized(){return this.kk}set initialized(t){this.kk!==t&&(this.kk=t)}get parent(){return this.Pk}set parent(t){this.Pk!==t&&(this.Pk=t)}get children(){return this.Sk}set children(t){if(this.Sk!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Sk=t}}get level(){return this.Mk}set level(t){this.Mk!==t&&(this.Mk=t)}get descendantCount(){return this.Nk}set descendantCount(t){this.Nk!==t&&(this.Nk=t)}get maxChildrenCount(){return this.Ck}set maxChildrenCount(t){this.Ck!==t&&(this.Ck=t)}get maxGenerationCount(){return this.Lk}set maxGenerationCount(t){this.Lk!==t&&(this.Lk=t)}get comments(){return this.Fe}set comments(t){if(this.Fe!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Fe=t}}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t)}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t)}get angle(){return this.Yt}set angle(t){this.Yt!==t&&(this.Yt=t)}get alignment(){return this.hi}set alignment(t){this.hi!==t&&(this.hi=t)}get nodeIndent(){return this.Zy}set nodeIndent(t){this.Zy!==t&&(this.Zy=t)}get nodeIndentPastParent(){return this.Qy}set nodeIndentPastParent(t){this.Qy!==t&&(this.Qy=t)}get nodeSpacing(){return this._y}set nodeSpacing(t){this._y!==t&&(this._y=t)}get layerSpacing(){return this.Ns}set layerSpacing(t){this.Ns!==t&&(this.Ns=t)}get layerSpacingParentOverlap(){return this.tw}set layerSpacingParentOverlap(t){this.tw!==t&&(this.tw=t)}get compaction(){return this.iw}set compaction(t){this.iw!==t&&(this.iw=t)}get breadthLimit(){return this.ew}set breadthLimit(t){this.ew!==t&&(this.ew=t)}get rowSpacing(){return this.nw}set rowSpacing(t){this.nw!==t&&(this.nw=t)}get rowIndent(){return this.ow}set rowIndent(t){this.ow!==t&&(this.ow=t)}get commentSpacing(){return this.lw}set commentSpacing(t){this.lw!==t&&(this.lw=t)}get commentMargin(){return this.hw}set commentMargin(t){this.hw!==t&&(this.hw=t)}get setsPortSpot(){return this.aw}set setsPortSpot(t){this.aw!==t&&(this.aw=t)}get portSpot(){return this.cw}set portSpot(t){this.cw.equals(t)||(this.cw=t)}get setsChildPortSpot(){return this.fw}set setsChildPortSpot(t){this.fw!==t&&(this.fw=t)}get childPortSpot(){return this.uw}set childPortSpot(t){this.uw.equals(t)||(this.uw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.O}set relativePosition(t){this.O.set(t)}get subtreeSize(){return this.ut}set subtreeSize(t){this.ut.set(t)}get subtreeOffset(){return this.lt}set subtreeOffset(t){this.lt.set(t)}}class wn extends pi{constructor(t){super(t);g(this,"Ak");this.Ak=new S(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const i=this.network.layout;let s=null,n=null;switch(i.ls){case 1:s=this.fromVertex,n=this.toVertex;break;case 2:s=this.toVertex,n=this.fromVertex;break;default:b.o("Unhandled path value "+i.ls.toString())}if(s===null||n===null)return;const o=this.Ak;if(o.x===0&&o.y===0){this.aE(s,n);return}const r=s.bounds,h=i.orthoAngle(s),a=i.computeLayerSpacing(s),l=s.rowSpacing;t.updateRoute();const u=t.curve===9,c=t.isOrthogonal;let d=0,f,m;if(t.startRoute(),c||u){for(d=2;t.pointsCount>4;)t.removePoint(2);f=t.getPoint(1),m=t.getPoint(2)}else{for(d=1;t.pointsCount>3;)t.removePoint(1);f=t.getPoint(0),m=t.getPoint(t.pointsCount-1)}const p=t.getPoint(t.pointsCount-1);let y=0;h===0?(s.alignment===23?(y=r.bottom+o.y,o.y===0&&f.y>p.y+s.rowIndent&&(y=Math.min(y,Math.max(f.y,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.top+o.y,o.y===0&&f.y<p.y-s.rowIndent&&(y=Math.max(y,Math.min(f.y,y+i.computeNodeIndent(s))))):y=r.y+r.height/2+o.y,u?(t.insertPointAt(d,f.x,y),d++,t.insertPointAt(d,r.right+a,y),d++,t.insertPointAt(d,r.right+a+(o.x-l)/3,y),d++,t.insertPointAt(d,r.right+a+(o.x-l)*2/3,y),d++,t.insertPointAt(d,r.right+a+(o.x-l),y),d++,t.insertPointAt(d,m.x,y),d++):(c&&(t.insertPointAt(d,r.right+a/2,f.y),d++),t.insertPointAt(d,r.right+a/2,y),d++,t.insertPointAt(d,r.right+a+o.x-(c?l/2:l),y),d++,c&&(t.insertPointAt(d,t.getPoint(d-1).x,m.y),d++))):h===90?(s.alignment===23?(y=r.right+o.x,o.x===0&&f.x>p.x+s.rowIndent&&(y=Math.min(y,Math.max(f.x,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.left+o.x,o.x===0&&f.x<p.x-s.rowIndent&&(y=Math.max(y,Math.min(f.x,y+i.computeNodeIndent(s))))):y=r.x+r.width/2+o.x,u?(t.insertPointAt(d,y,f.y),d++,t.insertPointAt(d,y,r.bottom+a),d++,t.insertPointAt(d,y,r.bottom+a+(o.y-l)/3),d++,t.insertPointAt(d,y,r.bottom+a+(o.y-l)*2/3),d++,t.insertPointAt(d,y,r.bottom+a+(o.y-l)),d++,t.insertPointAt(d,y,m.y),d++):(c&&(t.insertPointAt(d,f.x,r.bottom+a/2),d++),t.insertPointAt(d,y,r.bottom+a/2),d++,t.insertPointAt(d,y,r.bottom+a+o.y-(c?l/2:l)),d++,c&&(t.insertPointAt(d,m.x,t.getPoint(d-1).y),d++))):h===180?(s.alignment===23?(y=r.bottom+o.y,o.y===0&&f.y>p.y+s.rowIndent&&(y=Math.min(y,Math.max(f.y,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.top+o.y,o.y===0&&f.y<p.y-s.rowIndent&&(y=Math.max(y,Math.min(f.y,y+i.computeNodeIndent(s))))):y=r.y+r.height/2+o.y,u?(t.insertPointAt(d,f.x,y),d++,t.insertPointAt(d,r.left-a,y),d++,t.insertPointAt(d,r.left-a+(o.x+l)/3,y),d++,t.insertPointAt(d,r.left-a+(o.x+l)*2/3,y),d++,t.insertPointAt(d,r.left-a+(o.x+l),y),d++,t.insertPointAt(d,m.x,y),d++):(c&&(t.insertPointAt(d,r.left-a/2,f.y),d++),t.insertPointAt(d,r.left-a/2,y),d++,t.insertPointAt(d,r.left-a+o.x+(c?l/2:l),y),d++,c&&(t.insertPointAt(d,t.getPoint(d-1).x,m.y),d++))):h===270?(s.alignment===23?(y=r.right+o.x,o.x===0&&f.x>p.x+s.rowIndent&&(y=Math.min(y,Math.max(f.x,y-i.computeNodeIndent(s))))):s.alignment===22?(y=r.left+o.x,o.x===0&&f.x<p.x-s.rowIndent&&(y=Math.max(y,Math.min(f.x,y+i.computeNodeIndent(s))))):y=r.x+r.width/2+o.x,u?(t.insertPointAt(d,y,f.y),d++,t.insertPointAt(d,y,r.top-a),d++,t.insertPointAt(d,y,r.top-a+(o.y+l)/3),d++,t.insertPointAt(d,y,r.top-a+(o.y+l)*2/3),d++,t.insertPointAt(d,y,r.top-a+(o.y+l)),d++,t.insertPointAt(d,y,m.y),d++):(c&&(t.insertPointAt(d,f.x,r.top-a/2),d++),t.insertPointAt(d,y,r.top-a/2),d++,t.insertPointAt(d,y,r.top-a+o.y+(c?l/2:l)),d++,c&&(t.insertPointAt(d,m.x,t.getPoint(d-1).y),d++))):b.o("Invalid angle "+h),t.commitRoute()}aE(t,i){const s=this.link;if(s===null)return;const n=this.network.layout,o=n.orthoAngle(t),r=n.orthoAngle(i);if(o===r)return;const h=n.computeLayerSpacing(t),a=t.bounds,l=i.bounds;if(o===0&&l.left-a.right<h+1||o===90&&l.top-a.bottom<h+1||o===180&&a.left-l.right<h+1||o===270&&a.top-l.bottom<h+1)return;s.updateRoute();const u=s.curve===9,c=s.isOrthogonal,d=this.fromVertex,f=n.isBusAlignment(d.alignment);if(s.startRoute(),o===0){const m=a.right+h/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).y;s.setPointAt(1,m-20,s.getPoint(1).y),s.insertPointAt(2,m-20,p),s.insertPointAt(3,m,p),s.insertPointAt(4,m+20,p),s.setPointAt(5,s.getPoint(5).x,p)}}else c?f?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,m,s.getPoint(2).y),s.setPointAt(3,m,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,m,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,m,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,m,s.getPoint(1).y)}else if(o===90){const m=a.bottom+h/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,m-20),s.insertPointAt(2,p,m-20),s.insertPointAt(3,p,m),s.insertPointAt(4,p,m+20),s.setPointAt(5,p,s.getPoint(5).y)}}else c?f?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,m),s.setPointAt(3,s.getPoint(3).x,m)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,m):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,m):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,m)}else if(o===180){const m=a.left-h/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).y;s.setPointAt(1,m+20,s.getPoint(1).y),s.insertPointAt(2,m+20,p),s.insertPointAt(3,m,p),s.insertPointAt(4,m-20,p),s.setPointAt(5,s.getPoint(5).x,p)}}else c?f?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,m,s.getPoint(2).y),s.setPointAt(3,m,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,m,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,m,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,m,s.getPoint(1).y)}else if(o===270){const m=a.top-h/2;if(u){if(s.pointsCount===4){const p=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,m+20),s.insertPointAt(2,p,m+20),s.insertPointAt(3,p,m),s.insertPointAt(4,p,m-20),s.setPointAt(5,p,s.getPoint(5).y)}}else c?f?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,m),s.setPointAt(3,s.getPoint(3).x,m)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,m):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,m):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,m)}s.commitRoute()}get fromVertex(){return this.He}set fromVertex(t){this.He!==t&&(this.He=t)}get toVertex(){return this.qe}set toVertex(t){this.qe!==t&&(this.qe=t)}get relativePoint(){return this.Ak}set relativePoint(t){this.Ak.set(t)}}class ke{constructor(){}}g(ke,"Light",{colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Ot(5)},arrowheads:{toArrow:"Standard"}}),g(ke,"Dark",{colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Ot(5)},arrowheads:{toArrow:"Standard"}});const vi=class vi{constructor(e){g(this,"ts",new Set);g(this,"iu",new bt);g(this,"Tk","light");g(this,"Dk","light");g(this,"Fk",!1);g(this,"Ag","light");g(this,"HD",e=>{const t=e.matches?"dark":"light";t!==this.Ag&&(this.Ag=t,this.Dk==="system"&&this.dw())});e&&Object.assign(this,e),e!=null&&e.themeMap||(this.iu.set("light",{colors:{...ke.Light.colors},fonts:{...ke.Light.fonts},numbers:{...ke.Light.numbers},margins:{...ke.Light.margins},arrowheads:{...ke.Light.arrowheads}}),this.iu.set("dark",{colors:{...ke.Dark.colors},fonts:{...ke.Dark.fonts},numbers:{...ke.Dark.numbers},margins:{...ke.Dark.margins},arrowheads:{...ke.Dark.arrowheads}})),_.matchMedia&&(this.Ag=_.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.iu}set themeMap(e){this.iu!==e&&(this.iu=e,this.dw())}get defaultTheme(){return this.Tk}set defaultTheme(e){this.Tk!==e&&(b.s(e,"string",vi,"defaultTheme"),this.Tk=e,this.dw())}get currentTheme(){return this.Dk}set currentTheme(e){this.Dk!==e&&(b.s(e,"string",vi,"currentTheme"),this.Dk=e,this.dw())}get changesDivBackground(){return this.Fk}set changesDivBackground(e){if(this.Fk!==e&&(this.Fk=e,e))for(const t of this.ts)t.setDivBackground(this.findValue("div","","fill")),t.D("ThemeChanged",this)}get preferredColorScheme(){return this.Ag}addDiagram(e){return this.ts.add(e),this.aC(e),this}removeDiagram(e){return this.ts.delete(e),this.aC(e),this}hR(){var e;this.ts.size===0&&_.matchMedia&&((e=_.matchMedia("(prefers-color-scheme: dark)"))==null||e.addEventListener("change",this.HD))}aR(){var e;this.ts.size===0&&_.matchMedia&&((e=_.matchMedia("(prefers-color-scheme: dark)"))==null||e.removeEventListener("change",this.HD))}set(e,t){e===""&&(e=this.Tk),e==="system"&&(e=this.Ag);let i=this.iu.get(e);return i?i=this.qD(i,t):i=t,this.iu.set(e,i),this.dw(),this}findValue(e,t,i){return this.getValue(this.findTheme(this.currentTheme),e,t,i)||this.getValue(this.findTheme(this.defaultTheme),e,t,i)}getValue(e,t,i,s){var h;if(!e)return;i==null&&(i="");let n=e;const o=a=>{if(n===void 0||a==="")return;if(typeof a=="number"||!(Array.isArray(a)||a.includes(".")))return n[a];const l=Array.isArray(a)?a:a.split(".");for(let u=0;u<l.length;u++){const c=l[u];if(c!==""&&(n=n[c],n===void 0))return}return n},r=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof t=="number"?n=n[t%n.length]:n=o(t),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let a=(h=e.targetPropertyMap)==null?void 0:h.get(s);if(a?n=e[a]:(a=vi.cE.get(s),n=a?e[a]:e.colors),n=r(),n!==void 0)return n}return n}findTheme(e){return this.themeMap.get(e==="system"?this.Ag:e)}aC(e){const t=e.skipsUndoManager;e.skipsUndoManager=!0,e.updateAllThemeBindings(),this.Fk&&e.setDivBackground(this.findValue("div","","fill")),e.skipsUndoManager=t,e.D("ThemeChanged",this)}dw(){for(const e of this.ts)this.aC(e)}qD(e,t){for(const i in t)if(b.gw(t,i))try{t[i].constructor===Object?e[i]=this.qD(e[i]??{},t[i]):e[i]=t[i]}catch{delete e[i]}return e}};g(vi,"cE",new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]]));let Li=vi;class bn{constructor(){g(this,"St");g(this,"N");g(this,"Oi");g(this,"cl");this.N=kt.um(),this.St="",this.Oi=!0,this.cl=!0}get name(){return this.St}set name(e){this.St=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isRealtime(){return this.cl}set isRealtime(e){this.cl=e}get diagram(){return this.N}set diagram(e){this.N!==e&&(this.N=e,e.bl=!0,e.requestUpdate())}invalidateRouter(){this.N!==null&&(this.N.bl=!0,this.N.requestUpdate())}canRoute(e){if(!this.isEnabled)return!1;const t=this.diagram;return!(t&&(!this.isRealtime&&t.gu||t.animationManager.isTicking))}routeLinks(e,t){}toString(){return this.name!==""?this.name+" Router":b.Dn(this.constructor)}}class Wn extends bn{constructor(e){super(),this.name="AvoidsNodes",e&&Object.assign(this,e)}canRoute(e){return(e instanceof kt?e.Vm:e.diagram.Vm)?super.canRoute(e):!1}routeLinks(e,t){const i=t instanceof kt?null:t,s=e.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const o=s.value;if(!o.isAvoiding||o.containingGroup!==i||o.toNode===null||o.fromNode===null||o.pointsCount<4)continue;o.startRoute();const r=o.pointsCount,h=o.getPoint(1),a=o.getPoint(r-2),l=o.fromNode.actualBounds.copy();l.inflate(at.Ua,at.Ua),l.unionPoint(o.getPoint(0));const u=o.toNode.actualBounds.copy();u.inflate(at.Ua,at.Ua),u.unionPoint(o.getPoint(r-1)),this.fE(o,l,u,n)&&this.uE(o,h,o.dN,a,o.gN,l,u,n),o.commitRoute()}}fE(e,t,i,s){const n=e.diagram,o=e.pointsCount;if(n===null||e.fromNode===e.toNode||e.layer.isTemporary||t.containsPoint(e.getPoint(o-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(e.segmentIndex===17)return!0;const r=e.getPoint(1),h=e.getPoint(o-2),a=e.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,a.x),Math.min(r.y,a.y),Math.abs(r.x-a.x),Math.abs(r.y-a.y)))return!0;for(let u=2;u<o-3;u++){const c=e.getPoint(u),d=e.getPoint(u+1);if(!s.isUnoccupied(Math.min(c.x,d.x),Math.min(c.y,d.y),Math.abs(c.x-d.x),Math.abs(c.y-d.y)))return!0}const l=e.getPoint(o-3);return!s.isUnoccupied(Math.min(l.x,h.x),Math.min(l.y,h.y),Math.abs(l.x-h.x),Math.abs(l.y-h.y))}uE(e,t,i,s,n,o,r,h){const a=e.diagram,l=t,u=s;let c=null,d=null;if(a.isVirtualized){const p=h.bounds.copy(),y=e.getPoint(2),x=e.getPoint(e.pointsCount-3);p.inflate(-h.cellWidth,-h.cellHeight);const P=S.l();h.vd(t.x,t.y)||(A.gl(p.x,p.y,p.x+p.width,p.y+p.height,t.x,t.y,y.x,y.y,P)?(c=t=P.copy(),i=P.directionPoint(y)):A.gl(p.x,p.y,p.x+p.width,p.y+p.height,y.x,y.y,x.x,x.y,P)?(c=t=P.copy(),i=P.directionPoint(x)):A.gl(p.x,p.y,p.x+p.width,p.y+p.height,x.x,x.y,s.x,s.y,P)&&(c=t=P.copy(),i=P.directionPoint(s))),h.vd(s.x,s.y)||(A.gl(p.x,p.y,p.x+p.width,p.y+p.height,s.x,s.y,x.x,x.y,P)?(d=s=P.copy(),n=x.directionPoint(P)):A.gl(p.x,p.y,p.x+p.width,p.y+p.height,x.x,x.y,y.x,y.y,P)?(d=s=P.copy(),n=y.directionPoint(P)):A.gl(p.x,p.y,p.x+p.width,p.y+p.height,y.x,y.y,t.x,t.y,P)&&(d=s=P.copy(),n=t.directionPoint(P))),S.e(P)}const f=o.copy().unionRect(r);f.inflate(h.cellWidth*h.Gc,h.cellHeight*h.Gc),h.NT(t,i,s,n,f,!0);let m=h.lo(s.x,s.y);if(!h.ky&&m>=Xe.Rd&&(h.rA(),f.inflate(h.cellWidth*h.HM,h.cellHeight*h.qM),h.NT(t,i,s,n,f,!1),m=h.lo(s.x,s.y)),!h.ky&&m<Xe.Rd&&!h.DO(s.x,s.y)){e.points.removeRange(2,e.pointsCount-3),this.cC(e,h,s.x,s.y,n,!0);const p=0,y=90,x=180,P=270,k=e.getPoint(2);if(e.pointsCount<4)i===p||i===x?(k.x=t.x,k.y=s.y):(k.x=s.x,k.y=t.y),e.setPointAt(2,k.x,k.y),e.insertPointAt(3,k.x,k.y);else{const v=e.getPoint(3);if(i===p||i===x)if(A.f(k.x,v.x)){const N=i===p?Math.max(k.x,t.x):Math.min(k.x,t.x);e.setPointAt(2,N,t.y),e.setPointAt(3,N,v.y)}else A.f(k.y,v.y)?(Math.abs(t.y-k.y)<=h.cellHeight/2&&(e.setPointAt(2,k.x,t.y),e.setPointAt(3,v.x,t.y)),e.insertPointAt(2,k.x,t.y)):e.setPointAt(2,t.x,k.y);else if(i===y||i===P)if(A.f(k.y,v.y)){const N=i===y?Math.max(k.y,t.y):Math.min(k.y,t.y);e.setPointAt(2,t.x,N),e.setPointAt(3,v.x,N)}else A.f(k.x,v.x)?(Math.abs(t.x-k.x)<=h.cellWidth/2&&(e.setPointAt(2,t.x,k.y),e.setPointAt(3,t.x,v.y)),e.insertPointAt(2,t.x,k.y)):e.setPointAt(2,k.x,t.y)}if(c!==null){const v=e.getPoint(1),N=e.getPoint(2);v.x!==N.x&&v.y!==N.y?i===p||i===x?e.insertPointAt(2,v.x,N.y):e.insertPointAt(2,N.x,v.y):i===p||i===x?e.insertPointAt(2,l.x,c.y):e.insertPointAt(2,c.x,l.y)}d!==null&&(n===p||n===x?e.insertPointAt(e.pointsCount-2,u.x,d.y):e.insertPointAt(e.pointsCount-2,d.x,u.y))}}cC(e,t,i,s,n,o){const r=t.cellWidth,h=t.cellHeight;let a=t.lo(i,s),l=i,u=s,c=l,d=u;for(n===0?c+=r:n===90?d+=h:n===180?c-=r:d-=h,e.yN&&a>Xe.Xa&&t.lo(c,d)!==a-1&&(t.lo(l-r,u)===a-1?(n=180,c=l-r,d=u):t.lo(l+r,u)===a-1?(n=0,c=l+r,d=u):t.lo(l,u-h)===a-1?(n=270,c=l,d=u-h):t.lo(l,u+h)===a-1&&(n=90,c=l,d=u+h));a>Xe.Xa&&t.lo(c,d)===a-1;)l=c,u=d,n===0?c+=r:n===90?d+=h:n===180?c-=r:d-=h,a-=1;if(o?a>Xe.Xa&&(n===180||n===0?l=Math.floor(l/r)*r+r/2:(n===90||n===270)&&(u=Math.floor(u/h)*h+h/2)):(l=Math.floor(l/r)*r+r/2,u=Math.floor(u/h)*h+h/2),a>Xe.Xa){let f=n,m=l,p=u;if(n===0?(f=90,p+=h):n===90?(f=180,m-=r):n===180?(f=270,p-=h):n===270&&(f=0,m+=r),t.lo(m,p)===a-1)this.cC(e,t,m,p,f,!1);else{let y=l,x=u;n===0?(f=270,x-=h):n===90?(f=0,y+=r):n===180?(f=90,x+=h):n===270&&(f=180,y-=r),t.lo(y,x)===a-1&&this.cC(e,t,y,x,f,!1)}}e.insertPointAt(e.pointsCount-2,l,u)}}Se.prototype.initializeStandardTools=function(){this.Jt("Action",new js,this.mouseDownTools),this.Jt("Relinking",new _i,this.mouseDownTools),this.Jt("LinkReshaping",new ci,this.mouseDownTools),this.Jt("Rotating",new Xs,this.mouseDownTools),this.Jt("Resizing",new zs,this.mouseDownTools),this.Jt("Linking",new Bi,this.mouseMoveTools),this.Jt("Dragging",new Ue,this.mouseMoveTools),this.Jt("DragSelecting",new Ys,this.mouseMoveTools),this.Jt("Panning",new Gs,this.mouseMoveTools),this.Jt("ContextMenu",new Ii,this.mouseUpTools),this.Jt("TextEditing",new Vi,this.mouseUpTools),this.Jt("ClickCreating",new Ei,this.mouseUpTools),this.Jt("ClickSelecting",new Ks,this.mouseUpTools)},kt.CM("GraphLinksModel",Un),kt.CM("TreeModel",qn);const Ui=_.go,Ai={get version(){return kt.version},Group:ut,List:J,Set:K,Map:bt,Point:S,Size:ot,Rect:z,Margin:Ot,Spot:B,Geometry:Mt,PathFigure:qt,PathSegment:pt,InputEvent:Ge,DiagramEvent:Oi,ChangedEvent:si,Model:It,GraphLinksModel:xi,TreeModel:wi,Binding:Ke,ThemeBinding:yi,Transaction:Pi,UndoManager:Ri,CommandHandler:we,Tool:ce,DraggingTool:Ue,DraggingInfo:ni,DraggingOptions:zi,LinkingBaseTool:Qi,LinkingTool:Bi,RelinkingTool:_i,LinkReshapingTool:ci,ResizingTool:zs,RotatingTool:Xs,ClickSelectingTool:Ks,ActionTool:js,ClickCreatingTool:Ei,HTMLInfo:qe,ContextMenuTool:Ii,DragSelectingTool:Ys,PanningTool:Gs,TextEditingTool:Vi,ToolManager:Se,Animation:di,AnimationManager:Ie,AnimationTrigger:Si,Layer:de,Diagram:kt,Palette:Tn,Overview:Xi,Brush:Ft,GraphObject:Ct,Panel:rt,RowColumnDefinition:ee,Shape:dt,TextBlock:Kt,Picture:be,Part:Lt,Adornment:yt,Node:st,Link:at,Placeholder:ve,Layout:ne,LayoutNetwork:$e,LayoutVertex:Ze,LayoutEdge:pi,GridLayout:Yi,PanelLayout:Nt,CircularLayout:le,CircularNetwork:hn,CircularVertex:an,CircularEdge:ln,ForceDirectedLayout:Hn,ForceDirectedNetwork:un,ForceDirectedVertex:cn,ForceDirectedEdge:dn,LayeredDigraphLayout:Ht,LayeredDigraphNetwork:pn,LayeredDigraphVertex:Ti,LayeredDigraphEdge:yn,TreeLayout:Vt,TreeNetwork:Os,TreeVertex:Me,TreeEdge:wn,Themes:ke,ThemeManager:Li,Router:bn,AnimationStyle:Ws,AutoScale:ts,CycleMode:$s,Flip:_s,TextFormat:hs,ImageStretch:ls,LayoutConditions:nn,LinkAdjusting:ds,Curve:fs,Routing:gs,Orientation:is,TextOverflow:sn,PortSpreading:on,ScrollMode:Zs,CollapsePolicy:Qs,Sizing:ns,TriggerStart:Js,Stretch:es,ViewboxStretch:en,Wrap:rs,BrushType:We,ColorSpace:tn,GeometryStretch:$i,GeometryType:ii,SegmentType:ki,BindingMode:Gi,ChangeType:Zi,CircularArrangement:ws,CircularDirection:bs,CircularNodeDiameterFormula:ks,CircularSorting:vs,GridAlignment:ps,GridArrangement:ys,GridSorting:xs,LayeredDigraphAggressive:Ns,LayeredDigraphAlign:mn,LayeredDigraphCycleRemove:Ps,LayeredDigraphInit:Ms,LayeredDigraphLayering:Ss,LayeredDigraphPack:fn,TreeAlignment:Ls,TreeArrangement:Fs,TreeCompaction:As,TreeLayerStyle:xn,TreePath:Cs,TreeSorting:Ts,TreeStyle:Ds,GestureMode:Es,LinkingDirection:Is,ReshapingBehavior:Vs,TextEditingAccept:Us,TextEditingStarting:qs,TextEditingState:Hs,WheelMode:Bs};for(const w in Ai){const e=Ai[w];b.it(e)&&e!==hs&&(e.className=w)}b.G(Ui)&&Ui.version&&b.ni("WARNING: a `go` object on the root object is already defined.  "+("Debug"in Ui?"debug ":"")+"version: "+Ui.version+", replaced with version: "+Ai.version),kt.prototype.go=Ai,_.go=Ai})();const q=typeof global<"u"?global.go:self.go;q.Group;q.List;q.Set;q.Map;const Qn=q.Point,_n=q.Size;q.Rect;q.Margin;const to=q.Spot;q.Geometry;q.PathFigure;q.PathSegment;q.InputEvent;q.DiagramEvent;q.ChangedEvent;q.Model;const eo=q.GraphLinksModel;q.TreeModel;const io=q.Binding;q.ThemeBinding;q.Transaction;q.UndoManager;q.CommandHandler;const so=q.Tool;q.DraggingTool;q.DraggingInfo;q.DraggingOptions;q.LinkingBaseTool;q.LinkingTool;q.RelinkingTool;q.LinkReshapingTool;q.ResizingTool;q.RotatingTool;q.ClickSelectingTool;q.ActionTool;q.ClickCreatingTool;q.HTMLInfo;q.ContextMenuTool;q.DragSelectingTool;q.PanningTool;q.TextEditingTool;const no=q.ToolManager;q.Animation;q.AnimationManager;q.AnimationTrigger;q.Layer;const oo=q.Diagram;q.Palette;q.Overview;q.Brush;const ro=q.GraphObject,ho=q.Panel;q.RowColumnDefinition;const ao=q.Shape,lo=q.TextBlock;q.Picture;q.Part;q.Adornment;const uo=q.Node,co=q.Link;q.Placeholder;const go=q.Layout;q.LayoutNetwork;q.LayoutVertex;q.LayoutEdge;q.GridLayout;q.PanelLayout;q.CircularLayout;q.CircularNetwork;q.CircularVertex;q.CircularEdge;q.ForceDirectedLayout;q.ForceDirectedNetwork;q.ForceDirectedVertex;q.ForceDirectedEdge;q.LayeredDigraphLayout;q.LayeredDigraphNetwork;q.LayeredDigraphVertex;q.LayeredDigraphEdge;const fo=q.TreeLayout;q.TreeNetwork;q.TreeVertex;q.TreeEdge;q.Themes;q.ThemeManager;q.Router;q.version;q.AnimationStyle;q.AutoScale;q.Curve;q.CycleMode;q.Flip;q.ImageStretch;q.LayoutConditions;q.LinkAdjusting;q.Orientation;q.PortSpreading;q.Routing;q.ScrollMode;q.CollapsePolicy;q.Sizing;q.TriggerStart;q.Stretch;q.TextFormat;q.TextOverflow;q.ViewboxStretch;q.Wrap;q.BrushType;q.ColorSpace;q.GeometryStretch;q.GeometryType;q.SegmentType;q.BindingMode;q.ChangeType;q.CircularArrangement;q.CircularDirection;q.CircularNodeDiameterFormula;q.CircularSorting;q.GridAlignment;q.GridArrangement;q.GridSorting;q.LayeredDigraphAggressive;q.LayeredDigraphAlign;q.LayeredDigraphCycleRemove;q.LayeredDigraphInit;q.LayeredDigraphLayering;q.LayeredDigraphPack;q.TreeAlignment;q.TreeArrangement;q.TreeCompaction;q.TreeLayerStyle;q.TreePath;q.TreeSorting;q.TreeStyle;q.GestureMode;q.LinkingDirection;q.ReshapingBehavior;q.TextEditingAccept;q.TextEditingStarting;q.TextEditingState;q.WheelMode;export{io as B,oo as D,ro as G,co as L,uo as N,ho as P,ao as S,fo as T,lo as a,eo as b,_n as c,no as d,to as e,go as f,Qn as g,so as h};
