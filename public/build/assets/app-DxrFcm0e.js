var ku=Object.defineProperty;var Pu=(w,u,v)=>u in w?ku(w,u,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[u]=v;var g=(w,u,v)=>Pu(w,typeof u!="symbol"?u+"":u,v);var He="top",ri="bottom",ai="right",qe="left",fo="auto",_s=[He,ri,ai,qe],bs="start",Ys="end",Lh="clippingParents",Br="viewport",zs="popper",Dh="reference",Mr=_s.reduce(function(w,u){return w.concat([u+"-"+bs,u+"-"+Ys])},[]),Vr=[].concat(_s,[fo]).reduce(function(w,u){return w.concat([u,u+"-"+bs,u+"-"+Ys])},[]),Eh="beforeRead",Oh="read",Rh="afterRead",Fh="beforeMain",Ih="main",Bh="afterMain",Vh="beforeWrite",zh="write",jh="afterWrite",Kh=[Eh,Oh,Rh,Fh,Ih,Bh,Vh,zh,jh];function Ri(w){return w?(w.nodeName||"").toLowerCase():null}function hi(w){if(w==null)return window;if(w.toString()!=="[object Window]"){var u=w.ownerDocument;return u&&u.defaultView||window}return w}function vs(w){var u=hi(w).Element;return w instanceof u||w instanceof Element}function gi(w){var u=hi(w).HTMLElement;return w instanceof u||w instanceof HTMLElement}function zr(w){if(typeof ShadowRoot>"u")return!1;var u=hi(w).ShadowRoot;return w instanceof u||w instanceof ShadowRoot}function Mu(w){var u=w.state;Object.keys(u.elements).forEach(function(v){var N=u.styles[v]||{},A=u.attributes[v]||{},z=u.elements[v];!gi(z)||!Ri(z)||(Object.assign(z.style,N),Object.keys(A).forEach(function(j){var q=A[j];q===!1?z.removeAttribute(j):z.setAttribute(j,q===!0?"":q)}))})}function Nu(w){var u=w.state,v={popper:{position:u.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(u.elements.popper.style,v.popper),u.styles=v,u.elements.arrow&&Object.assign(u.elements.arrow.style,v.arrow),function(){Object.keys(u.elements).forEach(function(N){var A=u.elements[N],z=u.attributes[N]||{},j=Object.keys(u.styles.hasOwnProperty(N)?u.styles[N]:v[N]),q=j.reduce(function(Y,Q){return Y[Q]="",Y},{});!gi(A)||!Ri(A)||(Object.assign(A.style,q),Object.keys(z).forEach(function(Y){A.removeAttribute(Y)}))})}}const jr={name:"applyStyles",enabled:!0,phase:"write",fn:Mu,effect:Nu,requires:["computeStyles"]};function Ei(w){return w.split("-")[0]}var xs=Math.max,ao=Math.min,Xs=Math.round;function Nr(){var w=navigator.userAgentData;return w!=null&&w.brands&&Array.isArray(w.brands)?w.brands.map(function(u){return u.brand+"/"+u.version}).join(" "):navigator.userAgent}function Uh(){return!/^((?!chrome|android).)*safari/i.test(Nr())}function Gs(w,u,v){u===void 0&&(u=!1),v===void 0&&(v=!1);var N=w.getBoundingClientRect(),A=1,z=1;u&&gi(w)&&(A=w.offsetWidth>0&&Xs(N.width)/w.offsetWidth||1,z=w.offsetHeight>0&&Xs(N.height)/w.offsetHeight||1);var j=vs(w)?hi(w):window,q=j.visualViewport,Y=!Uh()&&v,Q=(N.left+(Y&&q?q.offsetLeft:0))/A,I=(N.top+(Y&&q?q.offsetTop:0))/z,pt=N.width/A,Lt=N.height/z;return{width:pt,height:Lt,top:I,right:Q+pt,bottom:I+Lt,left:Q,x:Q,y:I}}function Kr(w){var u=Gs(w),v=w.offsetWidth,N=w.offsetHeight;return Math.abs(u.width-v)<=1&&(v=u.width),Math.abs(u.height-N)<=1&&(N=u.height),{x:w.offsetLeft,y:w.offsetTop,width:v,height:N}}function Yh(w,u){var v=u.getRootNode&&u.getRootNode();if(w.contains(u))return!0;if(v&&zr(v)){var N=u;do{if(N&&w.isSameNode(N))return!0;N=N.parentNode||N.host}while(N)}return!1}function Yi(w){return hi(w).getComputedStyle(w)}function Cu(w){return["table","td","th"].indexOf(Ri(w))>=0}function os(w){return((vs(w)?w.ownerDocument:w.document)||window.document).documentElement}function go(w){return Ri(w)==="html"?w:w.assignedSlot||w.parentNode||(zr(w)?w.host:null)||os(w)}function La(w){return!gi(w)||Yi(w).position==="fixed"?null:w.offsetParent}function Tu(w){var u=/firefox/i.test(Nr()),v=/Trident/i.test(Nr());if(v&&gi(w)){var N=Yi(w);if(N.position==="fixed")return null}var A=go(w);for(zr(A)&&(A=A.host);gi(A)&&["html","body"].indexOf(Ri(A))<0;){var z=Yi(A);if(z.transform!=="none"||z.perspective!=="none"||z.contain==="paint"||["transform","perspective"].indexOf(z.willChange)!==-1||u&&z.willChange==="filter"||u&&z.filter&&z.filter!=="none")return A;A=A.parentNode}return null}function Mn(w){for(var u=hi(w),v=La(w);v&&Cu(v)&&Yi(v).position==="static";)v=La(v);return v&&(Ri(v)==="html"||Ri(v)==="body"&&Yi(v).position==="static")?u:v||Tu(w)||u}function Ur(w){return["top","bottom"].indexOf(w)>=0?"x":"y"}function Sn(w,u,v){return xs(w,ao(u,v))}function Au(w,u,v){var N=Sn(w,u,v);return N>v?v:N}function Xh(){return{top:0,right:0,bottom:0,left:0}}function Gh(w){return Object.assign({},Xh(),w)}function Hh(w,u){return u.reduce(function(v,N){return v[N]=w,v},{})}var Lu=function(u,v){return u=typeof u=="function"?u(Object.assign({},v.rects,{placement:v.placement})):u,Gh(typeof u!="number"?u:Hh(u,_s))};function Du(w){var u,v=w.state,N=w.name,A=w.options,z=v.elements.arrow,j=v.modifiersData.popperOffsets,q=Ei(v.placement),Y=Ur(q),Q=[qe,ai].indexOf(q)>=0,I=Q?"height":"width";if(!(!z||!j)){var pt=Lu(A.padding,v),Lt=Kr(z),Rt=Y==="y"?He:qe,at=Y==="y"?ri:ai,xt=v.rects.reference[I]+v.rects.reference[Y]-j[Y]-v.rects.popper[I],Z=j[Y]-v.rects.reference[Y],C=Mn(z),rt=C?Y==="y"?C.clientHeight||0:C.clientWidth||0:0,G=xt/2-Z/2,wt=pt[Rt],U=rt-Lt[I]-pt[at],Pt=rt/2-Lt[I]/2+G,O=Sn(wt,Pt,U),ee=Y;v.modifiersData[N]=(u={},u[ee]=O,u.centerOffset=O-Pt,u)}}function Eu(w){var u=w.state,v=w.options,N=v.element,A=N===void 0?"[data-popper-arrow]":N;A!=null&&(typeof A=="string"&&(A=u.elements.popper.querySelector(A),!A)||Yh(u.elements.popper,A)&&(u.elements.arrow=A))}const qh={name:"arrow",enabled:!0,phase:"main",fn:Du,effect:Eu,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Hs(w){return w.split("-")[1]}var Ou={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ru(w,u){var v=w.x,N=w.y,A=u.devicePixelRatio||1;return{x:Xs(v*A)/A||0,y:Xs(N*A)/A||0}}function Da(w){var u,v=w.popper,N=w.popperRect,A=w.placement,z=w.variation,j=w.offsets,q=w.position,Y=w.gpuAcceleration,Q=w.adaptive,I=w.roundOffsets,pt=w.isFixed,Lt=j.x,Rt=Lt===void 0?0:Lt,at=j.y,xt=at===void 0?0:at,Z=typeof I=="function"?I({x:Rt,y:xt}):{x:Rt,y:xt};Rt=Z.x,xt=Z.y;var C=j.hasOwnProperty("x"),rt=j.hasOwnProperty("y"),G=qe,wt=He,U=window;if(Q){var Pt=Mn(v),O="clientHeight",ee="clientWidth";if(Pt===hi(v)&&(Pt=os(v),Yi(Pt).position!=="static"&&q==="absolute"&&(O="scrollHeight",ee="scrollWidth")),Pt=Pt,A===He||(A===qe||A===ai)&&z===Ys){wt=ri;var re=pt&&Pt===U&&U.visualViewport?U.visualViewport.height:Pt[O];xt-=re-N.height,xt*=Y?1:-1}if(A===qe||(A===He||A===ri)&&z===Ys){G=ai;var Tt=pt&&Pt===U&&U.visualViewport?U.visualViewport.width:Pt[ee];Rt-=Tt-N.width,Rt*=Y?1:-1}}var Gt=Object.assign({position:q},Q&&Ou),we=I===!0?Ru({x:Rt,y:xt},hi(v)):{x:Rt,y:xt};if(Rt=we.x,xt=we.y,Y){var Mt;return Object.assign({},Gt,(Mt={},Mt[wt]=rt?"0":"",Mt[G]=C?"0":"",Mt.transform=(U.devicePixelRatio||1)<=1?"translate("+Rt+"px, "+xt+"px)":"translate3d("+Rt+"px, "+xt+"px, 0)",Mt))}return Object.assign({},Gt,(u={},u[wt]=rt?xt+"px":"",u[G]=C?Rt+"px":"",u.transform="",u))}function Fu(w){var u=w.state,v=w.options,N=v.gpuAcceleration,A=N===void 0?!0:N,z=v.adaptive,j=z===void 0?!0:z,q=v.roundOffsets,Y=q===void 0?!0:q,Q={placement:Ei(u.placement),variation:Hs(u.placement),popper:u.elements.popper,popperRect:u.rects.popper,gpuAcceleration:A,isFixed:u.options.strategy==="fixed"};u.modifiersData.popperOffsets!=null&&(u.styles.popper=Object.assign({},u.styles.popper,Da(Object.assign({},Q,{offsets:u.modifiersData.popperOffsets,position:u.options.strategy,adaptive:j,roundOffsets:Y})))),u.modifiersData.arrow!=null&&(u.styles.arrow=Object.assign({},u.styles.arrow,Da(Object.assign({},Q,{offsets:u.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Y})))),u.attributes.popper=Object.assign({},u.attributes.popper,{"data-popper-placement":u.placement})}const Yr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Fu,data:{}};var qn={passive:!0};function Iu(w){var u=w.state,v=w.instance,N=w.options,A=N.scroll,z=A===void 0?!0:A,j=N.resize,q=j===void 0?!0:j,Y=hi(u.elements.popper),Q=[].concat(u.scrollParents.reference,u.scrollParents.popper);return z&&Q.forEach(function(I){I.addEventListener("scroll",v.update,qn)}),q&&Y.addEventListener("resize",v.update,qn),function(){z&&Q.forEach(function(I){I.removeEventListener("scroll",v.update,qn)}),q&&Y.removeEventListener("resize",v.update,qn)}}const Xr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Iu,data:{}};var Bu={left:"right",right:"left",bottom:"top",top:"bottom"};function eo(w){return w.replace(/left|right|bottom|top/g,function(u){return Bu[u]})}var Vu={start:"end",end:"start"};function Ea(w){return w.replace(/start|end/g,function(u){return Vu[u]})}function Gr(w){var u=hi(w),v=u.pageXOffset,N=u.pageYOffset;return{scrollLeft:v,scrollTop:N}}function Hr(w){return Gs(os(w)).left+Gr(w).scrollLeft}function zu(w,u){var v=hi(w),N=os(w),A=v.visualViewport,z=N.clientWidth,j=N.clientHeight,q=0,Y=0;if(A){z=A.width,j=A.height;var Q=Uh();(Q||!Q&&u==="fixed")&&(q=A.offsetLeft,Y=A.offsetTop)}return{width:z,height:j,x:q+Hr(w),y:Y}}function ju(w){var u,v=os(w),N=Gr(w),A=(u=w.ownerDocument)==null?void 0:u.body,z=xs(v.scrollWidth,v.clientWidth,A?A.scrollWidth:0,A?A.clientWidth:0),j=xs(v.scrollHeight,v.clientHeight,A?A.scrollHeight:0,A?A.clientHeight:0),q=-N.scrollLeft+Hr(w),Y=-N.scrollTop;return Yi(A||v).direction==="rtl"&&(q+=xs(v.clientWidth,A?A.clientWidth:0)-z),{width:z,height:j,x:q,y:Y}}function qr(w){var u=Yi(w),v=u.overflow,N=u.overflowX,A=u.overflowY;return/auto|scroll|overlay|hidden/.test(v+A+N)}function $h(w){return["html","body","#document"].indexOf(Ri(w))>=0?w.ownerDocument.body:gi(w)&&qr(w)?w:$h(go(w))}function kn(w,u){var v;u===void 0&&(u=[]);var N=$h(w),A=N===((v=w.ownerDocument)==null?void 0:v.body),z=hi(N),j=A?[z].concat(z.visualViewport||[],qr(N)?N:[]):N,q=u.concat(j);return A?q:q.concat(kn(go(j)))}function Cr(w){return Object.assign({},w,{left:w.x,top:w.y,right:w.x+w.width,bottom:w.y+w.height})}function Ku(w,u){var v=Gs(w,!1,u==="fixed");return v.top=v.top+w.clientTop,v.left=v.left+w.clientLeft,v.bottom=v.top+w.clientHeight,v.right=v.left+w.clientWidth,v.width=w.clientWidth,v.height=w.clientHeight,v.x=v.left,v.y=v.top,v}function Oa(w,u,v){return u===Br?Cr(zu(w,v)):vs(u)?Ku(u,v):Cr(ju(os(w)))}function Uu(w){var u=kn(go(w)),v=["absolute","fixed"].indexOf(Yi(w).position)>=0,N=v&&gi(w)?Mn(w):w;return vs(N)?u.filter(function(A){return vs(A)&&Yh(A,N)&&Ri(A)!=="body"}):[]}function Yu(w,u,v,N){var A=u==="clippingParents"?Uu(w):[].concat(u),z=[].concat(A,[v]),j=z[0],q=z.reduce(function(Y,Q){var I=Oa(w,Q,N);return Y.top=xs(I.top,Y.top),Y.right=ao(I.right,Y.right),Y.bottom=ao(I.bottom,Y.bottom),Y.left=xs(I.left,Y.left),Y},Oa(w,j,N));return q.width=q.right-q.left,q.height=q.bottom-q.top,q.x=q.left,q.y=q.top,q}function Wh(w){var u=w.reference,v=w.element,N=w.placement,A=N?Ei(N):null,z=N?Hs(N):null,j=u.x+u.width/2-v.width/2,q=u.y+u.height/2-v.height/2,Y;switch(A){case He:Y={x:j,y:u.y-v.height};break;case ri:Y={x:j,y:u.y+u.height};break;case ai:Y={x:u.x+u.width,y:q};break;case qe:Y={x:u.x-v.width,y:q};break;default:Y={x:u.x,y:u.y}}var Q=A?Ur(A):null;if(Q!=null){var I=Q==="y"?"height":"width";switch(z){case bs:Y[Q]=Y[Q]-(u[I]/2-v[I]/2);break;case Ys:Y[Q]=Y[Q]+(u[I]/2-v[I]/2);break}}return Y}function qs(w,u){u===void 0&&(u={});var v=u,N=v.placement,A=N===void 0?w.placement:N,z=v.strategy,j=z===void 0?w.strategy:z,q=v.boundary,Y=q===void 0?Lh:q,Q=v.rootBoundary,I=Q===void 0?Br:Q,pt=v.elementContext,Lt=pt===void 0?zs:pt,Rt=v.altBoundary,at=Rt===void 0?!1:Rt,xt=v.padding,Z=xt===void 0?0:xt,C=Gh(typeof Z!="number"?Z:Hh(Z,_s)),rt=Lt===zs?Dh:zs,G=w.rects.popper,wt=w.elements[at?rt:Lt],U=Yu(vs(wt)?wt:wt.contextElement||os(w.elements.popper),Y,I,j),Pt=Gs(w.elements.reference),O=Wh({reference:Pt,element:G,strategy:"absolute",placement:A}),ee=Cr(Object.assign({},G,O)),re=Lt===zs?ee:Pt,Tt={top:U.top-re.top+C.top,bottom:re.bottom-U.bottom+C.bottom,left:U.left-re.left+C.left,right:re.right-U.right+C.right},Gt=w.modifiersData.offset;if(Lt===zs&&Gt){var we=Gt[A];Object.keys(Tt).forEach(function(Mt){var de=[ai,ri].indexOf(Mt)>=0?1:-1,Ve=[He,ri].indexOf(Mt)>=0?"y":"x";Tt[Mt]+=we[Ve]*de})}return Tt}function Xu(w,u){u===void 0&&(u={});var v=u,N=v.placement,A=v.boundary,z=v.rootBoundary,j=v.padding,q=v.flipVariations,Y=v.allowedAutoPlacements,Q=Y===void 0?Vr:Y,I=Hs(N),pt=I?q?Mr:Mr.filter(function(at){return Hs(at)===I}):_s,Lt=pt.filter(function(at){return Q.indexOf(at)>=0});Lt.length===0&&(Lt=pt);var Rt=Lt.reduce(function(at,xt){return at[xt]=qs(w,{placement:xt,boundary:A,rootBoundary:z,padding:j})[Ei(xt)],at},{});return Object.keys(Rt).sort(function(at,xt){return Rt[at]-Rt[xt]})}function Gu(w){if(Ei(w)===fo)return[];var u=eo(w);return[Ea(w),u,Ea(u)]}function Hu(w){var u=w.state,v=w.options,N=w.name;if(!u.modifiersData[N]._skip){for(var A=v.mainAxis,z=A===void 0?!0:A,j=v.altAxis,q=j===void 0?!0:j,Y=v.fallbackPlacements,Q=v.padding,I=v.boundary,pt=v.rootBoundary,Lt=v.altBoundary,Rt=v.flipVariations,at=Rt===void 0?!0:Rt,xt=v.allowedAutoPlacements,Z=u.options.placement,C=Ei(Z),rt=C===Z,G=Y||(rt||!at?[eo(Z)]:Gu(Z)),wt=[Z].concat(G).reduce(function(Ne,Ue){return Ne.concat(Ei(Ue)===fo?Xu(u,{placement:Ue,boundary:I,rootBoundary:pt,padding:Q,flipVariations:at,allowedAutoPlacements:xt}):Ue)},[]),U=u.rects.reference,Pt=u.rects.popper,O=new Map,ee=!0,re=wt[0],Tt=0;Tt<wt.length;Tt++){var Gt=wt[Tt],we=Ei(Gt),Mt=Hs(Gt)===bs,de=[He,ri].indexOf(we)>=0,Ve=de?"width":"height",ie=qs(u,{placement:Gt,boundary:I,rootBoundary:pt,altBoundary:Lt,padding:Q}),be=de?Mt?ai:qe:Mt?ri:He;U[Ve]>Pt[Ve]&&(be=eo(be));var Te=eo(be),ze=[];if(z&&ze.push(ie[we]<=0),q&&ze.push(ie[be]<=0,ie[Te]<=0),ze.every(function(Ne){return Ne})){re=Gt,ee=!1;break}O.set(Gt,ze)}if(ee)for(var ve=at?3:1,je=function(Ue){var Gi=wt.find(function(Fi){var xi=O.get(Fi);if(xi)return xi.slice(0,Ue).every(function(Ms){return Ms})});if(Gi)return re=Gi,"break"},Ke=ve;Ke>0;Ke--){var Pe=je(Ke);if(Pe==="break")break}u.placement!==re&&(u.modifiersData[N]._skip=!0,u.placement=re,u.reset=!0)}}const Jh={name:"flip",enabled:!0,phase:"main",fn:Hu,requiresIfExists:["offset"],data:{_skip:!1}};function Ra(w,u,v){return v===void 0&&(v={x:0,y:0}),{top:w.top-u.height-v.y,right:w.right-u.width+v.x,bottom:w.bottom-u.height+v.y,left:w.left-u.width-v.x}}function Fa(w){return[He,ai,ri,qe].some(function(u){return w[u]>=0})}function qu(w){var u=w.state,v=w.name,N=u.rects.reference,A=u.rects.popper,z=u.modifiersData.preventOverflow,j=qs(u,{elementContext:"reference"}),q=qs(u,{altBoundary:!0}),Y=Ra(j,N),Q=Ra(q,A,z),I=Fa(Y),pt=Fa(Q);u.modifiersData[v]={referenceClippingOffsets:Y,popperEscapeOffsets:Q,isReferenceHidden:I,hasPopperEscaped:pt},u.attributes.popper=Object.assign({},u.attributes.popper,{"data-popper-reference-hidden":I,"data-popper-escaped":pt})}const _h={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:qu};function $u(w,u,v){var N=Ei(w),A=[qe,He].indexOf(N)>=0?-1:1,z=typeof v=="function"?v(Object.assign({},u,{placement:w})):v,j=z[0],q=z[1];return j=j||0,q=(q||0)*A,[qe,ai].indexOf(N)>=0?{x:q,y:j}:{x:j,y:q}}function Wu(w){var u=w.state,v=w.options,N=w.name,A=v.offset,z=A===void 0?[0,0]:A,j=Vr.reduce(function(I,pt){return I[pt]=$u(pt,u.rects,z),I},{}),q=j[u.placement],Y=q.x,Q=q.y;u.modifiersData.popperOffsets!=null&&(u.modifiersData.popperOffsets.x+=Y,u.modifiersData.popperOffsets.y+=Q),u.modifiersData[N]=j}const Zh={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Wu};function Ju(w){var u=w.state,v=w.name;u.modifiersData[v]=Wh({reference:u.rects.reference,element:u.rects.popper,strategy:"absolute",placement:u.placement})}const $r={name:"popperOffsets",enabled:!0,phase:"read",fn:Ju,data:{}};function _u(w){return w==="x"?"y":"x"}function Zu(w){var u=w.state,v=w.options,N=w.name,A=v.mainAxis,z=A===void 0?!0:A,j=v.altAxis,q=j===void 0?!1:j,Y=v.boundary,Q=v.rootBoundary,I=v.altBoundary,pt=v.padding,Lt=v.tether,Rt=Lt===void 0?!0:Lt,at=v.tetherOffset,xt=at===void 0?0:at,Z=qs(u,{boundary:Y,rootBoundary:Q,padding:pt,altBoundary:I}),C=Ei(u.placement),rt=Hs(u.placement),G=!rt,wt=Ur(C),U=_u(wt),Pt=u.modifiersData.popperOffsets,O=u.rects.reference,ee=u.rects.popper,re=typeof xt=="function"?xt(Object.assign({},u.rects,{placement:u.placement})):xt,Tt=typeof re=="number"?{mainAxis:re,altAxis:re}:Object.assign({mainAxis:0,altAxis:0},re),Gt=u.modifiersData.offset?u.modifiersData.offset[u.placement]:null,we={x:0,y:0};if(Pt){if(z){var Mt,de=wt==="y"?He:qe,Ve=wt==="y"?ri:ai,ie=wt==="y"?"height":"width",be=Pt[wt],Te=be+Z[de],ze=be-Z[Ve],ve=Rt?-ee[ie]/2:0,je=rt===bs?O[ie]:ee[ie],Ke=rt===bs?-ee[ie]:-O[ie],Pe=u.elements.arrow,Ne=Rt&&Pe?Kr(Pe):{width:0,height:0},Ue=u.modifiersData["arrow#persistent"]?u.modifiersData["arrow#persistent"].padding:Xh(),Gi=Ue[de],Fi=Ue[Ve],xi=Sn(0,O[ie],Ne[ie]),Ms=G?O[ie]/2-ve-xi-Gi-Tt.mainAxis:je-xi-Gi-Tt.mainAxis,Hi=G?-O[ie]/2+ve+xi+Fi+Tt.mainAxis:Ke+xi+Fi+Tt.mainAxis,Ns=u.elements.arrow&&Mn(u.elements.arrow),Rn=Ns?wt==="y"?Ns.clientTop||0:Ns.clientLeft||0:0,nn=(Mt=Gt==null?void 0:Gt[wt])!=null?Mt:0,Fn=be+Ms-nn-Rn,Cs=be+Hi-nn,on=Sn(Rt?ao(Te,Fn):Te,be,Rt?xs(ze,Cs):ze);Pt[wt]=on,we[wt]=on-be}if(q){var rn,Ti=wt==="x"?He:qe,Ye=wt==="x"?ri:ai,li=Pt[U],hs=U==="y"?"height":"width",an=li+Z[Ti],hn=li-Z[Ye],qi=[He,qe].indexOf(C)!==-1,ln=(rn=Gt==null?void 0:Gt[U])!=null?rn:0,ti=qi?an:li-O[hs]-ee[hs]-ln+Tt.altAxis,Ii=qi?li+O[hs]+ee[hs]-ln-Tt.altAxis:hn,In=Rt&&qi?Au(ti,li,Ii):Sn(Rt?ti:an,li,Rt?Ii:hn);Pt[U]=In,we[U]=In-li}u.modifiersData[N]=we}}const Qh={name:"preventOverflow",enabled:!0,phase:"main",fn:Zu,requiresIfExists:["offset"]};function Qu(w){return{scrollLeft:w.scrollLeft,scrollTop:w.scrollTop}}function tc(w){return w===hi(w)||!gi(w)?Gr(w):Qu(w)}function ec(w){var u=w.getBoundingClientRect(),v=Xs(u.width)/w.offsetWidth||1,N=Xs(u.height)/w.offsetHeight||1;return v!==1||N!==1}function ic(w,u,v){v===void 0&&(v=!1);var N=gi(u),A=gi(u)&&ec(u),z=os(u),j=Gs(w,A,v),q={scrollLeft:0,scrollTop:0},Y={x:0,y:0};return(N||!N&&!v)&&((Ri(u)!=="body"||qr(z))&&(q=tc(u)),gi(u)?(Y=Gs(u,!0),Y.x+=u.clientLeft,Y.y+=u.clientTop):z&&(Y.x=Hr(z))),{x:j.left+q.scrollLeft-Y.x,y:j.top+q.scrollTop-Y.y,width:j.width,height:j.height}}function sc(w){var u=new Map,v=new Set,N=[];w.forEach(function(z){u.set(z.name,z)});function A(z){v.add(z.name);var j=[].concat(z.requires||[],z.requiresIfExists||[]);j.forEach(function(q){if(!v.has(q)){var Y=u.get(q);Y&&A(Y)}}),N.push(z)}return w.forEach(function(z){v.has(z.name)||A(z)}),N}function nc(w){var u=sc(w);return Kh.reduce(function(v,N){return v.concat(u.filter(function(A){return A.phase===N}))},[])}function oc(w){var u;return function(){return u||(u=new Promise(function(v){Promise.resolve().then(function(){u=void 0,v(w())})})),u}}function rc(w){var u=w.reduce(function(v,N){var A=v[N.name];return v[N.name]=A?Object.assign({},A,N,{options:Object.assign({},A.options,N.options),data:Object.assign({},A.data,N.data)}):N,v},{});return Object.keys(u).map(function(v){return u[v]})}var Ia={placement:"bottom",modifiers:[],strategy:"absolute"};function Ba(){for(var w=arguments.length,u=new Array(w),v=0;v<w;v++)u[v]=arguments[v];return!u.some(function(N){return!(N&&typeof N.getBoundingClientRect=="function")})}function mo(w){w===void 0&&(w={});var u=w,v=u.defaultModifiers,N=v===void 0?[]:v,A=u.defaultOptions,z=A===void 0?Ia:A;return function(q,Y,Q){Q===void 0&&(Q=z);var I={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ia,z),modifiersData:{},elements:{reference:q,popper:Y},attributes:{},styles:{}},pt=[],Lt=!1,Rt={state:I,setOptions:function(C){var rt=typeof C=="function"?C(I.options):C;xt(),I.options=Object.assign({},z,I.options,rt),I.scrollParents={reference:vs(q)?kn(q):q.contextElement?kn(q.contextElement):[],popper:kn(Y)};var G=nc(rc([].concat(N,I.options.modifiers)));return I.orderedModifiers=G.filter(function(wt){return wt.enabled}),at(),Rt.update()},forceUpdate:function(){if(!Lt){var C=I.elements,rt=C.reference,G=C.popper;if(Ba(rt,G)){I.rects={reference:ic(rt,Mn(G),I.options.strategy==="fixed"),popper:Kr(G)},I.reset=!1,I.placement=I.options.placement,I.orderedModifiers.forEach(function(Tt){return I.modifiersData[Tt.name]=Object.assign({},Tt.data)});for(var wt=0;wt<I.orderedModifiers.length;wt++){if(I.reset===!0){I.reset=!1,wt=-1;continue}var U=I.orderedModifiers[wt],Pt=U.fn,O=U.options,ee=O===void 0?{}:O,re=U.name;typeof Pt=="function"&&(I=Pt({state:I,options:ee,name:re,instance:Rt})||I)}}}},update:oc(function(){return new Promise(function(Z){Rt.forceUpdate(),Z(I)})}),destroy:function(){xt(),Lt=!0}};if(!Ba(q,Y))return Rt;Rt.setOptions(Q).then(function(Z){!Lt&&Q.onFirstUpdate&&Q.onFirstUpdate(Z)});function at(){I.orderedModifiers.forEach(function(Z){var C=Z.name,rt=Z.options,G=rt===void 0?{}:rt,wt=Z.effect;if(typeof wt=="function"){var U=wt({state:I,name:C,instance:Rt,options:G}),Pt=function(){};pt.push(U||Pt)}})}function xt(){pt.forEach(function(Z){return Z()}),pt=[]}return Rt}}var ac=mo(),hc=[Xr,$r,Yr,jr],lc=mo({defaultModifiers:hc}),uc=[Xr,$r,Yr,jr,Zh,Jh,Qh,qh,_h],Wr=mo({defaultModifiers:uc});const tl=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Bh,afterRead:Rh,afterWrite:jh,applyStyles:jr,arrow:qh,auto:fo,basePlacements:_s,beforeMain:Fh,beforeRead:Eh,beforeWrite:Vh,bottom:ri,clippingParents:Lh,computeStyles:Yr,createPopper:Wr,createPopperBase:ac,createPopperLite:lc,detectOverflow:qs,end:Ys,eventListeners:Xr,flip:Jh,hide:_h,left:qe,main:Ih,modifierPhases:Kh,offset:Zh,placements:Vr,popper:zs,popperGenerator:mo,popperOffsets:$r,preventOverflow:Qh,read:Oh,reference:Dh,right:ai,start:bs,top:He,variationPlacements:Mr,viewport:Br,write:zh},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const es=new Map,rr={set(w,u,v){es.has(w)||es.set(w,new Map);const N=es.get(w);if(!N.has(u)&&N.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(N.keys())[0]}.`);return}N.set(u,v)},get(w,u){return es.has(w)&&es.get(w).get(u)||null},remove(w,u){if(!es.has(w))return;const v=es.get(w);v.delete(u),v.size===0&&es.delete(w)}},cc=1e6,dc=1e3,Tr="transitionend",el=w=>(w&&window.CSS&&window.CSS.escape&&(w=w.replace(/#([^\s"#']+)/g,(u,v)=>`#${CSS.escape(v)}`)),w),fc=w=>w==null?`${w}`:Object.prototype.toString.call(w).match(/\s([a-z]+)/i)[1].toLowerCase(),gc=w=>{do w+=Math.floor(Math.random()*cc);while(document.getElementById(w));return w},mc=w=>{if(!w)return 0;let{transitionDuration:u,transitionDelay:v}=window.getComputedStyle(w);const N=Number.parseFloat(u),A=Number.parseFloat(v);return!N&&!A?0:(u=u.split(",")[0],v=v.split(",")[0],(Number.parseFloat(u)+Number.parseFloat(v))*dc)},il=w=>{w.dispatchEvent(new Event(Tr))},Ki=w=>!w||typeof w!="object"?!1:(typeof w.jquery<"u"&&(w=w[0]),typeof w.nodeType<"u"),is=w=>Ki(w)?w.jquery?w[0]:w:typeof w=="string"&&w.length>0?document.querySelector(el(w)):null,Zs=w=>{if(!Ki(w)||w.getClientRects().length===0)return!1;const u=getComputedStyle(w).getPropertyValue("visibility")==="visible",v=w.closest("details:not([open])");if(!v)return u;if(v!==w){const N=w.closest("summary");if(N&&N.parentNode!==v||N===null)return!1}return u},ss=w=>!w||w.nodeType!==Node.ELEMENT_NODE||w.classList.contains("disabled")?!0:typeof w.disabled<"u"?w.disabled:w.hasAttribute("disabled")&&w.getAttribute("disabled")!=="false",sl=w=>{if(!document.documentElement.attachShadow)return null;if(typeof w.getRootNode=="function"){const u=w.getRootNode();return u instanceof ShadowRoot?u:null}return w instanceof ShadowRoot?w:w.parentNode?sl(w.parentNode):null},ho=()=>{},Nn=w=>{w.offsetHeight},nl=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,ar=[],pc=w=>{document.readyState==="loading"?(ar.length||document.addEventListener("DOMContentLoaded",()=>{for(const u of ar)u()}),ar.push(w)):w()},mi=()=>document.documentElement.dir==="rtl",yi=w=>{pc(()=>{const u=nl();if(u){const v=w.NAME,N=u.fn[v];u.fn[v]=w.jQueryInterface,u.fn[v].Constructor=w,u.fn[v].noConflict=()=>(u.fn[v]=N,w.jQueryInterface)}})},_e=(w,u=[],v=w)=>typeof w=="function"?w(...u):v,ol=(w,u,v=!0)=>{if(!v){_e(w);return}const A=mc(u)+5;let z=!1;const j=({target:q})=>{q===u&&(z=!0,u.removeEventListener(Tr,j),_e(w))};u.addEventListener(Tr,j),setTimeout(()=>{z||il(u)},A)},Jr=(w,u,v,N)=>{const A=w.length;let z=w.indexOf(u);return z===-1?!v&&N?w[A-1]:w[0]:(z+=v?1:-1,N&&(z=(z+A)%A),w[Math.max(0,Math.min(z,A-1))])},yc=/[^.]*(?=\..*)\.|.*/,xc=/\..*/,wc=/::\d+$/,hr={};let Va=1;const rl={mouseenter:"mouseover",mouseleave:"mouseout"},bc=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function al(w,u){return u&&`${u}::${Va++}`||w.uidEvent||Va++}function hl(w){const u=al(w);return w.uidEvent=u,hr[u]=hr[u]||{},hr[u]}function vc(w,u){return function v(N){return _r(N,{delegateTarget:w}),v.oneOff&&mt.off(w,N.type,u),u.apply(w,[N])}}function Sc(w,u,v){return function N(A){const z=w.querySelectorAll(u);for(let{target:j}=A;j&&j!==this;j=j.parentNode)for(const q of z)if(q===j)return _r(A,{delegateTarget:j}),N.oneOff&&mt.off(w,A.type,u,v),v.apply(j,[A])}}function ll(w,u,v=null){return Object.values(w).find(N=>N.callable===u&&N.delegationSelector===v)}function ul(w,u,v){const N=typeof u=="string",A=N?v:u||v;let z=cl(w);return bc.has(z)||(z=w),[N,A,z]}function za(w,u,v,N,A){if(typeof u!="string"||!w)return;let[z,j,q]=ul(u,v,N);u in rl&&(j=(at=>function(xt){if(!xt.relatedTarget||xt.relatedTarget!==xt.delegateTarget&&!xt.delegateTarget.contains(xt.relatedTarget))return at.call(this,xt)})(j));const Y=hl(w),Q=Y[q]||(Y[q]={}),I=ll(Q,j,z?v:null);if(I){I.oneOff=I.oneOff&&A;return}const pt=al(j,u.replace(yc,"")),Lt=z?Sc(w,v,j):vc(w,j);Lt.delegationSelector=z?v:null,Lt.callable=j,Lt.oneOff=A,Lt.uidEvent=pt,Q[pt]=Lt,w.addEventListener(q,Lt,z)}function Ar(w,u,v,N,A){const z=ll(u[v],N,A);z&&(w.removeEventListener(v,z,!!A),delete u[v][z.uidEvent])}function kc(w,u,v,N){const A=u[v]||{};for(const[z,j]of Object.entries(A))z.includes(N)&&Ar(w,u,v,j.callable,j.delegationSelector)}function cl(w){return w=w.replace(xc,""),rl[w]||w}const mt={on(w,u,v,N){za(w,u,v,N,!1)},one(w,u,v,N){za(w,u,v,N,!0)},off(w,u,v,N){if(typeof u!="string"||!w)return;const[A,z,j]=ul(u,v,N),q=j!==u,Y=hl(w),Q=Y[j]||{},I=u.startsWith(".");if(typeof z<"u"){if(!Object.keys(Q).length)return;Ar(w,Y,j,z,A?v:null);return}if(I)for(const pt of Object.keys(Y))kc(w,Y,pt,u.slice(1));for(const[pt,Lt]of Object.entries(Q)){const Rt=pt.replace(wc,"");(!q||u.includes(Rt))&&Ar(w,Y,j,Lt.callable,Lt.delegationSelector)}},trigger(w,u,v){if(typeof u!="string"||!w)return null;const N=nl(),A=cl(u),z=u!==A;let j=null,q=!0,Y=!0,Q=!1;z&&N&&(j=N.Event(u,v),N(w).trigger(j),q=!j.isPropagationStopped(),Y=!j.isImmediatePropagationStopped(),Q=j.isDefaultPrevented());const I=_r(new Event(u,{bubbles:q,cancelable:!0}),v);return Q&&I.preventDefault(),Y&&w.dispatchEvent(I),I.defaultPrevented&&j&&j.preventDefault(),I}};function _r(w,u={}){for(const[v,N]of Object.entries(u))try{w[v]=N}catch{Object.defineProperty(w,v,{configurable:!0,get(){return N}})}return w}function ja(w){if(w==="true")return!0;if(w==="false")return!1;if(w===Number(w).toString())return Number(w);if(w===""||w==="null")return null;if(typeof w!="string")return w;try{return JSON.parse(decodeURIComponent(w))}catch{return w}}function lr(w){return w.replace(/[A-Z]/g,u=>`-${u.toLowerCase()}`)}const Ui={setDataAttribute(w,u,v){w.setAttribute(`data-bs-${lr(u)}`,v)},removeDataAttribute(w,u){w.removeAttribute(`data-bs-${lr(u)}`)},getDataAttributes(w){if(!w)return{};const u={},v=Object.keys(w.dataset).filter(N=>N.startsWith("bs")&&!N.startsWith("bsConfig"));for(const N of v){let A=N.replace(/^bs/,"");A=A.charAt(0).toLowerCase()+A.slice(1,A.length),u[A]=ja(w.dataset[N])}return u},getDataAttribute(w,u){return ja(w.getAttribute(`data-bs-${lr(u)}`))}};class Cn{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(u){return u=this._mergeConfigObj(u),u=this._configAfterMerge(u),this._typeCheckConfig(u),u}_configAfterMerge(u){return u}_mergeConfigObj(u,v){const N=Ki(v)?Ui.getDataAttribute(v,"config"):{};return{...this.constructor.Default,...typeof N=="object"?N:{},...Ki(v)?Ui.getDataAttributes(v):{},...typeof u=="object"?u:{}}}_typeCheckConfig(u,v=this.constructor.DefaultType){for(const[N,A]of Object.entries(v)){const z=u[N],j=Ki(z)?"element":fc(z);if(!new RegExp(A).test(j))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${N}" provided type "${j}" but expected type "${A}".`)}}}const Pc="5.3.3";class Ni extends Cn{constructor(u,v){super(),u=is(u),u&&(this._element=u,this._config=this._getConfig(v),rr.set(this._element,this.constructor.DATA_KEY,this))}dispose(){rr.remove(this._element,this.constructor.DATA_KEY),mt.off(this._element,this.constructor.EVENT_KEY);for(const u of Object.getOwnPropertyNames(this))this[u]=null}_queueCallback(u,v,N=!0){ol(u,v,N)}_getConfig(u){return u=this._mergeConfigObj(u,this._element),u=this._configAfterMerge(u),this._typeCheckConfig(u),u}static getInstance(u){return rr.get(is(u),this.DATA_KEY)}static getOrCreateInstance(u,v={}){return this.getInstance(u)||new this(u,typeof v=="object"?v:null)}static get VERSION(){return Pc}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(u){return`${u}${this.EVENT_KEY}`}}const ur=w=>{let u=w.getAttribute("data-bs-target");if(!u||u==="#"){let v=w.getAttribute("href");if(!v||!v.includes("#")&&!v.startsWith("."))return null;v.includes("#")&&!v.startsWith("#")&&(v=`#${v.split("#")[1]}`),u=v&&v!=="#"?v.trim():null}return u?u.split(",").map(v=>el(v)).join(","):null},Kt={find(w,u=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(u,w))},findOne(w,u=document.documentElement){return Element.prototype.querySelector.call(u,w)},children(w,u){return[].concat(...w.children).filter(v=>v.matches(u))},parents(w,u){const v=[];let N=w.parentNode.closest(u);for(;N;)v.push(N),N=N.parentNode.closest(u);return v},prev(w,u){let v=w.previousElementSibling;for(;v;){if(v.matches(u))return[v];v=v.previousElementSibling}return[]},next(w,u){let v=w.nextElementSibling;for(;v;){if(v.matches(u))return[v];v=v.nextElementSibling}return[]},focusableChildren(w){const u=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(v=>`${v}:not([tabindex^="-"])`).join(",");return this.find(u,w).filter(v=>!ss(v)&&Zs(v))},getSelectorFromElement(w){const u=ur(w);return u&&Kt.findOne(u)?u:null},getElementFromSelector(w){const u=ur(w);return u?Kt.findOne(u):null},getMultipleElementsFromSelector(w){const u=ur(w);return u?Kt.find(u):[]}},po=(w,u="hide")=>{const v=`click.dismiss${w.EVENT_KEY}`,N=w.NAME;mt.on(document,v,`[data-bs-dismiss="${N}"]`,function(A){if(["A","AREA"].includes(this.tagName)&&A.preventDefault(),ss(this))return;const z=Kt.getElementFromSelector(this)||this.closest(`.${N}`);w.getOrCreateInstance(z)[u]()})},Mc="alert",Nc="bs.alert",dl=`.${Nc}`,Cc=`close${dl}`,Tc=`closed${dl}`,Ac="fade",Lc="show";class yo extends Ni{static get NAME(){return Mc}close(){if(mt.trigger(this._element,Cc).defaultPrevented)return;this._element.classList.remove(Lc);const v=this._element.classList.contains(Ac);this._queueCallback(()=>this._destroyElement(),this._element,v)}_destroyElement(){this._element.remove(),mt.trigger(this._element,Tc),this.dispose()}static jQueryInterface(u){return this.each(function(){const v=yo.getOrCreateInstance(this);if(typeof u=="string"){if(v[u]===void 0||u.startsWith("_")||u==="constructor")throw new TypeError(`No method named "${u}"`);v[u](this)}})}}po(yo,"close");yi(yo);const Dc="button",Ec="bs.button",Oc=`.${Ec}`,Rc=".data-api",Fc="active",Ka='[data-bs-toggle="button"]',Ic=`click${Oc}${Rc}`;class xo extends Ni{static get NAME(){return Dc}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(Fc))}static jQueryInterface(u){return this.each(function(){const v=xo.getOrCreateInstance(this);u==="toggle"&&v[u]()})}}mt.on(document,Ic,Ka,w=>{w.preventDefault();const u=w.target.closest(Ka);xo.getOrCreateInstance(u).toggle()});yi(xo);const Bc="swipe",Qs=".bs.swipe",Vc=`touchstart${Qs}`,zc=`touchmove${Qs}`,jc=`touchend${Qs}`,Kc=`pointerdown${Qs}`,Uc=`pointerup${Qs}`,Yc="touch",Xc="pen",Gc="pointer-event",Hc=40,qc={endCallback:null,leftCallback:null,rightCallback:null},$c={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class lo extends Cn{constructor(u,v){super(),this._element=u,!(!u||!lo.isSupported())&&(this._config=this._getConfig(v),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return qc}static get DefaultType(){return $c}static get NAME(){return Bc}dispose(){mt.off(this._element,Qs)}_start(u){if(!this._supportPointerEvents){this._deltaX=u.touches[0].clientX;return}this._eventIsPointerPenTouch(u)&&(this._deltaX=u.clientX)}_end(u){this._eventIsPointerPenTouch(u)&&(this._deltaX=u.clientX-this._deltaX),this._handleSwipe(),_e(this._config.endCallback)}_move(u){this._deltaX=u.touches&&u.touches.length>1?0:u.touches[0].clientX-this._deltaX}_handleSwipe(){const u=Math.abs(this._deltaX);if(u<=Hc)return;const v=u/this._deltaX;this._deltaX=0,v&&_e(v>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(mt.on(this._element,Kc,u=>this._start(u)),mt.on(this._element,Uc,u=>this._end(u)),this._element.classList.add(Gc)):(mt.on(this._element,Vc,u=>this._start(u)),mt.on(this._element,zc,u=>this._move(u)),mt.on(this._element,jc,u=>this._end(u)))}_eventIsPointerPenTouch(u){return this._supportPointerEvents&&(u.pointerType===Xc||u.pointerType===Yc)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Wc="carousel",Jc="bs.carousel",rs=`.${Jc}`,fl=".data-api",_c="ArrowLeft",Zc="ArrowRight",Qc=500,wn="next",Bs="prev",js="left",io="right",td=`slide${rs}`,cr=`slid${rs}`,ed=`keydown${rs}`,id=`mouseenter${rs}`,sd=`mouseleave${rs}`,nd=`dragstart${rs}`,od=`load${rs}${fl}`,rd=`click${rs}${fl}`,gl="carousel",$n="active",ad="slide",hd="carousel-item-end",ld="carousel-item-start",ud="carousel-item-next",cd="carousel-item-prev",ml=".active",pl=".carousel-item",dd=ml+pl,fd=".carousel-item img",gd=".carousel-indicators",md="[data-bs-slide], [data-bs-slide-to]",pd='[data-bs-ride="carousel"]',yd={[_c]:io,[Zc]:js},xd={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},wd={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Tn extends Ni{constructor(u,v){super(u,v),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Kt.findOne(gd,this._element),this._addEventListeners(),this._config.ride===gl&&this.cycle()}static get Default(){return xd}static get DefaultType(){return wd}static get NAME(){return Wc}next(){this._slide(wn)}nextWhenVisible(){!document.hidden&&Zs(this._element)&&this.next()}prev(){this._slide(Bs)}pause(){this._isSliding&&il(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){mt.one(this._element,cr,()=>this.cycle());return}this.cycle()}}to(u){const v=this._getItems();if(u>v.length-1||u<0)return;if(this._isSliding){mt.one(this._element,cr,()=>this.to(u));return}const N=this._getItemIndex(this._getActive());if(N===u)return;const A=u>N?wn:Bs;this._slide(A,v[u])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(u){return u.defaultInterval=u.interval,u}_addEventListeners(){this._config.keyboard&&mt.on(this._element,ed,u=>this._keydown(u)),this._config.pause==="hover"&&(mt.on(this._element,id,()=>this.pause()),mt.on(this._element,sd,()=>this._maybeEnableCycle())),this._config.touch&&lo.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const N of Kt.find(fd,this._element))mt.on(N,nd,A=>A.preventDefault());const v={leftCallback:()=>this._slide(this._directionToOrder(js)),rightCallback:()=>this._slide(this._directionToOrder(io)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),Qc+this._config.interval))}};this._swipeHelper=new lo(this._element,v)}_keydown(u){if(/input|textarea/i.test(u.target.tagName))return;const v=yd[u.key];v&&(u.preventDefault(),this._slide(this._directionToOrder(v)))}_getItemIndex(u){return this._getItems().indexOf(u)}_setActiveIndicatorElement(u){if(!this._indicatorsElement)return;const v=Kt.findOne(ml,this._indicatorsElement);v.classList.remove($n),v.removeAttribute("aria-current");const N=Kt.findOne(`[data-bs-slide-to="${u}"]`,this._indicatorsElement);N&&(N.classList.add($n),N.setAttribute("aria-current","true"))}_updateInterval(){const u=this._activeElement||this._getActive();if(!u)return;const v=Number.parseInt(u.getAttribute("data-bs-interval"),10);this._config.interval=v||this._config.defaultInterval}_slide(u,v=null){if(this._isSliding)return;const N=this._getActive(),A=u===wn,z=v||Jr(this._getItems(),N,A,this._config.wrap);if(z===N)return;const j=this._getItemIndex(z),q=Rt=>mt.trigger(this._element,Rt,{relatedTarget:z,direction:this._orderToDirection(u),from:this._getItemIndex(N),to:j});if(q(td).defaultPrevented||!N||!z)return;const Q=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(j),this._activeElement=z;const I=A?ld:hd,pt=A?ud:cd;z.classList.add(pt),Nn(z),N.classList.add(I),z.classList.add(I);const Lt=()=>{z.classList.remove(I,pt),z.classList.add($n),N.classList.remove($n,pt,I),this._isSliding=!1,q(cr)};this._queueCallback(Lt,N,this._isAnimated()),Q&&this.cycle()}_isAnimated(){return this._element.classList.contains(ad)}_getActive(){return Kt.findOne(dd,this._element)}_getItems(){return Kt.find(pl,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(u){return mi()?u===js?Bs:wn:u===js?wn:Bs}_orderToDirection(u){return mi()?u===Bs?js:io:u===Bs?io:js}static jQueryInterface(u){return this.each(function(){const v=Tn.getOrCreateInstance(this,u);if(typeof u=="number"){v.to(u);return}if(typeof u=="string"){if(v[u]===void 0||u.startsWith("_")||u==="constructor")throw new TypeError(`No method named "${u}"`);v[u]()}})}}mt.on(document,rd,md,function(w){const u=Kt.getElementFromSelector(this);if(!u||!u.classList.contains(gl))return;w.preventDefault();const v=Tn.getOrCreateInstance(u),N=this.getAttribute("data-bs-slide-to");if(N){v.to(N),v._maybeEnableCycle();return}if(Ui.getDataAttribute(this,"slide")==="next"){v.next(),v._maybeEnableCycle();return}v.prev(),v._maybeEnableCycle()});mt.on(window,od,()=>{const w=Kt.find(pd);for(const u of w)Tn.getOrCreateInstance(u)});yi(Tn);const bd="collapse",vd="bs.collapse",An=`.${vd}`,Sd=".data-api",kd=`show${An}`,Pd=`shown${An}`,Md=`hide${An}`,Nd=`hidden${An}`,Cd=`click${An}${Sd}`,dr="show",Us="collapse",Wn="collapsing",Td="collapsed",Ad=`:scope .${Us} .${Us}`,Ld="collapse-horizontal",Dd="width",Ed="height",Od=".collapse.show, .collapse.collapsing",Lr='[data-bs-toggle="collapse"]',Rd={parent:null,toggle:!0},Fd={parent:"(null|element)",toggle:"boolean"};class Pn extends Ni{constructor(u,v){super(u,v),this._isTransitioning=!1,this._triggerArray=[];const N=Kt.find(Lr);for(const A of N){const z=Kt.getSelectorFromElement(A),j=Kt.find(z).filter(q=>q===this._element);z!==null&&j.length&&this._triggerArray.push(A)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Rd}static get DefaultType(){return Fd}static get NAME(){return bd}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let u=[];if(this._config.parent&&(u=this._getFirstLevelChildren(Od).filter(q=>q!==this._element).map(q=>Pn.getOrCreateInstance(q,{toggle:!1}))),u.length&&u[0]._isTransitioning||mt.trigger(this._element,kd).defaultPrevented)return;for(const q of u)q.hide();const N=this._getDimension();this._element.classList.remove(Us),this._element.classList.add(Wn),this._element.style[N]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const A=()=>{this._isTransitioning=!1,this._element.classList.remove(Wn),this._element.classList.add(Us,dr),this._element.style[N]="",mt.trigger(this._element,Pd)},j=`scroll${N[0].toUpperCase()+N.slice(1)}`;this._queueCallback(A,this._element,!0),this._element.style[N]=`${this._element[j]}px`}hide(){if(this._isTransitioning||!this._isShown()||mt.trigger(this._element,Md).defaultPrevented)return;const v=this._getDimension();this._element.style[v]=`${this._element.getBoundingClientRect()[v]}px`,Nn(this._element),this._element.classList.add(Wn),this._element.classList.remove(Us,dr);for(const A of this._triggerArray){const z=Kt.getElementFromSelector(A);z&&!this._isShown(z)&&this._addAriaAndCollapsedClass([A],!1)}this._isTransitioning=!0;const N=()=>{this._isTransitioning=!1,this._element.classList.remove(Wn),this._element.classList.add(Us),mt.trigger(this._element,Nd)};this._element.style[v]="",this._queueCallback(N,this._element,!0)}_isShown(u=this._element){return u.classList.contains(dr)}_configAfterMerge(u){return u.toggle=!!u.toggle,u.parent=is(u.parent),u}_getDimension(){return this._element.classList.contains(Ld)?Dd:Ed}_initializeChildren(){if(!this._config.parent)return;const u=this._getFirstLevelChildren(Lr);for(const v of u){const N=Kt.getElementFromSelector(v);N&&this._addAriaAndCollapsedClass([v],this._isShown(N))}}_getFirstLevelChildren(u){const v=Kt.find(Ad,this._config.parent);return Kt.find(u,this._config.parent).filter(N=>!v.includes(N))}_addAriaAndCollapsedClass(u,v){if(u.length)for(const N of u)N.classList.toggle(Td,!v),N.setAttribute("aria-expanded",v)}static jQueryInterface(u){const v={};return typeof u=="string"&&/show|hide/.test(u)&&(v.toggle=!1),this.each(function(){const N=Pn.getOrCreateInstance(this,v);if(typeof u=="string"){if(typeof N[u]>"u")throw new TypeError(`No method named "${u}"`);N[u]()}})}}mt.on(document,Cd,Lr,function(w){(w.target.tagName==="A"||w.delegateTarget&&w.delegateTarget.tagName==="A")&&w.preventDefault();for(const u of Kt.getMultipleElementsFromSelector(this))Pn.getOrCreateInstance(u,{toggle:!1}).toggle()});yi(Pn);const Ua="dropdown",Id="bs.dropdown",ks=`.${Id}`,Zr=".data-api",Bd="Escape",Ya="Tab",Vd="ArrowUp",Xa="ArrowDown",zd=2,jd=`hide${ks}`,Kd=`hidden${ks}`,Ud=`show${ks}`,Yd=`shown${ks}`,yl=`click${ks}${Zr}`,xl=`keydown${ks}${Zr}`,Xd=`keyup${ks}${Zr}`,Ks="show",Gd="dropup",Hd="dropend",qd="dropstart",$d="dropup-center",Wd="dropdown-center",ms='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Jd=`${ms}.${Ks}`,so=".dropdown-menu",_d=".navbar",Zd=".navbar-nav",Qd=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",tf=mi()?"top-end":"top-start",ef=mi()?"top-start":"top-end",sf=mi()?"bottom-end":"bottom-start",nf=mi()?"bottom-start":"bottom-end",of=mi()?"left-start":"right-start",rf=mi()?"right-start":"left-start",af="top",hf="bottom",lf={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},uf={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Oi extends Ni{constructor(u,v){super(u,v),this._popper=null,this._parent=this._element.parentNode,this._menu=Kt.next(this._element,so)[0]||Kt.prev(this._element,so)[0]||Kt.findOne(so,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return lf}static get DefaultType(){return uf}static get NAME(){return Ua}toggle(){return this._isShown()?this.hide():this.show()}show(){if(ss(this._element)||this._isShown())return;const u={relatedTarget:this._element};if(!mt.trigger(this._element,Ud,u).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(Zd))for(const N of[].concat(...document.body.children))mt.on(N,"mouseover",ho);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ks),this._element.classList.add(Ks),mt.trigger(this._element,Yd,u)}}hide(){if(ss(this._element)||!this._isShown())return;const u={relatedTarget:this._element};this._completeHide(u)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(u){if(!mt.trigger(this._element,jd,u).defaultPrevented){if("ontouchstart"in document.documentElement)for(const N of[].concat(...document.body.children))mt.off(N,"mouseover",ho);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ks),this._element.classList.remove(Ks),this._element.setAttribute("aria-expanded","false"),Ui.removeDataAttribute(this._menu,"popper"),mt.trigger(this._element,Kd,u)}}_getConfig(u){if(u=super._getConfig(u),typeof u.reference=="object"&&!Ki(u.reference)&&typeof u.reference.getBoundingClientRect!="function")throw new TypeError(`${Ua.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return u}_createPopper(){if(typeof tl>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let u=this._element;this._config.reference==="parent"?u=this._parent:Ki(this._config.reference)?u=is(this._config.reference):typeof this._config.reference=="object"&&(u=this._config.reference);const v=this._getPopperConfig();this._popper=Wr(u,this._menu,v)}_isShown(){return this._menu.classList.contains(Ks)}_getPlacement(){const u=this._parent;if(u.classList.contains(Hd))return of;if(u.classList.contains(qd))return rf;if(u.classList.contains($d))return af;if(u.classList.contains(Wd))return hf;const v=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return u.classList.contains(Gd)?v?ef:tf:v?nf:sf}_detectNavbar(){return this._element.closest(_d)!==null}_getOffset(){const{offset:u}=this._config;return typeof u=="string"?u.split(",").map(v=>Number.parseInt(v,10)):typeof u=="function"?v=>u(v,this._element):u}_getPopperConfig(){const u={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Ui.setDataAttribute(this._menu,"popper","static"),u.modifiers=[{name:"applyStyles",enabled:!1}]),{...u,..._e(this._config.popperConfig,[u])}}_selectMenuItem({key:u,target:v}){const N=Kt.find(Qd,this._menu).filter(A=>Zs(A));N.length&&Jr(N,v,u===Xa,!N.includes(v)).focus()}static jQueryInterface(u){return this.each(function(){const v=Oi.getOrCreateInstance(this,u);if(typeof u=="string"){if(typeof v[u]>"u")throw new TypeError(`No method named "${u}"`);v[u]()}})}static clearMenus(u){if(u.button===zd||u.type==="keyup"&&u.key!==Ya)return;const v=Kt.find(Jd);for(const N of v){const A=Oi.getInstance(N);if(!A||A._config.autoClose===!1)continue;const z=u.composedPath(),j=z.includes(A._menu);if(z.includes(A._element)||A._config.autoClose==="inside"&&!j||A._config.autoClose==="outside"&&j||A._menu.contains(u.target)&&(u.type==="keyup"&&u.key===Ya||/input|select|option|textarea|form/i.test(u.target.tagName)))continue;const q={relatedTarget:A._element};u.type==="click"&&(q.clickEvent=u),A._completeHide(q)}}static dataApiKeydownHandler(u){const v=/input|textarea/i.test(u.target.tagName),N=u.key===Bd,A=[Vd,Xa].includes(u.key);if(!A&&!N||v&&!N)return;u.preventDefault();const z=this.matches(ms)?this:Kt.prev(this,ms)[0]||Kt.next(this,ms)[0]||Kt.findOne(ms,u.delegateTarget.parentNode),j=Oi.getOrCreateInstance(z);if(A){u.stopPropagation(),j.show(),j._selectMenuItem(u);return}j._isShown()&&(u.stopPropagation(),j.hide(),z.focus())}}mt.on(document,xl,ms,Oi.dataApiKeydownHandler);mt.on(document,xl,so,Oi.dataApiKeydownHandler);mt.on(document,yl,Oi.clearMenus);mt.on(document,Xd,Oi.clearMenus);mt.on(document,yl,ms,function(w){w.preventDefault(),Oi.getOrCreateInstance(this).toggle()});yi(Oi);const wl="backdrop",cf="fade",Ga="show",Ha=`mousedown.bs.${wl}`,df={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},ff={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class bl extends Cn{constructor(u){super(),this._config=this._getConfig(u),this._isAppended=!1,this._element=null}static get Default(){return df}static get DefaultType(){return ff}static get NAME(){return wl}show(u){if(!this._config.isVisible){_e(u);return}this._append();const v=this._getElement();this._config.isAnimated&&Nn(v),v.classList.add(Ga),this._emulateAnimation(()=>{_e(u)})}hide(u){if(!this._config.isVisible){_e(u);return}this._getElement().classList.remove(Ga),this._emulateAnimation(()=>{this.dispose(),_e(u)})}dispose(){this._isAppended&&(mt.off(this._element,Ha),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const u=document.createElement("div");u.className=this._config.className,this._config.isAnimated&&u.classList.add(cf),this._element=u}return this._element}_configAfterMerge(u){return u.rootElement=is(u.rootElement),u}_append(){if(this._isAppended)return;const u=this._getElement();this._config.rootElement.append(u),mt.on(u,Ha,()=>{_e(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(u){ol(u,this._getElement(),this._config.isAnimated)}}const gf="focustrap",mf="bs.focustrap",uo=`.${mf}`,pf=`focusin${uo}`,yf=`keydown.tab${uo}`,xf="Tab",wf="forward",qa="backward",bf={autofocus:!0,trapElement:null},vf={autofocus:"boolean",trapElement:"element"};class vl extends Cn{constructor(u){super(),this._config=this._getConfig(u),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return bf}static get DefaultType(){return vf}static get NAME(){return gf}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),mt.off(document,uo),mt.on(document,pf,u=>this._handleFocusin(u)),mt.on(document,yf,u=>this._handleKeydown(u)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,mt.off(document,uo))}_handleFocusin(u){const{trapElement:v}=this._config;if(u.target===document||u.target===v||v.contains(u.target))return;const N=Kt.focusableChildren(v);N.length===0?v.focus():this._lastTabNavDirection===qa?N[N.length-1].focus():N[0].focus()}_handleKeydown(u){u.key===xf&&(this._lastTabNavDirection=u.shiftKey?qa:wf)}}const $a=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Wa=".sticky-top",Jn="padding-right",Ja="margin-right";class Dr{constructor(){this._element=document.body}getWidth(){const u=document.documentElement.clientWidth;return Math.abs(window.innerWidth-u)}hide(){const u=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Jn,v=>v+u),this._setElementAttributes($a,Jn,v=>v+u),this._setElementAttributes(Wa,Ja,v=>v-u)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Jn),this._resetElementAttributes($a,Jn),this._resetElementAttributes(Wa,Ja)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(u,v,N){const A=this.getWidth(),z=j=>{if(j!==this._element&&window.innerWidth>j.clientWidth+A)return;this._saveInitialAttribute(j,v);const q=window.getComputedStyle(j).getPropertyValue(v);j.style.setProperty(v,`${N(Number.parseFloat(q))}px`)};this._applyManipulationCallback(u,z)}_saveInitialAttribute(u,v){const N=u.style.getPropertyValue(v);N&&Ui.setDataAttribute(u,v,N)}_resetElementAttributes(u,v){const N=A=>{const z=Ui.getDataAttribute(A,v);if(z===null){A.style.removeProperty(v);return}Ui.removeDataAttribute(A,v),A.style.setProperty(v,z)};this._applyManipulationCallback(u,N)}_applyManipulationCallback(u,v){if(Ki(u)){v(u);return}for(const N of Kt.find(u,this._element))v(N)}}const Sf="modal",kf="bs.modal",pi=`.${kf}`,Pf=".data-api",Mf="Escape",Nf=`hide${pi}`,Cf=`hidePrevented${pi}`,Sl=`hidden${pi}`,kl=`show${pi}`,Tf=`shown${pi}`,Af=`resize${pi}`,Lf=`click.dismiss${pi}`,Df=`mousedown.dismiss${pi}`,Ef=`keydown.dismiss${pi}`,Of=`click${pi}${Pf}`,_a="modal-open",Rf="fade",Za="show",fr="modal-static",Ff=".modal.show",If=".modal-dialog",Bf=".modal-body",Vf='[data-bs-toggle="modal"]',zf={backdrop:!0,focus:!0,keyboard:!0},jf={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class $s extends Ni{constructor(u,v){super(u,v),this._dialog=Kt.findOne(If,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Dr,this._addEventListeners()}static get Default(){return zf}static get DefaultType(){return jf}static get NAME(){return Sf}toggle(u){return this._isShown?this.hide():this.show(u)}show(u){this._isShown||this._isTransitioning||mt.trigger(this._element,kl,{relatedTarget:u}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(_a),this._adjustDialog(),this._backdrop.show(()=>this._showElement(u)))}hide(){!this._isShown||this._isTransitioning||mt.trigger(this._element,Nf).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Za),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){mt.off(window,pi),mt.off(this._dialog,pi),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bl({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new vl({trapElement:this._element})}_showElement(u){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const v=Kt.findOne(Bf,this._dialog);v&&(v.scrollTop=0),Nn(this._element),this._element.classList.add(Za);const N=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,mt.trigger(this._element,Tf,{relatedTarget:u})};this._queueCallback(N,this._dialog,this._isAnimated())}_addEventListeners(){mt.on(this._element,Ef,u=>{if(u.key===Mf){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),mt.on(window,Af,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),mt.on(this._element,Df,u=>{mt.one(this._element,Lf,v=>{if(!(this._element!==u.target||this._element!==v.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(_a),this._resetAdjustments(),this._scrollBar.reset(),mt.trigger(this._element,Sl)})}_isAnimated(){return this._element.classList.contains(Rf)}_triggerBackdropTransition(){if(mt.trigger(this._element,Cf).defaultPrevented)return;const v=this._element.scrollHeight>document.documentElement.clientHeight,N=this._element.style.overflowY;N==="hidden"||this._element.classList.contains(fr)||(v||(this._element.style.overflowY="hidden"),this._element.classList.add(fr),this._queueCallback(()=>{this._element.classList.remove(fr),this._queueCallback(()=>{this._element.style.overflowY=N},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const u=this._element.scrollHeight>document.documentElement.clientHeight,v=this._scrollBar.getWidth(),N=v>0;if(N&&!u){const A=mi()?"paddingLeft":"paddingRight";this._element.style[A]=`${v}px`}if(!N&&u){const A=mi()?"paddingRight":"paddingLeft";this._element.style[A]=`${v}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(u,v){return this.each(function(){const N=$s.getOrCreateInstance(this,u);if(typeof u=="string"){if(typeof N[u]>"u")throw new TypeError(`No method named "${u}"`);N[u](v)}})}}mt.on(document,Of,Vf,function(w){const u=Kt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&w.preventDefault(),mt.one(u,kl,A=>{A.defaultPrevented||mt.one(u,Sl,()=>{Zs(this)&&this.focus()})});const v=Kt.findOne(Ff);v&&$s.getInstance(v).hide(),$s.getOrCreateInstance(u).toggle(this)});po($s);yi($s);const Kf="offcanvas",Uf="bs.offcanvas",Xi=`.${Uf}`,Pl=".data-api",Yf=`load${Xi}${Pl}`,Xf="Escape",Qa="show",th="showing",eh="hiding",Gf="offcanvas-backdrop",Ml=".offcanvas.show",Hf=`show${Xi}`,qf=`shown${Xi}`,$f=`hide${Xi}`,ih=`hidePrevented${Xi}`,Nl=`hidden${Xi}`,Wf=`resize${Xi}`,Jf=`click${Xi}${Pl}`,_f=`keydown.dismiss${Xi}`,Zf='[data-bs-toggle="offcanvas"]',Qf={backdrop:!0,keyboard:!0,scroll:!1},tg={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class ns extends Ni{constructor(u,v){super(u,v),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Qf}static get DefaultType(){return tg}static get NAME(){return Kf}toggle(u){return this._isShown?this.hide():this.show(u)}show(u){if(this._isShown||mt.trigger(this._element,Hf,{relatedTarget:u}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Dr().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(th);const N=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(Qa),this._element.classList.remove(th),mt.trigger(this._element,qf,{relatedTarget:u})};this._queueCallback(N,this._element,!0)}hide(){if(!this._isShown||mt.trigger(this._element,$f).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(eh),this._backdrop.hide();const v=()=>{this._element.classList.remove(Qa,eh),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Dr().reset(),mt.trigger(this._element,Nl)};this._queueCallback(v,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const u=()=>{if(this._config.backdrop==="static"){mt.trigger(this._element,ih);return}this.hide()},v=!!this._config.backdrop;return new bl({className:Gf,isVisible:v,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:v?u:null})}_initializeFocusTrap(){return new vl({trapElement:this._element})}_addEventListeners(){mt.on(this._element,_f,u=>{if(u.key===Xf){if(this._config.keyboard){this.hide();return}mt.trigger(this._element,ih)}})}static jQueryInterface(u){return this.each(function(){const v=ns.getOrCreateInstance(this,u);if(typeof u=="string"){if(v[u]===void 0||u.startsWith("_")||u==="constructor")throw new TypeError(`No method named "${u}"`);v[u](this)}})}}mt.on(document,Jf,Zf,function(w){const u=Kt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&w.preventDefault(),ss(this))return;mt.one(u,Nl,()=>{Zs(this)&&this.focus()});const v=Kt.findOne(Ml);v&&v!==u&&ns.getInstance(v).hide(),ns.getOrCreateInstance(u).toggle(this)});mt.on(window,Yf,()=>{for(const w of Kt.find(Ml))ns.getOrCreateInstance(w).show()});mt.on(window,Wf,()=>{for(const w of Kt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(w).position!=="fixed"&&ns.getOrCreateInstance(w).hide()});po(ns);yi(ns);const eg=/^aria-[\w-]*$/i,Cl={"*":["class","dir","id","lang","role",eg],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},ig=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),sg=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,ng=(w,u)=>{const v=w.nodeName.toLowerCase();return u.includes(v)?ig.has(v)?!!sg.test(w.nodeValue):!0:u.filter(N=>N instanceof RegExp).some(N=>N.test(v))};function og(w,u,v){if(!w.length)return w;if(v&&typeof v=="function")return v(w);const A=new window.DOMParser().parseFromString(w,"text/html"),z=[].concat(...A.body.querySelectorAll("*"));for(const j of z){const q=j.nodeName.toLowerCase();if(!Object.keys(u).includes(q)){j.remove();continue}const Y=[].concat(...j.attributes),Q=[].concat(u["*"]||[],u[q]||[]);for(const I of Y)ng(I,Q)||j.removeAttribute(I.nodeName)}return A.body.innerHTML}const rg="TemplateFactory",ag={allowList:Cl,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},hg={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},lg={entry:"(string|element|function|null)",selector:"(string|element)"};class ug extends Cn{constructor(u){super(),this._config=this._getConfig(u)}static get Default(){return ag}static get DefaultType(){return hg}static get NAME(){return rg}getContent(){return Object.values(this._config.content).map(u=>this._resolvePossibleFunction(u)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(u){return this._checkContent(u),this._config.content={...this._config.content,...u},this}toHtml(){const u=document.createElement("div");u.innerHTML=this._maybeSanitize(this._config.template);for(const[A,z]of Object.entries(this._config.content))this._setContent(u,z,A);const v=u.children[0],N=this._resolvePossibleFunction(this._config.extraClass);return N&&v.classList.add(...N.split(" ")),v}_typeCheckConfig(u){super._typeCheckConfig(u),this._checkContent(u.content)}_checkContent(u){for(const[v,N]of Object.entries(u))super._typeCheckConfig({selector:v,entry:N},lg)}_setContent(u,v,N){const A=Kt.findOne(N,u);if(A){if(v=this._resolvePossibleFunction(v),!v){A.remove();return}if(Ki(v)){this._putElementInTemplate(is(v),A);return}if(this._config.html){A.innerHTML=this._maybeSanitize(v);return}A.textContent=v}}_maybeSanitize(u){return this._config.sanitize?og(u,this._config.allowList,this._config.sanitizeFn):u}_resolvePossibleFunction(u){return _e(u,[this])}_putElementInTemplate(u,v){if(this._config.html){v.innerHTML="",v.append(u);return}v.textContent=u.textContent}}const cg="tooltip",dg=new Set(["sanitize","allowList","sanitizeFn"]),gr="fade",fg="modal",_n="show",gg=".tooltip-inner",sh=`.${fg}`,nh="hide.bs.modal",bn="hover",mr="focus",mg="click",pg="manual",yg="hide",xg="hidden",wg="show",bg="shown",vg="inserted",Sg="click",kg="focusin",Pg="focusout",Mg="mouseenter",Ng="mouseleave",Cg={AUTO:"auto",TOP:"top",RIGHT:mi()?"left":"right",BOTTOM:"bottom",LEFT:mi()?"right":"left"},Tg={allowList:Cl,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Ag={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class tn extends Ni{constructor(u,v){if(typeof tl>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(u,v),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Tg}static get DefaultType(){return Ag}static get NAME(){return cg}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),mt.off(this._element.closest(sh),nh,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const u=mt.trigger(this._element,this.constructor.eventName(wg)),N=(sl(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(u.defaultPrevented||!N)return;this._disposePopper();const A=this._getTipElement();this._element.setAttribute("aria-describedby",A.getAttribute("id"));const{container:z}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(z.append(A),mt.trigger(this._element,this.constructor.eventName(vg))),this._popper=this._createPopper(A),A.classList.add(_n),"ontouchstart"in document.documentElement)for(const q of[].concat(...document.body.children))mt.on(q,"mouseover",ho);const j=()=>{mt.trigger(this._element,this.constructor.eventName(bg)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(j,this.tip,this._isAnimated())}hide(){if(!this._isShown()||mt.trigger(this._element,this.constructor.eventName(yg)).defaultPrevented)return;if(this._getTipElement().classList.remove(_n),"ontouchstart"in document.documentElement)for(const A of[].concat(...document.body.children))mt.off(A,"mouseover",ho);this._activeTrigger[mg]=!1,this._activeTrigger[mr]=!1,this._activeTrigger[bn]=!1,this._isHovered=null;const N=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),mt.trigger(this._element,this.constructor.eventName(xg)))};this._queueCallback(N,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(u){const v=this._getTemplateFactory(u).toHtml();if(!v)return null;v.classList.remove(gr,_n),v.classList.add(`bs-${this.constructor.NAME}-auto`);const N=gc(this.constructor.NAME).toString();return v.setAttribute("id",N),this._isAnimated()&&v.classList.add(gr),v}setContent(u){this._newContent=u,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(u){return this._templateFactory?this._templateFactory.changeContent(u):this._templateFactory=new ug({...this._config,content:u,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[gg]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(u){return this.constructor.getOrCreateInstance(u.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(gr)}_isShown(){return this.tip&&this.tip.classList.contains(_n)}_createPopper(u){const v=_e(this._config.placement,[this,u,this._element]),N=Cg[v.toUpperCase()];return Wr(this._element,u,this._getPopperConfig(N))}_getOffset(){const{offset:u}=this._config;return typeof u=="string"?u.split(",").map(v=>Number.parseInt(v,10)):typeof u=="function"?v=>u(v,this._element):u}_resolvePossibleFunction(u){return _e(u,[this._element])}_getPopperConfig(u){const v={placement:u,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:N=>{this._getTipElement().setAttribute("data-popper-placement",N.state.placement)}}]};return{...v,..._e(this._config.popperConfig,[v])}}_setListeners(){const u=this._config.trigger.split(" ");for(const v of u)if(v==="click")mt.on(this._element,this.constructor.eventName(Sg),this._config.selector,N=>{this._initializeOnDelegatedTarget(N).toggle()});else if(v!==pg){const N=v===bn?this.constructor.eventName(Mg):this.constructor.eventName(kg),A=v===bn?this.constructor.eventName(Ng):this.constructor.eventName(Pg);mt.on(this._element,N,this._config.selector,z=>{const j=this._initializeOnDelegatedTarget(z);j._activeTrigger[z.type==="focusin"?mr:bn]=!0,j._enter()}),mt.on(this._element,A,this._config.selector,z=>{const j=this._initializeOnDelegatedTarget(z);j._activeTrigger[z.type==="focusout"?mr:bn]=j._element.contains(z.relatedTarget),j._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},mt.on(this._element.closest(sh),nh,this._hideModalHandler)}_fixTitle(){const u=this._element.getAttribute("title");u&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",u),this._element.setAttribute("data-bs-original-title",u),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(u,v){clearTimeout(this._timeout),this._timeout=setTimeout(u,v)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(u){const v=Ui.getDataAttributes(this._element);for(const N of Object.keys(v))dg.has(N)&&delete v[N];return u={...v,...typeof u=="object"&&u?u:{}},u=this._mergeConfigObj(u),u=this._configAfterMerge(u),this._typeCheckConfig(u),u}_configAfterMerge(u){return u.container=u.container===!1?document.body:is(u.container),typeof u.delay=="number"&&(u.delay={show:u.delay,hide:u.delay}),typeof u.title=="number"&&(u.title=u.title.toString()),typeof u.content=="number"&&(u.content=u.content.toString()),u}_getDelegateConfig(){const u={};for(const[v,N]of Object.entries(this._config))this.constructor.Default[v]!==N&&(u[v]=N);return u.selector=!1,u.trigger="manual",u}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(u){return this.each(function(){const v=tn.getOrCreateInstance(this,u);if(typeof u=="string"){if(typeof v[u]>"u")throw new TypeError(`No method named "${u}"`);v[u]()}})}}yi(tn);const Lg="popover",Dg=".popover-header",Eg=".popover-body",Og={...tn.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Rg={...tn.DefaultType,content:"(null|string|element|function)"};class Qr extends tn{static get Default(){return Og}static get DefaultType(){return Rg}static get NAME(){return Lg}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Dg]:this._getTitle(),[Eg]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(u){return this.each(function(){const v=Qr.getOrCreateInstance(this,u);if(typeof u=="string"){if(typeof v[u]>"u")throw new TypeError(`No method named "${u}"`);v[u]()}})}}yi(Qr);const Fg="scrollspy",Ig="bs.scrollspy",ta=`.${Ig}`,Bg=".data-api",Vg=`activate${ta}`,oh=`click${ta}`,zg=`load${ta}${Bg}`,jg="dropdown-item",Vs="active",Kg='[data-bs-spy="scroll"]',pr="[href]",Ug=".nav, .list-group",rh=".nav-link",Yg=".nav-item",Xg=".list-group-item",Gg=`${rh}, ${Yg} > ${rh}, ${Xg}`,Hg=".dropdown",qg=".dropdown-toggle",$g={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Wg={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class wo extends Ni{constructor(u,v){super(u,v),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return $g}static get DefaultType(){return Wg}static get NAME(){return Fg}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const u of this._observableSections.values())this._observer.observe(u)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(u){return u.target=is(u.target)||document.body,u.rootMargin=u.offset?`${u.offset}px 0px -30%`:u.rootMargin,typeof u.threshold=="string"&&(u.threshold=u.threshold.split(",").map(v=>Number.parseFloat(v))),u}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(mt.off(this._config.target,oh),mt.on(this._config.target,oh,pr,u=>{const v=this._observableSections.get(u.target.hash);if(v){u.preventDefault();const N=this._rootElement||window,A=v.offsetTop-this._element.offsetTop;if(N.scrollTo){N.scrollTo({top:A,behavior:"smooth"});return}N.scrollTop=A}}))}_getNewObserver(){const u={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(v=>this._observerCallback(v),u)}_observerCallback(u){const v=j=>this._targetLinks.get(`#${j.target.id}`),N=j=>{this._previousScrollData.visibleEntryTop=j.target.offsetTop,this._process(v(j))},A=(this._rootElement||document.documentElement).scrollTop,z=A>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=A;for(const j of u){if(!j.isIntersecting){this._activeTarget=null,this._clearActiveClass(v(j));continue}const q=j.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(z&&q){if(N(j),!A)return;continue}!z&&!q&&N(j)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const u=Kt.find(pr,this._config.target);for(const v of u){if(!v.hash||ss(v))continue;const N=Kt.findOne(decodeURI(v.hash),this._element);Zs(N)&&(this._targetLinks.set(decodeURI(v.hash),v),this._observableSections.set(v.hash,N))}}_process(u){this._activeTarget!==u&&(this._clearActiveClass(this._config.target),this._activeTarget=u,u.classList.add(Vs),this._activateParents(u),mt.trigger(this._element,Vg,{relatedTarget:u}))}_activateParents(u){if(u.classList.contains(jg)){Kt.findOne(qg,u.closest(Hg)).classList.add(Vs);return}for(const v of Kt.parents(u,Ug))for(const N of Kt.prev(v,Gg))N.classList.add(Vs)}_clearActiveClass(u){u.classList.remove(Vs);const v=Kt.find(`${pr}.${Vs}`,u);for(const N of v)N.classList.remove(Vs)}static jQueryInterface(u){return this.each(function(){const v=wo.getOrCreateInstance(this,u);if(typeof u=="string"){if(v[u]===void 0||u.startsWith("_")||u==="constructor")throw new TypeError(`No method named "${u}"`);v[u]()}})}}mt.on(window,zg,()=>{for(const w of Kt.find(Kg))wo.getOrCreateInstance(w)});yi(wo);const Jg="tab",_g="bs.tab",Ps=`.${_g}`,Zg=`hide${Ps}`,Qg=`hidden${Ps}`,tm=`show${Ps}`,em=`shown${Ps}`,im=`click${Ps}`,sm=`keydown${Ps}`,nm=`load${Ps}`,om="ArrowLeft",ah="ArrowRight",rm="ArrowUp",hh="ArrowDown",yr="Home",lh="End",ps="active",uh="fade",xr="show",am="dropdown",Tl=".dropdown-toggle",hm=".dropdown-menu",wr=`:not(${Tl})`,lm='.list-group, .nav, [role="tablist"]',um=".nav-item, .list-group-item",cm=`.nav-link${wr}, .list-group-item${wr}, [role="tab"]${wr}`,Al='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',br=`${cm}, ${Al}`,dm=`.${ps}[data-bs-toggle="tab"], .${ps}[data-bs-toggle="pill"], .${ps}[data-bs-toggle="list"]`;class Ws extends Ni{constructor(u){super(u),this._parent=this._element.closest(lm),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),mt.on(this._element,sm,v=>this._keydown(v)))}static get NAME(){return Jg}show(){const u=this._element;if(this._elemIsActive(u))return;const v=this._getActiveElem(),N=v?mt.trigger(v,Zg,{relatedTarget:u}):null;mt.trigger(u,tm,{relatedTarget:v}).defaultPrevented||N&&N.defaultPrevented||(this._deactivate(v,u),this._activate(u,v))}_activate(u,v){if(!u)return;u.classList.add(ps),this._activate(Kt.getElementFromSelector(u));const N=()=>{if(u.getAttribute("role")!=="tab"){u.classList.add(xr);return}u.removeAttribute("tabindex"),u.setAttribute("aria-selected",!0),this._toggleDropDown(u,!0),mt.trigger(u,em,{relatedTarget:v})};this._queueCallback(N,u,u.classList.contains(uh))}_deactivate(u,v){if(!u)return;u.classList.remove(ps),u.blur(),this._deactivate(Kt.getElementFromSelector(u));const N=()=>{if(u.getAttribute("role")!=="tab"){u.classList.remove(xr);return}u.setAttribute("aria-selected",!1),u.setAttribute("tabindex","-1"),this._toggleDropDown(u,!1),mt.trigger(u,Qg,{relatedTarget:v})};this._queueCallback(N,u,u.classList.contains(uh))}_keydown(u){if(![om,ah,rm,hh,yr,lh].includes(u.key))return;u.stopPropagation(),u.preventDefault();const v=this._getChildren().filter(A=>!ss(A));let N;if([yr,lh].includes(u.key))N=v[u.key===yr?0:v.length-1];else{const A=[ah,hh].includes(u.key);N=Jr(v,u.target,A,!0)}N&&(N.focus({preventScroll:!0}),Ws.getOrCreateInstance(N).show())}_getChildren(){return Kt.find(br,this._parent)}_getActiveElem(){return this._getChildren().find(u=>this._elemIsActive(u))||null}_setInitialAttributes(u,v){this._setAttributeIfNotExists(u,"role","tablist");for(const N of v)this._setInitialAttributesOnChild(N)}_setInitialAttributesOnChild(u){u=this._getInnerElement(u);const v=this._elemIsActive(u),N=this._getOuterElement(u);u.setAttribute("aria-selected",v),N!==u&&this._setAttributeIfNotExists(N,"role","presentation"),v||u.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(u,"role","tab"),this._setInitialAttributesOnTargetPanel(u)}_setInitialAttributesOnTargetPanel(u){const v=Kt.getElementFromSelector(u);v&&(this._setAttributeIfNotExists(v,"role","tabpanel"),u.id&&this._setAttributeIfNotExists(v,"aria-labelledby",`${u.id}`))}_toggleDropDown(u,v){const N=this._getOuterElement(u);if(!N.classList.contains(am))return;const A=(z,j)=>{const q=Kt.findOne(z,N);q&&q.classList.toggle(j,v)};A(Tl,ps),A(hm,xr),N.setAttribute("aria-expanded",v)}_setAttributeIfNotExists(u,v,N){u.hasAttribute(v)||u.setAttribute(v,N)}_elemIsActive(u){return u.classList.contains(ps)}_getInnerElement(u){return u.matches(br)?u:Kt.findOne(br,u)}_getOuterElement(u){return u.closest(um)||u}static jQueryInterface(u){return this.each(function(){const v=Ws.getOrCreateInstance(this);if(typeof u=="string"){if(v[u]===void 0||u.startsWith("_")||u==="constructor")throw new TypeError(`No method named "${u}"`);v[u]()}})}}mt.on(document,im,Al,function(w){["A","AREA"].includes(this.tagName)&&w.preventDefault(),!ss(this)&&Ws.getOrCreateInstance(this).show()});mt.on(window,nm,()=>{for(const w of Kt.find(dm))Ws.getOrCreateInstance(w)});yi(Ws);const fm="toast",gm="bs.toast",as=`.${gm}`,mm=`mouseover${as}`,pm=`mouseout${as}`,ym=`focusin${as}`,xm=`focusout${as}`,wm=`hide${as}`,bm=`hidden${as}`,vm=`show${as}`,Sm=`shown${as}`,km="fade",ch="hide",Zn="show",Qn="showing",Pm={animation:"boolean",autohide:"boolean",delay:"number"},Mm={animation:!0,autohide:!0,delay:5e3};class bo extends Ni{constructor(u,v){super(u,v),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Mm}static get DefaultType(){return Pm}static get NAME(){return fm}show(){if(mt.trigger(this._element,vm).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(km);const v=()=>{this._element.classList.remove(Qn),mt.trigger(this._element,Sm),this._maybeScheduleHide()};this._element.classList.remove(ch),Nn(this._element),this._element.classList.add(Zn,Qn),this._queueCallback(v,this._element,this._config.animation)}hide(){if(!this.isShown()||mt.trigger(this._element,wm).defaultPrevented)return;const v=()=>{this._element.classList.add(ch),this._element.classList.remove(Qn,Zn),mt.trigger(this._element,bm)};this._element.classList.add(Qn),this._queueCallback(v,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Zn),super.dispose()}isShown(){return this._element.classList.contains(Zn)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(u,v){switch(u.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=v;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=v;break}}if(v){this._clearTimeout();return}const N=u.relatedTarget;this._element===N||this._element.contains(N)||this._maybeScheduleHide()}_setListeners(){mt.on(this._element,mm,u=>this._onInteraction(u,!0)),mt.on(this._element,pm,u=>this._onInteraction(u,!1)),mt.on(this._element,ym,u=>this._onInteraction(u,!0)),mt.on(this._element,xm,u=>this._onInteraction(u,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(u){return this.each(function(){const v=bo.getOrCreateInstance(this,u);if(typeof u=="string"){if(typeof v[u]>"u")throw new TypeError(`No method named "${u}"`);v[u](this)}})}}po(bo);yi(bo);function Ll(w,u){return function(){return w.apply(u,arguments)}}const{toString:Nm}=Object.prototype,{getPrototypeOf:ea}=Object,{iterator:vo,toStringTag:Dl}=Symbol,So=(w=>u=>{const v=Nm.call(u);return w[v]||(w[v]=v.slice(8,-1).toLowerCase())})(Object.create(null)),Ci=w=>(w=w.toLowerCase(),u=>So(u)===w),ko=w=>u=>typeof u===w,{isArray:en}=Array,Js=ko("undefined");function Ln(w){return w!==null&&!Js(w)&&w.constructor!==null&&!Js(w.constructor)&&Ze(w.constructor.isBuffer)&&w.constructor.isBuffer(w)}const El=Ci("ArrayBuffer");function Cm(w){let u;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?u=ArrayBuffer.isView(w):u=w&&w.buffer&&El(w.buffer),u}const Tm=ko("string"),Ze=ko("function"),Ol=ko("number"),Dn=w=>w!==null&&typeof w=="object",Am=w=>w===!0||w===!1,no=w=>{if(So(w)!=="object")return!1;const u=ea(w);return(u===null||u===Object.prototype||Object.getPrototypeOf(u)===null)&&!(Dl in w)&&!(vo in w)},Lm=w=>{if(!Dn(w)||Ln(w))return!1;try{return Object.keys(w).length===0&&Object.getPrototypeOf(w)===Object.prototype}catch{return!1}},Dm=Ci("Date"),Em=Ci("File"),Om=Ci("Blob"),Rm=Ci("FileList"),Fm=w=>Dn(w)&&Ze(w.pipe),Im=w=>{let u;return w&&(typeof FormData=="function"&&w instanceof FormData||Ze(w.append)&&((u=So(w))==="formdata"||u==="object"&&Ze(w.toString)&&w.toString()==="[object FormData]"))},Bm=Ci("URLSearchParams"),[Vm,zm,jm,Km]=["ReadableStream","Request","Response","Headers"].map(Ci),Um=w=>w.trim?w.trim():w.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function En(w,u,{allOwnKeys:v=!1}={}){if(w===null||typeof w>"u")return;let N,A;if(typeof w!="object"&&(w=[w]),en(w))for(N=0,A=w.length;N<A;N++)u.call(null,w[N],N,w);else{if(Ln(w))return;const z=v?Object.getOwnPropertyNames(w):Object.keys(w),j=z.length;let q;for(N=0;N<j;N++)q=z[N],u.call(null,w[q],q,w)}}function Rl(w,u){if(Ln(w))return null;u=u.toLowerCase();const v=Object.keys(w);let N=v.length,A;for(;N-- >0;)if(A=v[N],u===A.toLowerCase())return A;return null}const ys=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Fl=w=>!Js(w)&&w!==ys;function Er(){const{caseless:w,skipUndefined:u}=Fl(this)&&this||{},v={},N=(A,z)=>{const j=w&&Rl(v,z)||z;no(v[j])&&no(A)?v[j]=Er(v[j],A):no(A)?v[j]=Er({},A):en(A)?v[j]=A.slice():(!u||!Js(A))&&(v[j]=A)};for(let A=0,z=arguments.length;A<z;A++)arguments[A]&&En(arguments[A],N);return v}const Ym=(w,u,v,{allOwnKeys:N}={})=>(En(u,(A,z)=>{v&&Ze(A)?w[z]=Ll(A,v):w[z]=A},{allOwnKeys:N}),w),Xm=w=>(w.charCodeAt(0)===65279&&(w=w.slice(1)),w),Gm=(w,u,v,N)=>{w.prototype=Object.create(u.prototype,N),w.prototype.constructor=w,Object.defineProperty(w,"super",{value:u.prototype}),v&&Object.assign(w.prototype,v)},Hm=(w,u,v,N)=>{let A,z,j;const q={};if(u=u||{},w==null)return u;do{for(A=Object.getOwnPropertyNames(w),z=A.length;z-- >0;)j=A[z],(!N||N(j,w,u))&&!q[j]&&(u[j]=w[j],q[j]=!0);w=v!==!1&&ea(w)}while(w&&(!v||v(w,u))&&w!==Object.prototype);return u},qm=(w,u,v)=>{w=String(w),(v===void 0||v>w.length)&&(v=w.length),v-=u.length;const N=w.indexOf(u,v);return N!==-1&&N===v},$m=w=>{if(!w)return null;if(en(w))return w;let u=w.length;if(!Ol(u))return null;const v=new Array(u);for(;u-- >0;)v[u]=w[u];return v},Wm=(w=>u=>w&&u instanceof w)(typeof Uint8Array<"u"&&ea(Uint8Array)),Jm=(w,u)=>{const N=(w&&w[vo]).call(w);let A;for(;(A=N.next())&&!A.done;){const z=A.value;u.call(w,z[0],z[1])}},_m=(w,u)=>{let v;const N=[];for(;(v=w.exec(u))!==null;)N.push(v);return N},Zm=Ci("HTMLFormElement"),Qm=w=>w.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(v,N,A){return N.toUpperCase()+A}),dh=(({hasOwnProperty:w})=>(u,v)=>w.call(u,v))(Object.prototype),tp=Ci("RegExp"),Il=(w,u)=>{const v=Object.getOwnPropertyDescriptors(w),N={};En(v,(A,z)=>{let j;(j=u(A,z,w))!==!1&&(N[z]=j||A)}),Object.defineProperties(w,N)},ep=w=>{Il(w,(u,v)=>{if(Ze(w)&&["arguments","caller","callee"].indexOf(v)!==-1)return!1;const N=w[v];if(Ze(N)){if(u.enumerable=!1,"writable"in u){u.writable=!1;return}u.set||(u.set=()=>{throw Error("Can not rewrite read-only method '"+v+"'")})}})},ip=(w,u)=>{const v={},N=A=>{A.forEach(z=>{v[z]=!0})};return en(w)?N(w):N(String(w).split(u)),v},sp=()=>{},np=(w,u)=>w!=null&&Number.isFinite(w=+w)?w:u;function op(w){return!!(w&&Ze(w.append)&&w[Dl]==="FormData"&&w[vo])}const rp=w=>{const u=new Array(10),v=(N,A)=>{if(Dn(N)){if(u.indexOf(N)>=0)return;if(Ln(N))return N;if(!("toJSON"in N)){u[A]=N;const z=en(N)?[]:{};return En(N,(j,q)=>{const Y=v(j,A+1);!Js(Y)&&(z[q]=Y)}),u[A]=void 0,z}}return N};return v(w,0)},ap=Ci("AsyncFunction"),hp=w=>w&&(Dn(w)||Ze(w))&&Ze(w.then)&&Ze(w.catch),Bl=((w,u)=>w?setImmediate:u?((v,N)=>(ys.addEventListener("message",({source:A,data:z})=>{A===ys&&z===v&&N.length&&N.shift()()},!1),A=>{N.push(A),ys.postMessage(v,"*")}))(`axios@${Math.random()}`,[]):v=>setTimeout(v))(typeof setImmediate=="function",Ze(ys.postMessage)),lp=typeof queueMicrotask<"u"?queueMicrotask.bind(ys):typeof process<"u"&&process.nextTick||Bl,up=w=>w!=null&&Ze(w[vo]),it={isArray:en,isArrayBuffer:El,isBuffer:Ln,isFormData:Im,isArrayBufferView:Cm,isString:Tm,isNumber:Ol,isBoolean:Am,isObject:Dn,isPlainObject:no,isEmptyObject:Lm,isReadableStream:Vm,isRequest:zm,isResponse:jm,isHeaders:Km,isUndefined:Js,isDate:Dm,isFile:Em,isBlob:Om,isRegExp:tp,isFunction:Ze,isStream:Fm,isURLSearchParams:Bm,isTypedArray:Wm,isFileList:Rm,forEach:En,merge:Er,extend:Ym,trim:Um,stripBOM:Xm,inherits:Gm,toFlatObject:Hm,kindOf:So,kindOfTest:Ci,endsWith:qm,toArray:$m,forEachEntry:Jm,matchAll:_m,isHTMLForm:Zm,hasOwnProperty:dh,hasOwnProp:dh,reduceDescriptors:Il,freezeMethods:ep,toObjectSet:ip,toCamelCase:Qm,noop:sp,toFiniteNumber:np,findKey:Rl,global:ys,isContextDefined:Fl,isSpecCompliantForm:op,toJSONObject:rp,isAsyncFn:ap,isThenable:hp,setImmediate:Bl,asap:lp,isIterable:up};function Wt(w,u,v,N,A){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=w,this.name="AxiosError",u&&(this.code=u),v&&(this.config=v),N&&(this.request=N),A&&(this.response=A,this.status=A.status?A.status:null)}it.inherits(Wt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:it.toJSONObject(this.config),code:this.code,status:this.status}}});const Vl=Wt.prototype,zl={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(w=>{zl[w]={value:w}});Object.defineProperties(Wt,zl);Object.defineProperty(Vl,"isAxiosError",{value:!0});Wt.from=(w,u,v,N,A,z)=>{const j=Object.create(Vl);it.toFlatObject(w,j,function(I){return I!==Error.prototype},Q=>Q!=="isAxiosError");const q=w&&w.message?w.message:"Error",Y=u==null&&w?w.code:u;return Wt.call(j,q,Y,v,N,A),w&&j.cause==null&&Object.defineProperty(j,"cause",{value:w,configurable:!0}),j.name=w&&w.name||"Error",z&&Object.assign(j,z),j};const cp=null;function Or(w){return it.isPlainObject(w)||it.isArray(w)}function jl(w){return it.endsWith(w,"[]")?w.slice(0,-2):w}function fh(w,u,v){return w?w.concat(u).map(function(A,z){return A=jl(A),!v&&z?"["+A+"]":A}).join(v?".":""):u}function dp(w){return it.isArray(w)&&!w.some(Or)}const fp=it.toFlatObject(it,{},null,function(u){return/^is[A-Z]/.test(u)});function Po(w,u,v){if(!it.isObject(w))throw new TypeError("target must be an object");u=u||new FormData,v=it.toFlatObject(v,{metaTokens:!0,dots:!1,indexes:!1},!1,function(xt,Z){return!it.isUndefined(Z[xt])});const N=v.metaTokens,A=v.visitor||I,z=v.dots,j=v.indexes,Y=(v.Blob||typeof Blob<"u"&&Blob)&&it.isSpecCompliantForm(u);if(!it.isFunction(A))throw new TypeError("visitor must be a function");function Q(at){if(at===null)return"";if(it.isDate(at))return at.toISOString();if(it.isBoolean(at))return at.toString();if(!Y&&it.isBlob(at))throw new Wt("Blob is not supported. Use a Buffer instead.");return it.isArrayBuffer(at)||it.isTypedArray(at)?Y&&typeof Blob=="function"?new Blob([at]):Buffer.from(at):at}function I(at,xt,Z){let C=at;if(at&&!Z&&typeof at=="object"){if(it.endsWith(xt,"{}"))xt=N?xt:xt.slice(0,-2),at=JSON.stringify(at);else if(it.isArray(at)&&dp(at)||(it.isFileList(at)||it.endsWith(xt,"[]"))&&(C=it.toArray(at)))return xt=jl(xt),C.forEach(function(G,wt){!(it.isUndefined(G)||G===null)&&u.append(j===!0?fh([xt],wt,z):j===null?xt:xt+"[]",Q(G))}),!1}return Or(at)?!0:(u.append(fh(Z,xt,z),Q(at)),!1)}const pt=[],Lt=Object.assign(fp,{defaultVisitor:I,convertValue:Q,isVisitable:Or});function Rt(at,xt){if(!it.isUndefined(at)){if(pt.indexOf(at)!==-1)throw Error("Circular reference detected in "+xt.join("."));pt.push(at),it.forEach(at,function(C,rt){(!(it.isUndefined(C)||C===null)&&A.call(u,C,it.isString(rt)?rt.trim():rt,xt,Lt))===!0&&Rt(C,xt?xt.concat(rt):[rt])}),pt.pop()}}if(!it.isObject(w))throw new TypeError("data must be an object");return Rt(w),u}function gh(w){const u={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(w).replace(/[!'()~]|%20|%00/g,function(N){return u[N]})}function ia(w,u){this._pairs=[],w&&Po(w,this,u)}const Kl=ia.prototype;Kl.append=function(u,v){this._pairs.push([u,v])};Kl.toString=function(u){const v=u?function(N){return u.call(this,N,gh)}:gh;return this._pairs.map(function(A){return v(A[0])+"="+v(A[1])},"").join("&")};function gp(w){return encodeURIComponent(w).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ul(w,u,v){if(!u)return w;const N=v&&v.encode||gp;it.isFunction(v)&&(v={serialize:v});const A=v&&v.serialize;let z;if(A?z=A(u,v):z=it.isURLSearchParams(u)?u.toString():new ia(u,v).toString(N),z){const j=w.indexOf("#");j!==-1&&(w=w.slice(0,j)),w+=(w.indexOf("?")===-1?"?":"&")+z}return w}class mh{constructor(){this.handlers=[]}use(u,v,N){return this.handlers.push({fulfilled:u,rejected:v,synchronous:N?N.synchronous:!1,runWhen:N?N.runWhen:null}),this.handlers.length-1}eject(u){this.handlers[u]&&(this.handlers[u]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(u){it.forEach(this.handlers,function(N){N!==null&&u(N)})}}const Yl={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mp=typeof URLSearchParams<"u"?URLSearchParams:ia,pp=typeof FormData<"u"?FormData:null,yp=typeof Blob<"u"?Blob:null,xp={isBrowser:!0,classes:{URLSearchParams:mp,FormData:pp,Blob:yp},protocols:["http","https","file","blob","url","data"]},sa=typeof window<"u"&&typeof document<"u",Rr=typeof navigator=="object"&&navigator||void 0,wp=sa&&(!Rr||["ReactNative","NativeScript","NS"].indexOf(Rr.product)<0),bp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",vp=sa&&window.location.href||"http://localhost",Sp=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:sa,hasStandardBrowserEnv:wp,hasStandardBrowserWebWorkerEnv:bp,navigator:Rr,origin:vp},Symbol.toStringTag,{value:"Module"})),Be={...Sp,...xp};function kp(w,u){return Po(w,new Be.classes.URLSearchParams,{visitor:function(v,N,A,z){return Be.isNode&&it.isBuffer(v)?(this.append(N,v.toString("base64")),!1):z.defaultVisitor.apply(this,arguments)},...u})}function Pp(w){return it.matchAll(/\w+|\[(\w*)]/g,w).map(u=>u[0]==="[]"?"":u[1]||u[0])}function Mp(w){const u={},v=Object.keys(w);let N;const A=v.length;let z;for(N=0;N<A;N++)z=v[N],u[z]=w[z];return u}function Xl(w){function u(v,N,A,z){let j=v[z++];if(j==="__proto__")return!0;const q=Number.isFinite(+j),Y=z>=v.length;return j=!j&&it.isArray(A)?A.length:j,Y?(it.hasOwnProp(A,j)?A[j]=[A[j],N]:A[j]=N,!q):((!A[j]||!it.isObject(A[j]))&&(A[j]=[]),u(v,N,A[j],z)&&it.isArray(A[j])&&(A[j]=Mp(A[j])),!q)}if(it.isFormData(w)&&it.isFunction(w.entries)){const v={};return it.forEachEntry(w,(N,A)=>{u(Pp(N),A,v,0)}),v}return null}function Np(w,u,v){if(it.isString(w))try{return(u||JSON.parse)(w),it.trim(w)}catch(N){if(N.name!=="SyntaxError")throw N}return(0,JSON.stringify)(w)}const On={transitional:Yl,adapter:["xhr","http","fetch"],transformRequest:[function(u,v){const N=v.getContentType()||"",A=N.indexOf("application/json")>-1,z=it.isObject(u);if(z&&it.isHTMLForm(u)&&(u=new FormData(u)),it.isFormData(u))return A?JSON.stringify(Xl(u)):u;if(it.isArrayBuffer(u)||it.isBuffer(u)||it.isStream(u)||it.isFile(u)||it.isBlob(u)||it.isReadableStream(u))return u;if(it.isArrayBufferView(u))return u.buffer;if(it.isURLSearchParams(u))return v.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),u.toString();let q;if(z){if(N.indexOf("application/x-www-form-urlencoded")>-1)return kp(u,this.formSerializer).toString();if((q=it.isFileList(u))||N.indexOf("multipart/form-data")>-1){const Y=this.env&&this.env.FormData;return Po(q?{"files[]":u}:u,Y&&new Y,this.formSerializer)}}return z||A?(v.setContentType("application/json",!1),Np(u)):u}],transformResponse:[function(u){const v=this.transitional||On.transitional,N=v&&v.forcedJSONParsing,A=this.responseType==="json";if(it.isResponse(u)||it.isReadableStream(u))return u;if(u&&it.isString(u)&&(N&&!this.responseType||A)){const j=!(v&&v.silentJSONParsing)&&A;try{return JSON.parse(u,this.parseReviver)}catch(q){if(j)throw q.name==="SyntaxError"?Wt.from(q,Wt.ERR_BAD_RESPONSE,this,null,this.response):q}}return u}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Be.classes.FormData,Blob:Be.classes.Blob},validateStatus:function(u){return u>=200&&u<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};it.forEach(["delete","get","head","post","put","patch"],w=>{On.headers[w]={}});const Cp=it.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Tp=w=>{const u={};let v,N,A;return w&&w.split(`
`).forEach(function(j){A=j.indexOf(":"),v=j.substring(0,A).trim().toLowerCase(),N=j.substring(A+1).trim(),!(!v||u[v]&&Cp[v])&&(v==="set-cookie"?u[v]?u[v].push(N):u[v]=[N]:u[v]=u[v]?u[v]+", "+N:N)}),u},ph=Symbol("internals");function vn(w){return w&&String(w).trim().toLowerCase()}function oo(w){return w===!1||w==null?w:it.isArray(w)?w.map(oo):String(w)}function Ap(w){const u=Object.create(null),v=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let N;for(;N=v.exec(w);)u[N[1]]=N[2];return u}const Lp=w=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(w.trim());function vr(w,u,v,N,A){if(it.isFunction(N))return N.call(this,u,v);if(A&&(u=v),!!it.isString(u)){if(it.isString(N))return u.indexOf(N)!==-1;if(it.isRegExp(N))return N.test(u)}}function Dp(w){return w.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(u,v,N)=>v.toUpperCase()+N)}function Ep(w,u){const v=it.toCamelCase(" "+u);["get","set","has"].forEach(N=>{Object.defineProperty(w,N+v,{value:function(A,z,j){return this[N].call(this,u,A,z,j)},configurable:!0})})}class Qe{constructor(u){u&&this.set(u)}set(u,v,N){const A=this;function z(q,Y,Q){const I=vn(Y);if(!I)throw new Error("header name must be a non-empty string");const pt=it.findKey(A,I);(!pt||A[pt]===void 0||Q===!0||Q===void 0&&A[pt]!==!1)&&(A[pt||Y]=oo(q))}const j=(q,Y)=>it.forEach(q,(Q,I)=>z(Q,I,Y));if(it.isPlainObject(u)||u instanceof this.constructor)j(u,v);else if(it.isString(u)&&(u=u.trim())&&!Lp(u))j(Tp(u),v);else if(it.isObject(u)&&it.isIterable(u)){let q={},Y,Q;for(const I of u){if(!it.isArray(I))throw TypeError("Object iterator must return a key-value pair");q[Q=I[0]]=(Y=q[Q])?it.isArray(Y)?[...Y,I[1]]:[Y,I[1]]:I[1]}j(q,v)}else u!=null&&z(v,u,N);return this}get(u,v){if(u=vn(u),u){const N=it.findKey(this,u);if(N){const A=this[N];if(!v)return A;if(v===!0)return Ap(A);if(it.isFunction(v))return v.call(this,A,N);if(it.isRegExp(v))return v.exec(A);throw new TypeError("parser must be boolean|regexp|function")}}}has(u,v){if(u=vn(u),u){const N=it.findKey(this,u);return!!(N&&this[N]!==void 0&&(!v||vr(this,this[N],N,v)))}return!1}delete(u,v){const N=this;let A=!1;function z(j){if(j=vn(j),j){const q=it.findKey(N,j);q&&(!v||vr(N,N[q],q,v))&&(delete N[q],A=!0)}}return it.isArray(u)?u.forEach(z):z(u),A}clear(u){const v=Object.keys(this);let N=v.length,A=!1;for(;N--;){const z=v[N];(!u||vr(this,this[z],z,u,!0))&&(delete this[z],A=!0)}return A}normalize(u){const v=this,N={};return it.forEach(this,(A,z)=>{const j=it.findKey(N,z);if(j){v[j]=oo(A),delete v[z];return}const q=u?Dp(z):String(z).trim();q!==z&&delete v[z],v[q]=oo(A),N[q]=!0}),this}concat(...u){return this.constructor.concat(this,...u)}toJSON(u){const v=Object.create(null);return it.forEach(this,(N,A)=>{N!=null&&N!==!1&&(v[A]=u&&it.isArray(N)?N.join(", "):N)}),v}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([u,v])=>u+": "+v).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(u){return u instanceof this?u:new this(u)}static concat(u,...v){const N=new this(u);return v.forEach(A=>N.set(A)),N}static accessor(u){const N=(this[ph]=this[ph]={accessors:{}}).accessors,A=this.prototype;function z(j){const q=vn(j);N[q]||(Ep(A,j),N[q]=!0)}return it.isArray(u)?u.forEach(z):z(u),this}}Qe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);it.reduceDescriptors(Qe.prototype,({value:w},u)=>{let v=u[0].toUpperCase()+u.slice(1);return{get:()=>w,set(N){this[v]=N}}});it.freezeMethods(Qe);function Sr(w,u){const v=this||On,N=u||v,A=Qe.from(N.headers);let z=N.data;return it.forEach(w,function(q){z=q.call(v,z,A.normalize(),u?u.status:void 0)}),A.normalize(),z}function Gl(w){return!!(w&&w.__CANCEL__)}function sn(w,u,v){Wt.call(this,w??"canceled",Wt.ERR_CANCELED,u,v),this.name="CanceledError"}it.inherits(sn,Wt,{__CANCEL__:!0});function Hl(w,u,v){const N=v.config.validateStatus;!v.status||!N||N(v.status)?w(v):u(new Wt("Request failed with status code "+v.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(v.status/100)-4],v.config,v.request,v))}function Op(w){const u=/^([-+\w]{1,25})(:?\/\/|:)/.exec(w);return u&&u[1]||""}function Rp(w,u){w=w||10;const v=new Array(w),N=new Array(w);let A=0,z=0,j;return u=u!==void 0?u:1e3,function(Y){const Q=Date.now(),I=N[z];j||(j=Q),v[A]=Y,N[A]=Q;let pt=z,Lt=0;for(;pt!==A;)Lt+=v[pt++],pt=pt%w;if(A=(A+1)%w,A===z&&(z=(z+1)%w),Q-j<u)return;const Rt=I&&Q-I;return Rt?Math.round(Lt*1e3/Rt):void 0}}function Fp(w,u){let v=0,N=1e3/u,A,z;const j=(Q,I=Date.now())=>{v=I,A=null,z&&(clearTimeout(z),z=null),w(...Q)};return[(...Q)=>{const I=Date.now(),pt=I-v;pt>=N?j(Q,I):(A=Q,z||(z=setTimeout(()=>{z=null,j(A)},N-pt)))},()=>A&&j(A)]}const co=(w,u,v=3)=>{let N=0;const A=Rp(50,250);return Fp(z=>{const j=z.loaded,q=z.lengthComputable?z.total:void 0,Y=j-N,Q=A(Y),I=j<=q;N=j;const pt={loaded:j,total:q,progress:q?j/q:void 0,bytes:Y,rate:Q||void 0,estimated:Q&&q&&I?(q-j)/Q:void 0,event:z,lengthComputable:q!=null,[u?"download":"upload"]:!0};w(pt)},v)},yh=(w,u)=>{const v=w!=null;return[N=>u[0]({lengthComputable:v,total:w,loaded:N}),u[1]]},xh=w=>(...u)=>it.asap(()=>w(...u)),Ip=Be.hasStandardBrowserEnv?((w,u)=>v=>(v=new URL(v,Be.origin),w.protocol===v.protocol&&w.host===v.host&&(u||w.port===v.port)))(new URL(Be.origin),Be.navigator&&/(msie|trident)/i.test(Be.navigator.userAgent)):()=>!0,Bp=Be.hasStandardBrowserEnv?{write(w,u,v,N,A,z){const j=[w+"="+encodeURIComponent(u)];it.isNumber(v)&&j.push("expires="+new Date(v).toGMTString()),it.isString(N)&&j.push("path="+N),it.isString(A)&&j.push("domain="+A),z===!0&&j.push("secure"),document.cookie=j.join("; ")},read(w){const u=document.cookie.match(new RegExp("(^|;\\s*)("+w+")=([^;]*)"));return u?decodeURIComponent(u[3]):null},remove(w){this.write(w,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vp(w){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(w)}function zp(w,u){return u?w.replace(/\/?\/$/,"")+"/"+u.replace(/^\/+/,""):w}function ql(w,u,v){let N=!Vp(u);return w&&(N||v==!1)?zp(w,u):u}const wh=w=>w instanceof Qe?{...w}:w;function Ss(w,u){u=u||{};const v={};function N(Q,I,pt,Lt){return it.isPlainObject(Q)&&it.isPlainObject(I)?it.merge.call({caseless:Lt},Q,I):it.isPlainObject(I)?it.merge({},I):it.isArray(I)?I.slice():I}function A(Q,I,pt,Lt){if(it.isUndefined(I)){if(!it.isUndefined(Q))return N(void 0,Q,pt,Lt)}else return N(Q,I,pt,Lt)}function z(Q,I){if(!it.isUndefined(I))return N(void 0,I)}function j(Q,I){if(it.isUndefined(I)){if(!it.isUndefined(Q))return N(void 0,Q)}else return N(void 0,I)}function q(Q,I,pt){if(pt in u)return N(Q,I);if(pt in w)return N(void 0,Q)}const Y={url:z,method:z,data:z,baseURL:j,transformRequest:j,transformResponse:j,paramsSerializer:j,timeout:j,timeoutMessage:j,withCredentials:j,withXSRFToken:j,adapter:j,responseType:j,xsrfCookieName:j,xsrfHeaderName:j,onUploadProgress:j,onDownloadProgress:j,decompress:j,maxContentLength:j,maxBodyLength:j,beforeRedirect:j,transport:j,httpAgent:j,httpsAgent:j,cancelToken:j,socketPath:j,responseEncoding:j,validateStatus:q,headers:(Q,I,pt)=>A(wh(Q),wh(I),pt,!0)};return it.forEach(Object.keys({...w,...u}),function(I){const pt=Y[I]||A,Lt=pt(w[I],u[I],I);it.isUndefined(Lt)&&pt!==q||(v[I]=Lt)}),v}const $l=w=>{const u=Ss({},w);let{data:v,withXSRFToken:N,xsrfHeaderName:A,xsrfCookieName:z,headers:j,auth:q}=u;if(u.headers=j=Qe.from(j),u.url=Ul(ql(u.baseURL,u.url,u.allowAbsoluteUrls),w.params,w.paramsSerializer),q&&j.set("Authorization","Basic "+btoa((q.username||"")+":"+(q.password?unescape(encodeURIComponent(q.password)):""))),it.isFormData(v)){if(Be.hasStandardBrowserEnv||Be.hasStandardBrowserWebWorkerEnv)j.setContentType(void 0);else if(it.isFunction(v.getHeaders)){const Y=v.getHeaders(),Q=["content-type","content-length"];Object.entries(Y).forEach(([I,pt])=>{Q.includes(I.toLowerCase())&&j.set(I,pt)})}}if(Be.hasStandardBrowserEnv&&(N&&it.isFunction(N)&&(N=N(u)),N||N!==!1&&Ip(u.url))){const Y=A&&z&&Bp.read(z);Y&&j.set(A,Y)}return u},jp=typeof XMLHttpRequest<"u",Kp=jp&&function(w){return new Promise(function(v,N){const A=$l(w);let z=A.data;const j=Qe.from(A.headers).normalize();let{responseType:q,onUploadProgress:Y,onDownloadProgress:Q}=A,I,pt,Lt,Rt,at;function xt(){Rt&&Rt(),at&&at(),A.cancelToken&&A.cancelToken.unsubscribe(I),A.signal&&A.signal.removeEventListener("abort",I)}let Z=new XMLHttpRequest;Z.open(A.method.toUpperCase(),A.url,!0),Z.timeout=A.timeout;function C(){if(!Z)return;const G=Qe.from("getAllResponseHeaders"in Z&&Z.getAllResponseHeaders()),U={data:!q||q==="text"||q==="json"?Z.responseText:Z.response,status:Z.status,statusText:Z.statusText,headers:G,config:w,request:Z};Hl(function(O){v(O),xt()},function(O){N(O),xt()},U),Z=null}"onloadend"in Z?Z.onloadend=C:Z.onreadystatechange=function(){!Z||Z.readyState!==4||Z.status===0&&!(Z.responseURL&&Z.responseURL.indexOf("file:")===0)||setTimeout(C)},Z.onabort=function(){Z&&(N(new Wt("Request aborted",Wt.ECONNABORTED,w,Z)),Z=null)},Z.onerror=function(wt){const U=wt&&wt.message?wt.message:"Network Error",Pt=new Wt(U,Wt.ERR_NETWORK,w,Z);Pt.event=wt||null,N(Pt),Z=null},Z.ontimeout=function(){let wt=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded";const U=A.transitional||Yl;A.timeoutErrorMessage&&(wt=A.timeoutErrorMessage),N(new Wt(wt,U.clarifyTimeoutError?Wt.ETIMEDOUT:Wt.ECONNABORTED,w,Z)),Z=null},z===void 0&&j.setContentType(null),"setRequestHeader"in Z&&it.forEach(j.toJSON(),function(wt,U){Z.setRequestHeader(U,wt)}),it.isUndefined(A.withCredentials)||(Z.withCredentials=!!A.withCredentials),q&&q!=="json"&&(Z.responseType=A.responseType),Q&&([Lt,at]=co(Q,!0),Z.addEventListener("progress",Lt)),Y&&Z.upload&&([pt,Rt]=co(Y),Z.upload.addEventListener("progress",pt),Z.upload.addEventListener("loadend",Rt)),(A.cancelToken||A.signal)&&(I=G=>{Z&&(N(!G||G.type?new sn(null,w,Z):G),Z.abort(),Z=null)},A.cancelToken&&A.cancelToken.subscribe(I),A.signal&&(A.signal.aborted?I():A.signal.addEventListener("abort",I)));const rt=Op(A.url);if(rt&&Be.protocols.indexOf(rt)===-1){N(new Wt("Unsupported protocol "+rt+":",Wt.ERR_BAD_REQUEST,w));return}Z.send(z||null)})},Up=(w,u)=>{const{length:v}=w=w?w.filter(Boolean):[];if(u||v){let N=new AbortController,A;const z=function(Q){if(!A){A=!0,q();const I=Q instanceof Error?Q:this.reason;N.abort(I instanceof Wt?I:new sn(I instanceof Error?I.message:I))}};let j=u&&setTimeout(()=>{j=null,z(new Wt(`timeout ${u} of ms exceeded`,Wt.ETIMEDOUT))},u);const q=()=>{w&&(j&&clearTimeout(j),j=null,w.forEach(Q=>{Q.unsubscribe?Q.unsubscribe(z):Q.removeEventListener("abort",z)}),w=null)};w.forEach(Q=>Q.addEventListener("abort",z));const{signal:Y}=N;return Y.unsubscribe=()=>it.asap(q),Y}},Yp=function*(w,u){let v=w.byteLength;if(v<u){yield w;return}let N=0,A;for(;N<v;)A=N+u,yield w.slice(N,A),N=A},Xp=async function*(w,u){for await(const v of Gp(w))yield*Yp(v,u)},Gp=async function*(w){if(w[Symbol.asyncIterator]){yield*w;return}const u=w.getReader();try{for(;;){const{done:v,value:N}=await u.read();if(v)break;yield N}}finally{await u.cancel()}},bh=(w,u,v,N)=>{const A=Xp(w,u);let z=0,j,q=Y=>{j||(j=!0,N&&N(Y))};return new ReadableStream({async pull(Y){try{const{done:Q,value:I}=await A.next();if(Q){q(),Y.close();return}let pt=I.byteLength;if(v){let Lt=z+=pt;v(Lt)}Y.enqueue(new Uint8Array(I))}catch(Q){throw q(Q),Q}},cancel(Y){return q(Y),A.return()}},{highWaterMark:2})},vh=64*1024,{isFunction:to}=it,Hp=(({Request:w,Response:u})=>({Request:w,Response:u}))(it.global),{ReadableStream:Sh,TextEncoder:kh}=it.global,Ph=(w,...u)=>{try{return!!w(...u)}catch{return!1}},qp=w=>{w=it.merge.call({skipUndefined:!0},Hp,w);const{fetch:u,Request:v,Response:N}=w,A=u?to(u):typeof fetch=="function",z=to(v),j=to(N);if(!A)return!1;const q=A&&to(Sh),Y=A&&(typeof kh=="function"?(at=>xt=>at.encode(xt))(new kh):async at=>new Uint8Array(await new v(at).arrayBuffer())),Q=z&&q&&Ph(()=>{let at=!1;const xt=new v(Be.origin,{body:new Sh,method:"POST",get duplex(){return at=!0,"half"}}).headers.has("Content-Type");return at&&!xt}),I=j&&q&&Ph(()=>it.isReadableStream(new N("").body)),pt={stream:I&&(at=>at.body)};A&&["text","arrayBuffer","blob","formData","stream"].forEach(at=>{!pt[at]&&(pt[at]=(xt,Z)=>{let C=xt&&xt[at];if(C)return C.call(xt);throw new Wt(`Response type '${at}' is not supported`,Wt.ERR_NOT_SUPPORT,Z)})});const Lt=async at=>{if(at==null)return 0;if(it.isBlob(at))return at.size;if(it.isSpecCompliantForm(at))return(await new v(Be.origin,{method:"POST",body:at}).arrayBuffer()).byteLength;if(it.isArrayBufferView(at)||it.isArrayBuffer(at))return at.byteLength;if(it.isURLSearchParams(at)&&(at=at+""),it.isString(at))return(await Y(at)).byteLength},Rt=async(at,xt)=>{const Z=it.toFiniteNumber(at.getContentLength());return Z??Lt(xt)};return async at=>{let{url:xt,method:Z,data:C,signal:rt,cancelToken:G,timeout:wt,onDownloadProgress:U,onUploadProgress:Pt,responseType:O,headers:ee,withCredentials:re="same-origin",fetchOptions:Tt}=$l(at),Gt=u||fetch;O=O?(O+"").toLowerCase():"text";let we=Up([rt,G&&G.toAbortSignal()],wt),Mt=null;const de=we&&we.unsubscribe&&(()=>{we.unsubscribe()});let Ve;try{if(Pt&&Q&&Z!=="get"&&Z!=="head"&&(Ve=await Rt(ee,C))!==0){let je=new v(xt,{method:"POST",body:C,duplex:"half"}),Ke;if(it.isFormData(C)&&(Ke=je.headers.get("content-type"))&&ee.setContentType(Ke),je.body){const[Pe,Ne]=yh(Ve,co(xh(Pt)));C=bh(je.body,vh,Pe,Ne)}}it.isString(re)||(re=re?"include":"omit");const ie=z&&"credentials"in v.prototype,be={...Tt,signal:we,method:Z.toUpperCase(),headers:ee.normalize().toJSON(),body:C,duplex:"half",credentials:ie?re:void 0};Mt=z&&new v(xt,be);let Te=await(z?Gt(Mt,Tt):Gt(xt,be));const ze=I&&(O==="stream"||O==="response");if(I&&(U||ze&&de)){const je={};["status","statusText","headers"].forEach(Ue=>{je[Ue]=Te[Ue]});const Ke=it.toFiniteNumber(Te.headers.get("content-length")),[Pe,Ne]=U&&yh(Ke,co(xh(U),!0))||[];Te=new N(bh(Te.body,vh,Pe,()=>{Ne&&Ne(),de&&de()}),je)}O=O||"text";let ve=await pt[it.findKey(pt,O)||"text"](Te,at);return!ze&&de&&de(),await new Promise((je,Ke)=>{Hl(je,Ke,{data:ve,headers:Qe.from(Te.headers),status:Te.status,statusText:Te.statusText,config:at,request:Mt})})}catch(ie){throw de&&de(),ie&&ie.name==="TypeError"&&/Load failed|fetch/i.test(ie.message)?Object.assign(new Wt("Network Error",Wt.ERR_NETWORK,at,Mt),{cause:ie.cause||ie}):Wt.from(ie,ie&&ie.code,at,Mt)}}},$p=new Map,Wl=w=>{let u=w?w.env:{};const{fetch:v,Request:N,Response:A}=u,z=[N,A,v];let j=z.length,q=j,Y,Q,I=$p;for(;q--;)Y=z[q],Q=I.get(Y),Q===void 0&&I.set(Y,Q=q?new Map:qp(u)),I=Q;return Q};Wl();const Fr={http:cp,xhr:Kp,fetch:{get:Wl}};it.forEach(Fr,(w,u)=>{if(w){try{Object.defineProperty(w,"name",{value:u})}catch{}Object.defineProperty(w,"adapterName",{value:u})}});const Mh=w=>`- ${w}`,Wp=w=>it.isFunction(w)||w===null||w===!1,Jl={getAdapter:(w,u)=>{w=it.isArray(w)?w:[w];const{length:v}=w;let N,A;const z={};for(let j=0;j<v;j++){N=w[j];let q;if(A=N,!Wp(N)&&(A=Fr[(q=String(N)).toLowerCase()],A===void 0))throw new Wt(`Unknown adapter '${q}'`);if(A&&(it.isFunction(A)||(A=A.get(u))))break;z[q||"#"+j]=A}if(!A){const j=Object.entries(z).map(([Y,Q])=>`adapter ${Y} `+(Q===!1?"is not supported by the environment":"is not available in the build"));let q=v?j.length>1?`since :
`+j.map(Mh).join(`
`):" "+Mh(j[0]):"as no adapter specified";throw new Wt("There is no suitable adapter to dispatch the request "+q,"ERR_NOT_SUPPORT")}return A},adapters:Fr};function kr(w){if(w.cancelToken&&w.cancelToken.throwIfRequested(),w.signal&&w.signal.aborted)throw new sn(null,w)}function Nh(w){return kr(w),w.headers=Qe.from(w.headers),w.data=Sr.call(w,w.transformRequest),["post","put","patch"].indexOf(w.method)!==-1&&w.headers.setContentType("application/x-www-form-urlencoded",!1),Jl.getAdapter(w.adapter||On.adapter,w)(w).then(function(N){return kr(w),N.data=Sr.call(w,w.transformResponse,N),N.headers=Qe.from(N.headers),N},function(N){return Gl(N)||(kr(w),N&&N.response&&(N.response.data=Sr.call(w,w.transformResponse,N.response),N.response.headers=Qe.from(N.response.headers))),Promise.reject(N)})}const _l="1.12.2",Mo={};["object","boolean","number","function","string","symbol"].forEach((w,u)=>{Mo[w]=function(N){return typeof N===w||"a"+(u<1?"n ":" ")+w}});const Ch={};Mo.transitional=function(u,v,N){function A(z,j){return"[Axios v"+_l+"] Transitional option '"+z+"'"+j+(N?". "+N:"")}return(z,j,q)=>{if(u===!1)throw new Wt(A(j," has been removed"+(v?" in "+v:"")),Wt.ERR_DEPRECATED);return v&&!Ch[j]&&(Ch[j]=!0,console.warn(A(j," has been deprecated since v"+v+" and will be removed in the near future"))),u?u(z,j,q):!0}};Mo.spelling=function(u){return(v,N)=>(console.warn(`${N} is likely a misspelling of ${u}`),!0)};function Jp(w,u,v){if(typeof w!="object")throw new Wt("options must be an object",Wt.ERR_BAD_OPTION_VALUE);const N=Object.keys(w);let A=N.length;for(;A-- >0;){const z=N[A],j=u[z];if(j){const q=w[z],Y=q===void 0||j(q,z,w);if(Y!==!0)throw new Wt("option "+z+" must be "+Y,Wt.ERR_BAD_OPTION_VALUE);continue}if(v!==!0)throw new Wt("Unknown option "+z,Wt.ERR_BAD_OPTION)}}const ro={assertOptions:Jp,validators:Mo},Di=ro.validators;class ws{constructor(u){this.defaults=u||{},this.interceptors={request:new mh,response:new mh}}async request(u,v){try{return await this._request(u,v)}catch(N){if(N instanceof Error){let A={};Error.captureStackTrace?Error.captureStackTrace(A):A=new Error;const z=A.stack?A.stack.replace(/^.+\n/,""):"";try{N.stack?z&&!String(N.stack).endsWith(z.replace(/^.+\n.+\n/,""))&&(N.stack+=`
`+z):N.stack=z}catch{}}throw N}}_request(u,v){typeof u=="string"?(v=v||{},v.url=u):v=u||{},v=Ss(this.defaults,v);const{transitional:N,paramsSerializer:A,headers:z}=v;N!==void 0&&ro.assertOptions(N,{silentJSONParsing:Di.transitional(Di.boolean),forcedJSONParsing:Di.transitional(Di.boolean),clarifyTimeoutError:Di.transitional(Di.boolean)},!1),A!=null&&(it.isFunction(A)?v.paramsSerializer={serialize:A}:ro.assertOptions(A,{encode:Di.function,serialize:Di.function},!0)),v.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?v.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:v.allowAbsoluteUrls=!0),ro.assertOptions(v,{baseUrl:Di.spelling("baseURL"),withXsrfToken:Di.spelling("withXSRFToken")},!0),v.method=(v.method||this.defaults.method||"get").toLowerCase();let j=z&&it.merge(z.common,z[v.method]);z&&it.forEach(["delete","get","head","post","put","patch","common"],at=>{delete z[at]}),v.headers=Qe.concat(j,z);const q=[];let Y=!0;this.interceptors.request.forEach(function(xt){typeof xt.runWhen=="function"&&xt.runWhen(v)===!1||(Y=Y&&xt.synchronous,q.unshift(xt.fulfilled,xt.rejected))});const Q=[];this.interceptors.response.forEach(function(xt){Q.push(xt.fulfilled,xt.rejected)});let I,pt=0,Lt;if(!Y){const at=[Nh.bind(this),void 0];for(at.unshift(...q),at.push(...Q),Lt=at.length,I=Promise.resolve(v);pt<Lt;)I=I.then(at[pt++],at[pt++]);return I}Lt=q.length;let Rt=v;for(;pt<Lt;){const at=q[pt++],xt=q[pt++];try{Rt=at(Rt)}catch(Z){xt.call(this,Z);break}}try{I=Nh.call(this,Rt)}catch(at){return Promise.reject(at)}for(pt=0,Lt=Q.length;pt<Lt;)I=I.then(Q[pt++],Q[pt++]);return I}getUri(u){u=Ss(this.defaults,u);const v=ql(u.baseURL,u.url,u.allowAbsoluteUrls);return Ul(v,u.params,u.paramsSerializer)}}it.forEach(["delete","get","head","options"],function(u){ws.prototype[u]=function(v,N){return this.request(Ss(N||{},{method:u,url:v,data:(N||{}).data}))}});it.forEach(["post","put","patch"],function(u){function v(N){return function(z,j,q){return this.request(Ss(q||{},{method:u,headers:N?{"Content-Type":"multipart/form-data"}:{},url:z,data:j}))}}ws.prototype[u]=v(),ws.prototype[u+"Form"]=v(!0)});class na{constructor(u){if(typeof u!="function")throw new TypeError("executor must be a function.");let v;this.promise=new Promise(function(z){v=z});const N=this;this.promise.then(A=>{if(!N._listeners)return;let z=N._listeners.length;for(;z-- >0;)N._listeners[z](A);N._listeners=null}),this.promise.then=A=>{let z;const j=new Promise(q=>{N.subscribe(q),z=q}).then(A);return j.cancel=function(){N.unsubscribe(z)},j},u(function(z,j,q){N.reason||(N.reason=new sn(z,j,q),v(N.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(u){if(this.reason){u(this.reason);return}this._listeners?this._listeners.push(u):this._listeners=[u]}unsubscribe(u){if(!this._listeners)return;const v=this._listeners.indexOf(u);v!==-1&&this._listeners.splice(v,1)}toAbortSignal(){const u=new AbortController,v=N=>{u.abort(N)};return this.subscribe(v),u.signal.unsubscribe=()=>this.unsubscribe(v),u.signal}static source(){let u;return{token:new na(function(A){u=A}),cancel:u}}}function _p(w){return function(v){return w.apply(null,v)}}function Zp(w){return it.isObject(w)&&w.isAxiosError===!0}const Ir={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ir).forEach(([w,u])=>{Ir[u]=w});function Zl(w){const u=new ws(w),v=Ll(ws.prototype.request,u);return it.extend(v,ws.prototype,u,{allOwnKeys:!0}),it.extend(v,u,null,{allOwnKeys:!0}),v.create=function(A){return Zl(Ss(w,A))},v}const Ce=Zl(On);Ce.Axios=ws;Ce.CanceledError=sn;Ce.CancelToken=na;Ce.isCancel=Gl;Ce.VERSION=_l;Ce.toFormData=Po;Ce.AxiosError=Wt;Ce.Cancel=Ce.CanceledError;Ce.all=function(u){return Promise.all(u)};Ce.spread=_p;Ce.isAxiosError=Zp;Ce.mergeConfig=Ss;Ce.AxiosHeaders=Qe;Ce.formToJSON=w=>Xl(it.isHTMLForm(w)?new FormData(w):w);Ce.getAdapter=Jl.getAdapter;Ce.HttpStatusCode=Ir;Ce.default=Ce;window.axios=Ce;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";(function(){const w=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};w.requestAnimationFrame===void 0&&(w.setImmediate===void 0?w.requestAnimationFrame=S=>w.setTimeout(S,0):w.requestAnimationFrame=w.setImmediate);const ge=class ge{static Rk(e,t,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&ge.Tg(s),s=ge.ir(()=>{s=-1,i||e.apply(n,o)},t),i&&!s&&e.apply(n,o)}}static ir(e,t){return w.setTimeout(e,t)}static Tg(e){w.clearTimeout(e)}static hs(e){return w.document.createElement(e)}static o(e){throw new Error(e)}static L(e,t){let i="The object is frozen, so its properties cannot be set: "+e.toString();t!==void 0&&(i+="  to value: "+t),ge.o(i)}static dE(e,t,i,s){}static s(e,t,i,s){}static gE(e,t,i){}static ec(e,t,i){(e===null||typeof e!="object")&&ge.fC(t)}static k(e,t,i){}static mE(e,t,i){}static Zi(e,t,i,s){}static W(e,t,i,s){let n=ge.fC(i);s!==void 0&&(n+="."+s),ge.o(n+" is not in the range "+t+": "+e)}static Re(e){}static er(e,t){}static ni(e){w.console&&w.console.log(e)}static G(e){return e!==null&&typeof e=="object"}static it(e){return typeof e=="function"}static et(){const e=ge.vk.pop();return e===void 0?[]:e}static J(e){e.length=0,ge.vk.push(e)}static fC(e){return e===null?"*":typeof e=="string"?e:ge.it(e)?e.name:""}static Dn(e){return ge.it(e)?e.className?e.className:e.name:ge.G(e)&&e.constructor?ge.Dn(e.constructor):typeof e}static Uh(e,t){return t==null||t===""?null:ge.G(e)&&t in e||e[t]?e[t]:null}static toString(e){let t=e;return ge.G(e)&&(e.text?t=e.text:e.name?t=e.name:e.key!==void 0?t=e.key:e.id!==void 0?t=e.id:e.constructor===Object&&(e.Text?t=e.Text:e.Name?t=e.Name:e.Key!==void 0?t=e.Key:e.Id!==void 0?t=e.Id:e.ID!==void 0&&(t=e.ID))),t===void 0?"undefined":t===null?"null":t.toString()}static gw(e,t){if(e.hasOwnProperty(t))return!0;let i=Object.getPrototypeOf(e);for(;i&&i!==Function;){if(i.hasOwnProperty(t))return!0;const s=i.yE;if(s&&s[t])return!0;i=Object.getPrototypeOf(i)}return!1}static WD(e){const t=[];let i=0;for(i=0;i<256;i++)t[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+t[i]+119)%256,n=t[i],t[i]=t[s],t[s]=n;i=0,s=0;let o="";for(let r=0;r<e.length;r++)i=(i+1)%256,s=(s+t[i])%256,n=t[i],t[i]=t[s],t[s]=n,o+=String.fromCharCode(e.charCodeAt(r)^t[(t[i]+t[s])%256]);return o}static JD(e){const t="0123456789abcdef",i=[];for(let r=0;r<256;r++)i[t.charAt(r>>4)+t.charAt(r&15)]=String.fromCharCode(r);e.length%2&&(e="0"+e);const s=[];let n=0;for(let r=0;r<e.length;r+=2)s[n++]=i[e.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static Ts(e){return ge.WD(ge.JD(e))}};g(ge,"tr",w.navigator!==void 0&&w.navigator.platform!==void 0&&w.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null),g(ge,"vk",[]),g(ge,"pE",Object.freeze([])),g(ge,"color1","@COLOR1"),g(ge,"color2","@COLOR2"),g(ge,"mw","32ab5ff3b26f42dc0ed90f21412913b5");let u=ge;u.vfo="29e646fdb160";class v{constructor(){g(this,"Ok");this.Ok=[]}toString(){return this.Ok.join("")}add(e){e!==""&&this.Ok.push(e)}}class N{}const Xn=class Xn{constructor(){g(this,"g");g(this,"key");g(this,"value");this.g=[]}[Symbol.iterator](){return this.g.values()}get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(e){return this}filter(){return this}get count(){return 0}ul(){}toString(){return"EmptyIterator"}};g(Xn,"instance",new Xn);let A=Xn;class z{constructor(e){g(this,"key");g(this,"value");this.key=-1,this.value=e}[Symbol.iterator](){return[this.value].values()}get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(e){return this.key=-1,e(this.value)}all(e){return this.key=-1,e(this.value)}each(e){return this.key=-1,e(this.value),this}map(e){return new z(e(this.value))}filter(e){return e(this.value)?new z(this.value):A.instance}get count(){return 1}ul(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class j{constructor(e){g(this,"qt");g(this,"Ds");g(this,"Gt");g(this,"At");g(this,"key");g(this,"value");this.qt=e,this.Ds=null,e.sr=null,this.Gt=e.nt,this.At=-1}[Symbol.iterator](){return this.Ds===null?this.qt.r.values():this.qt.r.filter(this.Ds).values()}get iterator(){return this}get predicate(){return this.Ds}set predicate(e){this.Ds=e}reset(){const e=this.qt;e.sr=null,this.Gt=e.nt,this.At=-1}next(){const e=this.qt;if(e.nt!==this.Gt&&this.key<0)return!1;const t=e.r,i=t.length;let s=++this.At;const n=this.Ds;if(n!==null)for(;s<i;){const o=t[s];if(n(o))return this.At=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=t[s],!0;this.ul()}return!1}hasNext(){return this.next()}first(){const e=this.qt;this.Gt=e.nt,this.At=0;const t=e.r,i=t.length,s=this.Ds;if(s!==null){let n=0;for(;n<i;){const o=t[n];if(s(o))return this.At=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=t[0];return this.key=0,this.value=n,n}else return null}any(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(e(a))return!0;t.nt!==i&&u.Re(t)}}return!1}all(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const a=s[r];if(!(o!==null&&!o(a))){if(!e(a))return!1;t.nt!==i&&u.Re(t)}}return!0}each(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=t.r,n=s.length,o=this.Ds;for(let r=0;r<n;r++){const a=s[r];o!==null&&!o(a)||(e(a),t.nt!==i&&u.Re(t))}return this}map(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=[],n=t.r,o=n.length,r=this.Ds;for(let h=0;h<o;h++){const l=n[h];r!==null&&!r(l)||(s.push(e(l)),t.nt!==i&&u.Re(t))}const a=new Y;return a.r=s,a.ve(),a.iterator}filter(e){const t=this.qt;t.sr=null;const i=t.nt;this.At=-1;const s=[],n=t.r,o=n.length,r=this.Ds;for(let h=0;h<o;h++){const l=n[h];r!==null&&!r(l)||(e(l)&&s.push(l),t.nt!==i&&u.Re(t))}const a=new Y;return a.r=s,a.ve(),a.iterator}get count(){const e=this.Ds;if(e!==null){let t=0;const i=this.qt.r,s=i.length;for(let n=0;n<s;n++)e(i[n])&&t++;return t}else return this.qt.r.length}ul(){this.key=-1,this.value=null,this.Gt=-1,this.Ds=null,this.qt.sr=this}toString(){return"ListIterator@"+this.At+"/"+this.qt.count}}class q{constructor(e){g(this,"qt");g(this,"Gt");g(this,"At");g(this,"key");g(this,"value");this.qt=e,e.nr=null,this.Gt=e.nt,this.At=e.r.length}[Symbol.iterator](){return this.qt.r.reverse().values()}get iterator(){return this}reset(){const e=this.qt;e.nr=null,this.Gt=e.nt,this.At=e.r.length}next(){const e=this.qt;if(e.nt!==this.Gt&&this.key<0)return!1;const t=--this.At;return t>=0?(this.key=t,this.value=e.r[t],!0):(this.ul(),!1)}hasNext(){return this.next()}first(){const e=this.qt;this.Gt=e.nt;const t=e.r,i=t.length-1;if(this.At=i,i>=0){const s=t[i];return this.key=i,this.value=s,s}else return null}any(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];if(e(r))return!0;t.nt!==i&&u.Re(t)}return!1}all(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!e(r))return!1;t.nt!==i&&u.Re(t)}return!0}each(e){const t=this.qt;t.nr=null;const i=t.nt,s=t.r,n=s.length;this.At=n;for(let o=n-1;o>=0;o--){const r=s[o];e(r),t.nt!==i&&u.Re(t)}return this}map(e){const t=this.qt;t.nr=null;const i=t.nt,s=[],n=t.r,o=n.length;this.At=o;for(let a=o-1;a>=0;a--){const h=n[a];s.push(e(h)),t.nt!==i&&u.Re(t)}const r=new Y;return r.r=s,r.ve(),r.iterator}filter(e){const t=this.qt;t.nr=null;const i=t.nt,s=[],n=t.r,o=n.length;this.At=o;for(let a=o-1;a>=0;a--){const h=n[a];e(h)&&s.push(h),t.nt!==i&&u.Re(t)}const r=new Y;return r.r=s,r.ve(),r.iterator}get count(){return this.qt.r.length}ul(){this.key=-1,this.value=null,this.Gt=-1,this.qt.nr=this}toString(){return"ListIteratorBackwards("+this.At+"/"+this.qt.count+")"}}class Y{constructor(e){g(this,"h");g(this,"r");g(this,"nt");g(this,"sr");g(this,"nr");I.Ki(this),this.h=!1,this.r=[],this.nt=0,this.sr=null,this.nr=null,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.r.values()}ve(){let e=this.nt;e++,e>999999999&&(e=0),this.nt=e}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"List()#"+I.as(this)}add(e){return this.h&&u.L(this,e),this.r.push(e),this.ve(),this}push(e){this.add(e)}addAll(e){if(e===null)return this;this.h&&u.L(this);const t=this.r;if(Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t.push(n)}}else{const i=e.iterator;for(;i.next();){const s=i.value;t.push(s)}}return this.ve(),this}clear(){this.h&&u.L(this),this.r.length=0,this.ve()}contains(e){return this.has(e)}has(e){return e===null?!1:this.r.indexOf(e)!==-1}indexOf(e){return e===null?-1:this.r.indexOf(e)}elt(e){const t=this.r;return(e<0||e>=t.length)&&u.W(e,"0 <= i < length",Y,"elt:i"),t[e]}get(e){return this.elt(e)}setElt(e,t){const i=this.r;(e<0||e>=i.length)&&u.W(e,"0 <= i < length",Y,"setElt:i"),this.h&&u.L(this,e),i[e]=t}set(e,t){this.setElt(e,t)}first(){const e=this.r;return e.length===0?null:e[0]}last(){const e=this.r,t=e.length;return t>0?e[t-1]:null}pop(){this.h&&u.L(this);const e=this.r;return e.length>0?e.pop():null}any(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++){if(e(t[n]))return!0;this.nt!==i&&u.Re(this)}return!1}all(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++){if(!e(t[n]))return!1;this.nt!==i&&u.Re(this)}return!0}each(e){const t=this.r,i=this.nt,s=t.length;for(let n=0;n<s;n++)e(t[n]),this.nt!==i&&u.Re(this);return this}map(e){const t=new Y,i=[],s=this.r,n=this.nt,o=s.length;for(let r=0;r<o;r++)i.push(e(s[r])),this.nt!==n&&u.Re(this);return t.r=i,t.ve(),t}filter(e){const t=new Y,i=[],s=this.r,n=this.nt,o=s.length;for(let r=0;r<o;r++){const a=s[r];e(a)&&i.push(a),this.nt!==n&&u.Re(this)}return t.r=i,t.ve(),t}insertAt(e,t){e<0&&u.W(e,">= 0",Y,"insertAt:i"),this.h&&u.L(this,e);const i=this.r;e>=i.length?i.push(t):i.splice(e,0,t),this.ve()}remove(e){return this.delete(e)}delete(e){if(e===null)return!1;this.h&&u.L(this,e);const t=this.r,i=t.indexOf(e);return i===-1?!1:(i===t.length-1?t.pop():t.splice(i,1),this.ve(),!0)}removeAt(e){const t=this.r;(e<0||e>=t.length)&&u.W(e,"0 <= i < length",Y,"removeAt:i"),this.h&&u.L(this,e),e===t.length-1?t.pop():t.splice(e,1),this.ve()}removeRange(e,t){const i=this.r,s=i.length;if(e<0)e=0;else if(e>=s)return this;if(t<0)return this;if(t>=s&&(t=s-1),e>t)return this;this.h&&u.L(this);let n=e,o=t+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(t-e+1),this.ve(),this}copy(){const e=new Y,t=this.r;return t.length>0&&(e.r=Array.prototype.slice.call(t)),e}toArray(){const e=this.r,t=this.count,i=new Array(t);for(let s=0;s<t;s++)i[s]=e[s];return i}get uC(){return this.r}toSet(){const e=new I,t=this.r,i=this.count;for(let s=0;s<i;s++)e.add(t[s]);return e}sort(e){return this.h&&u.L(this),this.r.sort(e),this.ve(),this}sortRange(e,t,i){const s=this.r,n=s.length;t===void 0&&(t=0),i===void 0&&(i=n),this.h&&u.L(this);const o=i-t;if(o<=1)return this;if((t<0||t>=n-1)&&u.W(t,"0 <= from < length",Y,"sortRange:from"),o===2){const r=s[t],a=s[t+1];return e(r,a)>0&&(s[t]=a,s[t+1]=r,this.ve()),this}if(t===0)if(i>=n)s.sort(e);else{const r=s.slice(0,i);r.sort(e);for(let a=0;a<i;a++)s[a]=r[a]}else if(i>=n){const r=s.slice(t);r.sort(e);for(let a=t;a<n;a++)s[a]=r[a-t]}else{const r=s.slice(t,i);r.sort(e);for(let a=t;a<i;a++)s[a]=r[a-t]}return this.ve(),this}reverse(){return this.h&&u.L(this),this.r.reverse(),this.ve(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return A.instance;const e=this.sr;return e!==null?(e.reset(),e):new j(this)}get iteratorBackwards(){if(this.r.length<=0)return A.instance;const e=this.nr;return e!==null?(e.reset(),e):new q(this)}}class Q{constructor(e){g(this,"wo");g(this,"ii");g(this,"key");g(this,"value");this.wo=e,this.ii=e.g.values()}[Symbol.iterator](){return this.wo.g.values()}get iterator(){return this}reset(){const e=this.wo;this.ii=e.g.values()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.wo.g.size===0?null:(this.ii=this.wo.g.values(),this.ii.next().value)}any(e){return this.wo.any(e)}all(e){return this.wo.all(e)}each(e){return this.wo.each(e),this}map(e){const t=new Y;return this.wo.g.forEach(i=>t.add(e(i))),t.iterator}filter(e){const t=new Y;return this.wo.g.forEach(i=>{e(i)&&t.add(i)}),t.iterator}get count(){return this.wo.count}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"SetIterator"}}const zi=class zi{constructor(e){g(this,"h");g(this,"g");this.h=!1,this.g=new Set,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"Set()#"+zi.as(this)}add(e){return e===null?this:(this.g.add(e),this)}addAll(e){if(e===null)return this;if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s!==null&&this.g.add(s)}}else{const t=e.iterator;for(;t.next();){const i=t.value;i!==null&&this.g.add(i)}}return this}has(e){return this.g.has(e)}contains(e){return this.has(e)}containsAll(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(!this.has(t.value))return!1;return!0}containsAny(e){if(e===null)return!0;const t=e.iterator;for(;t.next();)if(this.has(t.value))return!0;return!1}first(){return this.g.size===0?null:this.g.values().next().value}any(e){for(const t of this.g)if(e(t))return!0;return!1}all(e){for(const t of this.g)if(!e(t))return!1;return!0}each(e){for(const t of this.g)e(t);return this}map(e){const t=new zi;for(const i of this.g)t.add(e(i));return t}filter(e){const t=new zi;for(const i of this.g)e(i)&&t.add(i);return t}delete(e){return this.h&&u.L(this),this.g.delete(e)}remove(e){return this.delete(e)}removeAll(e){if(e===null)return this;if(this.h&&u.L(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.delete(e[i])}else{const t=e.iterator;for(;t.next();)this.delete(t.value)}return this}retainAll(e){if(e===null)return this;if(this.count===0)return this;this.h&&u.L(this);const t=new zi;t.addAll(e);const i=[],s=this.iterator;for(;s.next();){const n=s.value;t.has(n)||i.push(n)}return this.removeAll(i),this}clear(){this.h&&u.L(this),this.g.clear()}copy(){const e=new zi;return this.g.forEach(t=>e.add(t)),e}toArray(){return Array.from(this.g)}toList(){const e=new Y;return this.g.forEach(t=>e.add(t)),e}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?A.instance:new Q(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(e,t){return this.g.forEach(e,t)}static Ki(e){e.__gohashid=zi.pw++}static as(e){return e.__gohashid}};g(zi,"pw",1);let I=zi;class pt{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.keys()}[Symbol.iterator](){return this.q.g.keys()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.keys()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.ii=this.q.g.keys(),this.ii.next().value)}any(e){for(const t of this.q.g)if(e(t[0]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[0]))return!1;return!0}each(e){for(const t of this.q.g)e(t[0]);return this}map(e){const t=this.q,i=new Y;for(const s of t.g)i.add(e(s[0]));return i.iterator}filter(e){const t=this.q,i=new Y;for(const s of t.g){const n=s[0];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapKeySetIterator"}}class Lt extends I{constructor(t){super();g(this,"q");I.Ki(this),this.h=!0,this.q=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}u(){return this}Pt(){return this}toString(){return"MapKeySet("+this.q.toString()+")"}add(t){u.o("This Set is read-only: "+this.toString())}has(t){return this.q.has(t)}contains(t){return this.has(t)}delete(t){u.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){u.o("This Set is read-only: "+this.toString())}first(){return this.q.g.size===0?null:this.q.g.keys().next().value}any(t){for(const i of this.q.g)if(t(i[0]))return!0;return!1}all(t){for(const i of this.q.g)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.q.g)t(i[0]);return this}map(t){const i=new I;for(const s of this.q.g)i.add(t(s[0]));return i}filter(t){const i=new I;for(const s of this.q.g){const n=s[0];t(n)&&i.add(n)}return i}copy(){return new Lt(this.q)}toSet(){const t=new I,i=this.q.g;for(const s of i)t.add(s[0]);return t}toArray(){const t=this.q.g,i=new Array(t.size);let s=0;for(const n of t)i[s]=n[0],s++;return i}toList(){const t=new Y,i=this.q.g;for(const s of i)t.add(s[0]);return t}get count(){return this.q.size}get size(){return this.q.size}get iterator(){return this.q.size<=0?A.instance:new pt(this.q)}}class Rt{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.values()}[Symbol.iterator](){return this.q.g.values()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.values()}next(){const e=this.ii.next();return this.value=e.value,this.key=e.value,!e.done}hasNext(){return this.next()}first(){return this.q.g.size===0?null:(this.ii=this.q.g.values(),this.ii.next().value)}any(e){for(const t of this.q.g)if(e(t[1]))return!0;return!1}all(e){for(const t of this.q.g)if(!e(t[1]))return!1;return!0}each(e){for(const t of this.q.g)e(t[1]);return this}map(e){const t=this.q,i=new Y;for(const s of t.g)i.add(e(s[1]));return i.iterator}filter(e){const t=this.q,i=new Y;for(const s of t.g){const n=s[1];e(n)&&i.add(n)}return i.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapValueSetIterator"}}class at{constructor(e,t){g(this,"key");g(this,"value");this.key=e,this.value=t}toString(){return"{"+this.key+":"+this.value+"}"}}class xt{constructor(e){g(this,"q");g(this,"ii");g(this,"key");g(this,"value");this.q=e,this.ii=e.g.entries()}[Symbol.iterator](){return this.q.g.entries()}get iterator(){return this}reset(){const e=this.q;this.ii=e.g.entries()}next(){const e=this.ii.next();return e.done?(this.key=null,this.value=null,!1):(this.key=e.value[0],this.value=e.value[1],!0)}hasNext(){return this.next()}first(){if(this.q.g.size===0)return null;this.ii=this.q.g.entries();const e=this.ii.next().value;return this.key=e[0],this.value=e[1],new at(e[0],e[1])}any(e){return this.q.any(e)}all(e){return this.q.all(e)}each(e){return this.q.each(e),this}map(e){const t=new Y;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new at(n,s):(i.key=n,i.value=s),t.add(e(i))}),t.iterator}filter(e){const t=new Y;let i=null;return this.q.g.forEach((s,n)=>{i===null?i=new at(n,s):(i.key=n,i.value=s),e(i)&&(t.add(i),i=null)}),t.iterator}get count(){return this.q.size}ul(){this.key=null,this.value=null,this.ii=null}toString(){return"MapIterator"}}class Z{constructor(e){g(this,"h");g(this,"g");I.Ki(this),this.h=!1,this.g=new Map,e!==void 0&&this.addAll(e)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}u(){return this.h=!0,this}Pt(){return this.h=!1,this}toString(){return"Map()#"+I.as(this)}set(e,t){return this.h&&u.L(this,e),this.g.set(e,t),this}add(e,t){return this.set(e,t)}addAll(e){if(e===null)return this;if(this.h&&u.L(this),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];this.set(s.key,s.value)}}else if(e instanceof Z){const t=e.iterator;for(;t.next();)this.set(t.key,t.value)}else{const t=e.iterator;for(;t.next();){const i=t.value;this.set(i.key,i.value)}}return this}first(){if(this.g.size===0)return null;const e=this.g.entries().next().value;return new at(e[0],e[1])}any(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new at(i,s):(t.key=i,t.value=s),e(t))return!0;return!1}all(e){let t=null;for(const[i,s]of this.g)if(t===null?t=new at(i,s):(t.key=i,t.value=s),!e(t))return!1;return!0}each(e){let t=null;for(const[i,s]of this.g)t===null?t=new at(i,s):(t.key=i,t.value=s),e(t);return this}map(e){const t=new Z;let i=null;for(const[s,n]of this.g)i===null?i=new at(s,n):(i.key=s,i.value=n),t.set(s,e(i));return t}filter(e){const t=new Z;let i=null;for(const[s,n]of this.g)i===null?i=new at(s,n):(i.key=s,i.value=n),e(i)&&t.set(s,n);return t}has(e){return this.g.has(e)}contains(e){return this.has(e)}get(e){const t=this.g.get(e);return t===void 0?null:t}getValue(e){return this.get(e)}delete(e){return e===null?!1:(this.h&&u.L(this,e),this.g.delete(e))}remove(e){return this.delete(e)}clear(){this.h&&u.L(this),this.g.clear()}copy(){const e=new Z;return e.g=new Map(this.g),e}toArray(){const e=this.g,t=new Array(e.size);let i=0;for(const s of e)t[i]=new at(s[0],s[1]),i++;return t}toKeySet(){return new Lt(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?A.instance:new xt(this)}get iteratorKeys(){return this.count<=0?A.instance:new pt(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?A.instance:new Rt(this)}values(){return this.g.values()}forEach(e,t){return this.g.forEach(e,t)}}const Se=class Se{constructor(e,t){g(this,"px");g(this,"py");g(this,"h");e===void 0?(this.px=0,this.py=0):typeof e=="number"&&typeof t=="number"?(this.px=e,this.py=t):u.o("Invalid arguments to Point constructor: "+e+", "+t),this.h=!1}a(e){return this.px=e.px,this.py=e.py,this}i(e,t){return this.px=e,this.py=t,this}setTo(e,t){return this.px=e,this.py=t,this}set(e){return this.px=e.px,this.py=e.py,this}copy(){const e=new Se;return e.px=this.px,e.py=this.py,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&u.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new Se(s,o)}else return new Se}static stringify(e){return e.x.toString()+" "+e.y.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(e){return e instanceof Se?this.px===e.x&&this.py===e.y:!1}equalTo(e,t){return this.px===e&&this.py===t}equalsApprox(e){return O.f(this.px,e.x)&&O.f(this.py,e.y)}add(e){return this.px+=e.x,this.py+=e.y,this}subtract(e){return this.px-=e.x,this.py-=e.y,this}offset(e,t){return this.px+=e,this.py+=t,this}rotate(e){if(e===0)return this;const t=this.px,i=this.py;if(t===0&&i===0)return this;let s=0,n=0;if(e>=360?e-=360:e<0&&(e+=360),e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const o=e*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*t-n*i,this.py=n*t+s*i,this}scale(e,t){return this.px*=e,this.py*=t,this}distanceSquaredPoint(e){const t=e.x-this.px,i=e.y-this.py;return t*t+i*i}distanceSquared(e,t){const i=e-this.px,s=t-this.py;return i*i+s*s}normalize(){const e=this.px,t=this.py,i=Math.sqrt(e*e+t*t);return i>0&&(this.px=e/i,this.py=t/i),this}directionPoint(e){return this.dC(e.x-this.px,e.y-this.py)}direction(e,t){return this.dC(e-this.px,t-this.py)}dC(e,t){if(e===0)return t>0?90:t<0?270:0;if(t===0)return e>0?0:180;{if(isNaN(e)||isNaN(t))return 0;let i=Math.atan(Math.abs(t/e))*180/Math.PI;return e<0?t<0?i+=180:i=180-i:t<0&&(i=360-i),i}}static compareWithLineSegment(e,t,i,s,n,o){return O.eu(e,t,i,s,n,o)}compareWithLineSegmentPoint(e,t){return O.eu(e.x,e.y,t.x,t.y,this.x,this.y)}static intersectingLineSegments(e,t,i,s,n,o,r,a){return O.su(e,t,i,s,n,o,r,a)}projectOntoLineSegment(e,t,i,s){return O.dl(e,t,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(e,t){return O.dl(e.x,e.y,t.x,t.y,this.px,this.py,this),this}snapToGrid(e,t,i,s){return O.Dg(this.px,this.py,e,t,i,s,this),this}snapToGridPoint(e,t){return O.Dg(this.px,this.py,e.x,e.y,t.width,t.height,this),this}setRectSpot(e,t){return this.px=e.x+t.x*e.width+t.offsetX,this.py=e.y+t.y*e.height+t.offsetY,this}setSpot(e,t,i,s,n){return this.px=e+n.x*i+n.offsetX,this.py=t+n.y*s+n.offsetY,this}T(e){return e.gt(this),this}Oe(e){return e.$e(this),this}static distanceLineSegmentSquared(e,t,i,s,n,o){let r=n-i,a=o-s;const h=r*r+a*a,l=i-e,c=s-t,d=-l*r-c*a;if(d<=0||d>=h)return r=n-e,a=o-t,Math.min(l*l+c*c,r*r+a*a);{const f=r*c-a*l;return f*f/h}}static distanceSquared(e,t,i,s){const n=i-e,o=s-t;return n*n+o*o}static direction(e,t,i,s){const n=i-e,o=s-t;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.px}set x(e){this.px=e}get y(){return this.py}set y(e){this.py=e}isReal(){return isFinite(this.x)&&isFinite(this.y)}static l(){const e=Se.Ek.pop();return e===void 0?new Se:e}static V(e,t){const i=Se.Ek.pop();return i===void 0?new Se(e,t):(i.x=e,i.y=t,i)}static e(e){Se.Ek.push(e)}};g(Se,"xo",new Se(0,0).$()),g(Se,"gC",new Se(-1/0,-1/0).$()),g(Se,"mC",new Se(1/0,1/0).$()),g(Se,"pC",new Se(6,6).$()),g(Se,"Ik",new Se(NaN,NaN).$()),g(Se,"Ek",[]);let C=Se;const he=class he{constructor(e,t){g(this,"sw");g(this,"sh");g(this,"h");e===void 0?(this.sw=0,this.sh=0):typeof e=="number"&&(e>=0||isNaN(e))&&typeof t=="number"&&(t>=0||isNaN(t))?(this.sw=e,this.sh=t):u.o("Invalid arguments to Size constructor: "+e+", "+t),this.h=!1}a(e){return this.sw=e.sw,this.sh=e.sh,this}i(e,t){return this.sw=e,this.sh=t,this}setTo(e,t){return this.sw=e,this.sh=t,this}set(e){return this.sw=e.sw,this.sh=e.sh,this}copy(){const e=new he;return e.sw=this.sw,e.sh=this.sh,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&u.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;return n=t[i++],n&&(o=parseFloat(n)),new he(s,o)}else return new he}static stringify(e){return e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(e){return e instanceof he?this.sw===e.width&&this.sh===e.height:!1}equalTo(e,t){return this.sw===e&&this.sh===t}equalsApprox(e){return O.f(this.sw,e.width)&&O.f(this.sh,e.height)}inflate(e,t){const i=this.width+e;this.sw=i>=0?i:0;const s=this.height+t;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(e){e<0&&u.W(e,">= 0",he,"width"),this.sw=e}get height(){return this.sh}set height(e){e<0&&u.W(e,">= 0",he,"height"),this.sh=e}isReal(){return isFinite(this.width)&&isFinite(this.height)}static l(){const e=he.xC.pop();return e===void 0?new he:e}static e(e){he.xC.push(e)}};g(he,"sc",new he(0,0).$()),g(he,"Uk",new he(1,1).$()),g(he,"yC",new he(6,6).$()),g(he,"nu",new he(8,8).$()),g(he,"wC",new he(10,10).$()),g(he,"Bk",new he(1/0,1/0).$()),g(he,"ww",new he(NaN,NaN).$()),g(he,"xC",[]);let rt=he;const Ee=class Ee{constructor(e,t,i,s){g(this,"rx");g(this,"ry");g(this,"rw");g(this,"rh");g(this,"h");if(e===void 0)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if(typeof e=="number"&&typeof t=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.rx=e,this.ry=t,this.rw=i,this.rh=s;else if(e instanceof C){const n=e.x,o=e.y;if(t instanceof C){const r=t.x,a=t.y;this.rx=Math.min(n,r),this.ry=Math.min(o,a),this.rw=Math.abs(n-r),this.rh=Math.abs(o-a)}else t instanceof rt?(this.rx=n,this.ry=o,this.rw=t.width,this.rh=t.height):u.o("Incorrect second argument supplied to Rect constructor "+t)}else u.o("Invalid arguments to Rect constructor: "+e+", "+t+", "+i+", "+s);this.h=!1}a(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}i(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}Fn(e,t){return this.rw=e,this.rh=t,this}setTo(e,t,i,s){return this.rx=e,this.ry=t,this.rw=i,this.rh=s,this}set(e){return this.rx=e.rx,this.ry=e.ry,this.rw=e.rw,this.rh=e.rh,this}setPoint(e){return this.rx=e.x,this.ry=e.y,this}setSize(e){return this.rw=e.width,this.rh=e.height,this}copy(){const e=new Ee;return e.rx=this.rx,e.ry=this.ry,e.rw=this.rw,e.rh=this.rh,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&u.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n&&(r=parseFloat(n));let a=0;for(;t[i]==="";)i++;return n=t[i++],n&&(a=parseFloat(n)),new Ee(s,o,r,a)}else return new Ee}static stringify(e){return e.x.toString()+" "+e.y.toString()+" "+e.width.toString()+" "+e.height.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(e){return e instanceof Ee?this.rx===e.x&&this.ry===e.y&&this.rw===e.width&&this.rh===e.height:!1}equalTo(e,t,i,s){return this.rx===e&&this.ry===t&&this.rw===i&&this.rh===s}equalsApprox(e){return O.f(this.rx,e.x)&&O.f(this.ry,e.y)&&O.f(this.rw,e.width)&&O.f(this.rh,e.height)}equalsApproxTo(e,t,i,s){return O.f(this.rx,e)&&O.f(this.ry,t)&&O.f(this.rw,i)&&O.f(this.rh,s)}equalsApproxClose(e){return O.z(this.rx,e.x)&&O.z(this.ry,e.y)&&O.z(this.rw,e.width)&&O.z(this.rh,e.height)}containsPoint(e){return this.rx<=e.x&&this.rx+this.rw>=e.x&&this.ry<=e.y&&this.ry+this.rh>=e.y}containsRect(e){return this.rx<=e.x&&e.x+e.width<=this.rx+this.rw&&this.ry<=e.y&&e.y+e.height<=this.ry+this.rh}contains(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.rx<=e&&e+i<=this.rx+this.rw&&this.ry<=t&&t+s<=this.ry+this.rh}offset(e,t){return this.rx+=e,this.ry+=t,this}inflate(e,t){return this.xw(t,e,t,e)}addMargin(e){return this.xw(e.top,e.right,e.bottom,e.left)}subtractMargin(e){return this.xw(-e.top,-e.right,-e.bottom,-e.left)}grow(e,t,i,s){return this.xw(e,t,i,s)}xw(e,t,i,s){const n=this.rw;t+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=t+s);const o=this.rh;return e+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=e,this.rh+=e+i),this}intersectRect(e){return this.bC(e.x,e.y,e.width,e.height)}intersect(e,t,i,s){return this.bC(e,t,i,s)}bC(e,t,i,s){const n=Math.max(this.rx,e),o=Math.max(this.ry,t),r=Math.min(this.rx+this.rw,e+i),a=Math.min(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,a-o),this}intersectsRect(e){return this.intersects(e.x,e.y,e.width,e.height)}intersects(e,t,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=e,isNaN(i)||isNaN(n)||o>i||e>n))return!1;let r=this.rh;const a=this.ry;return!(r!==1/0&&s!==1/0&&(r+=a,s+=t,isNaN(s)||isNaN(r)||a>s||t>r))}intersectsRectPlus(e,t){let i=this.rw,s=e.width+t+t;const n=this.rx,o=e.x-t;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,a=e.height+t+t;const h=this.ry,l=e.y-t;return r+=h,a+=l,!(h>a||l>r)}unionPoint(e){return this.unionNoCheck(e.x,e.y,0,0)}unionRect(e){return this.unionNoCheck(e.rx,e.ry,e.rw,e.rh)}union(e,t,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.unionNoCheck(e,t,i,s)}unionNoCheck(e,t,i,s){const n=Math.min(this.rx,e),o=Math.min(this.ry,t),r=Math.max(this.rx+this.rw,e+i),a=Math.max(this.ry+this.rh,t+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=a-o,this}setSpot(e,t,i){return this.rx=e-i.offsetX-i.x*this.rw,this.ry=t-i.offsetY-i.y*this.rh,this}static contains(e,t,i,s,n,o,r,a){return r===void 0&&(r=0),a===void 0&&(a=0),e<=n&&n+r<=e+i&&t<=o&&o+a<=t+s}static intersects(e,t,i,s,n,o,r,a){let h=i,l=r;const c=e,d=n;if(h+=c,l+=d,c>l||d>h)return!1;let f=s,m=a;const p=t,y=o;return f+=p,m+=y,!(p>m||y>f)}static intersectsLineSegment(e,t,i,s,n,o,r,a){return O.kC(e,t,i,s,n,o,r,a)}get x(){return this.rx}set x(e){this.rx=e}get y(){return this.ry}set y(e){this.ry=e}get width(){return this.rw}set width(e){e<0&&u.W(e,">= 0",Ee,"width"),this.rw=e}get height(){return this.rh}set height(e){e<0&&u.W(e,">= 0",Ee,"height"),this.rh=e}get left(){return this.rx}set left(e){this.rx=e}get top(){return this.ry}set top(e){this.ry=e}get right(){return this.rx+this.rw}set right(e){this.rx+=e-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(e){this.ry+=e-(this.ry+this.rh)}get position(){return new C(this.rx,this.ry)}set position(e){this.rx=e.x,this.ry=e.y}get size(){return new rt(this.rw,this.rh)}set size(e){this.rw=e.width,this.rh=e.height}get center(){return new C(this.rx+this.rw/2,this.ry+this.rh/2)}set center(e){this.rx=e.x-this.rw/2,this.ry=e.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(e){this.rx=e-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(e){this.ry=e-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static l(){const e=Ee.Vk.pop();return e===void 0?new Ee:e}static V(e,t,i,s){const n=Ee.Vk.pop();return n===void 0?new Ee(e,t,i,s):n.i(e,t,i,s)}static e(e){Ee.Vk.push(e)}};g(Ee,"Fg",new Ee(0,0,0,0).$()),g(Ee,"$D",new Ee(NaN,NaN,NaN,NaN).$()),g(Ee,"Vk",[]);let G=Ee;const Oe=class Oe{constructor(e,t,i,s){g(this,"mt");g(this,"mr");g(this,"mb");g(this,"ml");g(this,"h");e===void 0?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):t===void 0?(t=e,i=e,s=e,this.mt=e,this.mr=t,this.mb=i,this.ml=s):i===void 0?(i=e,s=t,this.mt=e,this.mr=t,this.mb=i,this.ml=s):s!==void 0?(this.mt=e,this.mr=t,this.mb=i,this.ml=s):u.o("Invalid arguments to Margin constructor: "+e+", "+t+", "+i+", "+s),this.h=!1}a(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}setTo(e,t,i,s){return this.mt=e,this.mr=t,this.mb=i,this.ml=s,this}set(e){return this.mt=e.mt,this.mr=e.mr,this.mb=e.mb,this.ml=e.ml,this}copy(){const e=new Oe;return e.mt=this.mt,e.mr=this.mr,e.mb=this.mb,e.ml=this.ml,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&u.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}static parse(e){if(typeof e=="string"){const t=e.split(" ");let i=0,s=NaN;for(;t[i]==="";)i++;let n=t[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new Oe;let o=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(o=parseFloat(n)),isNaN(o))return new Oe(s);let r=NaN;for(;t[i]==="";)i++;if(n=t[i++],n&&(r=parseFloat(n)),isNaN(r))return new Oe(s,o);let a=NaN;for(;t[i]==="";)i++;return n=t[i++],n&&(a=parseFloat(n)),isNaN(a)?new Oe(s,o):new Oe(s,o,r,a)}else return new Oe}static stringify(e){return e.top.toString()+" "+e.right.toString()+" "+e.bottom.toString()+" "+e.left.toString()}static stringifyFixed(e){return t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(e){return e instanceof Oe?this.mt===e.top&&this.mr===e.right&&this.mb===e.bottom&&this.ml===e.left:!1}equalTo(e,t,i,s){return this.mt===e&&this.mr===t&&this.mb===i&&this.ml===s}equalsApprox(e){return O.f(this.mt,e.top)&&O.f(this.mr,e.right)&&O.f(this.mb,e.bottom)&&O.f(this.ml,e.left)}get top(){return this.mt}set top(e){this.mt=e}get right(){return this.mr}set right(e){this.mr=e}get bottom(){return this.mb}set bottom(e){this.mb=e}get left(){return this.ml}set left(e){this.ml=e}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static l(){const e=Oe.SC.pop();return e===void 0?new Oe:e}static e(e){Oe.SC.push(e)}};g(Oe,"Rg",new Oe(0,0,0,0).$()),g(Oe,"PC",new Oe(2,2,2,2).$()),g(Oe,"SC",[]);let wt=Oe;const tt=class tt{constructor(e,t,i,s){g(this,"sx");g(this,"sy");g(this,"ox");g(this,"oy");g(this,"h");e===void 0?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=0),this.sx=e,this.sy=t,this.ox=i,this.oy=s),this.h=!1}a(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}setTo(e,t,i,s){return this.sx=e,this.sy=t,this.ox=i,this.oy=s,this}set(e){return this.sx=e.sx,this.sy=e.sy,this.ox=e.ox,this.oy=e.oy,this}copy(){const e=new tt;return e.sx=this.sx,e.sy=this.sy,e.ox=this.ox,e.oy=this.oy,e}$(){return this.h=!0,Object.freeze(this),this}P(){return this.h||Object.isFrozen(this)?this:this.copy().u()}u(){return this.h||(this.h=!0),this}Pt(){return this.h&&(Object.isFrozen(this)&&u.o("cannot thaw constant: "+this),this.h=!1),this}yw(e){}Ie(e){return this.sx=NaN,this.sy=NaN,this.ox=e,this}wE(e,t){(isNaN(e)||e>1||e<0)&&u.W(e,"0 <= "+t+" <= 1",tt,t)}xE(e,t){(isNaN(e)||e===1/0||e===-1/0)&&u.W(e,"real number, not NaN or Infinity",tt,t)}static parse(e){if(typeof e=="string"){if(e=e.trim(),e==="None")return tt.None;if(e==="TopLeft")return tt.TopLeft;if(e==="Top"||e==="TopCenter"||e==="MiddleTop")return tt.TopCenter;if(e==="TopRight")return tt.TopRight;if(e==="Left"||e==="LeftCenter"||e==="MiddleLeft")return tt.LeftCenter;if(e==="Center")return tt.Center;if(e==="Right"||e==="RightCenter"||e==="MiddleRight")return tt.RightCenter;if(e==="BottomLeft")return tt.BottomLeft;if(e==="Bottom"||e==="BottomCenter"||e==="MiddleBottom")return tt.BottomCenter;if(e==="BottomRight")return tt.BottomRight;if(e==="TopSide")return tt.TopSide;if(e==="LeftSide")return tt.LeftSide;if(e==="RightSide")return tt.RightSide;if(e==="BottomSide")return tt.BottomSide;if(e==="TopBottomSides")return tt.TopBottomSides;if(e==="LeftRightSides")return tt.LeftRightSides;if(e==="TopLeftSides")return tt.TopLeftSides;if(e==="TopRightSides")return tt.TopRightSides;if(e==="BottomLeftSides")return tt.BottomLeftSides;if(e==="BottomRightSides")return tt.BottomRightSides;if(e==="NotTopSide")return tt.NotTopSide;if(e==="NotLeftSide")return tt.NotLeftSide;if(e==="NotRightSide")return tt.NotRightSide;if(e==="NotBottomSide")return tt.NotBottomSide;if(e==="AllSides")return tt.AllSides;if(e==="Default")return tt.Default;const t=e.split(" ");let i=0,s=0;for(;t[i]==="";)i++;let n=t[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;t[i]==="";)i++;n=t[i++],n!==void 0&&n.length>0&&(r=parseFloat(n));let a=0;for(;t[i]==="";)i++;return n=t[i++],n!==void 0&&n.length>0&&(a=parseFloat(n)),new tt(s,o,r,a)}else return new tt}static stringify(e){return e.isSpot()?e.x.toString()+" "+e.y.toString()+" "+e.offsetX.toString()+" "+e.offsetY.toString():e.toString()}static stringifyFixed(e){return t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?this.ox===0&&this.oy===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(tt.None)?"None":this.equals(tt.TopLeft)?"TopLeft":this.equals(tt.TopCenter)?"Top":this.equals(tt.TopRight)?"TopRight":this.equals(tt.LeftCenter)?"Left":this.equals(tt.Center)?"Center":this.equals(tt.RightCenter)?"Right":this.equals(tt.BottomLeft)?"BottomLeft":this.equals(tt.BottomCenter)?"Bottom":this.equals(tt.BottomRight)?"BottomRight":this.equals(tt.TopSide)?"TopSide":this.equals(tt.LeftSide)?"LeftSide":this.equals(tt.RightSide)?"RightSide":this.equals(tt.BottomSide)?"BottomSide":this.equals(tt.TopBottomSides)?"TopBottomSides":this.equals(tt.LeftRightSides)?"LeftRightSides":this.equals(tt.TopLeftSides)?"TopLeftSides":this.equals(tt.TopRightSides)?"TopRightSides":this.equals(tt.BottomLeftSides)?"BottomLeftSides":this.equals(tt.BottomRightSides)?"BottomRightSides":this.equals(tt.NotTopSide)?"NotTopSide":this.equals(tt.NotLeftSide)?"NotLeftSide":this.equals(tt.NotRightSide)?"NotRightSide":this.equals(tt.NotBottomSide)?"NotBottomSide":this.equals(tt.AllSides)?"AllSides":this.equals(tt.Default)?"Default":"None"}equals(e){return e instanceof tt?(this.sx===e.x||isNaN(this.sx)&&isNaN(e.x))&&(this.sy===e.y||isNaN(this.sy)&&isNaN(e.y))&&this.ox===e.offsetX&&this.oy===e.offsetY:!1}opposite(){return new tt(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(e){if(!this.isSide())return!1;if(!e.isSide())if(e.equals(tt.Left))e=tt.LeftSide;else if(e.equals(tt.Right))e=tt.RightSide;else if(e.equals(tt.Top))e=tt.TopSide;else if(e.equals(tt.Bottom))e=tt.BottomSide;else return!1;const t=this.oy,i=e.offsetY;return(t&i)===i}get x(){return this.sx}set x(e){this.sx=e}get y(){return this.sy}set y(e){this.sy=e}get offsetX(){return this.ox}set offsetX(e){this.ox=e}get offsetY(){return this.oy}set offsetY(e){this.oy=e}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static l(){const e=tt.MC.pop();return e===void 0?new tt:e}static e(e){tt.MC.push(e)}};g(tt,"None",new tt(0,0,0,0).Ie(0).$()),g(tt,"Default",new tt(0,0,-1,0).Ie(-1).$()),g(tt,"TopLeft",new tt(0,0,0,0).$()),g(tt,"TopCenter",new tt(.5,0,0,0).$()),g(tt,"TopRight",new tt(1,0,0,0).$()),g(tt,"LeftCenter",new tt(0,.5,0,0).$()),g(tt,"Center",new tt(.5,.5,0,0).$()),g(tt,"RightCenter",new tt(1,.5,0,0).$()),g(tt,"BottomLeft",new tt(0,1,0,0).$()),g(tt,"BottomCenter",new tt(.5,1,0,0).$()),g(tt,"BottomRight",new tt(1,1,0,0).$()),g(tt,"MiddleTop",tt.TopCenter),g(tt,"MiddleLeft",tt.LeftCenter),g(tt,"MiddleRight",tt.RightCenter),g(tt,"MiddleBottom",tt.BottomCenter),g(tt,"Top",tt.TopCenter),g(tt,"Left",tt.LeftCenter),g(tt,"Right",tt.RightCenter),g(tt,"Bottom",tt.BottomCenter),g(tt,"TopSide",new tt(0,0,1,1).Ie(1).$()),g(tt,"LeftSide",new tt(0,0,1,2).Ie(1).$()),g(tt,"RightSide",new tt(0,0,1,4).Ie(1).$()),g(tt,"BottomSide",new tt(0,0,1,8).Ie(1).$()),g(tt,"TopBottomSides",new tt(0,0,1,9).Ie(1).$()),g(tt,"LeftRightSides",new tt(0,0,1,6).Ie(1).$()),g(tt,"TopLeftSides",new tt(0,0,1,3).Ie(1).$()),g(tt,"TopRightSides",new tt(0,0,1,5).Ie(1).$()),g(tt,"BottomLeftSides",new tt(0,0,1,10).Ie(1).$()),g(tt,"BottomRightSides",new tt(0,0,1,12).Ie(1).$()),g(tt,"NotTopSide",new tt(0,0,1,14).Ie(1).$()),g(tt,"NotLeftSide",new tt(0,0,1,13).Ie(1).$()),g(tt,"NotRightSide",new tt(0,0,1,11).Ie(1).$()),g(tt,"NotBottomSide",new tt(0,0,1,7).Ie(1).$()),g(tt,"AllSides",new tt(0,0,1,15).Ie(1).$()),g(tt,"zk",new tt(.156,.156).$()),g(tt,"Xk",new tt(.844,.844).$()),g(tt,"MC",[]);let U=tt;const Qi=class Qi{constructor(){g(this,"m11");g(this,"m12");g(this,"m21");g(this,"m22");g(this,"dx");g(this,"dy");this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(e){return this.m11=e.m11,this.m12=e.m12,this.m21=e.m21,this.m22=e.m22,this.dx=e.dx,this.dy=e.dy,this}setTo(e,t,i,s,n,o){return this.m11=e,this.m12=t,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const e=new Qi;return e.m11=this.m11,e.m12=this.m12,e.m21=this.m21,e.m22=this.m22,e.dx=this.dx,e.dy=this.dy,e}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(e){return this.m11===e.m11&&this.m12===e.m12&&this.m21===e.m21&&this.m22===e.m22&&this.dx===e.dx&&this.dy===e.dy}Yk(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ri(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}nc(e){const t=this.m11*e.m11+this.m21*e.m12,i=this.m12*e.m11+this.m22*e.m12,s=this.m11*e.m21+this.m21*e.m22,n=this.m12*e.m21+this.m22*e.m22;return this.dx=this.m11*e.dx+this.m21*e.dy+this.dx,this.dy=this.m12*e.dx+this.m22*e.dy+this.dy,this.m11=t,this.m12=i,this.m21=s,this.m22=n,this}NC(e){const t=1/(e.m11*e.m22-e.m12*e.m21),i=e.m22*t,s=-e.m12*t,n=-e.m21*t,o=e.m11*t,r=t*(e.m21*e.dy-e.m22*e.dx),a=t*(e.m12*e.dx-e.m11*e.dy),h=this.m11*i+this.m21*s,l=this.m12*i+this.m22*s,c=this.m11*n+this.m21*o,d=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*a+this.dx,this.dy=this.m12*r+this.m22*a+this.dy,this.m11=h,this.m12=l,this.m21=c,this.m22=d,this}bw(){const e=1/(this.m11*this.m22-this.m12*this.m21),t=this.m22*e,i=-this.m12*e,s=-this.m21*e,n=this.m11*e,o=e*(this.m21*this.dy-this.m22*this.dx),r=e*(this.m12*this.dx-this.m11*this.dy);return this.m11=t,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}cs(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return this;this.Fs(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,a=this.m11*-n+this.m21*s,h=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=a,this.m22=h,this.Fs(-t,-i),this}Fs(e,t){return this.dx+=this.m11*e+this.m21*t,this.dy+=this.m12*e+this.m22*t,this}tt(e,t){return t===void 0&&(t=e),this.m11*=e,this.m12*=e,this.m21*=t,this.m22*=t,this}ZD(){if(this.m11===1&&this.m12===0)return 0;let e=Math.atan2(this.m12,this.m11)*180/Math.PI;return e<0&&(e+=360),e}gt(e){const t=e.x,i=e.y;return e.i(t*this.m11+i*this.m21+this.dx,t*this.m12+i*this.m22+this.dy)}$e(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=e.x-this.dx,a=e.y-this.dy;return e.i(r*i+a*n,r*s+a*o)}kw(e){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,s=-this.m12*t,n=-this.m21*t,o=this.m11*t,r=t*(this.m21*this.dy-this.m22*this.dx),a=t*(this.m12*this.dx-this.m11*this.dy),h=e.x*1.25,l=e.y*1.2;return e.i(h*i+l*n+r,h*s+l*o+a)}vg(e){const t=e.x,i=e.y,s=t+e.width,n=i+e.height,o=this.m11,r=this.m12,a=this.m21,h=this.m22,l=this.dx,c=this.dy,d=t*o+i*a+l,f=t*r+i*h+c,m=s*o+i*a+l,p=s*r+i*h+c,y=t*o+n*a+l,x=t*r+n*h+c,b=s*o+n*a+l,M=s*r+n*h+c;let P=d,k=d,L=f,T=f;return P=Math.min(P,m),k=Math.max(k,m),L=Math.min(L,p),T=Math.max(T,p),P=Math.min(P,y),k=Math.max(k,y),L=Math.min(L,x),T=Math.max(T,x),P=Math.min(P,b),k=Math.max(k,b),L=Math.min(L,M),T=Math.max(T,M),e.i(P,L,k-P,T-L),e}static l(){const e=Qi.CC.pop();return e===void 0?new Qi:e}static e(e){Qi.CC.push(e)}};g(Qi,"CC",[]),g(Qi,"Gk","54a702f3e53909c447824c6706603faf4c");let Pt=Qi;const O={QD:"7da71ca0ad381e90",Rn:4*((Math.sqrt(2)-1)/3),LC:null,Pw:S=>{if(S<=0)return 0;let e=O.LC;if(e===null){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);O.LC=e}if(S<1){const t=1/S;return t<=2e3?1/e[t|0]:Math.sqrt(S)}else return S<=2e3?e[S|0]:Math.sqrt(S)},f:(S,e)=>{const t=S-e;return t<.5&&t>-.5},z:(S,e)=>{const t=S-e;return t<5e-8&&t>-5e-8},vi:(S,e,t,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,a=0,h=0,l=0;if(S<t?(a=S,r=t):(a=t,r=S),e<i?(l=e,h=i):(l=i,h=e),S===t)return l<=o&&o<=h&&S-s<=n&&n<=S+s;if(e===i)return a<=n&&n<=r&&e-s<=o&&o<=e+s;const c=r+s,d=a-s;if(d<=n&&n<=c){const f=h+s,m=l-s;if(m<=o&&o<=f)if(c-d>f-m)if(S-t>s||t-S>s){const p=(i-e)/(t-S)*(n-S)+e;if(p-s<=o&&o<=p+s)return!0}else return!0;else if(e-i>s||i-e>s){const p=(t-S)/(i-e)*(o-e)+S;if(p-s<=n&&n<=p+s)return!0}else return!0}return!1},Sw:(S,e,t,i,s,n,o,r,a,h,l,c)=>{if(!O.vi(S,e,o,r,c,t,i)||!O.vi(S,e,o,r,c,s,n)){const d=(S+t)/2,f=(e+i)/2,m=(t+s)/2,p=(i+n)/2,y=(s+o)/2,x=(n+r)/2,b=(d+m)/2,M=(f+p)/2,P=(m+y)/2,k=(p+x)/2,L=(b+P)/2,T=(M+k)/2;return O.Sw(S,e,d,f,b,M,L,T,a,h,l,c)||O.Sw(L,T,P,k,y,x,o,r,a,h,l,c)}else return O.vi(S,e,o,r,c,h,l)},AC:(S,e,t,i,s,n,o,r,a)=>{const h=(S+t)/2,l=(e+i)/2,c=(t+s)/2,d=(i+n)/2,f=(s+o)/2,m=(n+r)/2,p=(h+c)/2,y=(l+d)/2,x=(c+f)/2,b=(d+m)/2;return a.i((p+x)/2,(y+b)/2),a},_D:(S,e,t,i,s,n,o,r)=>{const a=(S+t)/2,h=(e+i)/2,l=(t+s)/2,c=(i+n)/2,d=(s+o)/2,f=(n+r)/2,m=(a+l)/2,p=(h+c)/2,y=(l+d)/2,x=(c+f)/2;return C.direction(m,p,y,x)},ou:(S,e,t,i,s,n,o,r,a,h)=>{if(!O.vi(S,e,o,r,a,t,i)||!O.vi(S,e,o,r,a,s,n)){const l=(S+t)/2,c=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(s+o)/2,p=(n+r)/2,y=(l+d)/2,x=(c+f)/2,b=(d+m)/2,M=(f+p)/2,P=(y+b)/2,k=(x+M)/2;O.ou(S,e,l,c,y,x,P,k,a,h),O.ou(P,k,b,M,m,p,o,r,a,h)}else h.unionNoCheck(S,e,0,0),h.unionNoCheck(o,r,0,0);return h},vn:(S,e,t,i,s,n,o,r,a,h)=>{if(!O.vi(S,e,o,r,a,t,i)||!O.vi(S,e,o,r,a,s,n)){const l=(S+t)/2,c=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(s+o)/2,p=(n+r)/2,y=(l+d)/2,x=(c+f)/2,b=(d+m)/2,M=(f+p)/2,P=(y+b)/2,k=(x+M)/2;O.vn(S,e,l,c,y,x,P,k,a,h),O.vn(P,k,b,M,m,p,o,r,a,h)}else h.length===0&&(h.push(S),h.push(e)),h.push(o),h.push(r);return h},Kk:(S,e,t,i,s,n,o,r,a,h)=>{if(O.vi(S,e,s,n,h,t,i))return O.vi(S,e,s,n,h,r,a);{const l=(S+t)/2,c=(e+i)/2,d=(t+s)/2,f=(i+n)/2,m=(l+d)/2,p=(c+f)/2;return O.Kk(S,e,l,c,m,p,o,r,a,h)||O.Kk(m,p,d,f,s,n,o,r,a,h)}},bE:(S,e,t,i,s,n,o)=>{const r=(S+t)/2,a=(e+i)/2,h=(t+s)/2,l=(i+n)/2;return o.i((r+h)/2,(a+l)/2),o},jk:(S,e,t,i,s,n,o,r)=>{if(O.vi(S,e,s,n,o,t,i))r.unionNoCheck(S,e,0,0),r.unionNoCheck(s,n,0,0);else{const a=(S+t)/2,h=(e+i)/2,l=(t+s)/2,c=(i+n)/2,d=(a+l)/2,f=(h+c)/2;O.jk(S,e,a,h,d,f,o,r),O.jk(d,f,l,c,s,n,o,r)}return r},Og:(S,e,t,i,s,n,o,r)=>{if(O.vi(S,e,s,n,o,t,i))r.length===0&&(r.push(S),r.push(e)),r.push(s),r.push(n);else{const a=(S+t)/2,h=(e+i)/2,l=(t+s)/2,c=(i+n)/2,d=(a+l)/2,f=(h+c)/2;O.Og(S,e,a,h,d,f,o,r),O.Og(d,f,l,c,s,n,o,r)}return r},Ig:(S,e,t,i,s,n,o,r,a,h,l,c,d,f)=>{if(!O.vi(S,e,o,r,d,t,i)||!O.vi(S,e,o,r,d,s,n)){const m=(S+t)/2,p=(e+i)/2,y=(t+s)/2,x=(i+n)/2,b=(s+o)/2,M=(n+r)/2,P=(m+y)/2,k=(p+x)/2,L=(y+b)/2,T=(x+M)/2,D=(P+L)/2,B=(k+T)/2;let E=1/0,R=!1,F=0,V=0;if(O.Ig(S,e,m,p,P,k,D,B,a,h,l,c,d,f)){const K=(f.x-a)**2+(f.y-h)**2;K<E&&(E=K,R=!0,F=f.x,V=f.y)}if(O.Ig(D,B,L,T,b,M,o,r,a,h,l,c,d,f)){const K=(f.x-a)**2+(f.y-h)**2;K<E&&(E=K,R=!0,F=f.x,V=f.y)}return R&&(f.x=F,f.y=V),R}else{if(!O.su(S,e,o,r,a,h,l,c))return!1;const m=(S-o)*(h-c)-(e-r)*(a-l);if(m===0)return!1;const p=((S*r-e*o)*(a-l)-(S-o)*(a*c-h*l))/m,y=((S*r-e*o)*(h-c)-(e-r)*(a*c-h*l))/m;return f.i(p,y),!0}},Eg:(S,e,t,i,s,n,o,r,a,h,l,c,d)=>{let f=0;if(!O.vi(S,e,o,r,d,t,i)||!O.vi(S,e,o,r,d,s,n)){const m=(S+t)/2,p=(e+i)/2,y=(t+s)/2,x=(i+n)/2,b=(s+o)/2,M=(n+r)/2,P=(m+y)/2,k=(p+x)/2,L=(y+b)/2,T=(x+M)/2,D=(P+L)/2,B=(k+T)/2;f+=O.Eg(S,e,m,p,P,k,D,B,a,h,l,c,d),f+=O.Eg(D,B,L,T,b,M,o,r,a,h,l,c,d)}else{const m=(S-o)*(h-c)-(e-r)*(a-l);if(m===0)return f;const p=((S*r-e*o)*(a-l)-(S-o)*(a*c-h*l))/m,y=((S*r-e*o)*(h-c)-(e-r)*(a*c-h*l))/m;if(p>=l)return f;let x=0,b=0;if((a>l?a-l:l-a)<(h>c?h-c:c-h)){if(e<r?(x=e,b=r):(x=r,b=e),y<x||y>b)return f}else if(S<o?(x=S,b=o):(x=o,b=S),p<x||p>b)return f;m>0?f++:m<0&&f--}return f},dl:(S,e,t,i,s,n,o)=>{if(O.z(S,t)){let r=0,a=0;e<i?(r=e,a=i):(r=i,a=e);const h=n;return h<r?(o.i(S,r),!1):h>a?(o.i(S,a),!1):(o.i(S,h),!0)}else if(O.z(e,i)){let r=0,a=0;S<t?(r=S,a=t):(r=t,a=S);const h=s;return h<r?(o.i(r,e),!1):h>a?(o.i(a,e),!1):(o.i(h,e),!0)}else{const r=(t-S)**2+(i-e)**2,a=((S-s)*(S-t)+(e-n)*(e-i))/r;if(a<-5e-6)return o.i(S,e),!1;if(a>1.000005)return o.i(t,i),!1;{const h=S+a*(t-S),l=e+a*(i-e);return o.i(h,l),!0}}},On:(S,e,t,i,s,n,o,r,a)=>{if(O.f(S,t)&&O.f(e,i))return a.i(S,e),!1;if(O.z(s,o)){if(O.z(S,t))return O.dl(S,e,t,i,s,n,a),!1;{const h=(i-e)/(t-S)*(s-S)+e;return O.dl(S,e,t,i,s,h,a)}}else{const h=(r-n)/(o-s);if(O.z(S,t)){const l=h*(S-s)+n;let c=0,d=0;return e<i?(c=e,d=i):(c=i,d=e),l<c?(a.i(S,c),!1):l>d?(a.i(S,d),!1):(a.i(S,l),!0)}else{const l=(i-e)/(t-S);if(O.z(h,l))return O.dl(S,e,t,i,s,n,a),!1;{const c=(l*S-h*s+n-e)/(l-h);if(O.z(l,0)){let d=0,f=0;return S<t?(d=S,f=t):(d=t,f=S),c<d?(a.i(d,e),!1):c>f?(a.i(f,e),!1):(a.i(c,e),!0)}else{const d=l*(c-S)+e;return O.dl(S,e,t,i,c,d,a)}}}}},kE:(S,e,t,i,s)=>O.On(t.x,t.y,i.x,i.y,S.x,S.y,e.x,e.y,s),PE:(S,e,t,i,s,n,o,r,a,h)=>{let l=1/0;function c(L,T){const D=(L-S)**2+(T-e)**2;D<l&&(l=D,a.i(L,T))}c(a.x,a.y);let d=0,f=0,m=0,p=0;s<o?(d=s,f=o):(d=o,f=s),n<r?(m=s,p=o):(m=o,p=s);const y=f-d,x=p-m,b=y/2+h,M=x/2+h,P=(s+o)/2,k=(n+r)/2;if(b===0||M===0)return a;if(O.f(S,t)){const L=1-(t-P)**2/(b*b);if(L<0)return a;const T=Math.sqrt(L),D=M*T+k,B=-M*T+k;c(t,D),c(t,B)}else{const L=(i-e)/(t-S),T=1/(b*b)+L*L/(M*M),D=2*L*(e-L*S)/(M*M)-2*L*k/(M*M)-2*P/(b*b),B=2*L*S*k/(M*M)-2*e*k/(M*M)+k*k/(M*M)+P*P/(b*b)-1+(e-L*S)*(e-L*S)/(M*M),E=D*D-4*T*B;if(E<0)return a;const R=Math.sqrt(E),F=(-D+R)/(2*T);c(F,L*F-L*S+e);const V=(-D-R)/(2*T);c(V,L*V-L*S+e)}return a},gl:(S,e,t,i,s,n,o,r,a)=>{let h=1e21,l=S,c=e;if(O.On(S,e,S,i,s,n,o,r,a)){const d=(a.x-s)**2+(a.y-n)**2;d<h&&(h=d,l=a.x,c=a.y)}if(O.On(t,e,t,i,s,n,o,r,a)){const d=(a.x-s)**2+(a.y-n)**2;d<h&&(h=d,l=a.x,c=a.y)}if(O.On(S,e,t,e,s,n,o,r,a)){const d=(a.x-s)**2+(a.y-n)**2;d<h&&(h=d,l=a.x,c=a.y)}if(O.On(S,i,t,i,s,n,o,r,a)){const d=(a.x-s)**2+(a.y-n)**2;d<h&&(h=d,l=a.x,c=a.y)}return a.i(l,c),h<1e21},Mw:(S,e,t)=>O.kC(S.x,S.y,S.width,S.height,e.x,e.y,t.x,t.y),kC:(S,e,t,i,s,n,o,r)=>{const a=S,h=S+t,l=e,c=e+i;if(s===o){let d=0,f=0;return n<r?(d=n,f=r):(d=r,f=n),a<=s&&s<=h&&d<=c&&f>=l}if(n===r){let d=0,f=0;return s<o?(d=s,f=o):(d=o,f=s),l<=n&&n<=c&&d<=h&&f>=a}return!!(G.contains(S,e,t,i,s,n)||G.contains(S,e,t,i,o,r)||O.su(a,l,h,l,s,n,o,r)||O.su(h,l,h,c,s,n,o,r)||O.su(h,c,a,c,s,n,o,r)||O.su(a,c,a,l,s,n,o,r))},su:(S,e,t,i,s,n,o,r)=>S===t&&e===i&&s===o&&n===r?S===s&&e===n:O.eu(S,e,t,i,s,n)*O.eu(S,e,t,i,o,r)<=0&&O.eu(s,n,o,r,S,e)*O.eu(s,n,o,r,t,i)<=0,eu:(S,e,t,i,s,n)=>{const o=t-S,r=i-e;let a=s-S,h=n-e,l=a*r-h*o;return l===0&&(l=a*o+h*r,l>0&&(a-=o,h-=r,l=a*o+h*r,l<0&&(l=0))),l},Ug:S=>(S<0&&(S+=360),S>=360&&(S-=360),S),TC:(S,e,t,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const r=i>s?-1:1,a=1e-5,h=o*2,l=[],c=o/2;let d=i,f=Math.min(h,Math.abs(s-i));if(f<a){const m=d+r*Math.min(f,c),p=S+t*Math.cos(d),y=e+t*Math.sin(d),x=S+t*Math.cos(m),b=e+t*Math.sin(m),M=(p+x)/2,P=(y+b)/2;return l.push([p,y,M,P,M,P,x,b]),l}for(;f>a;){const m=d+r*Math.min(f,c);l.push(O.tF(t,d,m,S,e)),f-=Math.abs(m-d),d=m}return l},tF:(S,e,t,i,s)=>{const n=(t-e)/2,o=S*Math.cos(n),r=S*Math.sin(n),a=o,h=-r,l=a*a+h*h,c=l+a*o+h*r,d=4/3*(Math.sqrt(2*l*c)-c)/(a*r-h*o),f=a-d*h,m=h+d*a,p=f,y=-m,x=n+e,b=Math.cos(x),M=Math.sin(x);return[i+S*Math.cos(e),s+S*Math.sin(e),i+f*b-m*M,s+f*M+m*b,i+p*b-y*M,s+p*M+y*b,i+S*Math.cos(t),s+S*Math.sin(t)]},Dg:(S,e,t,i,s,n,o)=>{const r=s,a=n,h=Math.floor((S-t)/r)*r+t,l=Math.floor((e-i)/a)*a+i;let c=h;h+r-S<r/2&&(c=h+r);let d=l;return l+a-e<a/2&&(d=l+a),o.i(c,d),o},DC:(S,e)=>{let t=Math.max(S,e),i=Math.min(S,e),s=1,n=1;do s=t%i,n=i,t=i,i=s;while(s>0);return n},iF:(S,e,t,i)=>{const s=t<0,n=i<0;let o=0,r=0,a=0;S<e?(r=1,a=0):(r=0,a=1);let h=0,l=0,c=0,d=0;return o=r,h=o===0?S:e,c=o===0?t:i,(o===0?s:n)&&(c=-c),o=a,l=o===0?S:e,d=o===0?t:i,(o===0?s:n)&&(d=-d),O.eF(h,l,c,d,0,0)},eF:(S,e,t,i,s,n)=>{let o=0;if(i>0)if(t>0){const r=S*S,a=e*e,h=S*t,l=e*i;let c=-a+l,d=-a+Math.sqrt(h*h+l*l),f=c;const m=9999999999;for(let x=0;x<m&&(f=.5*(c+d),!(f===c||f===d));++x){const b=h/(f+r),M=l/(f+a),P=b*b+M*M-1;if(P>0)c=f;else if(P<0)d=f;else break}s=r*t/(f+r),n=a*i/(f+a);const p=s-t,y=n-i;o=Math.sqrt(p*p+y*y)}else s=0,n=e,o=Math.abs(i-e);else{const r=S*S-e*e,a=S*t;if(a<r){const h=a/r,l=h*h;s=S*h,n=e*Math.sqrt(Math.abs(1-l));const c=s-t;o=Math.sqrt(c*c+n*n)}else s=S,n=0,o=Math.abs(t-S)}return o},In:new N,Bg:new N,or:new N,rr:0,Vg:100};O.za=O.QD;var ee=(S=>(S[S.Line=1]="Line",S[S.Rectangle=2]="Rectangle",S[S.Ellipse=3]="Ellipse",S[S.Path=4]="Path",S))(ee||{}),re=(S=>(S[S.None=0]="None",S[S.Default=1]="Default",S[S.Fill=2]="Fill",S[S.Uniform=6]="Uniform",S))(re||{});const Ae=class Ae{constructor(e){g(this,"n");g(this,"zg");g(this,"Xg");g(this,"oc");g(this,"ru");g(this,"lu");g(this,"En");g(this,"Un");g(this,"Bn");g(this,"H");g(this,"we");g(this,"xe");g(this,"Qi");g(this,"_i");g(this,"Rs");g(this,"rc");g(this,"lc");I.Ki(this),this.n=2,e===void 0&&(e=4),this.H=e,this.we=0,this.xe=0,this.Qi=0,this._i=0,e===4?this.Rs=new Y:this.Rs=Ae.Nw,this.zg=this.Rs.nt,this.Xg=new G().u(),this.oc=null,this.ru=null,this.lu=NaN,this.En=U.TopLeft,this.Un=U.BottomRight,this.rc=NaN,this.lc=NaN,this.Bn=2}copy(){const e=new Ae;if(e.n=this.n&-2,e.H=this.H,e.we=this.we,e.xe=this.xe,e.Qi=this.Qi,e._i=this._i,this.H===4){const t=this.Rs.r,i=e.Rs;for(let s=0;s<t.length;s++){const n=t[s];i.add(n.copy())}e.Rs=i}else e.Rs=this.Rs;return e.zg=this.zg,e.Xg.a(this.Xg),e.oc=this.oc,e.ru=this.ru,e.lu=this.lu,e.En=this.En.P(),e.Un=this.Un.P(),e.rc=this.rc,e.lc=this.lc,e.Bn=this.Bn,e}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){if(this.h=!0,this.type!==4)return this;const e=this.figures;e.u();for(const t of e)t.u();return this}equalsApprox(e){if(!(e instanceof Ae))return!1;if(this.type!==e.type)return this.type===1&&e.type===4?this.FC(e):e.type===1&&this.type===4?e.FC(this):!1;if(this.type===4){const t=this.figures.r,i=e.figures.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}else return O.f(this.startX,e.startX)&&O.f(this.startY,e.startY)&&O.f(this.endX,e.endX)&&O.f(this.endY,e.endY)}FC(e){if(this.type!==1||e.type!==4)return!1;if(e.figures.count===1){const t=e.figures.elt(0);if(t.segments.count===1&&O.f(this.startX,t.startX)&&O.f(this.startY,t.startY)){const i=t.segments.elt(0);if(i.type===2&&O.f(this.endX,i.endX)&&O.f(this.endY,i.endY))return!0}}return!1}static stringify(e){return e.toString()}static stringifyFixed(e){return t=>t.toString(e)}oi(e){e in ee?this.type=e:u.er(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i;switch(this.type){case 1:return e<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.startX)+" "+t(this.startY)+"L"+t(this.endX)+" "+t(this.endY);case 2:return i=new G(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+t(i.x)+" "+t(i.y)+"H"+t(i.right)+"V"+t(i.bottom)+"H"+t(i.left)+"z";case 3:if(i=new G(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),e<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),a=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+a+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}else{const r=t(i.left)+" "+t(i.y+i.height/2),a=t(i.right)+" "+t(i.y+i.height/2);return"M"+r+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+a+"A"+t(i.width/2)+" "+t(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];r>0&&(s+=" x "),a.isFilled&&(s+="F "),s+=a.toString(e)}return s;default:return ee[this.type]}}static fillPath(e){const t=e.split(/[Xx]/),i=t.length;let s="";for(let n=0;n<i;n++){const o=t[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static parse(e,t){t===void 0&&(t=!1);const i=new RegExp("(["+Ae.Yg+"])(["+Ae.Yg+"])","gm"),s=new RegExp("(["+Ae.Yg+"])([^s])","gm"),n=new RegExp("([^s])(["+Ae.Yg+"])","gm");e=e.replace(/,/gm," "),e=e.replace(i,"$1 $2"),e=e.replace(i,"$1 $2"),e=e.replace(s,"$1 $2"),e=e.replace(n,"$1 $2"),e=e.replace(/([0-9])([+\-])/gm,"$1 $2"),e=e.replace(/[\s\r\t\n]+/gm," "),e=e.replace(/^\s+|\s+$/g,"");const o=e.split(" ");for(let F=0;F<o.length;F++){const V=o[F];if(V.match(/(\.[0-9]*)(\.)/gm)!==null){const K=u.et();let H="",W=!1;for(let J=0;J<V.length;J++){const $=V[J];$==="."&&!W?(W=!0,H+=$):$==="."?(K.push(H),H="."):H+=$}K.push(H),o.splice(F,1);for(let J=0;J<K.length;J++)o.splice(F+J,0,K[J]);F+=K.length-1,u.J(K)}}let r=-1,a="",h="";const l=new C(0,0),c=new C(0,0),d=new C(0,0);let f=!0;function m(){return r>=P-1||o[r+1].match(E)!==null?!0:(f=!1,!1)}function p(){return r++,o[r]}function y(F){let V=parseFloat(p()),K=parseFloat(p());a===a.toLowerCase()&&(V=d.x+V,K=d.y+K),F.i(V,K)}function x(){return y(d),d}function b(){return y(c),c}function M(){const F=h.toLowerCase();return F==="c"||F==="s"||F==="q"||F==="t"?new C(2*d.x-c.x,2*d.y-c.y):new C(d.x,d.y)}const P=o.length,k=Ls.RC(null);let L=!1,T=!1,D=!1,B=!0;const E=new RegExp("["+Ae.Yg+"]");for(;!(r>=P-1);){if(h=a,a=p(),a==="")continue;f=!0;let F=!1;switch(a.toUpperCase()){case"X":B=!0,L=!1,T=!1;break;case"M":const V=x();for(k.bi===null||B===!0?(k.hu(V.x,V.y,L,!1,!T,D),B=!1):k.sF(V.x,V.y),l.a(d);!m();){const K=x();k.lr(K.x,K.y)}break;case"L":for(;!m();){const K=x();k.lr(K.x,K.y)}f&&(F=!0);break;case"H":for(;!m();)d.i((a===a.toLowerCase()?d.x:0)+parseFloat(p()),d.y),k.lr(d.x,d.y);break;case"V":for(;!m();)d.i(d.x,(a===a.toLowerCase()?d.y:0)+parseFloat(p())),k.lr(d.x,d.y);f&&(F=!0);break;case"C":for(;!m();){const K=new C;y(K);const H=b(),W=x();k.hr(K.x,K.y,H.x,H.y,W.x,W.y)}f&&(F=!0);break;case"S":for(;!m();){const K=M(),H=b(),W=x();k.hr(K.x,K.y,H.x,H.y,W.x,W.y)}f&&(F=!0);break;case"Q":for(;!m();){const K=b(),H=x();k.Cw(K.x,K.y,H.x,H.y)}f&&(F=!0);break;case"T":for(;!m();){const K=M();c.a(K);const H=x();k.Cw(K.x,K.y,H.x,H.y),c.a(H)}f&&(F=!0);break;case"B":for(;!m();){const K=parseFloat(p()),H=parseFloat(p());let W=parseFloat(p()),J=parseFloat(p());const $=parseFloat(p());let et=$,ot=!1;m()||(et=parseFloat(p()),m()||(ot=parseFloat(p())!==0)),a===a.toLowerCase()&&(W+=d.x,J+=d.y),k.nF(K,H,W,J,$,et,ot)}f&&(F=!0);break;case"A":for(;!m();){const K=Math.abs(parseFloat(p())),H=Math.abs(parseFloat(p())),W=parseFloat(p());let J=!1,$=!1,et=0,ot=0;const Ct=p();Ct.length===1?(J=!!parseFloat(Ct),$=!!parseFloat(p()),et=parseFloat(p()),ot=parseFloat(p())):Ct.length===2?(J=!!parseFloat(Ct[0]),$=!!parseFloat(Ct[1]),et=parseFloat(p()),ot=parseFloat(p())):(J=!!parseFloat(Ct[0]),$=!!parseFloat(Ct[1]),et=parseFloat(Ct.slice(2)),ot=parseFloat(p())),a===a.toLowerCase()&&(et=d.x+et,ot=d.y+ot),d.i(et,ot),k.oF(K,H,W,J,$,et,ot)}f&&(F=!0);break;case"Z":k.rF(),d.a(l);break;case"F":{let K="",H=1;for(;o[r+H];){if(o[r+H]==="0"){D=!0,H++;continue}if(o[r+H].match(/[Uu]/)!==null){H++;continue}if(o[r+H].match(E)===null){H++;continue}K=o[r+H];break}K.match(/[Mm]/)?L=!0:k.lF();break}case"U":{let K="",H=1;for(;o[r+H];){if(o[r+H].match(/[Ff]/)!==null){H++;continue}if(o[r+H].match(E)===null){H++;continue}K=o[r+H];break}K.match(/[Mm]/)?T=!0:k.hF(!1);break}default:if(a==="0"||a==="1")break;u.ni("Unknown geometry command: "+a);break}if(F){u.ni(`Bad geometry command: ${a}, next token: ${p()},
string: ${e}`);break}}const R=k.Gg;if(Ls.vC(k),t){const F=R.figures.iterator;for(;F.next();){const V=F.value;V.isFilled=!0}}return R}static OC(e,t){const i=e.length,s=C.l();for(let n=0;n<i;n++){const o=e[n];s.x=o[0],s.y=o[1],t.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],t.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],t.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],t.gt(s),o[6]=s.x,o[7]=s.y}C.e(s)}Hk(){if(this.wt)return!0;if(this.type===4){const e=this.figures;if(this.zg!==e.nt)return!0;const t=this.figures.r,i=t.length;for(let s=0;s<i;s++)if(t[s].Hk())return!0}return!1}Lw(){if(this.wt=!1,this.oc=null,this.ru=null,this.lu=NaN,this.type===4){const t=this.figures;this.zg=t.nt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].aF()}const e=this.Xg;e.Pt(),isNaN(this.rc)||isNaN(this.lc)?e.i(0,0,0,0):e.i(0,0,this.rc,this.lc),this.IC(e,!1),e.unionNoCheck(0,0,0,0),e.u()}computeBoundsWithoutOrigin(){const e=new G;return this.IC(e,!0),e}IC(e,t){switch(this.type){case 1:case 2:case 3:t?e.i(this.we,this.xe,0,0):e.unionNoCheck(this.we,this.xe,0,0),e.unionNoCheck(this.Qi,this._i,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];t&&o===0?e.i(r.startX,r.startY,0,0):e.unionNoCheck(r.startX,r.startY,0,0);const a=r.segments.r,h=a.length;let l=r.startX,c=r.startY;for(let d=0;d<h;d++){const f=a[d];switch(f.type){case 2:case 1:l=f.endX,c=f.endY,e.unionNoCheck(l,c,0,0);break;case 3:O.ou(l,c,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,e),l=f.endX,c=f.endY;break;case 4:O.jk(l,c,f.point1X,f.point1Y,f.endX,f.endY,.5,e),l=f.endX,c=f.endY;break;case 5:case 6:const m=f.type===5?f.bo(r):f.Bh(r,l,c),p=m.length;if(p===0){l=f.type===5?f.centerX:f.endX,c=f.type===5?f.centerY:f.endY,e.unionNoCheck(l,c,0,0);break}let y=null;for(let x=0;x<p;x++)y=m[x],O.ou(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],.5,e);y!==null&&(l=y[6],c=y[7]);break;default:u.o("Unknown Segment type: "+f.type)}}}break;default:u.o("Unknown Geometry type: "+this.type)}}cF(e,t){const i=this.bounds;let s=e/i.width,n=t/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.h&&u.L(this);const e=this.computeBoundsWithoutOrigin();return this.offset(-e.x,-e.y),new C(-e.x,-e.y)}offset(e,t){return this.h&&u.L(this),this.T(1,0,0,1,e,t),this}scale(e,t){return this.h&&u.L(this),this.T(e,0,0,t,0,0),this}rotate(e,t,i){this.h&&u.L(this),t===void 0&&(t=0),i===void 0&&(i=0);const s=Pt.l();return s.Ri(),s.cs(e,t,i),this.T(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Pt.e(s),this}T(e,t,i,s,n,o){let r=0,a=0;switch(this.type){case 1:case 2:case 3:r=this.we,a=this.xe,this.we=r*e+a*i+n,this.xe=r*t+a*s+o,r=this.Qi,a=this._i,this.Qi=r*e+a*i+n,this._i=r*t+a*s+o;break;case 4:const h=this.figures.r,l=h.length;for(let c=0;c<l;c++){const d=h[c];r=d.startX,a=d.startY,d.startX=r*e+a*i+n,d.startY=r*t+a*s+o;const f=d.segments.r,m=f.length;for(let p=0;p<m;p++){const y=f[p];switch(y.type){case 2:case 1:r=y.endX,a=y.endY,y.endX=r*e+a*i+n,y.endY=r*t+a*s+o;break;case 3:r=y.point1X,a=y.point1Y,y.point1X=r*e+a*i+n,y.point1Y=r*t+a*s+o,r=y.point2X,a=y.point2Y,y.point2X=r*e+a*i+n,y.point2Y=r*t+a*s+o,r=y.endX,a=y.endY,y.endX=r*e+a*i+n,y.endY=r*t+a*s+o;break;case 4:r=y.point1X,a=y.point1Y,y.point1X=r*e+a*i+n,y.point1Y=r*t+a*s+o,r=y.endX,a=y.endY,y.endX=r*e+a*i+n,y.endY=r*t+a*s+o;break;case 5:if(r=y.centerX,a=y.centerY,y.centerX=r*e+a*i+n,y.centerY=r*t+a*s+o,t!==0){let x=Math.atan2(t,e)*180/Math.PI;x<0&&(x+=360),y.startAngle+=x}e<0&&(y.startAngle=180-y.startAngle,y.sweepAngle=-y.sweepAngle),s<0&&(y.startAngle=-y.startAngle,y.sweepAngle=-y.sweepAngle),y.radiusX*=Math.sqrt(e*e+i*i),y.radiusY!==void 0&&(y.radiusY*=Math.sqrt(t*t+s*s));break;case 6:if(r=y.endX,a=y.endY,y.endX=r*e+a*i+n,y.endY=r*t+a*s+o,y.radiusX===0||y.radiusY===0)break;if(t!==0){let x=Math.atan2(t,e)*180/Math.PI;x<0&&(x+=360),y.xAxisRotation+=x}e<0&&(y.xAxisRotation=180-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),s<0&&(y.xAxisRotation=-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),y.radiusX*=Math.sqrt(e*e+i*i),y.radiusY*=Math.sqrt(t*t+s*s);break;default:u.o("Unknown Segment type: "+y.type)}}}break}return this.wt=!0,this}containsPoint(e,t){t===void 0&&(t=0);const i=this.we,s=this.xe,n=this.Qi,o=this._i;switch(this.type){case 1:return O.vi(i,s,n,o,t,e.x,e.y);case 2:{const r=Math.min(i,n)-t,a=Math.min(s,o)-t,h=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,c=G.V(r,a,h,l),d=c.containsPoint(e);return G.e(c),d}case 3:{let r=Math.min(i,n)-t,a=Math.min(s,o)-t;const h=Math.abs(n-i)+t*2,l=Math.abs(o-s)+t*2,c=h/2,d=l/2;return c<=0||d<=0?!1:(r=e.x-(r+c),a=e.y-(a+d),r*r/(c*c)+a*a/(d*d)<=1)}case 4:return this.qk(e,t,!0,!1);default:return!1}}qk(e,t,i,s){const n=e.x,o=e.y,r=this.bounds.x-20,a=o;let h=0,l=0,c=0,d=0,f=0,m=0;const p=this.figures.r,y=p.length;for(let x=0;x<y;x++){const b=p[x],M=!b.isEvenOdd;if(b.isFilled){if(i&&b.Wk(n,o,t))return!0}else{if(b.Wk(n,o,s?t:t+2))return!0;continue}const P=b.segments;l=b.startX,c=b.startY;let k=l,L=c;const T=P.r;for(let D=0;D<=P.length;D++){let B,E;switch(D!==P.length?(B=T[D],E=B.type,f=B.endX,m=B.endY):(E=2,f=k,m=L),E){case 1:{const R=this.Aw(n,o,r,a,l,c,k,L);if(isNaN(R))return!0;h+=R,k=f,L=m;break}case 2:{const R=this.Aw(n,o,r,a,l,c,f,m);if(isNaN(R))return!0;h+=R;break}case 3:d=O.Eg(l,c,B.point1X,B.point1Y,B.point2X,B.point2Y,f,m,r,a,n,o,.5),h+=d;break;case 4:{const R=(l+2*B.point1X)/3,F=(c+2*B.point1Y)/3,V=(B.point1X*2+f)/3,K=(B.point1Y*2+m)/3;d=O.Eg(l,c,R,F,V,K,f,m,r,a,n,o,.5),h+=d;break}case 5:case 6:{const R=B.type===5?B.bo(b):B.Bh(b,l,c),F=R.length;if(F===0){const K=this.Aw(n,o,r,a,l,c,B.type===5?B.centerX:B.endX,B.type===5?B.centerY:B.endY);if(isNaN(K))return!0;h+=K;break}let V=null;for(let K=0;K<F;K++){if(V=R[K],K===0){const H=this.Aw(n,o,r,a,l,c,V[0],V[1]);if(isNaN(H))return!0;h+=H}d=O.Eg(V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7],r,a,n,o,.5),h+=d}V!==null&&(f=V[6],m=V[7]);break}default:u.o("Unknown Segment type: "+B.type)}l=f,c=m}if(M){if(h!==0)return!0}else if(h%2!==0)return!0;h=0}return!1}Aw(e,t,i,s,n,o,r,a){if(O.vi(n,o,r,a,.05,e,t))return NaN;const h=(e-i)*(o-a);if(h===0)return 0;const l=((e*s-t*i)*(n-r)-(e-i)*(n*a-o*r))/h,c=(e*s-t*i)*(o-a)/h;if(l>=e)return 0;if((n>r?n-r:r-n)<(o>a?o-a:a-o)){if(o<a){if(c<o||c>a)return 0}else if(c<a||c>o)return 0}else if(n<r){if(l<n||l>r)return 0}else if(l<r||l>n)return 0;return h>0?1:-1}EC(e,t,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].Wk(e,t,i))return!0;return!1}getPointAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=new C),this.type===1)return t.i(this.startX+e*(this.endX-this.startX),this.startY+e*(this.endY-this.startY)),t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let a=0;for(let h=0;h<o;h++){const l=s[h],c=l.length;for(let d=0;d<c;d++){const f=l[d];if(a+f>=r){const m=r-a,p=f===0?0:m/f,y=i[h],x=y[d*2],b=y[d*2+1],M=y[d*2+2],P=y[d*2+3];return t.i(x+(M-x)*p,b+(P-b)*p),t}a+=f}}return t}getAngleAlongPath(e){if(e<0?e=0:e>1&&(e=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=t.length,o=s*e;let r=0;for(let a=0;a<n;a++){const h=i[a],l=h.length;for(let c=0;c<l;c++){const d=h[c];if(r+d>=o){const f=t[a],m=f[c*2],p=f[c*2+1],y=f[c*2+2],x=f[c*2+3];return Math.abs(y-m)<1&&Math.abs(x-p)<1?0:Math.abs(y-m)<1?x-p>=0?90:270:Math.abs(x-p)<1?y-m>=0?0:180:Math.atan2(x-p,y-m)*180/Math.PI}r+=d}}return NaN}getPointAndAngleAlongPath(e,t){if(e<0?e=0:e>1&&(e=1),t===void 0&&(t=[]),t.length=3,this.type===1)return t[0]=this.startX+e*(this.endX-this.startX),t[1]=this.startY+e*(this.endY-this.startY),t[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,t;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*e;let a=0;for(let h=0;h<o;h++){const l=s[h],c=l.length;for(let d=0;d<c;d++){const f=l[d];if(a+f>=r){const m=r-a,p=f===0?0:m/f,y=i[h],x=y[d*2],b=y[d*2+1],M=y[d*2+2],P=y[d*2+3];t[0]=x+(M-x)*p,t[1]=b+(P-b)*p;let k;return Math.abs(M-x)<1&&Math.abs(P-b)<1?k=0:Math.abs(M-x)<1?k=P-b>=0?90:270:Math.abs(P-b)<1?k=M-x>=0?0:180:k=Math.atan2(P-b,M-x)*180/Math.PI,t[2]=k,t}a+=f}}return t}getFractionForPoint(e){if(this.type===1){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=e.x,r=e.y;let a=0,h=0;if(t===s)return i<n?(a=i,h=n):(a=n,h=i),r<=a?a===i?0:1:r>=h?h===i?0:1:Math.abs(r-i)/(h-a);if(i===n)return t<s?(a=t,h=s):(a=s,h=t),o<=a?a===t?0:1:o>=h?h===t?0:1:Math.abs(o-t)/(h-a);{const l=(s-t)**2+(n-i)**2,c=C.l();O.dl(t,i,s,n,o,r,c);const d=c.x,f=c.y;return C.e(c),Math.sqrt(((d-t)**2+(f-i)**2)/l)}}}else if(this.type===2){const t=this.startX,i=this.startY,s=this.endX,n=this.endY;if(t===s&&i===n)return 0;{const o=s-t,r=n-i,a=o*2+r*2;let h=e.x,l=e.y;h=Math.min(Math.max(h,t),s),l=Math.min(Math.max(l,i),n);const c=Math.abs(h-t),d=Math.abs(h-s),f=Math.abs(l-i),m=Math.abs(l-n),p=Math.min(c,d,f,m);if(p===f)return h/a;if(p===d)return(o+l)/a;if(p===m)return(o*2+r-h)/a;if(p===c)return(o*2+r*2-l)/a}}else{const t=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=C.l();let o=1/0,r=0,a=0;const h=t.length;let l=0,c=0;for(let f=0;f<h;f++){const m=t[f],p=i[f],y=m.length;for(let x=0;x<y;x+=2){const b=m[x],M=m[x+1];if(x===0){l=b,c=M;continue}O.dl(l,c,b,M,e.x,e.y,n);const P=(n.x-e.x)**2+(n.y-e.y)**2;P<o&&(o=P,r=a,r+=Math.sqrt((n.x-l)**2+(n.y-c)**2)),a+=p[(x-2)/2],l=b,c=M}}C.e(n);const d=r/s;return d<0?0:d>1?1:d}return 0}get flattenedSegments(){return this.UC(),this.oc}UC(){if(this.oc===null){const e=this.oc=[],t=this.ru=[];this.fF(e,t)}}get flattenedLengths(){return this.UC(),this.ru}get flattenedTotalLength(){let e=this.lu;if(isNaN(e)){if(this.type===1){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(this.type===2){const t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=t*2+i*2}else{const t=this.flattenedLengths,i=t.length;e=0;for(let s=0;s<i;s++){const n=t[s],o=n.length;for(let r=0;r<o;r++)e+=n[r]}}this.lu=e}return e}Jk(e){const t=[];let i=0,s=0;const n=e.length;for(let o=0;o<n;o+=2){const r=e[o],a=e[o+1];if(o===0){i=r,s=a;continue}const h=Math.sqrt(C.distanceSquared(i,s,r,a));t.push(h),i=r,s=a}return t}fF(e,t){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),e.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),t.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),e.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),t.push(s);else if(this.type===3){const n=new Gt;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new Mt(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.bo(n),a=r.length;if(a===0)i.push(o.centerX),i.push(o.centerY);else{let h=n.startX,l=n.startY;for(let c=0;c<a;c++){const d=r[c];O.vn(h,l,d[2],d[3],d[4],d[5],d[6],d[7],.5,i),h=d[6],l=d[7]}}e.push(i),t.push(this.Jk(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,a=o.startY,h=r,l=a;const c=o.segments.r,d=c.length;for(let f=0;f<d;f++){const m=c[f];switch(m.type){case 1:i.length>=4&&(e.push(i),t.push(this.Jk(i))),i=[],i.push(m.endX),i.push(m.endY),r=m.endX,a=m.endY,h=r,l=a;break;case 2:i.push(m.endX),i.push(m.endY),r=m.endX,a=m.endY;break;case 3:O.vn(r,a,m.point1X,m.point1Y,m.point2X,m.point2Y,m.endX,m.endY,.5,i),r=m.endX,a=m.endY;break;case 4:O.Og(r,a,m.point1X,m.point1Y,m.endX,m.endY,.5,i),r=m.endX,a=m.endY;break;case 5:{const p=m.bo(o),y=p.length;if(y===0){i.push(m.centerX),i.push(m.centerY),r=m.centerX,a=m.centerY;break}for(let x=0;x<y;x++){const b=p[x];O.vn(r,a,b[2],b[3],b[4],b[5],b[6],b[7],.5,i),r=b[6],a=b[7]}break}case 6:{const p=m.Bh(o,r,a),y=p.length,x=m.endX,b=m.endY;if(y===0){i.push(x),i.push(b),r=x,a=b;break}for(let M=0;M<y;M++){const P=p[M];O.vn(r,a,P[2],P[3],P[4],P[5],P[6],P[7],.5,i),r=P[6],a=P[7]}break}default:u.o("Segment not of valid type: "+m.type)}m.isClosed&&(i.push(h),i.push(l))}i.length>=4&&(e.push(i),t.push(this.Jk(i)))}}}get type(){return this.H}set type(e){this.H!==e&&(this.h&&u.L(this,e),this.H=e,e===4?this.Rs=new Y:(Ae.Nw===null&&(Ae.Nw=new Y().u()),this.Rs=Ae.Nw),this.wt=!0)}get startX(){return this.we}set startX(e){this.we!==e&&(this.h&&u.L(this,e),this.we=e,this.wt=!0)}get startY(){return this.xe}set startY(e){this.xe!==e&&(this.h&&u.L(this,e),this.xe=e,this.wt=!0)}get endX(){return this.Qi}set endX(e){this.Qi!==e&&(this.h&&u.L(this,e),this.Qi=e,this.wt=!0)}get endY(){return this._i}set endY(e){this._i!==e&&(this.h&&u.L(this,e),this._i=e,this.wt=!0)}get figures(){return this.Rs}set figures(e){this.Rs!==e&&(this.h&&u.L(this,e),this.Rs=e,this.wt=!0)}add(e){return this.Rs.add(e),this}setSpots(e,t,i,s,n,o,r,a){return this.h&&u.L(this),this.En=new U(e,t,n,o).u(),this.Un=new U(i,s,r,a).u(),this}get spot1(){return this.En}set spot1(e){this.h&&u.L(this,e),this.En=e.P()}get spot2(){return this.Un}set spot2(e){this.h&&u.L(this,e),this.Un=e.P()}get defaultStretch(){return this.Bn}set defaultStretch(e){this.Bn=e}get bounds(){return this.Hk()&&this.Lw(),this.Xg}};g(Ae,"Line",1),g(Ae,"Rectangle",2),g(Ae,"Ellipse",3),g(Ae,"Path",4),g(Ae,"Nw",new Y().u()),g(Ae,"Yg","UuBbMmZzLlHhVvCcSsQqTtAaFfXx");let Tt=Ae;Tt.stringify=Tt.stringify,Tt.stringifyFixed=Tt.stringifyFixed,Tt.fillPath=Tt.fillPath,Tt.parse=Tt.parse;class Gt{constructor(e,t,i,s,n){g(this,"n");g(this,"we");g(this,"xe");g(this,"hc");g(this,"Kg");g(this,"Ee");i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),e!==void 0?this.we=e:this.we=0,t!==void 0?this.xe=t:this.xe=0,this.hc=new Y,this.Kg=this.hc.nt,this.Ee=null}copy(){const e=new Gt;e.n=this.n&-2,e.we=this.we,e.xe=this.xe;const t=this.hc.r,i=t.length,s=e.hc;for(let n=0;n<i;n++){const o=t[n].copy();s.add(o)}return e.Kg=this.Kg,e.Ee=this.Ee,e}equalsApprox(e){if(!(e instanceof Gt)||!O.f(this.startX,e.startX)||!O.f(this.startY,e.startY))return!1;const t=this.segments.r,i=e.segments.r,s=t.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=t[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}toString(e){e===void 0&&(e=-1);let t="";if(e<0)t="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(e);t="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+o.toString(e)}return t}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){this.h=!0;const e=this.segments;e.u();const t=e.r,i=e.length;for(let s=0;s<i;s++)t[s].u();return this}Hk(){if(this.wt)return!0;const e=this.segments;if(this.Kg!==e.nt)return!0;for(const t of e)if(t.wt)return!0;return!1}aF(){this.wt=!1,this.Ee=null;const e=this.segments;this.Kg=e.nt;for(const t of e)t.wt=!1,t.vs=null}get isFilled(){return(this.n&4)!==0}set isFilled(e){this.h&&u.L(this,e),e?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(e){this.h&&u.L(this,e),e?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(e){this.h&&u.L(this,e),e?this.n|=16:this.n&=-17}get startX(){return this.we}set startX(e){this.h&&u.L(this,e),this.we=e,this.Ee=null,this.wt=!0}get startY(){return this.xe}set startY(e){this.h&&u.L(this,e),this.xe=e,this.Ee=null,this.wt=!0}get segments(){return this.hc}set segments(e){this.h&&u.L(this,e),this.hc=e,this.Ee=null,this.wt=!0}add(e){return this.hc.add(e),this.Ee=null,this}Wk(e,t,i){const s=this;let n=s.startX,o=s.startY,r=n,a=o;const h=s.segments.r,l=h.length;for(let c=0;c<l;c++){const d=h[c];switch(d.type){case 1:r=d.endX,a=d.endY,n=d.endX,o=d.endY;break;case 2:if(O.vi(n,o,d.endX,d.endY,i,e,t))return!0;n=d.endX,o=d.endY;break;case 3:if(O.Sw(n,o,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,e,t,i))return!0;n=d.endX,o=d.endY;break;case 4:if(O.Kk(n,o,d.point1X,d.point1Y,d.endX,d.endY,.5,e,t,i))return!0;n=d.endX,o=d.endY;break;case 5:case 6:const f=d.type===5?d.bo(s):d.Bh(s,n,o),m=f.length,p=d.type===5?d.centerX:d.endX,y=d.type===5?d.centerY:d.endY;if(m===0){if(O.vi(n,o,p,y,i,e,t))return!0;n=p,o=y;break}let x=null;for(let b=0;b<m;b++)if(x=f[b],b===0&&O.vi(n,o,x[0],x[1],i,e,t)||O.Sw(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],.5,e,t,i))return!0;x!==null&&(n=x[6],o=x[7]);break;default:u.o("Unknown Segment type: "+d.type)}if(d.isClosed&&(n!==r||o!==a)&&O.vi(n,o,r,a,i,e,t))return!0}return!1}}var we=(S=>(S[S.Move=1]="Move",S[S.Line=2]="Line",S[S.Bezier=3]="Bezier",S[S.QuadraticBezier=4]="QuadraticBezier",S[S.Arc=5]="Arc",S[S.SvgArc=6]="SvgArc",S))(we||{});const ci=class ci{constructor(e,t,i,s,n,o,r,a){g(this,"H");g(this,"n");g(this,"Qi");g(this,"_i");g(this,"tn");g(this,"pl");g(this,"yl");g(this,"ar");g(this,"vs");if(I.Ki(this),e===void 0&&(e=2),this.H=e,this.n=2,t!==void 0?this.Qi=t:this.Qi=0,i!==void 0?this._i=i:this._i=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),e===6){let h=o;h=h%360,h<0&&(h+=360),this.tn=h,this.pl=0,this.yl=Math.max(s,0),this.ar=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),a&&(this.isClockwiseArc=!0)}else this.tn=s,this.pl=n,e===5&&(o=Math.max(o,0)),this.yl=o,typeof r=="number"?(e===5&&(r=Math.max(r,0)),this.ar=r):this.ar=0;this.vs=null}copy(){const e=new ci;return e.H=this.H,e.n=this.n&-2,e.Qi=this.Qi,e._i=this._i,e.tn=this.tn,e.pl=this.pl,e.yl=this.yl,e.ar=this.ar,e}equalsApprox(e){if(!(e instanceof ci)||this.type!==e.type||this.isClosed!==e.isClosed)return!1;switch(this.type){case 1:case 2:return O.f(this.endX,e.endX)&&O.f(this.endY,e.endY);case 3:return O.f(this.endX,e.endX)&&O.f(this.endY,e.endY)&&O.f(this.point1X,e.point1X)&&O.f(this.point1Y,e.point1Y)&&O.f(this.point2X,e.point2X)&&O.f(this.point2Y,e.point2Y);case 4:return O.f(this.endX,e.endX)&&O.f(this.endY,e.endY)&&O.f(this.point1X,e.point1X)&&O.f(this.point1Y,e.point1Y);case 5:return O.f(this.startAngle,e.startAngle)&&O.f(this.sweepAngle,e.sweepAngle)&&O.f(this.centerX,e.centerX)&&O.f(this.centerY,e.centerY)&&O.f(this.radiusX,e.radiusX)&&O.f(this.radiusY,e.radiusY);case 6:return this.isClockwiseArc===e.isClockwiseArc&&this.isLargeArc===e.isLargeArc&&O.f(this.xAxisRotation,e.xAxisRotation)&&O.f(this.endX,e.endX)&&O.f(this.endY,e.endY)&&O.f(this.radiusX,e.radiusX)&&O.f(this.radiusY,e.radiusY);default:return!1}}oi(e){e in we?this.type=e:u.er(this,e)}toString(e){e===void 0&&(e=-1);const t=s=>s===0?"0":s.toFixed(e);let i="";switch(this.type){case 1:e<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+t(this.endX)+" "+t(this.endY);break;case 2:e<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+t(this.endX)+" "+t(this.endY);break;case 3:e<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.point2X)+" "+t(this.point2Y)+" "+t(this.endX)+" "+t(this.endY);break;case 4:e<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.endX)+" "+t(this.endY);break;case 5:e<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+t(this.startAngle)+" "+t(this.sweepAngle)+" "+t(this.centerX)+" "+t(this.centerY)+" "+t(this.radiusX)+" "+t(this.radiusY);break;case 6:e<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+t(this.radiusX)+" "+t(this.radiusY)+" "+t(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+t(this.endX)+" "+t(this.endY);break;default:i=we[this.type]}return i+(this.isClosed?"z":"")}get h(){return(this.n&1)!==0}set h(e){e?this.n|=1:this.n&=-2}get wt(){return(this.n&2)!==0}set wt(e){e?this.n|=2:this.n&=-3}u(){return this.h=!0,this}close(){return this.isClosed=!0,this}bo(e){if(this.vs!==null&&e.wt===!1)return this.vs;const t=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=t),t===0||i===0)return this.vs=[],this.vs;const s=this.tn,n=this.pl,o=O.TC(0,0,t<i?t:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(t!==i){const a=Pt.l();a.Ri(),t<i?a.tt(1,i/t):a.tt(t/i,1),Tt.OC(o,a),Pt.e(a)}const r=o.length;for(let a=0;a<r;a++){const h=o[a];h[0]+=s,h[1]+=n,h[2]+=s,h[3]+=n,h[4]+=s,h[5]+=n,h[6]+=s,h[7]+=n}return this.vs=o,this.vs}Bh(e,t,i){if(this.vs!==null&&e.wt===!1)return this.vs;if(this.radiusX===0||this.radiusY===0)return this.vs=[],this.vs;const s=t,n=i;let o=this.yl,r=this.ar;o===0&&(o=1e-4),r===0&&(r=1e-4);const a=this.tn*(Math.PI/180),h=this.isLargeArc,l=this.isClockwiseArc,c=this.Qi,d=this._i,f=Math.cos(a),m=Math.sin(a),p=f*(s-c)/2+m*(n-d)/2,y=-m*(s-c)/2+f*(n-d)/2,x=p*p/(o*o)+y*y/(r*r);x>1&&(o*=Math.sqrt(x),r*=Math.sqrt(x));let b=(h===l?-1:1)*Math.sqrt((o*o*r*r-o*o*y*y-r*r*p*p)/(o*o*y*y+r*r*p*p));isNaN(b)&&(b=0);let M=b*o*y/r,P=b*-r*p/o;isNaN(M)&&(M=0),isNaN(P)&&(P=0);const k=(s+c)/2+f*M-m*P,L=(n+d)/2+m*M+f*P,T=(ht,dt)=>Math.sqrt(ht*ht+dt*dt),D=(ht,dt,ct,ft)=>(ht*ct+dt*ft)/(T(ht,dt)*T(ct,ft)),B=(ht,dt,ct,ft)=>(ht*ft<dt*ct?-1:1)*Math.acos(D(ht,dt,ct,ft)),E=B(1,0,(p-M)/o,(y-P)/r),R=(p-M)/o,F=(y-P)/r,V=(-p-M)/o,K=(-y-P)/r;let H=B(R,F,V,K);const W=D(R,F,V,K);W<=-1?H=Math.PI:W>=1&&(H=0),!l&&H>0&&(H=H-2*Math.PI),l&&H<0&&(H=H+2*Math.PI);const J=o>r?o:r,$=o>r?1:o/r,et=o>r?r/o:1,ot=O.TC(0,0,J,E,E+H,!0),Ct=Pt.l();return Ct.Ri(),Ct.Fs(k,L),Ct.cs(this.tn,0,0),Ct.tt($,et),Tt.OC(ot,Ct),Pt.e(Ct),this.vs=ot,this.vs}get isClosed(){return(this.n&8)!==0}set isClosed(e){this.isClosed!==e&&(e?this.n|=8:this.n&=-9,this.wt=!0)}get type(){return this.H}set type(e){this.h&&u.L(this,e),this.H=e,this.wt=!0}get endX(){return this.Qi}set endX(e){this.h&&u.L(this,e),this.Qi=e,this.wt=!0}get endY(){return this._i}set endY(e){this.h&&u.L(this,e),this._i=e,this.wt=!0}get point1X(){return this.tn}set point1X(e){this.h&&u.L(this,e),this.tn=e,this.wt=!0}get point1Y(){return this.pl}set point1Y(e){this.h&&u.L(this,e),this.pl=e,this.wt=!0}get point2X(){return this.yl}set point2X(e){this.h&&u.L(this,e),this.yl=e,this.wt=!0}get point2Y(){return this.ar}set point2Y(e){this.h&&u.L(this,e),this.ar=e,this.wt=!0}get centerX(){return this.tn}set centerX(e){this.h&&u.L(this,e),this.tn=e,this.wt=!0}get centerY(){return this.pl}set centerY(e){this.h&&u.L(this,e),this.pl=e,this.wt=!0}get radiusX(){return this.yl}set radiusX(e){e<0&&u.W(e,">= zero",ci,"radiusX"),this.h&&u.L(this,e),this.yl=e,this.wt=!0}get radiusY(){return this.ar}set radiusY(e){e<0&&u.W(e,">= zero",ci,"radiusY"),this.h&&u.L(this,e),this.ar=e,this.wt=!0}get startAngle(){return this.Qi}set startAngle(e){this.h&&u.L(this,e),e=e%360,e<0&&(e+=360),this.Qi=e,this.wt=!0}get sweepAngle(){return this._i}set sweepAngle(e){this.h&&u.L(this,e),e>360&&(e=360),e<-360&&(e=-360),this._i=e,this.wt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(e){this.h&&u.L(this,e),e?this.n|=4:this.n&=-5,this.wt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(e){this.h&&u.L(this,e),e?this.n|=16:this.n&=-17,this.wt=!0}get xAxisRotation(){return this.tn}set xAxisRotation(e){this.h&&u.L(this,e),e=e%360,e<0&&(e+=360),this.tn=e,this.wt=!0}};g(ci,"Move",1),g(ci,"Line",2),g(ci,"Bezier",3),g(ci,"QuadraticBezier",4),g(ci,"Arc",5),g(ci,"SvgArc",6);let Mt=ci;class de{constructor(){g(this,"N");g(this,"Tw");g(this,"Dw");g(this,"jg");g(this,"Hg");g(this,"qg");g(this,"Wg");g(this,"Jg");g(this,"$g");g(this,"Zg");g(this,"Qg");g(this,"_g");g(this,"tm");g(this,"im");g(this,"ko");g(this,"em");g(this,"sm");g(this,"nm");g(this,"be");this.N=null,this.Tw=new C(0,0).u(),this.Dw=new C(0,0).u(),this.jg=0,this.Hg=0,this.qg=1,this.Wg="",this.Jg="",this.$g=!1,this.Zg=!1,this.Qg=0,this._g=0,this.tm=!1,this.im=!1,this.ko=!1,this.em=null,this.sm=0,this.nm=null,this.be=null}copy(){const e=new de;return this.clone(e)}clone(e){return e.N=this.N,e.Tw.a(this.viewPoint),e.Dw.a(this.documentPoint),e.jg=this.jg,e.Hg=this.Hg,e.qg=this.qg,e.Wg=this.Wg,e.Jg=this.Jg,e.$g=this.$g,e.Zg=this.Zg,e.Qg=this.Qg,e._g=this._g,e.tm=this.tm,e.im=this.im,e.ko=this.ko,e.em=this.em,e.sm=this.sm,e.nm=this.nm,e.be=this.be,e}toString(){let e="^";return this.modifiers!==0&&(e+="M:"+this.modifiers),this.button!==0&&(e+="B:"+this.button),this.key!==""&&(e+="K:"+this.key),this.clickCount!==0&&(e+="C:"+this.clickCount),this.delta!==0&&(e+="D:"+this.delta),this.handled&&(e+="h"),this.bubbles&&(e+="b"),this.documentPoint!==null&&(e+="@"+this.documentPoint.toString()),e}get diagram(){return this.N}set diagram(e){this.N=e}get viewPoint(){return this.Tw}set viewPoint(e){this.Tw.a(e)}get documentPoint(){return this.Dw}set documentPoint(e){this.Dw.a(e)}getMultiTouchViewPoint(e,t){const i=this.diagram;return i===null||i.BC(this.event,e,t),t}getMultiTouchDocumentPoint(e,t){const i=this.diagram;return i===null||(i.BC(this.event,e,t),t.a(i.transformViewToDoc(t))),t}get modifiers(){return this.jg}set modifiers(e){this.jg=e}get button(){return this.Hg}set button(e){if(this.Hg=e,this.event===null)switch(e){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.qg}set buttons(e){this.qg=e}get key(){return this.Wg}set key(e){this.Wg=e}get code(){return this.Jg}set code(e){this.Jg=e}get down(){return this.$g}set down(e){this.$g=e}get up(){return this.Zg}set up(e){this.Zg=e}get clickCount(){return this.Qg}set clickCount(e){this.Qg=e}get delta(){return this._g}set delta(e){this._g=e}get isMultiTouch(){return this.tm}set isMultiTouch(e){this.tm=e}get handled(){return this.im}set handled(e){this.im=e}get bubbles(){return this.ko}set bubbles(e){this.ko=e}get event(){return this.em}set event(e){this.em=e}get isTouchEvent(){const e=this.event;return e===null?!1:e.pointerType==="touch"||e.pointerType==="pen"}get timestamp(){return this.sm}set timestamp(e){this.sm=e}get targetDiagram(){return this.nm}set targetDiagram(e){this.nm=e}get targetObject(){return this.be}set targetObject(e){this.be=e}get control(){return(this.modifiers&1)!==0}set control(e){this.modifiers=e?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(e){this.modifiers=e?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(e){this.modifiers=e?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(e){this.modifiers=e?this.modifiers|8:this.modifiers&-9}get left(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(e){e?this.buttons|=1:this.buttons&=-2}get right(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(e){e?this.buttons|=2:this.buttons&=-3}get middle(){const e=this.event;return e!==null&&(e.type==="mousedown"||e.type==="mouseup"||e.type==="pointerdown"||e.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(e){e?this.buttons|=4:this.buttons&=-5}get commandKey(){const e=this.code,t=this.key;return"cxvyzagCXVYZAG".includes(t)?t.toLowerCase():e==="KeyC"?"c":e==="KeyX"?"x":e==="KeyV"?"v":e==="KeyY"?"y":e==="KeyZ"?"z":e==="KeyA"?"a":e==="KeyG"?"g":e!==""?e:t}}class Ve{constructor(){g(this,"N");g(this,"St");g(this,"om");g(this,"rm");this.N=null,this.St="",this.om=null,this.rm=null}copy(){const e=new Ve;return e.N=this.N,e.St=this.St,e.om=this.om,e.rm=this.rm,e}toString(){let e="*"+this.name;return this.subject!==null&&(e+=":"+this.subject.toString()),this.parameter!==null&&(e+="("+this.parameter.toString()+")"),e}get diagram(){return this.N}set diagram(e){this.N=e}get name(){return this.St}set name(e){this.St=e}get subject(){return this.om}set subject(e){this.om=e}get parameter(){return this.rm}set parameter(e){this.rm=e}}var ie=(S=>(S[S.Transaction=1]="Transaction",S[S.Property=2]="Property",S[S.Insert=3]="Insert",S[S.Remove=4]="Remove",S))(ie||{});const ds=class ds{constructor(){g(this,"au");g(this,"lm");g(this,"en");g(this,"ki");g(this,"N");g(this,"cu");g(this,"ac");g(this,"cc");g(this,"fc");g(this,"uc");this.au=2,this.lm="",this.en="",this.ki=null,this.N=null,this.cu=null,this.ac=null,this.cc=null,this.fc=null,this.uc=null}clear(){this.ki=null,this.N=null,this.cu=null,this.ac=null,this.cc=null,this.fc=null,this.uc=null}copy(){const e=new ds;e.au=this.au,e.lm=this.lm,e.en=this.en,e.ki=this.ki,e.N=this.N,e.cu=this.cu;let t=this.ac;return u.G(t)&&u.it(t.copyFrozen)?e.ac=t.copyFrozen():e.ac=t,t=this.cc,u.G(t)&&u.it(t.copyFrozen)?e.cc=t.copyFrozen():e.cc=t,t=this.fc,u.G(t)&&u.it(t.copyFrozen)?e.fc=t.copyFrozen():e.fc=t,t=this.uc,u.G(t)&&u.it(t.copyFrozen)?e.uc=t.copyFrozen():e.uc=t,e}oi(e){e in ie?this.change=e:u.er(this,e)}toString(){let e="";return this.change===1?e+="* ":this.change===2?e+=this.model!==null?"!m":"!d":e+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(e+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(e+=" "+this.modelChange),e+=": ",this.change===1?this.oldValue!==null&&(e+=" "+this.oldValue):(this.object!==null&&(e+=u.toString(this.object)),this.oldValue!==null&&(e+="  old: "+u.toString(this.oldValue)),this.oldParam!==null&&(e+=" "+this.oldParam),this.newValue!==null&&(e+="  new: "+u.toString(this.newValue)),this.newParam!==null&&(e+=" "+this.newParam)),e}getValue(e){return e?this.oldValue:this.newValue}getParam(e){return e?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.VC(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.VC(this,!1))}get model(){return this.ki}set model(e){this.ki=e}get diagram(){return this.N}set diagram(e){this.N=e}get change(){return this.au}set change(e){this.au=e}get modelChange(){return this.lm}set modelChange(e){this.lm=e}get propertyName(){return this.en}set propertyName(e){this.en=e}get isTransactionFinished(){return this.au===1&&(this.en==="CommittedTransaction"||this.en==="FinishedUndo"||this.en==="FinishedRedo")}get object(){return this.cu}set object(e){this.cu=e}get oldValue(){return this.ac}set oldValue(e){this.ac=e}get oldParam(){return this.cc}set oldParam(e){this.cc=e}get newValue(){return this.fc}set newValue(e){this.fc=e}get newParam(){return this.uc}set newParam(e){this.uc=e}};g(ds,"Transaction",1),g(ds,"Property",2),g(ds,"Insert",3),g(ds,"Remove",4);let be=ds;class Te{constructor(){g(this,"zC");g(this,"St");g(this,"$k");this.zC=new Y().u(),this.St="",this.$k=!1}toString(e){let t="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(e!==void 0&&e>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(t+=`
  `+n.toString())}}return t}clear(){const e=this.changes;e.Pt();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),e.u()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let e=this.changes.count-1;e>=0;e--){const t=this.changes.elt(e);t!==null&&t.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const e=this.changes.count;for(let t=0;t<e;t++){const i=this.changes.elt(t);i!==null&&i.redo()}}uF(e){const t=this.changes;for(let i=t.count-1;i>=e;i--){const s=t.elt(i);s!==null&&s.undo(),t.Pt(),t.removeAt(i)}t.u()}thaw(){this.changes.Pt()}optimize(){if(!this.isComplete)return;const e=this.changes;e.Pt();const t=new Z;for(let s=0;s<e.count;s++){const n=e.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=t.get(n.object);o||(o=new Z,t.set(n.object,o));const r=o.get(n.propertyName);r===null?o.set(n.propertyName,-1):(r>0&&e.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<e.count;s++){const n=e.elt(s);n!==null&&(s>i&&e.setElt(i,n),i++)}for(;e.length>i;)e.pop();e.u()}get changes(){return this.zC}get name(){return this.St}set name(e){this.St=e}get isComplete(){return this.$k}set isComplete(e){this.$k=e}}class ze{constructor(e){g(this,"Fw");g(this,"Oi");g(this,"XC");g(this,"Os");g(this,"Zk");g(this,"hm");g(this,"Vn");g(this,"Qk");g(this,"_k");g(this,"sn");g(this,"dc");g(this,"Rw");g(this,"Is");g(this,"vw");g(this,"Ow");g(this,"am");g(this,"Iw");this.Fw=new I,this.Oi=!1,this.XC=new Y().u(),this.Os=-1,this.Zk=999,this.Is=!1,this.hm=null,this.Vn=0,this.Qk=!1,this._k=23,this.sn=new Y().u(),this.dc=new Y,this.Rw=!0,this.vw=!1,this.Ow=!1,this.am=!1,this.Iw=!1,e&&Object.assign(this,e)}toString(e){let t="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;t+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(t+=" "),t+=this.nestedTransactionNames.elt(s);if(t+="]",e!==void 0&&e>0){i=this.history.count;for(let s=0;s<i;s++)t+=`
 `+this.history.elt(s).toString(e-1)}return t}clear(){const e=this.history;e.Pt();for(let t=e.count-1;t>=0;t--){const i=e.elt(t);i!==null&&i.clear()}e.clear(),this.Os=-1,e.u(),this.Is=!1,this.hm=null,this.Vn=0,this.sn.Pt(),this.sn.clear(),this.sn.u(),this.dc.clear(),this.vw=!1,this.Ow=!1,this.am=!1,this.Iw=!1}copyProperties(e){this.isEnabled=e.isEnabled,this.maxHistoryLength=e.maxHistoryLength,this.cm=e.cm}addModel(e){this.Fw.add(e)}removeModel(e){this.Fw.delete(e)}startTransaction(e){if(e===void 0&&(e=""),e===null&&(e=""),this.isUndoingRedoing)return!1;this.Rw===!0&&(this.Rw=!1,this.Vn++,this.wl||this.xl("StartingFirstTransaction",e,this.currentTransaction),this.Vn>0&&this.Vn--),this.isEnabled&&(this.sn.Pt(),this.sn.add(e),this.sn.u(),this.currentTransaction===null?this.dc.add(0):this.dc.add(this.currentTransaction.changes.count)),this.Vn++;const t=this.transactionLevel===1;return t&&(this.wl||this.xl("StartedTransaction",e,this.currentTransaction)),t}commitTransaction(e){return e===void 0&&(e=""),this.YC(!0,e)}rollbackTransaction(){return this.YC(!1,"")}YC(e,t){if(this.isUndoingRedoing)return!1;this.cm&&this.transactionLevel<1&&u.ni("Ending transaction without having started a transaction: "+t);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&e&&(this.wl||this.xl("CommittingTransaction",t,s));let n=0;if(this.transactionLevel>0&&(this.Vn--,this.isEnabled)){const o=this.sn.count;o>0&&(t===""&&(t=this.sn.elt(0)),this.sn.Pt(),this.sn.removeAt(o-1),this.sn.u());const r=this.dc.count;r>0&&(n=this.dc.elt(r-1),this.dc.removeAt(r-1))}if(i){if(e){if(this.am=!1,s===null&&t!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=t),this.discardHistoryAfterIndex();const r=this.history;r.Pt();const a=this.maxHistoryLength;if(a>=0){if(a===0)r.clear();else if(r.count>=a){const h=r.elt(0);h!==null&&h.clear(),r.removeAt(0),this.Os--}}a!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.Os++),r.u(),s=o}this.wl||this.xl("CommittedTransaction",t,s)}else{this.Is=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.wl||this.xl("RolledBackTransaction",t,s),this.Is=!1}s!==null&&s.clear()}return this.hm=null,this.Ew&&this.clear(),this.Ew=!1,this.Uw=!1,!0}else return this.isEnabled&&!e&&s!==null&&s.uF(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const e=this.history;e.Pt();for(let t=e.count-1;t>this.historyIndex;t--){const i=e.elt(t);i!==null&&i.clear(),e.removeAt(t),this.am=!0}e.u()}thaw(){this.history.Pt()}SE(e){this.Vn+=e,this.Vn<0&&(this.Vn=0)}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToUndo;return!!(e!==null&&e.canUndo())}undo(){if(!this.canUndo())return;const e=this.transactionToUndo;try{this.Is=!0,this.xl("StartingUndo","Undo",e),this.Os--,e.undo()}catch(t){u.ni("undo error: "+t.toString())}finally{this.xl("FinishedUndo","Undo",e),this.Is=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const e=this.transactionToRedo;return!!(e!==null&&e.canRedo())}redo(){if(!this.canRedo())return;const e=this.transactionToRedo;try{this.Is=!0,this.xl("StartingRedo","Redo",e),this.Os++,e.redo()}catch(t){u.ni("redo error: "+t.toString())}finally{this.xl("FinishedRedo","Redo",e),this.Is=!1}}xl(e,t,i){i===void 0&&(i=null);const s=new be;s.change=1,s.propertyName=e,s.object=i,s.oldValue=t;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.dF(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;t===null&&(t=new Te,this.hm=t);const i=e.copy(),s=t.changes;if(s.Pt(),s.add(i),s.u(),this.cm&&this._k>0&&this.transactionLevel<=0&&!this.Rw){const n=e.diagram;if(n!==null&&n.Vh===!1)return;u.ni("Change not within a transaction: "+i.toString()),this._k--}}}skipsEvent(e){if(e===null||e.change===1)return!0;const t=e.object;if(t===null)return!1;if(t.layer!==void 0){const i=t.layer;if(i!==null&&i.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.Fw.iterator}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.Is}get history(){return this.XC}get maxHistoryLength(){return this.Zk}set maxHistoryLength(e){this.Zk=e}get historyIndex(){return this.Os}get currentTransaction(){return this.hm}get transactionLevel(){return this.Vn}get isInTransaction(){return this.Vn>0}get cm(){return this.Qk}set cm(e){this.Qk=e}get nestedTransactionNames(){return this.sn}get Ew(){return this.vw}set Ew(e){this.vw=e}get Uw(){return this.Ow}set Uw(e){this.Ow=e}get wl(){return this.Iw}set wl(e){this.Iw=e}get isJustDiscarded(){return this.am}}class ve{constructor(){g(this,"N");g(this,"St");g(this,"Oi");g(this,"tP");g(this,"iP");g(this,"fm");g(this,"GC");I.Ki(this),this.N=zt.um(),this.St="",this.Oi=!0,this.tP=!1,this.iP=null,this.GC=new de,this.fm=-1}get diagram(){return this.N}set diagram(e){e instanceof zt&&(this.N=e)}toString(){return this.name!==""?this.name+" Tool":u.Dn(this.constructor)}updateAdornments(e){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const e=this.diagram;e.currentTool===this&&(e.currentTool=null,e.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,C.V(NaN,NaN)),s=t.getMultiTouchViewPoint(1,C.V(NaN,NaN));if(!i.isReal()||!s.isReal()){C.e(i),C.e(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){e.eP=e.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);e.sP=r,t.bubbles=!1}C.e(i),C.e(s)}standardPinchZoomMove(){const e=this.diagram,t=e.lastInput,i=t.getMultiTouchViewPoint(0,C.V(NaN,NaN)),s=t.getMultiTouchViewPoint(1,C.V(NaN,NaN));if(!i.isReal()||!s.isReal()){C.e(i),C.e(s);return}if(this.doCancel(),e.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o)/e.sP,a=new C((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=e.eP*r,l=e.commandHandler;if(h!==e.scale&&l.canResetZoom(h)){const c=e.zoomPoint;e.zoomPoint=a,l.resetZoom(h),e.zoomPoint=c}t.bubbles=!1}C.e(i),C.e(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(e){return e===void 0&&(e=this.name),this.transactionResult=null,this.diagram.startTransaction(e)}stopTransaction(){const e=this.diagram;return this.transactionResult===null?e.rollbackTransaction():e.commitTransaction(this.transactionResult)}standardMouseSelect(){const e=this.diagram;if(!e.allowSelect)return;const t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(i!==null){if(u.tr?t.meta:t.control){e.D("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),e.D("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.D("ChangingSelection",e.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),e.D("ChangedSelection",e.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&e.select(s)}}else t.left&&!(u.tr?t.meta:t.control)&&!t.shift&&e.clearSelection()}standardMouseClick(e,t){e===void 0&&(e=null),t===void 0&&(t=o=>{var r;return!((r=o.layer)!=null&&r.isTemporary)});const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,e,t);return s.targetObject=n,this.gF(n,s,i),s.handled}gF(e,t,i){if(t.handled=!1,e!==null&&!e.isEnabledObject())return;let s=0;t.left?t.clickCount===1?s=1:t.clickCount===2?s=2:s=1:t.right&&t.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(e!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.D(n,e)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.D(n)}if(e!==null)for(;e!==null;){let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick;break}if(o!==null&&(o(t,e),t.handled))break;e=e.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(t)}}standardMouseOver(){const e=this.diagram,t=e.lastInput;if(e.animationManager.pi===!0)return;const i=e.skipsUndoManager;e.skipsUndoManager=!0;let s=e.viewportBounds.containsPoint(t.documentPoint)?e.findObjectAt(t.documentPoint,null,null):null;t.event&&(t.event.type==="pointercancel"||t.event.type==="pointerout")&&(s=null),t.targetObject=s;let n=!1;if(s!==e.gc){let o=e.gc;const r=o;for(e.gc=s,this.doCurrentObjectChanged(o,s),t.handled=!1;o!==null;){const a=o.mouseLeave;if(a!==null&&(s===o||s!==null&&s.isContainedBy(o)||(a(t,o,s),n=!0,t.handled)))break;o=o.panel}for(o=r,t.handled=!1;s!==null;){const a=s.mouseEnter;if(a!==null&&(o===s||o!==null&&o.isContainedBy(s)||(a(t,s,o),n=!0,t.handled)))break;s=s.panel}s=e.gc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(e.currentCursor=r,t.handled=!1,o=s;o!==null;){const a=o.mouseOver;if(a!==null&&(a(t,o),n=!0,t.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=e.mouseOver;o!==null&&(o(t),n=!0)}n&&e.requestUpdate(),e.skipsUndoManager=i}doUpdateCursor(e){const t=this.diagram;t&&(t.currentCursor="")}doCurrentObjectChanged(e,t){}standardMouseWheel(){const e=this.diagram,t=e.lastInput;let i=t.delta;if(i===0||!e.documentBounds.isReal())return;const s=e.commandHandler,n=e.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!t.shift||n===1&&t.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=e.zoomPoint;e.zoomPoint=t.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),e.zoomPoint=o}t.bubbles=!1}else if(n===2&&t.shift||n===1&&!t.control){const o=e.position.copy(),r=t.event,a=r.deltaMode;let h=r.deltaX,l=r.deltaY,c="pixel";if((h!==0||l!==0)&&!t.shift){switch(a){case 0:c="pixel";break;case 1:c="line";break;case 2:c="page";break}if(h!==0&&e.allowHorizontalScroll){const d=e.scrollHorizontalLineChange;h=h*(d/16),e.scroll(c,h>0?"right":"left",Math.abs(h))}if(l!==0&&e.allowVerticalScroll){const d=e.scrollVerticalLineChange;l=l*(d/16),e.scroll(c,l>0?"down":"up",Math.abs(l))}}else!t.shift&&e.allowVerticalScroll?(i=i*3*e.scrollVerticalLineChange,e.scroll(c,i>0?"up":"down",Math.abs(i))):t.shift&&e.allowHorizontalScroll&&(i=i*3*e.scrollHorizontalLineChange,e.scroll(c,i>0?"left":"right",Math.abs(i)));this.doWheelChange(e,o,t)}}doWheelChange(e,t,i){(!e.position.equals(t)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(e,t){t===void 0&&(t=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=t.clone(this.GC);this.fm=u.ir(()=>i.doWaitAfter(s),e)}cancelWaitAfter(){this.fm!==-1&&u.Tg(this.fm),this.fm=-1}doWaitAfter(e){}findToolHandleAt(e,t){const i=this.diagram.findObjectAt(e,s=>{for(;s!==null&&!(s.panel instanceof Ft);)s=s.panel;return s});return i===null?null:i.part.category===t?i:null}isBeyondDragSize(e,t){const i=this.diagram;e===void 0&&(e=i.firstInput.viewPoint),t===void 0&&(t=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(t.x-e.x)>n||Math.abs(t.y-e.y)>o}get name(){return this.St}set name(e){this.St=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isActive(){return this.tP}set isActive(e){this.tP=e}get transactionResult(){return this.iP}set transactionResult(e){this.iP=e}}var je=(S=>(S[S.Scroll=1]="Scroll",S[S.Zoom=2]="Zoom",S[S.None=3]="None",S))(je||{}),Ke=(S=>(S[S.Zoom=1]="Zoom",S[S.Cancel=2]="Cancel",S[S.None=3]="None",S))(Ke||{});class Pe extends ve{constructor(t){super();g(this,"KC");g(this,"jC");g(this,"HC");g(this,"nP");g(this,"oP");g(this,"rP");g(this,"lP");g(this,"hP");g(this,"aP");g(this,"cP");g(this,"dm");g(this,"zh");this.name="ToolManager",this.KC=new Y,this.jC=new Y,this.HC=new Y,this.nP=850,this.oP=850,this.rP=new rt(2,2).$(),this.lP=5e3,this.hP=1,this.aP=1,this.cP=null,this.dm=null,this.zh=-1,t&&Object.assign(this,t)}get mouseWheelBehavior(){return this.hP}set mouseWheelBehavior(t){this.hP=t}get gestureBehavior(){return this.aP}set gestureBehavior(t){this.aP=t}initializeStandardTools(){}updateAdornments(t){const i=this.currentToolTip;if(i instanceof Ft&&this.dm===t){const s=i.adornedObject;(t!==null?s!==null&&s.part===t:s===null)?this.showToolTip(i,s):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&this.gestureBehavior===2&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}t.undoManager;const s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const n=this.mouseMoveTools.length;for(let o=0;o<n;o++){const r=this.mouseMoveTools.elt(o);if(r.diagram=this.diagram,r.canStart()){t.doFocus(),t.currentTool=r,t.currentTool===r&&(r.isActive||r.doActivate(),r.doMouseMove());return}}}this.standardMouseActivity(t);const s=i.event;s!==null&&(s.type==="pointermove"||!s.cancelable)&&(i.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,i){const s=this.currentToolTip;s!==null&&(i!==null&&s instanceof Ft&&(i===s||i.isContainedBy(s))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(i.mF()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled)){const s=t.copy();s.button=2,i.lastInput=s,i.Bw=!0,i.doMouseUp();return}}doMouseHover(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null)for(i.handled=!1;s!==null;){const n=this.isActive?s.mouseHold:s.mouseHover;if(n!==null&&(n(i,s),i.handled))break;s=s.panel}else{const n=this.isActive?t.mouseHold:t.mouseHover;n!==null&&n(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let s=i.targetObject;if(s!==null){const n=this.currentToolTip;if(n instanceof Ft&&(s===n||s.isContainedBy(n)))return;for(;s!==null;){const o=s.toolTip;if(o!==null){this.showToolTip(o,s);return}s=s.panel}this.hideToolTip()}else{const n=t.toolTip;n!==null?this.showToolTip(n,null):this.hideToolTip()}}showToolTip(t,i){const s=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Ft){t.layerName="Tool",t.selectable=!1,t.scale=1/s.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=s.scale);const o=t.diagram;o!==null&&o!==s&&o.remove(t),s.add(t),i!==null?t.adornedObject=i:t.data=s.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof Ti&&t!==this.currentToolTip&&t.show!==null&&t.show(i,s,this);this.currentToolTip=t,this.zh!==-1&&(u.Tg(this.zh),this.zh=-1);const n=this.toolTipDuration;if(n>0&&n!==1/0){const o=this;this.zh=u.ir(()=>o.hideToolTip(),n)}}positionToolTip(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+20/n.scale+r.height>a.bottom?o.y-=r.height+5/n.scale:o.y+=20/n.scale,o.y<a.y&&(o.y=a.y),s.position=o}hideToolTip(){this.zh!==-1&&(u.Tg(this.zh),this.zh=-1);const t=this.diagram,i=this.currentToolTip;i!==null&&(i instanceof Ft?(t.remove(i),this.dm!==null&&this.dm.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof Ti&&i.hide!==null&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.cP}set currentToolTip(t){this.cP=t,this.dm=t!==null&&t instanceof Ft?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.diagram=this.diagram,n.canStart()){t.doFocus(),t.currentTool=n,t.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return n}return null}replaceTool(t,i){i!==null&&(i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.name===t)return i!==null?this.mouseDownTools.setElt(n,i):this.mouseDownTools.removeAt(n),o}s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.name===t)return i!==null?this.mouseMoveTools.setElt(n,i):this.mouseMoveTools.removeAt(n),o}s=this.mouseUpTools.length;for(let n=0;n<s;n++){const o=this.mouseUpTools.elt(n);if(o.name===t)return i!==null?this.mouseUpTools.setElt(n,i):this.mouseUpTools.removeAt(n),o}return null}replaceStandardTool(t,i,s){this.Jt(t,i,s)}Jt(t,i,s){i!==null&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):i!==null&&s.add(i)}get mouseDownTools(){return this.KC}get mouseMoveTools(){return this.jC}get mouseUpTools(){return this.HC}get hoverDelay(){return this.nP}set hoverDelay(t){this.nP=t}get holdDelay(){return this.oP}set holdDelay(t){this.oP=t}get dragSize(){return this.rP}set dragSize(t){this.rP=t.P()}get toolTipDuration(){return this.lP}set toolTipDuration(t){this.lP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}g(Pe,"WheelScroll",1),g(Pe,"WheelZoom",2),g(Pe,"WheelNone",3),g(Pe,"GestureZoom",1),g(Pe,"GestureCancel",2),g(Pe,"GestureNone",3);const qt=class qt extends ve{constructor(t){super();g(this,"fP");g(this,"uP");g(this,"nn");g(this,"dP");g(this,"gP");g(this,"mP");g(this,"pP");g(this,"mc");g(this,"gm");g(this,"yP");g(this,"Xh");g(this,"cr");g(this,"qC");g(this,"wP");g(this,"fu");g(this,"uu");g(this,"xP");g(this,"bP");g(this,"kP");g(this,"PP");this.name="Dragging",this.fP=!0,this.PP=!0,this.uP=!0,this.nn=null,this.dP=null,this.gP=null,this.mP=null,this.pP=!1,this.fu=!1,this.mc=new C(NaN,NaN),this.gm=new C,this.yP=!0,this.Xh=100,this.cr=[],this.qC=new I().u(),this.wP=new Bn,this.uu=null,this.xP="copy",this.bP="",this.kP="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.fP}set isCopyEnabled(t){this.fP=t}get copiesEffectiveCollection(){return this.uP}set copiesEffectiveCollection(t){this.uP=t}get dragOptions(){return this.wP}set dragOptions(t){this.wP=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.yP}set isComplexRoutingRealtime(t){this.yP=t;const i=this.diagram.findRouter("AvoidsLinks");i!==null&&(i.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.P(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.P(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.P(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){this.dragOptions.dragsTree=t}get copyCursor(){return this.xP}set copyCursor(t){this.xP=t}get moveCursor(){return this.bP}set moveCursor(t){this.bP=t}get nodropCursor(){return this.kP}set nodropCursor(t){this.kP=t}get currentPart(){return this.dP}set currentPart(t){this.dP=t}get copiedParts(){return this.mP}set copiedParts(t){this.mP=t}get draggedParts(){return this.gP}set draggedParts(t){this.gP=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.qC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){this.diagram.draggedLink=t}get isDragOutStarted(){return this.pP}set isDragOutStarted(t){this.pP=t}get startPoint(){return this.gm}set startPoint(t){this.gm.equals(t)||this.gm.a(t)}get delay(){return this.Xh}set delay(t){this.Xh=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const i=t.lastInput;return!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.Xh)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i===null)return null;for(;i!==null&&!i.canSelect();)i=i.containingGroup;return i!==null&&(i.canMove()||i.canCopy())?i:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i!==null){for(;i!==null&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,this.currentPart!==null&&!this.currentPart.isSelected){t.D("ChangingSelection",t.selection);const s=t.lastInput;!(u.tr?s.meta:s.control)&&!s.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.D("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.uu=null,this.currentPart===null&&this.standardMouseSelect();const i=this.currentPart;if(i===null||!i.canMove()&&!i.canCopy())return;t.cacheGroupExternalLinks(!0),qt.dt=null,this.isActive=!0,this.mc.set(t.position),this.SP(t.selection),this.cr.length=0,t.animationManager.stopAnimation();const s=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=s,this.PP=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.du=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Vw(),t.WC(this.draggedParts),t.gu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.pF()}SP(t){if(!this.dragsLink)return;const i=this.diagram,s=i.model.mm(),n=t.first();s&&t.count===1&&n instanceof St&&this.mayDragLink(n)?(this.draggedLink=n,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.nn=i.toolManager.findTool("Relinking"),this.nn===null&&(this.nn=new xi,this.nn.diagram=i),this.nn.originalLink=this.draggedLink):(this.draggedLink=null,this.nn=null)}mayDragLink(t){const i=this.diagram;return i!==null&&i.allowRelink}computeEffectiveCollection(t,i){return this.diagram.commandHandler.computeEffectiveCollection(t,i)}Es(t){return t===void 0?new ls(C.xo):this.isGridSnapEnabled?new ls(new C(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new ls(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.PP,t.gu=!1,t.bl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.MP(),t.NP(this.draggedParts),this.uu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.fu=!1,qt.yF(),this.JC(),this.mc.i(NaN,NaN),qt.Yh!==null&&(qt.Yh.currentCursor=""),qt.Yh=null,qt.dt=null,this.kl(),t.isMouseCaptured=!1,t.currentCursor="",t.du=!1,this.stopTransaction(),t.CP(!0)}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}MP(){const t=this.diagram,i=t.skipsUndoManager;t.skipsUndoManager=!0;const s=t.lastInput;this.$C(s,null),t.skipsUndoManager=i,this.cr.length=0}ZC(){this.kl(),this.LP();const t=this.diagram;this.mc.isReal()&&(t.position=this.mc),t.stopAutoScroll()}doCancel(){this.kl(),this.LP();const t=this.diagram;this.mc.isReal()&&(t.position=this.mc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const i=t.lastInput,s=t.previousInput;i.code==="Escape"?this.doCancel():(i.code!==s.code||i.modifiers!==s.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}wF(t,i){let s=1/0,n=1/0,o=-1/0,r=-1/0;const a=t.iterator;for(;a.next();){const h=a.value;if(!h.isVisible())continue;const l=h.location,c=l.x,d=l.y;isNaN(c)||isNaN(d)||(c<s&&(s=c),d<n&&(n=d),c>o&&(o=c),d>r&&(r=d))}return s===1/0?i.i(0,0,0,0):i.i(s,n,o-s,r-n),i}AP(t){if(this.copiedParts!==null)return;const i=this.diagram;if(t&&(i.isReadOnly||i.isModelReadOnly)||this.draggedParts===null)return;const s=i.undoManager;s.isEnabled&&s.isInTransaction?s.currentTransaction!==null&&s.currentTransaction.changes.count>0&&(i.undoManager.rollbackTransaction(),i.startTransaction("Drag")):this.LP(),i.skipsUndoManager=!t,i.partManager.addsToTemporaryLayer=!t,this.startPoint=i.firstInput.documentPoint;const n=this.copiesEffectiveCollection?this.draggedParts.toKeySet():i.selection,o=i.copyParts(n,i,!0),r=new Z,a=this.draggedParts.iterator;for(;a.next();){const l=a.key;if(l.ke()&&l.canCopy()){const c=o.get(l);if(c===null)continue;c.location=l.location,c.ensureBounds(),r.set(c,this.Es(c.location))}}const h=o.iterator;for(;h.next();){const l=h.value;l instanceof St&&l.canCopy()&&r.set(l,this.Es())}if(this.copiedParts=r,this.SP(r.toKeySet()),this.draggedLink!==null){const l=this.draggedLink,c=l.routeBounds;l.fr(this.startPoint.x-(c.x+c.width/2),this.startPoint.y-(c.y+c.height/2))}this.doUpdateCursor(null)}kl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const i=this.draggedParts.iterator;for(;i.next();)if(i.key instanceof St){const s=i.value;s.point=new C(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}JC(){this.draggedLink!==null&&(this.dragsLink&&this.nn!==null&&(this.nn.stopDraggingMouseMove(),this.nn.originalLink=null),this.draggedLink=null,this.nn=null)}pc(t,i){if(t===null)return;const s=this.diagram,n=this.startPoint,o=C.l();o.a(s.lastInput.documentPoint),this.moveParts(t,o.subtract(n),i),C.e(o),s.getRenderingHint("temporaryPixelRatio")===!0&&s.Pl===null&&s.avgSpf>30&&(s.Vw(),s.mu())}moveParts(t,i,s){s===void 0&&(s=!1);const n=this.diagram;n!==null&&n.TP(t,i,this.dragOptions,s)}LP(){if(this.draggedParts===null)return;const t=this.diagram;let i=this.draggedParts.iterator;for(;i.next();){const s=i.key;s.ke()&&(s.location=i.value.point)}for(i=this.draggedParts.iterator;i.next();){const s=i.key;if(s instanceof St&&s.suspendsRouting){const n=i.value.point;this.draggedParts.set(s,this.Es()),s.fr(-n.x,-n.y)}}t.maybeUpdate()}xF(t){var s;if(t===null)return!0;const i=t.part;return!!(i===null||i instanceof Ft||(s=i.layer)!=null&&s.isTemporary||this.draggedParts&&this.draggedParts.has(i)||this.copiedParts&&this.copiedParts.has(i))}DP(t){const i=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.QC(!1));const s=this.findDragOverObject(t),n=i.lastInput;n.targetObject=s,this.doUpdateCursor(s);const o=i.skipsUndoManager;let r=!1;try{if(i.skipsUndoManager=!0,r=this.$C(n,s),!this.isActive&&qt.dt===null)return;const a=s!==null?s.part:null;if(a===null||i.handlesDragDropForTopLevelParts&&a.isTopLevel&&!(a instanceof Nt)){const h=i.mouseDragOver;h!==null&&(h(n),r=!0)}if(!this.isActive&&qt.dt===null||(this.doDragOver(t,s),!this.isActive&&qt.dt===null))return}finally{i.skipsUndoManager=o,r&&i.maybeUpdate()}this.uu=s,!i.isReadOnly&&(i.allowMove||i.allowCopy)&&(i.allowHorizontalScroll||i.allowVerticalScroll)&&i.doAutoScroll(n.viewPoint)}findDragOverObject(t){return this.diagram.FP(t,null,i=>!this.xF(i))}doUpdateCursor(t){const i=this.diagram;(t===null||this.uu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?i.currentCursor=this.copyCursor:this.mayMove()?i.currentCursor=this.moveCursor:this.mayDragOut()&&(i.currentCursor=this.nodropCursor))}$C(t,i){let s=!1,n=this.cr.length;const o=n>0?this.cr[0]:null;if(i===o)return!1;t.handled=!1;for(let a=0;a<n;a++){const h=this.cr[a],l=h.mouseDragLeave;if(l!==null&&(l(t,h,i),s=!0,t.handled))break}if(this.cr.length=0,!this.isActive&&qt.dt===null||i===null)return s;t.handled=!1;let r=i;for(;r!==null;)this.cr.push(r),r=this._C(r);n=this.cr.length;for(let a=0;a<n;a++){const h=this.cr[a],l=h.mouseDragEnter;if(l!==null&&(l(t,h,o),s=!0,t.handled))break}return s}ME(t,i){var s;return t===null?!1:!!(t===i||t.isContainedBy(i)||i instanceof Nt&&!(t instanceof Nt)&&i.handlesDragDropForMembers&&((s=t.part)!=null&&s.isMemberOf(i)))}_C(t){const i=t.panel;if(i!==null)return i;if(t instanceof Ht&&!(t instanceof Nt)){const s=t.containingGroup;if(s!==null&&s.handlesDragDropForMembers)return s}return null}tL(t,i){const s=this.diagram,n=this.nn;if(n===null)return null;const o=n.portGravity,r=s.findObjectsNear(t,o,c=>n.findValidLinkablePort(c,i)),a=C.l();let h=1/0,l=null;for(const c=r.iterator;c.next();){const d=c.value;if(d.part===null)continue;const f=d.getDocumentPoint(U.Center,a),m=t.distanceSquaredPoint(f);m<h&&(l=d,h=m)}return C.e(a),l}QC(t){const i=this.draggedLink;if(i!==null){if(i.pointsCount<2)return;const s=this.diagram;if(s.isReadOnly)return;const n=this.nn;if(n===null)return;let o=null,r=null;i.fromNode===null&&(o=this.tL(i.getPoint(0),!1),o!==null&&(r=o.part));let a=null,h=null;i.toNode===null&&(a=this.tL(i.getPoint(i.pointsCount-1),!0),a!==null&&(h=a.part)),n.isValidLink(r,o,h,a)?t?(i.defaultFromPoint=i.getPoint(0),i.defaultToPoint=i.getPoint(i.pointsCount-1),i.suspendsRouting=!1,i.fromNode=r,o!==null&&(i.fromPortId=o.portId),i.toNode=h,a!==null&&(i.toPortId=a.portId),i.fromPort!==s.RP&&s.D("LinkRelinked",i,s.RP),i.toPort!==s.vP&&s.D("LinkRelinked",i,s.vP)):n.doDraggingMouseMove(r,o,h,a):n.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,i){}iL(t){const i=this.diagram;this.dragsLink&&this.QC(!0),this.MP();const s=this.findDragOverObject(t),n=i.lastInput;if(n.targetObject=s,s!==null){n.handled=!1;let h=s;for(;h!==null;){const l=h.mouseDrop;if(l!==null&&(l(n,h),n.handled))break;this.bF(n,h),h=this._C(h)}}else{const h=i.mouseDrop;h!==null&&h(n)}if(!this.isActive&&qt.dt===null)return;const o=this.copiedParts||this.draggedParts;if(o!==null){const h=o.iterator;for(;h.next();){const l=h.key;l instanceof gt&&l.linksConnected.each(c=>c.suspendsRouting=!1)}}if(this.doDropOnto(t,s),!this.isActive&&qt.dt===null)return;const r=G.l(),a=i.selection.iterator;for(;a.next();){const h=a.value;h instanceof gt&&this.kF(i,h,r)}G.e(r)}bF(t,i){const s=this.diagram,n=i.part;if(s.handlesDragDropForTopLevelParts&&n!==null&&n.isTopLevel&&!(n instanceof Nt)){const o=s.mouseDrop;o!==null&&o(t)}}kF(t,i,s){if(!i.canAvoid())return;let n=!1;s=i.getAvoidableRect(s),t.viewportBounds.containsRect(s)&&(n=!0);const o=this.copiedParts||this.draggedParts;if(o===null)return;const r=t.OP(s,h=>h.part,h=>h instanceof St,!0,h=>h instanceof St,n);if(r.count===0)return;const a=r.iterator;for(;a.next();){const h=a.value;o.has(h)&&o.has(i)||!h.isMemberOf(i)&&h.isAvoiding&&h.invalidateRoute()}}doDropOnto(t,i){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;this.simulatedMouseMove(i.event,i.documentPoint,i.targetDiagram)||this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.AP(!1),this.pc(this.copiedParts,!1)):this.mayMove()?(this.kl(),this.pc(this.draggedParts,!0)):this.mayDragOut()?(this.AP(!1),this.pc(this.copiedParts,!1)):this.kl(),this.DP(t.lastInput.documentPoint))}doMouseUp(){var o;if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram))return;let s=!1;const n=this.mayCopy();if(n&&this.copiedParts!==null?(this.kl(),this.AP(!0),this.pc(this.copiedParts,!1),this.copiedParts!==null&&(t.D("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(r=>{r.isSelected=!0}))):(s=!0,this.kl(),this.mayMove()&&(this.pc(this.draggedParts,!0),this.DP(t.lastInput.documentPoint))),this.fu=!0,this.iL(t.lastInput.documentPoint),this.isActive){const r=n&&this.copiedParts,a=r?(o=this.copiedParts)==null?void 0:o.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,s&&this.PF(),t.invalidateDocumentBounds(),t.NP(this.draggedParts),this.transactionResult=r?"Copy":"Move",t.D(r?"SelectionCopied":"SelectionMoved",a)}this.stopTool(),n&&t.D("ChangedSelection",t.selection)}simulatedMouseMove(t,i,s){if(qt.dt===null)return!1;const n=qt.dt.diagram;s instanceof zt||(s=null);const o=qt.Yh;if(s!==o){if(o!==null&&o!==n){o.stopAutoScroll(),qt.dt.isDragOutStarted=!1;const a=o.toolManager.findTool("Dragging");a!==null&&a.doSimulatedDragLeave()}if(qt.Yh=s,s!==null&&s!==n){qt.dt.ZC();const a=s.toolManager.findTool("Dragging");a!==null&&(a.eL(),a.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(s===null||s===n||!s.allowDrop||s.isReadOnly||!s.allowInsert)return!1;const r=s.toolManager.findTool("Dragging");if(r!==null){let a=i;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),a=s.getMouse(t)),s.lastInput.documentPoint=a,s.lastInput.viewPoint=s.transformDocToView(a),s.lastInput.down=!1,s.lastInput.up=!1,r.doSimulatedDragOver()}return!0}simulatedMouseUp(t,i,s){if(qt.dt===null)return!1;const n=qt.Yh,o=qt.dt.diagram;if(s===null)return qt.dt.doCancel(),!0;if(s!==n){if(n!==null){const a=n.toolManager.findTool("Dragging");if(n!==null&&n!==o&&a!==null)return n.stopAutoScroll(),qt.dt.isDragOutStarted=!1,a.doSimulatedDragLeave(),!1}qt.Yh=s;const r=s.toolManager.findTool("Dragging");r!==null&&(qt.dt.ZC(),r.eL(),r.doSimulatedDragEnter())}if(s!==this.diagram){let r=i;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=s.getMouse(t)):r===null&&(r=new C),s.lastInput.documentPoint=r,s.lastInput.viewPoint=s.transformDocToView(r),s.lastInput.down=!1,s.lastInput.up=!0;const a=s.toolManager.findTool("Dragging");a!==null&&a.doSimulatedDrop();const h=qt.dt;if(h!==null){const l=h.mayCopy();h.transactionResult=l?"Copy":"Move",h.stopTool()}return!0}return!1}PF(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const i=t.key;if(i instanceof gt){const s=i.containingGroup;s!==null&&s.hasPlaceholder()&&!this.draggedParts.has(s)&&s.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(u.tr?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}eL(){qt.zw.has(this)||qt.zw.add(this)}static yF(){if(qt.zw.count>0){const t=qt.zw,i=t.length;for(let s=0;s<i;s++){const n=t.elt(s);n.JC(),n.kl(),n.MP(),n.diagram.stopAutoScroll()}t.clear()}}computeBorder(t,i,s){return!this.fu&&this.draggedParts!==null&&!this.draggedParts.has(t)?s.a(i):null}getDraggingSource(){return qt.dt}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const i=qt.dt;return!(i===null||i.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.ur(),t.animationManager.stopAnimation();const i=qt.dt;i!==null&&(this.diagram.du=!0,t.lastInput.event===null&&(t.lastInput.event=i.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=qt.dt;t!==null&&t.doSimulatedDragOut(),this.diagram.du=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.pu=!0;const i=qt.dt;if(i!==null&&i.draggedParts!==null){if(!this.mayDragIn())return;this.sL(i.draggedParts.toKeySet(),!1,t.firstInput),this.pc(this.copiedParts,!1),this.DP(t.lastInput.documentPoint)}t.animationManager.pu=!1}doSimulatedDrop(){const t=this.diagram,i=qt.dt;if(i!==null){const s=i.diagram;if(i.fu=!0,this.kl(),i.draggedParts===null||!this.mayDragIn())return;t.animationManager.pu=!0,t.D("ChangingSelection",t.selection),this.startTransaction("Drop"),this.sL(i.draggedParts.toKeySet(),!0,t.lastInput),this.pc(this.copiedParts,!1);const n=new I;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(o=>{o.isSelected=!0,n.add(o)})),this.iL(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.du=!1,t.D("ExternalObjectsDropped",n,s),this.stopTransaction(),t.D("ChangedSelection",t.selection)}t.animationManager.pu=!1}sL(t,i,s){if(this.copiedParts!==null)return;const n=this.diagram;if(n.isReadOnly||n.isModelReadOnly)return;n.skipsUndoManager=!i,n.partManager.addsToTemporaryLayer=!i,this.startPoint=s.documentPoint;const o=n.copyParts(t,n,!0),r=G.l();this.wF(t,r);const a=r.x+r.width/2,h=r.y+r.height/2;G.e(r);const l=this.gm,c=new Z,d=C.l(),f=t.iterator;for(;f.next();){const p=f.value;if(p instanceof St&&p.canCopy()){const y=o.get(p);if(y===null)continue;y.points=p.points,y.fr(l.x-a,l.y-h),y.suspendsRouting=!0,c.set(y,this.Es())}}const m=t.iterator;for(;m.next();){const p=m.value;if(p.ke()&&p.canCopy()){const y=o.get(p);if(y===null)continue;const x=p.location;d.i(l.x-(a-x.x),l.y-(h-x.y)),y.location=d,y.ensureBounds(),c.set(y,this.Es(d))}}if(C.e(d),this.copiedParts=c,this.SP(c.toKeySet()),this.draggedLink!==null){const p=this.draggedLink,y=p.routeBounds;p.fr(this.startPoint.x-(y.x+y.width/2),this.startPoint.y-(y.y+y.height/2))}this.doUpdateCursor(null)}pF(){this.isDragOutStarted=!0,this.fu=!1,qt.dt=this,qt.Yh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.uu=null}computeMove(t,i,s,n){const o=this.diagram;return o!==null?o.computeMove(t,i,this.dragOptions,n):new C}};g(qt,"zw",new Y),g(qt,"dt",null),g(qt,"Yh",null);let Ne=qt;Pe.prototype.doCancel=function(){Ne.dt!==null&&Ne.dt.doCancel(),ve.prototype.doCancel.call(this)};class Ue extends ve{constructor(){super();g(this,"IP");g(this,"EP");g(this,"Sl");g(this,"UP");g(this,"BP");g(this,"Gh");g(this,"VP");g(this,"Kh");g(this,"zP");g(this,"XP");g(this,"YP");g(this,"GP");g(this,"KP");g(this,"jP");g(this,"nL");g(this,"HP");g(this,"Ml");g(this,"qP");this.IP=100,this.EP=!1,this.Sl="pointer",this.UP=new St({layerName:"Tool"}).add(new At({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new At({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).Et(),this.Gh=new At("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:rt.Uk}).theme("stroke","tempPort"),this.BP=new gt({selectable:!1,layerName:"Tool"}).add(this.Gh).Et(),this.Kh=new At("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:rt.Uk}).theme("stroke","tempPort"),this.VP=new gt({selectable:!1,layerName:"Tool"}).add(this.Kh).Et(),this.zP=null,this.XP=null,this.YP=null,this.GP=null,this.KP=null,this.jP=!0,this.nL=new Z,this.HP=null,this.Ml=null,this.qP=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.IP}set portGravity(t){t>=0&&(this.IP=t)}get isUnconnectedLinkValid(){return this.EP}set isUnconnectedLinkValid(t){this.EP=t}get linkingCursor(){return this.Sl}set linkingCursor(t){this.Sl=t}get temporaryLink(){return this.UP}set temporaryLink(t){t.Et(),this.UP=t}get temporaryFromNode(){return this.BP}set temporaryFromNode(t){t.Et(),this.BP=t,t&&(this.Gh=t.port)}get temporaryFromPort(){return this.Gh}set temporaryFromPort(t){if(this.Gh!==null){const i=this.Gh.panel;if(i!==null){const s=i.C.indexOf(this.Gh);i.removeAt(s),i.insertAt(s,t)}}this.Gh=t}get temporaryToNode(){return this.VP}set temporaryToNode(t){t.Et(),this.VP=t,t&&(this.Kh=t.port)}get temporaryToPort(){return this.Kh}set temporaryToPort(t){if(this.Kh!==null){const i=this.Kh.panel;if(i!==null){const s=i.C.indexOf(this.Kh);i.removeAt(s),i.insertAt(s,t)}}this.Kh=t}get originalLink(){return this.zP}set originalLink(t){this.zP=t}get originalFromNode(){return this.XP}set originalFromNode(t){this.XP=t}get originalFromPort(){return this.YP}set originalFromPort(t){this.YP=t}get originalToNode(){return this.GP}set originalToNode(t){this.GP=t}get originalToPort(){return this.KP}set originalToPort(t){this.KP=t}get isForwards(){return this.jP}set isForwards(t){this.jP=t}get validPortsCache(){return this.nL}get targetPort(){return this.HP}set targetPort(t){this.HP=t}copyPortProperties(t,i,s,n,o){if(t===null||i===null||s===null||n===null)return;const r=i.getDocumentScale(),a=rt.l();a.width=i.naturalBounds.width*r,a.height=i.naturalBounds.height*r,n.desiredSize=a,rt.e(a),o?(n.toSpot=i.toSpot,n.toEndSegmentLength=i.toEndSegmentLength):(n.fromSpot=i.fromSpot,n.fromEndSegmentLength=i.fromEndSegmentLength),s.locationSpot=U.Center;const h=C.l();s.location=i.getDocumentPoint(U.Center,h),C.e(h),n.angle=i.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,i,s,n,o)}setNoTargetPortProperties(t,i,s){i!==null&&(i.desiredSize=rt.Uk,i.fromSpot=U.None,i.toSpot=U.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,i,s)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof gt){const i=this.targetPort.part;this.isForwards?this.copyPortProperties(i,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(i,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,i){if(t===null)return null;const s=t.part;if(!(s instanceof gt))return null;for(;t!==null;){const n=i?t.toLinkable:t.fromLinkable;if(n===!0&&(t.portId!==null||t instanceof gt)&&(i?this.isValidTo(s,t):this.isValidFrom(s,t)))return t;if(n===!1)return null;t=t.panel}return null}findTargetPort(t){const i=this.diagram,s=i.lastInput.documentPoint;let n=this.portGravity;const o=i.findObjectsNear(s,n,l=>this.findValidLinkablePort(l,t),null,!0);let r=1/0,a=null;const h=o.iterator;for(;h.next();){const l=h.value,c=l.part;if(!(c instanceof gt))continue;const d=l.getDocumentPoint(U.Center,C.l()),f=s.x-d.x,m=s.y-d.y;C.e(d);const p=f*f+m*m;if(p<r){const y=this.validPortsCache.get(l);y!==null?y&&(a=l,r=p):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,c,l)||!t&&this.isValidLink(c,l,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(l,!0),a=l,r=p):this.validPortsCache.set(l,!1)}}if(a!==null){const l=a.part;if(l instanceof gt&&(l.layer===null||l.layer.allowLink))return a}return null}isValidFrom(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.fromLinkable!==!0))return!1;const s=i.fromMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&i===this.originalFromPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksOutOf(n).count>=s)return!1}return!0}isValidTo(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.toLinkable!==!0))return!1;const s=i.toMaxLinks;if(s<1/0){if(this.originalLink!==null&&t===this.originalToNode&&i===this.originalToPort)return!0;let n=i.portId;if(n===null&&(n=""),t.findLinksInto(n).count>=s)return!1}return!0}isInSameNode(t,i){if(t===null||i===null)return!1;if(t===i)return!0;const s=t.part,n=i.part;return s!==null&&s===n}isLinked(t,i){if(t===null||i===null)return!1;const s=t.part;if(!(s instanceof gt))return!1;let n=t.portId;n===null&&(n="");const o=i.part;if(!(o instanceof gt))return!1;let r=i.portId;r===null&&(r="");const a=o.findLinksInto(r);for(;a.next();){const h=a.value;if(h.fromNode===s&&h.fromPortId===n)return!0}return!1}isValidLink(t,i,s,n){if(!this.isValidFrom(t,i)||!this.isValidTo(s,n)||i!==null&&n!==null&&(!(i.fromLinkableSelfNode&&n.toLinkableSelfNode)&&this.isInSameNode(i,n)||!(i.fromLinkableDuplicates&&n.toLinkableDuplicates)&&this.isLinked(i,n))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||s!==null&&this.isLabelDependentOnLink(s,this.originalLink))||t!==null&&s!==null&&(t.data===null&&s.data!==null||t.data!==null&&s.data===null)||!this.isValidCycle(t,s,this.originalLink))return!1;let o;return t!==null&&i!==null&&(o=t.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))||s!==null&&n!==null&&(o=s.linkValidation,o!==null&&!o(t,i,s,n,this.originalLink))?!1:(o=this.linkValidation,o!==null?o(t,i,s,n,this.originalLink):!0)}isLabelDependentOnLink(t,i){if(t===null)return!1;const s=t.labeledLink;if(s===null)return!1;if(s===i)return!0;const n=new I;return n.add(t),this.WP(s,i,n)}WP(t,i,s){if(t===i)return!0;const n=t.fromNode;if(n!==null&&n.labeledLink&&(s.add(n),this.WP(n.labeledLink,i,s)))return!0;const o=t.toNode;return!!(o!==null&&o.labeledLink&&(s.add(o),this.WP(o.labeledLink,i,s)))}isValidCycle(t,i,s){if(s===void 0&&(s=null),t===null||i===null)return this.isUnconnectedLinkValid;const n=this.diagram;let o=1;if(n&&(n.model.pm()?o=n.isTreePathToChildren?5:6:o=n.validCycle),o===1)return!0;if(o===5){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const a=i.linksConnected;for(;a.next();){const h=a.value;if(h!==s&&h.isTreeLink&&h.toNode===i)return!1}return!this.yu(t,i,s,!0)}else if(o===6){const r=s||this.temporaryLink;if(r!==null&&!r.isTreeLink)return!0;const a=t.linksConnected;for(;a.next();){const h=a.value;if(h!==s&&h.isTreeLink&&h.fromNode===t)return!1}return!this.yu(t,i,s,!0)}else{if(o===2)return!this.SF(t,i,s);if(o===3)return!this.yu(t,i,s,!1);if(o===4)return!this.MF(t,i,s)}return!0}yu(t,i,s,n){if(t===i)return!0;if(t===null||i===null)return!1;const o=t.linksConnected;for(;o.next();){const r=o.value;if(r===s||n&&!r.isTreeLink||r.toNode!==t)continue;const a=r.fromNode;if(!(a===t||a===null)&&this.yu(a,i,s,n))return!0}return!1}SF(t,i,s){if(t===i)return!0;const n=new I;return n.add(i),this.oL(n,t,i,s)}oL(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n||r.toNode!==i)continue;const a=r.fromNode;if(!(a===i||a===null)&&this.oL(t,a,s,n))return!0}return!1}MF(t,i,s){if(t===i)return!0;const n=new I;return n.add(i),this.rL(n,t,i,s)}rL(t,i,s,n){if(i===s)return!0;if(i===null||s===null||t.has(i))return!1;t.add(i);const o=i.linksConnected;for(;o.next();){const r=o.value;if(r===n)continue;const a=r.fromNode,h=r.toNode,l=a===i?h:a;if(!(l===i||l===null)&&this.rL(t,l,s,n))return!0}return!1}get linkValidation(){return this.Ml}set linkValidation(t){this.Ml=t}get portTargeted(){return this.qP}set portTargeted(t){this.qP=t}}var Gi=(S=>(S[S.Either=1]="Either",S[S.ForwardsOnly=2]="ForwardsOnly",S[S.BackwardsOnly=3]="BackwardsOnly",S))(Gi||{});const fs=class fs extends Ue{constructor(t){super();g(this,"JP");g(this,"$P");g(this,"b");g(this,"ZP");this.name="Linking",this.JP={},this.$P=null,this.b=1,this.ZP=null,t&&Object.assign(this,t)}get archetypeLinkData(){return this.JP}set archetypeLinkData(t){t!==null&&u.ec(t,fs,"archetypeLinkData"),this.JP=t}get archetypeLabelNodeData(){return this.$P}set archetypeLabelNodeData(t){t!==null&&u.ec(t,fs,"archetypeLabelNodeData"),this.$P=t}get direction(){return this.b}set direction(t){this.b=t}get startObject(){return this.ZP}set startObject(t){this.ZP=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Xw()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(i===null&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),i===null)return null;const s=i.part;if(!(s instanceof gt))return null;const n=this.direction;if(n===1||n===2){const o=this.findValidLinkablePort(i,!1);if(o!==null)return this.isForwards=!0,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!1))return this.isForwards=!0,r}}if(n===1||n===3){const o=this.findValidLinkablePort(i,!0);if(o!==null)return this.isForwards=!1,o;if(this.startObject===s){const r=s.port;if(this.findValidLinkablePort(r,!0))return this.isForwards=!1,r}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(i===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const s=this.originalFromPort.part;s instanceof gt&&(this.originalFromNode=s),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const s=this.originalToPort.part;s instanceof gt&&(this.originalToNode=s),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,s=null,n=null,o=null,r=null;try{this.targetPort=this.findTargetPort(this.isForwards);const a=this.targetPort;if(a!==null){const h=a.part;h instanceof gt&&(this.isForwards?(this.originalFromNode!==null&&(i=this.originalFromNode,s=this.originalFromPort),n=h,o=a):(i=h,s=a,this.originalToNode!==null&&(n=this.originalToNode,o=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,s=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(n=this.originalToNode,o=this.originalToPort);i!==null||n!==null?(r=this.insertLink(i,s,n,o),r!==null?(a===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.D("ChangingSelection",t.selection),t.clearSelection(!0),r.isSelected=!0),this.transactionResult=this.name,t.D("LinkDrawn",r)):this.doNoLink(i,s,n,o)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),r&&t.allowSelect&&t.D("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof St)return t.isTreeLink;const i=this.diagram;if(i===null)return!0;const s=i.partManager.getLinkCategoryForData(t),n=i.partManager.findLinkTemplateForCategory(s);return n!==null?n.isTreeLink:!0}insertLink(t,i,s,n){return this.diagram.partManager.insertLink(t,i,s,n)}doNoLink(t,i,s,n){}};g(fs,"Either",1),g(fs,"ForwardsOnly",2),g(fs,"BackwardsOnly",3);let Fi=fs;class xi extends Ue{constructor(t){super();g(this,"lL",null);g(this,"hL",null);g(this,"QP",null);g(this,"_P",null);g(this,"fs");g(this,"tS");this.name="Relinking",this.fromHandleArchetype=new At("Diamond",{desiredSize:rt.nu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new At("Diamond",{desiredSize:rt.nu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.tS=new G,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof St))return;let i="RelinkFrom",s=null;if(t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null&&(s=this.makeAdornment(n,!1),t.addAdornment(i,s)))}if(s===null&&t.removeAdornment(i),i="RelinkTo",s=null,t.isSelected&&!this.diagram.isReadOnly){const n=t.selectionObject;n!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&n.actualBounds.isReal()&&n.isVisibleObject()&&(s=t.findAdornment(i),s===null?(s=this.makeAdornment(n,!0),t.addAdornment(i,s)):s.c())}s===null&&t.removeAdornment(i)}makeAdornment(t,i){let s=i?this._P:this.QP;return s&&(s=s.copy(),s.adornedObject=t),s}get fromHandleArchetype(){return this.lL}set fromHandleArchetype(t){this.lL=t,t!==null?this.QP=new Ft(bt.Link).add(t).Et():this.QP=null}get toHandleArchetype(){return this.hL}set toHandleArchetype(t){this.hL=t,t!==null?this._P=new Ft(bt.Link).add(t).Et():this._P=null}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof Ft||u.o("new handle is not in an Adornment: "+t)),this.fs=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Xw()||!t.lastInput.left)return!1;let i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),i!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let s=this.handle;if(s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),s===null&&(s=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),s===null)return;const n=s.part;if(!(n instanceof Ft)||!(n.adornedPart instanceof St))return;this.handle=s,this.isForwards=n===null||n.category==="RelinkTo",this.originalLink=n.adornedPart}const i=this.originalLink;i!==null&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=i.fromPort,this.originalFromNode=i.fromNode,this.originalToPort=i.toPort,this.originalToNode=i.toNode,this.tS.set(i.actualBounds),i.pointsCount>0&&(i.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=rt.sc),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=i.getPoint(0))),i.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=rt.sc),this.temporaryToNode!==null&&(this.temporaryToNode.location=i.getPoint(i.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(i,this.temporaryLink),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,i){if(t===null||i===null)return;i.adjusting=t.adjusting,i.corner=t.corner;let s=t.curve;(s===11||s===10)&&(s=0),i.curve=s,i.curviness=t.curviness,i.isTreeLink=t.isTreeLink,i.points=t.points,i.routing=t.routing,i.smoothness=t.smoothness,i.fromSpot=t.fromSpot,i.fromEndSegmentLength=t.fromEndSegmentLength,i.fromShortLength=t.fromShortLength,i.toSpot=t.toSpot,i.toEndSegmentLength=t.toEndSegmentLength,i.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=this.originalFromNode,s=this.originalFromPort,n=this.originalToNode,o=this.originalToPort,r=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const a=this.targetPort.part;a instanceof gt&&(this.isForwards?(n=a,o=this.targetPort):(i=a,s=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(n=null,o=null):(i=null,s=null):r=null;r!==null?(this.reconnectLink(r,this.isForwards?n:i,this.isForwards?o:s,this.isForwards),this.targetPort===null&&(this.isForwards?r.defaultToPoint=t.lastInput.documentPoint:r.defaultFromPoint=t.lastInput.documentPoint,r.invalidateRoute()),this.transactionResult=this.name,t.D("LinkRelinked",r,this.isForwards?this.originalToPort:this.originalFromPort)):this.originalLink!==null&&this.doNoRelink(this.originalLink,this.isForwards),this.originalLink!==null&&this.originalLink.invalidateOtherJumpOvers(this.tS)}finally{this.stopTool()}}}reconnectLink(t,i,s,n){const o=s!==null&&s.portId!==null?s.portId:"";return n?(t.toNode=i,t.toPortId=o):(t.fromNode=i,t.fromPortId=o),!0}doNoRelink(t,i){}doDraggingMouseMove(t,i,s,n){t!==null?(this.copyPortProperties(t,i,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),s!==null?(this.copyPortProperties(s,n,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var Ms=(S=>(S[S.None=0]="None",S[S.Horizontal=1]="Horizontal",S[S.Vertical=2]="Vertical",S[S.All=3]="All",S))(Ms||{});class Hi extends ve{constructor(t){super();g(this,"dr");g(this,"iS");g(this,"eS");g(this,"fs");g(this,"Yw");g(this,"sS");g(this,"ym");this.name="LinkReshaping",this.dr=new At("Rectangle",{desiredSize:rt.yC,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.iS=new At("Diamond",{desiredSize:rt.nu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.eS=3,this.fs=null,this.Yw=null,this.sS=new C,this.ym=new Y,t&&Object.assign(this,t)}getReshapingBehavior(t){return t?t.gr:0}setReshapingBehavior(t,i){t.gr=i}updateAdornments(t){if(t===null||!(t instanceof St))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.path;s!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(this.name),(i===null||i.nS!==t.pointsCount||i.oS!==t.resegmentable)&&(i=this.makeAdornment(s),i!==null&&(i.nS=t.pointsCount,i.oS=t.resegmentable,t.addAdornment(this.name,i))))}i===null&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,s=i.points,n=i.pointsCount,o=i.isOrthogonal;let r=null;if(s!==null&&n>1){r=new Ft,r.type=bt.Link;const a=i.firstPickIndex,h=i.lastPickIndex,l=o?1:0;if(i.resegmentable&&i.computeCurve()!==9)for(let c=a+l;c<h-l;c++){const d=this.makeResegmentHandle(t,c);d!==null&&(d.segmentIndex=c,d.segmentFraction=.5,d.fromMaxLinks=999,r.add(d))}for(let c=a+1;c<h;c++){const d=this.makeHandle(t,c);if(d!==null){if(d.segmentIndex=c,c!==a)if(c===a+1&&o){const f=i.getPoint(a);let m=i.getPoint(a+1);O.f(f.x,m.x)&&O.f(f.y,m.y)?(m=i.getPoint(a-1),O.f(f.x,m.x)?(this.setReshapingBehavior(d,2),d.cursor="n-resize"):O.f(f.y,m.y)&&(this.setReshapingBehavior(d,1),d.cursor="w-resize")):O.f(f.x,m.x)?(this.setReshapingBehavior(d,2),d.cursor="n-resize"):O.f(f.y,m.y)&&(this.setReshapingBehavior(d,1),d.cursor="w-resize")}else if(c===h-1&&o){let f=i.getPoint(h-1);const m=i.getPoint(h);O.f(f.x,m.x)&&O.f(f.y,m.y)?(f=i.getPoint(h+1),O.f(f.x,m.x)?(this.setReshapingBehavior(d,2),d.cursor="n-resize"):O.f(f.y,m.y)&&(this.setReshapingBehavior(d,1),d.cursor="w-resize")):O.f(f.x,m.x)?(this.setReshapingBehavior(d,2),d.cursor="n-resize"):O.f(f.y,m.y)&&(this.setReshapingBehavior(d,1),d.cursor="w-resize")}else c===h||(this.setReshapingBehavior(d,3),d.cursor="move");r.add(d)}}r.adornedObject=t}return r}makeHandle(t,i){const s=this.handleArchetype;return s===null?null:s.copy().rS()}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t}makeResegmentHandle(t,i){const s=this.midHandleArchetype;return s===null?null:s.copy().rS()}get midHandleArchetype(){return this.iS}set midHandleArchetype(t){this.iS=t}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof Ft||u.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedLink(){return this.Yw}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const i=this.handle.part.adornedPart;if(i instanceof St){if(this.Yw=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&this.handle.fromMaxLinks===999){const s=i.points.copy(),n=this.getResegmentingPoint();if(s.insertAt(this.handle.segmentIndex+1,n),i.isOrthogonal&&s.insertAt(this.handle.segmentIndex+1,n),i.points=s,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.sS=i.getPoint(this.handle.segmentIndex),this.ym=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Yw=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.ym),this.stopTool()}getResegmentingPoint(){return this.handle===null?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(U.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const s=this.adornedLink;if(s!==null&&s.resegmentable&&this.handle!==null){const n=this.handle.segmentIndex,o=s.getPoint(n-1),r=s.getPoint(n),a=s.getPoint(n+1);if(s.isOrthogonal){if(n>s.firstPickIndex+1&&n<s.lastPickIndex-1){let h=s.getPoint(n-2);if(this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(h,o,r,a,!0)||this.isInLineOrtho(h,o,r,a,!1))){const l=s.points.copy();this.isInLineOrtho(h,o,r,a,!0)?(l.setElt(n-2,new C(h.x,(a.y+h.y)/2)),l.setElt(n+1,new C(a.x,(a.y+h.y)/2))):(l.setElt(n-2,new C((a.x+h.x)/2,h.y)),l.setElt(n+1,new C((a.x+h.x)/2,a.y))),l.removeAt(n),l.removeAt(n-1),s.points=l,s.invalidateAdornments()}else if(h=s.getPoint(n+2),this.isWithinResegmentingDistance(r,a)&&(this.isInLineOrtho(o,r,a,h,!0)||this.isInLineOrtho(o,r,a,h,!1))){const l=s.points.copy();this.isInLineOrtho(o,r,a,h,!0)?(l.setElt(n-1,new C(o.x,(o.y+h.y)/2)),l.setElt(n+2,new C(h.x,(o.y+h.y)/2))):(l.setElt(n-1,new C((o.x+h.x)/2,o.y)),l.setElt(n+2,new C((o.x+h.x)/2,h.y))),l.removeAt(n+1),l.removeAt(n),s.points=l,s.invalidateAdornments()}}}else{const h=C.l();if(O.dl(o.x,o.y,a.x,a.y,r.x,r.y,h)&&h.distanceSquaredPoint(r)<this.resegmentingDistance*this.resegmentingDistance){const l=s.points.copy();l.removeAt(n),s.points=l,s.invalidateAdornments()}C.e(h)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("LinkReshaped",this.adornedLink,this.ym)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,s,n,o){return o?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance&&Math.abs(s.y-n.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance&&Math.abs(s.x-n.x)<this.resegmentingDistance}get resegmentingDistance(){return this.eS}set resegmentingDistance(t){this.eS=t}reshape(t){const i=this.adornedLink;if(i===null)return;const s=this.handle;if(s===null)return;i.startRoute();let n=s.segmentIndex;const o=this.getReshapingBehavior(s);if(i.isOrthogonal)if(n===i.firstPickIndex+1){const r=i.firstPickIndex+1;o===2?(i.setPointAt(r,i.getPoint(r-1).x,t.y),i.setPointAt(r+1,i.getPoint(r+2).x,t.y)):o===1&&(i.setPointAt(r,t.x,i.getPoint(r-1).y),i.setPointAt(r+1,t.x,i.getPoint(r+2).y))}else if(n===i.lastPickIndex-1){const r=i.lastPickIndex-1;o===2?(i.setPointAt(r-1,i.getPoint(r-2).x,t.y),i.setPointAt(r,i.getPoint(r+1).x,t.y)):o===1&&(i.setPointAt(r-1,t.x,i.getPoint(r-2).y),i.setPointAt(r,t.x,i.getPoint(r+1).y))}else{let r=n;const a=i.getPoint(r),h=i.getPoint(r-1),l=i.getPoint(r+1);O.f(h.x,a.x)&&O.f(a.y,l.y)?(O.f(h.x,i.getPoint(r-2).x)&&!O.f(h.y,i.getPoint(r-2).y)?(i.insertPointAt(r,t.x,h.y),n++,r++):i.setPointAt(r-1,t.x,h.y),O.f(l.y,i.getPoint(r+2).y)&&!O.f(l.x,i.getPoint(r+2).x)?i.insertPointAt(r+1,l.x,t.y):i.setPointAt(r+1,l.x,t.y)):O.f(h.y,a.y)&&O.f(a.x,l.x)?(O.f(h.y,i.getPoint(r-2).y)&&!O.f(h.x,i.getPoint(r-2).x)?(i.insertPointAt(r,h.x,t.y),n++,r++):i.setPointAt(r-1,h.x,t.y),O.f(l.x,i.getPoint(r+2).x)&&!O.f(l.y,i.getPoint(r+2).y)?i.insertPointAt(r+1,t.x,l.y):i.setPointAt(r+1,t.x,l.y)):O.f(h.x,a.x)&&O.f(a.x,l.x)?(O.f(h.x,i.getPoint(r-2).x)&&!O.f(h.y,i.getPoint(r-2).y)?(i.insertPointAt(r,t.x,h.y),n++,r++):i.setPointAt(r-1,t.x,h.y),O.f(l.x,i.getPoint(r+2).x)&&!O.f(l.y,i.getPoint(r+2).y)?i.insertPointAt(r+1,t.x,l.y):i.setPointAt(r+1,t.x,l.y)):O.f(h.y,a.y)&&O.f(a.y,l.y)&&(O.f(h.y,i.getPoint(r-2).y)&&!O.f(h.x,i.getPoint(r-2).x)?(i.insertPointAt(r,h.x,t.y),n++,r++):i.setPointAt(r-1,h.x,t.y),O.f(l.y,i.getPoint(r+2).y)&&!O.f(l.x,i.getPoint(r+2).x)?i.insertPointAt(r+1,l.x,t.y):i.setPointAt(r+1,l.x,t.y)),i.setPointAt(n,t.x,t.y)}else{i.setPointAt(n,t.x,t.y);let r=i.fromNode,a=i.fromPort;if(r!==null){const c=r.findVisibleNode();c!==null&&c!==r&&(r=c,a=r.port)}if(n===1&&a!==null&&i.computeSpot(!0,a).isNoSpot()){const c=a.getDocumentPoint(U.Center,C.l()),d=i.getLinkPointFromPoint(r,a,c,t,!0,C.l());i.setPointAt(0,d.x,d.y),C.e(c),C.e(d)}let h=i.toNode,l=i.toPort;if(h!==null){const c=h.findVisibleNode();c!==null&&c!==h&&(h=c,l=h.port)}if(n===i.pointsCount-2&&l!==null&&i.computeSpot(!1,l).isNoSpot()){const c=l.getDocumentPoint(U.Center,C.l()),d=i.getLinkPointFromPoint(h,l,c,t,!1,C.l());i.setPointAt(i.pointsCount-1,d.x,d.y),C.e(c),C.e(d)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink;if(i===null)return t;const s=this.handle;if(s===null)return t;const n=s.segmentIndex;switch(this.getReshapingBehavior(s)){case 3:return t;case 2:{const o=i.getPoint(n);return new C(o.x,t.y)}case 1:{const o=i.getPoint(n);return new C(t.x,o.y)}default:case 0:return i.getPoint(n)}}get originalPoint(){return this.sS}get originalPoints(){return this.ym}}g(Hi,"None",0),g(Hi,"Horizontal",1),g(Hi,"Vertical",2),g(Hi,"All",3);class Ns extends ve{constructor(t){super();g(this,"pr");g(this,"yr");g(this,"Po");g(this,"yc");g(this,"lS");g(this,"us");g(this,"dr");g(this,"fs");g(this,"wm");g(this,"hS");g(this,"wc");g(this,"Gw");g(this,"Kw");g(this,"jw");this.name="Resizing",this.pr=new rt(1,1).u(),this.yr=new rt(9999,9999).u(),this.Po=new rt(NaN,NaN).u(),this.yc=!1,this.lS=!0,this.us=null,this.dr=new At("Rectangle",{alignmentFocus:U.Center,desiredSize:rt.yC,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.wm=new C,this.hS=new rt,this.wc=new C,this.Gw=new rt(0,0),this.Kw=new rt(1/0,1/0),this.jw=new rt(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(!(t===null||t instanceof St)){if(t.isSelected&&!this.diagram.isReadOnly){const i=t.resizeObject;let s=t.findAdornment(this.name);if(i!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null)){const n=i.getDocumentAngle();t.Nl()&&this.updateResizeHandles(s,n),t.addAdornment(this.name,s);return}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.resizeAdornmentTemplate;if(s){if(i=s.copy(),i===null)return null}else{i=new Ft,i.type=bt.Spot,i.locationSpot=U.Center;const o=new si;o.isPanelMain=!0,i.add(o);let r=this.makeHandle(t,U.TopLeft);r!==null&&i.add(r),r=this.makeHandle(t,U.TopRight),r!==null&&i.add(r),r=this.makeHandle(t,U.BottomRight),r!==null&&i.add(r),r=this.makeHandle(t,U.BottomLeft),r!==null&&i.add(r),r=this.makeHandle(t,U.MiddleTop),r!==null&&i.add(r),r=this.makeHandle(t,U.MiddleRight),r!==null&&i.add(r),r=this.makeHandle(t,U.MiddleBottom),r!==null&&i.add(r),r=this.makeHandle(t,U.MiddleLeft),r!==null&&i.add(r)}return i.adornedObject=t,i}makeHandle(t,i){const s=this.handleArchetype;if(s===null)return null;const n=s.copy().rS();return n.alignment=i,n}updateResizeHandles(t,i){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.NF(t,i);else if(t instanceof bt){const s=t.elements;for(;s.next();){const n=s.value;this.updateResizeHandles(n,i)}}}}NF(t,i){let s=t.alignment;s.isNoSpot()&&(s=U.Center);let n=i;if(s.x<=0)s.y<=0?n+=225:s.y>=1?n+=135:n+=180;else if(s.x>=1)s.y<=0?n+=315:s.y>=1&&(n+=45);else if(s.y<=0)n+=270;else if(s.y>=1)n+=90;else return;n<0?n+=360:n>=360&&(n-=360),n<22.5?t.cursor="e-resize":n<67.5?t.cursor="se-resize":n<112.5?t.cursor="s-resize":n<157.5?t.cursor="sw-resize":n<202.5?t.cursor="w-resize":n<247.5?t.cursor="nw-resize":n<292.5?t.cursor="n-resize":n<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof Ft||u.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedObject(){return this.us}set adornedObject(t){t!==null&&t.part instanceof Ft&&u.o("new handle must not be in an Adornment: "+t),this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&this.adornedObject.part!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.gu=!0,this.startTransaction(this.name),this.wm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.wc.set(this.adornedObject.part.location),this.hS.set(this.adornedObject.desiredSize),this.jw=this.computeCellSize(),this.Gw=this.computeMinSize(),this.Kw=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.gu=!1,t.bl=!0,this.stopTransaction(),this.handle=null,this.us=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){this.adornedObject!==null&&this.adornedObject.part!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||this.adornedObject===null||this.handle===null)return;const i=this.Gw,s=this.Kw,n=this.jw,o=t.lastInput.documentPoint,r=this.adornedObject.getLocalPoint(o,C.l()),a=this.computeReshape(),h=this.computeResize(r,this.handle.alignment,i,s,n,a);this.resize(h),t.maybeUpdate(),C.e(r)}doMouseUp(){const t=this.diagram;if(this.isActive&&this.adornedObject!==null&&this.handle!==null){const i=this.Gw,s=this.Kw,n=this.jw,o=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,C.l()),r=this.computeReshape(),a=this.computeResize(o,this.handle.alignment,i,s,n,r);this.resize(a),C.e(o),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const i=this.diagram,s=this.adornedObject;if(s===null)return;s.desiredSize=t.size;const n=s.part;if(n===null||this.handle===null)return;n.ensureBounds();const o=s.getDocumentPoint(this.handle.alignment.opposite());if(n instanceof Nt){const r=new Y;r.add(n);let a;!this.dragsMembers&&!n.hasPlaceholder()&&(a=new Bn,a.dragsMembers=!1),i.moveParts(r,this.oppositePoint.copy().subtract(o),!0,a)}else n.location=n.location.copy().subtract(o).add(this.oppositePoint);i.maybeUpdate()}computeResize(t,i,s,n,o,r){if(this.adornedObject===null)return G.Fg;i.isNoSpot()&&(i=U.Center);const a=this.adornedObject.naturalBounds,h=a.x,l=a.y,c=a.x+a.width,d=a.y+a.height;let f=1;if(!r){let y=a.width,x=a.height;y<=0&&(y=1),x<=0&&(x=1),f=x/y}const m=C.l();O.Dg(t.x,t.y,h,l,o.width,o.height,m);const p=a.copy();return i.x<=0?i.y<=0?(p.x=Math.max(m.x,c-n.width),p.x=Math.min(p.x,c-s.width),p.width=Math.max(c-p.x,s.width),p.y=Math.max(m.y,d-n.height),p.y=Math.min(p.y,d-s.height),p.height=Math.max(d-p.y,s.height),r||(p.height/p.width>=1?(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f):(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width),p.x=c-p.width,p.y=d-p.height)):i.y>=1?(p.x=Math.max(m.x,c-n.width),p.x=Math.min(p.x,c-s.width),p.width=Math.max(c-p.x,s.width),p.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(p.height/p.width>=1?(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f):(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width),p.x=c-p.width)):(p.x=Math.max(m.x,c-n.width),p.x=Math.min(p.x,c-s.width),p.width=c-p.x,r||(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f,p.y=l+.5*(d-l-p.height))):i.x>=1?i.y<=0?(p.width=Math.max(Math.min(m.x-h,n.width),s.width),p.y=Math.max(m.y,d-n.height),p.y=Math.min(p.y,d-s.height),p.height=Math.max(d-p.y,s.height),r||(p.height/p.width>=1?(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f):(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width),p.y=d-p.height)):i.y>=1?(p.width=Math.max(Math.min(m.x-h,n.width),s.width),p.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(p.height/p.width>=1?(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f):(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width))):(p.width=Math.max(Math.min(m.x-h,n.width),s.width),r||(p.height=Math.max(Math.min(f*p.width,n.height),s.height),p.width=p.height/f,p.y=l+.5*(d-l-p.height))):i.y<=0?(p.y=Math.max(m.y,d-n.height),p.y=Math.min(p.y,d-s.height),p.height=d-p.y,r||(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width,p.x=h+.5*(c-h-p.width))):i.y>=1&&(p.height=Math.max(Math.min(m.y-l,n.height),s.height),r||(p.width=Math.max(Math.min(p.height/f,n.width),s.width),p.height=f*p.width,p.x=h+.5*(c-h-p.width))),C.e(m),p}computeReshape(){let t=0;return this.adornedObject instanceof At&&(t=this.adornedObject.aS()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){if(this.adornedObject===null)return rt.sc;const t=this.adornedObject.minSize.copy(),i=this.minSize;return!isNaN(i.width)&&i.width>t.width&&(t.width=i.width),!isNaN(i.height)&&i.height>t.height&&(t.height=i.height),t}computeMaxSize(){if(this.adornedObject===null)return rt.Bk;const t=this.adornedObject.maxSize.copy(),i=this.maxSize;return!isNaN(i.width)&&i.width<t.width&&(t.width=i.width),!isNaN(i.height)&&i.height<t.height&&(t.height=i.height),t}computeCellSize(){var o;const t=new rt(NaN,NaN),i=(o=this.adornedObject)==null?void 0:o.part;if(i){const r=i.resizeCellSize;!isNaN(r.width)&&r.width>0&&(t.width=r.width),!isNaN(r.height)&&r.height>0&&(t.height=r.height)}let s=this.cellSize;isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height);const n=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&n){const r=n.grid;r!==null&&r.visible&&this.isGridSnapEnabled&&(s=r.gridCellSize,isNaN(t.width)&&!isNaN(s.width)&&s.width>0&&(t.width=s.width),isNaN(t.height)&&!isNaN(s.height)&&s.height>0&&(t.height=s.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.pr}set minSize(t){if(!this.pr.equals(t)){let i=t.width;isNaN(i)&&(i=0);let s=t.height;isNaN(s)&&(s=0),this.pr.i(i,s)}}get maxSize(){return this.yr}set maxSize(t){if(!this.yr.equals(t)){let i=t.width;isNaN(i)&&(i=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.yr.i(i,s)}}get cellSize(){return this.Po}set cellSize(t){this.Po.equals(t)||this.Po.a(t)}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}get dragsMembers(){return this.lS}set dragsMembers(t){this.lS=t}get oppositePoint(){return this.wm}set oppositePoint(t){this.wm.equals(t)||this.wm.a(t)}get originalDesiredSize(){return this.hS}get originalLocation(){return this.wc}}class Rn extends ve{constructor(t){super();g(this,"cS");g(this,"fS");g(this,"us",null);g(this,"dr",null);g(this,"Hw",null);g(this,"fs",null);g(this,"uS");g(this,"xm");g(this,"wc");g(this,"dS");g(this,"gS");this.name="Rotating",this.cS=45,this.fS=2,this.wc=new C,this.us=null,this.handleArchetype=new At("Ellipse",{desiredSize:rt.nu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.uS=0,this.xm=new C(NaN,NaN),this.dS=0,this.gS=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Cl()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.rotateObject;if(i!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let s=t.findAdornment(this.name);if((s===null||s.adornedObject!==i)&&(s=this.makeAdornment(i)),s!==null){s.angle=i.getDocumentAngle(),s.hasPlaceholder()||(s.location=this.computeAdornmentLocation(i)),t.addAdornment(this.name,s);return}}}t.removeAdornment(this.name)}}makeAdornment(t){var n;let i=null;const s=(n=t.part)==null?void 0:n.rotateAdornmentTemplate;return s?i=s.copy():this.Hw!==null&&(i=this.Hw.copy()),i===null?null:(i.adornedObject=t,i)}get handleArchetype(){return this.dr}set handleArchetype(t){this.dr=t,t!==null?this.Hw=new Ft(bt.Position,{locationSpot:U.Center}).add(t).Et():this.Hw=null}get handle(){return this.fs}set handle(t){t!==null&&(t.part instanceof Ft||u.o("new handle is not in an Adornment: "+t)),this.fs=t}get adornedObject(){return this.us}set adornedObject(t){t!==null&&t.part instanceof Ft&&u.o("new handle must not be in an Adornment: "+t),this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject===null||this.adornedObject.part===null||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.uS=this.adornedObject.angle,this.xm=this.computeRotationPoint(this.adornedObject),this.wc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const i=t.part;if(i!==null){const s=i.locationObject;if(i.rotationSpot.isSpot())return t.getDocumentPoint(i.rotationSpot);if(t===i||t===s)return s.getDocumentPoint(i.locationSpot)}return t.getDocumentPoint(U.Center)}computeAdornmentLocation(t){let i=this.rotationPoint;i.isReal()||(i=this.computeRotationPoint(t));const s=t.getLocalPoint(i);let n=this.handleAngle;n<0?n+=360:n>=360&&(n-=360),n=Math.round(Math.round(n/45)*45);const o=this.handleDistance;return n===0?s.x=t.naturalBounds.width+o:n===45?(s.x=t.naturalBounds.width+o,s.y=t.naturalBounds.height+o):n===90?s.y=t.naturalBounds.height+o:n===135?(s.x=-o,s.y=t.naturalBounds.height+o):n===180?s.x=-o:n===225?(s.x=-o,s.y=-o):n===270?s.y=-o:n===315&&(s.x=t.naturalBounds.width+o,s.y=-o),t.getDocumentPoint(s)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.us=null,this.xm=new C(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.D("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const i=this.adornedObject;if(i===null||i.part===null)return;i.angle=t;const s=i.part;s.ensureBounds();const n=s.locationObject,o=s.rotateObject;if(n===o||n.isContainedBy(o)){const r=this.wc.copy();s.location=r.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){var r;let i=this.rotationPoint.directionPoint(t)-this.handleAngle;const s=(r=this.adornedObject)==null?void 0:r.panel;s&&(i-=s.getDocumentAngle()),i>=360?i-=360:i<0&&(i+=360);const n=Math.min(Math.abs(this.snapAngleMultiple),180),o=Math.min(Math.abs(this.snapAngleEpsilon),n/2);return!this.diagram.lastInput.shift&&n>0&&o>0&&(i%n<o?i=Math.floor(i/n)*n:i%n>n-o&&(i=(Math.floor(i/n)+1)*n)),i>=360?i-=360:i<0&&(i+=360),i}get snapAngleMultiple(){return this.cS}set snapAngleMultiple(t){this.cS=t}get snapAngleEpsilon(){return this.fS}set snapAngleEpsilon(t){this.fS=t}get originalAngle(){return this.uS}get rotationPoint(){return this.xm}set rotationPoint(t){this.xm=t.copy()}get handleAngle(){return this.dS}set handleAngle(t){this.dS=t}get handleDistance(){return this.gS}set handleDistance(t){this.gS=t}}class nn extends ve{constructor(e){super(),this.name="ClickSelecting",e&&Object.assign(this,e)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class Fn extends ve{constructor(t){super();g(this,"xc");this.name="Action",this.xc=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,i=t.lastInput,s=t.findObjectAt(i.documentPoint,n=>{for(;n.panel!==null;){if(n.isActionable)return n;n=n.panel}return n});return s!==null&&s.isActionable?(this.xc=s,t.gc=t.findObjectAt(i.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionDown!==null&&i.actionDown(t,i)}}doMouseMove(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionMove!==null&&i.actionMove(t,i)}}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,i=this.xc;if(i===null)return;t.targetObject=i,i.actionUp!==null&&i.actionUp(t,i),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===i)return s;s=s.panel}return s},s=>s===i)}this.stopTool()}doCancel(){const t=this.diagram.lastInput,i=this.xc;i!==null&&(t.targetObject=i,i.actionCancel!==null&&i.actionCancel(t,i),this.stopTool())}doStop(){this.xc=null}}class Cs extends ve{constructor(t){super();g(this,"Ll");g(this,"mS");g(this,"yc");g(this,"pS");this.name="ClickCreating",this.Ll=null,this.mS=!0,this.yc=!1,this.pS=new C(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.pS=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.pS))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const i=this.diagram,s=this.archetypeNodeData;if(s===null)return null;let n=null;try{if(i.D("ChangingSelection",i.selection),this.startTransaction(this.name),s instanceof Ht)s.ke()&&(s.Et(),n=s.copy(),n!==null&&i.add(n));else if(s!==null){const o=i.model.copyNodeData(s);u.G(o)&&(i.model.addNodeData(o),n=i.findPartForData(o))}if(n!==null){const o=C.V(t.x,t.y);this.isGridSnapEnabled&&this.diagram.yS(n,t,o),n.location=o,i.allowSelect&&(i.clearSelection(!0),n.isSelected=!0),C.e(o)}i.invalidateDocumentBounds(),this.transactionResult=this.name,i.D("PartCreated",n)}finally{this.stopTransaction(),i.D("ChangedSelection",i.selection)}return n}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){t!==null&&u.ec(t,Cs,"archetypeNodeData"),this.Ll=t}get isDoubleClick(){return this.mS}set isDoubleClick(t){this.mS=t}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){this.yc=t}}class on extends ve{constructor(t){super();g(this,"Xh");g(this,"wS");g(this,"Al");this.name="DragSelecting",this.Xh=175,this.wS=!1,this.Al=new Ht({layerName:"Tool",selectable:!1}).add(new At("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).Et(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const i=t.lastInput;return!(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(i.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const i=this.computeBoxBounds();let s=this.box.findObject("SHAPE");s===null&&(s=this.box.findMainElement());const n=rt.l().i(i.width,i.height);s!==null&&(s.desiredSize=n),this.box.bc(i.x,i.y,!1),rt.e(n),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.D("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new G(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,s=i.lastInput,n=i.findPartsIn(t,this.isPartialInclusion);if(u.tr?s.meta:s.control)if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected&&(r.isSelected=!1)}}else{const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected=!r.isSelected}}else if(s.shift){const o=n.iterator;for(;o.next();){const r=o.value;r.isSelected||(r.isSelected=!0)}}else{const o=new Y,r=i.selection.iterator;for(;r.next();){const l=r.value;n.has(l)||o.add(l)}const a=o.iterator;for(;a.next();){const l=a.value;l.isSelected=!1}const h=n.iterator;for(;h.next();){const l=h.value;l.isSelected||(l.isSelected=!0)}}}get delay(){return this.Xh}set delay(t){this.Xh=t}get isPartialInclusion(){return this.wS}set isPartialInclusion(t){this.wS=t}get box(){return this.Al}set box(t){t!==null&&t.Et(),this.Al=t}}class rn extends ve{constructor(t){super();g(this,"qw");g(this,"aL");g(this,"ko");g(this,"xS");this.name="Panning",this.qw=new C,this.aL=new C,this.ko=!1;const i=this;this.xS=()=>{const s=i.diagram;s!==null&&s.Pi(w.document,"scroll",i.xS,!1),i.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.ko?(t.lastInput.bubbles=!0,t.Ut(w.document,"scroll",this.xS,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.qw.a(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.qw,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.cL()}doMouseUp(){this.cL(),this.stopTool()}cL(){const t=this.diagram;if(this.isActive&&t){if(this.ko){t.lastInput.bubbles=!0;return}const i=t.position,s=t.firstInput.documentPoint,n=t.lastInput.documentPoint;let o=i.x+s.x-n.x,r=i.y+s.y-n.y;t.allowHorizontalScroll||(o=i.x),t.allowVerticalScroll||(r=i.y),t.position=this.aL.i(o,r)}}get bubbles(){return this.ko}set bubbles(t){this.ko=t}get originalPosition(){return this.qw}}class Ti{constructor(e){g(this,"Ww");g(this,"Jw");g(this,"bS");g(this,"kS");this.Ww=null,this.Jw=null,this.bS=null,this.kS=null,e&&Object.assign(this,e)}get mainElement(){return this.bS}set mainElement(e){this.bS=e}get show(){return this.Ww}set show(e){this.Ww!==e&&(this.Ww=e)}get hide(){return this.Jw}set hide(e){this.Jw!==e&&(this.Jw=e)}get valueFunction(){return this.kS}set valueFunction(e){this.kS=e}}class Ye{constructor(e,t,i){g(this,"ri");g(this,"$w");g(this,"kc");this.ri=e,this.$w=t,this.kc=i}}const ne=class ne extends ve{constructor(t){super();g(this,"PS");g(this,"Zw");g(this,"SS");g(this,"MS");g(this,"Qw");g(this,"_w");g(this,"bm");this.name="ContextMenu",this.PS=null,this.Zw=null,this.SS=null,this.MS=new C,this.Qw=null,this.bm=!1;const i=this;this._w=()=>i.stopTool(),t&&Object.assign(this,t)}CF(){const t=new Ti;t.show=(a,h,l)=>l.showDefaultContextMenu(),t.hide=(a,h)=>h.hideDefaultContextMenu(),ne.wu=t;const i=this;this._w=()=>i.stopTool();const s=u.hs("div"),n=u.hs("div");s.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",n.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const o=u.hs("style");w.document.getElementsByTagName("head")[0].appendChild(o),o.sheet.insertRule(".goCXul { list-style: none; }",0),o.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),o.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const r=this.diagram;r!==null&&(r.Ut(s,"contextmenu",ne.jh,!1),r.Ut(s,"selectstart",ne.jh,!1),r.Ut(n,"contextmenu",ne.jh,!1)),s.className="goCXforeground",n.className="goCXbackground",w.document.body&&(w.document.body.appendChild(s),w.document.body.appendChild(n)),ne.km=s,ne.Pm=n,ne.NS=!0}static jh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.MS.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.bm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const i=this.diagram,s=i.lastInput;let n=null;if(t instanceof zt||(t instanceof Xt?n=t:n=i.findObjectAt(s.documentPoint,null,o=>{var r;return!((r=o.layer)!=null&&r.isTemporary)})),n!==null){let o=n;for(;o!==null;){if(o.contextMenu!==null)return o;o=o.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return n.part}else if(i.contextMenu!==null)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Ft){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Ft){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const i=this.currentContextMenu;if(i===null)return;let s=null;i instanceof Ti||(s=t.findObjectAt(t.lastInput.documentPoint,null,null),s!==null&&s.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(s)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(i===void 0&&(i=null),this.bm)return;this.bm=!0,t&&this.standardMouseSelect();const s=this.standardMouseClick();if(this.bm=!1,!s){this.isActive=!0;const n=ne.wu;if(i===null&&(i=this.findObjectWithContextMenu()),i!==null){const o=i.contextMenu;o!==null?(this.currentObject=i instanceof Xt?i:null,this.showContextMenu(o,this.currentObject)):n!==null&&this.showContextMenu(n,this.currentObject)}else n!==null&&this.showContextMenu(n,null);this.currentContextMenu instanceof Ft&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){const s=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Ft){const n=t;n.layerName="Tool",n.selectable=!1,n.scale=1/s.scale,n.category=this.name,n.hasPlaceholder()&&(n.placeholder.scale=s.scale);const o=n.diagram;o!==null&&o!==s&&o.remove(n),s.add(n),i!==null?n.adornedObject=i:n.data=s.model,n.ensureBounds(),this.positionContextMenu(n,i)}else t instanceof Ti&&t.show!==null&&t.show(i,s,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const s=t,n=this.diagram,o=n.lastInput.documentPoint.copy(),r=s.measuredBounds,a=n.viewportBounds;n.lastInput.isTouchEvent&&(o.x-=r.width),o.x+r.width>a.right&&(o.x-=r.width+5/n.scale),o.x<a.x&&(o.x=a.x),o.y+r.height>a.bottom&&(o.y-=r.height+5/n.scale),o.y<a.y&&(o.y=a.y),s.position=o}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;i!==null&&(i instanceof Ft?(t.remove(i),this.Zw!==null&&this.Zw.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof Ti&&(i.hide!==null?i.hide(t,this):i.mainElement!==null&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}LF(){const t=this,i=new Y;return i.add(new Ye("Copy",s=>s.commandHandler.copySelection(),s=>s.commandHandler.canCopySelection())),i.add(new Ye("Cut",s=>s.commandHandler.cutSelection(),s=>s.commandHandler.canCutSelection())),i.add(new Ye("Delete",s=>s.commandHandler.deleteSelection(),s=>s.commandHandler.canDeleteSelection())),i.add(new Ye("Paste",s=>s.commandHandler.pasteSelection(t.mouseDownPoint),s=>s.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new Ye("Select All",s=>s.commandHandler.selectAll(),s=>s.commandHandler.canSelectAll())),i.add(new Ye("Undo",s=>s.commandHandler.undo(),s=>s.commandHandler.canUndo())),i.add(new Ye("Redo",s=>s.commandHandler.redo(),s=>s.commandHandler.canRedo())),i.add(new Ye("Scroll To Part",s=>s.commandHandler.scrollToPart(),s=>s.commandHandler.canScrollToPart())),i.add(new Ye("Zoom To Fit",s=>s.commandHandler.zoomToFit(),s=>s.commandHandler.canZoomToFit())),i.add(new Ye("Reset Zoom",s=>s.commandHandler.resetZoom(),s=>s.commandHandler.canResetZoom())),i.add(new Ye("Group Selection",s=>s.commandHandler.groupSelection(),s=>s.commandHandler.canGroupSelection())),i.add(new Ye("Ungroup Selection",s=>s.commandHandler.ungroupSelection(),s=>s.commandHandler.canUngroupSelection())),i.add(new Ye("Edit Text",s=>s.commandHandler.editTextBlock(),s=>s.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;this.Qw===null&&(this.Qw=this.LF()),ne.km.innerHTML="",ne.Pm.addEventListener("pointerdown",this._w,!1);const i=this,s=u.hs("ul");s.className="goCXul",ne.km.appendChild(s),s.innerHTML="";const n=this.Qw.iterator;for(;n.next();){const o=n.value,r=o.$w,a=o.kc;if(!u.it(r)||u.it(a)&&!a(t))continue;const h=u.hs("li");h.className="goCXli";const l=u.hs("a");l.className="goCXa",l.href="#",l.$w=r,l.addEventListener("pointerdown",function(c){return this.$w(t),i.stopTool(),c.preventDefault(),!1},!1),l.textContent=o.ri,h.appendChild(l),s.appendChild(h)}ne.km.style.display="block",ne.Pm.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==ne.wu)return;ne.km.style.display="none",ne.Pm.style.display="none";const t=this.diagram;t!==null&&t.Pi(ne.Pm,"pointerdown",this._w,!1),this.currentContextMenu=null}get currentContextMenu(){return this.PS}set currentContextMenu(t){this.PS=t,this.Zw=t instanceof Ft?t.adornedPart:null}get defaultTouchContextMenu(){return ne.NS===!1&&ne.wu===null&&zt.isUsingDOM()&&this.CF(),ne.wu}set defaultTouchContextMenu(t){t===null&&(ne.NS=!0),ne.wu=t}get currentObject(){return this.SS}set currentObject(t){this.SS=t}get mouseDownPoint(){return this.MS}};g(ne,"wu",null),g(ne,"NS",!1),g(ne,"Pm"),g(ne,"km");let li=ne;var hs=(S=>(S[S.LostFocus=1]="LostFocus",S[S.MouseDown=2]="MouseDown",S[S.Tab=3]="Tab",S[S.Enter=4]="Enter",S))(hs||{}),an=(S=>(S[S.SingleClick=1]="SingleClick",S[S.SingleClickSelected=2]="SingleClickSelected",S[S.DoubleClick=3]="DoubleClick",S))(an||{}),hn=(S=>(S[S.None=1]="None",S[S.Active=2]="Active",S[S.Editing=3]="Editing",S[S.Validating=4]="Validating",S[S.Invalid=5]="Invalid",S[S.Validated=6]="Validated",S))(hn||{});const me=class me extends ve{constructor(t){super();g(this,"Pe");g(this,"CS");g(this,"LS");g(this,"Tl");g(this,"Gt");g(this,"AS");g(this,"TS");g(this,"DS");g(this,"tx");g(this,"FS");this.name="TextEditing",this.Pe=new ae,this.CS=null,this.LS=2,this.Tl=null,this.Gt=1,this.AS=1,this.TS=!0,this.DS=null,this.tx=new Ti,this.AF(this.tx),t&&Object.assign(this,t)}AF(t){if(!zt.isUsingDOM())return;const i=u.hs("textarea");this.FS=i;const s=this;i.addEventListener("input",function(n){if(s.textBlock===null)return;const o=s.measureTemporaryTextBlock(this.value),r=this.textScale;this.style.width=20+Math.max(s.textBlock.measuredBounds.width,o.measuredBounds.width)*r+"px",this.rows=Math.max(s.textBlock.lineCount,o.lineCount)},!1),i.addEventListener("keydown",function(n){if(n.isComposing||s.textBlock===null)return;const o=n.key;if(o==="Enter"){s.textBlock.isMultiline===!1&&n.preventDefault(),s.acceptText(4);return}else if(o==="Tab"){s.acceptText(3),n.preventDefault();return}else o==="Escape"&&(s.doCancel(),s.diagram!==null&&s.diagram.doFocus())},!1),i.addEventListener("focus",function(n){s.TF(n)},!1),i.addEventListener("blur",function(n){s.DF(n)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(n,o,r)=>{if(!(n instanceof ae)||!o||!o.div||!(r instanceof me))return;if(r.state===5){i.style.border="3px solid red",i.focus();return}const a=n.getDocumentPoint(U.Center),h=o.position,l=o.scale;let c=n.getDocumentScale()*l;c<r.minimumEditorScale&&(c=r.minimumEditorScale);const d=n.naturalBounds.width*c+6,f=n.naturalBounds.height*c+2,m=(a.x-h.x)*l,p=(a.y-h.y)*l,y=n.verticalAlignment,x=(n.lineHeight+n.spacingAbove+n.spacingBelow)*n.lineCount*c,b=.5*f-.5*x,M=y.y*f-y.y*x+y.offsetY-b-x/2;i.value=n.text,o.div.style.font=n.font;const P=1;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=c*100+"%",i.style.lineHeight="normal",i.style.width=d+"px",i.style.left=(m-d/2|0)-P+"px",i.style.top=(p+M|0)-P+"px",i.style.textAlign=n.textAlign,i.style.margin="0",i.style.padding=P+"px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=n.lineCount,i.textScale=c,i.className="goTXarea",o.div.appendChild(i),i.focus(),r.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(n,o)=>{n.div&&n.div.removeChild(i)}}get textBlock(){return this.CS}set textBlock(t){this.CS=t}get currentTextEditor(){return this.DS}set currentTextEditor(t){this.DS=t}get defaultTextEditor(){return this.tx}set defaultTextEditor(t){this.tx=t}get starting(){return this.LS}set starting(t){this.LS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||me.Pc&&me.Pc!==this&&(me.Pc.acceptText(2),me.Pc&&me.Pc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const i=t.lastInput.documentPoint,s=t.findObjectAt(i);if(s===null||!(s instanceof ae)||!s.editable||s.part===null||!s.part.canEdit())return!1;const n=s.part;return!(n===null||this.starting===2&&!n.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){me.Pc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let i=this.textBlock;if(i===null&&(i=t.findObjectAt(t.lastInput.documentPoint)),i===null||!(i instanceof ae)||(this.textBlock=i,i.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;i.textEditor!==null&&(s=i.textEditor),this.Pe=this.textBlock.copy();const n=new G(this.textBlock.getDocumentPoint(U.TopLeft),this.textBlock.getDocumentPoint(U.BottomRight));t.scrollToRect(n),s!==null&&s.show!==null&&s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.fL());break;case 1:case 4:case 3:if(t===4&&this.textBlock!==null&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.fL());break}}fL(){const t=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(t!==null&&s!==null){const n=t.text;let o="";if(s.valueFunction!==null&&(o=s.valueFunction()),!this.isValidText(t,n,o)){this.Gt=5,this.doError(n,o);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=o,this.doSuccess(n,o),i!==null&&i.D("TextEdited",t,n),this.stopTransaction(),this.stopTool(),i!==null&&i.doFocus()}}doError(t,i){const s=this.textBlock;if(s===null)return;s.errorFunction!==null&&s.errorFunction(this,t,i);const n=this.currentTextEditor;n!==null&&n.show!==null&&n.show(s,this.diagram,this)}doSuccess(t,i){const s=this.textBlock;s!==null&&s.textEdited!==null&&s.textEdited(s,t,i)}doDeactivate(){const t=this.diagram;if(t!==null){if(this.Gt=1,this.currentTextEditor!==null){const i=this.currentTextEditor;i!==null&&i.hide!==null&&i.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){me.Pc=null}TF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.FS;this.Gt===2&&(this.Gt=3),u.it(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}DF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this.FS;u.it(i.focus)&&i.focus(),u.it(i.select)&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,s){const n=this.textValidation;if(n!==null&&!n(t,i,s))return!1;const o=t.textValidation;return!(o!==null&&!o(t,i,s))}get textValidation(){return this.Tl}set textValidation(t){this.Tl=t}get minimumEditorScale(){return this.AS}set minimumEditorScale(t){this.AS=t}get selectsTextOnActivate(){return this.TS}set selectsTextOnActivate(t){this.TS=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const i=this.Pe;return i.text=t,this.textBlock!==null&&i.ht(this.textBlock.Dl,1/0),i}};g(me,"LostFocus",1),g(me,"MouseDown",2),g(me,"Tab",3),g(me,"Enter",4),g(me,"SingleClick",1),g(me,"SingleClickSelected",2),g(me,"DoubleClick",3),g(me,"StateNone",1),g(me,"StateActive",2),g(me,"StateEditing",3),g(me,"StateValidating",4),g(me,"StateInvalid",5),g(me,"StateValidated",6),g(me,"Pc",null);let qi=me;var ln=(S=>(S[S.Default=1]="Default",S[S.AnimateLocations=2]="AnimateLocations",S[S.None=3]="None",S))(ln||{});const ts=class ts{constructor(e){g(this,"N");g(this,"Si");g(this,"Oi");g(this,"wr");g(this,"zn");g(this,"So");g(this,"RS");g(this,"vS");g(this,"Sm");g(this,"pi");g(this,"Sc");g(this,"on");g(this,"Mm");g(this,"Hh");g(this,"ix");g(this,"Nm");g(this,"ex");g(this,"Mc");g(this,"pu");g(this,"Cm");this.N=zt.um(),this.Si=!1,this.Sm=!1,this.pi=!1,this.Sc=!1,this.ex=!0,this.Mc=1,this.pu=!1,this.Oi=!0,this.wr=!0,this.So=600,this.RS=!1,this.vS=!1,this.zn=new I,this.on=new Ii,this.Mm=new Ii,this.on.ds=this,this.Hh=new I,this.ix=new I,this.Nm=new I,this.Cm=new I,e&&Object.assign(this,e)}Mo(e){this.N=e}NE(){return this.N}canStart(e){return!0}Fl(e){return!this.Oi||!this.canStart(e)?!1:(this.zn.add(e),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.N.Mi(),this.pi=!0,!0)}getBundleAnimation(){return this.Mm}OS(){if(!this.Oi||(this.Mm.ce.count>0&&this.Mm.start(),!this.pi))return;const e=this.on,t=this.N,i=this.zn.has("Model");if(i&&(this.Sc=!0,this.Mc===1?(e.isViewportUnconstrained=!0,e.ce.clear(),e.add(t,"position",t.position.copy().offset(0,-200),t.position),e.add(t,"opacity",0,1)):this.Mc===3&&e.ce.clear(),this.Mc===2&&t.nx.equals(t.at)?this.ex=!0:this.ex=!1,t.D("InitialAnimationStarting",this)),i&&!this.wr||e.ce.count===0){this.zn.clear(),this.pi=!1,e.ce.clear(),e.lx(t),this.Sc=!1,t.S();return}this.zn.clear(),t.xr=!1;const s=e.ce.get(t);t.autoScale!==1&&s!==null&&(delete s.ei.scale,delete s.gs.scale);const n=this;w.requestAnimationFrame(()=>{n.pi===!1||e.Si||(t.getRenderingHint("temporaryPixelRatio")&&t.Vw(),t.IS(),n.pi=!1,e.start(),e.Si&&(n.xu(),t.invalidateDocumentBounds(),e.uL(0),t.ur(!0),n.bu(),t.D("AnimationStarting",n)))})}ES(){return this.zn.has("Trigger")&&this.zn.count===1}dL(e,t,i,s){this.isTicking||this.ES()||e instanceof St&&(e.fromNode!==null||e.toNode!==null)||this.on.add(e,"position",t,i,s)}hx(e){return this.on.hx(e)}US(e){return this.on.US(e)}FF(e){const t=this.Hh,i=this;function s(){if(i.Nm.count>0&&(t.addAll(i.Nm),i.Nm.clear(),i.Si=!0),i.Si===!1||t.count===0)return;i.ix.addAll(t);const n=i.ix.iterator;for(;n.next();){const o=n.value;o.Si!==!1&&(o.RF()?o.gL(!1):o.Nc=!0)}if(i.ix.clear(),i.Si===!1){w.requestAnimationFrame(s);return}i.xu(),i.N.ur(),i.bu(),w.requestAnimationFrame(s)}this.Si?this.vF(e):(this.Si=!0,t.add(e),w.requestAnimationFrame(()=>s()))}vF(e){this.Nm.add(e)}OF(){const e=this.Hh.iterator;for(;e.next();)e.value.Nc=!1}xu(){if(this.Sm)return;const e=this.N;this.RS=e.skipsUndoManager,this.vS=e.fe,e.skipsUndoManager=!0,e.fe=!0,this.Sm=!0}bu(){const e=this.N;e.skipsUndoManager=this.RS,e.fe=this.vS,this.Sm=!1}stopAnimation(e){const t=this.on;if(this.pi===!0&&(this.pi=!1,this.Sc=!1,this.zn.clear(),t.IF()&&this.N.requestUpdate()),!this.Si){t.ce.clear(),t.lx(this.N);return}if(t.ku(!0),t.lx(null),e===!0){const i=this.Hh.toArray();for(let s=0;s<i.length;s++)i[s].ku(!0)}}ku(e){this.Hh.delete(e),this.Hh.count===0&&(this.Si=!1,this.N.requestUpdate()),e===this.defaultAnimation&&this.N.D("AnimationFinished",this)}Cc(e,t){this.pi&&(!this.zn.has("Expand Tree")&&!this.zn.has("Expand SubGraph")||(this.on.Cc(e,t),this.mL(e)))}Lc(e,t){this.pi&&(!this.zn.has("Collapse Tree")&&!this.zn.has("Collapse SubGraph")||(this.on.Lc(e,t),this.on.BS(t,"position",t.position,t.position),this.mL(e)))}pL(e,t){!this.pi||e.equals(t)||this.ES()||(this.N.Vh||(e=t.copy()),this.on.BS(this.N,"position",e,t))}yL(e,t){this.pi&&(this.ES()||this.on.add(this.N,"scale",e,t))}VS(e,t){e.Se&&(e.br=t,this.Cm.add(e))}mL(e){const t=e.findLinksConnected();for(;t.next();){const i=t.value;i.Se&&(i.br=i.points.copy(),this.Cm.add(i))}}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e,e&&this.Hh.each(t=>{!t.isAnimating&&t.runCount===1/0&&t.start()})}get duration(){return this.So}set duration(e){e<1&&u.W(e,">= 1",ts,"duration"),this.So=e}get isAnimating(){return this.Si}get isTicking(){return this.Sm}get isInitial(){return this.wr}set isInitial(e){this.wr=e}get defaultAnimation(){return this.on}get activeAnimations(){return this.Hh}get initialAnimationStyle(){return this.Mc}set initialAnimationStyle(e){this.Mc=e}static defineAnimationEffect(e,t){ts.ax.set(e,t)}static zS(e,t,i,s,n){e===null&&(e=[0,0,0,0]),t===null&&(t=[0,0,0,0]);let o=e[0],r=e[1];const a=e[2],h=e[3];let l=t[0],c=t[1];const d=t[2],f=t[3];a===0||a===100?(o=l,r=c):(d===0||d===100)&&(l=o,c=r),Math.abs(l-o)>180&&(l>o?o+=360:l+=360);const m=n(i,o,l-o,s)%360,p=n(i,r,c-r,s),y=n(i,a,d-a,s),x=n(i,h,f-h,s);return"hsla("+m+", "+p+"%, "+y+"%, "+x+")"}};g(ts,"ax",new Z),g(ts,"Default",1),g(ts,"AnimateLocations",2),g(ts,"None",3);let ti=ts;{const S=ti.ax,e=(t,i,s,n,o,r)=>{t.position=new C(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))};S.set("position:diagram",e),S.set("position",e),S.set("position:part",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new C(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),S.set("location",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!0):t.location=new C(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),S.set("position:placeholder",(t,i,s,n,o,r)=>{o<r?t.bc(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):t.position=new C(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),S.set("position:nodeCollapse",(t,i,s,n,o,r)=>{const a=t.actualBounds,h=s.actualBounds,l=h.x+h.width/2-a.width/2,c=h.y+h.height/2-a.height/2;o<r?t.bc(n(o,i.x,l-i.x,r),n(o,i.y,c-i.y,r),!1):t.position=new C(n(o,i.x,l-i.x,r),n(o,i.y,c-i.y,r))}),S.set("desiredSize",(t,i,s,n,o,r)=>{t.desiredSize=new rt(n(o,i.width,s.width-i.width,r),n(o,i.height,s.height-i.height,r))}),S.set("width",(t,i,s,n,o,r)=>{t.width=n(o,i,s-i,r)}),S.set("height",(t,i,s,n,o,r)=>{t.height=n(o,i,s-i,r)}),S.set("fill",(t,i,s,n,o,r)=>{t.fill=ti.zS(i,s,o,r,n)}),S.set("stroke",(t,i,s,n,o,r)=>{t.stroke=ti.zS(i,s,o,r,n)}),S.set("strokeWidth",(t,i,s,n,o,r)=>{t.strokeWidth=n(o,i,s-i,r)}),S.set("strokeDashOffset",(t,i,s,n,o,r)=>{t.strokeDashOffset=n(o,i,s-i,r)}),S.set("background",(t,i,s,n,o,r)=>{t.background=ti.zS(i,s,o,r,n)}),S.set("opacity",(t,i,s,n,o,r)=>{t.opacity=n(o,i,s-i,r)}),S.set("scale",(t,i,s,n,o,r)=>{t.scale=n(o,i,s-i,r)}),S.set("angle",(t,i,s,n,o,r)=>{t.angle=n(o,i,s-i,r)})}const $e=class $e{constructor(e){g(this,"cx");g(this,"Lm");g(this,"Si");g(this,"Pu");g(this,"So");g(this,"ms");g(this,"wL");g(this,"Ac");g(this,"ce");g(this,"fx");g(this,"ei");g(this,"Xn");g(this,"Su");g(this,"Tc");g(this,"ux");g(this,"gx");g(this,"Nc");g(this,"XS");g(this,"mx");g(this,"ds");g(this,"N");g(this,"YS");g(this,"GS");g(this,"KS");this.N=null,this.ds=null,this.XS=null,this.mx=null,this.YS=!1,this.Si=!1,this.Nc=!1,this.ei=0,this.Xn=0,this.cx=$e.EaseInOutQuad,this.Lm=$e.EaseInOutQuad,this.Su=!1,this.Tc=!1,this.ux=1,this.gx=0,this.So=NaN,this.ms=NaN,this.GS=0,this.Pu=null,this.wL=C.xo,this.ce=new Z,this.fx=new Z,this.Ac=new I,this.KS=1,e&&Object.assign(this,e)}suspend(){this.Nc=!0}advanceTo(e,t){t&&(this.Nc=!1),this.Su&&e>=this.ms&&(this.Tc=!0,e=e-this.ms),this.GS=e,this.gL(!0),this.ds.xu(),this.N.ur(),this.ds.bu(),this.N.redraw()}lx(e){if(this.fx.clear(),this.Tc=!1,this.gx=0,this.ms=NaN,this.Ac.count>0&&this.Ac.clear(),e!==null){const t=e.links;for(;t.next();)t.value.br=null}}IF(){return this.ce.count>0}start(){if(this.ce.count===0)return this;if(this.Si)return this;let e=this.N;const t=this.ce.iterator;for(;t.next();){const s=t.key;e===null&&(s instanceof zt?e=s:s instanceof Xt&&(e=s.diagram))}if(e!==null)this.N=e,this.ds=e.animationManager;else return this;const i=this.ds;return i.isEnabled===!1?this:(this.ms=isNaN(this.So)?i.duration:this.So,this.Lm=this.cx,i.Sc&&i.Mc===1&&this===i.defaultAnimation&&(this.Lm=$e.EaseOutExpo,this.ms=isNaN(this.So)?i.duration===600?900:i.duration:this.So),this.KS=e.scrollMode,this.isViewportUnconstrained&&(e.qh=2),i.xu(),this.Ac.each(s=>{s.data=null,e.add(s)}),i.bu(),this.Si=!0,this.ei=+new Date,this.Xn=this.ei+this.ms,i.FF(this),this)}addTemporaryPart(e,t){return e.ke()?(this.Ac.add(e),this.N=t,this):this}add(e,t,i,s,n){if(this.N===null&&(e instanceof zt?this.N=e:e instanceof Xt&&e.diagram!==null&&(this.N=e.diagram)),e instanceof Ht){if(!e.isAnimated)return this;t==="position"&&(t="position:part")}return this.BS(e,t,i,s,n),this}BS(e,t,i,s,n){const o=this.ce;let r,a,h;if(e instanceof zt&&t==="position"&&(t="position:diagram"),(t==="fill"||t==="stroke"||t==="background")&&(Jt.No(i),Jt.jS(),i=[Jt.Ii.n0,Jt.Ii.n1,Jt.Ii.n2,Jt.Ii.n3],Jt.No(s),Jt.jS(),s=[Jt.Ii.n0,Jt.Ii.n1,Jt.Ii.n2,Jt.Ii.n3]),o.has(e))r=o.get(e),a=r.ei,h=r.gs,a[t]===void 0&&(a[t]=this.Mu(i)),h[t]=this.Mu(s);else{if(t==="position"&&i.equalsApprox(s))return;a={},h={},a[t]=this.Mu(i),h[t]=this.Mu(s),r=new In(a,h,n),o.set(e,r)}const l=a[t];l instanceof C&&!l.isReal()&&l.a(this.wL),n&&t.indexOf("position:")===0&&e instanceof Ht?r.yx.location=this.Mu(e.location):n&&(r.yx[t]=this.Mu(i))}Mu(e){return e instanceof C||e instanceof rt?e.copy():e}EF(e){const t=this.ce;if(t.has(e)){const i=t.get(e);i.wx=!0}}hx(e){if(!this.Si)return!1;const t=this.ce.get(e);return t!==null&&t.wx}US(e){if(!this.Si)return!1;const t=this.ce.get(e);return t!==null&&!!(t.ei.position||t.ei["position:part"]||t.ei.location)}RF(){if(this.Ac.count>0)return!0;const e=this.ce.iterator;for(;e.next();){const t=e.key;if(t instanceof Xt&&t.diagram!==null||t instanceof zt)return!0}return!1}gL(e){if(this.Nc&&!e)return;const t=this.ds;if(this.Si===!1)return;const i=+new Date;let s=i>this.Xn?this.ms:i-this.ei;e&&(s=this.GS,s<this.ms?(this.ei=+new Date-s,this.Xn=this.ei+this.ms):s=this.ms),t.xu(),this.uL(s),this.N.ur(!0),t.bu(),i>this.Xn&&(this.Su&&!this.Tc?(this.ei=+new Date,this.Xn=this.ei+this.ms,this.Tc=!0):this.ku(!1))}uL(e){const t=this.ms,i=this.ce.iterator,s=this.Tc;for(;i.next();){const n=i.key;if(n instanceof Xt&&n.diagram===null)continue;const o=i.value,r=s?o.gs:o.ei,a=s?o.ei:o.gs,h=ti.ax;for(const l in a)l==="position"&&(a["position:placeholder"]||a["position:nodeCollapse"])||h.get(l)!==null&&h.get(l)(n,r[l],a[l],this.Lm,e,t,this)}}stop(){return this.Si?(this.ku(!0),this):this}ku(e){if(this.mx!==null&&this.mx.UF(this.XS),!this.Si)return;const t=this.N,i=this.ds;i.Sc=!1,this.Si=!1,this.Nc=!1,i.xu();const s=this.ce,n=this.Ac.iterator;for(;n.next();)t.remove(n.value);const o=this.Su,r=s.iterator,a=ti.ax;for(;r.next();){const l=r.key,c=r.value,d=o?c.gs:c.ei,f=o?c.ei:c.gs,m=c.yx;for(const p in f)if(a.get(p)!==null){let y=p;c.xx&&(y==="position:nodeCollapse"||y==="position:placeholder")&&(y="position"),a.get(y)(l,d[p],m[p]!==void 0?m[p]:c.xx?d[p]:f[p],this.Lm,this.ms,this.ms,this)}c.xx&&m.location!==void 0&&l instanceof Ht&&(l.location=m.location),c.wx&&l instanceof Ht&&l.Ei(!1)}this.gx++;const h=!e&&this.ux>this.gx;if(!h&&(this===i.Mm||this===i.defaultAnimation)&&this.ce.clear(),t.bx.clear(),t.CP(!1),t.invalidateDocumentBounds(),t.S(),t.ur(!0),i.defaultAnimation===this){const l=i.Cm.iterator;for(;l.next();)l.value.BF();i.Cm.clear()}if(t.ur(!0),this.isViewportUnconstrained&&(t.scrollMode=this.KS),i.bu(),h){this.Tc=!1,this.start();return}this.lx(null),t.xL(),i.ku(this),this.Pu&&this.Pu(this),t.requestUpdate()}Cc(e,t){const i=t.actualBounds;let s=null;if(t instanceof Nt&&(s=t.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(U.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(e,"position",n,e.position,!1)}else this.add(e,"position",new C(i.x+i.width/2,i.y+i.height/2),e.position,!1);this.add(e,"scale",.01,e.scale,!1),e instanceof Nt&&this.VF(e,t)}VF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof gt&&this.Cc(s,t)}}Lc(e,t){if(!e.isVisible())return;let i=null;if(t instanceof Nt&&(i=t.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(U.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(e,"position:placeholder",e.position,s,!0)}else this.add(e,"position:nodeCollapse",e.position,t,!0);this.add(e,"scale",e.scale,.01,!0),this.EF(e),e instanceof Nt&&this.zF(e,t)}zF(e,t){const i=e.memberParts;for(;i.next();){const s=i.value;s instanceof gt&&this.Lc(s,t)}}get duration(){return this.So}set duration(e){u.s(e,"number",$e,"duration"),e<1&&u.W(e,">= 1",$e,"duration"),this.So=e}get reversible(){return this.Su}set reversible(e){this.Su=e}get runCount(){return this.ux}set runCount(e){e>0?this.ux=e:u.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Pu}set finished(e){this.Pu!==e&&(e!==null&&u.k(e,$e,"finished"),this.Pu=e)}get easing(){return this.cx}set easing(e){this.cx=e}get isViewportUnconstrained(){return this.YS}set isViewportUnconstrained(e){this.YS=e}get isAnimating(){return this.Si}getTemporaryState(e){let t=this.fx.get(e);return t===null&&(t={},this.fx.set(e,t)),t}};g($e,"EaseLinear",(e,t,i,s)=>i*e/s+t),g($e,"EaseInOutQuad",(e,t,i,s)=>(e/=s/2,e<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t)),g($e,"EaseInQuad",(e,t,i,s)=>i*(e/=s)*e+t),g($e,"EaseOutQuad",(e,t,i,s)=>-i*(e/=s)*(e-2)+t),g($e,"EaseInExpo",(e,t,i,s)=>e===0?t:i*Math.pow(2,10*(e/s-1))+t),g($e,"EaseOutExpo",(e,t,i,s)=>e===s?t+i:i*(-Math.pow(2,-10*e/s)+1)+t);let Ii=$e;class In{constructor(e,t,i){g(this,"ei");g(this,"gs");g(this,"yx");g(this,"xx");g(this,"wx");this.ei=e,this.gs=t,this.yx={},this.xx=i,this.wx=!1}}var oa=(S=>(S[S.Default=1]="Default",S[S.Immediate=2]="Immediate",S[S.Bundled=3]="Bundled",S))(oa||{});const Fs=class Fs{constructor(e,t,i){g(this,"be");g(this,"en");g(this,"Nu");g(this,"Dc");this.be=null,this.en=e,this.Nu=i||1,this.Dc=null,t!==void 0&&(this.Dc=t,i===void 0&&(this.Nu=2))}copy(){const e=new Fs(this.en);e.Nu=this.Nu;const t=this.Dc;if(t!==null){const i={};t.duration!==void 0&&(i.duration=t.duration),t.finished!==void 0&&(i.finished=t.finished),t.easing!==void 0&&(i.easing=t.easing),e.Dc=i}return e}get propertyName(){return this.en}set propertyName(e){this.en=e}get animationSettings(){return this.Dc}set animationSettings(e){this.Dc=e}XF(e){const t=this.Dc;t!==null&&(t.duration&&(e.duration=t.duration),t.finished&&(e.finished=t.finished),t.easing&&(e.easing=t.easing))}get startCondition(){return this.Nu}set startCondition(e){this.Nu=e}};g(Fs,"Default",1),g(Fs,"Immediate",2),g(Fs,"Bundled",3);let un=Fs;class Xe{constructor(e){g(this,"N");g(this,"St");g(this,"$t");g(this,"kr");g(this,"Rl");g(this,"vl");g(this,"Ol");g(this,"Il");g(this,"El");g(this,"Ul");g(this,"Bl");g(this,"Vl");g(this,"zl");g(this,"Xl");g(this,"Yl");g(this,"Gl");g(this,"kc");g(this,"Kl");g(this,"kx");g(this,"Am");g(this,"Cu");g(this,"Ct");I.Ki(this),this.N=null,this.Ct=new Y,this.St="",this.$t=1,this.kr=!1,this.Rl=!0,this.vl=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.Ul=!0,this.Bl=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.Gl=!0,this.kc=!0,this.Kl=!0,this.kx=!0,this.Am=!1,this.Cu=[],e&&Object.assign(this,e)}YF(){const e=this.Ct;for(let t=0;t<e.length;t++)e.r[t].HS(null);e.clear(),this.Cu.length=0}Mo(e){this.N=e}toString(e){e===void 0&&(e=0);const t='Layer "'+this.name+'"';if(e<=0)return t;let i=0,s=0,n=0,o=0,r=0;const a=this.Ct.iterator;for(;a.next();){const l=a.value;l instanceof Nt?n++:l instanceof gt?s++:l instanceof St?o++:l instanceof Ft?r++:i++}let h="";if(i>0&&(h+=i+" Parts "),s>0&&(h+=s+" Nodes "),n>0&&(h+=n+" Groups "),o>0&&(h+=o+" Links "),r>0&&(h+=r+" Adornments "),e>1){const l=this.Ct.iterator;for(;l.next();){const c=l.value;h+=`
    `+c.toString();const d=c.data;d!==null&&I.as(d)&&(h+=" #"+I.as(d)),c instanceof gt?h+=" "+u.toString(d):c instanceof St&&(h+=" "+u.toString(c.fromNode)+" "+u.toString(c.toNode))}}return t+" "+this.Ct.count+": "+h}findObjectAt(e,t,i){if(t===void 0&&(t=null),i===void 0&&(i=null),this.Kl===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(s=!0);const n=C.l(),o=this.Ct.r,r=o.length;for(let a=r;a--;){const h=o[a];if(s===!0&&h.Nl()===!1||!h.isVisible())continue;n.a(e),n.Oe(h.Us);let l=h.bL(n,t,i);if(l!==null&&(t!==null&&(l=t(l)),l!==null&&(i===null||i(l))))return C.e(n),l}return C.e(n),null}findObjectsAt(e,t,i,s){if(t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof Y)&&!(s instanceof I)&&(s=new I),this.Kl===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(n=!0);const o=C.l(),r=this.Ct.r,a=r.length;for(let h=a;h--;){const l=r[h];if(n===!0&&l.Nl()===!1||!l.isVisible())continue;o.a(e),o.Oe(l.Us);let c=l;l.kL(o,t,i,s)&&(t!==null&&(c=t(c)),c!==null&&(i===null||i(c))&&s.add(c))}return C.e(o),s}findObjectsIn(e,t,i,s,n){if(t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof Y)&&!(n instanceof I)&&(n=new I),this.Kl===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(e)&&(o=!0);const r=this.Ct.r,a=r.length;for(let h=a;h--;){const l=r[h];if(o===!0&&l.Nl()===!1||!l.isVisible())continue;let c=l;l.Tm(e,t,i,s,n)&&(t!==null&&(c=t(c)),c!==null&&(i===null||i(c))&&n.add(c))}return n}OP(e,t,i,s,n,o,r){if(this.Kl===!1)return n;const a=this.Ct.r,h=a.length;for(let l=h;l--;){const c=a[l];if(r===!0&&c.Nl()===!1||!o(c)||!c.isVisible())continue;let d=c;c.Tm(e,t,i,s,n)&&(t!==null&&(d=t(d)),d!==null&&(i===null||i(d))&&n.add(d))}return n}findObjectsNear(e,t,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof Y||n instanceof I)&&(o=n),n=!0),!(o instanceof Y)&&!(o instanceof I)&&(o=new I),this.Kl===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(e)&&(r=!0);const a=C.l(),h=C.l(),l=this.Ct.r,c=l.length;for(let d=c;d--;){const f=l[d];if(r===!0&&f.Nl()===!1||!f.isVisible())continue;a.a(e),a.Oe(f.Us),h.i(e.x+t,e.y),h.Oe(f.Us);let m=f;f.PL(a,h,i,s,n,o)&&(i!==null&&(m=i(m)),m!==null&&(s===null||s(m))&&o.add(m))}return C.e(a),C.e(h),o}qS(){return this.Ct.r}ps(e,t){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(s===0)return;const n=u.et(),o=u.et();for(let r=0;r<s;r++){const a=i[r];if(a.WS=r,a instanceof St){if(a.Se===!1)continue}else if(a instanceof Ft&&a.adornedPart!==null)continue;const h=a.actualBounds;a.isVisible()&&h.intersectsRectPlus(t,10)?(a.ps(!0),n.push(a)):(a.ps(!1),a.adornments!==null&&a.adornments.count>0&&o.push(a))}for(let r=0;r<n.length;r++){const a=n[r];a.JS();const h=a.adornments;for(;h.next();){const l=h.value;l.ht(1/0,1/0),l.Bt(),l.ps(!0)}}for(let r=0;r<o.length;r++)o[r].JS();u.J(n),u.J(o)}Lu(e){let t=1;return this.$t!==1&&(t=e.globalAlpha,e.globalAlpha=t*this.$t),t}SL(e,t){for(let i=0;i<t;i++)e[i].Au()}Ui(e,t,i){if(!this.visible||this.$t===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(n===0)return;e.kr&&this.SL(s,n);const o=this.Lu(e),r=this.Cu;r.length=0;const a=t.scale,h=G.l();for(let l=0;l<n;l++){const c=s[l];this.Dm(e,c,t,r,a,h,!0)}G.e(h),e.kr&&this.SL(s,n),e.globalAlpha=o}CE(e,t,i){if(!this.visible||this.$t===0)return;const s=this.Ct.r,n=s.length;if(n===0)return;const o=this.Lu(e),r=this.Cu;r.length=0;const a=t.scale,h=G.l();for(let l=0;l<n;l++){const c=s[l];i.has(c)||this.Dm(e,c,t,r,a,h,!0)}G.e(h),e.globalAlpha=o}GF(e,t,i,s){if(!this.visible||this.$t===0||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(o===0)return;const r=this.Lu(e),a=this.Cu;a.length=0;const h=t.scale,l=G.l();for(let c=0;c<o;c++){const d=n[c];i.has(d)&&this.Dm(e,d,t,a,h,l,!1)}G.e(l),e.globalAlpha=r}KF(e,t,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Lu(e);o.Ui(e,i),e.globalAlpha=r}}else{const r=this.Lu(e),a=i.scale,h=G.l(),l=this.Ct.r,c=l.length;for(let d=0;d<c;d++){const f=l[d];!n&&f===o||this.Dm(e,f,i,null,a,h,!1)}G.e(h),e.globalAlpha=r}}LE(e,t,i){if(!this.visible||this.$t===0)return;const s=this.Lu(e),n=this.Cu;n.length=0;const o=t.scale,r=G.l(),a=this.Ct.r,h=a.length,l=i.length;for(let c=0;c<h;c++){const d=a[c],f=d.Wh(d.actualBounds);this.jF(f,i,l,o)&&this.Dm(e,d,t,n,o,r,!0)}G.e(r),e.globalAlpha=s}Dm(e,t,i,s,n,o,r){if(r&&!t.Nl()){e.removePartFromView(t);return}if(s!==null&&t instanceof St&&(t.isOrthogonal&&s.push(t),t.Se===!1)){e.removePartFromView(t);return}let a=!1,h=t.containingGroup;for(;h!==null;)a?h.si!==null&&o.intersectRect(h.si):h.si!==null&&(a=!0,o.a(h.si)),h=h.containingGroup;const l=t.actualBounds;let c=!1;if(a&&t.isVisible()){if(!o.intersectsRect(l)){e.removePartFromView(t);return}c=!o.containsRect(l)}c&&(e.save(),e instanceof Ge?e.partClipRect=o.copy():(e.beginPath(),e.rect(o.x,o.y,o.width,o.height),e.clip())),l.width*n>i.Fm||l.height*n>i.Fm?t.Ui(e,i):this.HF(e,t,i),c&&(e.restore(),e.clearContextCache(!0))}HF(e,t,i){if(e instanceof Ge){t.Ui(e,i);return}const s=t.actualBounds,n=t.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!t.isVisible())return;const o=t.T;if(t.background===null){t.rn(e,"rgba(0,0,0,0.3)",!0,!1,n,s),e.fillRect(s.x,s.y,s.width,s.height);return}if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),t.rn(e,t.background,!0,!1,n,s),e.fillRect(0,0,n.width/2,n.height/2),!o.Yk()){const r=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}jF(e,t,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const a=t[r];if(!(a.width===0||a.height===0)&&e.intersects(a.x-n,a.y-n,a.width+o,a.height+o))return!0}return!1}t(e,t,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,e,this,t,i,s,n)}Jh(e,t,i){const s=this.Ct;if(t.HS(this),e>=s.count)e=s.count;else if(s.elt(e)===t)return-1;s.insertAt(e,t),t.Rm(i);const n=this.diagram;return n!==null&&(i?n.S():n.Jh(t)),this.Px(e,t),e}te(e,t,i){if(!i&&t.layer!==this&&t.layer!==null)return t.layer.te(e,t,i);const s=this.Ct;if(e<0||e>=s.length){if(e=s.indexOf(t),e<0)return-1}else if(s.elt(e)!==t&&(e=s.indexOf(t),e<0))return-1;t.vm(i),s.removeAt(e);const n=this.diagram;return n!==null&&(i?n.S():n.te(t)),t.HS(null),e}Px(e,t){e=this.qF(e,t),t instanceof Nt&&this.WF(e,t),t.svg!==null&&t.svg.remove()}qF(e,t){const i=t.zOrder;if(isNaN(i))return e;const s=this.Ct,n=s.count;if(n<=1)return e;if(e<0&&(e=s.indexOf(t)),e<0)return-1;let o=e-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let a=e+1,h=NaN;for(;a<n&&(h=s.elt(a).zOrder,!!isNaN(h));)a++;if(!isNaN(r)&&r>i)for(;;){if(o===-1||r<=i)return o++,o===e?e:(s.removeAt(e),s.insertAt(o,t),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(h)&&h<i)for(;;){if(a===n||h>=i)return a--,a===e?e:(s.removeAt(e),s.insertAt(a,t),a);for(h=NaN;++a<n&&(h=s.elt(a).zOrder,!!isNaN(h)););}return e}WF(e,t){if(t===null||!isNaN(t.zOrder))return;this.JF(e,t);const i=t.containingGroup;i!==null&&this.Px(-1,i)}JF(e,t){if(t.memberParts.count===0)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===t&&(e=o,i>=0)||i<0&&r.containingGroup===t&&(i=o,e>=0))break}if(!(i<0)&&i<e){const o=this.Ct;o.removeAt(e),o.insertAt(i,t)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.N}get name(){return this.St}set name(e){const t=this.St;if(t!==e){const i=this.diagram;if(i!==null){t===""&&u.o("Cannot rename default Layer to: "+e);const n=i.layers;for(;n.next();)n.value.name===e&&u.o("Layer.name is already present in this diagram: "+e)}this.St=e,this.t("name",t,e);const s=this.Ct.iterator;for(;s.next();){const n=s.value;n.layerName=this.St}}}get opacity(){return this.$t}set opacity(e){const t=this.$t;if(t!==e){(e<0||e>1)&&u.W(e,"0 <= value <= 1",Xe,"opacity"),this.$t=e;const i=this.diagram;i!==null&&i.S(),this.t("opacity",t,e)}}get isViewportAligned(){return this.Am}set isViewportAligned(e){const t=this.Am;t!==e&&(this.Am=e,this.diagram&&(this.ML(),this.diagram.S()),this.t("isViewportAligned",t,e),e&&(this.isInDocumentBounds=!1))}ML(){if(!this.Am)return;const e=this.diagram,t=this.Ct.r,i=t.length,s=e.xt,n=e.bt;for(let o=0;o<i;o++){const r=t[o],a=r.naturalBounds.width,h=r.naturalBounds.height;let l=r.alignment;(l.isDefault()||!l.isSpot())&&(l=U.BottomRight);let c=r.alignmentFocus;c.isDefault()&&(c=new U(l.x,l.y));const d=l.x*s+l.offsetX-(c.x*a+c.offsetX),f=l.y*n+l.offsetY-(c.y*h+c.offsetY),m=C.V(d,f);e.$F(m),r.bc(m.x,m.y,!0),C.e(m),r.tt=1/e.scale}}get isTemporary(){return this.kr}set isTemporary(e){const t=this.kr;t!==e&&(this.kr=e,this.t("isTemporary",t,e))}get visible(){return this.kc}set visible(e){const t=this.kc;if(t!==e){this.kc=e;const i=this.Ct.iterator;for(;i.next();)i.value.Ei(e);const s=this.diagram;s!==null&&s.S(),this.t("visible",t,e)}}get pickable(){return this.Kl}set pickable(e){const t=this.Kl;t!==e&&(this.Kl=e,this.t("pickable",t,e))}get isInDocumentBounds(){return this.kx}set isInDocumentBounds(e){const t=this.kx;t!==e&&(this.kx=e,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(this.vl=e,this.t("allowDelete",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(this.El=e,this.t("allowUngroup",t,e))}get allowLink(){return this.Ul}set allowLink(e){const t=this.Ul;t!==e&&(this.Ul=e,this.t("allowLink",t,e))}get allowRelink(){return this.Bl}set allowRelink(e){const t=this.Bl;t!==e&&(this.Bl=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Yl}set allowRotate(e){const t=this.Yl;t!==e&&(this.Yl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Gl}set allowSelect(e){const t=this.Gl;t!==e&&(this.Gl=e,this.t("allowSelect",t,e))}}var No=(S=>(S[S.None=1]="None",S[S.Uniform=2]="Uniform",S[S.UniformToFill=3]="UniformToFill",S))(No||{}),ra=(S=>(S[S.All=1]="All",S[S.NotDirected=2]="NotDirected",S[S.NotDirectedFast=3]="NotDirectedFast",S[S.NotUndirected=4]="NotUndirected",S[S.DestinationTree=5]="DestinationTree",S[S.SourceTree=6]="SourceTree",S))(ra||{}),aa=(S=>(S[S.Document=1]="Document",S[S.Infinite=2]="Infinite",S))(aa||{}),ha=(S=>(S[S.TreeParent=1]="TreeParent",S[S.AllParents=2]="AllParents",S[S.AnyParents=3]="AnyParents",S))(ha||{});const _=class _{constructor(e,t){g(this,"ds");g(this,"Wt");g(this,"$S");g(this,"Sx");g(this,"Pr");g(this,"Tu");g(this,"Mx");g(this,"Nx");g(this,"Cx");g(this,"Lx");g(this,"Ax");g(this,"Tx");g(this,"$h");g(this,"qh");g(this,"Dx");g(this,"Fx");g(this,"Rx");g(this,"jl");g(this,"Fc");g(this,"Sr");g(this,"Om");g(this,"vx");g(this,"Ox");g(this,"Du");g(this,"Yn");g(this,"Mr");g(this,"Zh");g(this,"Co");g(this,"Im");g(this,"Rc");g(this,"Em");g(this,"vc");g(this,"Fu");g(this,"Nr");g(this,"Gn");g(this,"ZS");g(this,"QS");g(this,"Ix");g(this,"Ex");g(this,"_S");g(this,"Ux");g(this,"tM");g(this,"iM");g(this,"eM");g(this,"Bx");g(this,"Um");g(this,"Cr");g(this,"Lr");g(this,"Ar");g(this,"Tr");g(this,"Dr");g(this,"Fr");g(this,"Vx");g(this,"Rr");g(this,"zx");g(this,"vr");g(this,"Or");g(this,"Ir");g(this,"Er");g(this,"Xx");g(this,"sM");g(this,"Lo");g(this,"nM");g(this,"Yx");g(this,"Gx");g(this,"oM");g(this,"ki");g(this,"rM");g(this,"lM");g(this,"hM");g(this,"Os");g(this,"Ao");g(this,"Oi");g(this,"Kx");g(this,"Rl");g(this,"vl");g(this,"jx");g(this,"Hx");g(this,"Ol");g(this,"Il");g(this,"El");g(this,"qx");g(this,"Ul");g(this,"Bl");g(this,"Vl");g(this,"zl");g(this,"Xl");g(this,"Yl");g(this,"Gl");g(this,"Wx");g(this,"Jx");g(this,"aM");g(this,"Ru");g(this,"vu");g(this,"$x");g(this,"Zx");g(this,"Qx");g(this,"_x");g(this,"Bm");g(this,"tb");g(this,"ib");g(this,"eb");g(this,"Zt");g(this,"cM");g(this,"sb");g(this,"fM");g(this,"Ou");g(this,"ln");g(this,"Kn");g(this,"ie");g(this,"jn");g(this,"NL");g(this,"Hl");g(this,"uM");g(this,"dM");g(this,"Vm");g(this,"nb");g(this,"Iu");g(this,"zm");g(this,"ob");g(this,"Ur");g(this,"ql");g(this,"Qh");g(this,"gM");g(this,"mM");g(this,"Xm");g(this,"rb");g(this,"lb");g(this,"Ze");g(this,"Eu");g(this,"Ym");g(this,"Uu");g(this,"Wl");g(this,"Oc");g(this,"Gm");g(this,"Br");g(this,"_h");g(this,"pM");g(this,"Km");g(this,"Ht");g(this,"T");g(this,"Ue");g(this,"xr");g(this,"Bi");g(this,"ys");g(this,"yM");g(this,"Jl");g(this,"Vr");g(this,"bl");g(this,"zr");g(this,"ta");g(this,"Ic");g(this,"wM");g(this,"Bu");g(this,"ia");g(this,"Vu");g(this,"Xt");g(this,"$l");g(this,"at");g(this,"tt");g(this,"zu");g(this,"xt");g(this,"bt");g(this,"ft");g(this,"Ec");g(this,"Bw");g(this,"hb");g(this,"ea");g(this,"Uc");g(this,"ab");g(this,"cb");g(this,"fb");g(this,"ZF");g(this,"QF");g(this,"Vi");g(this,"Pl");g(this,"Fm");g(this,"jm");g(this,"xM");g(this,"bM");g(this,"CL");g(this,"Hm");g(this,"_F");g(this,"tR");g(this,"iR");g(this,"ub");g(this,"eR");g(this,"sR");g(this,"nR");g(this,"sa");g(this,"LL");g(this,"Zl");g(this,"na");g(this,"oa");g(this,"ra");g(this,"la");g(this,"mu");g(this,"jh");g(this,"Qt");g(this,"Mt");g(this,"Bc");g(this,"eP");g(this,"sP");g(this,"gc");g(this,"$t");g(this,"gu");g(this,"gb");g(this,"pb");g(this,"yb");g(this,"wb");g(this,"xb");g(this,"qm");g(this,"SM");g(this,"Wm");g(this,"Jm");g(this,"$m");g(this,"nx");g(this,"MM");g(this,"NM");g(this,"Vc");if(_.mw||(_.Gk(),_.mw=!0),I.Ki(this),_.TL(this),this.Ht=!0,this.Mt=null,this.xt=0,this.bt=0,this.ft=null,_.isUsingDOM()){const s=this,n=()=>{s.Pi(w.document,"DOMContentLoaded",n,!1),s.setRTL()};w.document.body!==null?this.setRTL():s.Ut(w.document,"DOMContentLoaded",n,!1)}this.Ec=null,_.CM("Model",cs);const i=this;return this.rM=s=>i.partManager.doModelDataChanged(s),this.lM=s=>i.partManager.doModelChanged(s),this.ab=null,this.cb=null,this.DL(),this.model=te.LM(),this.themeManager=new mn,this.Lo=!0,this.FL(),this.layout=new De,this.Lo=!1,this._F=null,this.tR=null,this.iR=null,this.ub=null,this.eR=null,this.sR=null,this.nR=null,this.sa=null,this.LL=null,this.Zl=null,this.na=null,this.oa=null,this.ra=null,this.la=null,this.mu=()=>{},this.jh=null,this.Uu=!1,this.Bc=new tu(this),e!==void 0&&(typeof e=="string"||w.Element&&e instanceof Element?this.AM(e):t=e),t&&this.setProperties(t),this.Ht=!1,this.requestUpdate(),this}mF(){return this.ft!==null}get renderer(){return this.Oc}set renderer(e){if(this instanceof Vn)return;e===""&&(e="default");const t=e.toLowerCase(),i=this.Oc;if(t===i)return;this.Oc=t;let s=null;t==="default"||t==="canvas"?(s=this.Wl.get("svg"),s!==null&&s.Tt.remove(),this.ft&&(this.Qt=this.ft.li),this.Qt.clearContextCache(!0)):t==="svg"?(this.Wl.has("svg")?s=this.Wl.get("svg"):(s=new dn(this,w.document),this.addRenderer("svg",s)),this.div!==null&&this.div.appendChild(s.Tt),this.Qt=s.li,this.ft&&(this.ft.li.setTransform(this.Vi,0,0,this.Vi,0,0),this.ft.li.clearRect(0,0,this.xt,this.bt))):t==="debug"&&(this.Wl.has("SVG")||(s=new dn(this,w.document),this.addRenderer("SVG",s),s.Tt.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.Tt))),this.Ht||this.redraw()}DL(){this.Vc=new Y,this.setupRouters(),this.ds=new ti,this.ds.Mo(this),this.Wt=17,this.$S=!1,this.zu=!1,this.Sx="default",this.Xt=new Y,this.Wl=new Z,this.Oc="default",this.resetRenderingHints(),this.oR(),this.$t=1,this.at=new C(NaN,NaN).u(),this.nx=new C(NaN,NaN),this.tt=1,this.Km=1,this.Mx=new C(NaN,NaN).u(),this.Nx=NaN,this.Cx=1e-4,this.Lx=100,this.T=new Pt,this.Ax=new C(NaN,NaN).u(),this.Tx=new G(NaN,NaN,NaN,NaN).u(),this.$h=new wt(0,0,0,0).u(),this.qh=1,this.Dx=!1,this.Fx=null,this.Rx=null,this.jl=1,this.Fc=U.Default,this.Sr=1,this.Om=U.Default,this.vx=U.None,this.Ox=U.None,this.Ue=!0,this.Du=!1,this.Yn=new Set,this.Mr=new I,this.Zh=new I,this.Co=!1,this.$l=new Z,this.Bu=!0,this.Im=250,this.Rc=-1,this.Em=new wt(16,16,16,16).u(),this.xr=!1,this.vc=!1,this.Fu=!0,this.Gm=new de,this.Gm.diagram=this,this.Br=new de,this.Br.diagram=this,this._h=new de,this._h.diagram=this,this.Nr=null,this.Gn=null,this.Bw=!1,this.rR(),this.zr=new I,this.Ix=!0,this.Ex=1,this._S=!1,this.Ux=1,this.Bx="auto",this.Um="auto",this.Cr=null,this.Lr=null,this.Ar=null,this.Tr=null,this.Dr=null,this.Fr=null,this.Vx=null,this.Rr=null,this.zx=!1,this.vr=null,this.Or=null,this.Ir=null,this.Er=null,this.Xx=!1,this.hb={},this.ea=[null,null],this.Lo=!1,this.nM=!1,this.Yx=!1,this.Gx=!1,this.oM=!0,this.ys=!1,this.ia=!1,this.hM=!0,this.Os=-2,this.Jl=new Z,this.Vu=new Y,this.Ao=!1,this.Oi=!0,this.Kx=!0,this.Rl=!0,this.vl=!0,this.jx=!1,this.Hx=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.qx=!0,this.Ul=!0,this.Bl=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Yl=!0,this.Gl=!0,this.Wx=!0,this.Jx=!0,this.aM=!1,this.Uc=!1,this.Ru=!0,this.vu=!0,this.$x=!0,this.Zx=!0,this.Qx=16,this._x=16,this.Bm=!1,this.tb=!1,this.ib=0,this.eb=0,this.Zt=new wt(5).u(),this.cM=new I().u(),this.sb=999999999,this.fM=new I().u(),this.ta=!0,this.Ou=!0,this.Ic=!0,this.ln=!1,this.Kn=!1,this.Vr=!0,this.bl=!1,this.jn=!1,this.NL=new I,this.wM=new I,this.Hl=null,this.uM=new rt(8,8),this.dM=999,this.Vm=!1,this.eP=1,this.sP=0,this.Bi={scale:1,position:new C,bounds:new G,canvasSize:new rt,newCanvasSize:new rt,isScroll:!1},this.Bi.canvasSize=this.Bi.canvasSize,this.Bi.newCanvasSize=this.Bi.newCanvasSize,this.Bi.isScroll=!1,this.nb=new G(NaN,NaN,NaN,NaN).u(),this.Iu=new rt(NaN,NaN).u(),this.zm=new G(NaN,NaN,NaN,NaN).u(),this.ob=!1,this.lR(),this.Ze=null,this.Eu=!1,this.gc=null,this.partManager=new cs,this.toolManager=new Pe,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.pb=null,this.yb=new Bn,this.wb=null,this.xb=null,this.gb=!1,this.gu=!1,this.commandHandler=new ei,this.Jm=null,this.$m=C.Ik,this.MM=!1,this.Vi=1,this.Pl=null,this.Fm=1,this.qm=0,this.SM=[0,0,0,0,0],this.Wm=0,this.jm=1,this.xM=0,this.bM=new C,this.CL=500,this.Ym=new C,this.Hm=!1}static isUsingDOM(){return _.RL}static useDOM(e){_.RL=e?w.document!==void 0:!1}clear(){this.animationManager.stopAnimation(),this.model.clear(),_.vL(),this.OL(!1),this.Vu.clear(),this.IL(),this.Hl=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.S()}OL(e){this.animationManager.stopAnimation(!0),this.cM=new I().u(),this.fM=new I().u();const t=this.skipsUndoManager,i=this.ki!==null&&this.ki!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.Ze!==null&&(s=this.Ze.part,s!==null&&this.remove(s));const n=[],o=this.Xt.length;if(e){for(let r=0;r<o;r++){const a=this.Xt.r[r].parts;for(;a.next();){const h=a.value;h!==s&&h.data===null&&n.push(h)}}for(let r=0;r<n.length;r++){const a=n[r];this.remove(a)}}for(let r=0;r<o;r++)this.Xt.r[r].YF();return this.partManager.clear(),this.Yn.clear(),this.Mr.clear(),this.Zh.clear(),this.$l.clear(),this.zr.clear(),this.gc=null,this.Vu.clear(),this.IL(),u.vk=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=t),n}static vL(){_.Zm=null,_.bb=""}static AE(){return null}reset(){this.clear(),this.Ht=!0,this.DL(),this.themeManager=new mn,this.Ql(),this.Lo=!0,this.FL(),this.layout=new De,this.Lo=!1,this.model=te.LM(),this.model.undoManager=new ze,this.Uu=!1,this.Ht=!1,this.S()}lR(){this.Ur=new Z,this.gM=new gt().add(new ae({stroke:"black",font:"10pt sans-serif"}).bind("text","",u.toString).theme("stroke","text").theme("font","normal")),this.Ur.set("",this.gM),this.Ur.set("Comment",new gt().add(new ae({stroke:"brown",font:"10pt sans-serif"}).bind("text","",u.toString).theme("stroke","comment").theme("font","normal"))),this.Ur.set("LinkLabel",new gt({selectable:!1,avoidable:!1}).add(new At("Ellipse",{fill:"black",stroke:null,desiredSize:new rt(3,3).$()}).theme("fill","link"))),this.Qh=new Z,this.yM=new Nt(bt.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new ae({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",u.toString).theme("stroke","text").theme("font","bold"),new bt(bt.Auto,{name:"GROUPPPANEL"}).add(new At({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new si({padding:5}).theme("padding","group"))),this.Qh.set("",this.yM),this.ql=new Z,this.mM=new St().add(new At({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new At({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.ql.set("",this.mM),this.ql.set("Comment",new St().add(new At({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.Xm=new Ft(bt.Auto).add(new At({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new si({margin:1.5}).theme("margin","selection","numbers",null,e=>e?new wt(e/2):1.5)),this.rb=this.Xm,this.lb=new Ft(bt.Link).add(new At({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(e){let t=e===void 0?this.div:e;t===null&&(t=w.document.body);const i=u.hs("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",t.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),t.removeChild(i),this.Sx=s}setScrollWidth(e){let t=e===void 0?this.div:e;t===null&&(t=w.document.body);let i=0;if(_.isUsingDOM()){let s=_.PM,n=_.kM;s===null&&(_.PM=u.hs("p"),s=_.PM,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",_.kM=u.hs("div"),n=_.kM,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",t.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),t.removeChild(n),i=o-r,i===0&&!u.tr&&(i=11)}this.Wt=i,this.$S=!0}oi(e){e in No?this.autoScale=e:u.er(this,e)}toString(e){e===void 0&&(e=0);let t="";this.div&&this.div.id&&(t=this.div.id);let i='Diagram "'+t+'"';if(e<=0)return i;const s=this.Xt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(e-1)}return i}static TL(e){_.db=e}static um(){return _.db}static fromDiv(e){let t=e;if(typeof e=="string"&&(t=w.document.getElementById(e)),t instanceof HTMLDivElement){const i=_.Qe.get(t);if(i)return i}return null}get div(){return this.Mt}set div(e){if(this.Mt!==e){const t=this.Mt;if(t!==null){if(_.Qe.delete(t),t.goDiagram=void 0,t.go=void 0,t.innerHTML="",this.ft!==null){const s=this.ft.Tt;this.Pi(s,"pointermove",this.na,!1),this.Pi(s,"pointerdown",this.Zl,!1),this.Pi(s,"pointerup",this.oa,!1),this.Pi(s,"pointerout",this.ra,!1),this.Pi(s,"pointercancel",this.la,!1),this.ft.dispose()}this.Ec&&(this.Ec.disconnect(),this.Ec=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.ft=null,this.Pi(w,"resize",this.ub,!1),this.Pi(w,"wheel",this.sa,!0),_.um()===this&&_.TL(null)}else this.Zl===null&&(this.jn=!1);if(this.Mt=null,e!==null){const i=_.Qe.get(e);i&&(i.div=null),this.AM(e),this.mu(),this.themeManager&&this.themeManager.hR()}else this.themeManager&&this.themeManager.aR()}}setupRouters(){this.Vc.push(new Su)}AM(e){const t=this;if(!_.isUsingDOM())return;e==null&&u.o("Diagram setup requires an argument DIV."),t.Mt!==null&&u.o("Diagram has already completed setup."),typeof e=="string"?t.Mt=w.document.getElementById(e):e instanceof HTMLDivElement?t.Mt=e:u.o("No DIV or DIV id supplied: "+e),t.Mt===null&&u.o("Invalid DIV id; could not get element with id: "+e);const i=_.Qe.get(t.Mt);if(i&&i!==this&&u.o("Invalid div id; div already has a Diagram associated with it."),!t.Ec&&w.ResizeObserver){const c=w.ResizeObserver,d=u.Rk(()=>t.requestUpdate(),250,!1);t.Ec=new c(()=>d()),t.Ec.observe(t.Mt)}w.getComputedStyle(t.Mt,null).position==="static"&&(t.Mt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,t.Mt.style["-webkit-tap-highlight-color"]=n,t.Mt.innerHTML="",_.Qe.set(t.Mt,t),t.Mt.goDiagram=t,t.Mt.go=w.go;const o=new $i(t);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",w.getComputedStyle(t.Mt,null).getPropertyValue("direction")==="rtl"&&(t.zu=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),t.ft=o,t.Qt=o.li;const r=t.Qt;t.Vi=t.computePixelRatio(),t.viewSize.isReal()||(t.xt=t.Mt.clientWidth||1,t.bt=t.Mt.clientHeight||1),t.EL(t.xt,t.bt);const a=t;t.Mt.insertBefore(o.Tt,t.Mt.firstChild);const h=new $i(null);if(h.width=1,h.height=1,t.ZF=h,t.QF=h.li,_.isUsingDOM()){const c=u.hs("div"),d=u.hs("div");c.style.position="absolute",c.style.overflow="auto",c.style.width=t.xt+"px",c.style.height=t.bt+"px",c.style.zIndex="1",d.style.position="absolute",d.style.width="1px",d.style.height="1px",t.Mt.appendChild(c),c.appendChild(d),c.onscroll=_.cR,c.addEventListener("pointerdown",_.fR),c.N=t,c.uR=!0,c.dR=!0,t.ab=c,t.cb=d}t.mu=u.Rk(()=>{t.Pl=null,t.S()},300,!1),t.ub=u.Rk(()=>{t.IS()},250,!1),t.jh=c=>(c.preventDefault(),!1),t.sa=c=>{if(!a.isEnabled)return;const d=a.zc(c,!0);d.bubbles=!0;let f=0,m=0;d.delta=0,c.deltaX!==void 0?(c.deltaX!==0&&(f=c.deltaX>0?1:-1),c.deltaY!==0&&(m=c.deltaY>0?1:-1),d.delta=Math.abs(c.deltaX)>Math.abs(c.deltaY)?-f:-m):c.wheelDeltaX!==void 0?(c.wheelDeltaX!==0&&(f=c.wheelDeltaX>0?-1:1),c.wheelDeltaY!==0&&(m=c.wheelDeltaY>0?-1:1),d.delta=Math.abs(c.wheelDeltaX)>Math.abs(c.wheelDeltaY)?-f:-m):c.wheelDelta!==void 0&&c.wheelDelta!==0&&(d.delta=c.wheelDelta>0?1:-1),a.doMouseWheel(),a.ha(d,c)},t.LL=c=>{if(!a.isEnabled)return;t.Uc=!1,a.zc(c,!0);const d=a.currentTool;d.cancelWaitAfter(),d.standardMouseOver()},t.Zl=c=>{if(!a.isEnabled)return;t.Uc=!0;const d=a.hb;d[c.pointerId]===void 0&&(d[c.pointerId]=c);const f=a.ea;let m=!1;if(f[0]!==null&&(f[0].pointerId===c.pointerId||f[0].pointerType!==c.pointerType))f[0]=c;else if(f[1]!==null&&f[1].pointerId===c.pointerId)f[1]=c,m=!0;else if(f[0]===null)f[0]=c;else if(f[1]===null)f[1]=c,m=!0;else{c.preventDefault();return}const p=c.pointerType==="touch"||c.pointerType==="pen";p&&(a.Bw=!1,a.Hm=!0);const y=a.gR(c,c,m),x=a.bM,b=p?25:10;if(c.timeStamp-a.xM<a.CL&&!(Math.abs(x.x-c.screenX)>b||Math.abs(x.y-c.screenY)>b)?a.jm++:a.jm=1,y.clickCount=a.jm,a.xM=c.timeStamp,a.bM.setTo(c.screenX,c.screenY),a.doMouseDown(),c.button===1){c.preventDefault();return}a.ha(y,c)},t.na=c=>{if(!a.isEnabled)return;t.Uc=!0;const d=a.ea;if(d[0]!==null&&(d[0].pointerId===c.pointerId||d[0].pointerType!==c.pointerType))d[0]=c;else if(d[1]!==null&&d[1].pointerId===c.pointerId){d[1]=c;return}else if(d[0]===null)d[0]=c;else return;if(d[0].pointerId!==c.pointerId)return;const f=a.mR(c,c,d[1]!==null);a.doMouseMove(),a.ha(f,c)},t.oa=c=>{if(!a.isEnabled)return;t.Uc=!0;const d=c.pointerType==="touch"||c.pointerType==="pen",f=a.hb;if(d&&a.Bw){delete f[c.pointerId],c.preventDefault();return}const m=a.ea;if(m[0]!==null&&(m[0].pointerId===c.pointerId||m[0].pointerType!==c.pointerType))m[0]=null;else if(m[1]!==null&&m[1].pointerId===c.pointerId){m[1]=null;return}else return;const p=a.TM(c,!1,!0,!1,!0,!1);let y=w.document.elementFromPoint(c.clientX,c.clientY)||null;y!==null&&y.shadowRoot!==void 0&&y.shadowRoot!==null&&(y=y.shadowRoot.elementFromPoint(c.clientX,c.clientY)),y!==null&&y.N instanceof _&&y.N!==a&&y.N.Qm(c,p),y===null&&(y=c.target),a.Qm(c,p),p.clickCount=a.jm,p.targetDiagram=a.kb(c,y),p.targetObject=null,a.doMouseUp(),a.ha(p,c),d&&(a.Hm=!1)},t.ra=c=>{if(!a.isEnabled)return;t.Uc=!1;const d=a.hb;d[c.pointerId]&&delete d[c.pointerId];const f=a.ea;if(f[0]!==null&&f[0].pointerId===c.pointerId&&(f[0]=null),f[1]!==null&&f[1].pointerId===c.pointerId&&(f[1]=null),c.pointerType==="touch"||c.pointerType==="pen")return;const m=a.currentTool;m.cancelWaitAfter(),m.standardMouseOver()},t.la=c=>{const d=a.ea;d[0]!==null&&d[0].pointerId===c.pointerId?(d[0]=null,a.Hm=!1):d[1]!==null&&d[1].pointerId===c.pointerId&&(d[1]=null)};const l=r;if(t.fb=l.E[u.Ts("7eba17a4ca3b1a8346")][u.Ts("78a118b7")](l.E,_.Xu,s,s),r.clearContextCache(!0),t.pR(),this.Oc==="svg"){const c=this.Wl.get("svg");this.Mt&&this.Mt.appendChild(c.Tt),this.Qt=c.li}}addEventListener(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}Ut(e,t,i,s){e.addEventListener(t,i,{capture:s,passive:!1})}removeEventListener(e,t,i,s){e.removeEventListener(t,i,{capture:s})}Pi(e,t,i,s){e.removeEventListener(t,i,{capture:s})}pR(){const e=this;let t=this.ft.Tt;t instanceof HTMLCanvasElement||(t=e.div),this.Ut(t,"pointerdown",e.Zl,!1),this.Ut(t,"pointermove",e.na,!1),this.Ut(t,"pointerup",e.oa,!1),this.Ut(t,"pointerout",e.ra,!1),this.Ut(t,"pointercancel",e.la,!1),this.Ut(t,"pointerenter",e.yR,!1),this.Ut(t,"pointerleave",e.wR,!1),this.Ut(t,"wheel",e.sa,!1),this.Ut(t,"keydown",e.xR,!1),this.Ut(t,"keyup",e.bR,!1),this.Ut(t,"blur",e.kR,!1),this.Ut(t,"focus",e.PR,!1),this.Ut(t,"selectstart",i=>(i.preventDefault(),!1),!1),this.Ut(t,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Ut(w,"resize",e.ub,!1)}Vw(){this.qm>30&&(this.Pl=1)}CP(e){this.Pl!==null&&(this.Pl=null,e&&this.mu(),this.qm=0,this.SM=[0,0,0,0,0],this.Wm=0)}computePixelRatio(){return this.Pl!==null?this.Pl:w.devicePixelRatio||1}get avgSpf(){return this.qm}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.ft)if(this.scrollsPageOnFocus)this.ft.focus();else{const e=w.scrollX,t=w.scrollY;this.ft.focus(),w.scrollTo(e,t)}}PR(e){const t=_.Qe.get(this);t&&t.D("GainedFocus")}kR(e){const t=_.Qe.get(this);t&&t.D("LostFocus")}IS(){if(this.ft===null)return;const e=this.Mt;if(e===null||e.clientWidth===0||e.clientHeight===0)return;this.$S||this.setScrollWidth();const t=this.Kn?this.Wt:0,i=this.ln?this.Wt:0,s=this.Vi;if(this.Vi=this.computePixelRatio(),this.Vi!==s&&(this.Du=!0,this.requestUpdate()),e.clientWidth!==this.xt+t||e.clientHeight!==this.bt+i){this.aa(),this.Ue=!0;const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(this.vc=!0,n.invalidateLayout()),this.ys||this.requestUpdate()}}FL(){let e=0,t=new Xe;t.name="Grid",t.allowSelect=!1,t.pickable=!1,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new Xe,t.name="ViewportBackground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new Xe,t.name="Background",this.Xr(t,e++),t=new Xe,t.name="",this.Xr(t,e++),t=new Xe,t.name="Foreground",this.Xr(t,e++),t=new Xe,t.name="ViewportForeground",t.isViewportAligned=!0,t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new Xe,t.name="Adornment",t.isTemporary=!0,t.isInDocumentBounds=!1,this.Xr(t,e++),t=new Xe,t.name="Tool",t.isTemporary=!0,t.isInDocumentBounds=!0,this.Xr(t,e++)}UL(){const e=new bt(bt.Grid,{name:"GRID"}).add(new At("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new At("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new At("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new At("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new At("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new At("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),t=new Ht({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(e);return this.add(t),this.partManager.parts.delete(t),e.visible=!1,e}static cR(){const e=_.Qe.get(this.parentElement||this);if(e){if(e.tb){e.tb=!1;return}if(!e.isEnabled){e.BL();return}e.diagramScroll(this)}}static fR(e){if(!this.N.isEnabled){this.N.updateScroll();return}this.N.ib=e.target.scrollTop,this.N.eb=e.target.scrollLeft}diagramScroll(e){if(this.ft===null)return;const t=this.ab,i=this.cb;this.Bm=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.$h;let r=s.x-o.left,a=s.y-o.top;const h=s.width+o.left+o.right,l=s.height+o.top+o.bottom;let c=s.right+o.right,d=s.bottom+o.bottom,f=n.x,m=n.y;const p=n.width,y=n.height;let x=n.right,b=n.bottom;const M=this.scale;let P,k=e.scrollLeft;if(this.zu)switch(this.Sx){case"negative":k=k+e.scrollWidth-e.clientWidth;break;case"reverse":k=e.scrollWidth-k-e.clientWidth;break}const L=k;if(p<h||y<l){P=C.V(this.position.x,this.position.y),this.allowHorizontalScroll&&this.eb!==L&&(P.x=L/M+r,this.eb=L),this.allowVerticalScroll&&this.ib!==e.scrollTop&&(P.y=e.scrollTop/M+a,this.ib=e.scrollTop),this.position=P,C.e(P),this.Bm=!1,this.Ou=!1;return}if(P=C.l(),e.uR&&this.allowHorizontalScroll&&(r<f&&(this.position=P.i(L+r,this.position.y)),c>x)){const T=t.scrollWidth-this.xt;this.position=P.i(-T+L-this.xt/M+c,this.position.y)}if(e.dR&&this.allowVerticalScroll&&(a<m&&(this.position=P.i(this.position.x,e.scrollTop+a)),d>b)){const T=t.scrollHeight-this.bt;this.position=P.i(this.position.x,-T+e.scrollTop-this.bt/M+d)}C.e(P),this._l(),this.Bm=!1,this.Ou=!1,s=this.documentBounds,n=this.viewportBounds,c=s.right,x=n.right,d=s.bottom,b=n.bottom,r=s.x,f=n.x,a=s.y,m=n.y,p>=h&&r>=f&&c<=x&&(i.style.width="1px"),y>=l&&a>=m&&d<=b&&(i.style.height="1px")}computeBounds(e){return e===void 0&&(e=new G),this.Mi(),this.VL(e)}VL(e){if(this.fixedBounds.isReal())return e.a(this.fixedBounds),e.addMargin(this.Zt),e;let t=!0;const i=this.Xt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.Ct.r,a=r.length;for(let h=0;h<a;h++){const l=r[h];if(!l.isInDocumentBounds||!l.isVisible())continue;const c=l.actualBounds;c.isReal()&&(t?(t=!1,e.a(c)):e.unionRect(c))}}return t&&e.i(0,0,0,0),e.addMargin(this.Zt),e}computePartsBounds(e,t){t===void 0&&(t=!1);let i=null;if(Array.isArray(e))for(let s=0;s<e.length;s++){const n=e[s];!t&&n instanceof St||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=e.iterator;for(;s.next();){const n=s.value;!t&&n instanceof St||(n.ensureBounds(),i===null?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===null?new G(NaN,NaN,0,0):i}Bs(e){if(!e&&!this.jn||this.Ht||this.ft===null||!this.documentBounds.isReal())return;if(this.Ht=!0,e){const d=this.initialPosition;if(d.isReal()){this.Ht=!1,this.position=d;return}let f=this.initialDocumentSpot,m=this.initialViewportSpot;f.isNoSpot()&&(f=U.TopLeft),m.isNoSpot()&&(m=U.TopLeft);const p=C.l();p.setRectSpot(this.documentBounds,f);const y=this.viewportBounds,x=G.V(0,0,y.width,y.height),b=C.l();b.setRectSpot(x,m),b.i(p.x-b.x,p.y-b.y),this.Ht=!1,this.position=b,G.e(x),C.e(b)}let t=this.jl;e&&this.Sr!==1&&(t=this.Sr);const i=t!==1?this.Yu(t):this.scale,s=this.at.x,n=this.at.y,o=this.xt/i,r=this.bt/i;let a=this.Fc;const h=this.Om;if(e&&!a.isSpot()&&(h.isSpot()||h.isDefault())){const d=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();a=h.isDefault()&&!d?U.Center:h}this.DM(this.documentBounds,o,r,a,e);const l=this.scale;this.scale=i,this.Ht=!1;const c=this.viewportBounds;c.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new G(s,n,o,r),c,l,!1)}Yu(e){const t=this.Km;if(this.ft===null)return t;if(e===1)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return t;const s=i.width,n=i.height,o=this.xt+(this.Kn?this.Wt:0),r=this.bt+(this.ln?this.Wt:0);let a=o/s,h=r/n;const l=this.$h,c=l.left+l.right!==0,d=l.top+l.bottom!==0;(c||d)&&(h===a?(h=(r-this.Wt)/n,a=(o-this.Wt)/s):h>a?h=(r-this.Wt)/n:a=(o-this.Wt)/s);let f=0;return e===2?f=Math.min(h,a):e===3&&(h>a?f=(r-this.Wt)/n:f=(o-this.Wt)/s),f>t&&(f=t),f<this.minScale&&(f=this.minScale),f>this.maxScale&&(f=this.maxScale),f}zoomToFit(){const e=this.qh;this.qh=1,this.scale=this.Yu(2),this.alignDocument(U.Center,U.Center),e!==1&&(this.Bs(!1),this.DM(this.documentBounds,this.xt/this.tt,this.bt/this.tt,this.Fc,!1)),this.qh=e}zoomToRect(e,t){t===void 0&&(t=2);const i=e.width,s=e.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(t===2||t===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.xt,r=this.bt;t===3?r/s>o/i?n=(r-(this.ln?this.Wt:0))/s:n=(o-(this.Kn?this.Wt:0))/i:n=Math.min(r/s,o/i)}this.scale=n,this.position=new C(e.x,e.y)}get SR(){return this.Ht}set SR(e){this.Ht=e}alignDocument(e,t){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new C(i.x+(e.x*i.width+e.offsetX)-(t.x*s.width-t.offsetX),i.y+(e.y*i.height+e.offsetY)-(t.y*s.height-t.offsetY))}focusObject(e){if(e instanceof Xt){this.Jm=e;const t=C.l();this.$m=this.transformDocToView(e.getDocumentPoint(U.TopLeft,t)),C.e(t)}else this.Jm=null,this.$m=C.Ik}DM(e,t,i,s,n){const o=C.V(this.at.x,this.at.y);let r=o.x,a=o.y;if(this.Jm!==null){let h=C.l();h=this.Jm.getDocumentPoint(U.TopLeft,h),r=h.x-this.$m.x/this.scale,a=h.y-this.$m.y/this.scale,s=U.None,C.e(h)}if(n||this.scrollMode===1){s.isSpot()&&(t>e.width&&(r=e.x+(s.x*e.width+s.offsetX)-(s.x*t-s.offsetX)),i>e.height&&(a=e.y+(s.y*e.height+s.offsetY)-(s.y*i-s.offsetY)));const h=this.$h,l=t-e.width;if(t<e.width+h.left+h.right){let d=r+t/2;d=Math.min(d,e.right+Math.max(l,h.right)-t/2),d=Math.max(d,e.left-Math.max(l,h.left)+t/2),r=d-t/2}else r>e.left?r=e.left:r<e.right-t&&(r=e.right-t);const c=i-e.height;if(i<e.height+h.top+h.bottom){let d=a+i/2;d=Math.min(d,e.bottom+Math.max(c,h.bottom)-i/2),d=Math.max(d,e.top-Math.max(c,h.top)+i/2),a=d-i/2}else a>e.top?a=e.top:a<e.bottom-i&&(a=e.bottom-i)}if(o.x=isFinite(r)?r:-this.Zt.left,o.y=isFinite(a)?a:-this.Zt.top,this.positionComputation!==null){const h=this.positionComputation(this,o);o.x=h.x,o.y=h.y}this.ds.pL(this.at,o),this.at.i(o.x,o.y),this._m(),this.Ql(),this.MR(),C.e(o)}findPartAt(e,t){if(t===void 0&&(t=!0),t){const i=this.FP(e,s=>s.part,s=>s.canSelect());if(i instanceof Ht)return i}else{const i=this.FP(e,s=>s.part);if(i instanceof Ht)return i}return null}findObjectAt(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Mi();const s=this.Xt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}FP(e,t,i){t===void 0&&(t=null),i===void 0&&(i=null),this.Mi();const s=this.Xt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(e,t,i);if(o!==null)return o}return null}findPartsAt(e,t,i){return t===void 0&&(t=!0),this.NR(e,s=>s.part,t?s=>s instanceof Ht&&s.canSelect():null,i)}NR(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof Y)&&!(s instanceof I)&&(s=new I),this.Mi();const n=this.Xt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(e,t,i,s)}return s}findObjectsAt(e,t,i,s){t===void 0&&(t=null),i===void 0&&(i=null),!(s instanceof Y)&&!(s instanceof I)&&(s=new I),this.Mi();const n=this.Xt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(e,t,i,s)}return s}findPartsIn(e,t,i,s){return t===void 0&&(t=!1),i===void 0&&(i=!0),this.CR(e,null,n=>n instanceof Ht&&(!i||n.canSelect()),t,s)}findObjectsIn(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof Y)&&!(n instanceof I)&&(n=new I),this.Mi();const o=this.Xt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(e,t,i,s,n)}return n}OP(e,t,i,s,n,o){const r=new I;this.Mi();const a=this.Xt.iteratorBackwards;for(;a.next();){const h=a.value;h.visible&&h.OP(e,t,i,s,r,n,o)}return r}CR(e,t,i,s,n){t===void 0&&(t=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof Y)&&!(n instanceof I)&&(n=new I),this.Mi();const o=this.Xt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(e,t,i,s,n)}return n}findPartsNear(e,t,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.LR(e,t,null,o=>o instanceof Ht&&(!s||o.canSelect()),i,n)}findObjectsNear(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof Y||n instanceof I)&&(o=n),n=!0),!(o instanceof Y)&&!(o instanceof I)&&(o=new I),this.Mi();const r=this.Xt.iteratorBackwards;for(;r.next();){const a=r.value;a.visible&&a.findObjectsNear(e,t,i,s,n,o)}return o}LR(e,t,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof Y||n instanceof I)&&(o=n),n=!0),!(o instanceof Y)&&!(o instanceof I)&&(o=new I),this.Mi();const r=this.Xt.iteratorBackwards;for(;r.next();){const a=r.value;!a.visible||a.isTemporary||a.findObjectsNear(e,t,i,s,n,o)}return o}acceptEvent(e){return this.zc(e,e instanceof MouseEvent)}zc(e,t){const i=this.Br;this.Br=this._h,this._h=i,i.diagram=this,i.event=e,t?this.Qm(e,i):(i.viewPoint=this.Br.viewPoint,i.documentPoint=this.Br.documentPoint);let s=0;const n=e;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),u.tr&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=e.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.kb(e,e.target),i.targetObject=null,i}kb(e,t){if(t===null)return null;const i=_.Qe.get(t);if(i)return i;let s=e.path;if(!s&&u.it(e.composedPath)&&(s=e.composedPath()),s&&s[0]){const n=_.Qe.get(s[0]);if(n)return n}return null}gR(e,t,i){const s=this.TM(e,!0,!1,!1,!0,i);return this.Qm(t,s),s.targetDiagram=this.kb(e,e.target),s.targetObject=null,i||s.clone(this.Gm),s}mR(e,t,i){const s=this.TM(e,!1,!1,!1,!1,i);let n=w.document.elementFromPoint(t.clientX,t.clientY)||null;n!==null&&n.shadowRoot!==void 0&&n.shadowRoot!==null&&(n=n.shadowRoot.elementFromPoint(t.clientX,t.clientY));let o=this,r=e;if(n){const a=this.kb(e,n);a&&(r=t,o=a)}return s.targetDiagram=o,this.Qm(r,s),s.targetObject=null,s}TM(e,t,i,s,n,o){const r=this.Br;this.Br=this._h,this._h=r,r.diagram=this,r.clickCount=1,r.delta=0;let a=0;return e.ctrlKey&&(a+=1),e.altKey&&(a+=2),e.shiftKey&&(a+=4),e.metaKey&&(a+=8),r.modifiers=a,r.event=e,r.timestamp=e.timeStamp,r.button=i?this.firstInput.button:e.button,r.buttons=e.buttons,u.tr&&e.button===0&&e.ctrlKey&&(r.button=2),r.down=t,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}ha(e,t){return e.bubbles?!0:(t.stopPropagation!==void 0&&t.stopPropagation(),t.cancelable!==!1&&t.preventDefault(),t.cancelBubble=!0,!1)}xR(e){const t=_.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!1);return i.key=e.key,i.code=e.code,i.down=!0,t.doKeyDown(),t.ha(i,e)}bR(e){const t=_.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!1);return i.key=e.key,i.code=e.code,i.up=!0,t.doKeyUp(),t.ha(i,e)}yR(e){const t=_.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!0);return t.mouseEnter!==null&&t.mouseEnter(i),t.currentTool.standardMouseOver(),t.ha(i,e)}wR(e){const t=_.Qe.get(this);if(!t||!t.isEnabled)return!1;const i=t.zc(e,!0);return t.mouseLeave!==null&&t.mouseLeave(i),t.ha(i,e)}getMouse(e){const t=this.ft;if(t===null)return new C(0,0);const i=t.getBoundingClientRect(),s=(e.clientX-i.left)*(this.xt/i.width),n=(e.clientY-i.top)*(this.bt/i.height);return new C(s,n).Oe(this.T)}Qm(e,t){const i=this.ft;let s=0,n=0;if(i!==null){const r=i.getBoundingClientRect();s=(e.clientX-r.left)*(this.xt/r.width),n=(e.clientY-r.top)*(this.bt/r.height)}t.viewPoint.i(s,n);const o=C.V(s,n);this.T.$e(o),t.documentPoint.a(o),C.e(o)}BC(e,t,i){let s;if(this.ea[0]!==null)s=this.ea[t];else return;const n=this.ft;if(n!==null){const o=n.getBoundingClientRect();i.i((s.clientX-o.left)*(this.xt/o.width),(s.clientY-o.top)*(this.bt/o.height))}}invalidateDocumentBounds(){this.ta||(this.ta=!0,this.requestUpdate(!1))}AR(){this.ys||this.Mi(),this.ensureBounds()}redraw(){this.Ht||this.ys||(this.S(),this.maybeUpdate())}isUpdateRequested(){return this.xr}delayInitialization(e){e===void 0&&(e=null);const t=this.animationManager,i=t.isEnabled;t.stopAnimation(),t.isEnabled=!1,this.ur(),this.jn=!1,this.nx=new C(NaN,NaN),t.isEnabled=i,this.ys=!0;const s=this;e!==null&&u.ir(()=>{s.ys=!1,t.Fl("Model"),e(s)},1)}requestUpdate(e){if(e===void 0&&(e=!1),this.xr===!0||this.Ht||e===!1&&this.ys)return;this.xr=!0;const t=this;w.requestAnimationFrame(()=>{t.xr&&t.maybeUpdate()})}maybeUpdate(){this.Fu&&!this.xr||(this.Fu&&(this.Fu=!1),this.ur())}FM(e,t){!this.Ou||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.BL()||(e&&this.Mi(),t&&this.Bs(!1))}ur(e){if(this.ys||(this.xr=!1,this.Mt===null&&!this.Iu.isReal()))return;this.ys=!0;const t=this.animationManager,i=this.Vu;if(!t.isAnimating&&i.length!==0){const c=i.r,d=c.length;for(let f=0;f<d;f++){const m=c[f];m.ue(!1),m.c()}i.clear()}const s=this.wM;s.count>0&&(s.each(c=>c.RM()),s.clear());let n=!1,o=!1;t.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),t.pi||this.IS(),e||this.FM(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.bl||this.Vc.count!==0&&this.Mr.size!==0),a=!this.jn||this.Vr;this.Mi(!0);let h=!1;(a||r)&&(this.jn?this.vM(!this.vc,r):(this.startTransaction("Initial Layout"),t.isEnabled===!1&&t.stopAnimation(),this.vM(!1,r)),h=a),this.vc=!1,this.bl=!1,this.Mi(),this.Ze!==null&&(this.Ze.visible&&!this.Eu&&(this.th(),this.Eu=!0),!this.Ze.visible&&this.Eu&&(this.Eu=!1)),this.Yx||this.AR(),e||this.FM(!0,!1);let l=!1;if(h){const c=G.l();c.a(this.viewportBounds),this.jn||(this.jn=!0,l=!0,this.skipsUndoManager||(this.undoManager.Ew=!0),this.undoManager.Uw=!0,this.TR()),this.DR(),this.Mi(!1),e||this.FM(!0,!0),G.e(c)}else if(t.Sc&&t.ex){if(this.Sr!==1)this.scale=this.Yu(this.Sr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const c=this.initialScale;isFinite(c)&&c>0&&(this.scale=c)}this.Bs(!0)}h&&l&&this.commitTransaction("Initial Layout"),e||this.Ui(this.Qt),o&&(this.skipsUndoManager=n),this.ys=!1}get Vh(){return this.jn}TR(){if(this.Sr!==1)this.scale=this.Yu(this.Sr);else if(this.jl!==1)this.scale=this.Yu(this.jl);else{const t=this.initialScale;isFinite(t)&&t>0&&(this.scale=t)}this.Bs(!0);const e=this.Xt.r;this.ps(e,e.length,this,this.viewportBounds),this.D("InitialLayoutCompleted"),this.nx.a(this.at),this.th()}DR(){this.D("LayoutCompleted")}t0(e){this.Yn.add(e)}addInvalidRoute(e){this.Co?this.Zh.add(e):this.Mr.add(e)}Mi(e){if(this.Yn.size!==0&&!(!this.ys&&this.animationManager.isTicking)){if(this.ys||(this.bl=!0),e){this.zL(this.Yn);return}for(let t=0;t<23&&this.Yn.size!==0;t++){const i=new Set(this.Yn);this.Yn.clear(),this.RM(i,this.Yn)}this.nodes.each(t=>{t instanceof Nt&&t.XL(!1)})}}zL(e,t){for(const i of e)!i.ke()||i instanceof Nt||(i.Yr()?(i.ht(1/0,1/0),i.Bt()):t&&t.add(i));for(const i of e)if(i instanceof Nt){if(!i.isVisible())continue;this.Pb(i)}}RM(e,t){this.zL(e,t);for(const i of e){if(!(i instanceof St))continue;const s=i;s.isVisible()&&(s.Yr()?(s.ht(1/0,1/0),s.Bt()):t.add(s))}for(const i of e)i instanceof Ft&&i.isVisible()&&(i.Yr()?(i.ht(1/0,1/0),i.Bt()):t.add(i))}i0(e){const t=e instanceof _,i=t?e.links:e.memberParts,s=this.Yn;if(t)this.Mi(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.ke()||n instanceof Nt||n.Yr()&&(n.ht(1/0,1/0),n.Bt()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof Nt){if(!n.isVisible())continue;this.Pb(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof St&&s.has(n)&&n.isVisible()&&n.Yr()&&(n.ht(1/0,1/0),n.Bt())}}Pb(e){const t=u.et(),i=u.et(),s=e.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof Nt?(o.To()||o._e()||o.ih())&&this.Pb(o):o instanceof St?o.fromNode===e||o.toNode===e?i.push(o):t.push(o):(o.ht(1/0,1/0),o.Bt()))}let n=t.length;for(let o=0;o<n;o++){const r=t[o];r.ht(1/0,1/0),r.Bt()}u.J(t),e.ht(1/0,1/0),e.Bt(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ht(1/0,1/0),r.Bt()}u.J(i)}ps(e,t,i,s){if(!(!this.Ic&&!this.animationManager.isAnimating)){for(let n=0;n<t;n++)e[n].ps(i,s);this.Mi()}}Ui(e){this.Mt!==null&&(this.ft===null&&u.o("No canvas specified"),this.Oc==="svg"?this.FR(e):this.RR(e))}RR(e){const t=this.animationManager;if(t.pi||t.isAnimating&&!t.isTicking)return;const i=new Date;if(this.e0(),this.Mt&&this.Mt.style.opacity==="0")return;const s=e!==this.Qt,n=this.Xt.r,o=n.length,r=this;if(this.ps(n,o,r,r.viewportBounds),s)e.clearContextCache(!0),this._l();else if(!this.Ue&&!t.isAnimating)return;const a=this.T,h=this.Vi;e.setTransform(h,0,0,h,0,0),e.clearRect(0,0,this.xt,this.bt),this.$t!==1&&(e.globalAlpha=this.$t),this.OM(e);for(let m=0;m<o;m++)e.setTransform(h,0,0,h,0,0),e.transform(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),e.commitTransform(),n[m].Ui(e,r);let l=!1;this.Bc?this.Bc.Xu(this)&&(l=this.fb()):l=!0,l&&(Pt.prototype.$e=Pt.prototype.kw),s?(this.Qt.clearContextCache(!0),this._l()):(this.Ic=!1,this.Ue=!1);const c=+new Date-+i,d=!1,f=this.SM;if(this.Pl===null){f[this.Wm]=c,this.Wm=(this.Wm+1)%f.length;let m=0;for(let p=0;p<f.length;p++)m+=f[p];this.qm=m/f.length}this.$t!==1&&(e.globalAlpha=1)}FR(e){if(this.Mt===null)return;const t=this.animationManager;if(t.pi||t.isAnimating&&!t.isTicking)return;this.e0();const i=this.xt,s=this.bt;e.surface.resize(i,s,i,s);const n=this.Xt.r,o=n.length,r=this;if(this.ps(n,o,r,r.viewportBounds),!this.Ue&&!t.isAnimating)return;const a=this.T;e.lastDrawnPart=null,e.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),this.$t!==1&&(e.globalAlpha=this.$t),this.OM(e);const h=this.Vi;this.ft.li.setTransform(h,0,0,h,0,0),this.ft.li.clearRect(0,0,this.xt,this.bt);for(let c=0;c<o;c++)n[c].Ui(e,r);let l=!1;this.Bc?this.Bc.Xu(this)&&(l=this.fb()):l=!0,l&&(Pt.prototype.$e=Pt.prototype.kw),this.Ic=!1,this.Ue=!1}Sb(e,t,i,s,n,o,r,a,h){if(this.Mt===null)return;this.ft===null&&u.o("No canvas specified"),o===void 0&&(o=null),r===void 0&&(r=null),a===void 0&&(a=!1),h===void 0&&(h=!1),this.e0(),this.Qt.clearContextCache(!0),this._l(),this.ia=!0;const l=this.tt;this.tt=s;const c=this,d=this.Xt.r,f=d.length;try{const m=new G(n.x,n.y,i.width/s,i.height/s),p=m.copy();p.addMargin(t),this.th(p),this.Mi(),this.ps(d,f,c,m),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),r!==null&&r!==""&&(e.fillStyle=r,e.fillBackground(0,0,i.width,i.height));const y=this.Vi;e.scale(y,y);const x=Pt.l();x.Ri(),x.Fs(t.left,t.top),x.tt(s),(n.x!==0||n.y!==0)&&x.Fs(-n.x,-n.y),e.setTransform(x.m11,x.m12,x.m21,x.m22,x.dx,x.dy),e.commitTransform(),e instanceof Ge&&e.setDiagramPosScale(x.m11,x.m12,x.m21,x.m22,x.dx,x.dy),Pt.e(x),this.OM(e),e.globalAlpha=this.$t;const b=this.findLayer("Grid");if(o){const M=new I,P=o.iterator;for(P.reset();P.next();){const k=P.value;k instanceof Ht&&(!h&&k.layer===b||(k.Au(),M.add(k)))}for(let k=0;k<f;k++)d[k].GF(e,c,M,a);M.each(k=>k.Au())}else for(let M=0;M<f;M++){const P=d[M];P===b?h&&P.Ui(e,c,!0):P.Ui(e,c,a)}this.ia=!1,this.Bc&&this.Bc.Xu(this)&&this.fb()}finally{this.tt=l,this.Qt.clearContextCache(!0),this._l(),this.ps(d,f,c,c.viewportBounds),this.th(),this.Qt instanceof Ge&&(this.Qt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(e){return this.Pr[e]}setRenderingHint(e,t){e==="minDrawingLength"&&(this.Fm=t),this.Pr[e]=t,this.redraw()}resetRenderingHints(){this.Pr=new N,this.Pr.drawShadows=!0,this.Pr.textGreeking=!0,this.Pr.viewportOptimizations=!u.tr,this.Pr.temporaryPixelRatio=!0,this.Pr.pictureRatioOptimization=!0,this.Pr.minDrawingLength=1,this.Fm=1}OM(e){const t=this.Pr;if(t===null)return;if(t.imageSmoothingEnabled!==void 0){const s=!!t.imageSmoothingEnabled;e.setImageSmoothingEnabled(s)}const i=t.defaultFont;i!=null&&(e.font=i)}getInputOption(e){return this.Tu[e]}setInputOption(e,t){this.Tu[e]=t}oR(){this.Tu=new N,this.Tu.extraTouchArea=10,this.Tu.extraTouchThreshold=10,this.Tu.hasGestureZoom=!0}set(e){return Object.assign(this,e),this}attach(e){return this.setProperties(e)}setProperties(e){return _.s0(this,e),this}static s0(e,t){const i=e instanceof bt,s=e instanceof _;for(const n in t){n===""&&u.o("Setting properties requires non-empty property names");let o=e,r=n;if(i||s){const h=n.indexOf(".");if(h>0){const l=n.substring(0,h);i?o=e.findObject(l):(o=e[l],o==null&&(o=e.toolManager[l])),u.G(o)?r=n.substring(h+1):u.o("Unable to find object named: "+l+" in "+e.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!u.gw(o,r))if(s&&r==="ModelChanged"){e.addModelChangedListener(t[r]);continue}else if(s&&r==="Changed"){e.addChangedListener(t[r]);continue}else if(s&&u.gw(e.toolManager,r))o=e.toolManager;else if(s&&e.YL(r)){e.addDiagramListener(r,t[r]);continue}else if(e instanceof te&&r==="Changed"){e.addChangedListener(t[r]);continue}else u.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const a=t[n];o[r]=a,r[0]==="_"&&o instanceof Xt&&o.addCopyProperty(r)}}xL(){if(this.$l.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.$l.count>0;){const e=this.$l;this.$l=new Z;const t=e.iterator;for(;t.next();){const i=t.key;i.invalidateOtherJumpOvers(t.value),i.ee()}}this.S()}}S(e){if(e===void 0)this.Ue=!0,this.requestUpdate();else{const t=this.viewportBounds;e.isReal()&&t.intersectsRect(e)&&(this.Ue=!0,this.requestUpdate())}this.D("InvalidateDraw")}invalidateViewport(e,t){if(this.Ue!==!0){if(this.Ue=!0,this.Oc==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Vw(),this.maybeUpdate(),this.CP(!0)):this.maybeUpdate()}}aa(){this.Ou=!0}_l(){this.Ic=!0}e0(){this.Du!==!1&&(this.Du=!1,this.EL(this.xt,this.bt))}EL(e,t){this.Ql();const i=this.Vi,s=e*i,n=t*i;this.ft.resize(s,n,e,t)&&(this.Ue=!0,this.Qt.clearContextCache(!0))}BL(){const e=this.ft;if(e===null||this.Iu.isReal())return!0;const t=this.xt,i=this.bt,s=this.Mt;let n=!1,o=this.Kn?this.Wt:0,r=this.ln?this.Wt:0,a=s.clientWidth||t+o,h=s.clientHeight||i+r;const l=this.viewportBounds,c=l.x,d=l.y,f=l.width,m=l.height;if((a!==t+o||h!==i+r)&&(this.Kn=!1,this.ln=!1,o=0,r=0,this.xt=a,this.bt=h,this.Du=!0,n=!0,this.Ql()),!this.jn||!this.viewportBounds.isReal())return!0;const p=this.ab,y=this.cb;if(this.Ou=!1,!n&&!this.Kn&&!this.ln&&!this.Ru&&!this.vu)return!0;const x=this.documentBounds;let b=0,M=0,P=0,k=0;const L=l.width,T=l.height,D=this.$h;this.contentAlignment.isSpot()?(x.width>L&&(b=D.left,M=D.right),x.height>T&&(P=D.top,k=D.bottom)):(b=D.left,M=D.right,P=D.top,k=D.bottom);const B=x.width+b+M,E=x.height+P+k,R=this.scale,F=R;let V=B>a/R,K=E>h/R;if(!n&&!this.Kn&&!this.ln&&!V&&!K)return!0;const H=x.x-b,W=l.x,J=x.right+M;let $=l.right+o;const et=x.y-P,ot=l.y,Ct=x.bottom+k;let ht=l.bottom+r,dt="1px",ct="1px";if(this.scrollMode===1&&(V||K)){if(V&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let lt=1;H+1<W&&(lt=Math.max((W-H)*R+this.xt,lt)),J>$+1&&(lt=Math.max((J-$)*R+this.xt,lt)),L+o+1<B&&(lt=Math.max((B-L)*R+this.xt,lt)),dt=lt.toString()+"px"}if(K&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let lt=1;et+1<ot&&(lt=Math.max((ot-et)*R+this.bt,lt)),Ct>ht+1&&(lt=Math.max((Ct-ht)*R+this.bt,lt)),T+r+1<E&&(lt=Math.max((E-T)*R+this.bt,lt)),ct=lt.toString()+"px"}}let ft=dt!=="1px",Ot=ct!=="1px";if(!(ft&&Ot)&&(ft||Ot)){if(V=!(B<L+o),K=!(E<T+r),Ot&&($-=this.Wt),ft&&(ht-=this.Wt),V&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let vt=1;H+1<W&&(vt=Math.max((W-H)*R+this.xt,vt)),J>$+1&&(vt=Math.max((J-$)*R+this.xt,vt)),L+1<B&&(vt=Math.max((B-L)*R+this.xt,vt)),dt=vt.toString()+"px"}ft=dt!=="1px";let lt=this.bt;if(ft!==this.ln&&(lt=ft?this.bt-this.Wt:this.bt+this.Wt),K&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let vt=1;et+1<ot&&(vt=Math.max((ot-et)*R+lt,vt)),Ct>ht+1&&(vt=Math.max((Ct-ht)*R+lt,vt)),T+1<E&&(vt=Math.max((E-T)*R+lt,vt)),ct=vt.toString()+"px"}Ot=ct!=="1px"}if(this.Bm&&!(ft!==this.ln||Ot!==this.Kn))return(t!==this.xt||i!==this.bt)&&this.maybeUpdate(),!1;if(ft!==this.ln&&(dt==="1px"?this.bt=this.bt+this.Wt:this.bt=Math.max(this.bt-this.Wt,1),n=!0),this.ln=ft,y.style.width=dt,Ot!==this.Kn&&(ct==="1px"?this.xt=this.xt+this.Wt:this.xt=Math.max(this.xt-this.Wt,1),n=!0,this.zu)){const lt=C.l();Ot?(e.style.left=this.Wt+"px",this.position=lt.i(this.at.x+this.Wt/this.scale,this.at.y)):(e.style.left="0px",this.position=lt.i(this.at.x-this.Wt/this.scale,this.at.y)),C.e(lt)}n&&this.Ql(),this.Kn=Ot,y.style.height=ct,this.tb=!0,n&&(this.Du=!0);let Et=p.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(L+1<B?Et=(this.position.x-H)*R:H+1<W?Et=p.scrollWidth-p.clientWidth:J>$+1&&(Et=this.position.x*R)),this.zu)switch(this.Sx){case"negative":Et=-(p.scrollWidth-Et-p.clientWidth);break;case"reverse":Et=p.scrollWidth-Et-p.clientWidth;break}if(p.scrollLeft=Et,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(T+1<E?p.scrollTop=(this.position.y-et)*R:et+1<ot?p.scrollTop=p.scrollHeight-p.clientHeight:Ct>ht+1&&(p.scrollTop=this.position.y*R)),a=this.xt,h=this.bt,p.style.width=a+(this.Kn?this.Wt:0)+"px",p.style.height=h+(this.ln?this.Wt:0)+"px",t!==a||i!==h||this.animationManager.pi){const lt=G.V(c,d,f,m);return this.onViewportBoundsChanged(lt,this.viewportBounds,F,n),G.e(lt),!1}return!0}add(e){const t=e.diagram;if(t===this)return;t!==null&&u.o("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+t.toString());let i=this.findLayer(e.layerName);if(i===null&&(i=this.findLayer("")),i===null&&u.o('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer===i)return;const s=i.Jh(99999999,e,e.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,e,null,s),i.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1);const n=e.layerChanged;n!==null&&n(e,null,i)}Jh(e){this.partManager.Jh(e);const t=this;e.Gr(i=>t.GL(i)),e.data||e.Do(),e.hasPlaceholder()&&e.c(),e.data!==null&&e.Gr(i=>t.partManager.IM(i,null)),(e._e()===!0||e.ih()===!0)&&this.t0(e),e.KL(!0,this),e.jL()?(e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.requestUpdate()}te(e){e.clearAdornments(),this.partManager.te(e);const t=this;e.data!==null&&e.Gr(i=>t.partManager.EM(i,t)),this.Yn.delete(e),e instanceof St&&this.Mr.delete(e),e.jL()?(e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.invalidateDocumentBounds()):e.isVisible()&&e.actualBounds.isReal()&&this.S(e.Wh(e.actualBounds)),this.requestUpdate()}remove(e){this.UM(e,!0)}UM(e,t){const i=e.layer;if(i===null||i.diagram!==this)return;e.isSelected=!1,e.isHighlighted=!1,e.invalidateLayout(2),t&&e.Xc();const s=i.te(-1,e,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,e,null,s,null);const n=e.layerChanged;n!==null&&n(e,i,null)}removeParts(e,t){if(t===void 0&&(t=!1),Array.isArray(e)){const i=e.length;for(let s=0;s<i;s++){const n=e[s];t&&!n.canDelete()||this.remove(n)}}else{const i=new I;i.addAll(e);const s=i.iterator;for(;s.next();){const n=s.value;t&&!n.canDelete()||this.remove(n)}}}copyParts(e,t,i){i===void 0&&(i=!1);let s=null;const n=t||this,o=n.model;let r=!1,a=!1;try{o.pm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.mm()||o.Mb())&&(a=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(e,t,i)}finally{o.pm()&&(o.copiesParentKeyOfNodeData=r),(o.mm()||o.Mb())&&(o.copiesGroupKeyOfNodeData=a)}return s}moveParts(e,t,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.o0()),this.toolManager===null)return;const n=new Z;if(e!==null)if(Array.isArray(e))for(let o=0;o<e.length;o++)this.Kr(n,e[o],i,s);else{const o=e.iterator;for(;o.next();)this.Kr(n,o.value,i,s)}else{let o=this.parts;for(;o.next();){const r=o.value;this.Kr(n,r,i,s)}for(o=this.nodes;o.next();){const r=o.value;this.Kr(n,r,i,s)}for(o=this.links;o.next();){const r=o.value;this.Kr(n,r,i,s)}}this.TP(n,t,s,i)}Kr(e,t,i,s,n){if(!e.has(t)&&(n===void 0&&(n=!1),!(i&&!n&&!t.canMove()&&!t.canCopy())))if(s===void 0&&(s=this.o0()),t instanceof gt){if(e.set(t,this.Es(s,t,t.location)),t instanceof Nt&&(t.hasPlaceholder()||s.dragsMembers)){const r=t.memberParts;for(;r.next();){const a=r.value;this.Kr(e,a,i,s,s.groupsAlwaysMove)}}const o=t.linksConnected;for(;o.next();){const r=o.value;if(e.has(r))continue;const a=r.fromNode,h=r.toNode;a!==null&&e.has(a)&&h!==null&&e.has(h)&&this.Kr(e,r,i,s)}if(s.dragsTree){const r=t.findTreeChildrenNodes();for(;r.next();){const a=r.value;this.Kr(e,a,i,s)}}}else if(t instanceof St){e.set(t,this.Es(s,t));const o=t.labelNodes;for(;o.next();){const r=o.value;this.Kr(e,r,i,s)}}else t instanceof Ft||e.set(t,this.Es(s,t,t.location))}TP(e,t,i,s){if(e===null||e.count===0)return;const n=C.l(),o=C.l();o.a(t),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.gb;r||this.WC(e);const a=u.et(),h=u.et(),l=e.iterator;let c=C.l();for(;l.next();){const y=l.key,x=l.value;if(y.ke()){const b=this.HL(y,e);if(b!==null)a.push(new eu(y,x,b));else if(!s||y.canMove()){const M=x.point;n.a(M),this.computeMove(y,n.add(o),i,c),y.location=c,x.shifted===void 0&&(x.shifted=new C),x.shifted.a(c.subtract(M))}}else l.key instanceof St&&h.push(new at(l.key,l.value))}C.e(c);const d=a.length;for(let y=0;y<d;y++){const x=a[y],b=x.qL.point;n.a(b),x.Nb.shifted===void 0&&(x.Nb.shifted=new C),x.Me.location=n.add(x.Nb.shifted)}const f=C.l(),m=C.l(),p=h.length;for(let y=0;y<p;y++){const x=h[y],b=x.key;if(b instanceof St){if(b.suspendsRouting){b.br=null;const M=b.fromNode,P=b.toNode;if(this.draggedLink!==null&&i.dragsLink){const k=x.value.point;if(b.dragComputation===null){e.set(b,this.Es(i,b,o));const L=o.x-k.x,T=o.y-k.y;b.fr(L,T)}else{const L=C.V(0,0),T=b.getPoint(0);T&&T.isReal()&&L.a(T),c=C.l().a(L).add(o);let D=c;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(D=C.l(),this.yS(b,c,D,i)),c.a(b.dragComputation(b,c,D)).subtract(L),e.set(b,this.Es(i,b,c));const B=c.x-k.x,E=c.y-k.y;b.fr(B,E),C.e(L),C.e(c),D!==c&&C.e(D)}}else{if(M!==null){f.a(M.location);const k=e.get(M);k!==null&&f.subtract(k.point)}if(P!==null){m.a(P.location);const k=e.get(P);k!==null&&m.subtract(k.point)}if(M!==null&&P!==null)if(f.equalsApprox(m)){const k=x.value.point,L=n;L.a(f),L.subtract(k),e.set(b,this.Es(i,b,f)),b.fr(L.x,L.y)}else b.suspendsRouting=!1,b.invalidateRoute();else{const k=x.value.point;let L;M!==null?L=f:P!==null?L=m:L=o,e.set(b,this.Es(i,b,L));const T=L.x-k.x,D=L.y-k.y;b.fr(T,D)}}}else if(b.fromNode===null||b.toNode===null){const M=x.value.point;e.set(b,this.Es(i,b,o));const P=o.x-M.x,k=o.y-M.y;b.fr(P,k)}}}C.e(n),C.e(o),C.e(f),C.e(m),u.J(a),u.J(h),r||(this.Mi(),this.NP(e))}computeMove(e,t,i,s){if(s===void 0&&(s=new C),s.a(t),e===null)return s;let n=t;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=C.l(),this.yS(e,t,n,i));const r=e.dragComputation!==null?e.dragComputation(e,t,n):n,a=e.minLocation;let h=a.x;isNaN(h)&&(h=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let l=a.y;isNaN(l)&&(l=o?Math.round(e.location.y*1e3)/1e3:e.location.y);const c=e.maxLocation;let d=c.x;isNaN(d)&&(d=o?Math.round(e.location.x*1e3)/1e3:e.location.x);let f=c.y;return isNaN(f)&&(f=o?Math.round(e.location.y*1e3)/1e3:e.location.y),s.i(Math.max(h,Math.min(r.x,d)),Math.max(l,Math.min(r.y,f))),n!==t&&C.e(n),s}o0(){const e=this.toolManager.findTool("Dragging");return e instanceof Ne?e.dragOptions:this.yb}yS(e,t,i,s){if(s===void 0&&(s=this.o0()),i.a(t),e===null)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,a=o.height;const h=s.gridSnapOrigin;let l=h.x,c=h.y;const d=s.gridSnapCellSpot;if(n!==null){const m=n.gridCellSize;isNaN(r)&&(r=m.width),isNaN(a)&&(a=m.height);const p=n.gridOrigin;isNaN(l)&&(l=p.x),isNaN(c)&&(c=p.y)}const f=C.V(0,0);return f.setSpot(0,0,r,a,d),O.Dg(t.x,t.y,l+f.x,c+f.y,r,a,i),C.e(f),i}WC(e){if(e===null)return;this.gb=!0;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof St&&(i.suspendsRouting=!0)}}NP(e){if(e===null)return;const t=e.iterator;for(;t.next();){const i=t.key;i instanceof St&&(i.suspendsRouting=!1,i.WL()&&i.invalidateRoute())}this.gb=!1}get draggedLink(){return this.pb}set draggedLink(e){this.pb!==e&&(this.pb=e,e!==null&&(this.wb=e.fromPort,this.xb=e.toPort))}get RP(){return this.wb}set RP(e){this.wb=e}get vP(){return this.xb}set vP(e){this.xb=e}HL(e,t){const i=e.containingGroup;if(i!==null){let s=this.HL(i,t);if(s!==null||(s=t.get(i),s!==null))return s}return null}Es(e,t,i){if(i===void 0)return new ls(C.xo);let s=e.isGridSnapEnabled;return!e.groupsSnapMembers&&t.containingGroup!==null&&(s=!1),s?new ls(new C(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new ls(i.copy())}BM(e,t){if(e.diagram!==null&&e.diagram!==this&&u.o("Cannot share a Layer with another Diagram: "+e+" of "+e.diagram),t===null?e.diagram!==null&&u.o("Cannot add an existing Layer to this Diagram again: "+e):(t.diagram!==this&&u.o("Existing Layer must be in this Diagram: "+t+" not in "+t.diagram),e===t&&u.o("Cannot move a Layer before or after itself: "+e)),e.diagram===this)return;const i=e.name,s=this.Xt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&u.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(e){this.BM(e,null),e.Mo(this);const t=this.Xt;let i=t.count-1;if(!e.isTemporary)for(;i>=0&&t.elt(i).isTemporary;)i--;return t.insertAt(i+1,e),this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,i+1),this.S(),this.invalidateDocumentBounds(),this}addLayerBefore(e,t){this.BM(e,t),e.Mo(this);const i=this.Xt,s=i.indexOf(e);s>=0&&(i.delete(e),this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o,e);break}return this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o),this.S(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(e,t){this.BM(e,t),e.Mo(this);const i=this.Xt,s=i.indexOf(e);s>=0&&(i.delete(e),this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===t){i.insertAt(o+1,e);break}return this.ki!==null&&this.raiseChangedEvent(3,"layers",this,null,e,null,o+1),this.S(),s<0&&this.invalidateDocumentBounds(),this}Xr(e,t){e.Mo(this),this.Xt.insertAt(t,e)}JL(e){this.Xt.removeAt(e)}removeLayer(e){if(e.diagram!==this&&u.o("Cannot remove a Layer from another Diagram: "+e+" of "+e.diagram),e.name==="")return;const t=this.Xt,i=t.indexOf(e);if(t.delete(e)){const s=e.Ct.copy().iterator;for(;s.next();){const n=s.value,o=n.layerName;o!==e.name?n.layerName=o:n.layerName=""}this.ki!==null&&this.raiseChangedEvent(4,"layers",this,e,null,i,null),this.S(),this.invalidateDocumentBounds()}}findLayer(e){const t=this.layers;for(;t.next();){const i=t.value;if(i.name===e)return i}return null}findRouter(e){for(const t of this.Vc)if(t.name===e)return t;return null}addModelChangedListener(e){return u.k(e,_,"addModelChangedListener:listener"),this.Gn===null&&(this.Gn=new Y),this.Gn.add(e),this.model.addChangedListener(e),this}removeModelChangedListener(e){u.k(e,_,"removeModelChangedListener:listener"),this.Gn!==null&&(this.Gn.delete(e),this.Gn.count===0&&(this.Gn=null)),this.model.removeChangedListener(e)}addChangedListener(e){return u.k(e,_,"addChangedListener:listener"),this.Nr===null&&(this.Nr=new Y),this.Nr.add(e),this}removeChangedListener(e){u.k(e,_,"removeChangedListener:listener"),this.Nr!==null&&(this.Nr.delete(e),this.Nr.count===0&&(this.Nr=null))}VM(e){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(e),e.change!==1&&(this.isModified=!0),this.Nr!==null){const t=this.Nr,i=t.length;for(let s=0;s<i;s++)t.elt(s)(e)}}raiseChangedEvent(e,t,i,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const a=new be;a.diagram=this,a.change=e,a.propertyName=t,a.object=i,a.oldValue=s,a.oldParam=o,a.newValue=n,a.newParam=r,this.VM(a)}raiseChanged(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}t(e,t,i,s,n){this.raiseChangedEvent(2,e,this,t,i,s,n)}get animationManager(){return this.ds}get undoManager(){return this.ki.undoManager}get skipsUndoManager(){return this.Lo}set skipsUndoManager(e){u.s(e,"boolean",_,"skipsUndoManager"),this.Lo=e,this.ki.skipsUndoManager=e}get delaysLayout(){return this.Gx}set delaysLayout(e){this.Gx=e}VC(e,t){if(e===null||e.diagram!==this)return;const i=this.fe;try{this.fe=!0;const s=e.change;if(s===2){const n=e.object,o=e.propertyName,r=e.getValue(t);if(e.diagram.model.Z(n,o,r),n instanceof Xt){const a=n.part;a!==null&&a.invalidateAdornments()}this.isModified=!0}else if(s===3){const n=e.object,o=e.newParam,r=e.newValue;if(n instanceof bt)if(typeof o=="number"&&r instanceof Xt){t?n.te(o):n.insertAt(o,r);const a=n.part;a!==null&&a.invalidateAdornments()}else typeof o=="number"&&r instanceof Me&&(r.isRow?n.$L(o,t?void 0:r):n.ZL(o,t?void 0:r));else if(n instanceof Xe){const a=e.oldParam===!0;typeof o=="number"&&r instanceof Ht&&(t?(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.te(a?o:-1,r,a)):n.Jh(o,r,a))}else n instanceof _?typeof o=="number"&&r instanceof Xe&&(t?this.JL(o):this.Xr(r,o)):u.o("unknown ChangeType.Insert object: "+e.toString());this.isModified=!0}else if(s===4){const n=e.object,o=e.oldParam,r=e.oldValue;if(n instanceof bt)typeof o=="number"&&r instanceof Xt?t?n.insertAt(o,r):n.te(o):typeof o=="number"&&r instanceof Me&&(r.isRow?n.$L(o,t?r:void 0):n.ZL(o,t?r:void 0));else if(n instanceof Xe){const a=e.newParam===!0;typeof o=="number"&&r instanceof Ht&&(t?n.Ct.indexOf(r)<0&&n.Jh(o,r,a):(a||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.te(a?o:-1,r,a)))}else n instanceof _?typeof o=="number"&&r instanceof Xe&&(t?this.Xr(r,o):this.JL(o)):u.o("unknown ChangeType.Remove object: "+e.toString());this.isModified=!0}else s===1||u.o("unknown ChangedEvent: "+e.toString())}finally{this.fe=i}}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(e){this.partManager.updateAllTargetBindings(e)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.Ze!==null){const e=this.Ze.part;e!==null&&e.Do()}}setDivBackground(e){this.div&&(this.div.style.backgroundColor=e)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}_m(){const e=this.T,t=this.tt,i=this.at;e.Ri(),t!==1&&e.tt(t),(i.x!==0||i.y!==0)&&e.Fs(-i.x,-i.y)}QL(e,t){const i=this.animationManager;if(this.Ht||this.ys){this.tt=t,this.Ql(),this.S(),this.aa(),i.yL(e,this.tt),this._m();return}if(this.ft===null){this.tt=t,this._m();return}this.Ht=!0;const s=this.viewportBounds.copy(),n=this.xt,o=this.bt;let r=this.zoomPoint.x,a=this.zoomPoint.y;const h=this.contentAlignment;isNaN(r)&&(h.isSide()?h.includesSide(U.LeftSide)?r=0:h.includesSide(U.RightSide)&&(r=n-1):h.isSpot()?r=h.x*(n-1):r=n/2),isNaN(a)&&(h.isSide()?h.includesSide(U.TopSide)?a=0:h.includesSide(U.BottomSide)&&(a=o-1):h.isSpot()?a=h.y*(o-1):a=o/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(t=this.scaleComputation(this,t)),t<this.minScale&&(t=this.minScale),t>this.maxScale&&(t=this.maxScale);const l=C.V(this.at.x+r/e-r/t,this.at.y+a/e-a/t);this.position=l,C.e(l),this.tt=t,this._m(),this.Ql(),this.Ht=!1,this.onViewportBoundsChanged(s,this.viewportBounds,e,!1),this.Bs(!1),i.yL(e,this.tt),this.S()}MR(){const e=this.Xt.r;for(let t=0;t<e.length;t++)e[t].ML()}onViewportBoundsChanged(e,t,i,s){if(e.equals(t))return;s===void 0&&(s=!1),s||this.aa(),this._l();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(e.width!==t.width||e.height!==t.height)&&n.invalidateLayout();const o=this.currentTool;this.Uc===!0&&o instanceof Pe&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.standardMouseActivity(this)),this.Ht||this.invalidateViewport(e,t),this.th(),this.Bi.scale=i,this.Bi.position.x=e.x,this.Bi.position.y=e.y,this.Bi.bounds.a(e),this.Bi.canvasSize.width=Math.round(e.width*i),this.Bi.canvasSize.height=Math.round(e.height*i),this.Bi.newCanvasSize.width=this.xt,this.Bi.newCanvasSize.height=this.bt,this.Bi.isScroll=s,this.D("ViewportBoundsChanged",this.Bi,e),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(t)&&r.invalidateRoute()})}th(e){const t=this.Ze;if(t===null||!t.visible||t.part===null||t.layer===null)return;const i=e!==void 0?e:this.nb;if(!i.isReal())return;const s=i.width,n=i.height;if(t.scale=1,t.angle=0,t.layer.isViewportAligned)t.width=s*this.scale,t.height=n*this.scale,t.part.alignment=U.TopLeft;else{t.yi===null&&(t.yi=new As);const o=t.yi.Yc;if(!o.isReal())return;t.width=s+o.width*2,t.height=n+o.height*2;const r=C.l();O.Dg(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),t.part.location=r,C.e(r)}}clearSelection(e){e===void 0&&(e=!1);const t=this.selection;if(t.count===0)return;e||this.D("ChangingSelection",t);const i=t.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}t.Pt(),t.clear(),t.u(),e||this.D("ChangedSelection",t)}select(e){e!==null&&e.diagram===this&&(!e.isSelected||this.selection.count>1)&&(this.D("ChangingSelection",this.selection),this.clearSelection(!0),e.isSelected=!0,this.D("ChangedSelection",this.selection))}selectCollection(e){if(this.D("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];s instanceof Ht||u.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const t=e.iterator;for(;t.next();){const i=t.value;i instanceof Ht||u.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.D("ChangedSelection",this.selection)}clearHighlighteds(){const e=this.highlighteds;if(e.count>0){const t=e.toArray(),i=t.length;for(let s=0;s<i;s++){const n=t[s];n.isHighlighted=!1}e.Pt(),e.clear(),e.u()}}highlight(e){e!==null&&e.diagram===this&&(!e.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),e.isHighlighted=!0)}highlightCollection(e){const t=new I().addAll(e),i=this.highlighteds.copy().removeAll(t).iterator;for(;i.next();){const n=i.value;n.isHighlighted=!1}const s=t.iterator;for(;s.next();){const n=s.value;n instanceof Ht||u.o("Diagram.highlightCollection given something that is not a Part: "+n),n.isHighlighted=!0}}scroll(e,t,i){i===void 0&&(i=1);const s=t==="up"||t==="down";let n=0;const o=C.l();if(e==="pixel")n=i;else if(e==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(e==="page"){let a=s?this.viewportBounds.height:this.viewportBounds.width;if(a*=this.scale,a!==0){const h=Math.max(a-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*h}}else if(e==="document"){const a=this.documentBounds,h=this.viewportBounds;t==="up"?this.position=o.i(h.x,a.y):t==="left"?this.position=o.i(a.x,h.y):t==="down"?this.position=o.i(h.x,a.bottom-h.height):t==="right"&&(this.position=o.i(a.right-h.width,h.y)),C.e(o);return}else u.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+e);n/=this.scale;const r=this.position;t==="up"?this.position=o.i(r.x,r.y-n):t==="down"?this.position=o.i(r.x,r.y+n):t==="left"?this.position=o.i(r.x-n,r.y):t==="right"?this.position=o.i(r.x+n,r.y):u.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+t),C.e(o)}scrollToRect(e){const t=this.viewportBounds;if(t.containsRect(e))return;const i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}centerRect(e){const t=this.viewportBounds,i=e.center;i.x-=t.width/2,i.y-=t.height/2,this.position=i}transformDocToView(e){return e.copy().T(this.T)}transformViewToDoc(e){return e.copy().Oe(this.T)}$F(e){return e.Oe(this.T)}get opacity(){return this.$t}set opacity(e){const t=this.$t;t!==e&&(u.s(e,"number",_,"opacity"),(e<0||e>1)&&u.W(e,"0 <= value <= 1",_,"opacity"),this.$t=e,this.t("opacity",t,e),this.S())}get validCycle(){return this.Ux}set validCycle(e){const t=this.Ux;t!==e&&(this.Ux=e,this.t("validCycle",t,e))}get layers(){return this.Xt.iterator}get isModelReadOnly(){const e=this.ki;return e===null?!1:e.isReadOnly}set isModelReadOnly(e){const t=this.ki;t!==null&&(t.isReadOnly=e)}get isReadOnly(){return this.Ao}set isReadOnly(e){const t=this.Ao;t!==e&&(u.s(e,"boolean",_,"isReadOnly"),this.Ao=e,this.t("isReadOnly",t,e))}get isEnabled(){return this.Oi}set isEnabled(e){const t=this.Oi;t!==e&&(u.s(e,"boolean",_,"isEnabled"),this.Oi=e,this.t("isEnabled",t,e))}get allowClipboard(){return this.Kx}set allowClipboard(e){const t=this.Kx;t!==e&&(u.s(e,"boolean",_,"allowClipboard"),this.Kx=e,this.t("allowClipboard",t,e))}get allowCopy(){return this.Rl}set allowCopy(e){const t=this.Rl;t!==e&&(u.s(e,"boolean",_,"allowCopy"),this.Rl=e,this.t("allowCopy",t,e))}get allowDelete(){return this.vl}set allowDelete(e){const t=this.vl;t!==e&&(u.s(e,"boolean",_,"allowDelete"),this.vl=e,this.t("allowDelete",t,e))}get allowDragOut(){return this.jx}set allowDragOut(e){const t=this.jx;t!==e&&(u.s(e,"boolean",_,"allowDragOut"),this.jx=e,this.t("allowDragOut",t,e))}get allowDrop(){return this.Hx}set allowDrop(e){const t=this.Hx;t!==e&&(u.s(e,"boolean",_,"allowDrop"),this.Hx=e,this.t("allowDrop",t,e))}get allowTextEdit(){return this.Ol}set allowTextEdit(e){const t=this.Ol;t!==e&&(u.s(e,"boolean",_,"allowTextEdit"),this.Ol=e,this.t("allowTextEdit",t,e))}get allowGroup(){return this.Il}set allowGroup(e){const t=this.Il;t!==e&&(u.s(e,"boolean",_,"allowGroup"),this.Il=e,this.t("allowGroup",t,e))}get allowUngroup(){return this.El}set allowUngroup(e){const t=this.El;t!==e&&(u.s(e,"boolean",_,"allowUngroup"),this.El=e,this.t("allowUngroup",t,e))}get allowInsert(){return this.qx}set allowInsert(e){const t=this.qx;t!==e&&(u.s(e,"boolean",_,"allowInsert"),this.qx=e,this.t("allowInsert",t,e))}get allowLink(){return this.Ul}set allowLink(e){const t=this.Ul;t!==e&&(u.s(e,"boolean",_,"allowLink"),this.Ul=e,this.t("allowLink",t,e))}get allowRelink(){return this.Bl}set allowRelink(e){const t=this.Bl;t!==e&&(u.s(e,"boolean",_,"allowRelink"),this.Bl=e,this.t("allowRelink",t,e))}get allowMove(){return this.Vl}set allowMove(e){const t=this.Vl;t!==e&&(u.s(e,"boolean",_,"allowMove"),this.Vl=e,this.t("allowMove",t,e))}get allowReshape(){return this.zl}set allowReshape(e){const t=this.zl;t!==e&&(u.s(e,"boolean",_,"allowReshape"),this.zl=e,this.t("allowReshape",t,e))}get allowResize(){return this.Xl}set allowResize(e){const t=this.Xl;t!==e&&(u.s(e,"boolean",_,"allowResize"),this.Xl=e,this.t("allowResize",t,e))}get allowRotate(){return this.Yl}set allowRotate(e){const t=this.Yl;t!==e&&(u.s(e,"boolean",_,"allowRotate"),this.Yl=e,this.t("allowRotate",t,e))}get allowSelect(){return this.Gl}set allowSelect(e){const t=this.Gl;t!==e&&(u.s(e,"boolean",_,"allowSelect"),this.Gl=e,this.t("allowSelect",t,e))}get allowUndo(){return this.Wx}set allowUndo(e){const t=this.Wx;t!==e&&(u.s(e,"boolean",_,"allowUndo"),this.Wx=e,this.t("allowUndo",t,e))}get allowZoom(){return this.Jx}set allowZoom(e){const t=this.Jx;t!==e&&(u.s(e,"boolean",_,"allowZoom"),this.Jx=e,this.t("allowZoom",t,e))}get hasVerticalScrollbar(){return this.vu}set hasVerticalScrollbar(e){const t=this.vu;t!==e&&(u.s(e,"boolean",_,"hasVerticalScrollbar"),this.vu=e,this.aa(),this.S(),this.t("hasVerticalScrollbar",t,e),this.Bs(!1))}get hasHorizontalScrollbar(){return this.Ru}set hasHorizontalScrollbar(e){const t=this.Ru;t!==e&&(u.s(e,"boolean",_,"hasHorizontalScrollbar"),this.Ru=e,this.aa(),this.S(),this.t("hasHorizontalScrollbar",t,e),this.Bs(!1))}get allowHorizontalScroll(){return this.$x}set allowHorizontalScroll(e){const t=this.$x;t!==e&&(u.s(e,"boolean",_,"allowHorizontalScroll"),this.$x=e,this.t("allowHorizontalScroll",t,e),this.Bs(!1))}get allowVerticalScroll(){return this.Zx}set allowVerticalScroll(e){const t=this.Zx;t!==e&&(u.s(e,"boolean",_,"allowVerticalScroll"),this.Zx=e,this.t("allowVerticalScroll",t,e),this.Bs(!1))}get scrollHorizontalLineChange(){return this.Qx}set scrollHorizontalLineChange(e){const t=this.Qx;t!==e&&(u.s(e,"number",_,"scrollHorizontalLineChange"),e<0&&u.W(e,">= 0",_,"scrollHorizontalLineChange"),this.Qx=e,this.t("scrollHorizontalLineChange",t,e))}get scrollVerticalLineChange(){return this._x}set scrollVerticalLineChange(e){const t=this._x;t!==e&&(u.s(e,"number",_,"scrollVerticalLineChange"),e<0&&u.W(e,">= 0",_,"scrollVerticalLineChange"),this._x=e,this.t("scrollVerticalLineChange",t,e))}get lastInput(){return this._h}set lastInput(e){this._h=e}get previousInput(){return this.Br}set previousInput(e){this.Br=e}get firstInput(){return this.Gm}set firstInput(e){this.Gm=e}get currentCursor(){return this.Bx}set currentCursor(e){if(e===""&&(e=this.Um),this.Bx!==e){u.s(e,"string",_,"currentCursor");const t=this.ft,i=this.Mt;if(t===null||i===null)return;this.Bx=e;const s=t.style.cursor;t.style.cursor=e,i.style.cursor=e,t.style.cursor===s&&(t.style.cursor="-webkit-"+e,i.style.cursor="-webkit-"+e,t.style.cursor===s&&(t.style.cursor="-moz-"+e,i.style.cursor="-moz-"+e,t.style.cursor===s&&(t.style.cursor=e,i.style.cursor=e)))}}get defaultCursor(){return this.Um}set defaultCursor(e){e===""&&(e="auto");const t=this.Um;t!==e&&(u.s(e,"string",_,"defaultCursor"),this.Um=e,this.t("defaultCursor",t,e))}get click(){return this.Cr}set click(e){const t=this.Cr;t!==e&&(e!==null&&u.k(e,_,"click"),this.Cr=e,this.t("click",t,e))}get doubleClick(){return this.Lr}set doubleClick(e){const t=this.Lr;t!==e&&(e!==null&&u.k(e,_,"doubleClick"),this.Lr=e,this.t("doubleClick",t,e))}get contextClick(){return this.Ar}set contextClick(e){const t=this.Ar;t!==e&&(e!==null&&u.k(e,_,"contextClick"),this.Ar=e,this.t("contextClick",t,e))}get mouseOver(){return this.Tr}set mouseOver(e){const t=this.Tr;t!==e&&(e!==null&&u.k(e,_,"mouseOver"),this.Tr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.Dr}set mouseHover(e){const t=this.Dr;t!==e&&(e!==null&&u.k(e,_,"mouseHover"),this.Dr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.Fr}set mouseHold(e){const t=this.Fr;t!==e&&(e!==null&&u.k(e,_,"mouseHold"),this.Fr=e,this.t("mouseHold",t,e))}get mouseDragOver(){return this.Vx}set mouseDragOver(e){const t=this.Vx;t!==e&&(e!==null&&u.k(e,_,"mouseDragOver"),this.Vx=e,this.t("mouseDragOver",t,e))}get mouseDrop(){return this.Rr}set mouseDrop(e){const t=this.Rr;t!==e&&(this.Rr=e,this.t("mouseDrop",t,e))}get handlesDragDropForTopLevelParts(){return this.zx}set handlesDragDropForTopLevelParts(e){const t=this.zx;t!==e&&(u.s(e,"boolean",_,"handlesDragDropForTopLevelParts"),this.zx=e,this.t("handlesDragDropForTopLevelParts",t,e))}get mouseEnter(){return this.vr}set mouseEnter(e){const t=this.vr;t!==e&&(e!==null&&u.k(e,_,"mouseEnter"),this.vr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.Or}set mouseLeave(e){const t=this.Or;t!==e&&(e!==null&&u.k(e,_,"mouseLeave"),this.Or=e,this.t("mouseLeave",t,e))}get toolTip(){return this.Ir}set toolTip(e){const t=this.Ir;t!==e&&(this.Ir=e,this.t("toolTip",t,e))}get contextMenu(){return this.Er}set contextMenu(e){const t=this.Er;t!==e&&(this.Er=e,this.t("contextMenu",t,e))}get commandHandler(){return this.sM}set commandHandler(e){const t=this.sM;t!==e&&(t&&t.doStop(),this.sM=e,e.Mo(this),e.doStart())}get toolManager(){return this.tM}set toolManager(e){this.tM!==e&&(this.tM=e,e.diagram=this)}get defaultTool(){return this.iM}set defaultTool(e){const t=this.iM;t!==e&&(this.iM=e,e.diagram=this,this.currentTool===t&&(this.currentTool=e))}get currentTool(){return this.eM}set currentTool(e){const t=this.eM;t&&(t.isActive&&t.doDeactivate(),t.cancelWaitAfter(),t.doStop()),e===null&&(e=this.defaultTool),e!==null&&(this.eM=e,e.diagram=this,e.doStart())}get selection(){return this.cM}get maxSelectionCount(){return this.sb}set maxSelectionCount(e){const t=this.sb;if(t!==e)if(u.s(e,"number",_,"maxSelectionCount"),e>=0&&!isNaN(e)){if(this.sb=e,this.t("maxSelectionCount",t,e),!this.undoManager.isUndoingRedoing){const i=this.selection.count-e;if(i>0){this.D("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.D("ChangedSelection",this.selection)}}}else u.W(e,">= 0",_,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.Xm}set nodeSelectionAdornmentTemplate(e){const t=this.Xm;t!==e&&(this.Xm=e.Et(),this.t("nodeSelectionAdornmentTemplate",t,e))}get groupSelectionAdornmentTemplate(){return this.rb}set groupSelectionAdornmentTemplate(e){const t=this.rb;t!==e&&(this.rb=e.Et(),this.t("groupSelectionAdornmentTemplate",t,e))}get linkSelectionAdornmentTemplate(){return this.lb}set linkSelectionAdornmentTemplate(e){const t=this.lb;t!==e&&(this.lb=e.Et(),this.t("linkSelectionAdornmentTemplate",t,e))}get highlighteds(){return this.fM}get isModified(){const e=this.undoManager;return e.isEnabled?e.currentTransaction!==null?!0:this.Uu&&this.Os!==e.historyIndex:this.Uu}set isModified(e){if(this.Uu!==e){u.s(e,"boolean",_,"isModified"),this.Uu=e;const t=this.undoManager;!e&&t.isEnabled&&(this.Os=t.historyIndex),e||this._L()}}_L(){const e=this.isModified;this.hM!==e&&(this.hM=e,this.D("Modified"))}get model(){return this.ki}set model(e){const t=this.ki;if(t!==e){this.currentTool.doCancel(),t&&t.undoManager!==e.undoManager&&t.undoManager.isInTransaction&&u.o("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);const i=this.OL(!0);this.jn=!1,this.Fu=!0,this.Os=-2,this.xr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Fl("Model"),t&&(this.Gn!==null&&this.Gn.each(n=>t.removeChangedListener(n)),t.removeChangedListener(this.lM)),this.ki=e,this.partManager=this.vR(this.ki.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);e.addChangedListener(this.rM),this.partManager.zM(),e.removeChangedListener(this.rM),e.addChangedListener(this.lM),this.Gn!==null&&this.Gn.each(n=>e.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.S(),t&&e.undoManager.copyProperties(t.undoManager)}}get themeManager(){return this.NM}set themeManager(e){const t=this.NM;t!==e&&(t&&t.removeDiagram(this),this.NM=e,e!==null&&e.addDiagram(this))}initializePartManager(e){}static CM(e,t){_.AL.set(e,t)}static get licenseKey(){return _.XM.last()}static set licenseKey(e){_.XM.add(e.replace(/\s/g,""))}static get version(){return _.OR}vR(e){const t=_.AL.get(e);return t!==null?new t:new cs}get X(){return this.oM}set X(e){this.oM=e}get bx(){return this.NL}IR(e){if(e.model!==this.model)return;const t=e.change,i=e.propertyName;if(t===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.ys&&!this.jn&&(this.vc=!0,this.Fu&&(this.xr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.D("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.X){this.X=!1;try{if(e.modelChange===""&&t===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.D("ChangedSelection",this.selection),this.Mi());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this.xL(),this.vc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.OS(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.Os=Math.min(this.Os,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Uw&&u.ir(()=>{this.isModified=!1},1);const n=e.isTransactionFinished;if(n&&(this._L(),this.bx.clear(),this.animationManager.OF()),!this.Xx&&n&&this.lastInput.targetDiagram){this.Xx=!0;const o=this;u.ir(()=>{o.currentTool.standardMouseOver(),o.Xx=!1},10)}}}finally{this.X=!0}}}get fe(){return this.nM}set fe(e){this.nM=e}get du(){return this.Yx}set du(e){this.Yx=e}GL(e){const t=e.C.r;for(const i of t)i instanceof ii&&this.YM(i)}YM(e){const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||(t.ts instanceof I&&t.ts.add(this),e.ER(),!t.r0))return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s===null){ii.tA(e,t);const n=[];n.push(e),this.Jl.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}UR(e){const t=e.C.r,i=t.length;for(let s=0;s<i;s++)this.GM(t[s])}GM(e){if(!(e instanceof ii))return;const t=e.element;if(t===null||!(t instanceof HTMLImageElement)||!t.r0)return;const i=t.getAttribute("src")||"",s=this.Jl.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&(this.Jl.delete(i),ii.BR(t),t.ts instanceof I&&t.ts.delete(this),ii.clearCache(i));return}}}IL(){ii.clearCache(),this.Jl.clear()}rebuildParts(){this.partManager.rebuildParts()}Lc(e,t){this.ds.Lc(e,t)}Cc(e,t){this.ds.Cc(e,t)}findPartForKey(e){return this.partManager.findPartForKey(e)}findNodeForKey(e){return this.partManager.findNodeForKey(e)}findLinkForKey(e){return this.partManager.findLinkForKey(e)}findPartForData(e){return this.partManager.findPartForData(e)}findNodeForData(e){return this.partManager.findNodeForData(e)}findLinkForData(e){return this.partManager.findLinkForData(e)}findNodesByExample(...e){return this.partManager.findNodesByExample(...e)}findLinksByExample(...e){return this.partManager.findLinksByExample(...e)}get nodeTemplate(){return this.Ur.get("")}set nodeTemplate(e){const t=this.Ur.get("");t!==e&&(this.Ur.set("",e),this.t("nodeTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Ur}set nodeTemplateMap(e){const t=this.Ur;t!==e&&(this.Ur=e,this.t("nodeTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.Qh.get("")}set groupTemplate(e){const t=this.Qh.get("");t!==e&&(this.Qh.set("",e),this.t("groupTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.Qh}set groupTemplateMap(e){const t=this.Qh;t!==e&&(this.Qh=e,this.t("groupTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.ql.get("")}set linkTemplate(e){const t=this.ql.get("");t!==e&&(this.ql.set("",e),this.t("linkTemplate",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.ql}set linkTemplateMap(e){const t=this.ql;t!==e&&(this.ql=e,this.t("linkTemplateMap",t,e),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.aM}set isMouseCaptured(e){const t=this.ft;if(t===null)return;const i=t.Tt;i instanceof SVGElement||(e?(this.lastInput.bubbles=!1,this.Pi(i,"pointermove",this.na,!1),this.Pi(i,"pointerdown",this.Zl,!1),this.Pi(i,"pointerup",this.oa,!1),this.Pi(i,"pointerout",this.ra,!1),this.Pi(i,"pointercancel",this.la,!1),this.Ut(w,"pointermove",this.na,!0),this.Ut(w,"pointerdown",this.Zl,!0),this.Ut(w,"pointerup",this.oa,!0),this.Ut(w,"pointerout",this.ra,!0),this.Ut(w,"pointercancel",this.la,!0),this.Pi(i,"wheel",this.sa,!1),this.Ut(w,"wheel",this.sa,!0),this.Ut(w,"selectstart",this.jh,!1)):(this.Pi(w,"pointermove",this.na,!0),this.Pi(w,"pointerdown",this.Zl,!0),this.Pi(w,"pointerup",this.oa,!0),this.Pi(w,"pointerout",this.ra,!0),this.Pi(w,"pointercancel",this.la,!0),this.Ut(i,"pointermove",this.na,!1),this.Ut(i,"pointerdown",this.Zl,!1),this.Ut(i,"pointerup",this.oa,!1),this.Ut(i,"pointerout",this.ra,!1),this.Ut(i,"pointercancel",this.la,!1),this.Pi(w,"wheel",this.sa,!0),this.Pi(w,"selectstart",this.jh,!1),this.Ut(i,"wheel",this.sa,!1)),this.aM=e)}get position(){return this.at}set position(e){if(this.at.equals(e))return;const t=C.l().a(this.at),i=this.viewportBounds.copy();if(this.at.a(e),this.animationManager.pL(t,this.at),!this.Ht&&!(this.ft===null&&!this.Iu.isReal())){this.Ht=!0;const s=this.scale,n=this.xt/s,o=this.bt/s;this.DM(this.zm,n,o,this.Fc,!1),this.Ht=!1}else this.Ql(),this._m();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.tt,!1)}C.e(t)}get initialPosition(){return this.Mx}set initialPosition(e){this.Mx.equals(e)||(this.Mx=e.P())}get initialScale(){return this.Nx}set initialScale(e){this.Nx!==e&&(u.s(e,"number",_,"initialScale"),this.Nx=e)}get grid(){return this.Ze===null&&(this.Ze=this.UL()),this.Ze}set grid(e){let t=this.Ze;if(t!==e){t===null&&(this.Ze=this.UL(),t=this.Ze),e.type!==bt.Grid&&u.o("Diagram.grid must be a Panel of type Panel.Grid");const i=t.panel;i!==null&&i.remove(t),this.Ze=e,e.name="GRID",i!==null&&i.add(e),this.Eu=!1,this.S(),this.t("grid",t,e)}}get viewportBounds(){return this.nb}Ql(){const e=this.nb,t=this.at,i=this.tt;e.i(t.x,t.y,Math.max(this.xt,0)/i,Math.max(this.bt,0)/i),this._l()}get viewSize(){return this.Iu}set viewSize(e){const t=this.viewSize;if(!t.equals(e)){e=e.P(),this.Iu=e;let i=0,s=0;e.isReal()?(i=e.width,s=e.height):this.Mt!==null&&(i=this.Mt.clientWidth||1,s=this.Mt.clientHeight||1),this.xt=i,this.bt=s,this.Ql(),this.invalidateDocumentBounds(),this.t("viewSize",t,e),this.S()}}get fixedBounds(){return this.Tx}set fixedBounds(e){const t=this.Tx;t.equals(e)||((e.width===-1/0||e.height===1/0||e.height===-1/0)&&u.o("fixedBounds width/height must not be Infinity"),e=e.P(),this.Tx=e,this.invalidateDocumentBounds(),this.t("fixedBounds",t,e))}get scrollMargin(){return this.$h}set scrollMargin(e){typeof e=="number"&&(e=new wt(e));const t=this.$h;t.equals(e)||(e=e.P(),this.$h=e,this.t("scrollMargin",t,e),this.mu())}get scrollMode(){return this.qh}set scrollMode(e){const t=this.qh;t!==e&&(this.qh=e,e===1&&this.Bs(!1),this.t("scrollMode",t,e),this.aa(),this.S())}get scrollsPageOnFocus(){return this.Dx}set scrollsPageOnFocus(e){const t=this.Dx;t!==e&&(u.s(e,"boolean",_,"scrollsPageOnFocus"),this.Dx=e,this.t("scrollsPageOnFocus",t,e))}get positionComputation(){return this.Fx}set positionComputation(e){const t=this.Fx;t!==e&&(e!==null&&u.k(e,_,"positionComputation"),this.Fx=e,this.Bs(!1),this.t("positionComputation",t,e))}get scaleComputation(){return this.Rx}set scaleComputation(e){const t=this.Rx;t!==e&&(e!==null&&u.k(e,_,"scaleComputation"),this.Rx=e,this.QL(this.scale,this.scale),this.t("scaleComputation",t,e))}get documentBounds(){return this.zm}iA(e){this.ta=!1;let t=this.zm;t.equals(e)||(t=t.copy(),this.zm.a(e),this.Bs(!1),this.D("DocumentBoundsChanged",void 0,t),this.aa(),this.S())}ensureBounds(){if(this.ta){const e=G.l();this.iA(this.computeBounds(e)),G.e(e)}}get isVirtualized(){return this.ob}set isVirtualized(e){const t=this.ob;t!==e&&(u.s(e,"boolean",_,"isVirtualized"),this.ob=e,this.t("isVirtualized",t,e))}get scale(){return this.tt}set scale(e){const t=this.tt;t!==e&&this.QL(t,e)}get defaultScale(){return this.Km}set defaultScale(e){this.Km=e}get autoScale(){return this.jl}set autoScale(e){const t=this.jl;t!==e&&(this.jl=e,this.t("autoScale",t,e),e!==1&&this.Bs(!1))}get initialAutoScale(){return this.Sr}set initialAutoScale(e){const t=this.Sr;t!==e&&(this.Sr=e,this.t("initialAutoScale",t,e))}get initialViewportSpot(){return this.Ox}set initialViewportSpot(e){const t=this.Ox;t!==e&&(e.isSpot()||u.o("initialViewportSpot must be a specific Spot: "+e),this.Ox=e,this.t("initialViewportSpot",t,e))}get initialDocumentSpot(){return this.vx}set initialDocumentSpot(e){const t=this.vx;t!==e&&(e.isSpot()||u.o("initialViewportSpot must be a specific Spot: "+e),this.vx=e,this.t("initialDocumentSpot",t,e))}get minScale(){return this.Cx}set minScale(e){const t=this.Cx;t!==e&&(e>0?(this.Cx=e,this.t("minScale",t,e),e>this.scale&&(this.scale=e)):u.W(e,"> 0",_,"minScale"))}get maxScale(){return this.Lx}set maxScale(e){const t=this.Lx;t!==e&&(e>0?(this.Lx=e,this.t("maxScale",t,e),e<this.scale&&(this.scale=e)):u.W(e,"> 0",_,"maxScale"))}get zoomPoint(){return this.Ax}set zoomPoint(e){this.Ax.equals(e)||(e=e.P(),this.Ax=e)}get contentAlignment(){return this.Fc}set contentAlignment(e){const t=this.Fc;t.equals(e)||(e=e.P(),this.Fc=e,this.t("contentAlignment",t,e),this.Bs(!1))}get initialContentAlignment(){return this.Om}set initialContentAlignment(e){const t=this.Om;t.equals(e)||(e=e.P(),this.Om=e,this.t("initialContentAlignment",t,e))}get padding(){return this.Zt}set padding(e){typeof e=="number"&&(e=new wt(e));const t=this.Zt;t.equals(e)||(e=e.P(),this.Zt=e,this.invalidateDocumentBounds(),this.t("padding",t,e))}get partManager(){return this.pM}set partManager(e){const t=this.pM;t!==e&&(e.diagram!==null&&u.o("Cannot share PartManagers between Diagrams: "+e.toString()),t&&t.Mo(null),this.pM=e,e.Mo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const e=new I,t=this.nodes;for(;t.next();){const s=t.value;s.isTopLevel&&e.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&e.add(s)}return e.iterator}findTopLevelGroups(){return this.zr.iterator}get routers(){return this.Vc}doLinkRouting(e){this.Co=!0;const t=this.Vc.r;for(let i=0;i<t.length;i++)t[i].canRoute(e)&&t[i].routeLinks(this.Mr,e);this.Co=!1}get layout(){return this.ie}set layout(e){const t=this.ie;t!==e&&(this.ie=e,e.diagram=this,e.group=null,this.Vr=!0,this.t("layout",t,e),this.requestUpdate())}layoutDiagram(e){this.Mi(),e&&this.Cb(!0),this.ys?this.vM(!1,this.bl||this.Vc.count!==0&&this.Yn.size!==0):(this.vc=!0,this.ur())}Cb(e){const t=this.zr.iterator;for(;t.next();)this.eA(t.value,e);this.layout&&(e?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}eA(e,t){if(e===null)return;const i=e.ca.iterator;for(;i.next();){const s=i.value;this.eA(s,t)}e.layout!==null&&(t?e.layout.isValidLayout=!1:e.layout.invalidateLayout())}vM(e,t){if(this.Gx)return;const i=this.X;this.X=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.wl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.pi&&(e||r.Fl(s)),this.Vr=!1;let a=this.zr.iterator;for(;a.next();)this.sA(a.value,e,n,t);let h=!1;if(o.isValidLayout||(!e||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.i0(this),h=!0,o.isValidLayout=!0):this.Vr=!0),h||this.i0(this),this.doLinkRouting(this),this.Mr.clear(),this.Zh.size!==0){for(let l=0;l<23&&this.Zh.size!==0;l++){for(a=this.zr.iterator;a.next();)this.nA(a.value);const c=this.Mr;this.Mr=this.Zh,this.Zh=c,this.i0(this),this.doLinkRouting(this)}this.Mr.clear(),this.Zh.clear()}}finally{const a=this.undoManager.wl;n===0&&(this.commitTransaction(s),this.undoManager.wl=!1),a&&(n===0||n===1)&&r.OS(),this.Vr&&(this.Vr=!o.isValidLayout),this.X=i}}sA(e,t,i,s){const n=e.ca.iterator;for(;n.next();)this.sA(n.value,t,i,s);const o=e.layout;o!==null&&!o.isValidLayout?!t||o.isRealtime||i===0?(e.fa=!e.location.isReal(),o.doLayout(e),e.invalidateLayout(32),this.Pb(e),this.i0(e),this.doLinkRouting(e),o.isValidLayout=!0):(this.doLinkRouting(e),this.Vr=!0):s&&this.doLinkRouting(e)}nA(e){const t=e.ca.iterator;for(;t.next();)this.nA(t.value);this.i0(e),this.doLinkRouting(e)}get isTreePathToChildren(){return this.Ix}set isTreePathToChildren(e){const t=this.Ix;if(t!==e&&(u.s(e,"boolean",_,"isTreePathToChildren"),this.Ix=e,this.t("isTreePathToChildren",t,e),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.l0()}}findTreeRoots(){const e=new Y,t=this.nodes;for(;t.next();){const i=t.value;i.isTopLevel&&i.findTreeParentLink()===null&&e.add(i)}return e.iterator}get treeCollapsePolicy(){return this.Ex}set treeCollapsePolicy(e){const t=this.Ex;t!==e&&(e!==1&&e!==2&&e!==3&&u.o("Unknown Diagram.treeCollapsePolicy: "+e),this.Ex=e,this.t("treeCollapsePolicy",t,e))}get isCollapsingExpanding(){return this._S}set isCollapsingExpanding(e){this._S=e}rR(){const e=new Z,t=new Z;function i(s){const n=s.toLowerCase(),o=new Y;e.set(s,o),e.set(n,o),t.set(s,s),t.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.ZS=e,this.QS=t}YL(e){const t=this.QS.get(e);return t!==null?t:this.QS.get(e.toLowerCase())}KM(e){let t=this.ZS.get(e);if(t!==null)return t;const i=e.toLowerCase();if(t=this.ZS.get(i),t!==null)return t;u.o("Unknown DiagramEvent name: "+e)}addDiagramListener(e,t){u.s(e,"string",_,"addDiagramListener:name"),u.k(t,_,"addDiagramListener:listener");const i=this.KM(e);return i!==null&&i.add(t),this}removeDiagramListener(e,t){u.s(e,"string",_,"removeDiagramListener:name"),u.k(t,_,"addDiagramListener:listener");const i=this.KM(e);i!==null&&i.delete(t)}raiseDiagramEvent(e,t,i){this.D(e,t,i)}D(e,t,i){const s=this.KM(e),n=new Ve;n.diagram=this;const o=this.YL(e);o!==null&&(n.name=o),t!==void 0&&(n.subject=t),i!==void 0&&(n.parameter=i);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const a=s.toArray();for(let h=0;h<r;h++){const l=a[h];l(n)}}}isUnoccupied(e,t){return this.getPositions(!1,null,t||null).isUnoccupied(e.x,e.y,e.width,e.height)}computeOccupiedArea(e){return this.isVirtualized?this.viewportBounds.copy():this.ta?this.VL(e):e.a(this.documentBounds)}getPositions(e,t,i){let s=this.Hl;s===null&&(this.Hl=s=new Bi(this.avoidanceCellSize));let n=t;if(s.Fo||s.ua!==n||s.jM!==i){if(s.HM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.qM=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.oA(n)),n===null){const o=G.l();this.computeOccupiedArea(o),o.inflate(100,100),s.Lb(o);const r=this.nodes;for(;r.next();){const a=r.value,h=a.layer;h===null||!h.visible||h.isTemporary||this.WM(a,i,o)}G.e(o)}else{if(n.memberParts.count>0){const a=this.computePartsBounds(n.memberParts,!1);a.inflate(20,20),s.Lb(a)}const o=G.l(),r=n.memberParts;for(;r.next();){const a=r.value;a instanceof gt&&this.WM(a,i,o)}G.e(o)}s.ua=n,s.jM=i,s.Fo=!1}else e&&s.rA();return s}get avoidanceCellSize(){return this.uM}set avoidanceCellSize(e){this.Hl=null,this.uM=new rt(Math.max(1,e.width),Math.max(1,e.height))}get avoidanceLimit(){return this.dM}set avoidanceLimit(e){this.dM=Math.max(1,e)}oA(e){return e.canAvoid()?e:e.containingGroup!==null?this.oA(e.containingGroup):null}WM(e,t,i){if(e===t||!e.isVisible())return;const s=e.canAvoid();if(s){const n=e.getAvoidableRect(i);this.Hl.VR(n.x,n.y,n.width,n.height)}if(e instanceof Nt&&(!s||e.avoidableMembers)){const n=e.memberParts;for(;n.next();){const o=n.value;o instanceof gt&&this.WM(o,t,i)}}}JM(e){this.Hl!==null&&!this.Hl.Fo&&(e===void 0||e.canAvoid())&&(this.Hl.Fo=!0)}get autoScrollInterval(){return this.Im}set autoScrollInterval(e){const t=this.Im;t!==e&&(this.Im=e,this.t("autoScrollInterval",t,e))}get autoScrollRegion(){return this.Em}set autoScrollRegion(e){typeof e=="number"&&(e=new wt(e));const t=this.Em;t.equals(e)||(e=e.P(),this.Em=e,this.invalidateDocumentBounds(),this.t("autoScrollRegion",t,e))}doAutoScroll(e){this.Ym.a(e),this.computeAutoScrollPosition(this.Ym).equalsApprox(this.position)?this.stopAutoScroll():this.lA()}lA(){if(this.Rc!==-1)return;const e=this.Im,t=this;this.Rc=u.ir(()=>{if(t.Rc===-1||(t.stopAutoScroll(),t.lastInput.event===null))return;const i=t.computeAutoScrollPosition(t.Ym);if(i.equalsApprox(t.position))return;t.position=i,t.lastInput.documentPoint=t.transformViewToDoc(t.Ym),t.doMouseMove(),t.ta=!0;const s=G.l();t.computeBounds(s),s.unionRect(t.documentBounds),t.iA(s),G.e(s),t.Ue=!0,t.maybeUpdate(),t.lA()},e)}stopAutoScroll(){this.Rc!==-1&&(u.Tg(this.Rc),this.Rc=-1)}computeAutoScrollPosition(e){let t=this.position;const i=this.Em;if(i.top<=0&&i.left<=0&&i.right<=0&&i.bottom<=0)return t;const s=this.viewportBounds,n=this.scale,o=G.V(0,0,s.width*n,s.height*n),r=C.V(0,0);if(e.x>=o.x&&e.x<o.x+i.left&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,r.x-=a,e.x<o.x+i.left/2&&(r.x-=a),e.x<o.x+i.left/4&&(r.x-=4*a)}else if(e.x<=o.x+o.width&&e.x>o.x+o.width-i.right&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,r.x+=a,e.x>o.x+o.width-i.right/2&&(r.x+=a),e.x>o.x+o.width-i.right/4&&(r.x+=4*a)}if(e.y>=o.y&&e.y<o.y+i.top&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,r.y-=a,e.y<o.y+i.top/2&&(r.y-=a),e.y<o.y+i.top/4&&(r.y-=4*a)}else if(e.y<=o.y+o.height&&e.y>o.y+o.height-i.bottom&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,r.y+=a,e.y>o.y+o.height-i.bottom/2&&(r.y+=a),e.y>o.y+o.height-i.bottom/4&&(r.y+=4*a)}return r.equalsApprox(C.xo)||(t=new C(t.x+r.x/n,t.y+r.y/n)),G.e(o),C.e(r),t}makeSvg(e){this.Wl.has("SVG")||this.addRenderer("SVG",new dn(this,w.document));const t=new dn(this,w.document,!0);e===void 0&&(e={});const i=this;function s(n,o){const r=i.hA(n,"SVG",t),a=r!==null?r.svg:null;return u.it(o)?(o(a),null):a}return this.aA(s,e)}makeSVG(e){return this.makeSvg(e)}addRenderer(e,t){this.Wl.set(e,t)}removeRenderer(e){this.Wl.delete(e)}cacheGroupExternalLinks(e){this.MM=e,e||this.nodes.each(t=>{t instanceof Nt&&(t.h0=null)})}aA(e,t){const i=t.callback;let s=!0;const n=this.Jl.iterator;for(;n.next();)if(!n.value[0].hn){s=!1;break}if(!u.it(i)||s)return e(t,i,this);const o=this;function r(){const l=+new Date;for(s=!0,n.reset();n.next();)if(!n.value[0].hn){s=!1;break}if(s||l-h>a){e(t,i,o);return}w.requestAnimationFrame(r)}const a=t.callbackTimeout||300,h=+new Date;return w.requestAnimationFrame(()=>r()),null}makeImage(e){return _.isUsingDOM()?(e===void 0&&(e={}),e.returnType="Image",this.makeImageData(e)):null}makeImageData(e){return e===void 0&&(e={}),this.aA(this.zR,e)}zR(e,t,i){const s=i.hA(e,"canvas",null);if(s===null)return null;const n=s.E.canvas;let o=null;if(n!==null){let r=e.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case _.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case _.img:const a=(e.document||document).createElement("img");a.src=n.toDataURL(e.type,e.details),o=a;break;case"blob":{const h=n;return u.it(t)||(o="",u.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),u.it(h.toBlob)?(h.toBlob(t,e.type,e.details),"toBlob"):(t(null),null)}case"string":default:o=n.toDataURL(e.type,e.details)}}return u.it(t)?(t(o),null):o}hA(e,t,i){if(this.animationManager.stopAnimation(),this.maybeUpdate(),this.ft===null)return null;u.G(e)||u.o("properties argument must be an Object.");let s=!1,n=e.size||null,o=e.scale||null;e.scale!==void 0&&isNaN(e.scale)&&(o="NaN");let r=e.maxSize;e.maxSize===void 0&&(s=!0,t==="SVG"?r=new rt(1/0,1/0):r=new rt(2e3,2e3));const a=e.position||null;let h=e.parts||null;Array.isArray(h)&&(h=new Y(h));let l=e.padding===void 0?1:e.padding;const c=e.background||null;let d=e.omitTemporary;d===void 0&&(d=!0);const f=e.document||document,m=e.elementFinished||null;let p=e.showTemporary;p===void 0&&(p=!d);let y=e.showGrid;y===void 0&&(y=p),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof l=="number"?l=new wt(l):l instanceof wt||u.o("MakeImage padding must be a Margin or a number."),l.left=Math.max(l.left,0),l.right=Math.max(l.right,0),l.top=Math.max(l.top,0),l.bottom=Math.max(l.bottom,0),this.Qt.clearContextCache(!0);const x=new $i(null,f,void 0,!0),b=x.li;if(!(n||o||h||a))return x.width=this.xt+Math.ceil(l.left+l.right),x.height=this.bt+Math.ceil(l.top+l.bottom),t==="SVG"?i===null?null:(i.resize(x.width,x.height,x.width,x.height),i.jr=f,i.Gu=m,this.Sb(i.li,l,new rt(x.width,x.height),this.tt,this.at,h,c,p,y),i.li):(this.Bu=!1,this.Sb(b,l,new rt(x.width,x.height),this.tt,this.at,h,c,p,y),this.Bu=!0,x.li);const M=this.Km,P=this.documentBounds.copy();if(P.subtractMargin(this.Zt),p){const F=this.Xt.r,V=F.length;for(let K=0;K<V;K++){const H=F[K];if(!H.visible||!H.isTemporary)continue;const W=H.Ct.r,J=W.length;for(let $=0;$<J;$++){const et=W[$];if(!et.isInDocumentBounds||!et.isVisible())continue;const ot=et.actualBounds;ot.isReal()&&P.unionRect(ot)}}}let k=new C(P.x,P.y);if(h!==null){const F=new G(0,0,0,0);let V=!0;const K=h.iterator;for(K.reset();K.next();){const H=K.value;if(!(H instanceof Ht))continue;const W=H.layer;if(W!==null&&!W.visible||W!==null&&!p&&W.isTemporary||!H.isVisible())continue;const J=H.actualBounds;J.isReal()&&(V?(V=!1,F.a(J)):F.unionRect(J))}P.width=F.width,P.height=F.height,k.x=F.x,k.y=F.y}a!==null&&a.isReal()&&(k=a,o||(o=M));let L=0,T=0;l!==null&&(L=l.left+l.right,T=l.top+l.bottom);let D=0,B=0;n!==null&&(D=n.width,B=n.height,isFinite(D)&&(D=Math.max(0,D-L)),isFinite(B)&&(B=Math.max(0,B-T)));let E=0,R=0;if(n!==null&&o!==null?(o==="NaN"&&(o=M),n.isReal()?(E=D,R=B):isNaN(B)?(E=D,R=P.height*o):(E=P.width*o,R=B)):n!==null?n.isReal()?(o=Math.min(D/P.width,B/P.height),E=D,R=B):isNaN(B)?(o=D/P.width,E=D,R=P.height*o):(o=B/P.height,E=P.width*o,R=B):o!==null?o==="NaN"&&r.isReal()?(o=Math.min((r.width-L)/P.width,(r.height-T)/P.height),o>M?(o=M,E=P.width,R=P.height):(E=r.width,R=r.height)):(E=P.width*o,R=P.height*o):(o=M,E=P.width,R=P.height),l!==null?(E+=L,R+=T):l=new wt(0),r!==null){let F=r.width,V=r.height;t!=="SVG"&&s&&_.XR,isNaN(F)&&(F=2e3),isNaN(V)&&(V=2e3),isFinite(F)&&(E=Math.min(E,F)),isFinite(V)&&(R=Math.min(R,V))}return x.width=Math.ceil(E),x.height=Math.ceil(R),t==="SVG"?i===null?null:(i.resize(x.width,x.height,x.width,x.height),i.jr=f,i.Gu=m,this.Sb(i.li,l,new rt(Math.ceil(E),Math.ceil(R)),o,k,h,c,p,y),i.li):(this.Bu=!1,this.Sb(b,l,new rt(Math.ceil(E),Math.ceil(R)),o,k,h,c,p,y),this.Bu=!0,x.li)}};g(_,"db",null),g(_,"AL",new Z),g(_,"kM"),g(_,"PM",null),g(_,"RL",w.document!==void 0),g(_,"Qe",new WeakMap),g(_,"Zm",null),g(_,"bb",""),g(_,"None",1),g(_,"Uniform",2),g(_,"UniformToFill",3),g(_,"CycleAll",1),g(_,"CycleNotDirected",2),g(_,"CycleNotDirectedFast",3),g(_,"CycleNotUndirected",4),g(_,"CycleDestinationTree",5),g(_,"CycleSourceTree",6),g(_,"DocumentScroll",1),g(_,"InfiniteScroll",2),g(_,"TreeParentCollapsed",1),g(_,"AllParentsCollapsed",2),g(_,"AnyParentsCollapsed",3),g(_,"XM",new Y),g(_,"OR","3.0.26"),g(_,"img","image"),g(_,"XR",!1),g(_,"Xu",null),g(_,"cA","5da73c80a36555d4038e4972187c3cae51fd22"),g(_,"mw",!1),g(_,"Gk",()=>{if(_.cA[5]===void 0&&(Pt.prototype.$e=Pt.prototype.kw),!_.isUsingDOM())return;const e=u.hs("canvas"),t=e.getContext("2d"),i=u.Ts("7ca11abfd022028846");t[i]=u.Ts("398c3597c01238");const s="7ca11abfd7330390",n=[_.cA,u.mw+"4ae6247590da4bb21c324ba3a84e385776",Pt.Gk+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",O.za],o=10,r=0;for(let a=1;a<5;a++)t[u.Ts(s)](u.Ts(n[a-1]),o,a*15+r);t[i]=u.Ts("39f046ebb36e4b");for(let a=1;a<5;a++)t[u.Ts(s)](u.Ts(n[a-1]),o,a*15+r);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(Pt.prototype.$e=Pt.prototype.kw),_.Xu=e});let zt=_;class tu{constructor(e){g(this,"fA");g(this,"uA");g(this,"$M");g(this,"Ne");if(this.fA=null,this.uA="63ad05bbe23a1786468a4c741b6d2",this.$M="@onz",this.uA===this._tk){this.$M=!0,this.Ne=this.$M;return}this.Ne=null}YR(e,t){let i="f";const s=w[u.Ts("76a715b2f73f148a")][u.Ts("72ba13b5")]||"",n=u.Ts;if(this.Ne=!0,!zt.isUsingDOM())return;let o=zt[n("76a115b6ed251eaf4692")];if(!o){const a=s[n("76ad18b4f73e")];for(let l=s[n("73a612b6fb191d")](n("35e7"))+2;l<a;l++)i+=s[l];const h=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ne=!(h>=0&&h<i[n("73a612b6fb191d")](n("35")));return}const r=zt.XM.iterator;for(;r.next();){o=r.value;const a=n(o).split(n("39e9"));if(a.length<6)return;const h=n(a[1]).split(".");if(a[4]!=="7da71ca0")return;const l=n(u[n("6cae19")]).split(".");if(!(h[0]>l[0]||h[0]===l[0]&&h[1]>=l[1]))continue;const c="73a612b6fb191d",d=w[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),f=d[n(c)](n("3aad1ab6e022098b4dc4")),m=n(a[2]);if(f>-1){const E=d[n(c)](m.toLowerCase()+"/");if(this.Ne=!(E>-1&&E<f),!this.Ne)return}const p=s[n("76ad18b4f73e")];for(let E=s[n(c)](n("35e7"))+2;E<p;E++)i+=s[E];let y=i[n(c)](m);if(y<0&&m!==n("7da71ca0ad381e90")&&(y=i[n(c)](n("76a715b2ef3e149757"))),y<0&&(y=i[n(c)](n("76a715b2ef3e149757"))),y<0&&(y=i[n(c)](n("2bfa41fdb3784bca12"))),y<0&&(y=s[n(c)](n("7baa19a6f76c1988428554"))),y<0&&(y=s[n(c)](n("7ea902b2b9221e9c57c45767196566"))),this.Ne=!(y>=0&&y<i[n(c)](n("35"))||i[n(c)](n("35"))===-1),!this.Ne||s[n(c)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ne=!(s[n(c)](m)>-1),!this.Ne))return;const x=w[u.Ts("76a715b2f73f148a")][u.Ts("69ad17a1e03e")],b=x[n(c)](n("7fb002b6ed25128b4da25b2e"));if(b>-1&&(this.Ne=!(x[n(c)](m)>b),!this.Ne))return;const M=m;if(M[0]!=="#")continue;const P=u.hs("div");let k=a[0].replace(/[A-Za-z]/g,"");for(;k.length<4;)k+="9";const L=k;k=k.substring(k.length-4);let T="";const D=["gsh","gsf"],B=["Header","Background","Display","Feedback"];if(T+=D[parseInt(k.substring(0,1),10)%2],T+=B[parseInt(k.substring(0,1),10)%4],P[n("79a417a0f0181a8946")]=T,w.document[n("78a712aa")]){w.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](P);const E=w.getComputedStyle(P).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),R=w.getComputedStyle(P).getPropertyValue(n("75b817b0ea2202"));if(w.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](P),!E)continue;const F=w[n("77a902b0eb1b1e804a8a")],V="0."+parseInt(L,10)%100;if(R===V||E.indexOf(parseInt(M[1]+M[2],16))!==-1&&E.indexOf(parseInt(M[3]+M[4],16))!==-1){this.Ne=!1;return}else if(F&&F(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){T="."+T;for(let K=0;K<document.styleSheets.length;K++){const H=document.styleSheets[K].rules||document.styleSheets[K].cssRules;for(const W in H)if(T===H[W].selectorText){this.Ne=!1;return}}}}else this.Ne=null,t&&(this.Ne=!1)}}Xu(e){return e.Qt.setTransform(e.Vi,0,0,e.Vi,0,0),e.Qt.commitTransform(),this.Ne===null&&this.YR(e,!0),0<this.Ne&&this!==this.fA}}class ls{constructor(e){g(this,"ZM");g(this,"QM");this.ZM=e===void 0?new C:e,this.QM=new C}get point(){return this.ZM}set point(e){this.ZM=e}get shifted(){return this.QM}set shifted(e){this.QM=e}}class eu{constructor(e,t,i){g(this,"Me");g(this,"qL");g(this,"Nb");this.Me=e,this.qL=t,this.Nb=i}}class Bn{constructor(e){g(this,"isGridSnapEnabled");g(this,"isGridSnapRealtime");g(this,"gridSnapCellSize");g(this,"gridSnapCellSpot");g(this,"gridSnapOrigin");g(this,"dragsLink");g(this,"dragsTree");g(this,"groupsSnapMembers");g(this,"groupsAlwaysMove");g(this,"dragsMembers");this.Ri(),e&&Object.assign(this,e)}Ri(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new rt(NaN,NaN).u(),this.gridSnapCellSpot=U.TopLeft,this.gridSnapOrigin=new C(NaN,NaN).u(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class iu extends zt{constructor(e,t){let i;return e===void 0||typeof e=="string"||w.Element&&e instanceof Element?i=e:u.G(e)&&(t=e),super(i),this.dA(),t&&this.setProperties(t),this}dA(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=U.TopCenter,this.layout=new Kn}setupRouters(){}reset(){super.reset(),this.dA()}}class Vn extends zt{constructor(t,i){let s;t===void 0||typeof t=="string"||w.Element&&t instanceof Element?s=t:u.G(t)&&(i=t);super(s);g(this,"Ab");g(this,"Tb");g(this,"Db");g(this,"Fb");g(this,"a0");g(this,"Kc");g(this,"Al");g(this,"_M");g(this,"t2");g(this,"Rb");g(this,"i2");return this.animationManager.isEnabled=!1,this.Ht=!0,this.Ab=null,this.Ru=!1,this.vu=!1,this.Tb=!0,this.Db=!0,this.Fb=0,this.a0=!1,this.Kc=null,this.setRenderingHint("drawShadows",!1),this.Al=new Ht({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new At({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).Et(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new wt(0,0,0,0),this.at.i(0,0),this.toolManager.Jt("Dragging",new su,this.toolManager.mouseMoveTools),this.click=()=>{const n=this.observed;if(n===null)return;const o=n.viewportBounds,r=this.lastInput.documentPoint;n.position=new C(r.x-o.width/2,r.y-o.height/2)},this._M=n=>{this.invalidateDocumentBounds(),this.c0()},this.t2=n=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.S())},this.Rb=n=>{this.updateDelay<1?this.S():this.a0||(this.a0=!0,u.ir(()=>this.redraw(),this.updateDelay))},this.i2=n=>{this.observed!==null&&this.c0()},this.autoScale=2,this.Ht=!1,i&&Object.assign(this,i),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.a0&&this.updateDelay>=1&&(this.a0=!1,this.GR()),super.redraw()}Ui(){if(this.Mt===null&&u.o("No div specified"),this.ft===null&&u.o("No canvas specified"),this.ft instanceof dn||(this.box.JS(),!this.Ue))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Vh)return;this.e0();const i=this.ft,s=this.Qt;if(s.clearContextCache(!0),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.gA();else if(this.Kc!==null){s.drawImage(this.Kc.Tt,0,0);const r=this.T;s.scale(this.Vi,this.Vi),s.transform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),s.commitTransform()}const n=this.Xt.r,o=n.length;for(let r=0;r<o;r++)n[r].Ui(s,this);this.Ic=!1,this.Ue=!1}GR(){const t=this.ft,i=this.Qt;if(!(t===null||i===null)){if(this.e0(),this.Kc===null){const s=new $i(null);s.width=t.width,s.height=t.height,this.Kc=s}try{this.ft=this.Kc,this.Qt=this.ft.li,this.Qt.clearContextCache(!0),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.clearRect(0,0,this.ft.width,this.ft.height),this.gA()}finally{this.ft=t,this.Qt=i}}}gA(){const t=this.observed;if(t===null)return;const i=this.drawsTemporaryLayers,s=this.drawsGrid&&i,n=t.grid;if(s&&n!==null&&n.visible&&!(isNaN(n.width)||isNaN(n.height))){const d=G.l().a(this.viewportBounds).unionRect(t.viewportBounds);t.th(d),G.e(d),t.Mi()}const o=this.T,r=this.Qt;r.scale(this.Vi,this.Vi),r.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),r.commitTransform();const a=this.viewportBounds,h=t.Xt.r,l=h.length,c=this.Xt.r;this.ps(c,c.length,this,this.viewportBounds);for(let d=0;d<l;d++)h[d].KF(r,a,this,i,s)}get observed(){return this.Ab}set observed(t){const i=this.Ab;if(t instanceof Vn&&u.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(i!==null&&this.KR(i),this.Ab=t,t!==null&&this.jR(t),this.invalidateDocumentBounds(),t===null){this.Kc=null;const s=this.ft,n=this.Qt;s&&n&&(n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,s.width,s.height))}else this.Rb(null),this.c0(),this.S();this.t("observed",i,t)}}get box(){return this.Al}set box(t){const i=this.Al;i!==t&&(t.Et(),this.Al=t,this.remove(i),this.add(this.Al),this.c0(),this.t("box",i,t))}get drawsTemporaryLayers(){return this.Tb}set drawsTemporaryLayers(t){this.Tb!==t&&(this.Tb=t,this.redraw())}get drawsGrid(){return this.Db}set drawsGrid(t){this.Db!==t&&(this.Db=t,this.redraw())}get updateDelay(){return this.Fb}set updateDelay(t){t<0&&(t=0),this.Fb!==t&&(this.Fb=t)}jR(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this._M),t.addDiagramListener("DocumentBoundsChanged",this.t2),t.addDiagramListener("InvalidateDraw",this.Rb),t.addDiagramListener("AnimationFinished",this.i2),this.add(this.box))}KR(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this._M),t.removeDiagramListener("DocumentBoundsChanged",this.t2),t.removeDiagramListener("InvalidateDraw",this.Rb),t.removeDiagramListener("AnimationFinished",this.i2))}c0(){const t=this.box,i=this.observed;if(i===null)return;this.Ue=!0;const s=i.viewportBounds,n=t.selectionObject,o=rt.l();o.i(s.width,s.height),n.desiredSize=o,rt.e(o);const r=2/this.scale;n instanceof At&&(n.strokeWidth=r),t.location=new C(s.x-r/2,s.y-r/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return G.Fg;const i=t.documentBounds.copy();return i.unionRect(t.viewportBounds),i}invalidateViewport(t,i){this.Ue!==!0&&(this.Ue=!0,this.requestUpdate())}onViewportBoundsChanged(t,i,s,n){this.Ht||(this._l(),this.S(),this.aa(),this.invalidateDocumentBounds(),this.c0(),this.Bi.scale=s,this.Bi.position.x=t.x,this.Bi.position.y=t.y,this.Bi.bounds.a(t),this.Bi.isScroll=n,this.D("ViewportBoundsChanged",this.Bi,t))}}class su extends Ne{constructor(){super();g(this,"eh");this.eh=null}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const i=t.observed;if(i===null)return!1;const s=t.lastInput;if(!s.left||t.currentTool!==this&&(!this.isBeyondDragSize()||s.isTouchEvent&&s.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=i.viewportBounds;this.eh=new C(n.width/2,n.height/2);const o=t.firstInput.documentPoint;i.position=new C(o.x-this.eh.x,o.y-this.eh.y)}return!0}doActivate(){this.eh=null,super.doActivate()}doUpdateCursor(t){const i=this.diagram,s=i.box;s!==null&&s.cursor&&(i.currentCursor=s.cursor)}moveParts(t,i,s){const n=this.diagram,o=n.observed;if(o===null)return;const r=n.box;if(r===null)return;if(this.eh===null){const h=n.firstInput.documentPoint,l=r.location;this.eh=new C(h.x-l.x,h.y-l.y)}const a=n.lastInput.documentPoint;o.position=new C(a.x-this.eh.x,a.y-this.eh.y)}}class ei{constructor(e){g(this,"N");g(this,"e2");g(this,"s2");g(this,"o2");g(this,"l2");g(this,"h2");g(this,"a2");g(this,"c2");g(this,"f2");g(this,"nh");g(this,"u2");g(this,"vb");g(this,"Ob");g(this,"Ib");g(this,"Eb");g(this,"d2");g(this,"Ro");g(this,"g2");I.Ki(this),this.N=zt.um(),this.e2=!0,this.s2=!0,this.o2=!0,this.l2=!1,this.h2=!1,this.a2=!1,this.c2=!1,this.f2=null,this.nh=null,this.u2=1.05,this.vb=NaN,this.Ob=null,this.Ib=NaN,this.Eb=G.Fg,this.d2=!1,this.Ro=null,this.g2=200,e&&Object.assign(this,e)}toString(){return"CommandHandler"}get diagram(){return this.N}Mo(e){this.N=e}doStart(){}doStop(){}doKeyDown(){const e=this.diagram,t=e.lastInput,i=u.tr?t.meta:t.control,s=t.shift,n=t.alt,o=t.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||i&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():o==="ArrowUp"?e.allowVerticalScroll&&(i?e.scroll("pixel","up"):e.scroll("line","up")):o==="ArrowDown"?e.allowVerticalScroll&&(i?e.scroll("pixel","down"):e.scroll("line","down")):o==="ArrowLeft"?e.allowHorizontalScroll&&(i?e.scroll("pixel","left"):e.scroll("line","left")):o==="ArrowRight"?e.allowHorizontalScroll&&(i?e.scroll("pixel","right"):e.scroll("line","right")):o==="PageUp"?s&&e.allowHorizontalScroll?e.scroll("page","left"):e.allowVerticalScroll&&e.scroll("page","up"):o==="PageDown"?s&&e.allowHorizontalScroll?e.scroll("page","right"):e.allowVerticalScroll&&e.scroll("page","down"):o==="Home"?i&&e.allowVerticalScroll?e.scroll("document","up"):!i&&e.allowHorizontalScroll&&e.scroll("document","left"):o==="End"?i&&e.allowVerticalScroll?e.scroll("document","down"):!i&&e.allowHorizontalScroll&&e.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||i&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():t.bubbles=!0}doKeyUp(){const e=this.diagram.lastInput;e.bubbles=!0}stopCommand(){const e=this.diagram,t=e.currentTool;t instanceof Pe&&e.allowSelect&&e.clearSelection(),t!==null&&t.doCancel()}canStopCommand(){return!0}selectAll(){const e=this.diagram;e.S();try{e.currentCursor="wait",e.D("ChangingSelection",e.selection);const t=e.parts;for(;t.next();){const n=t.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=e.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=e.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{e.D("ChangedSelection",e.selection),e.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){const e=this.diagram;try{e.currentCursor="wait",e.D("ChangingSelection",e.selection),e.startTransaction("Delete"),e.D("SelectionDeleting",e.selection);const t=new I,i=e.selection.iterator;for(;i.next();){const s=i.value;Ht.oh(t,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}e.removeParts(t,!0),e.D("SelectionDeleted",t)}finally{e.commitTransaction("Delete"),e.D("ChangedSelection",e.selection),e.currentCursor=""}}canDeleteSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||e.selection.count===0)}copySelection(){const e=this.diagram;try{const t=new I,i=e.selection.iterator;for(;i.next();){const s=i.value;Ht.oh(t,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(t)}finally{}}canCopySelection(){const e=this.diagram;return!(!e.allowCopy||!e.allowClipboard||e.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowCopy||!e.allowDelete||!e.allowClipboard||e.selection.count===0)}copyToClipboard(e){const t=this.diagram;let i=null;if(e===null)zt.vL();else{let s=null;try{s=t.copyParts(e,null,!0)}finally{i=new Y,s!==null&&i.addAll(s.iteratorValues),zt.Zm=i,zt.bb=t.model.dataFormat}}t.D("ClipboardChanged",i)}pasteFromClipboard(){const e=new I,t=zt.Zm;if(t===null)return e;const i=this.diagram;if(zt.bb!==i.model.dataFormat)return e;let s=null;try{s=i.copyParts(t,i,!1)}finally{if(s!==null){const n=s.iterator;for(;n.next();){const o=n.value,r=n.key;o.location.isReal()||(r.location.isReal()?o.location=r.location:!o.position.isReal()&&r.position.isReal()&&(o.position=r.position)),e.add(o)}}}return e}pasteSelection(e){e===void 0&&(e=null);const t=this.diagram;try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),t.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&t.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(e!==null){const n=t.computePartsBounds(t.selection);if(n.isReal()){const o=this.computeEffectiveCollection(t.selection,t.yb);t.TP(o,new C(e.x-n.centerX,e.y-n.centerY),t.yb,!1)}}t.D("ClipboardPasted",i)}finally{t.commitTransaction("Paste"),t.D("ChangedSelection",t.selection),t.currentCursor=""}}canPasteSelection(e){const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowClipboard||zt.Zm===null||zt.Zm.count===0||zt.bb!==t.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){const e=this.diagram;return e.isReadOnly||e.isModelReadOnly?!1:e.allowUndo&&e.undoManager.canRedo()}decreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canDecreaseZoom(e){e===void 0&&(e=1/this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}increaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return;const i=t.scale*e;i<t.minScale||i>t.maxScale||(t.scale=i)}canIncreaseZoom(e){e===void 0&&(e=this.zoomFactor);const t=this.diagram;if(t.autoScale!==1)return!1;const i=t.scale*e;return i<t.minScale||i>t.maxScale?!1:t.allowZoom}resetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;e<t.minScale||e>t.maxScale||(t.scale=e)}canResetZoom(e){e===void 0&&(e=this.defaultScale);const t=this.diagram;return e<t.minScale||e>t.maxScale?!1:t.allowZoom}zoomToFit(){const e=this.diagram,t=e.animationManager;t.stopAnimation(),e.redraw();const i=e.position,s=e.scale;t.Fl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.Ib&&!isNaN(this.vb)&&this.Ob!==null&&e.documentBounds.equals(this.Eb)?(e.scale=this.vb,e.position=this.Ob,this.Ib=NaN,this.Eb=G.Fg):(this.vb=s,this.Ob=i.copy(),e.zoomToFit(),this.Ib=e.scale,this.Eb=e.documentBounds.copy()),t.OS()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(e){e===void 0&&(e=null);const t=this.diagram;if(t.ensureBounds(),e===null){try{this.Ro!==null&&(this.Ro.next()?e=this.Ro.value:this.Ro=null)}catch{this.Ro=null}e===null&&(t.highlighteds.count>0?this.Ro=t.highlighteds.iterator:t.selection.count>0&&(this.Ro=t.selection.iterator),this.Ro!==null&&this.Ro.next()&&(e=this.Ro.value))}if(e!==null){const i=t.animationManager;i.Fl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.jc(e,[e]);if(n.length===1)t.startTransaction(),t.centerRect(e.actualBounds),t.commitTransaction("Scroll To Part");else{const o=()=>{t.startTransaction();let a=n.pop();for(;n.length>0&&a instanceof gt&&a.isTreeExpanded&&(!(a instanceof Nt)||a.isSubGraphExpanded);)a=n.pop();n.length>0?(a instanceof Ht&&t.scrollToRect(a.actualBounds),a instanceof gt&&!a.isTreeExpanded&&(a.isTreeExpanded=!0),a instanceof Nt&&!a.isSubGraphExpanded&&(a.isSubGraphExpanded=!0)):(a instanceof Ht&&t.centerRect(a.actualBounds),t.removeDiagramListener("LayoutCompleted",r)),t.commitTransaction("Scroll To Part")},r=()=>{u.ir(o,(i.isEnabled?i.duration:0)+s)};t.addDiagramListener("LayoutCompleted",r),o()}}else{const n=t.position.copy();t.centerRect(e.actualBounds),n.equalsApprox(t.position)&&i.stopAnimation()}}}jc(e,t){if(e.isVisible())return t;if(e instanceof Ft){const i=e.adornedPart;i!==null&&this.jc(i,t)}else if(e instanceof St){const i=e.fromNode;i!==null&&this.jc(i,t);const s=e.toNode;s!==null&&this.jc(s,t)}else{if(e instanceof gt){const s=e.labeledLink;s!==null&&this.jc(s,t);const n=e.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&t.push(n),this.jc(n,t))}const i=e.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&t.push(i),this.jc(i,t))}return t}canScrollToPart(e){if(e===void 0&&(e=null),e!==null&&!(e instanceof Ht))return!1;const t=this.diagram;return t.selection.count===0&&t.highlighteds.count===0?!1:t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new Y;if(e!==null&&e.isTreeExpanded)e.collapseTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof gt&&o.isTreeExpanded&&(o.collapseTree(),s.add(o))}}t.D("TreeCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof gt)||!e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof gt){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(e){e===void 0&&(e=null);const t=this.diagram,i="Expand Tree";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new Y;if(e!==null&&!e.isTreeExpanded)e.expandTree(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof gt&&(o.isTreeExpanded||(o.expandTree(),s.add(o)))}}t.D("TreeExpanded",s)}finally{t.commitTransaction(i)}}canExpandTree(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null){if(!(e instanceof gt)||e.isTreeExpanded)return!1;if(e.findTreeChildrenLinks().count>0)return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof gt){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const e=this.diagram,t=e.model;if(!t.Hc())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{e.currentCursor="wait",e.D("ChangingSelection",e.selection),e.startTransaction("Group");const n=new Y,o=e.selection.iterator;for(;o.next();){const l=o.value;l.ke()&&l.canGroup()&&n.add(l)}const r=new Y,a=n.iterator;for(;a.next();){const l=a.value;let c=!1;const d=n.iterator;for(;d.next();){const f=d.value;if(l.isMemberOf(f)){c=!0;break}}c||r.add(l)}const h=r.first();if(h!==null){let l=h.containingGroup;if(l!==null)for(;l!==null;){let c=!1;const d=r.iterator;for(;d.next();)if(!d.value.isMemberOf(l)){c=!0;break}if(c)l=l.containingGroup;else break}if(i instanceof Nt)i.Et(),s=i.copy(),s!==null&&e.add(s);else if(t.isGroupForData(i)){const c=t.copyNodeData(i);u.G(c)&&(t.addNodeData(c),s=e.findNodeForData(c))}if(s!==null){l!==null&&this.isValidMember(l,s)&&(s.containingGroup=l);const c=r.iterator;for(;c.next();){const d=c.value;this.isValidMember(s,d)&&(d.containingGroup=s)}e.clearSelection(!0),s.isSelected=!0}}e.D("SelectionGrouped",s)}finally{e.commitTransaction("Group"),e.D("ChangedSelection",e.selection),e.currentCursor=""}}canGroupSelection(){const e=this.diagram;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowGroup||!e.model.Hc()||this.archetypeGroupData===null)return!1;const t=e.selection.iterator;for(;t.next();){const i=t.value;if(i.ke()&&i.canGroup())return!0}return!1}m2(e){const t=u.et();if(Array.isArray(e))e.forEach(n=>{n instanceof St||n instanceof Ht&&t.push(n)});else{const n=e.iterator;for(;n.next();){const o=n.value;o instanceof St||o instanceof Ht&&t.push(o)}}const i=new I,s=t.length;for(let n=0;n<s;n++){const o=t[n];let r=!0;for(let a=0;a<s;a++)if(o.isMemberOf(t[a])){r=!1;break}r&&i.add(o)}return u.J(t),i}isValidMember(e,t){if(t===null||e===t||t instanceof St)return!1;let i;return e!==null&&(e===t||e.isMemberOf(t)||(i=e.memberValidation,i!==null&&!i(e,t))||e.data===null&&t.data!==null||e.data!==null&&t.data===null)?!1:(i=this.memberValidation,i!==null?i(e,t):!0)}ungroupSelection(e){e===void 0&&(e=null);const t=this.diagram,i=t.model;if(i.Hc())try{t.currentCursor="wait",t.D("ChangingSelection",t.selection),t.startTransaction("Ungroup");const s=new Y;if(e!==null)s.add(e);else{const o=t.selection.iterator;for(;o.next();){const r=o.value;r instanceof Nt&&r.canUngroup()&&s.add(r)}}const n=new Y;if(s.count>0){t.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const a=r.containingGroup,h=a!==null&&a.data!==null?i.getKeyForNodeData(a.data):void 0;n.addAll(r.memberParts);const l=n.iterator;for(;l.next();){const c=l.value;if(c.isSelected=!0,c instanceof St)continue;const d=c.data;d!==null?i.setGroupForData(d,h):c.containingGroup=a}t.remove(r)}}t.D("SelectionUngrouped",s,n)}finally{t.commitTransaction("Ungroup"),t.D("ChangedSelection",t.selection),t.currentCursor=""}}canUngroupSelection(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||!t.allowUngroup||!t.model.Hc())return!1;if(e!==null){if(!(e instanceof Nt))return!1;if(e.canUngroup())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Nt&&s.canUngroup())return!0}}return!1}addTopLevelParts(e,t){const i=this.m2(e);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!t||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Collapse SubGraph";try{t.startTransaction(i),t.animationManager.Fl(i);const s=new Y;if(e!==null&&e.isSubGraphExpanded)e.collapseSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof Nt&&o.isSubGraphExpanded&&(o.collapseSubGraph(),s.add(o))}}t.D("SubGraphCollapsed",s)}finally{t.commitTransaction(i)}}canCollapseSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof Nt)||!e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Nt&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(e){e===void 0&&(e=null);const t=this.diagram,i="Expand SubGraph",s=new Y;try{if(t.startTransaction(i),t.animationManager.Fl(i),e!==null&&!e.isSubGraphExpanded)e.expandSubGraph(),s.add(e);else if(e===null){const n=t.selection.iterator;for(;n.next();){const o=n.value;o instanceof Nt&&(o.isSubGraphExpanded||(o.expandSubGraph(),s.add(o)))}}t.D("SubGraphExpanded",s)}finally{for(const n of s)this.mA(t,n);e&&this.mA(t,e),t.commitTransaction(i)}}mA(e,t){for(const i of t.memberParts)i instanceof gt&&e.Cc(i,t)}canExpandSubGraph(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly)return!1;if(e!==null)return!(!(e instanceof Nt)||e.isSubGraphExpanded);{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Nt&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){e===void 0&&(e=null);const t=this.diagram,i=t.toolManager.findTool("TextEditing");if(i!==null){if(e===null){let s=null;const n=t.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;e=s.findInVisualTree(o=>o instanceof ae&&o.editable)}e!==null&&(t.currentTool=null,i.textBlock=e,t.currentTool=i)}}canEditTextBlock(e){e===void 0&&(e=null);const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowTextEdit||t.toolManager.findTool("TextEditing")===null)return!1;if(e!==null){if(!(e instanceof ae))return!1;const i=e.part;if(i!==null&&i.canEdit())return!0}else{const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(e=s.findInVisualTree(n=>n instanceof ae&&n.editable),e!==null))return!0}}return!1}showContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");if(i===null)return;e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t);const s=i.findObjectWithContextMenu(e);if(s!==null){const n=t.lastInput;let o=null;if(s instanceof Xt)o=s.getDocumentPoint(U.Center);else if(!t.viewportBounds.containsPoint(n.documentPoint)){const r=t.viewportBounds;o=new C(r.x+r.width/2,r.y+r.height/2)}if(o!==null){const r=new de;r.diagram=t,r.viewPoint=t.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,t.lastInput=r}t.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(e){const t=this.diagram,i=t.toolManager.findTool("ContextMenu");return!(i===null||(e===void 0&&(e=null),e===null&&(t.selection.count>0?e=t.selection.first():e=t),i.findObjectWithContextMenu(e)===null))}get copiesClipboardData(){return this.e2}set copiesClipboardData(e){u.s(e,"boolean",ei,"copiesClipboardData"),this.e2=e}get copiesConnectedLinks(){return this.s2}set copiesConnectedLinks(e){u.s(e,"boolean",ei,"copiesConnectedLinks"),this.s2=e}get deletesConnectedLinks(){return this.o2}set deletesConnectedLinks(e){u.s(e,"boolean",ei,"deletesConnectedLinks"),this.o2=e}get copiesTree(){return this.l2}set copiesTree(e){u.s(e,"boolean",ei,"copiesTree"),this.l2=e}get deletesTree(){return this.h2}set deletesTree(e){u.s(e,"boolean",ei,"deletesTree"),this.h2=e}get copiesParentKey(){return this.a2}set copiesParentKey(e){u.s(e,"boolean",ei,"copiesParentKey"),this.a2=e}get copiesGroupKey(){return this.c2}set copiesGroupKey(e){u.s(e,"boolean",ei,"copiesGroupKey"),this.c2=e}get archetypeGroupData(){return this.f2}set archetypeGroupData(e){e!==null&&u.ec(e,ei,"archetypeGroupData"),this.diagram,this.f2=e}get memberValidation(){return this.nh}set memberValidation(e){e!==null&&u.k(e,ei,"memberValidation"),this.nh=e}get defaultScale(){return this.diagram.defaultScale}set defaultScale(e){this.diagram.defaultScale=e}get zoomFactor(){return this.u2}set zoomFactor(e){e>1||u.o("zoomFactor must be larger than 1.0, not: "+e),this.u2=e}get isZoomToFitRestoreEnabled(){return this.d2}set isZoomToFitRestoreEnabled(e){u.s(e,"boolean",ei,"isZoomToFitRestoreEnabled"),this.d2=e}get scrollToPartPause(){return this.g2}set scrollToPartPause(e){this.g2=e}computeEffectiveCollection(e,t){const i=this.diagram,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;t===void 0&&(t=i.o0());const o=new Z;if(e===null)return o;let r=e.iterator;for(;r.next();){const a=r.value;i.Kr(o,a,n,t)}if(i.draggedLink!==null&&t.dragsLink)return o;for(r=e.iterator;r.next();){const a=r.value;if(a instanceof St){const h=a.fromNode;if(h!==null&&!o.has(h))o.delete(a);else{const l=a.toNode;l!==null&&!o.has(l)&&o.delete(a)}}}return o}}var Co=(S=>(S[S.None=0]="None",S[S.Default=1]="Default",S[S.Vertical=4]="Vertical",S[S.Horizontal=5]="Horizontal",S[S.Fill=2]="Fill",S))(Co||{}),To=(S=>(S[S.None=0]="None",S[S.Along=21]="Along",S[S.Plus90=22]="Plus90",S[S.Minus90=23]="Minus90",S[S.Opposite=24]="Opposite",S[S.Upright=25]="Upright",S[S.Plus90Upright=26]="Plus90Upright",S[S.Minus90Upright=27]="Minus90Upright",S[S.Upright45=28]="Upright45",S))(To||{}),la=(S=>(S[S.None=0]="None",S[S.Vertical=1]="Vertical",S[S.Horizontal=2]="Horizontal",S[S.Both=3]="Both",S))(la||{});const Vt=class Vt{constructor(){g(this,"n");g(this,"f0");g(this,"u0");g(this,"Hr");g(this,"p");g(this,"lh");g(this,"ct");g(this,"at");g(this,"se");g(this,"$t");g(this,"d0");g(this,"Vs");g(this,"Lt");g(this,"is");g(this,"qr");g(this,"hh");g(this,"wi");g(this,"da");g(this,"tt");g(this,"Yt");g(this,"Wr");g(this,"Ni");g(this,"zi");g(this,"Ku");g(this,"hi");g(this,"ju");g(this,"Ot");g(this,"si");g(this,"Jr");g(this,"Ub");g(this,"ah");g(this,"Hu");I.Ki(this),this.n=30723,this.$t=1,this.d0="",this.Vs=null,this.Lt=null,this.at=new C(NaN,NaN).u(),this.is=rt.ww,this.qr=new Pt,this.hh=new Pt,this.wi=null,this.da=1,this.tt=1,this.Yt=0,this.Wr=wt.Rg,this.se=new G(NaN,NaN,NaN,NaN).u(),this.Ni=new G(NaN,NaN,NaN,NaN).u(),this.zi=new G(0,0,NaN,NaN).u(),this.Ku=null,this.f0=null,this.ct=null,this.hi=U.Default,this.ju=U.Default,this.u0=0,this.Hr=0,this.Ot=null,this.p=null,this.lh=null,this.si=null,this.Ub=null,this.ah=null,this.Jr=null,this.Hu=null}cloneProtected(e){e.n=(this.n|2048|4096)&-32769,e.$t=this.$t,e.d0=this.d0,e.Lt=this.Lt,e.at.a(this.at),e.is=this.is.P(),this.wi!==null?e.wi=this.wi.copy():e.wi=null,e.tt=this.tt,e.Yt=this.Yt,e.Wr=this.Wr.P(),e.se.a(this.se),e.Ni.a(this.Ni),e.zi.a(this.zi),e.f0=this.f0,this.ct!==null&&(e.ct=this.ct.copy()),e.hi=this.hi.P(),e.ju=this.ju.P(),e.u0=this.u0,e.Hr=this.Hr,this.Ot!==null&&(e.Ot=this.Ot.copy()),this.p!==null&&(this.p.fi?e.p=this.p:e.p=this.p.copy()),this.lh!==null&&(e.lh=this.lh.slice()),this.si!==null&&(e.si=this.si.copy())}addCopyProperty(e){let t=this.lh;if(!Array.isArray(t))t=[],this.lh=t;else for(let i=0;i<t.length;i++)if(t[i]===e)return;t.push(e)}vo(e){e.Ku=null,e.Jr=null,e.c()}clone(){const e=new this.constructor;if(this.cloneProtected(e),this.lh!==null)for(let t=0;t<this.lh.length;t++){const i=this.lh[t];e[i]=this[i]}return e}copy(){return this.clone()}rS(){const e=this.Ci;if(e!==null){this.Ci=null;for(const t of e)t.qu()&&(t.isToData?this.themeData(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):t.isToObject?this.themeObject(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter,t.sourceName):t.isToModel?this.themeModel(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter):this.theme(t.targetProperty,t.sourceProperty,t.themeSource,t.converter,t.themeConverter))}return this}oi(e){e in To?this.segmentOrientation=e:e in Co?this.stretch=e:u.er(this,e)}toString(){return u.Dn(this.constructor)+"#"+I.as(this)}ch(){this.p!==null&&(this.p.fi=!0)}Kt(){return this.p===null?this.p=new us:this.p.fi&&(this.p=this.p.copy()),this.p}Be(){if(this.ct===null){const e=new jn;e.ga=U.None,e.ma=U.None,e.pa=10,e.ya=10,e.wa=0,e.xa=0,this.ct=e}return this.ct}raiseChangedEvent(e,t,i,s,n,o,r){const a=this.part;if(a!==null){a.qc(e,t,i,s,n,o,r),i===this&&e===2&&this.Wc()&&this.ba(a,t);const h=this.diagram;if(this.ws!==null&&h!==null&&h.Vh&&!h.undoManager.isUndoingRedoing&&!h.animationManager.pu){const l=this.ws.get(t);if(l!==null&&h.animationManager.isEnabled&&!h.animationManager.isTicking){this.Hu===null&&(this.Hu=new Z);let c=h.undoManager.transactionLevel===0;if(l.startCondition===2?c=!0:l.startCondition===3&&(c=!1),c){const d=new Ii;l.XF(d);const f=this.Hu.get(l);f!==null&&f.stop(),this.Hu.set(l,d),d.mx=this,d.XS=l,d.add(this,t,s,n),d.start()}else h.animationManager.getBundleAnimation().add(this,t,s,n)}}if(this instanceof bt&&i===a&&a.p2()&&a.data!==null){const l=this.C.r,c=l.length;for(let d=0;d<c;d++){const f=l[d];f instanceof bt&&f.Gr(m=>{m.data!==null&&m.p2()&&m.updateTargetBindings(t)})}}}}UF(e){this.Hu.delete(e)}Do(){if(this.diagram!==null&&this.findBindingPanel()===null&&this.Ci!==null){const e=this.diagram.model,t=this.Ci.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;let s=null;const n=i.sourceName;i.isToObject&&(s=this.pA(n));let o=this;const r=i.targetId;r!==-1&&(o=this.g0(r),o===null)||(n==="/"?s=o.part:n==="."?s=o:n===".."&&(s=o.panel),i.updateTarget(o,s,void 0,e))}}}ba(e,t){const i=this.findBindingPanel();if(i!==null){const s=e.diagram,n=this.Ci.iterator;for(;n.next();){const o=n.value;let r=null;if(o.isToObject){if(r=o.yA(i,this),r===null)continue;o.updateSource(this,r,t,null)}else if(o.isToModel)s!==null&&!s.fe&&o.updateSource(this,s.model.modelData,t,i);else if(!o.isToTheme){const a=i.data;if(a===null)continue;s!==null&&!s.fe&&o.updateSource(this,a,t,i)}if(r===this){const a=o.targetId,h=i.g0(a);h!==null&&o.updateTarget(h,r,t,s==null?void 0:s.model)}}}}g0(e){return this.Hn===e?this:null}pA(e){let t;return e===""?t=this:e==="/"?t=this:e==="."?t=this:e===".."?t=this:t=this.part.findObject(e),t}get Hn(){return this.p!==null?this.p.Hn:-1}set Hn(e){this.Hn!==e&&(this.p===null&&(this.p=new us),this.p.Hn=e)}get Ci(){return this.p!==null?this.p.Ci:null}set Ci(e){this.Ci!==e&&(this.p===null&&(this.p=new us),this.p.Ci=e)}get qn(){return this.p!==null?this.p.qn:null}set qn(e){this.qn!==e&&(this.p===null&&(this.p=new us),this.p.qn=e)}raiseChanged(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}t(e,t,i){this.raiseChangedEvent(2,e,this,t,i)}Wn(e,t,i,s){const n=this.se;if(n.i(e,t,i,s),this.tt!==1||this.Yt!==0){this.wi===null&&(this.wi=new Pt);const o=this.wi;o.Ri(),this.m0(o,e,t,i,s),o.vg(n)}}wA(e,t,i){return this.pickable===!1?!1:(i.nc(this.T),t?this.intersectsRect(e,i):this.containedInRect(e,i))}xA(e,t,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=e.distanceSquaredPoint(t);return i?C.distanceLineSegmentSquared(e.x,e.y,0,0,0,s.height)<=n||C.distanceLineSegmentSquared(e.x,e.y,0,s.height,s.width,s.height)<=n||C.distanceLineSegmentSquared(e.x,e.y,s.width,s.height,s.width,0)<=n||C.distanceLineSegmentSquared(e.x,e.y,s.width,0,0,0)<=n:e.distanceSquared(0,0)<=n&&e.distanceSquared(0,s.height)<=n&&e.distanceSquared(s.width,0)<=n&&e.distanceSquared(s.width,s.height)<=n}an(){return!0}containsPoint(e){const t=C.l();t.a(e),this.T.gt(t);const i=this.actualBounds;if(!i.isReal())return C.e(t),!1;const s=this.diagram;if(s!==null&&s.Hm){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),a=r/2,h=this.naturalBounds,l=this.getDocumentScale()*s.scale,c=1/l;if(h.width*l<o&&h.height*l<o){const d=G.contains(i.x-a*c,i.y-a*c,i.width+r*c,i.height+r*c,t.x,t.y);return C.e(t),d}}let n=!1;return(this instanceof Ft||this instanceof At?G.contains(i.x-5,i.y-5,i.width+10,i.height+10,t.x,t.y):i.containsPoint(t))&&(this.si&&!this.si.containsPoint(t)?n=!1:this.Lt!==null&&this.zi.containsPoint(e)?n=!0:n=this.fh(e)),C.e(t),n}fh(e){const t=this.naturalBounds;return G.contains(0,0,t.width,t.height,e.x,e.y)}containsRect(e){if(this.angle===0)return this.actualBounds.containsRect(e);const t=this.naturalBounds,i=G.V(0,0,t.width,t.height),s=this.T;let n=!1;const o=C.V(e.x,e.y);return i.containsPoint(s.$e(o))&&(o.i(e.x,e.bottom),i.containsPoint(s.$e(o))&&(o.i(e.right,e.bottom),i.containsPoint(s.$e(o))&&(o.i(e.right,e.y),i.containsPoint(s.$e(o))&&(n=!0)))),C.e(o),G.e(i),n}containedInRect(e,t){if(t===void 0)return e.containsRect(this.actualBounds);const i=this.naturalBounds,s=t;let n=!1;const o=C.V(0,0);return e.containsPoint(s.gt(o))&&(o.i(0,i.height),e.containsPoint(s.gt(o))&&(o.i(i.width,i.height),e.containsPoint(s.gt(o))&&(o.i(i.width,0),e.containsPoint(s.gt(o))&&(n=!0)))),C.e(o),n}intersectsRect(e,t){if(t===void 0&&(t=this.T,this.angle===0))return e.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=t,n=C.V(0,0),o=C.V(0,i.height),r=C.V(i.width,i.height),a=C.V(i.width,0);let h=!1;if(e.containsPoint(s.gt(n))||e.containsPoint(s.gt(o))||e.containsPoint(s.gt(r))||e.containsPoint(s.gt(a)))h=!0;else{const l=G.V(0,0,i.width,i.height),c=C.V(e.x,e.y);l.containsPoint(s.$e(c))?h=!0:(c.i(e.x,e.bottom),l.containsPoint(s.$e(c))?h=!0:(c.i(e.right,e.bottom),l.containsPoint(s.$e(c))?h=!0:(c.i(e.right,e.y),l.containsPoint(s.$e(c))&&(h=!0)))),C.e(c),G.e(l),h||(O.Mw(e,n,o)||O.Mw(e,o,r)||O.Mw(e,r,a)||O.Mw(e,a,n))&&(h=!0)}return C.e(n),C.e(o),C.e(r),C.e(a),h}getDocumentPoint(e,t){if(t===void 0&&(t=new C),e instanceof U){const i=e,s=this.naturalBounds;return t.i(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Us.gt(t),t}else return t.set(e),this.Us.gt(t),t}getDocumentBounds(e){e===void 0&&(e=new G);const t=this.naturalBounds,i=this.Us,s=C.V(0,0).T(i);return e.i(s.x,s.y,0,0),s.i(t.width,0).T(i),e.unionNoCheck(s.x,s.y,0,0),s.i(t.width,t.height).T(i),e.unionNoCheck(s.x,s.y,0,0),s.i(0,t.height).T(i),e.unionNoCheck(s.x,s.y,0,0),C.e(s),e}getDocumentAngle(){return this.Us.ZD()}getDocumentScale(){if(this.p0()===!1)return this.da;const e=this.tt;return this.panel!==null?e*this.panel.getDocumentScale():e}getLocalPoint(e,t){return t===void 0&&(t=new C),t.a(e),this.Us.$e(t),t}getNearestIntersectionPoint(e,t,i){return this.Jc(e.x,e.y,t.x,t.y,i)}Jc(e,t,i,s,n){const o=this.T,r=1/(o.m11*o.m22-o.m12*o.m21),a=o.m22*r,h=-o.m12*r,l=-o.m21*r,c=o.m11*r,d=r*(o.m21*o.dy-o.m22*o.dx),f=r*(o.m12*o.dx-o.m11*o.dy),m=e*a+t*l+d,p=e*h+t*c+f,y=i*a+s*l+d,x=i*h+s*c+f;n.i(0,0);const b=this.naturalBounds,M=O.gl(0,0,b.width,b.height,m,p,y,x,n);return n.T(o),M}ht(e,t,i,s){if(this.To()===!1)return;const n=this.Wr,o=n.right+n.left,r=n.top+n.bottom;e=Math.max(e-o,0),t=Math.max(t-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const a=this.angle;let h=0;const l=this.desiredSize,c=this.y0();a===90||a===270?(e=isFinite(l.height)?l.height+c:e,t=isFinite(l.width)?l.width+c:t):(e=isFinite(l.width)?l.width+c:e,t=isFinite(l.height)?l.height+c:t);let d=i||0,f=s||0;const m=this instanceof bt;switch(this.zs(!0)){case 0:d=0,f=0,m&&(e=1/0,t=1/0);break;case 2:isFinite(e)&&e>i&&(d=e),isFinite(t)&&t>s&&(f=t);break;case 5:isFinite(e)&&e>i&&(d=e),f=0,m&&(t=1/0);break;case 4:isFinite(t)&&t>s&&(f=t),d=0,m&&(e=1/0);break}const p=this.maxSize,y=this.minSize;d>p.width&&y.width<p.width&&(d=p.width),f>p.height&&y.height<p.height&&(f=p.height),i=Math.max(d,y.width),s=Math.max(f,y.height),p.width<i&&(i=Math.min(y.width,i)),p.height<s&&(s=Math.min(y.height,s)),e=Math.min(p.width,e),t=Math.min(p.height,t),e=Math.max(i,e),t=Math.max(s,t),(a===90||a===270)&&(h=e,e=t,t=h,h=i,i=s,s=h),this.se.Pt(),this.Wu(e,t,i,s),this.se.u(),this.se.isReal()||u.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.se.toString()),this.ue(!1)}Wu(e,t,i,s){}Xs(){return!1}Bt(e,t,i,s,n){this.$c();const o=G.l();o.a(this.Ni),this.Ni.Pt(),this._e()===!1?this.Ni.i(e,t,i,s):this.uh(e,t,i,s),this.Ni.u(),n===void 0?this.si=null:this.si=n;let r=!1;if(n!==void 0)r=!0;else{let a=this.panel;if(a!==null&&a.$r()&&(a=a.panel),a!==null){const h=a.zi,l=this.measuredBounds,c=t+l.height,d=e+l.width;if(r=!(0<=e+.05&&d<=h.width+.05&&0<=t+.05&&c<=h.height+.05),this instanceof ae){const f=this.naturalBounds;(this.w0>f.height||this.ui>f.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.Ni.isReal()||u.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Ni.toString()),this.Ju(o,this.Ni),this.Jn(!1),G.e(o)}uh(e,t,i,s){}commonArrange(e,t,i,s){if(this.Ni.i(e,t,i,s),this.desiredSize.isReal())return;const n=this.se,o=this.Wr,r=o.right+o.left,a=o.top+o.bottom,h=n.width+r,l=n.height+a;i+=r,s+=a;let c=this.zs(!0);switch(h===i&&l===s&&(c=0),c){case 0:(h>i||l>s)&&(this.ue(!0),this.ht(h>i?i:h,l>s?s:l,0,0));break;case 2:this.ue(!0),this.ht(i,s,0,0);break;case 5:this.ue(!0),this.ht(i,l,0,0);break;case 4:this.ue(!0),this.ht(h,s,0,0);break}}Ju(e,t){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.w2(!0),this.S(),!e.equalsApproxClose(t)&&(i.dh(),this.x0(i)))}x0(e){this.portId!==null&&(e.w2(!0),e instanceof gt&&e.bA(this))}get shadowVisible(){return this.p!==null?this.p.b0:null}set shadowVisible(e){const t=this.shadowVisible;t!==e&&(this.Kt().b0=e,this.Ve(!0),this.S(),this.t("shadowVisible",t,e))}HR(e,t){const i=this.naturalBounds,s=this.hh,n=s.m11,o=s.m21,r=s.dx,a=s.m12,h=s.m22,l=s.dy;let c=0,d=0,f=c,m=d;c=f*n+m*o+r,d=f*a+m*h+l;let p=c,y=d,x=0,b=0;f=i.width+t,m=0,c=f*n+m*o+r,d=f*a+m*h+l;let M=Math.min(p,c),P=Math.min(y,d);x=Math.max(p+x,c)-M,b=Math.max(y+b,d)-P,p=M,y=P,f=i.width+t,m=i.height+t,c=f*n+m*o+r,d=f*a+m*h+l,M=Math.min(p,c),P=Math.min(y,d),x=Math.max(p+x,c)-M,b=Math.max(y+b,d)-P,p=M,y=P,f=0,m=i.height+t,c=f*n+m*o+r,d=f*a+m*h+l,M=Math.min(p,c),P=Math.min(y,d),x=Math.max(p+x,c)-M,b=Math.max(y+b,d)-P,p=M,y=P;const k=e.viewportBounds,L=k.x,T=k.y,D=k.width,B=k.height;return p>D+L||L>x+p||y>B+T||T>b+y}Ui(e,t){if(this.qR(e,t)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=e.globalAlpha,e.globalAlpha=s*i);let n="";this.filter!==""&&(n=e.filter,e.filter=this.filter);const o=this.T,r=this.panel;this.p0()===!0&&this.Bb();const a=this.part;let h=!1,l=0;if(a&&t.getRenderingHint("drawShadows")&&(h=a.isShadowed,h)){const y=a.shadowOffset;l=Math.max(y.y,y.x)*t.scale*t.Vi}const c=this instanceof bt&&this.$r(),d=this.Ni;if(c&&(this.kA(h,e,!1,r),this.WR(e,t),this.PA(h,e,!1,r),this.SA(h,e,!1)),c||!c&&(d.width===0||d.height===0||isNaN(d.x)||isNaN(d.y))){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}const f=this.Xs();if(!t.ia&&f&&this.HR(t,l)){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}let m=(this.n&256)!==0;if(e.clipInsteadOfFill&&(m=!1),this instanceof ae&&(e.font=this.font),m){const y=r.an()?r.naturalBounds:r.actualBounds;let x=Math.max(d.x,y.x),b=Math.max(d.y,y.y),M=Math.min(d.right,y.right)-x,P=Math.min(d.bottom,y.bottom)-b;const k=this.si;if(k!==null&&(x=k.x,b=k.y,M=k.width,P=k.height),x>d.width+d.x||d.x>y.width+y.x){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}e.save(),e.beginPath(),e.rect(x,b,M,P),e.clip()}if(f){if(!a.isVisible()){i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n);return}if(h){const y=a.shadowOffset;e.shadowsSet(y.x*t.scale*this.scale*t.Vi,y.y*t.scale*this.scale*t.Vi,a.shadowBlur),e.shadowsOn(),e.shadowColor=a.shadowColor}}const p=this.naturalBounds;if(e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.kA(h,e,f,r),this.Lt!==null&&(e.commitTransform(),this.Vb(e,p,d)),this.PA(h,e,f,r),this.gh(e,t),this.SA(h,e,f),m&&(e.restore(),e.clearContextCache(this instanceof bt)),!o.Yk()){const y=1/(o.m11*o.m22-o.m12*o.m21);e.transform(o.m22*y,-o.m12*y,-o.m21*y,o.m11*y,y*(o.m21*o.dy-o.m22*o.dx),y*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(e.globalAlpha=s),this.filter!==""&&(e.filter=n)}kA(e,t,i,s){e&&this.shadowVisible===!0?t.shadowsOn():e&&this.shadowVisible===!1&&t.shadowsOff(),e&&this.zb(s)&&this.shadowVisible===null&&t.shadowsOff()}PA(e,t,i,s){e&&(this.Lt!==null||this.zb(s))?(this.Xb(!0),this.shadowVisible===null&&t.shadowsOff()):this.Xb(!1)}SA(e,t,i){e&&this.b2()===!0&&t.shadowsOn(),i&&e&&t.shadowsOff()}JR(e,t,i){const s=this.part;let n=!1;s&&e.getRenderingHint("drawShadows")&&(n=s.isShadowed),t.clipInsteadOfFill&&(n=!1),this.Xs()&&n&&t.shadowsOn(),n&&this.shadowVisible===!0?t.shadowsOn():n&&this.shadowVisible===!1&&t.shadowsOff();const o=this.panel;if(n&&this.zb(o)&&this.shadowVisible===null&&t.shadowsOff(),t.Zr){const r=e.computePixelRatio(),a=`drop-shadow(${t.shadowOffsetX/r}px ${t.shadowOffsetY/r}px ${t.shadowBlur/r/2}px ${t.shadowColor})`;this.background!==null&&i.Lt.setAttributeNS(null,"filter",a)}return n&&(this.Lt!==null||this.zb(o))?(this.Xb(!0),this.shadowVisible===null&&t.shadowsOff()):this.Xb(!1),n}$R(e,t,i,s){if(i.Zr){const n=t.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.k2(e,o)}s&&this.b2()===!0&&i.shadowsOn(),this.Xs()&&i.shadowsOff()}zb(e){return e===null?!1:(e.$r()&&(e=e.panel),e.b2()||(e.type===bt.Auto||e.type===bt.Spot)&&e.findMainElement()!==this)}k2(e,t){}Vb(e,t,i){const s=this.y0(),n=t.x,o=t.y,r=t.width+s,a=t.height+s;this.rn(e,this.Lt,!0,!1,t,i),this.Lt instanceof Jt&&this.Lt.type===3?(e.beginPath(),e.rect(n-s/2,o-s/2,r,a),e.fillContext(this.Lt,!1,null)):e.fillRect(n-s/2,o-s/2,r,a)}MA(e,t){let i=e.ZR(this);const s=e.ah!==null?e.ah:e.svg;if(i!==-1)if(i===0)if(s.Lt)s.Lt.after(t);else if(e.type===bt.Table){const n=s.getElementsByClassName("gojs-ts"),o=n.length!==0?n[0]:null;o!==null&&o.after(t)}else s.prepend(t);else{for(;i!==0&&!e.elt(i-1).isVisibleObject();)i--;if(i===0)s.prepend(t);else{const n=e.elt(i-1).svg;n!==null?n.after(t):s.appendChild(t)}}}qR(e,t){if(!(e instanceof Ge))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.Ni;if(this.Xs()&&(!this.isVisible()||i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const s=this.panel,n=this.$u(e);if(this.Zc(e,t,n))return this.NA(this.svg),this.svg.parentElement!==null?(this.Xs()&&(e.lastDrawnPart=this.svg),!0):(this.Xs()?(e.lastDrawnPart!==null?e.lastDrawnPart.after(this.svg):e.diagramGroup.prepend(this.svg),e.lastDrawnPart=this.svg):s&&this.MA(s,this.svg),!0);if(this.Ve(!1),this.Xs()&&this.isShadowed){const p=this.shadowOffset;e.shadowsSet(p.x*t.scale*this.scale*t.Vi,p.y*t.scale*this.scale*t.Vi,this.shadowBlur),e.shadowsOn(),e.shadowColor=this.shadowColor}this instanceof ae&&(e.font=this.font),e.currentElement=null;const o=this.T,r=this instanceof bt,a=this instanceof bt?this.$r():!1,h=this.svg;if(this.p0()===!0&&this.Bb(),e.setCurrentTransform(1,0,0,1,0,0),e.outerGroup=!1,n)if(e.outerGroup=!0,r&&a)e.newGroup(1,0,0,1,0,0),this.svg=e.lastCreatedElement;else if(r&&this.isClipping){const p=this.findMainElement();let y=0,x=0;p!==null&&(y=p.actualBounds.x,x=p.actualBounds.y),e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+y,o.dy+x),this.svg=e.lastCreatedElement,p!==null&&e.createOrUpdateClipGroup(this,p.actualBounds),e.currentElement=e.lastCreatedElement}else r?(e.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=e.lastCreatedElement):e.newGroup(1,0,0,1,0,0);const l=this.naturalBounds;r||e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(r?(a&&e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Vb(e,l,i),a&&e.setCurrentTransform(1,0,0,1,0,0)):(e.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Vb(e,l,i)),e.currentElement.Lt=e.lastCreatedElement,e.currentElement.prepend(e.lastCreatedElement));const c=this.JR(t,e,e.currentElement);this.gh(e,t),r&&e.endGroup(),e.outerGroup&&e.endGroup();const d=e.surface.Gu,f=r?this.svg:e.currentElement;if(h!==null&&h.parentNode!==null&&f!==h&&h.parentNode===this.panel.svg){const p=this.svg.getAttribute("filter");return p!==null&&f.setAttribute("filter",p),this.filter!==""&&f.setAttributeNS(null,"filter",this.filter),h.replaceWith(f),this.svg=f,f!==null&&this.k0(e,s,i,f),!0}if(this.svg=f,d!==null&&f===null&&e.dummyGroup(),f===null)return!0;this.k0(e,s,i,f),this.$R(f,t,e,c);const m=this.Xs()?this.opacity*e.globalAlpha:this.opacity;if(m!==1&&f.setAttributeNS(null,"opacity",m.toString()),this.filter!==""&&f.setAttributeNS(null,"filter",this.filter),this.Xs()){if(h!==null&&f!==h&&h.parentNode===e.diagramGroup){const p=h.getAttribute("filter");p!==null&&f.setAttribute("filter",p),h.replaceWith(f)}else e.lastDrawnPart?e.lastDrawnPart.after(f):e.diagramGroup.prepend(f);e.lastDrawnPart=f}else s!==null&&this.MA(s,f);return d!==null&&d(this,f),this.NA(f),!0}NA(e){const t=this,i=e.dataset;t instanceof Vt&&(t.portId!==null&&(i.portId=t.portId),t instanceof bt&&(isNaN(t.itemIndex)||(i.itemIndex=t.itemIndex.toString()),t instanceof Ht&&(i.className=u.Dn(t),t.key!==void 0&&(i.key=t.key.toString()),t.containingGroup!==null&&(i.group=t.containingGroup.key.toString()),t instanceof St&&(t.fromNode!==null&&t.fromNode.key!==void 0&&(i.fromKey=t.fromNode.key.toString()),t.fromPortId!==""&&(i.fromPortId=t.fromPortId),t.toNode!==null&&t.toNode.key!==void 0&&(i.toKey=t.toNode.key.toString()),t.toPortId!==""&&(i.toPortId=t.toPortId)))))}k0(e,t,i,s){let n=(this.n&256)!==0;if(e.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=t.an()?t.naturalBounds:t.actualBounds;let r=Math.max(i.x,o.x),a=Math.max(i.y,o.y),h=Math.min(i.right,o.right)-r,l=Math.min(i.bottom,o.bottom)-a;const c=this.si;c!==null&&(r=c.x,a=c.y,h=c.width,l=c.height);const d=new G(r,a,Math.max(h,0),Math.max(l,0));this instanceof bt&&this.T.copy().bw().vg(d),s.setAttributeNS(null,"clip-path",`path('      M ${d.x},${d.y}       L ${d.width+d.x} ${d.y}       L ${d.width+d.x} ${d.height+d.y}       L ${d.x} ${d.height+d.y} z') view-box`)}QR(){if(this.svg===null)return;const e=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),t=this.svg.ownerDocument;if(e!==null)for(const i of e){const s=t.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}WR(e,t){const i=this.Ni,s=this.zi,n=this.Lt;n!==null&&e.commitTransform(),n!==null&&(this.rn(e,n,!0,!1,s,i),n instanceof Jt&&n.type===3?(e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.fillContext(n,!1,null)):e.fillRect(i.x,i.y,i.width,i.height)),this.gh(e,t)}gh(e,t){}Qc(){this.Ve(!0)}Zc(e,t,i){const s=this.svg;if(this._R()){if(this.Qc(),this.Ve(!1),s===null)return!1;const c=s.getAttribute("clip-path");if(c!==null&&c.includes("url")){const d=e.svg.getElementById(c.split("#")[1].slice(0,-1));d!==null&&d.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.T,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof bt,a=r?this.$r():!1;if(!(r&&a))if(this instanceof ii){const c=this.Yb;e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),c!==null&&e.amendImageTransform(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),i?s.lastElementChild.setAttributeNS(null,"transform",e.getCurrentTransform()):s.setAttributeNS(null,"transform",e.getCurrentTransform())}else if(i&&!r)if(this instanceof At){const c=s.getElementsByTagName("path");for(let d=0;d<c.length;d++)c[d].setAttributeNS(null,"transform",o)}else if(this instanceof ae){const c=s.getElementsByTagName("text"),d=typeof this.stroke=="string"?this.stroke:null;for(let f=0;f<c.length;f++)c[f].setAttributeNS(null,"transform",o),d&&c[f].setAttributeNS(null,"fill",d)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.ah){const c=this.findMainElement(),d=c!==null?c.actualBounds.x:0,f=c!==null?c.actualBounds.y:0;this.ah.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-d+", "+-f+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+d)+", "+(n.dy+f)+")")}else s.setAttributeNS(null,"transform",o);const h=this.Xs()?this.opacity*e.globalAlpha:this.opacity;h===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),e.setCurrentTransform(1,0,0,1,0,0);const l=this.ah?this.ah:this.Ub;if(this.background!==null||l.Lt!==void 0){const c=l.Lt;if(this.background===null)e.removeOldGradient(this,l.Lt,"fill"),l.Lt.remove(),l.Lt=void 0;else{if((a||i&&!(this instanceof bt))&&e.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Vb(e,this.naturalBounds,this.actualBounds),l.Lt){e.removeOldGradient(this,l.Lt,"fill");const d=l.Lt.getAttribute("filter");d!==null&&e.lastCreatedElement.setAttribute("filter",d),l.Lt.replaceWith(e.lastCreatedElement)}else l.prepend(e.lastCreatedElement);l.Lt=e.lastCreatedElement}c&&e.removeOldGradient(this,c,"fill")}return this.k0(e,this.panel,this.actualBounds,s),!0}$u(e){if(this.background!==null)return!0;let t=(this.n&256)!==0;return e.clipInsteadOfFill&&(t=!1),!!t}static TE(e,t,i,s,n,o,r){let a=.001;const h=o.length;e.moveTo(t,i);let l=s-t;const c=n-i;l===0&&(l=.001);const d=c/l;let f=Math.sqrt(l*l+c*c),m=0,p=!0;a=o[m%h];let y=r!==0;for(;f>=.1;){if(y){for(a=o[m++%h],a-=r;a<0;)a+=o[m++%h],p=!p;y=!1}else a=o[m++%h];a>f&&(a=f);let x=Math.sqrt(a*a/(1+d*d));l<0&&(x=-x),t+=x,i+=d*x,p?e.lineTo(t,i):e.moveTo(t,i),f-=a,p=!p}}rn(e,t,i,s,n,o){let r=1,a=1;if(typeof t=="string"){i?e.fillStyle=t:e.strokeStyle=t;return}else if(t.type===1){i?e.fillStyle=t.color:e.strokeStyle=t.color;return}let h;const l=this.y0();r=n.width,a=n.height,s?(r=o.width,a=o.height):i||(r+=l,a+=l);const c=e instanceof fn;if(c&&t.cn&&(t.type===4||t._c===r&&t.Gb===a))h=t.cn;else{let d=0,f=0,m=0,p=0,y=0,x=0,b=0,M=0;if(s?(b=o.x,M=o.y):i||(b-=l/2,M-=l/2),d=t.start.x*r+t.start.offsetX+b,f=t.start.y*a+t.start.offsetY+M,m=t.end.x*r+t.end.offsetX+b,p=t.end.y*a+t.end.offsetY+M,t.type===2)h=e.createLinearGradient(d,f,m,p);else if(t.type===3)x=isNaN(t.endRadius)?Math.max(r,a)/2:t.endRadius,isNaN(t.startRadius)?(y=0,x=Math.max(r,a)/2):y=t.startRadius,h=e.createRadialGradient(d,f,y,m,p,x);else if(t.type===4)try{h=e.createPattern(t.pattern,"repeat")}catch{h=null}else u.Zi(t.type,"Brush type");if(t.type!==4){const P=t.colorStops;if(P!==null){const k=P.iterator;for(;k.next();)h.addColorStop(k.key,k.value)}}if(c&&(t.cn=h,h!==null&&(t._c=r,t.Gb=a),h===null&&t.type===4&&t._c!==-1)){t._c=-1;const P=this.diagram;P!==null&&t._c===-1&&u.ir(()=>{P.redraw()},600)}}i?e.fillStyle=h:e.strokeStyle=h}isContainedBy(e){return e instanceof bt?this.tv(this,e):!1}tv(e,t){if(e===t||t===null)return!1;let i=e.panel;for(;i!==null;){if(i===t)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const e=this.panel;return e!==null?e.isVisibleObject():!0}isEnabledObject(){let e=this instanceof bt?this:this.panel;for(;e!==null&&e.isEnabled;)e=e.panel;return e===null}get enabledChanged(){return this.p!==null?this.p.P0:null}set enabledChanged(e){const t=this.enabledChanged;t!==e&&(e!==null&&u.k(e,Vt,"enabledChanged"),this.Kt().P0=e,this.t("enabledChanged",t,e))}Bb(){if(this.Kb()===!0){const e=this.qr;if(e.Ri(),!this.Ni.isReal()||!this.se.isReal()){this.Zu(!1);return}if(e.Fs(this.Ni.x-this.se.x,this.Ni.y-this.se.y),this.scale!==1||this.angle!==0){const t=this.naturalBounds;this.m0(e,t.x,t.y,t.width,t.height)}this.Zu(!1),this.ka(!0)}if(this.p0()===!0){const e=this.panel;if(e===null)this.hh.set(this.qr),this.da=this.scale;else if(e.Us!==null){const t=this.hh;t.Ri(),e.an()?t.nc(e.hh):e.panel!==null&&t.nc(e.panel.hh),t.nc(this.qr),this.da=this.scale*e.da}this.ka(!1)}}m0(e,t,i,s,n){if(this.tt!==1&&e.tt(this.tt),this.Yt===0)return;const o=C.l();o.setSpot(t,i,s,n,U.Center),e.cs(this.Yt,o.x,o.y),C.e(o)}c(e){if(this.To())return;e===void 0&&(e=!1),this.ue(!0),this.Jn(!0);const t=this.panel;t!==null&&!e&&t.c()}tf(){this.To()||(this.ue(!0),this.Jn(!0))}ef(e){if(this._e())return;const t=this.panel;!e&&t!==null&&t.c(),this.Jn(!0)}$c(){this.Kb()===!1&&(this.Zu(!0),this.ka(!0))}P2(){this.ka(!0)}S(){const e=this.part;e!==null&&e.S()}zs(e){const t=this.stretch,i=this.panel;if(i===null)return this.Oo(t===1?0:t,e);if(i.type===bt.Table)return this.S0(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),e);if(i.type===bt.Auto&&i.findMainElement()===this)return this.Oo(2,e);if(t===1){if(i.type===bt.Spot&&i.findMainElement()===this)return this.Oo(2,e);const s=i.defaultStretch;return s===1?this.Oo(0,e):this.Oo(s,e)}return this.Oo(t,e)}S0(e,t,i){const s=this.stretch;if(s!==1)return this.Oo(s,i);let n=null,o=null;switch(e.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(t.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.Oo(2,i):n===!0?this.Oo(5,i):o===!0?this.Oo(4,i):this.Oo(0,i)}Oo(e,t){if(t)return e;if(e===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(e===5)return 0;if(e===2)return 4}else{if(e===4)return 0;if(e===2)return 5}if(n)if(o!==90&&o!==270){if(e===4)return 0;if(e===2)return 5}else{if(e===5)return 0;if(e===2)return 4}return e}get segmentOrientation(){return this.Ot!==null?this.Ot.M0:0}set segmentOrientation(e){const t=this.segmentOrientation;t!==e&&(this.Ot===null&&(this.Ot=new Ji),this.Ot.M0=e,this.c(),this.t("segmentOrientation",t,e),e===0&&(this.angle=0))}iv(){this.segmentOrientation=21}get segmentIndex(){return this.Ot!==null?this.Ot.N0:-1/0}set segmentIndex(e){e=Math.round(e);const t=this.segmentIndex;t!==e&&(this.Ot===null&&(this.Ot=new Ji),this.Ot.N0=e,this.c(),this.t("segmentIndex",t,e))}get segmentFraction(){return this.Ot!==null?this.Ot.C0:0}set segmentFraction(e){e<0?e=0:e>1&&(e=1);const t=this.segmentFraction;t!==e&&(this.Ot===null&&(this.Ot=new Ji),this.Ot.C0=e,this.c(),this.t("segmentFraction",t,e))}get segmentOffset(){return this.Ot!==null?this.Ot.L0:C.xo}set segmentOffset(e){const t=this.segmentOffset;t.equals(e)||(e=e.P(),this.Ot===null&&(this.Ot=new Ji),this.Ot.L0=e,this.c(),this.t("segmentOffset",t,e))}get stretch(){return this.p!==null?this.p.$n:1}set stretch(e){const t=this.stretch;t!==e&&(this.Kt().$n=e,this.c(),this.t("stretch",t,e))}get name(){return this.p!==null?this.p.St:""}set name(e){const t=this.name;t!==e&&(this.Kt().St=e,this.part!==null&&this.part.A0(),this.t("name",t,e))}get opacity(){return this.$t}set opacity(e){e<0?e=0:e>1&&(e=1);const t=this.opacity;if(t!==e){this.$t=e,this.t("opacity",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.S(s.Wh(s.actualBounds))}}get filter(){return this.d0}set filter(e){const t=this.filter;if(t!==e){this.d0=e,this.Ve(!0),this.t("filter",t,e);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.S(s.Wh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(e){const t=(this.n&1)!==0;if(t!==e){this.n=this.n^1,this.Qc(),this.t("visible",t,e);const i=this.panel;i!==null?i.c():this.Xs()&&this.Ei(e),this.S(),this.CA()}}get pickable(){return(this.n&2)!==0}set pickable(e){const t=(this.n&2)!==0;t!==e&&(this.n=this.n^2,this.t("pickable",t,e))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(e){const t=(this.n&4)!==0;t!==e&&(this.n=this.n^4,this.t("fromLinkableDuplicates",t,e))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(e){const t=(this.n&8)!==0;t!==e&&(this.n=this.n^8,this.t("fromLinkableSelfNode",t,e))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(e){const t=(this.n&16)!==0;t!==e&&(this.n=this.n^16,this.t("toLinkableDuplicates",t,e))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(e){const t=(this.n&32)!==0;t!==e&&(this.n=this.n^32,this.t("toLinkableSelfNode",t,e))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(e){const t=(this.n&64)!==0;t!==e&&(this.n=this.n^64,this.c(),this.t("isPanelMain",t,e))}get isActionable(){return(this.n&128)!==0}set isActionable(e){const t=(this.n&128)!==0;t!==e&&(this.n=this.n^128,this.t("isActionable",t,e))}get background(){return this.Lt}set background(e){const t=this.background;t!==e&&(e!==null&&Jt.Qu(e,"GraphObject.background"),e instanceof Jt&&e.u(),this.Lt=e,this.S(),this.t("background",t,e))}b2(){return(this.n&512)!==0}Xb(e){e?this.n|=512:this.n&=-513}Wc(){return(this.n&1024)!==0}S2(e){e?this.n|=1024:this.n&=-1025}Kb(){return(this.n&2048)!==0}Zu(e){e?this.n|=2048:this.n&=-2049}p0(){return(this.n&4096)!==0}ka(e){e?this.n|=4096:this.n&=-4097}To(){return(this.n&8192)!==0}ue(e){e?this.n|=8192:this.n&=-8193}_e(){return(this.n&16384)!==0}Jn(e){e?this.n|=16384:this.n&=-16385}_R(){return(this.n&32768)!==0}Ve(e){e?this.n|=32768:this.n&=-32769}get part(){if(this.Xs())return this;if(this.Jr!==null)return this.Jr;let e=this;for(e=e.panel;e;){if(e instanceof Ht)return this.Jr=e,e;e=e.panel}return null}get svg(){return this.Ub}set svg(e){this.Ub=e}Au(){this.svg=null}get panel(){return this.Vs}Pa(e){this.Vs=e,this.svg!==null&&this.svg.remove()}get layer(){const e=this.part;return e!==null?e.layer:null}get diagram(){const e=this.part;return e!==null?e.diagram:null}get position(){return this.at}set position(e){const t=e.x,i=e.y,s=this.position,n=s.x,o=s.y;n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i))?(e=e.copy(),this.M2(e,n,o)&&this.t("position",new C(n,o),e.copy())):this.N2()}N2(){}M2(e,t,i){return this.at=e,this.ef(),!0}bc(e,t,i){this.at.x===e&&this.at.y===t||(this.at.i(e,t),this.$c())}get actualBounds(){return this.Ni}get scale(){return this.tt}set scale(e){const t=this.scale;t!==e&&(e<=0&&u.o("GraphObject.scale for "+this+" must be greater than zero, not: "+e),this.tt=e,this.c(),this.t("scale",t,e))}get angle(){return this.Yt}set angle(e){const t=this.angle;if(t!==e){if(e=e%360,e<0&&(e+=360),t===e)return;this.Yt=e,this.CA(),this.c(),this.t("angle",t,e)}}get desiredSize(){return this.is}set desiredSize(e){const t=e.width,i=e.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==t&&(!isNaN(n)||!isNaN(t))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(e=e.P(),this.is=e,this.c(),this instanceof At&&this.ee(),this.t("desiredSize",s,e),this.Wc())){const r=this.part;r!==null&&(this.ba(r,"width"),this.ba(r,"height"))}}get width(){return this.is.width}set width(e){const t=this.is.width;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.is,s=new rt(e,this.is.height).u();if(this.is=s,this.c(),this instanceof At&&this.ee(),this.t("desiredSize",i,s),this.Wc()){const n=this.part;n!==null&&this.ba(n,"width")}}}get height(){return this.is.height}set height(e){const t=this.is.height;if(t!==e&&(!isNaN(t)||!isNaN(e))){const i=this.is,s=new rt(this.is.width,e).u();if(this.is=s,this.c(),this instanceof At&&this.ee(),this.t("desiredSize",i,s),this.Wc()){const n=this.part;n!==null&&this.ba(n,"height")}}}get minSize(){return this.p!==null?this.p.pr:rt.sc}set minSize(e){const t=this.minSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e.u(),this.Kt().pr=e,this.c(),this.t("minSize",t,e))}get maxSize(){return this.p!==null?this.p.yr:rt.Bk}set maxSize(e){const t=this.maxSize;t.equals(e)||(e=e.copy(),isNaN(e.width)&&(e.width=1/0),isNaN(e.height)&&(e.height=1/0),e.u(),this.Kt().yr=e,this.c(),this.t("maxSize",t,e))}get measuredBounds(){return this.se}get naturalBounds(){return this.zi}y0(){return 0}get margin(){return this.Wr}set margin(e){typeof e=="number"&&(e=new wt(e));const t=this.Wr;t.equals(e)||(e=e.P(),this.Wr=e,this.c(),this.t("margin",t,e))}get T(){return this.Kb()===!0&&this.Bb(),this.qr}get Us(){return this.p0()===!0&&this.Bb(),this.hh}trigger(e,t,i){let s=null;return typeof e=="string"?s=new un(e,t,i):s=e,s.be=this,this.ws===null&&(this.ws=new Z),this.ws.set(s.propertyName,s),this}get ws(){return this.p!==null?this.p.ws:null}set ws(e){this.ws!==e&&(this.Kt().ws=e)}get gr(){return this.p!==null?this.p.gr:0}set gr(e){this.gr!==e&&(this.Kt().gr=e)}get alignment(){return this.hi}set alignment(e){const t=this.alignment;t.equals(e)||(e.isNoSpot()&&!e.isDefault()&&u.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+e),e=e.P(),this.hi=e,this.ef(),this.t("alignment",t,e))}get column(){return this.Hr}set column(e){e=Math.round(e);const t=this.column;t!==e&&(e<0&&u.W(e,">= 0",Vt,"column"),this.Hr=e,this.c(),this.t("column",t,e),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.p!==null?this.p.T0:1}set columnSpan(e){e=Math.round(e);const t=this.columnSpan;t!==e&&(e<1&&u.W(e,">= 1",Vt,"columnSpan"),this.Kt().T0=e,this.c(),this.t("columnSpan",t,e))}get row(){return this.u0}set row(e){e=Math.round(e);const t=this.row;t!==e&&(e<0&&u.W(e,">= 0",Vt,"row"),this.u0=e,this.c(),this.t("row",t,e),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.p!==null?this.p.D0:1}set rowSpan(e){e=Math.round(e);const t=this.rowSpan;t!==e&&(e<1&&u.W(e,">= 1",Vt,"rowSpan"),this.Kt().D0=e,this.c(),this.t("rowSpan",t,e))}get spanAllocation(){return this.p!==null?this.p.F0:null}set spanAllocation(e){const t=this.spanAllocation;t!==e&&(e!==null&&u.k(e,Vt,"spanAllocation"),this.Kt().F0=e,this.c(),this.t("spanAllocation",t,e))}get alignmentFocus(){return this.ju}set alignmentFocus(e){const t=this.alignmentFocus;t.equals(e)||(e=e.P(),this.ju=e,this.c(),this.t("alignmentFocus",t,e))}get portId(){return this.f0}set portId(e){const t=this.portId;if(t!==e){const i=this.part;i!==null&&!(i instanceof gt)&&u.o("Cannot set portID on a Link: "+e);const s=i;t!==null&&s!==null&&s.C2(this),this.f0=e,e!==null&&s!==null&&(s.fn=!0,s.LA(this)),this.t("portId",t,e)}}Sa(){const e=this.part;if(e instanceof gt&&(this.portId!==null||this===e.port)){const t=e.diagram;t!==null&&!t.undoManager.isUndoingRedoing&&e.bA(this)}}CA(){const e=this.diagram;e===null||e.undoManager.isUndoingRedoing||(this instanceof bt?this instanceof gt?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Sa()}):this.Sa())}get toSpot(){return this.ct!==null?this.ct.ma:U.None}set toSpot(e){const t=this.toSpot;t.equals(e)||(e=e.P(),this.Be().ma=e,this.t("toSpot",t,e),this.Sa())}get toEndSegmentLength(){return this.ct!==null?this.ct.ya:10}set toEndSegmentLength(e){const t=this.toEndSegmentLength;t!==e&&(e<0&&u.W(e,">= 0",Vt,"toEndSegmentLength"),this.Be().ya=e,this.t("toEndSegmentLength",t,e),this.Sa())}get toShortLength(){return this.ct!==null?this.ct.xa:0}set toShortLength(e){const t=this.toShortLength;t!==e&&(this.Be().xa=e,this.t("toShortLength",t,e),this.Sa())}get toLinkable(){return this.ct!==null?this.ct.R0:null}set toLinkable(e){const t=this.toLinkable;t!==e&&(this.Be().R0=e,this.t("toLinkable",t,e))}get toMaxLinks(){return this.ct!==null?this.ct.v0:1/0}set toMaxLinks(e){const t=this.toMaxLinks;t!==e&&(e<0&&u.W(e,">= 0",Vt,"toMaxLinks"),this.Be().v0=e,this.t("toMaxLinks",t,e))}get fromSpot(){return this.ct!==null?this.ct.ga:U.None}set fromSpot(e){const t=this.fromSpot;t.equals(e)||(e=e.P(),this.Be().ga=e,this.t("fromSpot",t,e),this.Sa())}get fromEndSegmentLength(){return this.ct!==null?this.ct.pa:10}set fromEndSegmentLength(e){const t=this.fromEndSegmentLength;t!==e&&(e<0&&u.W(e,">= 0",Vt,"fromEndSegmentLength"),this.Be().pa=e,this.t("fromEndSegmentLength",t,e),this.Sa())}get fromShortLength(){return this.ct!==null?this.ct.wa:0}set fromShortLength(e){const t=this.fromShortLength;t!==e&&(this.Be().wa=e,this.t("fromShortLength",t,e),this.Sa())}get fromLinkable(){return this.ct!==null?this.ct.O0:null}set fromLinkable(e){const t=this.fromLinkable;t!==e&&(this.Be().O0=e,this.t("fromLinkable",t,e))}get fromMaxLinks(){return this.ct!==null?this.ct.I0:1/0}set fromMaxLinks(e){const t=this.fromMaxLinks;t!==e&&(e<0&&u.W(e,">= 0",Vt,"fromMaxLinks"),this.Be().I0=e,this.t("fromMaxLinks",t,e))}get cursor(){return this.p!==null?this.p.Sl:""}set cursor(e){const t=this.cursor;t!==e&&(u.s(e,"string",Vt,"cursor"),this.Kt().Sl=e,this.t("cursor",t,e))}get click(){return this.p!==null?this.p.Cr:null}set click(e){const t=this.click;t!==e&&(e!==null&&u.k(e,Vt,"click"),this.Kt().Cr=e,this.t("click",t,e))}get doubleClick(){return this.p!==null?this.p.Lr:null}set doubleClick(e){const t=this.doubleClick;t!==e&&(e!==null&&u.k(e,Vt,"doubleClick"),this.Kt().Lr=e,this.t("doubleClick",t,e))}get contextClick(){return this.p!==null?this.p.Ar:null}set contextClick(e){const t=this.contextClick;t!==e&&(e!==null&&u.k(e,Vt,"contextClick"),this.Kt().Ar=e,this.t("contextClick",t,e))}get mouseEnter(){return this.p!==null?this.p.vr:null}set mouseEnter(e){const t=this.mouseEnter;t!==e&&(e!==null&&u.k(e,Vt,"mouseEnter"),this.Kt().vr=e,this.t("mouseEnter",t,e))}get mouseLeave(){return this.p!==null?this.p.Or:null}set mouseLeave(e){const t=this.mouseLeave;t!==e&&(e!==null&&u.k(e,Vt,"mouseLeave"),this.Kt().Or=e,this.t("mouseLeave",t,e))}get mouseOver(){return this.p!==null?this.p.Tr:null}set mouseOver(e){const t=this.mouseOver;t!==e&&(e!==null&&u.k(e,Vt,"mouseOver"),this.Kt().Tr=e,this.t("mouseOver",t,e))}get mouseHover(){return this.p!==null?this.p.Dr:null}set mouseHover(e){const t=this.mouseHover;t!==e&&(e!==null&&u.k(e,Vt,"mouseHover"),this.Kt().Dr=e,this.t("mouseHover",t,e))}get mouseHold(){return this.p!==null?this.p.Fr:null}set mouseHold(e){const t=this.mouseHold;t!==e&&(e!==null&&u.k(e,Vt,"mouseHold"),this.Kt().Fr=e,this.t("mouseHold",t,e))}get mouseDragEnter(){return this.p!==null?this.p.E0:null}set mouseDragEnter(e){const t=this.mouseDragEnter;t!==e&&(e!==null&&u.k(e,Vt,"mouseDragEnter"),this.Kt().E0=e,this.t("mouseDragEnter",t,e))}get mouseDragLeave(){return this.p!==null?this.p.U0:null}set mouseDragLeave(e){const t=this.mouseDragLeave;t!==e&&(e!==null&&u.k(e,Vt,"mouseDragLeave"),this.Kt().U0=e,this.t("mouseDragLeave",t,e))}get mouseDrop(){return this.p!==null?this.p.Rr:null}set mouseDrop(e){const t=this.mouseDrop;t!==e&&(e!==null&&u.k(e,Vt,"mouseDrop"),this.Kt().Rr=e,this.t("mouseDrop",t,e))}get actionDown(){return this.p!==null?this.p.B0:null}set actionDown(e){const t=this.actionDown;t!==e&&(e!==null&&u.k(e,Vt,"actionDown"),this.Kt().B0=e,this.t("actionDown",t,e))}get actionMove(){return this.p!==null?this.p.V0:null}set actionMove(e){const t=this.actionMove;t!==e&&(e!==null&&u.k(e,Vt,"actionMove"),this.Kt().V0=e,this.t("actionMove",t,e))}get actionUp(){return this.p!==null?this.p.z0:null}set actionUp(e){const t=this.actionUp;t!==e&&(e!==null&&u.k(e,Vt,"actionUp"),this.Kt().z0=e,this.t("actionUp",t,e))}get actionCancel(){return this.p!==null?this.p.X0:null}set actionCancel(e){const t=this.actionCancel;t!==e&&(e!==null&&u.k(e,Vt,"actionCancel"),this.Kt().X0=e,this.t("actionCancel",t,e))}get toolTip(){return this.p!==null?this.p.Ir:null}set toolTip(e){const t=this.toolTip;t!==e&&(this.Kt().Ir=e,this.t("toolTip",t,e))}get contextMenu(){return this.p!==null?this.p.Er:null}set contextMenu(e){const t=this.contextMenu;t!==e&&(this.Kt().Er=e,this.t("contextMenu",t,e))}findBindingPanel(){let e=this instanceof bt?this:this.panel;for(;e!==null;){if(e.L2())return e;e=e.panel}return null}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){return this.sf(e,t,i,s).makeTwoWay(),this}bindModel(e,t,i,s){return this.sf(e,t,i,s).ofModel(),this}bindObject(e,t,i,s,n){return this.sf(e,t,i,s).ofObject(n),this}theme(e,t,i,s,n){return this.mh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.mh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.mh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.mh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n=null;return typeof e=="string"?n=new Vi(e,t,i,s):n=e,this.Y0(n),n}mh(e,t,i,s,n){let o=null;return typeof e=="string"?o=new Es(e,t,i,s,n):o=e,this.Y0(o),o}Y0(e){e.be=this;const t=this.findBindingPanel();t!==null&&t.AA()&&u.o("Cannot add a Binding to a template that has already been copied: "+e),this.Ci===null&&(this.Ci=new Y),this.Ci.add(e)}set(e){return Object.assign(this,e),this}attach(e){return Vt.A2(this,e),this}apply(e){return e(this),this}setProperties(e){return zt.s0(this,e),this}static make(e,...t){let i=arguments,s=null,n=null;if(u.it(e))n=e;else if(typeof e=="string"){const r=Vt.jb.get(e);u.it(r)?(i=Array.prototype.slice.call(i),s=r(i),u.G(s)||u.o('GraphObject.make invoked object builder "'+e+'", but it did not return an Object')):n=w.go[e]}s===null&&((n==null||!n.constructor)&&u.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+e),s=new n);let o=1;if(s instanceof zt&&i.length>1){const r=s,a=i[1];(typeof a=="string"||a instanceof HTMLDivElement)&&(r.AM(a),o++)}for(let r=o;r<i.length;r++){const a=i[r];a===void 0?u.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):Vt.A2(s,a)}return s}static A2(e,t){if(typeof t=="number")Vt.ev(e,t);else if(typeof t=="string")Vt.sv(e,t);else if(t instanceof Vt)e instanceof bt||u.o("A GraphObject can only be added to a Panel, not to: "+e),e.add(t);else if(t instanceof Me){let i;t.isRow&&u.it(e.getRowDefinition)?i=e.getRowDefinition(t.index):!t.isRow&&u.it(e.getColumnDefinition)&&(i=e.getColumnDefinition(t.index)),i instanceof Me?i.Hb(t):u.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(t instanceof Yt){const i=e;i.type=t}else if(t instanceof Vi)e instanceof Vt||e instanceof Me?e.bind(t):u.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(t instanceof un)e instanceof Vt?e.trigger(t):u.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(t instanceof Gt)e instanceof Tt&&e.type===4?e.figures.add(t):u.o("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(t instanceof Mt)e instanceof Gt?e.segments.add(t):u.o("A PathSegment can only be added to a PathFigure, not to: "+e);else if(t instanceof De)e instanceof zt||e instanceof Nt?e.layout=t:u.o("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];Vt.A2(e,s)}else u.G(t)?Vt.nv(e,t):u.o('Unknown initializer "'+t+'" for object being constructed by GraphObject.make: '+e)}static sv(e,t){if(e instanceof ae)e.text=t;else if(e instanceof At)e.figure=t;else if(e instanceof ii)e.source=t;else if(e instanceof bt){const i=Yt.es.get(t);i!==null&&(e.type=i)}else if(e instanceof Jt){const i=u.Uh(Wi,t);i!==null?e.type=i:u.o("Unknown Brush type as an argument to GraphObject.make: "+t)}else if(e instanceof Tt){const i=u.Uh(ee,t);i!==null&&(e.type=i)}else if(e instanceof Mt){const i=u.Uh(we,t);i!==null&&(e.type=i)}}static ev(e,t){u.it(e.oi)?e.oi(t):u.er(e,t)}static nv(e,t){if(e instanceof Jt){const i=new N;for(const s in t){const n=parseFloat(s);isNaN(n)?i[s]=t[s]:e.addColorStop(n,t[s])}zt.s0(e,i)}else if(e instanceof Me){if(t.row!==void 0){const s=t.row;(s==null||s===1/0||isNaN(s)||s<0)&&u.o("Must specify non-negative integer row for RowColumnDefinition "+t+", not: "+s),e.isRow=!0,e.index=s}else if(t.column!==void 0){const s=t.column;(s==null||s===1/0||isNaN(s)||s<0)&&u.o("Must specify non-negative integer column for RowColumnDefinition "+t+", not: "+s),e.isRow=!1,e.index=s}const i=new N;for(const s in t)s==="row"||s==="column"||(i[s]=t[s]);zt.s0(e,i)}else zt.s0(e,t)}static build(e,t,...i){const s=Vt.jb.get(e);if(u.it(s)){const n=s([e].concat(i));if(n instanceof Vt)return t&&n.setProperties(t),n}u.o('GraphObject.build invoked object builder "'+e+'", but it did not return an Object')}static defineBuilder(e,t){u.s(e,"string",Vt,"defineBuilder:name"),u.k(t,Vt,"defineBuilder:func"),e.toLowerCase(),Vt.jb.set(e,t)}static isBuilderDefined(e){return Vt.jb.has(e)}static takeBuilderArgument(e,t,i){i===void 0&&(i=null);const s=e[1];return(u.it(i)?i(s):typeof s=="string")?(e.splice(1,1),s):(t===void 0&&u.o("no "+(u.it(i)?"satisfactory":"string")+" argument for GraphObject builder "+e[0]),t)}};g(Vt,"None",0),g(Vt,"Default",1),g(Vt,"Fill",2),g(Vt,"Vertical"),g(Vt,"Horizontal"),g(Vt,"Uniform",6),g(Vt,"UniformToFill",7),g(Vt,"FlipVertical",1),g(Vt,"FlipHorizontal",2),g(Vt,"FlipBoth",3),g(Vt,"jb",new Z);let Xt=Vt;Xt.Vertical=4,Xt.Horizontal=5,Xt.defineBuilder("Button",S=>{const e="#f5f5f5",t="#737373",i="#d4d4d4",s="#737373",n="#a3a3a3",o=2.76142374915397,r=2.761423749153969,a=new bt(bt.Auto,{isActionable:!0,enabledChanged:(h,l)=>{if(h instanceof bt){const c=h.findObject("ButtonBorder");if(c!==null)if(h._buttonFillNormal===void 0&&(h._buttonFillNormal=c.fill),l){let d=null;h.layer!==null&&h.diagram!==null&&h.isVisibleObject()&&(d=h.layer.findObjectAt(h.diagram.lastInput.documentPoint)),d===h||d!==null&&d.isContainedBy(h)?c.fill=h._buttonFillOver:c.fill=h._buttonFillNormal}else c.fill=h._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:i,_buttonStrokeOver:s,_buttonFillDisabled:n}).add(new At("RoundedRectangle",{name:"ButtonBorder",spot1:new U(0,0,o,r),spot2:new U(1,1,-o,-r),parameter1:2,fill:e,stroke:t}));return a.mouseEnter=(h,l,c)=>{if(!l.isEnabledObject()||!(l instanceof bt))return;const d=l.findObject("ButtonBorder");d instanceof At&&(l._buttonFillNormal===void 0&&(l._buttonFillNormal=d.fill),d.fill=l._buttonFillOver,l._buttonStrokeNormal===void 0&&(l._buttonStrokeNormal=d.stroke),d.stroke=l._buttonStrokeOver)},a.mouseLeave=(h,l,c)=>{if(!l.isEnabledObject()||!(l instanceof bt))return;const d=l.findObject("ButtonBorder");d instanceof At&&(l._buttonFillNormal!==void 0&&(d.fill=l._buttonFillNormal),l._buttonStrokeNormal!==void 0&&(d.stroke=l._buttonStrokeNormal))},a}),Xt.defineBuilder("TreeExpanderButton",S=>{const e=Xt.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new At("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:rt.nu}).bindObject("figure","isTreeExpanded",(t,i)=>{const s=i.panel;return t?s._treeExpandedFigure:s._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,i)=>{let s=i.part;if(s instanceof Ft&&(s=s.adornedPart),!(s instanceof gt))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;t.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},e}),Xt.defineBuilder("SubGraphExpanderButton",S=>{const e=Xt.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new At("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:rt.nu}).bindObject("figure","isSubGraphExpanded",(t,i)=>{const s=i.panel;return t?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),e.click=(t,i)=>{let s=i.part;if(s instanceof Ft&&(s=s.adornedPart),!(s instanceof Nt))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;t.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},e}),Xt.defineBuilder("ToolTip",S=>new Ft(bt.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new C(0,2)}).add(new At("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new U(0,0,4,6),spot2:new U(1,1,-4,-4)}))),Xt.defineBuilder("ContextMenu",S=>new Ft(bt.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new C(0,2)}).bindObject("background","",e=>e.adornedPart!==null&&e.hasPlaceholder()?null:"#f5f5f5")),Xt.defineBuilder("ContextMenuButton",S=>{const e=Xt.build("Button");e.stretch=5;const t=e.findObject("ButtonBorder");return t instanceof At&&(t.figure="Rectangle",t.strokeWidth=0,t.spot1=new U(0,0,4,6),t.spot2=new U(1,1,-4,-4)),e}),Xt.defineBuilder("PanelExpanderButton",S=>{const e=Xt.takeBuilderArgument(S,"COLLAPSIBLE"),t=Xt.build("Button");t.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),t.add(new At({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?t._buttonExpandedFigure:t._buttonCollapsedFigure,void 0,e));const i=t.findObject("ButtonBorder");return i instanceof At&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),t.click=(s,n)=>{if(!(n instanceof bt))return;const o=n.diagram;if(o===null||o.isReadOnly)return;let r=n.findBindingPanel();if(r===null&&(r=n.part),r!==null){const a=r.findObject(e);a!==null&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),a.visible=!a.visible,o.commitTransaction("Collapse/Expand Panel"))}},t}),Xt.defineBuilder("CheckBoxButton",S=>{const e=Xt.takeBuilderArgument(S),t=Xt.build("Button",{desiredSize:new rt(14,14)});t.attach({"ButtonBorder.spot1":new U(0,0,1,1),"ButtonBorder.spot2":new U(1,1,-1,-1)});const i=new At({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return e!==""&&i.bindTwoWay("visible",e),t.add(i),t.click=(s,n)=>{if(!(n instanceof bt))return;const o=s.diagram;if(o===null||o.isReadOnly||e!==""&&o.model.isReadOnly)return;s.handled=!0;const r=n.findObject("ButtonIcon");o.startTransaction("checkbox"),r!==null&&(r.visible=!r.visible),u.it(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},t}),Xt.defineBuilder("CheckBox",S=>{const e=Xt.takeBuilderArgument(S),t=Xt.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new wt(0,1,0,0)},e),i=new bt("Horizontal",{isActionable:!0,cursor:t.cursor,margin:new wt(1),mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonFillNormal:t._buttonFillNormal,_buttonStrokeNormal:t._buttonStrokeNormal,_buttonFillOver:t._buttonFillOver,_buttonStrokeOver:t._buttonStrokeOver,_buttonFillDisabled:t._buttonFillDisabled,_buttonClick:t.click});return i.add(t),t.mouseEnter=null,t.mouseLeave=null,t.click=null,i});class us{constructor(){g(this,"fi");g(this,"St");g(this,"Hn");g(this,"Ci");g(this,"qn");g(this,"Ys");g(this,"Sl");g(this,"Cr");g(this,"Lr");g(this,"Ar");g(this,"vr");g(this,"Or");g(this,"Tr");g(this,"Dr");g(this,"Fr");g(this,"E0");g(this,"U0");g(this,"Rr");g(this,"B0");g(this,"V0");g(this,"z0");g(this,"X0");g(this,"Ir");g(this,"Er");g(this,"P0");g(this,"F0");g(this,"ws");g(this,"pr");g(this,"yr");g(this,"$n");g(this,"D0");g(this,"T0");g(this,"gr");g(this,"b0");g(this,"G0");g(this,"K0");this.fi=!1,this.St="",this.Hn=-1,this.Ci=null,this.qn=null,this.Ys=null,this.Sl="",this.Cr=null,this.Lr=null,this.Ar=null,this.vr=null,this.Or=null,this.Tr=null,this.Dr=null,this.Fr=null,this.E0=null,this.U0=null,this.Rr=null,this.B0=null,this.V0=null,this.z0=null,this.X0=null,this.Ir=null,this.Er=null,this.P0=null,this.F0=null,this.ws=null,this.pr=rt.sc,this.yr=rt.Bk,this.$n=1,this.D0=1,this.T0=1,this.gr=0,this.b0=null,this.G0=null,this.K0="category"}copy(){const e=new us;return e.St=this.St,e.Hn=this.Hn,e.Ci=this.Ci,e.Ys=this.Ys,e.Sl=this.Sl,e.Cr=this.Cr,e.Lr=this.Lr,e.Ar=this.Ar,e.vr=this.vr,e.Or=this.Or,e.Tr=this.Tr,e.Dr=this.Dr,e.Fr=this.Fr,e.E0=this.E0,e.U0=this.U0,e.Rr=this.Rr,e.B0=this.B0,e.V0=this.V0,e.z0=this.z0,e.X0=this.X0,e.Ir=this.Ir,e.Er=this.Er,e.P0=this.P0,e.F0=this.F0,e.ws=this.ws,e.pr=this.pr.P(),e.yr=this.yr.P(),e.$n=this.$n,e.D0=this.D0,e.T0=this.T0,e.gr=this.gr,e.b0=this.b0,e.G0=this.G0,e.K0=this.K0,e}}class zn{constructor(){g(this,"m");this.m=[1,0,0,1,0,0]}copy(){const e=new zn;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e}translate(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t}scale(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t}rotate(e,t,i){if(e>=360?e-=360:e<0&&(e+=360),e===0)return;this.translate(t,i);let s=0,n=0;if(e===90)s=0,n=1;else if(e===180)s=-1,n=0;else if(e===270)s=0,n=-1;else{const l=e*Math.PI/180;s=Math.cos(l),n=Math.sin(l)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,a=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=a,this.m[3]=h,this.translate(-t,-i)}}class cn{constructor(e){g(this,"type");g(this,"x1");g(this,"y1");g(this,"r1");g(this,"x2");g(this,"y2");g(this,"r2");g(this,"colors");g(this,"pattern");this.type=e,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(e,t){this.colors.push({offset:e,color:t})}}class dn{constructor(e,t,i){g(this,"Tt");g(this,"li");g(this,"jr");g(this,"Gu");g(this,"T2");const s=t===void 0?w.document:t;this.jr=s,this.T2="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.Tt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.Tt.setAttributeNS(n,"xmlns",this.T2),this.Tt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.Gu=null,this.li=new Ge(this,i)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",this.Tt.setAttributeNS(null,"width",i+"px"),this.Tt.setAttributeNS(null,"height",s+"px"),this.Tt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this.li.D2.firstElementChild.setAttributeNS(null,"width",i+"px"),this.li.D2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(e,t,i){const s=this.jr.createElementNS(this.T2,e);if(u.G(t))for(const n in t)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,t[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.Tt.getBoundingClientRect()}focus(){this.Tt.focus()}get width(){return this.Tt.width.baseVal.value}set width(e){this.Tt.setAttribute("width",e+"px")}get height(){return this.Tt.height.baseVal.value}set height(e){this.Tt.setAttribute("height",e+"px")}dispose(){this.jr=null}get style(){return this.Tt.style}}class Ge{constructor(e,t){g(this,"nf");g(this,"of");g(this,"un");g(this,"Li");g(this,"ze");g(this,"fillStyle");g(this,"font");g(this,"globalAlpha");g(this,"lineCap");g(this,"lineDashOffset");g(this,"lineJoin");g(this,"lineWidth");g(this,"miterLimit");g(this,"shadowBlur");g(this,"shadowColor");g(this,"shadowOffsetX");g(this,"shadowOffsetY");g(this,"strokeStyle");g(this,"textAlign");g(this,"imageSmoothingEnabled");g(this,"clipInsteadOfFill");g(this,"lastCreatedElement");g(this,"rf");g(this,"lf");g(this,"surface");g(this,"svg");g(this,"D2");g(this,"TA");g(this,"qb");g(this,"Io");g(this,"ph");g(this,"Ma");g(this,"currentElement");g(this,"clipPathGroup");g(this,"diagramGroup");g(this,"lastDrawnPart");g(this,"currentPath");g(this,"outerGroup");g(this,"pathAttributes");g(this,"Zr");g(this,"kr");g(this,"filter");g(this,"partClipRect");if(this.surface=e,this.svg=e.Tt,this.rf=[],this.lf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.Zr=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.un=0,this.lastCreatedElement=null,this.currentElement=null,this.Li=[],this.pathAttributes={},this.qb=!1,this.Io=null,this.ph=0,this.ze=new zn,e.jr===null||e.jr===void 0)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=I.pw++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:e.width,height:e.height};s.appendChild(this.makeElement("rect",n)),this.D2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")"),this.TA={},this.kr=!!t,this.filter="",this.partClipRect=null}setDiagramPosScale(e,t,i,s,n,o){this.diagramGroup===void 0?this.newGroup(e,t,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+e+", "+t+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(e,t,i,s,n,o,r,a){const h=2*Math.PI,l=1e-6,c=h-l,d=i*Math.cos(s),f=i*Math.sin(s),m=e+d,p=t+f,y=o?0:1;let x=o?s-n:n-s;(Math.abs(r-m)>l||Math.abs(a-p)>l)&&this.Li.push(["L",m,+p]),x<0&&(x=x%h+h),x>c?(this.Li.push(["A",i,i,0,1,y,e-d,t-f]),this.Li.push(["A",i,i,0,1,y,m,p])):x>l&&this.Li.push(["A",i,i,0,+(x>=Math.PI),y,e+i*Math.cos(n),t+i*Math.sin(n)])}beginPath(){this.Li=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(e){this.ov(this.Li,this.ze,e||0)}bezierCurveTo(e,t,i,s,n,o){this.Li.push(["C",e,t,i,s,n,o])}clearRect(e,t,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Li.push(["z"])}createLinearGradient(e,t,i,s){const n=new cn("linear");return n.x1=e,n.y1=t,n.x2=i,n.y2=s,n}createPattern(e,t){let i="";e instanceof HTMLCanvasElement&&(i=e.toDataURL()),e instanceof HTMLImageElement&&(i=e.getAttribute("src"));const s=this.TA;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+I.pw++,o={width:e.width,height:e.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:e.width,height:e.height,href:i},a=this.makeElement("pattern",o);return a.appendChild(this.makeElement(zt.img,r)),this.svg.appendChild(a),s[i]=n,"url(#"+n+")"}createRadialGradient(e,t,i,s,n,o){const r=new cn("radial");return r.x1=e,r.y1=t,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(e,t,i,s,n,o,r,a){const h=r/i,l=a/s;(n!==0||o!==0)&&this.ze.translate(n,o),(h!==1||l!==1)&&this.ze.scale(h,l),(e!==0||t!==0)&&this.ze.translate(-e,-t)}drawImage(e,t,i,s,n,o,r,a,h){let l="";e instanceof HTMLCanvasElement&&(l=e.toDataURL()),e instanceof HTMLImageElement&&(l=e.getAttribute("src"));const c=e instanceof HTMLImageElement?e.naturalWidth:e.width,d=e instanceof HTMLImageElement?e.naturalHeight:e.height;s===void 0&&(o=t,r=i,a=s=c,h=n=d),s=s||0,n=n||0,o=o||0,r=r||0,a=a||0,h=h||0,this.amendImageTransform(t,i,s,n,o,r,a,h);const f={x:0,y:0,width:c||s,height:d||n,href:l};!O.z(s,a)||!O.z(n,h)?f.preserveAspectRatio="none":l.toLowerCase().indexOf(".svg")===-1&&l.toLowerCase().indexOf("data:image/svg")===-1&&(f.preserveAspectRatio="xMidYMid slice"),(t!==0||i!==0||s!==c||n!==d)&&(s+=t,n+=i,f["clip-path"]=`path('M ${t},${i} L ${s} ${i} L ${s} ${n} L ${t} ${n} z')`),this.processCommon(zt.img,f,this.ze),this._u(zt.img,f)}fill(e,t){e&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(e,t,i){this.clipInsteadOfFill?this.clip():this.fill(t,i)}createOrUpdateClipGroup(e,t){const i=this.newGroup(1,0,0,1,-t.x,-t.y);i.setAttributeNS(null,"class","spotClip"),e.ah=i}fillRect(e,t,i,s){this.addRect("fill",[e,t,i,s],this.ze)}fillBackground(e,t,i,s){const n={x:e,y:t,width:i,height:s};this.processCommon("fill",n,this.ze),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(e,t,i){this.addText("fill",[e,t,i],this.ze)}lineTo(e,t){this.Li.push(["L",e,t])}moveTo(e,t){this.Li.push(["M",e,t])}quadraticCurveTo(e,t,i,s){this.Li.push(["Q",e,t,i,s])}rect(e,t,i,s){this.Li.push(["M",e,t],["L",e+i,t],["L",e+i,t+s],["L",e,t+s],["z"])}restore(){this.ze=this.rf.pop(),this.Li=this.rf.pop();const e=this.rf.pop();this.fillStyle=e.fillStyle,this.font=e.font,this.globalAlpha=e.globalAlpha,this.lineCap=e.lineCap,this.lineDashOffset=e.lineDashOffset,this.lineJoin=e.lineJoin,this.lineWidth=e.lineWidth,this.miterLimit=e.miterLimit,this.shadowBlur=e.shadowBlur,this.shadowColor=e.shadowColor,this.shadowOffsetX=e.shadowOffsetX,this.shadowOffsetY=e.shadowOffsetY,this.strokeStyle=e.strokeStyle,this.textAlign=e.textAlign,this.partClipRect=e.partClipRect}save(){const e={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.rf.push(e);const t=[];for(let i=0;i<this.Li.length;i++)t.push(this.Li[i]);this.rf.push(t),this.rf.push(this.ze.copy())}setTransform(e,t,i,s,n,o){e===1&&t===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(e,t,i,s,n,o)}setCurrentTransform(e,t,i,s,n,o){this.ze.m=[e,t,i,s,n,o]}getCurrentTransform(){const e=this.ze.m;return"matrix("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}scale(e,t){this.ze.scale(e,t)}translate(e,t){this.ze.translate(e,t)}transform(e,t,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(e,t,i,s){this.addRect("stroke",[e,t,i,s],this.ze)}makeElement(e,t,i){return this.surface.makeElement(e,t,i)}_u(e,t,i){const s=this.makeElement(e,t,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(e,t,i){if(e==="fill"?this.setFill(t):e==="stroke"&&this.setStroke(t),i!==null){const s=i.m;t.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(e){if(this.fillStyle instanceof cn){e.fill=this.addGradient(this.fillStyle,!0);return}if(/^rgba\(/.test(this.fillStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.fill="rgb("+t[1]+","+t[2]+","+t[3]+")",e["fill-opacity"]=t[4]}else e.fill=this.fillStyle}setFillOrStrokeInPlace(e,t){const i=t?"fill":"stroke";if(this.fillStyle instanceof cn){e.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0));return}if(/^rgba\(/.test(this.fillStyle)){const s=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);e.setAttributeNS(null,i,"rgb("+s[1]+","+s[2]+","+s[3]+")"),e.setAttributeNS(null,i+"-opacity",s[4])}else e.setAttributeNS(null,i,this.fillStyle)}setStroke(e){if(this.strokeStyle instanceof cn)e.stroke=this.addGradient(this.strokeStyle,!1);else if(/^rgba\(/.test(this.strokeStyle)){const t=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);e.stroke="rgb("+t[1]+","+t[2]+","+t[3]+")",e["stroke-opacity"]=t[4]}else e.stroke=this.strokeStyle;e["stroke-width"]=this.lineWidth,e["stroke-linecap"]=this.lineCap,e["stroke-linejoin"]=this.lineJoin,e["stroke-miterlimit"]=this.miterLimit,this.qb&&(e["stroke-dasharray"]=this.Io.toString(),e["stroke-dashoffset"]=this.ph)}addGradient(e,t){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(t?"fill":"stroke"):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const h=this.svg.getElementById(i);h!==null&&h.remove()}else i="GRAD"+I.pw++;let n;if(e.type==="linear"){const h={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",h)}else if(e.type==="radial"){const h={x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,r1:e.r1,r2:e.r2,id:i};n=this.makeElement("radialGradient",h)}else u.o("invalid gradient");const o=e.colors,r=o.length,a=[];for(let h=0;h<r;h++){const l=o[h],c=l.color,d={offset:l.offset,"stop-color":c};if(/^rgba\(/.test(c)){const f=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(c);d["stop-color"]="rgb("+f[1]+","+f[2]+","+f[3]+")",d["stop-opacity"]=f[4]}a.push(d)}a.sort((h,l)=>h.offset>l.offset?1:-1);for(let h=0;h<r;h++)n.appendChild(this.makeElement("stop",a[h]));return this.svg.appendChild(n),"url(#"+i+")"}addRect(e,t,i){const s={x:t[0],y:t[1],width:t[2],height:t[3]};this.processCommon(e,s,i),this._u("rect",s)}addText(e,t,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:t[1],y:t[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(e,n,i),this._u("text",n,t[0])}ov(e,t,i){const s=this.rv(e),n=this.pathAttributes;if(n.clipPath){this.lf.length>1&&this.lf[this.lf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,t),this.currentPath!==null){const o=this.currentPath;if(o.nodeName!=="g")for(const r in n)r!=="transform"&&o.setAttributeNS(null,r,n[r]);else{const r=o.getElementsByTagName("path");for(const a in n)a!=="transform"&&r[i].setAttributeNS(null,a,n[a])}}else this._u("path",n)}rv(e){const t=[];for(let i=0;i<e.length;i++){const s=e[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());t.push(n.join(" "))}return t.join(" ")}newGroup(e,t,i,s,n,o){const r=new zn;r.m=[e,t,i,s,n,o];const a={};this.processCommon("g",a,r);const h=this._u("g",a);return this.lf.push(h),h}newGroup2(e){const t={};e&&(t.class=e);const i=this._u("g",t);return this.lf.push(i),i}endGroup(){return this.lf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(e,t,i){this.nf=e,this.of=t,this.un=i}shadowsOff(){this.Zr=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.Zr=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.un}enableDash(e,t){this.qb=!0,this.Io=e,this.ph=t}disableDash(){this.qb=!1}clearContextCache(e){}setImageSmoothingEnabled(e){}rotate(e){this.ze.rotate(e*57.2958,0,0)}getImageData(e,t,i,s){return null}measureText(e){return null}removeOldGradient(e,t,i){const s=t.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(e){e.svg!==null&&e.svg.parentNode===this.diagramGroup&&e.svg.remove()}}class $i{constructor(e,t,i,s){g(this,"Tt");g(this,"li");g(this,"jr");g(this,"Gu");const n=t===void 0?w.document:t;this.jr=n,this.Gu=null;const o=n.createElement("canvas");o.tabIndex=0,this.Tt=o,this.li=new fn(o,i,s),zt.Qe.set(o,e)}resize(e,t,i,s){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(e,t){return this.Tt.toDataURL(e,t)}getBoundingClientRect(){return this.Tt.getBoundingClientRect()}focus(){this.Tt.focus()}get width(){return this.Tt.width}set width(e){this.Tt.width=e}get height(){return this.Tt.height}set height(e){this.Tt.height=e}dispose(){zt.Qe.delete(this.Tt),this.jr=null}get style(){return this.Tt.style}}const Gn=class Gn{constructor(e,t,i){g(this,"E");g(this,"Wb");g(this,"Jb");g(this,"$b");g(this,"clipInsteadOfFill");g(this,"nf");g(this,"of");g(this,"un");g(this,"Ma");g(this,"Zr");g(this,"kr");this.E=e.getContext?e.getContext("2d",t):null,this.E===null&&u.o("Browser does not support HTML Canvas Element"),this.Wb="",this.Jb="",this.$b="",this.clipInsteadOfFill=!1,this.nf=0,this.of=0,this.un=0,this.Zr=!1,this.Ma=new Pt,this.kr=!!i}createOrUpdateClipGroup(e,t){}setImageSmoothingEnabled(e){this.E.imageSmoothingEnabled=e}get fillStyle(){return this.E.fillStyle}set fillStyle(e){this.$b!==e&&(this.E.fillStyle=e,this.$b=e)}get font(){return this.E.font}set font(e){this.Wb!==e&&(this.E.font=e,this.Wb=e)}get globalAlpha(){return this.E.globalAlpha}set globalAlpha(e){this.E.globalAlpha=e}get lineCap(){return this.E.lineCap}set lineCap(e){this.E.lineCap=e}get lineDashOffset(){return this.E.lineDashOffset}set lineDashOffset(e){this.E.lineDashOffset=e}get lineJoin(){return this.E.lineJoin}set lineJoin(e){this.E.lineJoin=e}get lineWidth(){return this.E.lineWidth}set lineWidth(e){this.E.lineWidth=e}get miterLimit(){return this.E.miterLimit}set miterLimit(e){this.E.miterLimit=e}get shadowBlur(){return this.E.shadowBlur}set shadowBlur(e){this.E.shadowBlur=e}get shadowColor(){return this.E.shadowColor}set shadowColor(e){this.E.shadowColor=e}get shadowOffsetX(){return this.E.shadowOffsetX}set shadowOffsetX(e){this.E.shadowOffsetX=e}get shadowOffsetY(){return this.E.shadowOffsetY}set shadowOffsetY(e){this.E.shadowOffsetY=e}get strokeStyle(){return this.E.strokeStyle}set strokeStyle(e){this.Jb!==e&&(this.E.strokeStyle=e,this.Jb=e)}get textAlign(){return this.E.textAlign}set textAlign(e){this.E.textAlign=e}get imageSmoothingEnabled(){return this.E.imageSmoothingEnabled}set imageSmoothingEnabled(e){this.E.imageSmoothingEnabled=e}get filter(){return this.E.filter}set filter(e){e===""?this.E.filter="none":this.E.filter=e}arc(e,t,i,s,n,o,r,a){this.E.arc(e,t,i,s,n,o)}beginPath(){this.E.beginPath()}endPath(){}bezierCurveTo(e,t,i,s,n,o){this.E.bezierCurveTo(e,t,i,s,n,o)}clearRect(e,t,i,s){this.commitTransform(),this.E.clearRect(e,t,i,s)}clip(e){e?this.E.clip(e):this.E.clip()}closePath(){this.E.closePath()}createLinearGradient(e,t,i,s){return this.E.createLinearGradient(e,t,i,s)}createPattern(e,t){return this.E.createPattern(e,t)}createRadialGradient(e,t,i,s,n,o){return this.E.createRadialGradient(e,t,i,s,n,o)}drawImage(e,t,i,s,n,o,r,a,h){s===void 0?this.E.drawImage(e,t,i):this.E.drawImage(e,t,i,s,n,o,r,a,h)}fill(e,t){t?this.E.fill(t,e?"evenodd":"nonzero"):this.E.fill(e?"evenodd":"nonzero")}fillRect(e,t,i,s){this.E.fillRect(e,t,i,s)}fillBackground(e,t,i,s){this.E.fillRect(e,t,i,s)}fillText(e,t,i){this.E.fillText(e,t,i)}getImageData(e,t,i,s){return this.E.getImageData(e,t,i,s)}lineTo(e,t){this.E.lineTo(e,t)}measureText(e){return this.E.measureText(e)}moveTo(e,t){this.E.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this.E.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this.E.rect(e,t,i,s)}restore(){this.E.restore()}save(){this.commitTransform(),this.E.save()}rotate(e){this.Ma.cs(e*57.2958,0,0)}setTransform(e,t,i,s,n,o){this.Ma.setTo(e,t,i,s,n,o)}scale(e,t){this.Ma.tt(e,t)}translate(e,t){this.Ma.Fs(e,t)}stroke(e){e?this.E.stroke(e):this.E.stroke()}transform(e,t,i,s,n,o){if(e===1&&t===0&&i===0&&s===1&&n===0&&o===0)return;const r=this.Ma,a=r.m11*e+r.m21*t,h=r.m12*e+r.m22*t,l=r.m11*i+r.m21*s,c=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=a,r.m12=h,r.m21=l,r.m22=c}commitTransform(){const e=this.Ma;this.E.setTransform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy)}fillContext(e,t,i){this.radialFill(e,t,i)||this.fillOrClip(t,i)}radialFill(e,t,i){if(!(e instanceof Jt)||e.type!==3)return!1;const s=e._c,n=e.Gb;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(t,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(e,t){this.clipInsteadOfFill?this.clip(t):this.fill(e,t)}shadowsSet(e,t,i){this.nf=e,this.of=t,this.un=i}shadowsOff(){this.Zr=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.Zr=!0,this.shadowOffsetX=this.nf,this.shadowOffsetY=this.of,this.shadowBlur=this.un}enableDash(e,t){const i=this.E;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}disableDash(){const e=this.E;e.setLineDash!==void 0&&(e.setLineDash(Gn.EmptyArray),e.lineDashOffset=0)}clearContextCache(e){e&&(this.Wb=""),this.Jb="",this.$b=""}removePartFromView(e){}};g(Gn,"EmptyArray",Object.freeze([]));let fn=Gn;var Wi=(S=>(S[S.Solid=1]="Solid",S[S.Linear=2]="Linear",S[S.Radial=3]="Radial",S[S.Pattern=4]="Pattern",S))(Wi||{}),ua=(S=>(S[S.Lab=1]="Lab",S[S.HSL=2]="HSL",S[S.Oklch=3]="Oklch",S))(ua||{});class Ts{constructor(){g(this,"n0");g(this,"n1");g(this,"n2");g(this,"n3");this.n0=0,this.n1=0,this.n2=0,this.n3=0}}const X=class X{constructor(e,t){g(this,"h");g(this,"H");g(this,"Na");g(this,"ei");g(this,"gs");g(this,"j0");g(this,"H0");g(this,"Eo");g(this,"q0");g(this,"cn");g(this,"_c");g(this,"Gb");if(I.Ki(this),this.h=!1,e===void 0)this.H=1,this.Na="black";else if(typeof e=="string"){const s=u.Uh(Wi,e);s!==null?(this.H=s,this.Na="black"):(this.H=1,this.Na=e)}else Object.keys(Wi).hasOwnProperty(e)?(this.H=e,this.Na="black"):typeof e=="object"&&(this.H=1,t=e);const i=this.H;if(i===2?(this.ei=U.TopCenter,this.gs=U.BottomCenter):i===3?(this.ei=U.Center,this.gs=U.Center):(this.ei=U.None,this.gs=U.None),this.j0=0,this.H0=NaN,this.Eo=null,this.q0=null,this.cn=null,this._c=0,this.Gb=0,t){const s={};for(const n in t)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),t[n]):s[n]=t[n];Object.assign(this,s)}}copy(){const e=new X;return e.H=this.H,e.Na=this.Na,e.ei=this.ei.P(),e.gs=this.gs.P(),e.j0=this.j0,e.H0=this.H0,this.Eo!==null&&(e.Eo=this.Eo.copy()),e.q0=this.q0,e}u(){return this.h=!0,this.Eo!==null&&this.Eo.u(),this}oi(e){e in Wi?this.type=e:u.er(this,e)}toString(){let e="Brush(";if(this.type===1)e+=this.color;else if(this.type===2?e+="Linear ":this.type===3?e+="Radial ":this.type===4?e+="Pattern ":e+="(unknown) ",e+=this.start+" "+this.end,this.colorStops!==null){const t=this.colorStops.iterator;for(;t.next();){const i=t.key,s=t.value;e+=" "+i+":"+s}}return e+=")",e}addColorStop(e,t){return this.h&&u.L(this),(typeof e!="number"||!isFinite(e)||e>1||e<0)&&u.W(e,"0 <= loc <= 1",X,"addColorStop:loc"),u.s(t,"string",X,"addColorStop:color"),this.Eo===null&&(this.Eo=new Z),this.Eo.set(e,t),this.H===1&&(this.type=2),this.cn=null,this}get type(){return this.H}set type(e){this.h&&u.L(this,e),this.H=e,this.start.isNoSpot()&&(e===2?this.start=U.TopCenter:e===3&&(this.start=U.Center)),this.end.isNoSpot()&&(e===2?this.end=U.BottomCenter:e===3&&(this.end=U.Center)),this.cn=null}get color(){return this.Na}set color(e){this.h&&u.L(this,e),this.Na=e,this.cn=null}get start(){return this.ei}set start(e){this.h&&u.L(this,e),this.ei=e.P(),this.cn=null}get end(){return this.gs}set end(e){this.h&&u.L(this,e),this.gs=e.P(),this.cn=null}get startRadius(){return this.j0}set startRadius(e){this.h&&u.L(this,e),e<0&&u.W(e,">= zero",X,"startRadius"),this.j0=e,this.cn=null}get endRadius(){return this.H0}set endRadius(e){this.h&&u.L(this,e),e<0&&u.W(e,">= zero",X,"endRadius"),this.H0=e,this.cn=null}get colorStops(){return this.Eo}set colorStops(e){this.h&&u.L(this,e),this.Eo=e,this.cn=null}get pattern(){return this.q0}set pattern(e){this.h&&u.L(this,e),this.q0=e,this.cn=null}static randomColor(e,t){e===void 0&&(e=128),t===void 0&&(t=Math.max(e,255));const i=Math.abs(t-e);let s=Math.floor(e+Math.random()*i).toString(16),n=Math.floor(e+Math.random()*i).toString(16),o=Math.floor(e+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(e){return w.CSS?w.CSS.supports("color",e):!0}static lighten(e){return X.lightenBy(e)}lightenBy(e,t){this.h&&u.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)X.No(this.color),this.color=X.td(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)X.No(n.value),this.addColorStop(n.key,X.td(i,s))}return this}static lightenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return X.No(e),X.td(s,n)}static darken(e){return X.darkenBy(e)}darkenBy(e,t){this.h&&u.L(this);const i=e===void 0||typeof e!="number"?.2:e,s=t===void 0?3:t;if(this.type===1)X.No(this.color),this.color=X.td(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)X.No(n.value),this.addColorStop(n.key,X.td(-i,s))}return this}static darkenBy(e,t,i){const s=t===void 0||typeof t!="number"?.2:t,n=i===void 0?3:i;return X.No(e),X.td(-s,n)}static mix(e,t,i){X.No(e);const s=X.Y.n0,n=X.Y.n1,o=X.Y.n2,r=X.Y.n3;X.No(t),i===void 0&&(i=.5);const a=Math.round((X.Y.n0-s)*i+s),h=Math.round((X.Y.n1-n)*i+n),l=Math.round((X.Y.n2-o)*i+o),c=Math.round((X.Y.n3-r)*i+r);return`rgba(${a}, ${h}, ${l}, ${c})`}isDark(){if(this.type===1)return X.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const e=this.colorStops;if(this.type===3)return X.isDark(e.first().value);if(e.get(.5)!==null)return X.isDark(e.get(.5));if(e.count===2){const a=e.toArray();return X.isDark(X.mix(a[0].value,a[1].value))}const t=e.iterator;let i=-1,s=-1,n=1,o=1;for(;t.next();){const a=t.key,h=Math.abs(.5-t.key);n>o&&h<n?(i=a,n=h):o>=n&&h<o&&(s=a,o=h)}if(i>s){let a=i;i=s,s=a,a=n,n=o,o=a}const r=s-i;return X.isDark(X.mix(e.get(i),e.get(s),1-o/r))}return!1}static isDark(e){return e?e instanceof X?e.isDark():(X.No(e),(299*X.Y.n0+587*X.Y.n1+114*X.Y.n2)/1e3<128):!1}static td(e,t){switch(t){case 1:return X.lv(),X.Zn.n0=Math.min(100,Math.max(0,X.Zn.n0+100*e)),X.hv(),"rgba("+X.Y.n0+", "+X.Y.n1+", "+X.Y.n2+", "+X.Y.n3+")";case 2:return X.jS(),X.Ii.n2=Math.min(100,Math.max(0,X.Ii.n2+100*e)),"hsla("+X.Ii.n0+", "+X.Ii.n1+"%, "+X.Ii.n2+"%, "+X.Ii.n3+")";case 3:return X.av(),X.Qn.n0=Math.min(100,Math.max(0,X.Qn.n0+100*e)),X.cv(),"rgba("+X.Y.n0+", "+X.Y.n1+", "+X.Y.n2+", "+X.Y.n3+")";default:u.o("Unknown color space: "+t)}}static No(e){X.W0===!1&&(X.W0=!0,X._n=zt.isUsingDOM()?new $i(null,void 0,{willReadFrequently:!0}).li:null);const t=X._n;if(t===null)return;t.clearRect(0,0,1,1),t.fillStyle="#000000";const i=t.fillStyle;if(t.fillStyle=e,t.fillStyle!==i){t.fillRect(0,0,1,1);const s=t.getImageData(0,0,1,1).data;X.Y.n0=s[0],X.Y.n1=s[1],X.Y.n2=s[2],X.Y.n3=s[3]/255}else t.fillStyle="#FFFFFF",t.fillStyle,t.fillStyle=e,t.fillStyle,X.Y.n0=0,X.Y.n1=0,X.Y.n2=0,X.Y.n3=1}static jS(){const e=X.Y.n0/255,t=X.Y.n1/255,i=X.Y.n2/255,s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n;let r,a;const h=(s+n)/2;if(o===0)r=a=0;else{switch(s){case e:r=(t-i)/o%6;break;case t:r=(i-e)/o+2;break;case i:r=(e-t)/o+4;break}r*=60,r<0&&(r+=360),a=o/(1-Math.abs(2*h-1))}X.Ii.n0=Math.round(r),X.Ii.n1=Math.round(a*100),X.Ii.n2=Math.round(h*100),X.Ii.n3=X.Y.n3}static DE(){const e=X.Ii.n0,t=X.Ii.n1/100,i=X.Ii.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*t,a=e/60,h=r*(1-Math.abs(a%2-1));a>=0&&a<1?(s=r,n=h,o=0):a>=1&&a<2?(s=h,n=r,o=0):a>=2&&a<3?(s=0,n=r,o=h):a>=3&&a<4?(s=0,n=h,o=r):a>=4&&a<5?(s=h,n=0,o=r):a>=5&&a<6&&(s=r,n=0,o=h);const l=i-.5*r;s+=l,n+=l,o+=l,X.Y.n0=Math.round(s*255),X.Y.n1=Math.round(n*255),X.Y.n2=Math.round(o*255),X.Y.n3=X.Ii.n3}static lv(){X.DA(),X.fv()}static hv(){X.uv(),X.FA()}static F2(e){return e/=255,e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}static R2(e){return e<=.0031308?e*12.92:1.055*Math.pow(e,1/2.4)-.055}static DA(){const e=X.F2(X.Y.n0),t=X.F2(X.Y.n1),i=X.F2(X.Y.n2);X.Dt.n0=.4124564*e+.3575761*t+.1804375*i,X.Dt.n1=.2126729*e+.7151522*t+.072175*i,X.Dt.n2=.0193339*e+.119192*t+.9503041*i,X.Dt.n3=X.Y.n3}static FA(){const e=3.2404542*X.Dt.n0+-1.5371385*X.Dt.n1+-.4985314*X.Dt.n2,t=-.969266*X.Dt.n0+1.8760108*X.Dt.n1+.041556*X.Dt.n2,i=.0556434*X.Dt.n0+-.2040259*X.Dt.n1+1.0572252*X.Dt.n2;X.Y.n0=X.R2(e)*255,X.Y.n1=X.R2(t)*255,X.Y.n2=X.R2(i)*255,X.Y.n3=X.Dt.n3,X.Y.n0=Math.round(X.Y.n0),X.Y.n0>255?X.Y.n0=255:X.Y.n0<0&&(X.Y.n0=0),X.Y.n1=Math.round(X.Y.n1),X.Y.n1>255?X.Y.n1=255:X.Y.n1<0&&(X.Y.n1=0),X.Y.n2=Math.round(X.Y.n2),X.Y.n2>255?X.Y.n2=255:X.Y.n2<0&&(X.Y.n2=0)}static O2(e){return e>X.v2?Math.pow(e,1/3):(X.Zb*e+16)/116}static fv(){const e=X.O2(X.Dt.n0*100/X.ed[0]),t=X.O2(X.Dt.n1*100/X.ed[1]),i=X.O2(X.Dt.n2*100/X.ed[2]);X.Zn.n0=116*t-16,X.Zn.n1=500*(e-t),X.Zn.n2=200*(t-i),X.Zn.n3=X.Dt.n3}static RA(e){const t=e*e*e;return t>X.v2?t:(116*e-16)/X.Zb}static uv(){const e=(X.Zn.n0+16)/116,t=X.Zn.n1/500+e,i=e-X.Zn.n2/200;X.Dt.n0=X.ed[0]/100*X.RA(t),X.Dt.n1=X.ed[1]/100*(X.Zn.n0>X.Zb*X.v2?Math.pow(e,3):X.Zn.n0/X.Zb),X.Dt.n2=X.ed[2]/100*X.RA(i),X.Dt.n3=X.Zn.n3}static dv(){let e=.8190224*X.Dt.n0+.3619062*X.Dt.n1+-.1288737*X.Dt.n2,t=.03298366*X.Dt.n0+.9292868*X.Dt.n1+.03614466*X.Dt.n2,i=.04817719*X.Dt.n0+.2642395*X.Dt.n1+.6335478*X.Dt.n2;e=Math.cbrt(e),t=Math.cbrt(t),i=Math.cbrt(i),X.ai.n0=.2104542*e+.7936177*t+-.004072046*i,X.ai.n1=1.977998*e+-2.428592*t+.4505937*i,X.ai.n2=.02590403*e+.7827717*t+-.8086757*i,X.ai.n3=X.Dt.n3,X.ai.n0*=100}static gv(){X.ai.n0/=100;let e=.9999999*X.ai.n0+.3963377*X.ai.n1+.2158037*X.ai.n2,t=1.000000009*X.ai.n0+-.1055613*X.ai.n1+-.06385417*X.ai.n2,i=1.00000005*X.ai.n0+-.08948418*X.ai.n1+-1.291485*X.ai.n2;e=e**3,t=t**3,i=i**3,X.Dt.n0=1.2268798*e+-.5578149*t+.281391*i,X.Dt.n1=-.04057576*e+1.112286*t+-.07171106*i,X.Dt.n2=-.07637294*e+-.4214933*t+1.586924*i,X.Dt.n3=X.ai.n3}static mv(){const e=Math.atan2(X.ai.n2,X.ai.n1)*180/Math.PI;X.Qn.n0=X.ai.n0,X.Qn.n1=Math.sqrt(X.ai.n1**2+X.ai.n2**2),X.Qn.n2=e>=0?e:e+360,X.Qn.n3=X.ai.n3}static pv(){X.ai.n0=X.Qn.n0,X.ai.n1=X.Qn.n1*Math.cos(X.Qn.n2*Math.PI/180),X.ai.n2=X.Qn.n1*Math.sin(X.Qn.n2*Math.PI/180),X.ai.n3=X.Qn.n3}static av(){X.DA(),X.dv(),X.mv()}static cv(){X.pv(),X.gv(),X.FA()}static Qu(e,t){typeof e=="string"||e instanceof X||u.o("Value for "+t+" must be a color string or a Brush, not "+e)}};g(X,"v2",216/24389),g(X,"Zb",24389/27),g(X,"ed",[95.047,100,108.883]),g(X,"Solid",1),g(X,"Linear",2),g(X,"Radial",3),g(X,"Pattern",4),g(X,"Lab",1),g(X,"HSL",2),g(X,"_n",null),g(X,"W0",!1),g(X,"Y",new Ts),g(X,"Ii",new Ts),g(X,"Dt",new Ts),g(X,"Zn",new Ts),g(X,"ai",new Ts),g(X,"Qn",new Ts);let Jt=X;const Hn=class Hn{constructor(){g(this,"St","Base")}static dn(e,t){t.name=e,Hn.es.set(e,t)}get name(){return this.St}set name(e){this.St=e}get classType(){return bt}measure(e,t,i,s,n,o,r){}measureElement(e,t,i,s,n){e.ht(t,i,s,n)}arrange(e,t,i){}arrangeElement(e,t,i,s,n,o){e.Bt(t,i,s,n,o)}remeasureObject(e){e.tf()}Ui(e,t,i){}};g(Hn,"es",new Z);let Yt=Hn;class nu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=e.Uo();for(let l=0;l<a;l++){const c=s[l];if(!c.visible&&c!==h)continue;const d=c.margin,f=d.right+d.left,m=d.top+d.bottom;c.ht(t,i,o,r);const p=c.measuredBounds,y=Math.max(p.width+f,0),x=Math.max(p.height+m,0);let b=c.position.x,M=c.position.y;if(isFinite(b)||(b=0),isFinite(M)||(M=0),c instanceof At&&c.isGeometryPositioned){const P=c.strokeWidth/2;b-=P,M-=P}n.unionNoCheck(b,M,y,x)}}arrange(e,t,i){const s=t.length,n=e.padding,o=i.x-n.left,r=i.y-n.top;for(let a=0;a<s;a++){const h=t[a],l=h.measuredBounds,c=h.margin,d=h.position.x,f=h.position.y;let m=isNaN(d)?-o:d-o,p=isNaN(f)?-r:f-r;if(h instanceof At&&h.isGeometryPositioned){const y=h.strokeWidth/2;m-=y,p-=y}h.visible&&h.Bt(m+c.left,p+c.top,l.width,l.height)}}}Yt.dn("Position",new nu);class ou extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=u.et(),l=e.Uo();for(let d=0;d<a;d++){const f=s[d];if(!f.visible&&f!==l)continue;const m=f.zs(!1);if(m!==0&&m!==5){h.push(f);continue}f.ht(1/0,i,0,r);const p=f.margin,y=f.measuredBounds,x=Math.max(y.width+p.right+p.left,0),b=Math.max(y.height+p.top+p.bottom,0);n.Fn(n.width+x,Math.max(n.height,b))}const c=h.length;e.desiredSize.height?i=Math.min(e.desiredSize.height,e.maxSize.height):n.height!==0&&(i=Math.min(n.height,e.maxSize.height));for(let d=0;d<c;d++){const f=h[d];if(!f.visible&&f!==l)continue;const m=f.margin,p=m.right+m.left,y=m.top+m.bottom;f.ht(1/0,i,0,r);const x=f.measuredBounds,b=Math.max(x.width+p,0),M=Math.max(x.height+y,0);n.width+=b,n.height=Math.max(n.height,M)}u.J(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.top,r=e.isOpposite;let a=r?i.width:n.left;for(let h=0;h<s;h++){const l=o,c=t[h];if(!c.visible)continue;const d=c.measuredBounds,f=c.margin,m=f.top+f.bottom,p=o+n.bottom;let y=d.height;const x=c.zs(!1);(isNaN(c.desiredSize.height)&&x===2||x===4)&&(y=Math.max(i.height-m-p,0));const b=y+m+p;let M=c.alignment;M.isDefault()&&(M=e.defaultAlignment),M.isSpot()||(M=U.Center),r&&(a-=d.width+f.left+f.right),c.Bt(a+M.offsetX+f.left,l+M.offsetY+f.top+(i.height*M.y-b*M.y),d.width,y),r||(a+=d.width+f.left+f.right)}}}Yt.dn("Horizontal",new ou);class ru extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length,h=u.et(),l=e.Uo();for(let d=0;d<a;d++){const f=s[d];if(!f.visible&&f!==l)continue;const m=f.zs(!1);if(m!==0&&m!==4){h.push(f);continue}f.ht(t,1/0,o,0);const p=f.margin,y=f.measuredBounds,x=Math.max(y.width+p.right+p.left,0),b=Math.max(y.height+p.top+p.bottom,0);n.Fn(Math.max(n.width,x),n.height+b)}const c=h.length;e.desiredSize.width?t=Math.min(e.desiredSize.width,e.maxSize.width):n.width!==0&&(t=Math.min(n.width,e.maxSize.width));for(let d=0;d<c;d++){const f=h[d];if(!f.visible&&f!==l)continue;const m=f.margin,p=m.right+m.left,y=m.top+m.bottom;f.ht(t,1/0,o,0);const x=f.measuredBounds,b=Math.max(x.width+p,0),M=Math.max(x.height+y,0);n.width=Math.max(n.width,b),n.height+=M}u.J(h)}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=e.isOpposite;let a=r?i.height:n.top;for(let h=0;h<s;h++){const l=o,c=t[h];if(!c.visible)continue;const d=c.measuredBounds,f=c.margin,m=f.left+f.right,p=o+n.right;let y=d.width;const x=c.zs(!1);(isNaN(c.desiredSize.width)&&x===2||x===5)&&(y=Math.max(i.width-m-p,0));const b=y+m+p;let M=c.alignment;M.isDefault()&&(M=e.defaultAlignment),M.isSpot()||(M=U.Center),r&&(a-=d.height+f.bottom+f.top),c.Bt(l+M.offsetX+f.left+(i.width*M.x-b*M.x),a+M.offsetY+f.top,y,d.height),r||(a+=d.height+f.bottom+f.top)}}}Yt.dn("Vertical",new ru);const yn=class yn extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(a===0)return;const h=e.findMainElement();let l=h.margin,c=0,d=0;const f=l.right+l.left,m=l.top+l.bottom;h.ht(t,i,o,r);let p=h.measuredBounds,y=p.width,x=p.height,b=Math.max(y+f,0),M=Math.max(x+m,0);const P=e.isClipping;P&&h.y0()!==0&&!yn.vA&&(yn.vA=!0,u.ni("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+e.toString()));const k=G.V(-l.left,-l.top,b,M);let L=G.V(0,0,y,x);this.I2(h,L,!0),y=L.width,x=L.height;let T=!0;const D=e.Uo();let B;for(let E=0;E<a;E++){const R=s[E];let F=t,V=i;if(R===h||!R.visible&&R!==D)continue;l=R.margin;let K=l.left,H=l.top;switch(c=l.right+l.left,d=l.top+l.bottom,B=R.zs(!1),B){case 2:F=y,V=x,c=0,d=0,K=0,H=0;break;case 5:F=y,c=0,K=0;break;case 4:V=x,d=0,H=0;break}R.ht(F,V,0,0),p=R.measuredBounds,b=Math.max(p.width+c,0),M=Math.max(p.height+d,0);let W=R.alignment;W.isDefault()&&(W=e.defaultAlignment),W.isSpot()||(W=U.Center);let J=R.alignmentFocus;J.isDefault()&&(J=U.Center);let $=null;R instanceof bt&&R.to!==""&&($=R.findObject(R.to),$===R&&($=null));let et=L.x-K,ot=L.y-H;if($!==null){R.Bt(0,0,p.width,p.height);const Ct=$.actualBounds,ht=C.V(Ct.x+(J.x*Ct.width-J.offsetX),Ct.y+(J.y*Ct.height-J.offsetY));for($=$.panel;$!==R;)$.T.gt(ht),$=$.panel;et+=W.x*y+W.offsetX-ht.x,ot+=W.y*x+W.offsetY-ht.y,C.e(ht)}else et+=W.x*y+W.offsetX-(J.x*p.width+J.offsetX),ot+=W.y*x+W.offsetY-(J.y*p.height+J.offsetY);T?(T=!1,n.i(et,ot,b,M)):n.unionNoCheck(et,ot,b,M)}switch(T?n.a(k):P?n.intersect(L.x,L.y,L.width,L.height):n.unionNoCheck(k.x,k.y,k.width,k.height),G.e(k),G.e(L),B=h.stretch,B===1&&(B=h.zs(!1)),B){case 0:return;case 2:if(!isFinite(t)&&!isFinite(i))return;break;case 5:if(!isFinite(t))return;break;case 4:if(!isFinite(i))return;break}p=h.measuredBounds,y=p.width,x=p.height,b=Math.max(y+f,0),M=Math.max(x+m,0),l=h.margin,L=G.V(-l.left,-l.top,b,M),this.I2(h,L,!0),y=L.width,x=L.height;for(let E=0;E<a;E++){const R=s[E];if(R===h||!R.visible&&R!==D)continue;l=R.margin,c=l.right+l.left,d=l.top+l.bottom,p=R.measuredBounds,b=Math.max(p.width+c,0),M=Math.max(p.height+d,0);let F=R.alignment;F.isDefault()&&(F=e.defaultAlignment),F.isSpot()||(F=U.Center);let V=R.alignmentFocus;V.isDefault()&&(V=U.Center),T?(T=!1,n.i(F.x*y+F.offsetX-(V.x*p.width+V.offsetX)-l.left,F.y*x+F.offsetY-(V.y*p.height+V.offsetY)-l.top,b,M)):n.unionNoCheck(F.x*y+F.offsetX-(V.x*p.width+V.offsetX)-l.left,F.y*x+F.offsetY-(V.y*p.height+V.offsetY)-l.top,b,M)}T?n.a(k):P?n.intersect(L.x,L.y,L.width,L.height):n.unionNoCheck(k.x,k.y,k.width,k.height),G.e(L)}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=o.width,a=o.height,h=e.padding,l=h.left,c=h.top;let d=l-i.x,f=c-i.y;n.Bt(d,f,r,a);const m=G.V(0,0,r,a);this.I2(n,m,!1);for(let p=0;p<s;p++){const y=t[p];if(y===n)continue;const x=y.measuredBounds,b=x.width,M=x.height;let P=y.alignment;P.isDefault()&&(P=e.defaultAlignment),P.isSpot()||(P=U.Center);let k=y.alignmentFocus;k.isDefault()&&(k=U.Center);let L=null;if(y instanceof bt&&y.to!==""&&(L=y.findObject(y.to),L===y&&(L=null)),L!==null){const T=L.actualBounds,D=C.V(T.x+(k.x*T.width-k.offsetX),T.y+(k.y*T.height-k.offsetY));for(L=L.panel;L!==y;)L.T.gt(D),L=L.panel;d=P.x*m.width+P.offsetX-D.x,f=P.y*m.height+P.offsetY-D.y,C.e(D)}else d=P.x*m.width+P.offsetX-(k.x*b+k.offsetX),f=P.y*m.height+P.offsetY-(k.y*M+k.offsetY);d+=m.x-i.x,f+=m.y-i.y,y.visible&&y.Bt(l+d,c+f,b,M)}G.e(m)}I2(e,t,i){let s=null;if(e instanceof bt&&e.to!==""&&(s=e.findObject(e.to),s===e&&(s=null)),s!==null)for(i&&e.Bt(0,0,t.width,t.height),t.a(s.actualBounds),s=s.panel;s!==e;)s.T.vg(t),s=s.panel}};g(yn,"vA",!1);let Ao=yn;Yt.dn("Spot",new Ao);class au extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(a===0)return;const h=e.findMainElement();let l=h.margin,c=t,d=i;const f=l.right+l.left,m=l.top+l.bottom;h.ht(t,i,o,r);let p=h.measuredBounds,y=0,x=null;h instanceof At&&(x=h,y=x.strokeWidth*x.scale);let b=Math.max(p.width+f,0),M=Math.max(p.height+m,0),P=e.E2(h);const k=P.x*b+P.offsetX,L=P.y*M+P.offsetY;let T=e.U2(h);const D=T.x*b+T.offsetX,B=T.y*M+T.offsetY;isFinite(t)&&(c=Math.max(Math.abs(k-D)-y,0)),isFinite(i)&&(d=Math.max(Math.abs(L-B)-y,0));let E=0,R=0;o>0&&(E=Math.max(Math.abs(P.x*o+P.offsetX-(T.x*o+T.offsetX))-y,0)),r>0&&(R=Math.max(Math.abs(P.y*r+P.offsetY-(T.y*r+T.offsetY))-y,0));const F=rt.l();F.i(0,0);const V=e.Uo();for(let J=0;J<a;J++){const $=s[J];if($===h||!$.visible&&$!==V)continue;l=$.margin;const et=l.right+l.left,ot=l.top+l.bottom;$.ht(c,d,E,R),p=$.measuredBounds,b=Math.max(p.width+et,0),M=Math.max(p.height+ot,0),F.i(Math.max(b,F.width),Math.max(M,F.height))}if(a===1){p=h.measuredBounds,n.width=b,n.height=M,rt.e(F);return}P=e.E2(h),T=e.U2(h);let K=0,H=0;T.x!==P.x&&T.y!==P.y&&(K=F.width/Math.abs(T.x-P.x),H=F.height/Math.abs(T.y-P.y)),rt.e(F),y=0,x!==null&&(y=x.strokeWidth*x.scale,x.aS()===6&&(K=H=Math.max(K,H))),K+=Math.abs(P.offsetX)+Math.abs(T.offsetX)+y,H+=Math.abs(P.offsetY)+Math.abs(T.offsetY)+y;let W=h.stretch;switch(W===1&&(W=h.zs(!1)),W){case 0:o=0,r=0;break;case 2:isFinite(t)&&(K=t),isFinite(i)&&(H=i);break;case 5:isFinite(t)&&(K=t),r=0;break;case 4:o=0,isFinite(i)&&(H=i);break}h.tf(),h.ht(K,H,o,r),n.width=h.measuredBounds.width+f,n.height=h.measuredBounds.height+m}arrange(e,t,i){const s=t.length;if(s===0)return;const n=e.findMainElement(),o=n.measuredBounds,r=G.l();r.i(0,0,1,1);let a=n.margin;const h=a.left,l=a.top,c=e.padding,d=c.left,f=c.top;let m=h,p=l,y=o.width,x=o.height;n.Bt(d+m,f+p,y,x);const b=e.E2(n),M=e.U2(n),P=0+b.x*o.width+b.offsetX,k=0+b.y*o.height+b.offsetY,L=0+M.x*o.width+M.offsetX,T=0+M.y*o.height+M.offsetY;r.x=P,r.y=k,r.unionNoCheck(L,T,0,0),r.x+=h+d,r.y+=l+f;for(let D=0;D<s;D++){const B=t[D];if(B===n)continue;const E=B.measuredBounds;a=B.margin;const R=Math.max(E.width+a.right+a.left,0),F=Math.max(E.height+a.top+a.bottom,0);let V=B.alignment;V.isDefault()&&(V=e.defaultAlignment),V.isSpot()||(V=U.Center),m=r.width*V.x+V.offsetX-R*V.x+a.left+r.x,p=r.height*V.y+V.offsetY-F*V.y+a.top+r.y,y=r.width,x=r.height,B.visible&&(G.contains(r.x,r.y,r.width,r.height,m,p,E.width,E.height)?B.Bt(m,p,E.width,E.height):B.Bt(m,p,E.width,E.height,new G(r.x,r.y,r.width,r.height)))}G.e(r)}}Yt.dn("Auto",new au);class hu extends Yt{constructor(){super(),this.name="Table"}measure(e,t,i,s,n,o,r){let a=s.length;const h=u.et(),l=u.et();for(let ut=0;ut<a;ut++){const nt=s[ut],kt=nt instanceof bt?nt:null;if(kt!==null&&kt.$r()&&nt.visible){l.push(kt);const jt=kt.C.r,oe=jt.length;for(let ce=0;ce<oe;ce++){const ye=jt[ce];kt.type===bt.TableRow?ye.row=nt.row:kt.type===bt.TableColumn&&(ye.column=nt.column),h.push(ye)}}else h.push(nt)}a=h.length,a===0&&(e.getRowDefinition(0),e.getColumnDefinition(0));const c=[];for(let ut=0;ut<a;ut++){const nt=h[ut];nt.visible&&(nt.ue(!0),nt.Jn(!0),c[nt.row]||(c[nt.row]=[]),c[nt.row][nt.column]||(c[nt.row][nt.column]=[]),c[nt.row][nt.column].push(nt))}u.J(h);const d=u.et(),f=u.et(),m=u.et(),p={count:0},y={count:0};let x=t,b=i;const M=e.Xe,P=e.Ye;let k=null;a=M.length;for(let ut=0;ut<a;ut++)k=M[ut],k!==void 0&&(k.actual=0,k.Ai=0);a=P.length;for(let ut=0;ut<a;ut++)k=P[ut],k!==void 0&&(k.actual=0,k.Ai=0);let L=c.length,T=0;for(let ut=0;ut<L;ut++)c[ut]&&(T=Math.max(T,c[ut].length));const D=Math.min(e.topIndex,L-1),B=Math.min(e.leftIndex,T-1);let E=0,R;L=c.length;const F=e.Uo();for(let ut=0;ut<L;ut++){if(!c[ut])continue;T=c[ut].length;const nt=e.getRowDefinition(ut);nt.actual=0,nt.Ai=0;for(let kt=0;kt<T;kt++){if(!c[ut][kt])continue;const jt=e.getColumnDefinition(kt);d[kt]===void 0&&(jt.actual=0,jt.Ai=0,d[kt]=!0);const oe=c[ut][kt],ce=oe.length;for(let ye=0;ye<ce;ye++){const xe=oe[ye];if(!xe.visible&&xe!==F)continue;const ki=xe.rowSpan>1,Je=xe.columnSpan>1;(ki||Je)&&!(ut<D)&&!(kt<B)&&f.push(xe);const oi=xe.margin,ke=oi.right+oi.left,Le=oi.top+oi.bottom;R=xe.S0(nt,jt,!1);const fi=xe.desiredSize,$t=!isNaN(fi.width),Li=!isNaN(fi.height);if(R!==0&&!($t&&Li)&&!(ut<D)&&!(kt<B)&&(!Je&&p[kt]===void 0&&(R===2||R===5)&&(p[kt]=-1,p.count++),!ki&&y[ut]===void 0&&(R===2||R===4)&&(y[ut]=-1,y.count++),!ki&&!Je&&m.push(xe)),xe.ht(1/0,1/0,0,0),ut<D||kt<B)continue;const Ie=xe.measuredBounds,Pi=Math.max(Ie.width+ke,0),ji=Math.max(Ie.height+Le,0);if(xe.rowSpan===1&&(R===0||R===5)){k=e.getRowDefinition(ut);const Mi=k.computeEffectiveSpacing(),xn=k._===0;E=Math.max(ji-k.actual,0),E+(xn?Mi:0)>b&&(E=Math.max(b-Mi,0)),k.Ai=k.Ai+E,k.actual=k._+E,b=Math.max(b-(E+(xn?Mi:0)),0)}if(xe.columnSpan===1&&(R===0||R===4)){k=e.getColumnDefinition(kt);const Mi=k.computeEffectiveSpacing(),xn=k._===0;E=Math.max(Pi-k.actual,0),E+(xn?Mi:0)>x&&(E=Math.max(x-Mi,0)),k.Ai=k.Ai+E,k.actual=k._+E,x=Math.max(x-(E+(xn?Mi:0)),0)}(ki||Je)&&xe.tf()}}}u.J(d);let V=0,K=0;a=e.columnCount;for(let ut=0;ut<a;ut++){const nt=P[ut];nt!==void 0&&(V+=isNaN(nt.de)?nt.Ai:nt.de,nt.Ai!==0&&(V+=nt.computeEffectiveSpacing()))}a=e.rowCount;for(let ut=0;ut<a;ut++){const nt=M[ut];nt!==void 0&&(K+=isNaN(nt.de)?nt.Ai:nt.de,nt.Ai!==0&&(K+=nt.computeEffectiveSpacing()))}x=Math.max(t-V,0),b=Math.max(i-K,0);let H=b,W=x;a=m.length;for(let ut=0;ut<a;ut++){const nt=m[ut],kt=e.getRowDefinition(nt.row),jt=e.getColumnDefinition(nt.column),oe=nt.measuredBounds,ce=nt.margin,ye=ce.right+ce.left,xe=ce.top+ce.bottom;jt.Ai===0&&p[nt.column]!==void 0?p[nt.column]=Math.max(oe.width+ye,p[nt.column]):p[nt.column]=null,kt.Ai===0&&y[nt.row]!==void 0?y[nt.row]=Math.max(oe.height+xe,y[nt.row]):y[nt.row]=null}let J=0,$=0,et;for(et in y)et!=="count"&&(J+=y[et]);for(et in p)et!=="count"&&($+=p[et]);const ot=rt.l();for(let ut=0;ut<a;ut++){const nt=m[ut];if(!nt.visible&&nt!==F)continue;const kt=e.getRowDefinition(nt.row),jt=e.getColumnDefinition(nt.column);let oe=0;isFinite(jt.width)?oe=jt.width:(isFinite(x)&&p[nt.column]!==null?$===0?oe=jt.actual+x:oe=p[nt.column]/$*W:p[nt.column]!==null?oe=x:oe=jt.actual||x,oe=Math.max(0,oe-jt.computeEffectiveSpacing()));let ce=0;switch(isFinite(kt.height)?ce=kt.height:(isFinite(b)&&y[nt.row]!==null?J===0?ce=kt.actual+b:ce=y[nt.row]/J*H:y[nt.row]!==null?ce=b:ce=kt.actual||b,ce=Math.max(0,ce-kt.computeEffectiveSpacing())),ot.i(Math.max(jt.minimum,Math.min(oe,jt.maximum)),Math.max(kt.minimum,Math.min(ce,kt.maximum))),R=nt.S0(kt,jt,!1),R){case 5:ot.height=Math.max(ot.height,kt.actual+b);break;case 4:ot.width=Math.max(ot.width,jt.actual+x);break}const ye=nt.margin,xe=ye.right+ye.left,ki=ye.top+ye.bottom;nt.tf();let Je=jt.minimum,oi=kt.minimum;const ke=nt.measuredBounds;ke.width===0&&p[nt.column]!==null&&(Je=Math.max(Je,p[nt.column])),ke.height===0&&y[nt.row]!==null&&(oi=Math.max(Je,y[nt.row])),nt.ht(ot.width,ot.height,Je,oi);const Le=nt.measuredBounds;let fi=Math.max(Le.width+xe,0),$t=Math.max(Le.height+ki,0);isFinite(x)&&(fi=Math.min(fi,ot.width)),isFinite(b)&&($t=Math.min($t,ot.height));let Li=0;Li=kt.actual,kt.actual=Math.max(kt.actual,$t),kt.Ai=Math.max(kt.Ai,$t),E=kt.actual-Li,b=Math.max(b-E,0),y[nt.row]===null&&(H=Math.max(H-E,0)),Li=jt.actual,jt.actual=Math.max(jt.actual,fi),jt.Ai=Math.max(jt.Ai,fi),E=jt.actual-Li,x=Math.max(x-E,0),p[nt.column]===null&&(W=Math.max(W-E,0))}u.J(m);const Ct=rt.l(),ht=u.et(),dt=u.et();if(a=f.length,a!==0)for(let ut=0;ut<L;ut++){if(!c[ut])continue;T=c[ut].length;const nt=e.getRowDefinition(ut);ht[ut]=nt.actual;for(let kt=0;kt<T;kt++){if(!c[ut][kt])continue;const jt=e.getColumnDefinition(kt);dt[kt]=jt.actual}}for(let ut=0;ut<a;ut++){const nt=f[ut];if(!nt.visible&&nt!==F)continue;const kt=e.getRowDefinition(nt.row),jt=e.getColumnDefinition(nt.column);switch(ot.i(Math.max(jt.minimum,Math.min(t,jt.maximum)),Math.max(kt.minimum,Math.min(i,kt.maximum))),R=nt.S0(kt,jt,!1),R){case 2:dt[jt.index]!==0&&(ot.width=Math.min(ot.width,dt[jt.index])),ht[kt.index]!==0&&(ot.height=Math.min(ot.height,ht[kt.index]));break;case 5:dt[jt.index]!==0&&(ot.width=Math.min(ot.width,dt[jt.index]));break;case 4:ht[kt.index]!==0&&(ot.height=Math.min(ot.height,ht[kt.index]));break}isFinite(jt.width)&&(ot.width=jt.width),isFinite(kt.height)&&(ot.height=kt.height),Ct.i(0,0);let oe=jt.minimum,ce=kt.minimum;for(let $t=1;$t<nt.rowSpan&&!(nt.row+$t>=e.rowCount);$t++)k=e.getRowDefinition(nt.row+$t),E=0,R===2||R===4?E=Math.max(k.minimum,ht[nt.row+$t]===0?k.maximum:Math.min(ht[nt.row+$t],k.maximum)):E=Math.max(k.minimum,isNaN(k.de)?k.maximum:Math.min(k.de,k.maximum)),Ct.height+=E,ce+=k.minimum;for(let $t=1;$t<nt.columnSpan&&!(nt.column+$t>=e.columnCount);$t++)k=e.getColumnDefinition(nt.column+$t),E=0,R===2||R===5?E=Math.max(k.minimum,dt[nt.column+$t]===0?k.maximum:Math.min(dt[nt.column+$t],k.maximum)):E=Math.max(k.minimum,isNaN(k.de)?k.maximum:Math.min(k.de,k.maximum)),Ct.width+=E,oe+=k.minimum;ot.width+=Ct.width,ot.height+=Ct.height;const ye=nt.margin,xe=ye.right+ye.left,ki=ye.top+ye.bottom;nt.ht(ot.width,ot.height,oe,ce);const Je=nt.measuredBounds,oi=Math.max(Je.width+xe,0),ke=Math.max(Je.height+ki,0);let Le=0;for(let $t=0;$t<nt.rowSpan&&!(nt.row+$t>=e.rowCount);$t++)k=e.getRowDefinition(nt.row+$t),Le+=k.total||0;if(Le<ke){let $t=ke-Le;const Li=ke-Le;if(nt.spanAllocation!==null){const Ie=nt.spanAllocation;for(let Pi=0;Pi<nt.rowSpan&&!($t<=0||nt.row+Pi>=e.rowCount);Pi++){k=e.getRowDefinition(nt.row+Pi);const ji=k._||0,Mi=Ie(nt,k,Li);k.actual=Math.min(k.maximum,ji+Mi),k._!==ji&&($t-=k._-ji)}}for(;$t>0;){const Ie=k._||0;if(isNaN(k.height)&&k.maximum>Ie&&(k.actual=Math.min(k.maximum,Ie+$t),k._!==Ie&&($t-=k._-Ie)),k.index===0)break;k=e.getRowDefinition(k.index-1)}}let fi=0;for(let $t=0;$t<nt.columnSpan&&!(nt.column+$t>=e.columnCount);$t++)k=e.getColumnDefinition(nt.column+$t),fi+=k.total||0;if(fi<oi){let $t=oi-fi;const Li=oi-fi;if(nt.spanAllocation!==null){const Ie=nt.spanAllocation;for(let Pi=0;Pi<nt.columnSpan&&!($t<=0||nt.column+Pi>=e.columnCount);Pi++){k=e.getColumnDefinition(nt.column+Pi);const ji=k._||0,Mi=Ie(nt,k,Li);k.actual=Math.min(k.maximum,ji+Mi),k._!==ji&&($t-=k._-ji)}}for(;$t>0;){const Ie=k._||0;if(isNaN(k.width)&&k.maximum>Ie&&(k.actual=Math.min(k.maximum,Ie+$t),k._!==Ie&&($t-=k._-Ie)),k.index===0)break;k=e.getColumnDefinition(k.index-1)}}}u.J(f),rt.e(Ct),rt.e(ot),ht!==void 0&&u.J(ht),dt!==void 0&&u.J(dt);let ct=0,ft=0;const Ot=e.desiredSize,Et=e.maxSize;R=e.zs(!0),V=0,K=0;let lt=0,vt=0;a=e.columnCount;for(let ut=0;ut<a;ut++)if(P[ut]!==void 0){if(k=e.getColumnDefinition(ut),isFinite(k.width)){lt+=k.width,lt+=k.computeEffectiveSpacing();continue}else if(k.Qb()===2){lt+=k._,lt+=k.computeEffectiveSpacing();continue}k._!==0&&(V+=k._,V+=k.computeEffectiveSpacing())}isFinite(Ot.width)?ct=Math.min(Ot.width,Et.width):R!==0&&isFinite(t)?ct=t:ct=V,ct=Math.max(ct,isFinite(t)?Math.min(o,t):o),ct=Math.max(ct-lt,0);const Qt=V===0?1:Math.max(ct/V,1);for(let ut=0;ut<a;ut++)P[ut]!==void 0&&(k=e.getColumnDefinition(ut),!isFinite(k.width)&&k.Qb()!==2&&(k.actual=k._*Qt),k.position=n.width,k._!==0&&(n.width+=k._,n.width+=k.computeEffectiveSpacing()));a=e.rowCount;for(let ut=0;ut<a;ut++)if(M[ut]!==void 0){if(k=e.getRowDefinition(ut),isFinite(k.height)){vt+=k.height,vt+=k.computeEffectiveSpacing();continue}else if(k.Qb()===2){vt+=k._,vt+=k.computeEffectiveSpacing();continue}k._!==0&&(K+=k._,K+=k.computeEffectiveSpacing())}isFinite(Ot.height)?ft=Math.min(Ot.height,Et.height):R!==0&&isFinite(i)?ft=i:ft=K,ft=Math.max(ft,isFinite(i)?Math.min(r,i):r),ft=Math.max(ft-vt,0);const It=K===0?1:Math.max(ft/K,1);for(let ut=0;ut<a;ut++)M[ut]!==void 0&&(k=e.getRowDefinition(ut),!isFinite(k.height)&&k.Qb()!==2&&(k.actual=k._*It),k.position=n.height,k._!==0&&(n.height+=k._,n.height+=k.computeEffectiveSpacing()));a=l.length;for(let ut=0;ut<a;ut++){const nt=l[ut];let kt=0,jt=0;nt.type===bt.TableRow?(kt=n.width,k=e.getRowDefinition(nt.row),jt=k.actual):(k=e.getColumnDefinition(nt.column),kt=k.actual,jt=n.height),nt.measuredBounds.i(0,0,kt,jt),nt.ue(!1)}u.J(l),e.yh=c}arrange(e,t,i){const s=t.length,n=e.padding,o=n.left,r=n.top,a=e.yh;if(a===null)return;let h=0,l=0;const c=a.length;let d=0;for(let B=0;B<c;B++)a[B]&&(d=Math.max(d,a[B].length));const f=e.Xe,m=e.Ye;let p=0,y=0,x=Math.min(e.topIndex,c-1);if(f.length>0){for(;x!==c&&(f[x]===void 0||f[x]._===0);)x++;x=Math.max(Math.min(x,c-1),0),p=-f[x].position}let b=Math.min(e.leftIndex,d-1);if(m.length>0){for(;b!==d&&(m[b]===void 0||m[b]._===0);)b++;b=Math.max(Math.min(b,d-1),0),y=-m[b].position}let M=0,P=0;for(;M!==c&&f[M]===void 0;)M++;for(;P!==c&&m[P]===void 0;)P++;const k=e.part;let L=e.getRowDefinition(M),T=e.getColumnDefinition(P);for(let B=0;B<t.length;B++){const E=t[B];if(!(E instanceof bt&&E.visible&&E.$r()))continue;E.type===bt.TableRow?(L=e.getRowDefinition(E.row),T=e.getColumnDefinition(P)):(L=e.getRowDefinition(M),T=e.getColumnDefinition(E.column)),l=L.position+p+r,L._!==0&&(l+=L.computeEffectiveSpacingTop(Math.max(M,x))),h=T.position+y+o,T._!==0&&(h+=T.computeEffectiveSpacingTop(Math.max(P,b)));const R=E.measuredBounds;E.$c(),E.actualBounds.Pt();const F=E.actualBounds,V=G.V(F.x,F.y,F.width,F.height);if(F.x=E.type===bt.TableRow?o:h,F.y=E.type===bt.TableColumn?r:l,F.width=R.width,F.height=R.height,E.actualBounds.u(),E.Jn(!1),V.equalsApproxClose(F)){G.e(V);continue}k!==null&&(k.dh(),E.x0(k)),G.e(V)}const D=rt.l();for(let B=0;B<c;B++){if(!a[B])continue;d=a[B].length;const E=e.getRowDefinition(B);l=E.position+p+r,E._!==0&&(l+=E.computeEffectiveSpacingTop(Math.max(M,x)));for(let R=0;R<d;R++){if(!a[B][R])continue;const F=e.getColumnDefinition(R);h=F.position+y+o,F._!==0&&(h+=F.computeEffectiveSpacingTop(Math.max(P,b)));const V=a[B][R],K=V.length;for(let H=0;H<K;H++){const W=V[H],J=W.measuredBounds;D.i(0,0);for(let ke=1;ke<W.rowSpan&&!(B+ke>=e.rowCount);ke++){const Le=e.getRowDefinition(B+ke);Le._!==0&&(D.height+=Le.total)}for(let ke=1;ke<W.columnSpan&&!(R+ke>=e.columnCount);ke++){const Le=e.getColumnDefinition(R+ke);Le._!==0&&(D.width+=Le.total)}const $=F._+D.width,et=E._+D.height;let ot=h,Ct=l;const ht=$,dt=et,ct=h,ft=l;let Ot=$,Et=et;h+$>i.width&&(Ot=Math.max(i.width-h,0)),l+et>i.height&&(Et=Math.max(i.height-l,0));let lt=W.alignment,vt=0,Qt=0,It=0,ut=0;if(lt.isDefault()){lt=e.defaultAlignment,lt.isSpot()||(lt=U.Center),vt=lt.x,Qt=lt.y,It=lt.offsetX,ut=lt.offsetY;const ke=F.alignment,Le=E.alignment;ke.isSpot()&&(vt=ke.x,It=ke.offsetX),Le.isSpot()&&(Qt=Le.y,ut=Le.offsetY)}else vt=lt.x,Qt=lt.y,It=lt.offsetX,ut=lt.offsetY;(isNaN(vt)||isNaN(Qt))&&(vt=.5,Qt=.5,It=0,ut=0);let nt=J.width,kt=J.height;const jt=W.margin,oe=jt.left+jt.right,ce=jt.top+jt.bottom,ye=W.S0(E,F,!1);isNaN(W.desiredSize.width)&&(ye===2||ye===5)&&(nt=Math.max($-oe,0)),isNaN(W.desiredSize.height)&&(ye===2||ye===4)&&(kt=Math.max(et-ce,0));const xe=W.maxSize,ki=W.minSize;nt=Math.min(xe.width,nt),kt=Math.min(xe.height,kt),nt=Math.max(ki.width,nt),kt=Math.max(ki.height,kt);const Je=nt+oe,oi=kt+ce;ot+=ht*vt-Je*vt+It+jt.left,Ct+=dt*Qt-oi*Qt+ut+jt.top,W.visible&&(G.contains(ct,ft,Ot,Et,ot,Ct,J.width,J.height)?W.Bt(ot,Ct,nt,kt):W.Bt(ot,Ct,nt,kt,new G(ct,ft,Ot,Et)))}}}rt.e(D);for(let B=0;B<s;B++){const E=t[B],R=E instanceof bt?E:null;if(R!==null&&R.$r()){const F=E.actualBounds;E.naturalBounds.Pt(),E.naturalBounds.i(0,0,F.width,F.height),E.naturalBounds.u()}}}}Yt.dn("Table",new hu);class lu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Yt.dn("TableRow",new lu);class uu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){}arrange(e,t,i){}}Yt.dn("TableColumn",new uu);class cu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){s.length!==1&&u.o("Viewbox Panel must contain exactly one GraphObject.");const a=s[0];a.tt=1,a.tf(),a.ht(1/0,1/0,o,r);let h=a.measuredBounds;const l=a.margin,c=l.right+l.left,d=l.top+l.bottom;if(isFinite(t)||isFinite(i)){const f=a.scale,m=h.width,p=h.height,y=Math.max(t-c,0),x=Math.max(i-d,0);let b=1;e.viewboxStretch===6?(m!==0&&p!==0&&(b=Math.min(y/m,x/p)),b===0&&(b=1e-4),a.tt*=b):(m!==0&&p!==0&&(b=Math.max(y/m,x/p)),b===0&&(b=1e-4),a.tt*=b),f!==a.scale&&(a.ue(!0),a.ht(1/0,1/0,o,r))}h=a.measuredBounds,n.width=isFinite(t)?t:Math.max(h.width+c,0),n.height=isFinite(i)?i:Math.max(h.height+d,0)}arrange(e,t,i){const s=t[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,a=o.top+o.bottom,h=Math.max(n.width+r,0),l=Math.max(n.height+a,0);let c=s.alignment;c.isDefault()&&(c=e.defaultAlignment),c.isSpot()||(c=U.Center),s.Bt(i.width*c.x-h*c.x+c.offsetX,i.height*c.y-l*c.y+c.offsetY,n.width,n.height)}}Yt.dn("Viewbox",new cu);class du extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){e.yi===null&&(e.yi=new As),this.yv(e),this.wv(e)}arrange(e,t,i){}Ui(e,t,i){const s=e.naturalBounds,n=s.width,o=s.height;t.save(),t.beginPath(),t.rect(0,0,n,o),t.clip(),t.endPath(),this.xv(e,t,i),t.restore(),t.clearContextCache(!1)}xv(e,t,i){let s=e.getDocumentScale()*i.scale;s<=0&&(s=1);const n=e.gridCellSize,o=n.width,r=n.height,a=e.naturalBounds,h=e.actualBounds,l=a.width,c=a.height,d=Math.ceil(l/o),f=Math.ceil(c/r),m=e.gridOrigin,p=m.x,y=m.y,x=e.yi.J0,b=e.C.r,M=b.length;for(let P=0;P<M;P++){const k=b[P];if(!k.visible)continue;const L=k.interval||1,T=Math.abs(L);if(o*T*s<2)continue;let D=k.segmentIndex;(!isFinite(D)||isNaN(D))&&(D=0),D<0&&(D=T-Math.min(-D,T)),D=Math.round(D%T);const B=k.opacity;let E=1;if(B!==1){if(B===0)continue;E=t.globalAlpha,t.globalAlpha=E*B}const R=x[P];let F=!1;const V=k.strokeDashArray;if(V!==null&&(F=!0,t.enableDash(V,k.strokeDashOffset)),k.stroke!==null&&k.strokeWidth>0&&(k.figure==="LineV"||k.figure==="LineH")){if(t.lineWidth=k.strokeWidth,e.rn(t,k.stroke,!1,!1,a,h),t.beginPath(),k.figure==="LineV"){const K=Math.floor((p-o)/o);for(let H=K;H<=K+d;H++){const W=H*o+p;0<=W&&W<=l&&this._b(H,L,D,R)&&(t.moveTo(W,0),t.lineTo(W,c))}}else if(k.figure==="LineH"){const K=Math.floor((y-r)/r);for(let H=K;H<=K+f;H++){const W=H*r+y;0<=W&&W<=c&&this._b(H,L,D,R)&&(t.moveTo(0,W),t.lineTo(l,W))}}t.stroke(),t.endPath()}else if(k.fill!==null){if(e.rn(t,k.fill,!0,!1,a,h),k.figure==="BarV"){let K=k.width;isNaN(K)&&(K=o);const H=Math.floor((p-o)/o);for(let W=H;W<=H+d;W++){const J=W*o+p;0<=J+K&&J<=l&&this._b(W,L,D,R)&&t.fillRect(J,0,K,c)}}else if(k.figure==="BarH"){let K=k.height;isNaN(K)&&(K=r);const H=Math.floor((y-r)/r);for(let W=H;W<=H+f;W++){const J=W*r+y;0<=J+K&&J<=c&&this._b(W,L,D,R)&&t.fillRect(0,J,l,K)}}}F&&t.disableDash(),B!==1&&(t.globalAlpha=E)}}_b(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(e%r===i)return!1}return!0}wv(e){const t=[],i=e.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(a<0)continue;const h=o.figure,l=this.B2(h);for(let c=0;c<s;c++){if(c===n)continue;const d=i[c];if(!d.visible)continue;const f=d.figure;if(this.B2(f)!==l)continue;const m=d.interval;m>a&&r.push(m)}}e.yi.J0=t}B2(e){return e==="LineV"||e==="BarV"}yv(e){let t=1,i=1;const s=e.C.r,n=s.length;for(let a=0;a<n;a++){const h=s[a],l=Math.abs(h.interval);l<2||(this.B2(h.figure)?i=i*l/O.DC(i,l):t=t*l/O.DC(t,l))}const o=e.gridCellSize,r=e.yi;r.Yc.isReal()?r.Yc.i(i*o.width,t*o.height):r.Yc=new rt(i*o.width,t*o.height)}}Yt.dn("Grid",new du);class fu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=s.length;if(!(e instanceof Ft||e instanceof St))return;let h=null,l=null;if(e instanceof St&&(h=e),e instanceof Ft&&(l=e,h=l.adornedPart,e.hf===null&&(e.hf=[])),!(h instanceof St))return;const c=h;if(a===0){e.naturalBounds.Fn(0,0),e.measuredBounds.i(0,0,0,0);return}const d=e instanceof Ft?null:h.path,f=h.routeBounds,m=e.Bo;m.i(0,0,f.width,f.height);const p=c.points,y=h.pointsCount;l!==null?l.sd(!1):h!==null&&h.sd(!1);const x=f.width,b=f.height,M=e.hf;if(M.length=0,d!==null){this.measureLinkPath(e,x,b,d);const T=d.measuredBounds;m.unionRect(T),M.push(T)}const P=Pt.l(),k=C.l(),L=C.l();for(let T=0;T<a;T++){const D=s[T];if(D===d)continue;let B=D.measuredBounds;if(D.isPanelMain&&D instanceof At){this.measureLinkPath(e,x,b,D),B=D.measuredBounds,m.unionRect(B),M.push(B);continue}if(y<2){D.ht(1/0,1/0,0,0),B=D.measuredBounds,m.unionRect(B),M.push(B);continue}const E=D.segmentIndex,R=D.segmentFraction;let F=D.alignmentFocus;F.isNoSpot()&&(F=U.Center);const V=D.segmentOrientation,K=D.segmentOffset;let H=0,W=0,J=0,$=0;if(isNaN(E)){const lt=c.ot,vt=u.et();lt.getPointAndAngleAlongPath(R,vt);const Qt=C.V(vt[0],vt[1]);$=vt[2],V!==0&&(J=c.computeAngle(D,V,$),D.Yt=J,D.ue(!0),D.Jn(!0)),H=Qt.x,W=Qt.y,C.e(Qt),u.J(vt)}else if(E<-y||E>=y){const lt=C.l();c.OA(lt),$=c.midAngle,V!==0&&(J=c.computeAngle(D,V,$),D.Yt=J,D.ue(!0),D.Jn(!0)),H=lt.x-f.x,W=lt.y-f.y,C.e(lt)}else{let lt,vt,Qt=0;if(E>=0?(lt=p.elt(E),vt=E<y-1?p.elt(E+1):lt):(Qt=y+E,lt=p.elt(Qt),vt=Qt>0?p.elt(Qt-1):lt),$=0,lt.equalsApprox(vt)){let It,ut;E>=0?(It=E>0?p.elt(E-1):lt,ut=E<y-2?p.elt(E+2):vt):(It=Qt<y-1?p.elt(Qt+1):lt,ut=Qt>1?p.elt(Qt-2):vt);const nt=It.distanceSquaredPoint(lt),kt=vt.distanceSquaredPoint(ut);nt>kt+10?$=E>=0?It.directionPoint(lt):lt.directionPoint(It):kt>nt+10?$=E>=0?vt.directionPoint(ut):ut.directionPoint(vt):$=E>=0?It.directionPoint(ut):ut.directionPoint(It)}else $=E>=0?lt.directionPoint(vt):vt.directionPoint(lt);V!==0&&(J=c.computeAngle(D,V,$),D.Yt=J,D.ue(!0),D.Jn(!0)),H=lt.x+(vt.x-lt.x)*R-f.x,W=lt.y+(vt.y-lt.y)*R-f.y}D.ht(1/0,1/0,0,0),B=D.measuredBounds;const et=D.naturalBounds;let ot=0;D instanceof At&&(ot=D.strokeWidth);const Ct=et.width+ot,ht=et.height+ot;P.Ri(),P.Fs(-B.x,-B.y),P.tt(D.scale,D.scale),P.cs(V===0?D.angle:$,Ct/2,ht/2),(V===22||V===26)&&P.cs(90,Ct/2,ht/2),(V===23||V===27)&&P.cs(-90,Ct/2,ht/2),V===28&&($>45&&$<135||$>225&&$<315)&&P.cs(-$,Ct/2,ht/2);const dt=new G(0,0,Ct,ht);k.setRectSpot(dt,F),P.gt(k);const ct=-k.x+ot/2*D.scale,ft=-k.y+ot/2*D.scale;L.a(K);const Ot=isNaN(K.x),Et=isNaN(K.y);if(Ot||Et){const lt=Ct/2+3,vt=ht/2+3,Qt=$>=45&&$<=135,It=$>=225&&$<=315;V===0&&(Qt||It)?(L.x=Et?lt:K.y,L.y=Ot?vt:K.x,Qt?E>=0||isNaN(E)&&R<.5||Ot&&(L.y=-vt):It&&((E>=0||isNaN(E)&&R<.5)&&Ot&&(L.y=-vt),Et&&(L.x=-lt))):(Ot&&(E>=0||isNaN(E)&&R<.5?L.x=lt:L.x=-lt),Et&&(L.y=-vt),L.rotate($))}else L.rotate($);H+=L.x,W+=L.y,dt.i(H+ct,W+ft,B.width,B.height),M.push(dt),m.unionRect(dt)}if(h!==null){const T=h.labelNodes;for(;T.next();)T.value.ht(1/0,1/0)}e.Bo=m,e.position.i(f.x+m.x,f.y+m.y),n.Fn(m.width||0,m.height||0),Pt.e(P),C.e(k),C.e(L)}arrange(e,t,i){const s=t.length;if(!(e instanceof Ft||e instanceof St))return;let n=e,o=null;e instanceof Ft&&(o=e,n=o.adornedPart);const r=e,a=e instanceof Ft?null:n.path,h=e.hf;if(h.length!==0){let f=0;if(a!==null&&f<h.length){const m=h[f];f++,a.Bt(m.x-r.Bo.x,m.y-r.Bo.y,m.width,m.height)}for(let m=0;m<s;m++){const p=t[m];if(p!==a&&f<h.length){const y=h[f];f++,p.Bt(y.x-r.Bo.x,y.y-r.Bo.y,y.width,y.height)}}}const l=n.points,c=l.count;if(c>=2&&r instanceof St){const f=r.labelNodes;for(;f.next();){const m=f.value;r.bv(m,c,l)}}o!==null?o.sd(!1):n.sd(!1);const d=e.IA(C.l());e.location.i(e.position.x+d.x,e.position.y+d.y),C.e(d)}measureLinkPath(e,t,i,s){if(s.To()===!1)return;let n=s.strokeWidth;if(n===0&&e instanceof Ft&&e.type===bt.Link&&e.adornedObject instanceof At&&(n=e.adornedObject.strokeWidth),n=n*s.tt,e instanceof St&&e.ot!==null){const o=e.geometry.bounds;s.Wn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(e instanceof Ft&&e.adornedPart.ot!==null){const o=e.adornedPart.ot.bounds;s.Wn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.Wn(-(n/2),-(n/2),t+n,i+n);s.kv(),s.ue(!1)}}Yt.dn("Link",new fu);class gu extends Yt{constructor(){super()}measure(e,t,i,s,n,o,r){const a=e.findMainElement();e.Ge=[];const h=a.margin,l=h.right+h.left,c=h.top+h.bottom;a.ht(t,i,o,r);const d=a.measuredBounds,f=d.width,m=d.height,p=Math.max(f+l,0),y=Math.max(m+c,0),x=new G(-h.left,-h.top,p,y);e.Ge.push(x),n.a(x),this.determineGraduatedMarks(e,a);const b=e.xs;if(b===null)return;const M=s.length;for(let P=0;P<M;P++){const k=s[P],L=b[P];!k.visible||k===a||L.length===0||(k instanceof At?this.measureGraduatedTicks(e,k,L,n):k instanceof ae&&this.measureGraduatedLabels(e,k,L,n),k.ue(!1))}}arrange(e,t,i){if(e.Ge===null)return;const s=e.findMainElement(),n=e.xs;if(n===null)return;const o=e.Ge;let r=0,a=o[r];r++,s!==null&&s.Bt(a.x-i.x,a.y-i.y,a.width,a.height);const h=t.length;for(let l=0;l<h;l++){const c=t[l],d=n[l];!c.visible||c===s||d.length===0||(a=o[r],r++,c.Bt(a.x-i.x,a.y-i.y,a.width,a.height))}e.Ge=null}measureGraduatedTicks(e,t,i,s){let n=t.alignmentFocus;n.isNoSpot()&&(n=U.TopCenter);const o=t.angle;t.Yt=0,t.ht(1/0,1/0,0,0),t.Yt=o;const r=t.measuredBounds,a=r.width,h=r.height,l=G.V(0,0,a,h),c=C.l();c.setRectSpot(l,n),G.e(l);const d=-c.x,f=-c.y,m=new G,p=i.length;for(let y=0;y<p;y++){const x=i[y],b=x.pt.x,M=x.pt.y,P=x.angle;for(let k=0;k<4;k++){switch(k){case 0:c.i(d,f);break;case 1:c.i(d+a,f);break;case 2:c.i(d,f+h);break;case 3:c.i(d+a,f+h);break}c.rotate(P+t.angle),c.offset(b,M),y===0&&k===0?m.i(c.x,c.y,0,0):m.unionPoint(c),c.offset(-b,-M),c.rotate(-P-t.angle)}}C.e(c),e.Ge!==null&&e.Ge.push(m),s.unionNoCheck(m.x,m.y,m.width,m.height)}measureGraduatedLabels(e,t,i,s){e.Pe===null&&(e.Pe=new ae);const n=e.Pe;this.EA(t,n);let o=t.alignmentFocus;o.isNoSpot()&&(o=U.TopCenter);const r=t.segmentOrientation,a=t.segmentOffset,h=new G;let l=0,c=0,d=0,f=0,m=0;const p=i.length;for(let y=0;y<p;y++){const x=i[y];l=x.pt.x,c=x.pt.y,d=x.angle,f=t.angle,m=t.angle,r!==0&&(r===21||r===25?m=d+t.angle:m=d,f=St.computeAngle(r,m)),n.Yt=f,n.text=x.text||"",n.ht(1/0,1/0,0,0);const b=n.measuredBounds,M=n.naturalBounds,P=M.width,k=M.height,L=Pt.l();L.Ri(),L.Fs(-b.x,-b.y),L.tt(n.scale,n.scale),L.cs(m,P/2,k/2),(r===22||r===26)&&L.cs(90,P/2,k/2),(r===23||r===27)&&L.cs(-90,P/2,k/2),r===28&&(d>45&&d<135||d>225&&d<315)&&L.cs(-d,P/2,k/2);const T=G.V(0,0,P,k),D=C.l();D.setRectSpot(T,o),L.gt(D);const B=-D.x,E=-D.y,R=C.l();R.a(a),isNaN(R.x)&&(R.x=P/2+3),isNaN(R.y)&&(R.y=-(k/2+3)),R.rotate(d),l+=R.x+B,c+=R.y+E;const F=new G(l,c,b.width,b.height),V=new G(b.x,b.y,b.width,b.height),K=new G(M.x,M.y,M.width,M.height);x.labelAngle=f,x.lineCount=n.lineCount,x.lines=n.getMetrics(),x.actualBounds=F,x.measuredBounds=V,x.naturalBounds=K,y===0?h.a(F):h.unionRect(F),C.e(R),C.e(D),G.e(T),Pt.e(L)}e.Ge!==null&&e.Ge.push(h),s.unionNoCheck(h.x,h.y,h.width,h.height)}determineGraduatedMarks(e,t){const i=t.geometry,s=t.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,a=n.length;let h=0,l=0;const c=u.et();for(let M=0;M<a;M++){const P=n[M],k=[];h=0,l=0;const L=P.length;for(let T=0;T<L;T+=2){const D=P[T],B=P[T+1];if(T===0){h=D,l=B;continue}let E=Math.atan2(B-l,D-h)*180/Math.PI;E<0&&(E+=360),k.push(E),h=D,l=B}c.push(k)}const d=this.Pv(e),f=e.C.r,m=f.length;let p=0,y=0,x=r;e.xs=[];let b;for(let M=0;M<m;M++){const P=f[M];if(b=[],!P.visible||P===t){e.xs.push(b);continue}const k=Math.abs(P.interval),L=e.graduatedTickUnit;if(L*k*r/e.graduatedRange<2&&P.graduatedSkip===null){e.xs.push(b);continue}let T=o[0][0],D=0,B=0;y=r*P.graduatedStart-1e-4,x=r*P.graduatedEnd+1e-4;const E=L*k;let R=e.graduatedTickBase;if(R<e.graduatedMin){let H=(e.graduatedMin-R)/E;H=H%1===0?H:Math.floor(H+1),R+=H*E}else if(R>e.graduatedMin+E){const H=Math.floor((R-e.graduatedMin)/E);R-=H*E}const F=d[M],V=R,K=e.graduatedMax*1e-6;for(let H=1;R<=e.graduatedMax+K;H++){if(this.Sv(e,R-e.graduatedTickBase,F)&&(R>e.graduatedMax&&(R=e.graduatedMax),(P.graduatedSkip===null||P instanceof ae&&!P.graduatedSkip(R,P)||P instanceof At&&!P.graduatedSkip(R,P))&&(p=(R-e.graduatedMin)*r/e.graduatedRange,p>r&&(p=r),y<=p&&p<=x))){let W=c[D][B],J=o[D][B];for(;D<o.length;){for(;p>T&&B<o[D].length-1;)B++,W=c[D][B],J=o[D][B],T+=J;if(p<=T)break;D++,B=0,W=c[D][B],J=o[D][B],T+=J}const $=n[D],et=$[B*2],ot=$[B*2+1],Ct=$[B*2+2],ht=$[B*2+3],dt=(p-(T-J))/J,ct=new C(et+(Ct-et)*dt+s/2-i.bounds.x,ot+(ht-ot)*dt+s/2-i.bounds.y);if(ct.scale(t.scale,t.scale),W=this.Mv(W,dt,$,c[D],B),P instanceof ae){let ft="";P.graduatedFunction!==null?(ft=P.graduatedFunction(R,P),ft=ft!=null?ft.toString():""):ft=(+R.toFixed(2)).toString(),ft!==""&&b.push({pt:ct,angle:W,text:ft})}else b.push({pt:ct,angle:W})}R=V+H*E}e.xs.push(b)}u.J(c)}Mv(e,t,i,s,n){if(t<.5005&&t>.4995)return e;let o=e;if(t<.5?n>0?o=s[n-1]:O.z(i[0],i[i.length-2])&&O.z(i[1],i[i.length-1])&&(o=s[s.length-1]):t>.5&&(n+1<s.length?o=s[n+1]:O.z(i[0],i[i.length-2])&&O.z(i[1],i[i.length-1])&&(o=s[0])),e!==o){let r=Math.abs(e-o);if(r>180&&(e<o?e+=360:o+=360,r=Math.abs(e-o)),t<5e-4||t>.9995)return(e+o)/2%360;if(r<10){const a=1-Math.abs(.5-t);return(e*a+o*(1-a))%360}}return e}Pv(e){if(e.ss===null){const t=[],i=e.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(t.push(r),!o.visible)continue;const a=o.interval;if(!(a<0))for(let h=0;h<s;h++){if(h===n)continue;const l=i[h];if(!l.visible||o.constructor!==l.constructor)continue;const c=l.interval;c>a&&r.push(c)}}e.ss=t}return e.ss}Sv(e,t,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*e.graduatedTickUnit,r=t%o,a=e.graduatedTickUnit*1e-6;if(r<a&&r>-a)return!1}return!0}Ui(e,t,i){const s=i.ia;i.ia=!0;const n=e.naturalBounds,o=n.width,r=n.height,a=t instanceof Ge;t.save(),t.beginPath(),t.rect(-1,-1,o+1,r+1),t.clip(),t.endPath();const h=e.findMainElement();h.Ui(t,i);let l=e.getDocumentScale()*i.scale;l<=0&&(l=1);const c=h.actualBounds,d=e.C.r,f=e.xs,m=d.length;for(let p=0;p<m;p++){const y=d[p],x=f[p],b=x.length;if(!(!y.visible||y===h||x.length===0)){if(y instanceof At){if(e.graduatedTickUnit*y.interval*h.geometry.flattenedTotalLength/e.graduatedRange*l<2&&y.graduatedSkip===null)continue;const M=y.measuredBounds,P=y.strokeWidth*y.scale;let k=y.alignmentFocus;k.isNoSpot()&&(k=U.TopCenter);for(let L=0;L<b;L++){const T=x[L].pt,D=x[L].angle;this.Nv(y,T,c,D,M,P,k),y.Ui(t,i),a&&(e.svg.appendChild(y.svg),y.svg=null),y.qr.Ri()}}else if(y instanceof ae){e.Pe===null&&(e.Pe=new ae);const M=e.Pe;this.EA(y,M),M.V2=!0;for(let P=0;P<b;P++){const k=x[P];if(k.actualBounds&&k.measuredBounds&&k.naturalBounds){M.Cv(k);const L=k.actualBounds;M.Bt(L.x,L.y,L.width,L.height),this.Lv(M,c,L,k.measuredBounds,k.naturalBounds),M.Jr=y.part,M.Vs=y.panel,M.Ui(t,i),M.Vs=null,M.Jr=null,a&&(e.svg.appendChild(M.svg),M.svg=null)}}}}}i.ia=s,t.restore(),t.clearContextCache(!0)}Nv(e,t,i,s,n,o,r){const a=e.qr;a.Ri(),a.Fs(t.x+i.x,t.y+i.y),a.cs(s+e.angle,0,0),a.Fs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),a.tt(e.scale,e.scale),e.Zu(!1),e.hh.set(e.qr),e.da=e.scale,e.ka(!1)}Lv(e,t,i,s,n){const o=e.qr;o.Ri(),o.Fs(i.x+t.x,i.y+t.y),o.Fs(-s.x,-s.y),e.m0(o,n.x,n.y,n.width,n.height),e.Zu(!1),e.hh.set(e.qr),e.da=e.scale,e.ka(!1)}EA(e,t){t.Av(e)}}Yt.dn("Graduated",new gu);var ca=(S=>(S[S.Uniform=6]="Uniform",S[S.UniformToFill=7]="UniformToFill",S))(ca||{});const yt=class yt extends Xt{constructor(t,i){super();g(this,"H");g(this,"C");g(this,"Zt");g(this,"nd");g(this,"Bn");g(this,"Qr");g(this,"to");g(this,"Bo");g(this,"z2");g(this,"F");g(this,"od");g(this,"st");g(this,"yi");g(this,"_t");g(this,"rd");g(this,"wh");g(this,"Gs");if(this.H=null,t===void 0)this.H=yt.Position;else if(typeof t=="string"){const s=Yt.es.get(t);s!==null&&(this.H=s)}else t instanceof Yt?this.H=t:t&&(this.H=yt.Position,i=t);this.H===null&&u.o("Panel type not specified or PanelLayout not loaded: "+t),this.n|=4194304|(this.H===yt.Grid?1048576:0),this.C=new Y,this.Zt=wt.Rg,this.nd=U.Default,this.Bn=1,this.Qr=null,this.to="",this.Bo=new G(NaN,NaN,NaN,NaN),this.z2=null,this.F=null,this.od=6,this.yi=null,this.st=null,this._t=null,this.rd=NaN,this.wh=null,this.Gs=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.H=this.H,t.Zt=this.Zt.P(),t.nd=this.nd.P(),t.Bn=this.Bn,t.to=this.to,t.Bo.a(this.Bo),this.F!==null&&(t.F=this.F.copy(t)),t.od=this.od,this.st!==null&&(t.st=this.st.copy()),this.yi!==null&&(t.yi=this.yi.copy()),t._t=this._t,t.rd=this.rd,t.wh=this.wh}vo(t){super.vo(t),t.C=this.C;const i=t.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.Vs=t}t.Qr=null}copy(){const t=super.copy();if(t!==null){const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].copy();t.Tv(o)}return t}else return null}toString(){return"Panel("+this.type.name+")#"+I.as(this)}get type(){return this.H}set type(t){const i=this.H;i!==t&&(this.H=t,this.af=this.H===yt.Grid,this.c(),this.t("type",i,t))}get elements(){return this.C.iterator}get naturalBounds(){return this.zi}get padding(){return this.Zt}set padding(t){typeof t=="number"?(t<0&&u.W(t,">= 0",yt,"padding"),t=new wt(t)):(t.left<0&&u.W(t.left,">= 0",yt,"padding:value.left"),t.right<0&&u.W(t.right,">= 0",yt,"padding:value.right"),t.top<0&&u.W(t.top,">= 0",yt,"padding:value.top"),t.bottom<0&&u.W(t.bottom,">= 0",yt,"padding:value.bottom"));const i=this.Zt;i.equals(t)||(t=t.P(),this.Zt=t,this.c(),this.t("padding",i,t))}get defaultAlignment(){return this.nd}set defaultAlignment(t){const i=this.nd;i.equals(t)||(t=t.P(),this.nd=t,this.c(),this.t("defaultAlignment",i,t))}get defaultStretch(){return this.Bn}set defaultStretch(t){const i=this.Bn;i!==t&&(this.Bn=t,this.c(),this.t("defaultStretch",i,t))}get defaultSeparatorPadding(){return this.F!==null?this.F.$0:wt.Rg}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new wt(t));const i=this.defaultSeparatorPadding;i.equals(t)||(t=t.P(),this.F===null&&(this.F=new Re),this.F.$0=t,this.c(),this.t("defaultSeparatorPadding",i,t))}get defaultRowSeparatorStroke(){return this.F!==null?this.F.Z0:null}set defaultRowSeparatorStroke(t){const i=this.defaultRowSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Jt)&&(t instanceof Jt&&t.u(),this.F===null&&(this.F=new Re),this.F.Z0=t,this.S(),this.t("defaultRowSeparatorStroke",i,t))}get defaultRowSeparatorStrokeWidth(){return this.F!==null?this.F.Q0:1}set defaultRowSeparatorStrokeWidth(t){const i=this.defaultRowSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.F===null&&(this.F=new Re),this.F.Q0=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",i,t))}get defaultRowSeparatorDashArray(){return this.F!==null?this.F._0:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&u.Zi(t,"Array",yt,"defaultRowSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&u.o("defaultRowSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.F===null&&(this.F=new Re),this.F._0=t,this.S(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return this.F!==null?this.F.tp:null}set defaultColumnSeparatorStroke(t){const i=this.defaultColumnSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Jt)&&(t instanceof Jt&&t.u(),this.F===null&&(this.F=new Re),this.F.tp=t,this.S(),this.t("defaultColumnSeparatorStroke",i,t))}get defaultColumnSeparatorStrokeWidth(){return this.F!==null?this.F.ip:1}set defaultColumnSeparatorStrokeWidth(t){const i=this.defaultColumnSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.F===null&&(this.F=new Re),this.F.ip=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",i,t))}get defaultColumnSeparatorDashArray(){return this.F!==null?this.F.ep:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&u.Zi(t,"Array",yt,"defaultColumnSeparatorDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(typeof r!="number"||!(r>=0)||!isFinite(r))&&u.o("defaultColumnSeparatorDashArray value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.F===null&&(this.F=new Re),this.F.ep=t,this.S(),this.t("defaultColumnSeparatorDashArray",i,t)}}get yh(){return this.F!==null?this.F.yh:null}set yh(t){this.F===null&&(this.F=new Re),this.F.yh=t}get viewboxStretch(){return this.od}set viewboxStretch(t){const i=this.od;i!==t&&(this.od=t,this.c(),this.t("viewboxStretch",i,t))}get gridCellSize(){return this.yi!==null?this.yi.ld:rt.wC}set gridCellSize(t){this.yi===null&&(this.yi=new As);const i=this.yi.ld;if(!i.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&u.o("Invalid Panel.gridCellSize: "+t),this.yi.ld=t.P();const s=this.diagram;s!==null&&this===s.grid&&s.th(),this.S(),this.t("gridCellSize",i,t)}}get gridOrigin(){return this.yi!==null?this.yi.hd:C.xo}set gridOrigin(t){this.yi===null&&(this.yi=new As);const i=this.yi.hd;if(!i.equals(t)){t.isReal()||u.o("Invalid Panel.gridOrigin: "+t),this.yi.hd=t.P();const s=this.diagram;s!==null&&this===s.grid&&s.th(),this.S(),this.t("gridOrigin",i,t)}}get graduatedMin(){return this.st!==null?this.st.sp:0}set graduatedMin(t){const i=this.graduatedMin;if(i!==t&&(this.st===null&&(this.st=new Ai),this.st.sp=t,this.c(),this.t("graduatedMin",i,t),this.Wc())){const s=this.part;s!==null&&this.ba(s,"graduatedRange")}}get graduatedMax(){return this.st!==null?this.st.np:100}set graduatedMax(t){const i=this.graduatedMax;if(i!==t&&(this.st===null&&(this.st=new Ai),this.st.np=t,this.c(),this.t("graduatedMax",i,t),this.Wc())){const s=this.part;s!==null&&this.ba(s,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.st!==null?this.st.op:10}set graduatedTickUnit(t){const i=this.graduatedTickUnit;i!==t&&t>0&&(this.st===null&&(this.st=new Ai),this.st.op=t,this.c(),this.t("graduatedTickUnit",i,t))}get graduatedTickBase(){return this.st!==null?this.st.rp:0}set graduatedTickBase(t){const i=this.graduatedTickBase;i!==t&&(this.st===null&&(this.st=new Ai),this.st.rp=t,this.c(),this.t("graduatedTickBase",i,t))}get xs(){return this.st!==null?this.st.xs:null}set xs(t){this.st!==null?this.st.xs=t:t!==null&&(this.st=new Ai,this.st.xs=t)}get Ge(){return this.st!==null?this.st.Ge:null}set Ge(t){this.st!==null?this.st.Ge=t:t!==null&&(this.st=new Ai,this.st.Ge=t)}get ss(){return this.st!==null?this.st.ss:null}set ss(t){this.st!==null?this.st.ss=t:t!==null&&(this.st=new Ai,this.st.ss=t)}get Pe(){return this.st!==null?this.st.Pe:null}set Pe(t){this.st!==null?this.st.Pe=t:t!==null&&(this.st=new Ai,this.st.Pe=t)}x0(t){super.x0(t);const i=this.C.r,s=i.length;for(let n=0;n<s;n++)i[n].x0(t)}gh(t,i){if(this.H===yt.Grid){t.commitTransform(),this.H.Ui(this,t,i);return}if(this.H===yt.Graduated){t.commitTransform(),this.H.Ui(this,t,i);return}if(this.H===yt.Table)if(t.commitTransform(),t instanceof Ge){const a=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.X2(t,i),t.endGroup(),t.currentElement=a}else this.X2(t,i);const s=this.isClipping&&this.H===yt.Spot;s&&t.save();const n=this.findMainElement(),o=this.C.r,r=o.length;for(let a=0;a<r;a++){const h=o[a];s&&h===n&&(t.clipInsteadOfFill=!0),h.Ui(t,i),s&&h===n&&(t.clipInsteadOfFill=!1)}s&&(t.restore(),t.clearContextCache(!0))}X2(t,i){t.lineCap="butt";const s=this.rowCount>0?this.Xe:null,n=this.columnCount>0?this.Ye:null;s!==null&&this.t1(t,i,!0,s,!0),n!==null&&this.t1(t,i,!1,n,!0),s!==null&&this.UA(t,!0,s),n!==null&&this.UA(t,!1,n),s!==null&&this.t1(t,i,!0,s,!1),n!==null&&this.t1(t,i,!1,n,!1)}UA(t,i,s){const n=s.length,o=this.actualBounds,r=this.naturalBounds;let a=!0;for(let h=0;h<n;h++){const l=s[h];if(l===void 0||l.actual===0)continue;if(a){a=!1;continue}if(i){if(l.position>r.height)continue}else if(l.position>r.width)continue;let c=l.separatorStrokeWidth;isNaN(c)&&(c=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let d=l.separatorStroke;if(d===null&&(d=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),c===0||d===null)continue;this.rn(t,d,!1,!1,r,o);let f=!1,m=l.separatorDashArray;m===null&&(m=i?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),m!==null&&(f=!0,t.enableDash(m,0)),t.beginPath();const p=l.position+c;i?p>r.height&&(c-=p-r.height):p>r.width&&(c-=p-r.width);let y=l.position+c/2;t.lineWidth=c;const x=this.Zt;if(i){y+=x.top;const b=x.left,M=r.width-x.right;t.moveTo(b,y),t.lineTo(M,y)}else{y+=x.left;const b=x.top,M=r.height-x.bottom;t.moveTo(y,b),t.lineTo(y,M)}t.stroke(),t.endPath(),f&&t.disableDash()}}t1(t,i,s,n,o){const r=n.length,a=this.actualBounds,h=this.naturalBounds,l=this.BA(!0),c=this.BA(!1);for(let d=0;d<r;d++){const f=n[d];if(f===void 0||f.background===null||f.coversSeparators===o||f.actual===0)continue;const m=s?a.height:a.width;if(f.position>m)continue;let p=f.computeEffectiveSpacing(),y=f.separatorStrokeWidth;isNaN(y)&&(y=s?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let x=f.separatorStroke;x===null&&(x=s?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(x===null||f.index===(s?l:c))&&(y=0),p-=y;const b=f.position+y;let M=p+f.actual;if(b+M>m&&(M=m-b),M<=0)continue;const P=this.Zt;this.rn(t,f.background,!0,!1,h,a),s?t.fillRect(P.left,b+P.top,a.width-(P.left+P.right),M):t.fillRect(b+P.left,P.top,M,a.height-(P.top+P.bottom))}}BA(t){const i=t?this.rowCount:this.columnCount;for(let s=0;s<i;s++){const n=t?this.Xe[s]:this.Ye[s];if(n!==void 0)return n.index}return 0}Qc(){const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Qc();this.Ve(!0)}Zc(t,i,s){const n=this.svg;if(n===null)return!1;if(this.type===yt.Table){const a=n.getElementsByClassName("gojs-ts"),h=a.length!==0?a[0]:null;h!==null&&(h.innerHTML=""),t.currentElement=h,this.X2(t,i),t.currentElement=null}else{if(this.H===yt.Grid||this.H===yt.Graduated)return n.innerHTML="",n.remove(),!1;if(this.H===yt.Spot&&this.isClipping)return n.innerHTML="",n.remove(),this.ah=null,this.Qc(),!1}if(!super.Zc(t,i,s))return!1;const o=this.C.r,r=o.length;for(let a=0;a<r;a++)o[a].Ui(t,i);return!0}$u(t){return!0}k0(t,i,s,n){if(!this.isClipping){if(this.Xs()&&t.partClipRect!==null){const o=t.partClipRect,r=this.C.r;let a=0,h=0;for(let l=0;l<r.length;l++){if(!r[l].isVisibleObject())continue;const c=r[l].actualBounds;a=l===0?c.x:Math.min(c.x,a),h=l===0?c.y:Math.min(c.y,h)}n.setAttributeNS(null,"clip-path",`path('M ${o.x-s.x-a},${o.y-s.y-h} l ${o.width} 0 l 0 ${o.height} l -${o.width} 0 z')`);return}super.k0(t,i,s,n)}}Jc(t,i,s,n,o){const r=this.an(),a=this.T,h=1/(a.m11*a.m22-a.m12*a.m21);let l=a.m22*h,c=-a.m12*h,d=-a.m21*h,f=a.m11*h,m=h*(a.m21*a.dy-a.m22*a.dx),p=h*(a.m12*a.dx-a.m11*a.dy);if(this.background!==null){const y=t*l+i*d+m,x=t*c+i*f+p,b=s*l+n*d+m,M=s*c+n*f+p;o.i(0,0);const P=this.naturalBounds,k=O.gl(0,0,P.width,P.height,y,x,b,M,o);return o.T(a),k}else{r||(l=1,c=0,d=0,f=1,m=0,p=0);const y=t*l+i*d+m,x=t*c+i*f+p,b=s*l+n*d+m,M=s*c+n*f+p;o.i(b,M);let P=(b-y)**2+(M-x)**2,k=!1;const L=this.C.r,T=L.length,D=C.l();let B=null,E=1/0,R=null;const F=this.isClipping&&this.H===yt.Spot;F&&(R=C.l(),B=this.findMainElement(),k=B.Jc(y,x,b,M,R),k&&(E=(y-R.x)**2+(x-R.y)**2));for(let V=0;V<T;V++){const K=L[V];if(!K.visible||K===B||!K.Jc(y,x,b,M,D))continue;k=!0;const H=(y-D.x)**2+(x-D.y)**2;H<P&&(P=H,o.set(D))}return F&&(E>P&&o.set(R),C.e(R)),C.e(D),r&&o.T(a),k}}Au(){const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Au();super.Au()}c(t){if(this.To())return;super.c(t);let i=null;(this.H===yt.Auto||this.H===yt.Link)&&(i=this.findMainElement());const s=this.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if((r===i||r.isPanelMain)&&r.c(!0),r.desiredSize.isReal())continue;const a=r.zs(!1);!(r instanceof si)&&!(r instanceof yt)&&!(r instanceof ae)&&a===0||r.c(!0)}}tf(){if(this.To())return;this.ue(!0),this.Jn(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].tf()}$c(){if(this.Kb()===!1){this.Zu(!0),this.ka(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].P2()}}P2(){this.ka(!0);const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].P2()}Wu(t,i,s,n){const o=this.Bo;o.i(0,0,0,0);const r=this.desiredSize,a=this.minSize;s===void 0&&(s=a.width,n=a.height),s=Math.max(s,a.width),n=Math.max(n,a.height);const h=this.maxSize;isNaN(r.width)||(t=Math.min(r.width,h.width)),isNaN(r.height)||(i=Math.min(r.height,h.height)),t=Math.max(s,t),i=Math.max(n,i);const l=this.Zt;t=Math.max(t-l.left-l.right,0),i=Math.max(i-l.top-l.bottom,0);const c=this.C.r;this.H.measure(this,t,i,c,o,s,n);let d=o.width+l.left+l.right,f=o.height+l.top+l.bottom;isFinite(r.width)&&(d=r.width),isFinite(r.height)&&(f=r.height),d=Math.min(h.width,d),f=Math.min(h.height,f),d=Math.max(a.width,d),f=Math.max(a.height,f),d=Math.max(s,d),f=Math.max(n,f),o.Fn(d,f),this.naturalBounds.Fn(d,f),this.Wn(0,0,d,f)}findMainElement(){if(this.Qr===null){const t=this.C.r,i=t.length;if(i===0)return null;for(let s=0;s<i;s++){const n=t[s];if(n.isPanelMain===!0)return this.Qr=n,n}this.Qr=t[0]}return this.Qr}Uo(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.z2}set panelLayoutState(t){this.z2=t}uh(t,i,s,n){const o=this.C.r;if(this.actualBounds.i(t,i,s,n),!this.desiredSize.isReal()){let r=this.zs(!0);const a=this.measuredBounds,h=a.width,l=a.height,c=this.Wr,d=c.left+c.right,f=c.top+c.bottom;switch(h===s&&l===n&&(r=0),r){case 0:(h>s||l>n)&&(this.c(),this.ht(h>s?s:h,l>n?n:l,0,0));break;case 2:this.c(!0),this.ht(s+d,n+f,0,0);break;case 5:this.c(!0),this.ht(s+d,l+f,0,0);break;case 4:this.c(!0),this.ht(h+d,n+f,0,0);break}}this.H.arrange(this,o,this.Bo)}fh(t){const i=this.naturalBounds,s=this.Uo();if(G.contains(0,0,i.width,i.height,t.x,t.y)){const n=this.C.r,o=n.length,r=C.V(0,0);for(let a=o;a--;){const h=n[a];if(!(!h.visible&&h!==s)&&(r.set(t).Oe(h.T),h.containsPoint(r)))return C.e(r),!0}return C.e(r),this.Lt!==null}return!1}g0(t){if(this.Hn===t)return this;const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n].g0(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,i){if(i(this,t),t instanceof yt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++)this.walkVisualTreeFrom(s[o],i)}}Gr(t){this.VA(this,t)}VA(t,i){i(t);const s=t.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r instanceof yt&&this.VA(r,i)}}Dv(t){this.zA(this,t)}zA(t,i){if(i(t),t instanceof yt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++)this.zA(s[o],i)}}findInVisualTree(t){return this.XA(this,t)}XA(t,i){if(i(t))return t;if(t instanceof yt){const s=t.C.r,n=s.length;for(let o=0;o<n;o++){const r=this.XA(s[o],i);if(r!==null)return r}}return null}findObject(t){if(this.name===t)return this;const i=this.C.r;let s=i.length;this.Fv()&&(s=this.lp());for(let n=0;n<s;n++){const o=i[n];if(o instanceof yt){const r=o.findObject(t);if(r!==null)return r}if(o.name===t)return o}return null}YA(){const t=this.C.r,i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];o instanceof yt?s=Math.max(s,o.YA()):o instanceof At&&(s=Math.max(s,o.Rv()))}return s}an(){return!(this.type===yt.TableRow||this.type===yt.TableColumn)}$r(){return this.type===yt.TableRow||this.type===yt.TableColumn}bL(t,i,s){if(this.pickable===!1||(i===void 0&&(i=null),s===void 0&&(s=null),this._e()))return null;const n=this.naturalBounds,o=1/this.getDocumentScale(),r=this.an(),a=r?t:C.V(t.x,t.y).Oe(this.T),h=this.diagram;let l=10,c=5;if(h!==null&&(l=h.getInputOption("extraTouchArea"),c=l/2),G.contains(-(c*o),-(c*o),n.width+l*o,n.height+l*o,a.x,a.y)){if(!this.af){const f=this.C.r,m=f.length,p=C.l(),y=this.isClipping&&this.H===yt.Spot,x=y?this.findMainElement():null;if(y&&(x.an()?p.set(t).Oe(x.T):p.set(t),!x.containsPoint(p)))return C.e(p),r||C.e(a),null;const b=this.Uo();for(let M=m;M--;){const P=f[M];if(!P.visible&&P!==b||(P.an()?p.set(t).Oe(P.T):p.set(t),y&&P===x))continue;let k=null;if(P instanceof yt?k=P.bL(p,i,s):P.pickable===!0&&P.containsPoint(p)&&(k=P),k!==null&&(i!==null&&(k=i(k)),k!==null&&(s===null||s(k))))return C.e(p),r||C.e(a),k}C.e(p)}if(this.background===null)return r||C.e(a),null;const d=G.contains(0,0,n.width,n.height,a.x,a.y)?this:null;return r||C.e(a),d}return r||C.e(a),null}kL(t,i,s,n){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const o=this.naturalBounds,r=this.an(),a=r?t:C.V(t.x,t.y).Oe(this.T),h=this.$r(),l=G.contains(0,0,o.width,o.height,a.x,a.y);if(h||l){if(!this.af){const c=this.C.r,d=c.length,f=C.l(),m=this.Uo();for(let p=d;p--;){const y=c[p];if(!y.visible&&y!==m)continue;y.an()?f.set(t).Oe(y.T):f.set(t);let x=y;const b=y instanceof yt?y:null;if(b!==null?b.kL(f,i,s,n):x.containsPoint(f)){if(x.pickable===!1)continue;i!==null&&(x=i(x)),x!==null&&(s===null||s(x))&&n.add(x)}}C.e(f)}return r||C.e(a),l&&this.background!==null}return r||C.e(a),!1}Tm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let a=r;if(a===void 0&&(a=Pt.l(),a.Ri()),a.nc(this.T),this.containedInRect(t,a))return this.Y2(i,s,o),r===void 0&&Pt.e(a),!0;if(this.intersectsRect(t,a)){if(!this.af){const h=this.Uo(),l=this.C.r,c=l.length;for(let d=c;d--;){const f=l[d];if(!f.visible&&f!==h)continue;const m=f.actualBounds,p=this.naturalBounds;if(m.x>p.width||m.y>p.height||m.x+m.width<0||m.y+m.height<0)continue;let y=f;const x=f instanceof yt?f:null,b=Pt.l();b.set(a),(x!==null?x.Tm(t,i,s,n,o,b):y.wA(t,n,b))&&(i!==null&&(y=i(y)),y!==null&&(s===null||s(y))&&o.add(y)),Pt.e(b)}}return r===void 0&&Pt.e(a),n}return r===void 0&&Pt.e(a),!1}Y2(t,i,s){const n=this.C.r,o=n.length;for(let r=o;r--;){const a=n[r];if(!a.visible)continue;const h=a.actualBounds,l=this.naturalBounds;if(h.x>l.width||h.y>l.height||h.x+h.width<0||h.y+h.height<0)continue;a instanceof yt&&a.Y2(t,i,s);let c=a;t!==null&&(c=t(c)),c!==null&&(i===null||i(c))&&s.add(c)}}PL(t,i,s,n,o,r){if(this.pickable===!1)return!1;s===void 0&&(s=null),n===void 0&&(n=null);const a=this.naturalBounds,h=this.an(),l=h?t:C.V(t.x,t.y).Oe(this.T),c=h?i:C.V(i.x,i.y).Oe(this.T),d=l.distanceSquaredPoint(c),f=l.x>0&&l.x<a.width&&l.y>0&&l.y<a.height||C.distanceLineSegmentSquared(l.x,l.y,0,0,0,a.height)<=d||C.distanceLineSegmentSquared(l.x,l.y,0,a.height,a.width,a.height)<=d||C.distanceLineSegmentSquared(l.x,l.y,a.width,a.height,a.width,0)<=d||C.distanceLineSegmentSquared(l.x,l.y,a.width,0,0,0)<=d,m=l.distanceSquared(0,0)<=d&&l.distanceSquared(0,a.height)<=d&&l.distanceSquared(a.width,0)<=d&&l.distanceSquared(a.width,a.height)<=d;if(h||(C.e(l),C.e(c)),f){if(!this.af){const p=C.l(),y=C.l(),x=this.Uo(),b=this.C.r,M=b.length;for(let P=M;P--;){const k=b[P];if(!k.visible&&k!==x)continue;const L=k.actualBounds,T=this.naturalBounds;if(h&&(L.x>T.width||L.y>T.height||L.x+L.width<0||L.y+L.height<0))continue;if(k.an()){const E=k.T;p.set(t).Oe(E),y.set(i).Oe(E)}else p.set(t),y.set(i);let D=k;const B=k instanceof yt?k:null;(B!==null?B.PL(p,y,s,n,o,r):D.xA(p,y,o))&&(s!==null&&(D=s(D)),D!==null&&(n===null||n(D))&&r.add(D))}C.e(p),C.e(y)}return o?f:m}return!1}E2(t){let i=null;if(t instanceof At){i=t.spot1,i===U.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot1)}return i===null&&(i=U.TopLeft),i}U2(t){let i=null;if(t instanceof At){i=t.spot2,i===U.Default&&(i=null);const s=t.geometry;s!==null&&i===null&&(i=s.spot2)}return i===null&&(i=U.BottomRight),i}add(...t){for(let i=0;i<t.length;i++)this.insertAt(this.C.count,t[i]);return this}elt(t){return this.C.elt(t)}insertAt(t,i){i instanceof Ht&&u.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&u.o("Cannot make a Panel contain itself: "+this.toString()),u.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const s=i.panel;if(s!==null&&s!==this&&u.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.H===yt.Grid&&!(i instanceof At)&&u.o("Can only add Shapes to a Grid Panel, not: "+i),this.H===yt.Graduated&&!(i instanceof At||i instanceof ae)&&u.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.Pa(this),i.Jr=null,this.itemArray!==null){const a=i.data;u.G(a)&&(this.Gs===null&&(this.Gs=new Z),this.Gs.set(a,i))}const n=this.C;let o=-1;if(s===this){let a=-1;const h=this.C.r,l=h.length;for(let c=0;c<l;c++)if(h[c]===i){a=c;break}if(a!==-1){if(a===t||a+1>=n.count&&t>=n.count)return;n.removeAt(a),o=a}else u.o("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),(t===0||i.isPanelMain)&&(this.Qr=null),this.To()||this.c(),i.c(!1),i.portId!==null?this.fn=!0:i instanceof yt&&i.fn===!0&&(this.fn=!0),this.ss=null,this.isEnabledObject()||this.i1(i,!1);const r=this.part;if(r!==null){r.A0(),r.cf(),this.fn&&r instanceof gt&&(r.fn=!0),r.fn&&r instanceof gt&&(r.ne=null);const a=this.diagram;if(a!==null&&a.undoManager.isUndoingRedoing)return;o!==-1&&r.raiseChangedEvent(4,"elements",this,i,null,o,null),r.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get fn(){return(this.n&8388608)!==0}set fn(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}p2(){return(this.n&16777216)!==0}G2(t){t?this.n|=16777216:this.n&=-16777217}Tv(t){t.Pa(this),t.Jr=null;const i=this.C,s=i.count;i.insertAt(s,t);const n=this.part;if(n!==null){n.A0(),t.portId!==null&&n instanceof gt&&(n.fn=!0);const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(3,"elements",this,null,t,null,s)}}ZR(t){const i=this.C.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}return n}remove(t){const i=this.C.r,s=i.length;let n=-1;for(let o=0;o<s;o++)if(i[o]===t){n=o;break}n!==-1&&this.te(n,!0)}removeAt(t){t>=0&&this.te(t,!0)}te(t,i){const s=this.C,n=s.elt(t);if(n.Jr=null,n.Pa(null),this.Gs!==null){const r=n.data;u.G(r)&&this.Gs.delete(r)}s.removeAt(t),this.ue(!1),this.c(),this.Qr===n&&(this.Qr=null),this.ss=null;const o=this.part;if(o!==null){o.A0(),o.cf(),o.invalidateAdornments(),o instanceof gt&&(n instanceof yt?n.walkVisualTreeFrom(n,(a,h)=>o.C2(h,i)):o.C2(n,i));const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;o.raiseChangedEvent(4,"elements",this,n,null,t,null)}}get Xe(){return this.F===null&&(this.F=new Re),this.F.Xe}get rowCount(){return this.F===null?0:this.Xe.length}getRowDefinition(t){t<0&&u.W(t,">= 0",yt,"getRowDefinition:idx"),t=Math.round(t);const i=this.Xe;if(i[t]===void 0){const s=new Me;s.Pa(this),s.isRow=!0,s.index=t,i[t]=s,this.raiseChangedEvent(3,"rowdefs",this,null,s,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&u.W(t,">= 0",yt,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const i=this.Xe,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,t,null),this.c()}}$L(t,i){const s=this.Xe;if(!(t<0)){if(s[t]=i instanceof Me?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}get Ye(){return this.F===null&&(this.F=new Re),this.F.Ye}get columnCount(){return this.F===null?0:this.Ye.length}getColumnDefinition(t){t<0&&u.W(t,">= 0",yt,"getColumnDefinition:idx"),t=Math.round(t);const i=this.Ye;if(i[t]===void 0){const s=new Me;s.Pa(this),s.isRow=!1,s.index=t,i[t]=s,this.raiseChangedEvent(3,"coldefs",this,null,s,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&u.W(t,">= 0",yt,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const i=this.Ye,s=i[t];if(s){i[t]=void 0;let n=i.length-1;for(;n>=0&&i[n--]===void 0;)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,t,null),this.c()}}ZL(t,i){const s=this.Ye;if(!(t<0)){if(s[t]=i instanceof Me?i:void 0,!i){let n=s.length-1;for(;n>=0&&s[n--]===void 0;)s.length--}this.c()}}addRowColumnDefinition(t){let i=null;return t.isRow?i=this.getRowDefinition(t.index):t.isRow||(i=this.getColumnDefinition(t.index)),i&&i.Hb(t),this}addRowDefinition(t,i){const s=this.getRowDefinition(t);return s&&s.Hb(new Me(i)),this}addColumnDefinition(t,i){const s=this.getColumnDefinition(t);return s&&s.Hb(new Me(i)),this}get rowSizing(){return this.F!==null?this.F.hp:3}set rowSizing(t){const i=this.rowSizing;i!==t&&(this.F===null&&(this.F=new Re),this.F.hp=t,this.c(),this.t("rowSizing",i,t))}get columnSizing(){return this.F!==null?this.F.ap:3}set columnSizing(t){const i=this.columnSizing;i!==t&&(this.F===null&&(this.F=new Re),this.F.ap=t,this.c(),this.t("columnSizing",i,t))}get topIndex(){return this.F!==null?this.F.cp:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&u.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.F===null&&(this.F=new Re),this.F.cp=t,this.c(),this.t("topIndex",i,t))}get leftIndex(){return this.F!==null?this.F.fp:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&u.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.F===null&&(this.F=new Re),this.F.fp=t,this.c(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==yt.Table||this.rowCount===0)return-1;let i=0;const s=this.Xe,n=s.length;let o=this.topIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}findColumnForLocalX(t){if(t<0||this.type!==yt.Table||this.columnCount===0)return-1;let i=0;const s=this.Ye,n=s.length;let o=this.leftIndex;for(;o<n;o++){const r=s[o];if(r!==void 0&&(i+=r.total,t<i))return o}return o}graduatedPointForValue(t,i){if(i===void 0&&(i=new C(NaN,NaN)),this.type!==yt.Graduated)return i.i(NaN,NaN),i;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const s=this.findMainElement();return s.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,i),s.T.gt(i)}graduatedValueForPoint(t){if(this.type!==yt.Graduated)return NaN;const i=this.findMainElement();return i.T.$e(t),i.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this._t}set data(t){const i=this._t;if(i!==t){const s=this instanceof Ht&&!(this instanceof Ft);s&&u.s(t,"object",yt,"data"),this.Et(),this._t=t;const n=this.diagram;if(n!==null)if(s)n.partManager.vv(this,i,t);else{const o=this.panel;o!==null&&o.Gs!==null&&(i!==null&&o.Gs.delete(i),t!==null&&o.Gs.set(t,this))}if(this.t("data",i,t),n!==null&&n.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.rd}set itemIndex(t){const i=this.rd;i!==t&&(this.rd=t,this.t("itemIndex",i,t))}get Ys(){return this.p!==null?this.p.Ys:null}set Ys(t){this.Ci!==t&&(this.p===null&&(this.p=new us),this.p.Ys=t)}L2(){return this.Ys!==null}AA(){const t=this.Ys;return t!==null&&t.h}freezeBindings(){return this.Et()}Et(){let t=this.Ys;if(t===null)this.data!==null&&u.o("Template cannot have .data be non-null: "+this),this.Ys=t=new Y;else if(t.h)return this;const i=new Y;this.G2(!1),this.walkVisualTreeFrom(this,(o,r)=>{r.ch();const a=r.Ci;if(a!==null){r.S2(!1);const h=a.iterator;for(;h.next();){const l=h.value;l.mode===2&&r.S2(!0);const c=l.sourceName;if(l.isToObject){c==="/"&&o.G2(!0);const d=l.yA(o,r);d!==null&&(i.add(d),d.qn===null&&(d.qn=new Y),d.qn.add(l))}t.add(l)}}if(r instanceof yt&&r.type===yt.Table){if(r.rowCount>0){const h=r.Xe,l=h.length;for(let c=0;c<l;c++){const d=h[c];if(d!==void 0&&d.bs!==null){const f=d.bs.iterator;for(;f.next();){const m=f.value;m.be=d,m.ad=2,m.ff=d.index,t.add(m)}}}}if(r.columnCount>0){const h=r.Ye,l=h.length;for(let c=0;c<l;c++){const d=h[c];if(d!==void 0&&d.bs!==null){const f=d.bs.iterator;for(;f.next();){const m=f.value;m.be=d,m.ad=1,m.ff=d.index,t.add(m)}}}}}});const s=i.iterator;for(;s.next();){const o=s.value;if(o.qn!==null){o.S2(!0);const r=o.qn.iterator;for(;r.next();){const a=r.value;o.Ci===null&&(o.Ci=new Y),o.Ci.add(a)}}o.qn=null}let n=t.iterator;for(;n.next();){const o=n.value;let r=o.be;if(r!==null){o.be=null;const a=o.targetProperty,h=a.indexOf(".");if(h>0&&r instanceof yt){const l=a.substring(0,h),c=a.substring(h+1),d=r.findObject(l);d!==null?(r=d,o.targetProperty=c):(u.ni('Warning: unable to find GraphObject named "'+l+'" for Binding: '+o.toString()),r=null)}if(r instanceof Me){const l=I.as(r.panel);o.targetId=l===void 0?-1:l,r.panel.Hn=o.targetId}else if(r instanceof Xt){const l=I.as(r);o.targetId=l===void 0?-1:l,r.Hn=o.targetId}else u.o("Unknown type of binding target: "+r);o.check(r)}}return t.u(),this instanceof Ht&&this.ke()&&this.ensureBounds(),this}copyTemplate(t){t===void 0&&(t=!1);const i=this.copy();return i.Dv(s=>{s instanceof yt&&(s.Ys=null,s._t=null);const n=s.Ci;n!==null&&(s.Ci=null,n.each(r=>s.bind(r.copy())));const o=s.ws;o!==null&&(s.ws=null,o.each(r=>s.trigger(r.value.copy())))}),t&&i.Et(),i}updateTargetBindings(t){var o;const i=this.Ys;if(i===null)return;t===void 0&&(t="");const s=(o=this.diagram)==null?void 0:o.model,n=i.iterator;for(;n.next();){const r=n.value,a=this.GA(r,t);if(a===null)continue;const{data:h,elt:l}=a;r.isToTheme&&this.diagram===null||l!==void 0&&r.updateTarget(l,h,void 0,s)}}Do(){if(this.diagram!==null)if(this.L2()){const t=this.diagram.model,i=this.Ys.iterator;for(;i.next();){const s=i.value;if(!s.isToTheme)continue;const n=this.GA(s);if(n===null)continue;const{data:o,elt:r}=n;r!==void 0&&s.updateTarget(r,o,void 0,t)}}else{const t=this.C.r,i=t.length;for(let s=0;s<i;s++)t[s].Do()}}GA(t,i=""){const s=t.sourceProperty;if(i!==""&&s!==""&&s!==i)return null;const n=t.targetProperty;if(t.converter===null&&n==="")return null;let o=this.data;const r=t.sourceName;if(t.isToObject){if(o=this.pA(r),o===null)return null}else if(t.isToModel){const c=this.diagram;if(c===null)return null;o=c.model.modelData}let a=this;const h=t.targetId;if(h!==-1){if(a=this.g0(h),a===null)return null}else t.be!==null&&(a=t.be);r==="/"?o=a.part:r==="."?o=a:r===".."&&(o=a.panel);const l=t.ad;if(l!==0){if(!(a instanceof yt))return null;l===1?a=a.getColumnDefinition(t.ff):l===2&&(a=a.getRowDefinition(t.ff))}return{data:o,elt:a}}get itemArray(){return this.wh}set itemArray(t){const i=this.wh;if(i!==t||t!==null&&this.Ov(t)){const s=this.diagram;if(i!==t&&(s!==null&&i!==null&&s.partManager.EM(this,s),this.wh=t,s!==null&&t!==null&&s.partManager.IM(this,s)),this.t("itemArray",i,t),s!==null&&s.undoManager.isUndoingRedoing)return;this.KA(i,t)}}findItemPanelForData(t){return t==null||this.Gs===null?null:(u.ec(t,yt,"findItemPanelForData"),this.Gs.get(t))}Ov(t){const i=this.C.r,s=i.length,n=t.length;let o=0,r=null;for(;o<s&&(r=i[o],!(r instanceof yt)||r.data===null);)o++,r=i[o];if(s-o!==n)return!0;if(r===null)return n>0;let a=0;for(;o<s&&a<n;){if(r=i[o],!(r instanceof yt)||r.data!==t[a])return!0;o++,a++}return!1}lp(){if(this.type===yt.Spot||this.type===yt.Auto)return Math.min(this.C.length,1);if(this.type===yt.Link){const t=this.C,i=t.length;let s=0;for(;s<i;s++){const n=t.elt(s);if(!(n instanceof At)||!n.isPanelMain)return s}return s}if(this.type===yt.Table&&this.C.length>0){const t=this.C.elt(0);if(t.isPanelMain&&t instanceof yt&&t.$r())return 1}return 0}rebuildItemElements(){const t=this.lp();for(;this.C.length>t;)this.te(this.C.length-1,!1);this.KA(null,this.itemArray)}KA(t,i){const s=this.lp(),n=i;if(n===null||n.length===0){for(;this.C.length>s;)this.te(this.C.length-1,!1);return}if(this.C.length<=s){const o=n.length;for(let r=0;r<o;r++)this.e1(n[r],r,!0)}else{let o=s;for(let a=0;a<n.length;a++,o++){const h=n[a],l=o<this.C.length?this.C.elt(o):null;if(l instanceof yt){if(l.data!==h){const c=this.K2(l.data,a),d=this.K2(h,a);let f=d!==c;if(!f){const m=this.j2(l.data,a,c);f=this.j2(h,a,d)!==m}f?(this.te(o,!1),this.e1(h,a,!1)):l.data=h}}else this.e1(h,a,!1)}for(;o<this.C.length;)this.te(o,!1);this.Qr=null,this.H2(s,0),this.To()||this.c(),this.ss=null,this.isEnabledObject()||this.i1(this,!1);const r=this.part;r!==null&&(r.A0(),r.cf(),this.fn&&r instanceof gt&&(r.fn=!0),r.fn&&r instanceof gt&&(r.ne=null))}}e1(t,i,s){if(t==null||i<0)return null;const n=this.K2(t,i),o=this.j2(t,i,n);if(o!==null){o.Et();const r=o.copy();if(r.p2()){const h=this.findBindingPanel();h!==null&&h.G2(!0)}u.G(t)&&(this.Gs===null&&(this.Gs=new Z),this.Gs.set(t,r));const a=i+this.lp();return this.insertAt(a,r),s&&(r._t=t,this.H2(a,i),r._t=null),r.data=t,r}return null}Iv(t){if(t<0)return;const i=t+this.lp();this.te(i,!0),this.H2(i,t)}H2(t,i){const s=this.C;let n=t,o=i;for(;n<s.length;){const r=s.elt(n);r instanceof yt&&r.Ev(n,o),n++,o++}}Ev(t,i){this.type===yt.TableRow?this.row=t:this.type===yt.TableColumn&&(this.column=t),this.itemIndex=i}Fv(){return this.wh!==null||this.itemTemplateMap!==null}get itemTemplate(){return this.itemTemplateMap===null?null:this.itemTemplateMap.get("")}set itemTemplate(t){if(this.itemTemplateMap===null){if(t===null)return;this.itemTemplateMap=new Z}const i=this.itemTemplateMap.get("");if(i!==t){(t instanceof Ht||t.isPanelMain)&&u.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.p!==null?this.p.G0:null}set itemTemplateMap(t){const i=this.itemTemplateMap;if(i!==t){const s=t.iterator;for(;s.next();)s.value;this.Kt().G0=t,this.t("itemTemplateMap",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.p!==null?this.p.K0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&(typeof t!="string"&&!u.it(t)&&u.Zi(t,"string or function",yt,"itemCategoryProperty"),this.Kt().K0=t,this.t("itemCategoryProperty",i,t))}K2(t,i){if(t===null)return"";const s=this.itemCategoryProperty;let n="";if(u.it(s))n=s(t);else if(typeof s=="string"&&u.G(t)){if(s==="")return"";const o=this.diagram,r=o!==null?o.model:null;r?n=r.yt(t,s):n=te.yt(t,s)}else return"";if(n===void 0)return"";if(typeof n=="string")return n;u.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+n)}j2(t,i,s){const n=this.itemTemplateMap;let o=null;return n!==null&&(o=n.get(s)),o===null&&(n!==null&&(o=n.get("")),o===null&&(yt.jA||(yt.jA=!0,u.ni('No item template Panel found for category "'+s+'" on '+this),u.ni("  Using default item template."),yt.HA=new yt().add(new ae().bind("text","",u.toString).theme("stroke","text"))),o=yt.HA)),o}get af(){return(this.n&1048576)!==0}set af(t){const i=(this.n&1048576)!==0;i!==t&&(u.s(t,"boolean",yt,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",i,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const i=(this.n&2097152)!==0;i!==t&&(this.Qc(),this.n=this.n^2097152,this instanceof Nt&&(this.si=null),this.c(),this.t("isClipping",i,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const i=(this.n&33554432)!==0;i!==t&&(this.n=this.n^33554432,this.c(),this.t("isOpposite",i,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const i=(this.n&4194304)!==0;if(i!==t){const s=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",i,t);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s&&this.i1(this,t)}}i1(t,i){const s=t.enabledChanged;if(s!==null&&s(t,i),t instanceof yt){const n=t.C.r,o=n.length;for(let r=0;r<o;r++){const a=n[r];i&&a instanceof yt&&!a.isEnabled||this.i1(a,i)}}}get alignmentFocusName(){return this.to}set alignmentFocusName(t){const i=this.to;i!==t&&(this.to=t,this.c(),this.t("alignmentFocusName",i,t))}static definePanelLayout(t,i){Yt.dn(t,i)}static isBuilderDefined(t){return Yt.es.has(t)}};g(yt,"FE",!1),g(yt,"jA",!1),g(yt,"HA",null),g(yt,"Position",Yt.es.get("Position")),g(yt,"Horizontal",Yt.es.get("Horizontal")),g(yt,"Vertical",Yt.es.get("Vertical")),g(yt,"Spot",Yt.es.get("Spot")),g(yt,"Auto",Yt.es.get("Auto")),g(yt,"Table",Yt.es.get("Table")),g(yt,"Viewbox",Yt.es.get("Viewbox")),g(yt,"TableRow",Yt.es.get("TableRow")),g(yt,"TableColumn",Yt.es.get("TableColumn")),g(yt,"Link",Yt.es.get("Link")),g(yt,"Grid",Yt.es.get("Grid")),g(yt,"Graduated",Yt.es.get("Graduated"));let bt=yt;bt.definePanelLayout=bt.definePanelLayout;class Ai{constructor(){g(this,"sp");g(this,"np");g(this,"op");g(this,"rp");g(this,"xs");g(this,"Ge");g(this,"ss");g(this,"Pe");this.sp=0,this.np=100,this.op=10,this.rp=0,this.xs=null,this.Ge=null,this.ss=null,this.Pe=null}copy(){const e=new Ai;return e.sp=this.sp,e.np=this.np,e.op=this.op,e.rp=this.rp,e.xs=this.xs,e.Ge=this.Ge,e.ss=this.ss,e.Pe=this.Pe,e}}class As{constructor(){g(this,"ld");g(this,"hd");g(this,"Yc");g(this,"J0");this.ld=rt.wC,this.hd=C.xo,this.Yc=rt.ww,this.J0=[]}copy(){const e=new As;return e.ld=this.ld.copy(),e.hd=this.hd.copy(),e.Yc=this.Yc.copy(),e.J0=this.J0,e}}class Re{constructor(){g(this,"Xe");g(this,"Ye");g(this,"hp");g(this,"ap");g(this,"cp");g(this,"fp");g(this,"$0");g(this,"Q0");g(this,"Z0");g(this,"_0");g(this,"ip");g(this,"tp");g(this,"ep");g(this,"yh");this.Xe=[],this.Ye=[],this.hp=3,this.ap=3,this.cp=0,this.fp=0,this.$0=wt.Rg,this.Q0=1,this.Z0=null,this._0=null,this.ip=1,this.tp=null,this.ep=null,this.yh=null}copy(e){const t=new Re,i=this.Xe,s=i.length,n=t.Xe;for(let h=0;h<s;h++){if(i[h]===void 0)continue;const l=i[h].copy();l.Pa(e),n[h]=l}const o=this.Ye,r=o.length,a=t.Ye;for(let h=0;h<r;h++){if(o[h]===void 0)continue;const l=o[h].copy();l.Pa(e),a[h]=l}return t.hp=this.hp,t.ap=this.ap,t.cp=this.cp,t.fp=this.fp,t.$0=this.$0.P(),t.Q0=this.Q0,t.Z0=this.Z0,t._0=this._0,t.ip=this.ip,t.tp=this.tp,t.ep=this.ep,t.yh=this.yh,t}}var Lo=(S=>(S[S.Default=1]="Default",S[S.None=2]="None",S[S.ProportionalExtra=3]="ProportionalExtra",S))(Lo||{});const di=class di{constructor(e){g(this,"Vs");g(this,"dp");g(this,"At");g(this,"Ca");g(this,"La");g(this,"hi");g(this,"at");g(this,"cd");g(this,"$n");g(this,"_r");g(this,"fd");g(this,"ud");g(this,"Aa");g(this,"Lt");g(this,"dd");g(this,"bs");g(this,"_");g(this,"Ai");g(this,"de");I.Ki(this),this.Vs=null,this.dp=!0,this.At=0,this.de=NaN,this.Ca=0,this.La=1/0,this.hi=U.Default,this._=0,this.Ai=0,this.at=0,this.bs=null,this.cd=1,this.$n=1,this._r=null,this.fd=null,this.ud=NaN,this.Aa=null,this.Lt=null,this.dd=!1,e&&(Object.assign(this,e),e.column!==void 0?(this.isRow=!1,this.index=e.column):e.row!==void 0&&(this.isRow=!0,this.index=e.row))}copy(){const e=new di;return e.dp=this.dp,e.At=this.At,e.de=this.de,e.Ca=this.Ca,e.La=this.La,e.hi=this.hi,e._=this._,e.Ai=this.Ai,e.at=this.at,e.$n=this.$n,e.cd=this.cd,this._r===null?e._r=null:e._r=this._r.P(),e.fd=this.fd,e.ud=this.ud,e.Aa=null,this.Aa!==null&&(e.separatorDashArray=this.Aa.slice()),e.Lt=this.Lt,e.dd=this.dd,e.bs=this.bs,e}Hb(e){e.isRow?e.height!==void 0&&(this.height=e.height):e.width!==void 0&&(this.width=e.width),e.minimum!==void 0&&(this.minimum=e.minimum),e.maximum!==void 0&&(this.maximum=e.maximum),e.alignment!==void 0&&(this.alignment=e.alignment),e.stretch!==void 0&&(this.stretch=e.stretch),e.sizing!==void 0&&(this.sizing=e.sizing),e.separatorPadding!==void 0&&(this.separatorPadding=e.separatorPadding),e.separatorStroke!==void 0&&(this.separatorStroke=e.separatorStroke),e.separatorStrokeWidth!==void 0&&(this.separatorStrokeWidth=e.separatorStrokeWidth),e.separatorDashArray!==void 0&&(this.Aa=e.separatorDashArray),e.background!==void 0&&(this.background=e.background),e.coversSeparators!==void 0&&(this.coversSeparators=e.coversSeparators),e.bs!==void 0&&(this.bs=e.bs)}oi(e){e in Lo?this.sizing=e:u.er(this,e)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+I.as(this)}Pa(e){this.Vs=e}computeEffectiveSpacingTop(e){let t=0;const i=this.Vs;if(this.index!==e){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(i!==null?t=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:t=0))}let s=this._r;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return t;return t+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let e=0;const t=this.Vs;let i=0;const s=this.isRow;if(t!==null&&t.type===bt.Table){const o=s?t.Xe.length:t.Ye.length;for(let r=0;r<o;r++){const a=s?t.Xe[r]:t.Ye[r];if(a!==void 0&&a._!==0){i=a.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&t!==null&&(o=s?t.defaultRowSeparatorStroke:t.defaultColumnSeparatorStroke),o!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(t!==null?e=s?t.defaultRowSeparatorStrokeWidth:t.defaultColumnSeparatorStrokeWidth:e=0))}let n=this._r;if(n===null)if(t!==null)n=t.defaultSeparatorPadding;else return e;return e+(this.isRow?n.top+n.bottom:n.left+n.right)}t(e,t,i,s,n){const o=this.Vs;if(o!==null&&(o.raiseChangedEvent(2,e,this,t,i,s,n),this.bs!==null)){const r=o.diagram;if(r!==null&&!r.fe){const a=o.findBindingPanel();if(a!==null){const h=a.data;if(h!==null){const l=this.bs.iterator;for(;l.next();)l.value.updateSource(this,h,e,a)}}}}}get panel(){return this.Vs}get isRow(){return this.dp}set isRow(e){this.dp=e}get index(){return this.At}set index(e){this.At=e}get height(){return this.de}set height(e){const t=this.de;t!==e&&(e<0&&u.W(e,">= 0",di,"height"),this.de=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("height",t,e))}get width(){return this.de}set width(e){const t=this.de;t!==e&&(e<0&&u.W(e,">= 0",di,"width"),this.de=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("width",t,e))}get minimum(){return this.Ca}set minimum(e){const t=this.Ca;t!==e&&((e<0||!isFinite(e))&&u.W(e,">= 0",di,"minimum"),this.Ca=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("minimum",t,e))}get maximum(){return this.La}set maximum(e){const t=this.La;t!==e&&(e<0&&u.W(e,">= 0",di,"maximum"),this.La=e,this.actual=this._,this.panel!==null&&this.panel.c(),this.t("maximum",t,e))}get alignment(){return this.hi}set alignment(e){const t=this.hi;t.equals(e)||(this.hi=e.P(),this.panel!==null&&this.panel.c(),this.t("alignment",t,e))}get stretch(){return this.$n}set stretch(e){const t=this.$n;t!==e&&(this.$n=e,this.panel!==null&&this.panel.c(),this.t("stretch",t,e))}get separatorPadding(){return this._r}set separatorPadding(e){typeof e=="number"&&(e=new wt(e));const t=this._r;(e===null||t===null||!t.equals(e))&&(e!==null&&(e=e.P()),this._r=e,this.panel!==null&&this.panel.c(),this.t("separatorPadding",t,e))}get separatorStroke(){return this.fd}set separatorStroke(e){const t=this.fd;t!==e&&(e!==null&&Jt.Qu(e,"RowColumnDefinition.separatorStroke"),e instanceof Jt&&e.u(),this.fd=e,this.panel!==null&&this.panel.c(),this.t("separatorStroke",t,e))}get separatorStrokeWidth(){return this.ud}set separatorStrokeWidth(e){const t=this.ud;t!==e&&(this.ud=e,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",t,e))}get separatorDashArray(){return this.Aa}set separatorDashArray(e){const t=this.Aa;if(t!==e){if(e!==null&&!Array.isArray(e)&&u.Zi(e,"Array",di,"separatorDashArray:value"),e!==null){const i=e.length;let s=0;for(let n=0;n<i;n++){const o=e[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&u.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(t===null)return;e=null}}this.Aa=e,this.panel!==null&&this.panel.S(),this.t("separatorDashArray",t,e)}}get background(){return this.Lt}set background(e){const t=this.Lt;t!==e&&(e!==null&&Jt.Qu(e,"RowColumnDefinition.background"),e instanceof Jt&&e.u(),this.Lt=e,this.panel!==null&&this.panel.S(),this.t("background",t,e))}get coversSeparators(){return this.dd}set coversSeparators(e){const t=this.dd;t!==e&&(u.s(e,"boolean",di,"coversSeparators"),this.dd=e,this.panel!==null&&this.panel.S(),this.t("coversSeparators",t,e))}get sizing(){return this.cd}set sizing(e){const t=this.cd;t!==e&&(this.cd=e,this.panel!==null&&this.panel.c(),this.t("sizing",t,e))}Qb(){if(this.sizing===1){const e=this.Vs;return this.isRow?e.rowSizing:e.columnSizing}return this.sizing}get actual(){return this._}set actual(e){isNaN(this.de)?this._=Math.max(Math.min(this.La,e),this.Ca):this._=Math.max(Math.min(this.La,this.de),this.Ca)}get measured(){return this.Ai}set measured(e){this.Ai=e}get total(){return this._+this.computeEffectiveSpacing()}get position(){return this.at}set position(e){this.at=e}bind(e,t,i,s){return this.sf(e,t,i,s),this}bindTwoWay(e,t,i,s){const n=this.sf(e,t,i,s);return s===void 0&&n.makeTwoWay(),this}theme(e,t,i,s,n){return this.mh(e,t,i,s,n),this}themeData(e,t,i,s,n){return this.mh(e,t,i,s,n).ofData(),this}themeObject(e,t,i,s,n,o){return this.mh(e,t,i,s,n).ofObject(o),this}themeModel(e,t,i,s,n){return this.mh(e,t,i,s,n).ofModel(),this}sf(e,t,i,s){let n;return typeof e=="string"?n=new Vi(e,t,i,s):n=e,this.Y0(n),n}mh(e,t,i,s,n){let o;return typeof e=="string"?o=new Es(e,t,i,s,n):o=e,this.Y0(o),o}Y0(e){e.be=this;const t=this.panel;if(t!==null){const i=t.findBindingPanel();i!==null&&i.AA()&&u.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+e+" on "+t)}this.bs===null&&(this.bs=new Y),this.bs.add(e)}};g(di,"Default",1),g(di,"None",2),g(di,"ProportionalExtra",3);let Me=di;const Zt=class Zt extends Xt{constructor(t,i){super();g(this,"ot");g(this,"ks");g(this,"gd");g(this,"Ta");g(this,"ji");g(this,"Vo");g(this,"Io");g(this,"jt");g(this,"md");g(this,"pd");g(this,"K");this.ot=null,this.ks=null,this.gd="None",this.Ta="black",this.ji="black",this.Vo=1,this.Io=null,this.jt=null,this.md=NaN,this.pd=NaN,this.K=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.ot=this.ot,t.ks=this.ks,t.gd=this.gd,t.Ta=this.Ta,t.ji=this.ji,t.Vo=this.Vo,this.Io!==null&&(t.Io=this.Io.slice()),this.jt!==null&&(this.jt.fi?t.jt=this.jt:t.jt=this.jt.copy()),t.md=this.md,t.pd=this.pd,this.K!==null&&(t.K=this.K.copy())}Da(){return this.jt===null?this.jt=new Do:this.jt.fi&&(this.jt=this.jt.copy()),this.jt}ch(){super.ch(),this.jt!==null&&(this.jt.fi=!0)}oi(t){t in re?this.geometryStretch=t:super.oi(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+I.as(this)}Uv(t,i){const s=this.pathPattern;s.ht(1/0,1/0);const n=s.measuredBounds;s.Bt(0,0,n.width,n.height);const o=this.geometry;t.save(),t.beginPath();const r=u.et();if(o.type===1)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.endY),this.yd(t,i,r,s);else if(o.type===4){const a=o.figures.iterator;for(;a.next();){const h=a.value;r.length=0,r.push(h.startX),r.push(h.startY);let l=h.startX,c=h.startY,d=l,f=c;const m=h.segments.r,p=m.length;for(let y=0;y<p;y++){const x=m[y];switch(x.type){case 1:this.yd(t,i,r,s),r.length=0,r.push(x.endX),r.push(x.endY),l=x.endX,c=x.endY,d=l,f=c;break;case 2:r.push(x.endX),r.push(x.endY),l=x.endX,c=x.endY;break;case 3:O.vn(l,c,x.point1X,x.point1Y,x.point2X,x.point2Y,x.endX,x.endY,.5,r),l=x.endX,c=x.endY;break;case 4:O.Og(l,c,x.point1X,x.point1Y,x.endX,x.endY,.5,r),l=x.endX,c=x.endY;break;case 5:{const b=x.bo(h),M=b.length;if(M===0){r.push(x.centerX),r.push(x.centerY),l=x.centerX,c=x.centerY;break}for(let P=0;P<M;P++){const k=b[P];O.vn(l,c,k[2],k[3],k[4],k[5],k[6],k[7],.5,r),l=k[6],c=k[7]}break}case 6:{const b=x.Bh(h,l,c),M=b.length;if(M===0){r.push(x.endX),r.push(x.endY),l=x.endX,c=x.endY;break}for(let P=0;P<M;P++){const k=b[P];O.vn(l,c,k[2],k[3],k[4],k[5],k[6],k[7],.5,r),l=k[6],c=k[7]}break}default:u.o("Segment not of valid type: "+x.type)}x.isClosed&&(r.push(d),r.push(f),this.yd(t,i,r,s))}this.yd(t,i,r,s)}}else if(o.type===2)r.push(o.startX),r.push(o.startY),r.push(o.endX),r.push(o.startY),r.push(o.endX),r.push(o.endY),r.push(o.startX),r.push(o.endY),r.push(o.startX),r.push(o.startY),this.yd(t,i,r,s);else if(o.type===3){const a=new Gt;a.startX=o.endX,a.startY=(o.startY+o.endY)/2;const h=new Mt(5);h.startAngle=0,h.sweepAngle=360,h.centerX=(o.startX+o.endX)/2,h.centerY=(o.startY+o.endY)/2,h.radiusX=Math.abs(o.startX-o.endX)/2,h.radiusY=Math.abs(o.startY-o.endY)/2,a.add(h);const l=h.bo(a),c=l.length;if(c===0)r.push(h.centerX),r.push(h.centerY);else{let d=a.startX,f=a.startY;for(let m=0;m<c;m++){const p=l[m];O.vn(d,f,p[2],p[3],p[4],p[5],p[6],p[7],.5,r),d=p[6],f=p[7]}}this.yd(t,i,r,s)}u.J(r),t.restore(),t.clearContextCache(!1)}Bv(t){let i=t.measuredBounds.width;return t instanceof Zt&&(i-=t.strokeWidth),i<1&&(i=1),i}yd(t,i,s,n){const o=s.length;if(o<4)return;const r=n.measuredBounds,a=Math.max(1,r.width),h=r.height;let l=s[0],c=s[1],d=0,f=0,m=0,p=0,y=0,x=0,b=0,M=0;const P=u.et();for(let F=2;F<o;F+=2)d=s[F],f=s[F+1],m=d-l,p=f-c,m===0&&(m=.001),y=p/m,x=Math.atan2(p,m),b=Math.sqrt(m*m+p*p),P.push([m,x,y,b]),M+=b,l=d,c=f;l=s[0],c=s[1];const k=this.Bv(n);let L=k;const T=a/2;let D=T!==0,B=0,E=P[B];m=E[0],x=E[1],y=E[2],b=E[3];let R=0;for(;M>=.1;){if(R===0&&(D?(L=k,L-=T,M-=T,D=!1):L=k,L===0&&(L=1)),L>M){L=M,u.J(P);return}L>b?(R=L-b,L=b):R=0;let F=Math.sqrt(L*L/(1+y*y));if(m<0&&(F=-F),l+=F,c+=y*F,t.translate(l,c),t.rotate(x),t.translate(-(a/2),-(h/2)),R===0&&n.gh(t,i),t.translate(a/2,h/2),t.rotate(-x),t.translate(-l,-c),M-=L,b-=L,R!==0){if(B++,B===P.length){u.J(P);return}E=P[B],m=E[0],x=E[1],y=E[2],b=E[3],L=R}}u.J(P)}gh(t,i){const s=t instanceof Ge;let n=this.ji;const o=this.Ta;if(n===null&&o===null)return;const r=this.ot;if(r===null)return;t.commitTransform();const a=this.actualBounds,h=this.naturalBounds;o!==null&&this.rn(t,o,!0,!1,h,a);const l=this.part;let c=this.Vo;n!==null&&c===0&&l!==null&&(this.isPanelMain||l.findMainElement()===this)&&(c=l.Vv()),c===0&&(n=null),n!==null&&c!==0&&(this.rn(t,n,!1,!1,h,a),t.lineWidth=c,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let d=!1;l&&i.getRenderingHint("drawShadows")&&(d=l.isShadowed),t.Zr===!1&&(d=!1);let f=!0;n!==null&&(o===null||o==="transparent")&&(f=!1);let m=!1;const p=this.strokeDashArray;if(p!==null&&(m=!0,t.enableDash(p,this.strokeDashOffset)),r.type===1)t.beginPath(),t.moveTo(r.startX,r.startY),t.lineTo(r.endX,r.endY),n!==null&&t.strokeContext(),t.endPath();else if(r.type===2){const y=r.startX,x=r.startY,b=r.endX,M=r.endY,P=Math.min(y,b),k=Math.min(x,M),L=Math.abs(b-y),T=Math.abs(M-x);t.beginPath(),t.rect(P,k,L,T),o!==null&&t.fillContext(o,!1,null),n!==null&&(f&&d&&t.shadowsOff(),t.strokeContext(),f&&d&&t.shadowsOn()),t.endPath()}else if(r.type===3){const y=r.startX,x=r.startY,b=r.endX,M=r.endY,P=Math.abs(b-y)/2,k=Math.abs(M-x)/2,L=Math.min(y,b)+P,T=Math.min(x,M)+k;t.beginPath(),t.moveTo(L,T-k),t.bezierCurveTo(L+O.Rn*P,T-k,L+P,T-O.Rn*k,L+P,T),t.bezierCurveTo(L+P,T+O.Rn*k,L+O.Rn*P,T+k,L,T+k),t.bezierCurveTo(L-O.Rn*P,T+k,L-P,T+O.Rn*k,L-P,T),t.bezierCurveTo(L-P,T-O.Rn*k,L-O.Rn*P,T-k,L,T-k),t.closePath(),o!==null&&t.fillContext(o,!1,null),n!==null&&(f&&d&&t.shadowsOff(),t.strokeContext(),f&&d&&t.shadowsOn()),t.endPath()}else if(r.type===4){const y=r.figures,x=y.length;for(let b=0;b<x;b++){const M=y.r[b];s?(t.beginPath(),this.buildPath(t,M)):M.Ee===null&&(M.Ee=new Path2D,this.buildPath(M.Ee,M));const P=M.isFilled;d?M.isShadowed?(P===!0&&o!=="transparent"&&o!==null&&t.fillContext(o,M.isEvenOdd,M.Ee),n!==null&&(P&&f&&t.shadowsOff(),t.stroke(M.Ee),P&&f&&t.shadowsOn())):(t.shadowsOff(),P&&o!=="transparent"&&o!==null&&t.fillContext(o,M.isEvenOdd,M.Ee),n!==null&&t.stroke(M.Ee),t.shadowsOn()):(P&&o!==null&&t.fillContext(o,M.isEvenOdd,M.Ee),n!==null&&t.stroke(M.Ee)),t.endPath(b)}}m&&t.disableDash(),this.pathPattern!==null&&this.Uv(t,i)}buildPath(t,i){t.moveTo(i.startX,i.startY);const s=i.segments.r,n=s.length;let o=null;for(let r=0;r<n;r++){const a=s[r];switch(a.type){case 1:t.moveTo(a.endX,a.endY);break;case 2:t.lineTo(a.endX,a.endY);break;case 3:t.bezierCurveTo(a.point1X,a.point1Y,a.point2X,a.point2Y,a.endX,a.endY);break;case 4:t.quadraticCurveTo(a.point1X,a.point1Y,a.endX,a.endY);break;case 5:if(a.radiusX===a.radiusY){const h=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY,c=Math.PI/180;t.arc(a.point1X,a.point1Y,a.radiusX,a.startAngle*c,(a.startAngle+a.sweepAngle)*c,a.sweepAngle<0,h,l)}else{const h=a.bo(i),l=h.length;if(l===0){t.lineTo(a.centerX,a.centerY);break}for(let c=0;c<l;c++){const d=h[c];c===0&&t.lineTo(d[0],d[1]),t.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}}break;case 6:{let h=0,l=0,c;if(o!==null&&o.type===5){c=o.bo(i);const f=c.length;if(f===0){t.lineTo(a.endX,a.endY);break}const m=c[f-1]||null;m!==null&&(h=m[6],l=m[7])}else h=o!==null?o.endX:i.startX,l=o!==null?o.endY:i.startY;c=a.Bh(i,h,l);const d=c.length;if(d===0){t.lineTo(a.endX,a.endY);break}for(let f=0;f<d;f++){const m=c[f];t.bezierCurveTo(m[2],m[3],m[4],m[5],m[6],m[7])}break}}a.isClosed&&t.closePath(),o=a}}Zc(t,i,s){if(!super.Zc(t,i,s)||this.ji===null&&this.Ta===null||this.ot===null||this.pathPattern!==null)return!1;const n=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==n.length?!1:(t.currentPath=this.svg,this.gh(t,i),t.currentPath=null,!0)}$u(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.$u(t)}k2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("path");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}getDocumentPoint(t,i){if(i===void 0&&(i=new C),t instanceof U){const s=t;s.isNoSpot()&&u.o("getDocumentPoint Spot must be a real, specific Spot, not: "+s.toString());const n=this.naturalBounds,o=this.strokeWidth;return i.i(s.x*(n.width+o)-o/2+n.x+s.offsetX,s.y*(n.height+o)-o/2+n.y+s.offsetY),this.Us.gt(i),i}else return i.set(t),this.Us.gt(i),i}getDocumentBounds(t){t===void 0&&(t=new G);const i=this.naturalBounds,s=this.Us,n=G.V(i.x,i.y,i.width,i.height),o=this.strokeWidth;n.inflate(o/2,o/2);const r=C.V(n.x,n.y).T(s);return t.i(r.x,r.y,0,0),r.i(n.right,n.y).T(s),t.unionNoCheck(r.x,r.y,0,0),r.i(n.right,n.bottom).T(s),t.unionNoCheck(r.x,r.y,0,0),r.i(n.x,n.bottom).T(s),t.unionNoCheck(r.x,r.y,0,0),G.e(n),C.e(r),t}fh(t,i){const s=this.geometry;if(s===null||this.fill===null&&this.stroke===null)return!1;const n=s.bounds;let o=this.strokeWidth/2;s.type===1&&!i&&(o+=2);const r=G.l();if(r.a(n),r.inflate(o+2,o+2),!r.containsPoint(t))return G.e(r),!1;const a=o+1e-4;if(s.type===1){if(this.stroke===null)return!1;const h=(s.startX-s.endX)*(t.x-s.endX)+(s.startY-s.endY)*(t.y-s.endY),l=(s.endX-s.startX)*(t.x-s.startX)+(s.endY-s.startY)*(t.y-s.startY);return h<0||l<0?!1:(G.e(r),O.vi(s.startX,s.startY,s.endX,s.endY,o,t.x,t.y))}else if(s.type===2){const h=s.startX,l=s.startY,c=s.endX,d=s.endY;if(r.x=Math.min(h,c),r.y=Math.min(l,d),r.width=Math.abs(c-h),r.height=Math.abs(d-l),this.fill===null){if(r.inflate(-a,-a),r.containsPoint(t))return G.e(r),!1;r.inflate(a,a)}this.stroke!==null&&r.inflate(o,o);const f=r.containsPoint(t);return G.e(r),f}else if(s.type===3){const h=s.startX,l=s.startY,c=s.endX,d=s.endY;let f=Math.min(h,c),m=Math.min(l,d);const p=Math.abs(c-h),y=Math.abs(d-l);let x=p/2,b=y/2;if(f=t.x-(f+x),m=t.y-(m+b),this.fill===null){if(x-=a,b-=a,x<=0||b<=0||f*f/(x*x)+m*m/(b*b)<=1)return G.e(r),!1;x+=a,b+=a}return this.stroke!==null&&(x+=a,b+=a),G.e(r),x<=0||b<=0?!1:f*f/(x*x)+m*m/(b*b)<=1}else{if(s.type===4)return G.e(r),this.fill===null?s.EC(t.x,t.y,o):s.qk(t,o,this.strokeWidth>1,i);u.o("Unknown Geometry type: "+s.type)}}Wu(t,i,s,n){const o=this.desiredSize,r=this.Vo;t=Math.max(t,0),i=Math.max(i,0);let a;if(this.ks!==null)a=this.geometry.bounds;else{const y=this.figure;let x=Zt.q2[y];if(x===void 0){let b=O.In[y];typeof b=="string"&&(b=O.In[b]),u.it(b)?(x=b(null,100,100),Zt.q2[y]=x):u.o("Unsupported Figure: "+y)}a=x.bounds}let h=a.width,l=a.height,c=a.width,d=a.height;switch(this.zs(!0)){case 0:s=0,n=0;break;case 2:c=Math.max(t-r,0),d=Math.max(i-r,0);break;case 5:c=Math.max(t-r,0),n=0;break;case 4:s=0,d=Math.max(i-r,0);break}isFinite(o.width)&&(c=o.width),isFinite(o.height)&&(d=o.height);const f=this.maxSize,m=this.minSize;s=Math.max(s-r,m.width),n=Math.max(n-r,m.height),c=Math.min(f.width,c),d=Math.min(f.height,d),c=isFinite(c)?Math.max(s,c):Math.max(h,s),d=isFinite(d)?Math.max(n,d):Math.max(l,n);const p=this.aS();switch(p){case 0:break;case 2:h=c,l=d;break;case 6:{let y=Math.min(c/h,d/l);isFinite(y)||(y=1),h=h*y,l=l*y;break}default:u.o(p+" is not a valid geometryStretch.")}if(this.ks!==null){h===0&&(h=.001),l===0&&(l=.001);const y=(this.ks!==null?this.ks:this.ot).cF(h,l);this.ot=y}else(this.ot===null||!O.z(this.ot.rc,t-r)||!O.z(this.ot.lc,i-r))&&(this.ot=Zt.zv(this,h,l));a=this.ot.bounds,t===1/0||i===1/0?this.Wn(a.x-r/2,a.y-r/2,t===0&&h===0?0:a.width+r,i===0&&l===0?0:a.height+r):this.Wn(-(r/2),-(r/2),c+r,d+r),o.isReal()?(c=o.width,d=o.height,c=Math.min(f.width,c),d=Math.min(f.height,d),c=Math.max(m.width,c),d=Math.max(m.height,d),this.zi.i(0,0,c,d)):this.zi.a(a)}aS(){const t=this.geometryStretch;return this.ks!==null?t===1?2:t:t===1?Zt.q2[this.figure].defaultStretch:t}uh(t,i,s,n){this.commonArrange(t,i,s,n)}getNearestIntersectionPoint(t,i,s){return this.Jc(t.x,t.y,i.x,i.y,s)}Jc(t,i,s,n,o){const r=this.T,a=1/(r.m11*r.m22-r.m12*r.m21),h=r.m22*a,l=-r.m12*a,c=-r.m21*a,d=r.m11*a,f=a*(r.m21*r.dy-r.m22*r.dx),m=a*(r.m12*r.dx-r.m11*r.dy),p=t*h+i*c+f,y=t*l+i*d+m,x=s*h+n*c+f,b=s*l+n*d+m,M=this.Vo/2;let P=this.ot;P===null&&(this.ht(1/0,1/0),P=this.ot);const k=P.bounds;let L=!1;if(P.type===1)if(this.strokeWidth<=1.5)L=O.On(P.startX,P.startY,P.endX,P.endY,p,y,x,b,o);else{let T=0,D=0;if(P.startX===P.endX)T=M,D=0;else{const V=(P.endY-P.startY)/(P.endX-P.startX);D=M/Math.sqrt(1+V*V),T=D*V}const B=u.et();let E=new C;O.On(P.startX+T,P.startY+D,P.endX+T,P.endY+D,p,y,x,b,E)&&B.push(E),E=new C,O.On(P.startX-T,P.startY-D,P.endX-T,P.endY-D,p,y,x,b,E)&&B.push(E),E=new C,O.On(P.startX+T,P.startY+D,P.startX-T,P.startY-D,p,y,x,b,E)&&B.push(E),E=new C,O.On(P.endX+T,P.endY+D,P.endX-T,P.endY-D,p,y,x,b,E)&&B.push(E);const R=B.length;if(R===0)return u.J(B),!1;L=!0;let F=1/0;for(let V=0;V<R;V++){const K=B[V],H=(K.x-p)**2+(K.y-y)**2;H<F&&(F=H,o.x=K.x,o.y=K.y)}u.J(B)}else if(P.type===2)L=O.gl(k.x-M,k.y-M,k.x+k.width+M,k.y+k.height+M,p,y,x,b,o);else if(P.type===3){const T=G.V(k.x,k.y,k.width,k.height).inflate(M,M);L=this.Xv(T,p,y,x,b,o),G.e(T)}else if(P.type===4){let T=0,D=0,B=0,E=0;const R=C.l();let F=x-p,V=b-y,K=F*F+V*V,H=p,W=y;if(K>0&&k.contains(H,W)&&(R.x=H,R.y=W,this.containsPoint(R)))for(F!==0&&Math.abs(F)<.5?(V*=.5/F,F=.5):V!==0&&Math.abs(V)<.5&&(F*=.5/V,V=.5),H-=F,W-=V;k.contains(H,W);)H-=F,W-=V;const J=.6;o.x=x,o.y=b;for(let Ct=0;Ct<P.figures.count;Ct++){const ht=P.figures.r[Ct],dt=ht.isFilled?H:p,ct=ht.isFilled?W:y,ft=ht.segments;T=ht.startX,D=ht.startY;let Ot=T,Et=D;for(let lt=0;lt<ft.count;lt++){const vt=ft.r[lt],Qt=vt.type;B=vt.endX,E=vt.endY;let It=!1;switch(Qt){case 1:Ot=B,Et=E;break;case 2:It=this.s1(T,D,B,E,dt,ct,x,b,R);break;case 3:{It=O.Ig(T,D,vt.point1X,vt.point1Y,vt.point2X,vt.point2Y,B,E,dt,ct,x,b,J,R);break}case 4:{It=O.Ig(T,D,T+2/3*(vt.point1X-T),D+2/3*(vt.point1Y-D),B+2/3*(vt.point1X-B),E+2/3*(vt.point1Y-E),B,E,dt,ct,x,b,J,R);break}case 5:case 6:{const ut=vt.type===5?vt.bo(ht):vt.Bh(ht,T,D),nt=ut.length;if(nt===0){It=this.s1(T,D,vt.type===5?vt.centerX:vt.endX,vt.type===5?vt.centerY:vt.endY,dt,ct,x,b,R);break}let kt=null;for(let jt=0;jt<nt;jt++){if(kt=ut[jt],jt===0&&this.s1(T,D,kt[0],kt[1],dt,ct,x,b,R)){const oe=this.o1(dt,ct,R,K,o);oe<K&&(K=oe,L=!0)}if(O.Ig(kt[0],kt[1],kt[2],kt[3],kt[4],kt[5],kt[6],kt[7],dt,ct,x,b,J,R)){const oe=this.o1(dt,ct,R,K,o);oe<K&&(K=oe,L=!0)}}B=kt[6],E=kt[7];break}default:u.o("Unknown Segment type: "+Qt)}if(T=B,D=E,It){const ut=this.o1(dt,ct,R,K,o);ut<K&&(K=ut,L=!0)}if(vt.isClosed&&(B=Ot,E=Et,this.s1(T,D,B,E,dt,ct,x,b,R))){const ut=this.o1(dt,ct,R,K,o);ut<K&&(K=ut,L=!0)}}}let $=s-t,et=n-i;const ot=Math.sqrt($*$+et*et);ot!==0&&($/=ot,et/=ot),o.x-=$*M,o.y-=et*M,C.e(R)}else u.o("Unknown Geometry type: "+P.type);return L?(this.T.gt(o),!0):!1}o1(t,i,s,n,o){const r=s.x-t,a=s.y-i,h=r*r+a*a;return h<n?(o.x=s.x,o.y=s.y,h):n}s1(t,i,s,n,o,r,a,h,l){if(O.z(t,s)&&O.z(i,n)||O.z(o,a)&&O.z(r,h))return!1;let c=!1;const d=(o-a)*(i-n)-(r-h)*(t-s);if(d===0)return!1;if(l.x=((o*h-r*a)*(t-s)-(o-a)*(t*n-i*s))/d,l.y=((o*h-r*a)*(i-n)-(r-h)*(t*n-i*s))/d,(t>s?t-s:s-t)<(i>n?i-n:n-i)){const f=i<n?i:n,m=i<n?n:i;(l.y>f||O.z(l.y,f))&&(l.y<m||O.z(l.y,m))&&(c=!0)}else{const f=t<s?t:s,m=t<s?s:t;(l.x>f||O.z(l.x,f))&&(l.x<m||O.z(l.x,m))&&(c=!0)}return c}Yv(t,i,s){return this.pickable===!1?!1:(s.nc(this.T),i?this.Gv(t,s):this.containedInRect(t,s))}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);let s=this.ot;s===null&&(this.ht(1/0,1/0),s=this.ot);const n=s.bounds,o=this.strokeWidth/2;let r=!1;const a=C.l();return a.i(n.x-o,n.y-o),t.containsPoint(i.gt(a))&&(a.i(n.x-o,n.bottom+o),t.containsPoint(i.gt(a))&&(a.i(n.right+o,n.bottom+o),t.containsPoint(i.gt(a))&&(a.i(n.right+o,n.y-o),t.containsPoint(i.gt(a))&&(r=!0)))),C.e(a),r}intersectsRect(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.T,t.containsRect(this.actualBounds)))return!0;const s=Pt.l();s.set(i),s.bw();const n=t.left,o=t.right,r=t.top,a=t.bottom,h=C.l();if(h.i(n,r),s.gt(h),this.fh(h,!0)||(h.i(o,r),s.gt(h),this.fh(h,!0))||(h.i(n,a),s.gt(h),this.fh(h,!0))||(h.i(o,a),s.gt(h),this.fh(h,!0)))return C.e(h),!0;const l=C.l(),c=C.l();s.set(i),s.NC(this.T),s.bw(),l.x=o,l.y=r,l.T(s),h.x=n,h.y=r,h.T(s);let d=!1;return this.Fa(h,l,c)?d=!0:(h.x=o,h.y=a,h.T(s),this.Fa(h,l,c)?d=!0:(l.x=n,l.y=a,l.T(s),this.Fa(h,l,c)?d=!0:(h.x=n,h.y=r,h.T(s),this.Fa(h,l,c)&&(d=!0)))),C.e(h),Pt.e(s),C.e(l),C.e(c),d}Fa(t,i,s){if(!this.getNearestIntersectionPoint(t,i,s))return!1;const n=t.x,o=t.y,r=i.x,a=i.y,h=s.x,l=s.y;if(n===r){let c=0,d=0;return o<a?(c=o,d=a):(c=a,d=o),l>=c&&l<=d}else{let c=0,d=0;return n<r?(c=n,d=r):(c=r,d=n),h>=c&&h<=d}}Gv(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.T,t.containsRect(this.actualBounds)))return!0;const s=t.left,n=t.right,o=t.top,r=t.bottom,a=C.l(),h=C.l(),l=C.l(),c=Pt.l();c.set(i),c.NC(this.T),c.bw(),h.x=n,h.y=o,h.T(c),a.x=s,a.y=o,a.T(c);let d=!1;return this.Fa(a,h,l)?d=!0:(a.x=n,a.y=r,a.T(c),this.Fa(a,h,l)?d=!0:(h.x=s,h.y=r,h.T(c),this.Fa(a,h,l)?d=!0:(a.x=s,a.y=o,a.T(c),this.Fa(a,h,l)&&(d=!0)))),Pt.e(c),C.e(a),C.e(h),C.e(l),d}xA(t,i,s){if(s&&this.fill!==null&&this.fh(t,!0))return!0;let n=t.distanceSquaredPoint(i);const o=n;this.strokeWidth>1.5&&(n=this.strokeWidth/2+Math.sqrt(n),n*=n);let r=this.ot;if(r===null&&(this.ht(1/0,1/0),r=this.ot,r===null))return!1;if(!s){const f=r.bounds,m=f.x,p=f.y,y=f.x+f.width,x=f.y+f.height;if(C.distanceSquared(t.x,t.y,m,p)<=n&&C.distanceSquared(t.x,t.y,y,p)<=n&&C.distanceSquared(t.x,t.y,m,x)<=n&&C.distanceSquared(t.x,t.y,y,x)<=n)return!0}function a(f,m){const p=f.length;for(let y=0;y<p;y+=2)if(m.distanceSquared(f[y],f[y+1])>n)return!0;return!1}const h=r.startX,l=r.startY,c=r.endX,d=r.endY;if(r.type===1){const f=C.distanceLineSegmentSquared(t.x,t.y,h,l,c,d),m=(c-h)*(t.x-h)+(d-l)*(t.y-l),p=(h-c)*(t.x-c)+(l-d)*(t.y-d),y=m>=0&&p>=0?n:o;return f<=y}else if(r.type===2){let f=!1;return s&&(f=C.distanceLineSegmentSquared(t.x,t.y,h,l,h,d)<=n||C.distanceLineSegmentSquared(t.x,t.y,h,l,c,l)<=n||C.distanceLineSegmentSquared(t.x,t.y,c,l,c,d)<=n||C.distanceLineSegmentSquared(t.x,t.y,h,d,c,d)<=n),f}else if(r.type===3){const f=(h+c)/2,m=(l+d)/2,p=t.x-f,y=t.y-m,x=Math.abs(c-h)/2,b=Math.abs(d-l)/2;if(x===0||b===0)return C.distanceLineSegmentSquared(t.x,t.y,h,l,c,d)<=n;if(s){const M=O.iF(x,b,p,y);return M*M<=n}else return!(C.distanceSquared(p,y,-x,0)>=n||C.distanceSquared(p,y,0,-b)>=n||C.distanceSquared(p,y,0,b)>=n||C.distanceSquared(p,y,x,0)>=n)}else if(r.type===4){const f=r.bounds,m=f.x,p=f.y,y=f.x+f.width,x=f.y+f.height;if(t.x>y&&t.x<m&&t.y>x&&t.y<p&&C.distanceLineSegmentSquared(t.x,t.y,m,p,m,x)>n&&C.distanceLineSegmentSquared(t.x,t.y,m,p,y,p)>n&&C.distanceLineSegmentSquared(t.x,t.y,y,x,m,x)>n&&C.distanceLineSegmentSquared(t.x,t.y,y,x,y,p)>n)return!1;const b=Math.sqrt(n);if(s){if(this.fill===null?r.EC(t.x,t.y,b):r.qk(t,b,!0,!1))return!0}else{const M=r.figures;for(let P=0;P<M.count;P++){const k=M.r[P];let L=k.startX,T=k.startY;if(t.distanceSquared(L,T)>n)return!1;const D=k.segments.r,B=D.length;for(let E=0;E<B;E++){const R=D[E];switch(R.type){case 1:case 2:if(L=R.endX,T=R.endY,t.distanceSquared(L,T)>n)return!1;break;case 3:{const F=u.et();O.vn(L,T,R.point1X,R.point1Y,R.point2X,R.point2Y,R.endX,R.endY,.8,F);const V=a(F,t);if(u.J(F),V||(L=R.endX,T=R.endY,t.distanceSquared(L,T)>n))return!1;break}case 4:{const F=u.et();O.Og(L,T,R.point1X,R.point1Y,R.endX,R.endY,.8,F);const V=a(F,t);if(u.J(F),V||(L=R.endX,T=R.endY,t.distanceSquared(L,T)>n))return!1;break}case 5:case 6:{const F=R.type===5?R.bo(k):R.Bh(k,L,T),V=F.length;if(V===0){if(L=R.type===5?R.centerX:R.endX,T=R.type===5?R.centerY:R.endY,t.distanceSquared(L,T)>n)return!1;break}let K=null;const H=u.et();for(let W=0;W<V;W++)if(K=F[W],H.length=0,O.vn(K[0],K[1],K[2],K[3],K[4],K[5],K[6],K[7],.8,H),a(H,t))return u.J(H),!1;u.J(H),K!==null&&(L=K[6],T=K[7]);break}default:u.o("Unknown Segment type: "+R.type)}}}return!0}}return!1}Xv(t,i,s,n,o,r){if(t.width===0)return O.On(t.x,t.y,t.x,t.y+t.height,i,s,n,o,r);if(t.height===0)return O.On(t.x,t.y,t.x+t.width,t.y,i,s,n,o,r);{const a=t.width/2,h=t.height/2,l=t.x+a,c=t.y+h;let d=9999;if(i!==n&&(d=(s-o)/(i-n)),Math.abs(d)<9999){const f=s-c-d*(i-l);if(a*a*(d*d)+h*h-f*f<0)return r.x=NaN,r.y=NaN,!1;const m=Math.sqrt(a*a*(d*d)+h*h-f*f),p=(-(a*a*d*f)+a*h*m)/(h*h+a*a*(d*d))+l,y=(-(a*a*d*f)-a*h*m)/(h*h+a*a*(d*d))+l,x=d*(p-l)+f+c,b=d*(y-l)+f+c,M=Math.abs((i-p)**2)+Math.abs((s-x)**2),P=Math.abs((i-y)**2)+Math.abs((s-b)**2);M<P?(r.x=p,r.y=x):(r.x=y,r.y=b)}else{const f=h*h,m=a*a,p=i-l,y=f-f/m*(p*p);if(y<0)return r.x=NaN,r.y=NaN,!1;const x=Math.sqrt(y),b=c+x,M=c-x,P=Math.abs(b-s),k=Math.abs(M-s);P<k?(r.x=i,r.y=b):(r.x=i,r.y=M)}return!0}}Rv(){return this.Vo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ot!==null?this.ot:this.ks}set geometry(t){const i=this.ot,s=this.ks;if(i===t)return;t!==null?(this.ot=t.u(),this.ks=this.ot):(this.ot=null,this.ks=null);const n=this.part;if(n!==null&&n.cf(),this.c(),this.t("geometry",i||s,t),this.Wc()){const o=this.part;o!==null&&this.ba(o,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const i=Tt.parse(t),s=i.normalize();this.geometry=i;const n=C.V(-s.x,-s.y);this.position=n,C.e(n)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",i,t))}ee(){this.ot=null}get fill(){return this.Ta}set fill(t){const i=this.Ta;i!==t&&(t!==null&&Jt.Qu(t,"Shape.fill"),t instanceof Jt&&t.u(),this.Ta=t,this.S(),this.t("fill",i,t))}get stroke(){return this.ji}set stroke(t){const i=this.ji;i!==t&&(t!==null&&Jt.Qu(t,"Shape.stroke"),t instanceof Jt&&t.u(),this.ji=t,this.S(),this.t("stroke",i,t))}get strokeWidth(){return this.Vo}set strokeWidth(t){const i=this.Vo;if(i!==t)if(t>=0){this.Vo=t,this.c();const s=this.part;s!==null&&s.cf(),this.t("strokeWidth",i,t)}else u.W(t,"value >= 0",Zt,"strokeWidth:value")}y0(){return this.Vo}get strokeCap(){return this.jt!==null?this.jt.gp:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.Da().gp=t,this.S(),this.t("strokeCap",i,t)):u.W(t,'"butt", "round", or "square"',Zt,"strokeCap"))}get strokeJoin(){return this.jt!==null?this.jt.mp:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.Da().mp=t,this.S(),this.t("strokeJoin",i,t)):u.W(t,'"miter", "bevel", or "round"',Zt,"strokeJoin"))}get strokeMiterLimit(){return this.jt!==null?this.jt.pp:10}set strokeMiterLimit(t){const i=this.strokeMiterLimit;if(i!==t&&t>=1){this.Da().pp=t,this.S();const s=this.part;s!==null&&s.cf(),this.t("strokeMiterLimit",i,t)}}get strokeDashArray(){return this.Io}set strokeDashArray(t){const i=this.Io;if(i!==t){if(t!==null&&!Array.isArray(t)&&u.Zi(t,"Array",Zt,"strokeDashArray:value"),t!==null){const s=t.length;let n=0;for(let o=0;o<s;o++){const r=t[o];(!(r>=0)||!isFinite(r))&&u.o("strokeDashArray:value "+r+" at index "+o+" must be a positive number or zero."),n+=r}if(n===0){if(i===null)return;t=null}}this.Io=t,this.S(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return this.jt!==null?this.jt.ph:0}set strokeDashOffset(t){const i=this.strokeDashOffset;i!==t&&t>=0&&(this.Da().ph=t,this.S(),this.t("strokeDashOffset",i,t))}get figure(){return this.gd}set figure(t){const i=this.gd;if(i!==t){let s=O.In[t];if(u.it(s)?s=t:(s=O.In[t.toLowerCase()],s||u.o("Unknown Shape.figure: "+t)),i!==s){const n=this.part;n!==null&&n.cf(),this.gd=s,this.ks=null,this.ee(),this.c(),this.t("figure",i,s)}}}get toArrow(){return this.Ot!==null?this.Ot.yp:"None"}set toArrow(t){const i=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Zt.qA(t);s===null?u.o("Unknown Shape.toArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new Ji),this.Ot.yp=s,this.ks=null,this.ee(),this.c(),this.WA(s),this.t("toArrow",i,s))}}get fromArrow(){return this.Ot!==null?this.Ot.wp:"None"}set fromArrow(t){const i=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const s=Zt.qA(t);s===null?u.o("Unknown Shape.fromArrow: "+t):i!==s&&(this.Ot===null&&(this.Ot=new Ji),this.Ot.wp=s,this.ks=null,this.ee(),this.c(),this.WA(s),this.t("fromArrow",i,s))}}WA(t){const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.iv();const s=U.MiddleRight;this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=s):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=new U(1-s.x,s.y))}get spot1(){return this.jt!==null?this.jt.En:U.Default}set spot1(t){const i=this.spot1;i.equals(t)||(t=t.P(),this.Da().En=t,this.c(),this.t("spot1",i,t))}get spot2(){return this.jt!==null?this.jt.Un:U.Default}set spot2(t){const i=this.spot2;i.equals(t)||(t=t.P(),this.Da().Un=t,this.c(),this.t("spot2",i,t))}get parameter1(){return this.md}set parameter1(t){const i=this.md;i!==t&&(this.md=t,this.ee(),this.c(),this.t("parameter1",i,t))}get parameter2(){return this.pd}set parameter2(t){const i=this.pd;i!==t&&(this.pd=t,this.ee(),this.c(),this.t("parameter2",i,t))}get naturalBounds(){return this.zi}kv(){const t=this.desiredSize;if(!t.isReal()&&this.ot!==null){const i=this.ot.bounds;this.zi.a(i)}else this.zi.i(0,0,t.width,t.height)}get pathPattern(){return this.jt!==null?this.jt.xp:null}set pathPattern(t){const i=this.pathPattern;i!==t&&(this.Da().xp=t,this.S(),this.t("pathPattern",i,t))}get geometryStretch(){return this.jt!==null?this.jt.bp:1}set geometryStretch(t){const i=this.geometryStretch;i!==t&&(this.Da().bp=t,this.c(),this.t("geometryStretch",i,t))}get interval(){return this.K!==null?this.K.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new wi),this.K.uf=t;const s=this.diagram;s!==null&&this.panel===s.grid&&s.th(),this.c();const n=this.panel;n!==null&&(n.ss=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new wi),this.K.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new wi),this.K.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedSkip(){return this.K!==null?this.K.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&u.k(t,Zt,"graduatedSkip"),this.K===null&&(this.K=new wi),this.K.mf=t,this.c(),this.t("graduatedSkip",i,t))}static zv(t,i,s){let n=null;if(t.toArrow!=="None")n=Zt.gn[t.toArrow];else if(t.fromArrow!=="None")n=Zt.gn[t.fromArrow];else{let o=O.In[t.figure];typeof o=="string"&&(o=O.In[o]),o===void 0&&u.o("Unknown Shape.figure: "+t.figure),n=o(t,i,s),n.rc=i,n.lc=s}if(n===null){const o=O.In.Rectangle;u.it(o)&&(n=o(t,i,s))}return n}static getFigureGenerators(){const t=new Z;for(const i in O.In){if(i===i.toLowerCase())continue;const s=O.In[i];t.set(i,s)}return t.u(),t}static defineFigureGenerator(t,i){u.s(t,"string",Zt,"defineFigureGenerator:name"),typeof i=="string"||u.k(i,Zt,"defineFigureGenerator:func");const s=t.toLowerCase(),n=O.In;n[t]=i,n[s]=t}static isFigureDefined(t){return O.In.has(t)}static getArrowheadGeometries(){const t=new Z;for(const i in O.Bg)if(Zt.gn[i]===void 0){const s=Tt.parse(O.Bg[i],!1);Zt.gn[i]=s;const n=i.toLowerCase();n!==i&&(Zt.gn[n]=i)}for(const i in Zt.gn){if(i===i.toLowerCase())continue;const s=Zt.gn[i];s instanceof Tt&&t.set(i,s)}return t.u(),t}static defineArrowheadGeometry(t,i){u.s(t,"string",Zt,"defineArrowheadGeometry:name");let s=null;typeof i=="string"?(u.s(i,"string",Zt,"defineArrowheadGeometry:pathstr"),s=Tt.parse(i,!1)):s=i;const n=t.toLowerCase();(n==="none"||t===n)&&u.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const o=Zt.gn;o[t]=s,o[n]=t}static isArrowheadDefined(t){return Zt.gn.has(t)}static qA(t){let i=Zt.gn[t];if(i===void 0){const s=t.toLowerCase();if(s==="none")return"None";if(i=Zt.gn[s],i===void 0){let n=null;for(const o in O.Bg)if(o.toLowerCase()===s){n=o;break}if(n!==null){const o=Tt.parse(O.Bg[n],!1);return Zt.gn[n]=o,s!==n&&(Zt.gn[s]=n),n}}}return typeof i=="string"?i:i instanceof Tt?t:null}};g(Zt,"gn",new N),g(Zt,"q2",new N);let At=Zt;class Do{constructor(){g(this,"fi");g(this,"gp");g(this,"mp");g(this,"pp");g(this,"ph");g(this,"xp");g(this,"bp");g(this,"En");g(this,"Un");this.fi=!1,this.gp="butt",this.mp="miter",this.pp=10,this.ph=0,this.xp=null,this.bp=1,this.En=U.Default,this.Un=U.Default}copy(){const e=new Do;return e.gp=this.gp,e.mp=this.mp,e.pp=this.pp,e.ph=this.ph,e.xp=this.xp,e.bp=this.bp,e.En=this.En.P(),e.Un=this.Un.P(),e}}var Eo=(S=>(S[S.None=0]="None",S[S.Fit=1]="Fit",S[S.DesiredSize=2]="DesiredSize",S[S.BreakAll=3]="BreakAll",S))(Eo||{}),da=(S=>(S[S.Clip=0]="Clip",S[S.Ellipsis=1]="Ellipsis",S))(da||{}),Oo=(S=>(S[S.Trim=0]="Trim",S[S.None=1]="None",S))(Oo||{});const Dt=class Dt extends Xt{constructor(t,i){super();g(this,"ri");g(this,"ji");g(this,"mn");g(this,"ge");g(this,"ui");g(this,"w0");g(this,"wd");g(this,"K");g(this,"rt");g(this,"Dl");g(this,"io");g(this,"pn");g(this,"Ce");g(this,"Ti");g(this,"yn");return Dt.W0===!1&&(Dt.W0=!0,Dt._n=zt.isUsingDOM()?new $i(null).li:null),this.n|=2097152,this.ri="",this.ji="black",this.mn="13px sans-serif",this.ge=0,this.ui=0,this.w0=0,this.wd=null,this.K=null,this.rt=null,this.Dl=0,this.io=null,this.pn=0,this.Ce=null,this.Ti=null,this.yn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),i&&Object.assign(this,i),this}cloneProtected(t){super.cloneProtected(t),t.ri=this.ri,t.ji=this.ji,t.mn=this.mn,t.ge=this.ge,t.ui=this.ui,t.w0=this.w0,t.wd=this.wd,this.K!==null&&(t.K=this.K.copy()),this.rt!==null&&(this.rt.fi?t.rt=this.rt:t.rt=this.rt.copy()),t.Dl=this.Dl,t.io=this.io,t.pn=this.pn,t.Ce=this.Ce,t.Ti=this.Ti,t.yn=this.yn}wn(){return this.rt===null?this.rt=new Ro:this.rt.fi&&(this.rt=this.rt.copy()),this.rt}ch(){super.ch(),this.rt!==null&&(this.rt.fi=!0)}Av(t){this.n=t.n|2048|4096,this.$t=t.opacity,this.Lt=t.background,this.is=t.desiredSize.P(),this.minSize=t.minSize.P(),this.maxSize=t.maxSize.P(),t.wi!==null?this.wi=t.wi.copy():this.wi=null,this.tt=t.scale,this.Yt=t.angle,this.stretch=t.stretch,this.Wr=t.margin.P(),this.hi=t.alignment.P(),this.ju=t.alignmentFocus.P(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.P(),this.segmentOrientation=t.segmentOrientation,t.si!==null&&(this.si=t.si.copy()),this.shadowVisible=t.shadowVisible,this.ri=t.ri,this.ji=t.ji,this.mn=t.mn,this.K!==null&&(this.K=t.K.copy()),t.rt!==null&&(t.rt.fi?this.rt=t.rt:this.rt=t.rt.copy()),this.Dl=t.Dl}Cv(t){if(this.ri=t.text||"",this.Yt=t.labelAngle||0,this.ge=t.lineCount||0,this.Kv(t.lines),t.naturalBounds&&(this.zi=t.naturalBounds),t.actualBounds){const i=t.actualBounds;this.Bt(i.x,i.y,i.width,i.height)}}oi(t){t in Eo?this.wrap=t:super.oi(t)}toString(){return this.ri.length>22?'TextBlock("'+this.ri.substring(0,20)+'"...)':'TextBlock("'+this.ri+'")'}static getEllipsis(){return Dt.kp}static setEllipsis(t){Dt.kp=t,Dt.l1=new N,Dt.W2=0}static getBaseline(){return Dt.h1}static setBaseline(t){Dt.h1=t}static getUnderline(){return Dt.a1}static setUnderline(t){Dt.a1=t}c(){super.c(),this.Ve(!0)}get font(){return this.mn}set font(t){const i=this.mn;i!==t&&(this.mn=t,this.io=null,this.c(),this.t("font",i,t))}static isValidFont(t){return w.CSS?w.CSS.supports("font",t):!0}get text(){return this.ri}set text(t){const i=this.ri;t!=null?t=t.toString():t="",i!==t&&(this.ri=t,this.c(),this.t("text",i,t))}get textAlign(){return this.rt!==null?this.rt.Pp:"start"}set textAlign(t){const i=this.textAlign;i!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.wn().Pp=t,this.S(),this.t("textAlign",i,t))}get flip(){return this.rt!==null?this.rt.eo:0}set flip(t){const i=this.flip;i!==t&&(this.wn().eo=t,this.S(),this.t("flip",i,t))}get verticalAlignment(){return this.rt!==null?this.rt.tl:U.Top}set verticalAlignment(t){const i=this.verticalAlignment;i.equals(t)||(t=t.P(),this.wn().tl=t,this.ef(),this.t("verticalAlignment",i,t))}get naturalBounds(){if(!this.zi.isReal()){const t=rt.l();this.J2(this.ri,999999,t);let i=t.width;rt.e(t);let s=this.JA(i);const n=this.desiredSize;isNaN(n.width)||(i=n.width),isNaN(n.height)||(s=n.height),this.zi.Fn(i,s)}return this.zi}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const i=(this.n&2097152)!==0;i!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",i,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const i=(this.n&4194304)!==0;i!==t&&(this.n=this.n^4194304,this.Ve(!0),this.S(),this.t("isUnderline",i,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const i=(this.n&8388608)!==0;i!==t&&(this.n=this.n^8388608,this.Ve(!0),this.S(),this.t("isStrikethrough",i,t))}get wrap(){return this.rt!==null?this.rt.Sp:2}set wrap(t){const i=this.wrap;i!==t&&(this.wn().Sp=t,this.c(),this.t("wrap",i,t))}get overflow(){return this.rt!==null?this.rt.Mp:0}set overflow(t){const i=this.overflow;i!==t&&(this.wn().Mp=t,this.c(),this.t("overflow",i,t))}get isOverflowed(){return(this.n&16777216)!==0}$2(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.ji}set stroke(t){const i=this.ji;i!==t&&(t!==null&&Jt.Qu(t,"TextBlock.stroke"),t instanceof Jt&&t.u(),this.ji=t,typeof t!="string"&&this.Qc(),this.S(),this.t("stroke",i,t))}get lineCount(){return this.ge}get lineHeight(){return this.Np()}get editable(){return(this.n&1048576)!==0}set editable(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.t("editable",i,t))}get V2(){return(this.n&33554432)!==0}set V2(t){this.n=this.n^33554432}get textEditor(){return this.rt!==null?this.rt.Cp:null}set textEditor(t){const i=this.textEditor;i!==t&&(this.wn().Cp=t,this.t("textEditor",i,t))}get errorFunction(){return this.rt!==null?this.rt.ns:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(t!==null&&u.k(t,Dt,"errorFunction"),this.wn().ns=t,this.t("errorFunction",i,t))}get interval(){return this.K!==null?this.K.uf:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new wi),this.K.uf=t,this.c();const s=this.panel;s!==null&&(s.ss=null),this.t("interval",i,t)}}get graduatedStart(){return this.K!==null?this.K.df:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new wi),this.K.df=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.K!==null?this.K.gf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new wi),this.K.gf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedFunction(){return this.K!==null?this.K.Lp:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(t!==null&&u.k(t,Dt,"graduatedFunction"),this.K===null&&(this.K=new wi),this.K.Lp=t,this.c(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return this.K!==null?this.K.mf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&u.k(t,Dt,"graduatedSkip"),this.K===null&&(this.K=new wi),this.K.mf=t,this.c(),this.t("graduatedSkip",i,t))}gh(t,i){if(this.ji===null||this.ri.length===0||this.mn===null)return;const s=this.naturalBounds,n=this.actualBounds,o=s.width,r=s.height,a=this.Np();let h=t.textAlign=this.textAlign;const l=i.zu;h==="start"?h=l?"right":"left":h==="end"&&(h=l?"left":"right");const c=this.isUnderline,d=this.isStrikethrough;this.rn(t,this.ji,!0,!1,s,n),(c||d)&&this.rn(t,this.ji,!1,!1,s,n);const f=0;let m=0;const p=o;let y=!1;i.Qt===t&&!(i.Qt instanceof Ge)&&!this.V2&&i.getRenderingHint("textGreeking")===!0&&a*this.da*i.scale<3&&(y=!0);const x=this.spacingAbove,b=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(o,0),t.scale(-1,1);break;case 1:t.translate(0,r),t.scale(1,-1);break;case 3:t.translate(o,r),t.scale(-1,-1);break}t.commitTransform();const M=this.ge,P=(x+a+b)*M;if(r>P){const k=this.verticalAlignment;m=k.y*r-k.y*P+k.offsetY}if(M===1&&this.yn!==null){let k=this.ui;k>p&&(k=p),m+=x,this.$A(this.yn,t,f,m,p,a,k,y,h,c,d)}else if(this.Ce!==null&&this.Ti!==null)for(let k=0;k<M;k++){let L=this.Ce[k];L>p&&(L=p),m+=x,this.$A(this.Ti[k],t,f,m,p,a,L,y,h,c,d),m+=a+b}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-o,0);break;case 1:t.scale(1,-1),t.translate(0,-r);break;case 3:t.scale(-1,-1),t.translate(-o,-r);break}}$A(t,i,s,n,o,r,a,h,l,c,d){let f=0;if(h){l==="left"?f=0:l==="right"?f=o-a:l==="center"&&(f=(o-a)/2);const y=i.globalAlpha;i.globalAlpha=y/2,i.fillRect(s+f,n+r/4,a,r/2),i.globalAlpha=y;return}l==="left"?f=0:l==="right"?f=o:l==="center"&&(f=o/2);const m=Dt.h1!==null?Dt.h1(this,r):r*.75;i.fillText(t,s+f,n+m);let p=r/20|0;if(p===0&&(p=1),l==="right"?f-=a:l==="center"&&(f-=a/2),c){const y=Dt.a1!==null?Dt.a1(this,r):r*.8;this.ZA(s+f,n+y,s+f+a,n+y,p,i),i instanceof Ge&&i.lastCreatedElement.classList.add("gojs-td")}if(d){let y=n+r-r/2.2|0;p%2!==0&&(y+=.5),this.ZA(s+f,y,s+f+a,y,p,i),i instanceof Ge&&i.lastCreatedElement.classList.add("gojs-td")}}ZA(t,i,s,n,o,r){r.beginPath(),r.lineWidth=o,r.moveTo(t,i),r.lineTo(s,n),r.stroke(),r.endPath()}Zc(t,i,s){if(!super.Zc(t,i,s))return!1;if(this.rn(t,this.ji,!0,!1,this.naturalBounds,this.actualBounds),s){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.jv(this.svg,this.text,t);return!0}jv(t,i,s){t.innerHTML=i,s.setFillOrStrokeInPlace(t,!0)}$u(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.$u(t)}k2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const s=t.getElementsByTagName("text");for(let n=0;n<s.length;n++)s[n].setAttributeNS(null,"filter",i)}}Hv(){this.pn=0,this.ui=0,this.io=null,this.Ce=null,this.Ti=null,this.yn=null}Wu(t,i,s,n){const o=this.ge;this.Dl=t,this.$2(!1);const r=this.mn;Dt._n!==null&&Dt.QA!==r&&(Dt._n.font=r,Dt.QA=r),this.Hv();let a=0,h=0;isNaN(this.desiredSize.width)?(a=this.qv(),a=Math.min(a,t/this.scale)):a=this.desiredSize.width,this.panel!==null&&(a=Math.min(a,this.panel.maxSize.width)),h=this.JA(a),isNaN(this.desiredSize.height)?h=Math.min(h,i/this.scale):h=this.desiredSize.height,this.Wv(t,h),(this.wrap===1||isNaN(this.desiredSize.width))&&(a=isNaN(t)?this.ui:Math.min(t,this.ui)),a=Math.max(s,a),h=Math.max(n,h),this.zi.Fn(a,h),this.Wn(0,0,a,h),this.svg!==null&&o!==this.ge&&this.Ve(!0)}uh(t,i,s,n){this.commonArrange(t,i,s,n)}xn(t,i){this.yn===null?(this.yn=t,this.ui=i):((this.Ti===null||this.Ce===null)&&(this.Ti=[],this.Ce=[],this.Ti.push(this.yn),this.Ce.push(this.ui)),this.Ti.push(t),this.Ce.push(i),this.Ti.length>this.maxLines&&(this.n|=16777216))}J2(t,i,s){const n=this.formatting===0;n&&(t=t.trim());let o=0,r=0,a=0;const h=this.mn,l=this.spacingAbove+this.spacingBelow,c=Math.max(0,this.Np()+l),d=this.overflow===1?this._A(h):0;if(this.ge>=this.maxLines){s!==null&&s.i(0,c);return}let f=t;if(this.wrap===0){if(this.pn=1,r=this.getStringWidth(t),d===0||r<=i){this.ui=Math.max(this.ui,r),this.xn(t,this.ui),s!==null&&s.i(r,c);return}let p=this.xd(f);f=f.substring(p.length);let y=this.xd(f);for(r=this.getStringWidth(p+y),a=0;y.length>0&&r<=i;){p+=y,f=f.substring(y.length),y=this.xd(f),a=r;let x=p+y;n&&(x=x.trim()),r=this.getStringWidth(x)}for(n&&(y=y.trim()),p+=y,i=Math.max(1,i-d);this.getStringWidth(p)>i&&p.length>1;)p=p.substring(0,p.length-1);this.$2(!0),p+=Dt.kp,a=this.getStringWidth(p),this.ui=a,this.xn(p,a),s!==null&&s.i(a,c);return}let m=0;for(f.length===0&&(m=1,this.xn(f,0));f.length>0;){let p=this.xd(f);for(f=f.substring(p.length);this.getStringWidth(p)>i;){let b=1;for(r=this.getStringWidth(p.substring(0,b)),a=0;r<=i;)b++,a=r,r=this.getStringWidth(p.substring(0,b));let M=0;b===1?(M=r,o=Math.max(o,r)):(M=a,o=Math.max(o,a)),b--,b<1&&(b=1);const P=p.substring(0,b);if(this.xn(P,M),m++,p=p.substring(b),this.ge+m>this.maxLines)break}let y=this.xd(f);for(r=this.getStringWidth(p+y),a=0;y.length>0&&r<=i;){p+=y,f=f.substring(y.length),y=this.xd(f),a=r;let b=p+y;n&&(b=b.trim()),r=this.getStringWidth(b)}if(n&&(p=p.trim()),p==="")continue;p[p.length-1]===""&&(p=p.substring(0,p.length-1)+"");let x=0;if(y.length===0?(x=r,o=Math.max(o,r)):(a=this.getStringWidth(p),x=a,o=Math.max(o,a)),this.xn(p,x),m++,this.ge+m>this.maxLines)break}this.pn=Math.min(this.maxLines-this.ge,m),this.ui=Math.max(this.ui,o),s!==null&&s.i(this.ui,c*this.pn)}Wv(t,i){if(this.ui===0||this.Ce===null||this.Ti===null||this.overflow!==1)return;const s=this.mn,n=this.overflow===1?this._A(s):0,o=this.spacingAbove+this.spacingBelow,r=Math.max(0,this.Np()+o),a=Math.min(this.maxLines-1,Math.max(Math.floor(i/r+.01)-1,0));if(a+1>=this.Ti.length)return;this.$2(!0);let h=this.Ti[a];const l=Math.max(1,t-n);for(;this.getStringWidth(h)>l&&h.length>1;)h=h.substring(0,h.length-1);h+=Dt.kp;const c=this.getStringWidth(h);this.Ti[a]=h,this.Ti=this.Ti.slice(0,a+1),this.Ce[a]=c,this.Ce=this.Ce.slice(0,a+1),this.pn=this.Ti.length,this.ui=Math.max(this.ui,c),this.ge=this.pn,this.ge===1&&(this.yn=this.Ti[0])}xd(t){if(this.wrap===3)return t.substring(0,1);let i=t.length,s=0;const n=Dt.Jv;for(;s<i&&!n.test(t.charAt(s));)s++;for(this.formatting===1&&(i=Math.min(i,s+1));s<i&&n.test(t.charAt(s));)s++;return s>=t.length?t:t.substring(0,s)}getStringWidth(t){return Dt._n===null?t.length*8:Dt._n.measureText(t).width}Np(){if(this.io!==null)return this.io;const t=this.mn;let i=0;return Dt._n===null?(i=16,this.io=i,i):(Dt.Z2[t]!==void 0&&Dt.tT<5e3?i=Dt.Z2[t]:(i=Dt._n.measureText("M").width*1.3,Dt.Z2[t]=i,Dt.tT++),this.io=i,i)}_A(t){if(Dt._n===null)return 6;let i=0;return Dt.l1[t]!==void 0&&Dt.W2<5e3?i=Dt.l1[t]:(i=Dt._n.measureText(Dt.kp).width,Dt.l1[t]=i,Dt.W2++),i}c1(t,i){return t.indexOf(`
`,i)}JA(t){let i=this.ri.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const s=this.spacingAbove+this.spacingBelow,n=Math.max(0,this.Np()+s);if(i.length===0)return this.ui=0,this.ge=1,n;if(!this.isMultiline){const l=this.c1(i,0);l>=0&&(i=i.substring(0,l))}let o=0;this.ge=0;let r=0,a=-1,h=!1;for(;!h;){if(a=this.c1(i,r),a===-1&&(a=i.length,h=!0),r<=a){const l=i.substring(r,a);if(this.wrap!==0){this.pn=0;const c=rt.l();this.J2(l,t,c),o+=c.height,rt.e(c),this.ge+=this.pn}else this.J2(l,t,null),o+=n,this.ge++;this.ge===this.maxLines&&(h=!0)}r=a+1}return this.w0=o,o}qv(){let t=this.ri.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let i=0,s=0,n=!1;for(;!n;){let o=this.c1(t,s);o===-1&&(o=t.length,n=!0);let r=t.substring(s,o);this.formatting===0&&(r=r.trim()),i=Math.max(i,this.getStringWidth(r)),s=o+1}return i}else{const i=this.c1(t,0);return i>=0&&(t=t.substring(0,i)),this.getStringWidth(t)}}get textValidation(){return this.rt!==null?this.rt.Tl:null}set textValidation(t){const i=this.textValidation;i!==t&&(t!==null&&u.k(t,Dt,"textValidation"),this.wn().Tl=t,this.t("textValidation",i,t))}get textEdited(){return this.rt!==null?this.rt.Ap:null}set textEdited(t){const i=this.textEdited;i!==t&&(t!==null&&u.k(t,Dt,"textEdited"),this.wn().Ap=t,this.t("textEdited",i,t))}get spacingAbove(){return this.rt!==null?this.rt.Tp:0}set spacingAbove(t){const i=this.spacingAbove;i!==t&&(this.wn().Tp=t,this.c(),this.t("spacingAbove",i,t))}get spacingBelow(){return this.rt!==null?this.rt.Dp:0}set spacingBelow(t){const i=this.spacingBelow;i!==t&&(this.wn().Dp=t,this.c(),this.t("spacingBelow",i,t))}get formatting(){return this.rt!==null?this.rt.Fp:0}set formatting(t){const i=this.formatting;i!==t&&(this.wn().Fp=t,this.c(),this.t("formatting",i,t))}get maxLines(){return this.rt!==null?this.rt.Rp:1/0}set maxLines(t){const i=this.maxLines;i!==t&&(t=Math.floor(t),t<=0&&u.W(t,"> 0",Dt,"maxLines"),this.wn().Rp=t,this.c(),this.t("maxLines",i,t))}getMetrics(){return[this.ui,this.Dl,this.io,this.pn,this.Ce,this.Ti,this.yn]}Kv(t){t!==void 0&&(this.ui=t[0],this.Dl=t[1],this.io=t[2],this.pn=t[3],this.Ce=t[4],this.Ti=t[5],this.yn=t[6])}get metrics(){return{arrSize:this.Ce!==null?this.Ce:[this.ui],arrText:this.Ti!==null?this.Ti:[this.yn],maxLineWidth:this.ui,fontHeight:this.io}}get choices(){return this.wd}set choices(t){const i=this.wd;i!==t&&(this.wd=t,this.t("choices",i,t))}};g(Dt,"h1",null),g(Dt,"a1",null),g(Dt,"None",0),g(Dt,"WrapFit",1),g(Dt,"WrapDesiredSize",2),g(Dt,"WrapBreakAll",3),g(Dt,"OverflowClip",0),g(Dt,"OverflowEllipsis",1),g(Dt,"FormatTrim",0),g(Dt,"FormatNone",1),g(Dt,"Jv",new RegExp("[ ]")),g(Dt,"Z2",new N),g(Dt,"tT",0),g(Dt,"l1",new N),g(Dt,"W2",0),g(Dt,"kp","..."),g(Dt,"QA",""),g(Dt,"_n",null),g(Dt,"W0",!1);let ae=Dt;class Ro{constructor(){g(this,"fi");g(this,"ns");g(this,"eo");g(this,"Fp");g(this,"Rp");g(this,"Mp");g(this,"Tp");g(this,"Dp");g(this,"Pp");g(this,"Ap");g(this,"Cp");g(this,"Tl");g(this,"tl");g(this,"Sp");this.fi=!1,this.ns=null,this.eo=0,this.Fp=0,this.Rp=1/0,this.Mp=0,this.Tp=0,this.Dp=0,this.Pp="start",this.Ap=null,this.Cp=null,this.Tl=null,this.tl=U.Top,this.Sp=2}copy(){const e=new Ro;return e.ns=this.ns,e.eo=this.eo,e.Fp=this.Fp,e.Rp=this.Rp,e.Mp=this.Mp,e.Tp=this.Tp,e.Dp=this.Dp,e.Pp=this.Pp,e.Ap=this.Ap,e.Cp=this.Cp,e.Tl=this.Tl,e.tl=this.tl,e.Sp=this.Sp,e}}class wi{constructor(){g(this,"uf");g(this,"df");g(this,"gf");g(this,"Lp");g(this,"mf");this.uf=1,this.df=0,this.gf=1,this.Lp=null,this.mf=null}copy(){const e=new wi;return e.uf=this.uf,e.df=this.df,e.gf=this.gf,e.Lp=this.Lp,e.mf=this.mf,e}}var Fo=(S=>(S[S.None=0]="None",S[S.Fill=2]="Fill",S[S.Uniform=6]="Uniform",S[S.UniformToFill=7]="UniformToFill",S))(Fo||{});const le=class le extends Xt{constructor(t,i){super();g(this,"il");g(this,"dt");g(this,"el");g(this,"pf");g(this,"ns");g(this,"sl");g(this,"yf");g(this,"eo");g(this,"wf");g(this,"xf");g(this,"Yb");this.n|=2097152,this.il=null,this.dt="",this.el=G.$D,this.pf=2,this.ns=null,this.sl=null,this.yf=U.Center,this.eo=0,this.wf=null,this.xf=null,this.Yb=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.dt=this.dt,t.element=this.il,t.el=this.el.P(),t.pf=this.pf,t.eo=this.eo,t.ns=this.ns,t.sl=this.sl,t.yf=this.yf.P(),t.xf=this.xf}oi(t){t in Fo?this.imageStretch=t:super.oi(t)}toString(){return"Picture("+this.source+")#"+I.as(this)}get bf(){return(this.n&1048576)!==0}set bf(t){this.bf!==t&&(this.n=this.n^1048576)}get vp(){return(this.n&2097152)!==0}set vp(t){this.vp!==t&&(this.n=this.n^2097152)}get hn(){return(this.n&4194304)!==0}set hn(t){this.hn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),u.s(t,"string",le,"clearCache:url"),t!==""?le.Op[t]&&(delete le.Op[t],le.f1--):(le.Op=new N,le.f1=0)}static tA(t,i){i.iT||(i.u1=s=>{le.$v(i,s),t.desiredSize.isReal()||(t.ue(!1),t.c())},i.d1=s=>le.Zv(i,s),i.addEventListener("load",i.u1),i.addEventListener("error",i.d1),i.iT=!0)}static BR(t){t.u1&&t.removeEventListener("load",t.u1),t.d1&&t.removeEventListener("error",t.d1),delete t.u1,delete t.d1,delete t.iT}get element(){return this.il}set element(t){const i=this.il;if(this.Ve(!0),i!==t){this.bf=t instanceof HTMLCanvasElement;const s=t instanceof HTMLImageElement;t!==null&&!(s||t instanceof HTMLVideoElement||this.bf)&&u.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t);const n=this.diagram;n!==null&&n.GM(this),this.il=t,t!==null&&s&&t.ts===void 0&&(t.ts=new I),n!==null&&s&&n.YM(this),this.t("element",i,t),this.S()}}ER(){const t=this.il;if(t===null)return;const i=this.desiredSize.isReal();(this.bf||t.complete===!0)&&(t.r0&&(t.Ip instanceof Event&&this.ns!==null?this.ns(this,t.Ip):t.hn===!0&&!t.Ip&&this.sl!==null&&t.Q2&&this.sl(this,t.Q2)),t.hn=!0),t.hn&&i&&this.diagram!==null&&this.diagram.Vu.add(this)}Qv(){if(this.il===null){this.wf=!1;return}const t=new $i(null).li;try{t.drawImage(this.il,0,0)}catch{this.vp=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.wf=!1),this.wf=!1}catch{this.wf=!0}}get source(){return this.dt}set source(t){const i=this.dt;if(i!==t){this.Ve(!0),u.s(t,"string",le,"source"),this.dt=t;let s=le.Op;if(!zt.isUsingDOM()){this.t("source",i,t);return}let n=null;if(s[t]!==void 0)n=s[t];else if(t!==""){le.f1>30&&(le.clearCache(),s=le.Op),n=u.hs("img"),n.r0=!0,le.tA(this,n);const o=this.xf;o!==null&&(n.crossOrigin=o(this)),n.src=t,s[t]=n,le.f1++}this.element=n,n!==null&&n.__goCache===void 0&&(n.__goCache=new mu),this.c(),this.S(),this.t("source",i,t)}}static $v(t,i){t.hn=!0,t.Ip=!1;let s;const n=t.ts.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value;r.S();const a=t.getAttribute("src")||"",h=r.Jl.get(a);if(h===null)continue;const l=h.length;for(let c=0;c<l;c++)s=h[c],s.desiredSize.isReal()||r.Vu.add(s),s.Ve(!0),r.requestUpdate(),t.r0&&(t.Q2===void 0&&(t.Q2=i),s.sl!==null&&s.sl(s,i))}t.ts.clear()}static Zv(t,i){t.Ip=i;let s;const n=t.ts.copy();if(n==null)return;const o=n.iterator;for(;o.next();){const r=o.value,a=t.getAttribute("src")||"",h=r.Jl.get(a);if(h===null)continue;const l=h.length,c=u.et();for(let d=0;d<l;d++)c.push(h[d]);if(t.r0)for(let d=0;d<l;d++)s=c[d],s.ns!==null&&s.ns(s,i);u.J(c)}t.ts.clear()}reloadSource(){if(this.source==="")return;le.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.S(),this.Ve(!0)}get sourceCrossOrigin(){return this.xf}set sourceCrossOrigin(t){if(this.xf!==t&&(t!==null&&u.k(t,le,"sourceCrossOrigin"),this.xf=t,this.element!==null)){const i=this.element.getAttribute("src");t===null&&typeof i=="string"?this.element.crossOrigin=null:t!==null&&(this.element.crossOrigin=t(this)),this.element.src=i}}get sourceRect(){return this.el}set sourceRect(t){const i=this.el;i.equals(t)||(t=t.P(),this.el=t,this.S(),this.t("sourceRect",i,t))}get imageStretch(){return this.pf}set imageStretch(t){const i=this.pf;i!==t&&(this.pf=t,this.S(),this.t("imageStretch",i,t))}get flip(){return this.eo}set flip(t){const i=this.eo;i!==t&&(this.eo=t,this.S(),this.t("flip",i,t))}get imageAlignment(){return this.yf}set imageAlignment(t){const i=this.yf;i.equals(t)||(t=t.P(),this.yf=t,this.S(),this.t("imageAlignment",i,t))}get errorFunction(){return this.ns}set errorFunction(t){const i=this.ns;i!==t&&(t!==null&&u.k(t,le,"errorFunction"),this.ns=t,this.t("errorFunction",i,t))}get successFunction(){return this.sl}set successFunction(t){const i=this.sl;i!==t&&(t!==null&&u.k(t,le,"successFunction"),this.sl=t,this.t("successFunction",i,t))}gh(t,i){const s=this.il;if(s===null)return;const n=s.getAttribute("src");if(s instanceof HTMLImageElement&&(n===null||n==="")||s.Ip instanceof Event&&t instanceof fn)return;const o=t instanceof Ge,r=this.naturalBounds;let a=0,h=0;const l=this.bf;let c=l?+s.width:s.naturalWidth,d=l?+s.height:s.naturalHeight;if(c===void 0&&s.videoWidth&&(c=s.videoWidth),d===void 0&&s.videoHeight&&(d=s.videoHeight),c===0||d===0)return;const f=c,m=d;this.sourceRect.isReal()&&(a=this.el.x,h=this.el.y,c=this.el.width,d=this.el.height);let p=c,y=d;const x=this.pf,b=this.yf;switch(x){case 0:if(this.sourceRect.isReal())break;p>=r.width&&(a=a+b.offsetX+(p*b.x-r.width*b.x)),y>=r.height&&(h=h+b.offsetY+(y*b.y-r.height*b.y)),c=Math.min(r.width,p),d=Math.min(r.height,y);break;case 2:p=r.width,y=r.height;break;case 6:case 7:let K=0;x===6?(K=Math.min(r.height/y,r.width/p),p*=K,y*=K):x===7&&(K=Math.max(r.height/y,r.width/p),p*=K,y*=K,p>=r.width&&(a=(a+b.offsetX+(p*b.x-r.width*b.x)/p)*c),y>=r.height&&(h=(h+b.offsetY+(y*b.y-r.height*b.y)/y)*d),c*=1/(p/r.width),d*=1/(y/r.height),p=r.width,y=r.height);break}const M=c*d,P=this.getDocumentScale()*i.scale,k=p*P,L=y*P,T=k*L,D=M/T,B=s.__goCache;let E=null;const R=le._v;if(!o){if(s.hn&&B!==void 0&&f<8e3&&m<8e3&&T>4&&D>R*R){B.Vt===null&&(B.eT(4,f,m,s),B.eT(16,f,m,s));const K=B.Vt,H=K.length;for(let W=0;W<H&&K[W].bd*K[W].bd<D;W++)E=K[W]}if(!i.Bu&&(this.wf===null&&this.Qv(),this.wf))return}const F=p<r.width?b.offsetX+(r.width*b.x-p*b.x):0,V=y<r.height?b.offsetY+(r.height*b.y-y*b.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,p),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,y)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,p),Math.min(r.height,y)),t.scale(-1,-1);break}if(t.commitTransform(),i.getRenderingHint("pictureRatioOptimization")&&!i.ia&&B!==void 0&&E!==null&&E.bd!==1){t.save();const K=E.bd;try{t.drawImage(E.dt,a/K,h/K,Math.min(E.dt.width,c/K),Math.min(E.dt.height,d/K),F,V,Math.min(r.width,p),Math.min(r.height,y)),t instanceof Ge&&(this.Yb=[a/K,h/K,Math.min(E.dt.width,c/K),Math.min(E.dt.height,d/K),F,V,Math.min(r.width,p),Math.min(r.height,y)])}catch{this.vp=!1}t.restore()}else try{t.drawImage(s,a,h,c,d,F,V,Math.min(r.width,p),Math.min(r.height,y)),t instanceof Ge&&(this.Yb=[a,h,c,d,F,V,Math.min(r.width,p),Math.min(r.height,y)])}catch{this.vp=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,p),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,y));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,p),-Math.min(r.height,y));break}}get naturalBounds(){return this.zi}Wu(t,i,s,n){const o=this.desiredSize,r=this.zs(!0),a=this.il,h=this.bf;let l=0,c=0;(h||!this.hn&&a&&a.complete)&&(this.hn=!0),a===null?(isFinite(o.width)||(t=s),isFinite(o.height)||(i=n)):(l=h?+a.width:a.naturalWidth,c=h?+a.height:a.naturalHeight),!isFinite(o.width)&&r!==2&&r!==5?a!==null&&this.hn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=l):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:a!==null&&(t=l)),s=0),!isFinite(o.height)&&r!==2&&r!==4?a!==null&&this.hn!==!1&&(this.sourceRect.isReal()?i=this.sourceRect.height:i=c):(isFinite(i)||(this.sourceRect.isReal()?i=this.sourceRect.height:a!==null&&(i=c)),n=0),isFinite(o.width)&&(t=o.width),isFinite(o.height)&&(i=o.height);const d=this.maxSize,f=this.minSize;s=Math.max(s||0,f.width),n=Math.max(n||0,f.height),t=Math.min(d.width,t),i=Math.min(d.height,i),t=Math.max(s,t),i=Math.max(n,i),a!==null&&!a.complete&&(isFinite(t)||(t=0),isFinite(i)||(i=0)),this.zi.Fn(t,i),this.Wn(0,0,t,i)}uh(t,i,s,n){this.commonArrange(t,i,s,n)}};g(le,"Op",new N),g(le,"f1",0),g(le,"_v",4);let ii=le;class mu{constructor(){g(this,"Vt");this.Vt=null}eT(e,t,i,s){this.Vt===null&&(this.Vt=[]);const n=new $i(null),o=n.li,r=1/e;if(n.width=t/e,n.height=i/e,n.width===0||n.height===0)return;const a=new pu(n.Tt,e);let h=s,l=1;if(this.Vt.length>0){const c=this.Vt[this.Vt.length-1];h=c.dt,l=c.bd}o.setTransform(r*l,0,0,r*l,0,0),o.commitTransform(),o.drawImage(h,0,0),this.Vt.push(a)}}class pu{constructor(e,t){g(this,"dt");g(this,"bd");this.dt=e,this.bd=t}}const gs=class gs{constructor(){g(this,"bi");g(this,"Gg");this.Gg=new Tt,this.bi=null}Ri(e){e!==null?(this.Gg=e,e.figures.clear()):this.Gg=new Tt,this.bi=null}hu(e,t,i,s,n,o){if(s!==void 0&&s===!0){const r=new Mt(1);r.endX=e,r.endY=t,this.bi.segments.add(r)}else this.bi=new Gt,this.bi.startX=e,this.bi.startY=t,this.bi.isFilled=i,this.bi.isEvenOdd=o||!1,this.Gg.figures.add(this.bi);n!==void 0&&(this.bi.isShadowed=n)}rF(){const e=this.bi.segments.length;e>0&&this.bi.segments.elt(e-1).close()}lF(){this.bi.segments.length>0&&(this.bi.isFilled=!0)}hF(e){this.bi.isShadowed=e}RE(e){this.bi.isEvenOdd=e}sF(e,t,i){i===void 0&&(i=!1);const s=new Mt(1);s.endX=e,s.endY=t,i&&s.close(),this.bi.segments.add(s)}lr(e,t,i){i===void 0&&(i=!1);const s=new Mt(2);s.endX=e,s.endY=t,i&&s.close(),this.bi.segments.add(s)}hr(e,t,i,s,n,o,r){r===void 0&&(r=!1);const a=new Mt(3);a.point1X=e,a.point1Y=t,a.point2X=i,a.point2Y=s,a.endX=n,a.endY=o,r&&a.close(),this.bi.segments.add(a)}Cw(e,t,i,s,n){n===void 0&&(n=!1);const o=new Mt(4);o.point1X=e,o.point1Y=t,o.endX=i,o.endY=s,n&&o.close(),this.bi.segments.add(o)}nF(e,t,i,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const a=new Mt(5);a.startAngle=e,a.sweepAngle=t,a.centerX=i,a.centerY=s,a.radiusX=n,o!==0?a.radiusY=o:a.radiusY=n,r&&a.close(),this.bi.segments.add(a)}oF(e,t,i,s,n,o,r,a){a===void 0&&(a=!1);const h=new Mt(6,o,r,e,t,i,s,n);a&&h.close(),this.bi.segments.add(h)}static RC(e){const t=gs._2;if(t!==null)return gs._2=null,t.Ri(e),t;{const i=new gs;return i.Ri(e),i}}static vC(e){gs._2=e}};g(gs,"_2",null);let Ls=gs;{const S=function(n,o){const r=n.toLowerCase(),a=O.In;a[n]=o,a[r]=n};S("Rectangle",(n,o,r)=>{const a="r"+o+","+r;let h=O.or[a];return h!==void 0||(h=new Tt(2),h.endX=o,h.endY=r,O.rr<O.Vg&&(O.or[a]=h,O.rr++)),h}),S("Square",(n,o,r)=>{const a="s"+o+","+r;let h=O.or[a];return h!==void 0||(h=new Tt(2),h.endX=o,h.endY=r,h.defaultStretch=6,O.rr<O.Vg&&(O.or[a]=h,O.rr++)),h});const e=(n,o,r,a,h)=>{(isNaN(a)||a<0)&&(a=5),isNaN(h)&&(h=15);const l="rr"+o+","+r+","+a+","+h;let c=O.or[l];if(c!==void 0)return c;let d=a;(h&1)===1?(d=Math.min(d,(h&2)===2?o/3:o),d=Math.min(d,(h&8)===8?r/3:r)):d=0;const f=new Gt(d,0,!0);c=new Tt().add(f);const m=U.TopLeft.copy(),p=U.BottomRight.copy();if((h&2)===2){let y=a;y=Math.min(y,(h&1)===1?o/3:o),y=Math.min(y,(h&4)===4?r/3:r);const x=y*O.Rn;f.add(new Mt(2,o-y,0)).add(new Mt(3,o,y,o-x,0,o,x)),m.offsetY=x,p.offsetX=-x}else f.add(new Mt(2,o,0));if((h&4)===4){let y=a;y=Math.min(y,(h&8)===8?o/3:o),y=Math.min(y,(h&2)===2?r/3:r);const x=y*O.Rn;f.add(new Mt(2,o,r-y)).add(new Mt(3,o-y,r,o,r-x,o-x,r)),p.offsetX=-x,p.offsetY=-x}else f.add(new Mt(2,o,r));if((h&8)===8){let y=a;y=Math.min(y,(h&4)===4?o/3:o),y=Math.min(y,(h&1)===1?r/3:r);const x=y*O.Rn;f.add(new Mt(2,y,r)).add(new Mt(3,0,r-y,x,r,0,r-x)),m.offsetX=x,p.offsetY=-x}else f.add(new Mt(2,0,r));if((h&1)===1){const y=d*O.Rn;f.add(new Mt(2,0,d)).add(new Mt(3,d,0,0,y,y,0).close()),m.offsetX=y,m.offsetY=y}else f.add(new Mt(2,0,0).close());return c.spot1=m,c.spot2=p,O.rr<O.Vg&&(O.or[l]=c,O.rr++),c};S("RoundedRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN,h=n?n.parameter2:NaN;return e(n,o,r,a,h)}),S("Border","RoundedRectangle"),S("RoundedTopRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,3)}),S("RoundedBottomRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,12)}),S("RoundedLeftRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,9)}),S("RoundedRightRectangle",(n,o,r)=>{const a=n?n.parameter1:NaN;return e(n,o,r,a,6)}),S("Ellipse",(n,o,r)=>{const a="e"+o+","+r;let h=O.or[a];return h!==void 0||(h=new Tt(3),h.endX=o,h.endY=r,h.spot1=U.zk,h.spot2=U.Xk,O.rr<O.Vg&&(O.or[a]=h,O.rr++)),h}),S("Circle",(n,o,r)=>{const a="c"+o+","+r;let h=O.or[a];return h!==void 0||(h=new Tt(3),h.endX=o,h.endY=r,h.spot1=U.zk,h.spot2=U.Xk,h.defaultStretch=6,O.rr<O.Vg&&(O.or[a]=h,O.rr++)),h}),S("TriangleRight",(n,o,r)=>new Tt().add(new Gt(0,0).add(new Mt(2,o,.5*r)).add(new Mt(2,0,r).close())).setSpots(0,.25,.5,.75)),S("TriangleDown",(n,o,r)=>new Tt().add(new Gt(0,0).add(new Mt(2,o,0)).add(new Mt(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),S("TriangleLeft",(n,o,r)=>new Tt().add(new Gt(o,r).add(new Mt(2,0,.5*r)).add(new Mt(2,o,0).close())).setSpots(.5,.25,1,.75)),S("TriangleUp",(n,o,r)=>new Tt().add(new Gt(o,r).add(new Mt(2,0,r)).add(new Mt(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),S("Triangle","TriangleUp"),S("Diamond",(n,o,r)=>new Tt().add(new Gt(.5*o,0).add(new Mt(2,0,.5*r)).add(new Mt(2,.5*o,r)).add(new Mt(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),S("LineH",(n,o,r)=>{const a=new Tt(1);return a.startX=0,a.startY=r/2,a.endX=o,a.endY=r/2,a}),S("LineV",(n,o,r)=>{const a=new Tt(1);return a.startX=o/2,a.startY=0,a.endX=o/2,a.endY=r,a}),S("None","Rectangle"),S("BarH","Rectangle"),S("BarV","Rectangle"),S("MinusLine","LineH"),S("PlusLine",(n,o,r)=>new Tt().add(new Gt(0,r/2,!1).add(new Mt(2,o,r/2)).add(new Mt(1,o/2,0)).add(new Mt(2,o/2,r)))),S("XLine",(n,o,r)=>new Tt().add(new Gt(0,r,!1).add(new Mt(2,o,0)).add(new Mt(1,0,0)).add(new Mt(2,o,r)))),S("LineRight",(n,o,r)=>new Tt().add(new Gt(.25*o,0,!1).add(new Mt(2,.75*o,.5*r)).add(new Mt(2,.25*o,r)))),S("LineDown",(n,o,r)=>new Tt().add(new Gt(0,.25*r,!1).add(new Mt(2,.5*o,.75*r)).add(new Mt(2,o,.25*r)))),S("LineLeft",(n,o,r)=>new Tt().add(new Gt(.75*o,0,!1).add(new Mt(2,.25*o,.5*r)).add(new Mt(2,.75*o,r)))),S("LineUp",(n,o,r)=>new Tt().add(new Gt(0,.75*r,!1).add(new Mt(2,.5*o,.25*r)).add(new Mt(2,o,.75*r)))),S("Capsule",(n,o,r)=>{const a=new Tt;if(o<r){const h=o/2,l=new Gt(0,h,!0);a.add(l),l.add(new Mt(5,180,180,h,h,h,h)),l.add(new Mt(2,o,r-h)),l.add(new Mt(5,0,180,h,r-h,h,h)),l.add(new Mt(2,0,h));const c=isFinite(n.parameter1)?n.parameter1:o*.156;return a.spot1=new U(0,0,0,c),a.spot2=new U(1,1,0,-c),a}else if(o>r){const h=r/2,l=new Gt(h,0,!0);a.add(l),l.add(new Mt(2,o-h,0)),l.add(new Mt(5,270,180,o-h,h,h,h)),l.add(new Mt(2,h,r)),l.add(new Mt(5,90,180,h,h,h,h));const c=isFinite(n.parameter1)?n.parameter1:r*.156;return a.spot1=new U(0,0,c,0),a.spot2=new U(1,1,-c,0),a}else return a.type=3,a.endX=o,a.endY=r,a.spot1=U.zk,a.spot2=U.Xk,a});const t=(n,o)=>new Gt(n,o,!1,!1),i=(n,o,r)=>n.add(new Mt(2,o,r)),s=(n,o,r)=>n.add(new Mt(1,o,r));S("Borders",(n,o,r)=>{let a=n?n.parameter1:NaN;isNaN(a)?a=10:a=a&15;const h=new Tt;let l;return a===10?(l=t(o,0),i(l,o,r),s(l,0,r),i(l,0,0)):a===5?(l=t(0,0),i(l,o,0),s(l,o,r),i(l,0,r)):a===1?(l=t(0,0),i(l,o,0),s(l,o,r)):a===2?(l=t(o,0),i(l,o,r)):a===4?(l=t(o,r),i(l,0,r)):a===8?(l=t(0,r),i(l,0,0),s(l,o,r)):a===3?(l=t(0,0),i(l,o,0),i(l,o,r)):a===6?(l=t(o,0),i(l,o,r),i(l,0,r)):a===12?(l=t(o,r),i(l,0,r),i(l,0,0)):a===9?(l=t(0,r),i(l,0,0),i(l,o,0)):a===7?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r)):a===14?(l=t(o,0),i(l,o,r),i(l,0,r),i(l,0,0)):a===13?(l=t(o,r),i(l,0,r),i(l,0,0),i(l,o,0)):a===11?(l=t(0,r),i(l,0,0),i(l,o,0),i(l,o,r)):a===15?(l=t(0,0),i(l,o,0),i(l,o,r),i(l,0,r),l.add(new Mt(2,0,0).close())):(l=t(0,0),s(l,o,r)),h.add(l),h})}O.Bg={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var fa=(S=>(S[S.None=0]="None",S[S.Added=1]="Added",S[S.Removed=2]="Removed",S[S.Shown=4]="Shown",S[S.Hidden=8]="Hidden",S[S.NodeSized=16]="NodeSized",S[S.GroupLayout=32]="GroupLayout",S[S.NodeReplaced=64]="NodeReplaced",S[S.Standard=127]="Standard",S[S.All=16777215]="All",S))(fa||{});const ue=class ue extends bt{constructor(t,i){let s;t===void 0||t instanceof Yt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"w");g(this,"zo");g(this,"j");g(this,"nl");g(this,"ol");g(this,"Xo");g(this,"ri");g(this,"Yo");g(this,"xh");g(this,"Ks");g(this,"Go");g(this,"kd");g(this,"WS");g(this,"sT");g(this,"Ep");g(this,"Up");this.w=2408959,this.zo="",this.j=null,this.nl="",this.ol=null,this.Xo=null,this.ri="",this.Yo=null,this.xh=null,this.Ks=new C(NaN,NaN).u(),this.Go=null,this.kd=NaN,this.WS=-1,this.sT=new G,this.Ep=null,this.Up=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.w=this.w&-4097|16384|32768,t.zo=this.zo,this.j!==null&&(this.j.fi?t.j=this.j:t.j=this.j.copy()),t.nl=this.nl,t.Xo=null,t.ri=this.ri,t.Ks.a(this.Ks),t.kd=this.kd}vo(t){super.vo(t),t.dh(),t.ol=null,t.Go=null,t.Ep=null}toString(){let t=u.Dn(this.constructor)+"#"+I.as(this);return this.data!==null&&(t+="("+u.toString(this.data)+")"),t}Hi(){return this.j===null?this.j=new Io:this.j.fi&&(this.j=this.j.copy()),this.j}ch(){super.ch(),this.j!==null&&(this.j.fi=!0)}qc(t,i,s,n,o,r,a){const h=this.diagram;h!==null&&(t===3&&i==="elements"?o instanceof bt?o.Gr(l=>{h.partManager.IM(l,h)}):o instanceof ii&&h.YM(o):t===4&&i==="elements"&&(o instanceof bt?o.Gr(l=>h.partManager.EM(l,h)):o instanceof ii&&h.GM(o)),h.raiseChangedEvent(t,i,s,n,o,r,a))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const i=this.C.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];r instanceof bt&&r.Gr(a=>{a.data!==null&&a.updateTargetBindings()})}const n=this.adornments;for(;n.next();)n.value.updateTargetBindings(t)}Do(){if(super.Do(),this.L2()){const i=this.C.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof bt&&o.Gr(r=>r.Do())}}const t=this.adornments;for(;t.next();)t.value.Do()}updateRelationshipsFromData(){var t;this.data!==null&&((t=this.diagram)==null||t.partManager.updateRelationshipsFromData(this))}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.Xo===null?A.instance:this.Xo.iteratorValues}findAdornment(t){const i=this.Xo;return i===null?null:i.get(t)}addAdornment(t,i){if(i===null)return;let s=null,n=this.Xo;if(n!==null&&(s=n.get(t)),s!==i){if(s!==null){const r=s.diagram;r!==null&&r.remove(s)}n===null&&(n=new Z,this.Xo=n),i.zo!==t&&(i.category=t),n.set(t,i);const o=this.diagram;if(o!==null){o.add(i);const r=i.adornedObject;if(r!==null){const a=r.findBindingPanel();a!==null&&(i.data=a.data)}}}}removeAdornment(t){const i=this.Xo;if(i===null)return;const s=i.get(t);if(s!==null){const n=s.diagram;n!==null&&(n.remove(s),s.data=null)}i.delete(t),i.count===0&&(this.Xo=null)}clearAdornments(){const t=this.Xo;if(t===null)return;const i=u.et(),s=t.iterator;for(;s.next();){const o=s.key;i.push(o)}const n=i.length;for(let o=0;o<n;o++)this.removeAdornment(i[o]);u.J(i)}updateAdornments(){var s;const t=this.diagram;if(t===null)return;this.tO(t),this.iO(t);let i=this.adornments;for(;i.next();){const n=i.value;n.c(),n.hasPlaceholder()&&((s=n.placeholder)==null||s.c())}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t._l(),this.nT()!==!0&&this.oT(!0))}JS(){this.nT()!==!1&&(this.updateAdornments(),this.oT(!1))}tO(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const s=this.selectionObject;if(s!==null&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let n=this.findAdornment(i);if(n===null){let o=this.selectionAdornmentTemplate;o===null&&(this.Cl()?o=t.linkSelectionAdornmentTemplate:this instanceof Nt?o=t.groupSelectionAdornmentTemplate:o=t.nodeSelectionAdornmentTemplate),n=o.copy(),n!==null&&(this.Cl()&&this.selectionObject===this.path&&(n.type=bt.Link),n.adornedObject=s)}if(n!==null){n.type===bt.Link&&n.c(),this.addAdornment(i,n);return}}}this.removeAdornment(i)}iO(t){const i=this;t.toolManager.mouseDownTools.each(s=>{s.isEnabled&&s.updateAdornments(i)}),t.toolManager.updateAdornments(i)}HS(t){this.Yo=t,t===null&&this.QR()}get layer(){return this.Yo}get diagram(){const t=this.Yo;return t==null?null:t.diagram}get layerName(){return this.nl}set layerName(t){const i=this.nl;if(i===t)return;let s=this.diagram;if(s!==null&&(s.findLayer(t)===null||s.partManager.addsToTemporaryLayer))return;this.nl=t,s!==null&&s.invalidateDocumentBounds(),this.t("layerName",i,t);const n=this.layer;if(n===null||n.name===t||(s=n.diagram,s===null))return;const o=s.findLayer(t);if(o===null||o===n)return;let r=n.te(-1,this,!0);r>=0&&s.raiseChangedEvent(4,"parts",n,this,null,r,!0),r=o.Jh(99999999,this,!0),n.visible!==o.visible&&this.Ei(o.visible),r>=0&&s.raiseChangedEvent(3,"parts",o,null,this,!0,r);const a=this.layerChanged;if(a===null)return;const h=s.X;s.X=!0,a(this,n,o),s.X=h}get layerChanged(){return this.j!==null?this.j.Bp:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(t!==null&&u.k(t,ue,"layerChanged"),this.Hi().Bp=t,this.t("layerChanged",i,t))}get zOrder(){return this.kd}set zOrder(t){const i=this.kd;if(i===t)return;this.kd=t;const s=this.layer;s!==null&&s.Px(-1,this),this.t("zOrder",i,t);const n=this.diagram;n!==null&&n.S()}eO(){const t=this.layer;t!==null&&t.Px(-1,this)}g1(){if(this.ih()!==!1)return;this.tN(!0),this.$c();const t=this.diagram;t!==null&&(t.t0(this),t.requestUpdate())}rT(){if(this.w|=2097152,this.ih()===!1)return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.lT(t,i);const s=this.Ni,n=G.l().a(s);s.Pt(),s.x=t.x,s.y=t.y,s.u(),this.Ju(n,s),G.e(n),this.tN(!1),this.$c()}Wn(t,i,s,n){const o=this.se;o.i(t,i,s,n),this.wi===null&&(this.wi=new Pt);const r=this.wi;r.Ri(),this.m0(r,t,i,s,n),this.wi=r,r.Yk()||r.vg(o)}m0(t,i,s,n,o){if(this.tt!==1&&t.tt(this.tt),this.Yt===0)return;let r=U.Center;this.locationSpot.isSpot()&&(r=this.locationSpot);const a=C.l();if(this.locationObject!==this){const h=this.locationObject,l=h.naturalBounds;a.setSpot(l.x,l.y,l.width,l.height,r),h.wi!==null&&h.wi.gt(a),a.offset(-h.measuredBounds.x,-h.measuredBounds.y);let c=h.panel;for(;c!==null&&c!==this;)c.wi!==null&&c.wi.gt(a),a.offset(-c.measuredBounds.x,-c.measuredBounds.y),c=c.panel}else a.setSpot(i,s,n,o,r);t.cs(this.Yt,a.x,a.y),C.e(a)}get locationObject(){var t;if(this.Go===null)if(this instanceof Ft&&this.type!==bt.Link&&this.hasPlaceholder())this.Go=this.placeholder;else{const i=this.locationObjectName;if(i!==""){const s=this.findObject(i);s!==null?this.Go=s:this.Go=this}else this.Go=this}return(t=this.Go)!=null&&t.visible?this.Go:this}get minLocation(){return this.j!==null?this.j.Vp:C.gC}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.P(),this.Hi().Vp=t,this.t("minLocation",i,t))}get maxLocation(){return this.j!==null?this.j.zp:C.mC}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.P(),this.Hi().zp=t,this.t("maxLocation",i,t))}get locationObjectName(){return this.j!==null?this.j.Xp:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this.Hi().Xp=t,this.Go=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return this.j!==null?this.j.Yp:U.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.P(),this.Hi().Yp=t,this.c(),this.t("locationSpot",i,t))}move(t,i){i===!0?this.location=t:this.position=t}moveTo(t,i,s){const n=C.V(t,i);this.move(n,s),C.e(n)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const s=t.diagram;if(s!==null&&s.animationManager.hx(this))return!0}const i=this.containingGroup;return!(i!==null&&(!i.isSubGraphExpanded||!i.isVisible()))}Ei(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),i!==null&&i.t0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.dh(),i!==null&&(i.invalidateDocumentBounds(),i.S())}findObject(t){if(this.name===t)return this;let i=this.Ep;if(i===null&&(this.Ep=i=new Z),i.get(t)!==null)return i.get(t);const s=super.findObject(t);return s!==null?(i.set(t,s),s):(i.set(t,null),null)}A0(){this.Ep=null}getRelativePoint(t,i,s){s===void 0&&(s=new C);const n=i.isNoSpot()?U.Center:i,o=t.naturalBounds;if(s.i(o.width*n.x+n.offsetX,o.height*n.y+n.offsetY),t===null||t===this)return s;t.T.gt(s);let r=t.panel;for(;r!==null&&r!==this;)r.T.gt(s),r=r.panel;return this.wi!==null&&this.wi.gt(s),s.offset(-this.se.x,-this.se.y),s}getDocumentBounds(t){return t===void 0&&(t=new G),t.a(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Bt()}IA(t){const i=this.locationSpot,s=this.locationObject;let n=s.naturalBounds;n.isReal()||(n=G.Fg);const o=s instanceof At?s.strokeWidth:0;if(t.setSpot(0,0,n.width+o,n.height+o,i),s!==this){t.offset(-o/2,-o/2),s.T.gt(t);let r=s.panel;for(;r!==null&&r!==this;)r.T.gt(t),r=r.panel}return this.wi!==null&&this.wi.gt(t),t.offset(-this.se.x,-this.se.y),t}Wh(t,i){const s=i===void 0?this.sT:i,n=this.sO(),o=n*2;if(!this.isShadowed)return s.i(t.x-1-n,t.y-1-n,t.width+2+o,t.height+2+o),s;let r=t.x,a=t.y,h=t.width,l=t.height;const c=this.shadowBlur,d=this.shadowOffset;return h+=c,l+=c,r-=c/2,a-=c/2,d.x>0?h+=d.x:(r+=d.x,h-=d.x),d.y>0?l+=d.y:(a+=d.y,l-=d.y),s.i(r-1,a-1,h+2,l+2),s}Vv(){return this.type===bt.Link&&this instanceof Ft&&this.category==="Selection"&&this.adornedObject instanceof At&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}sO(){return isNaN(this.Up)&&(this.Up=this.YA()),this.Up}cf(){this.Up=NaN}Bt(){if(this._e()===!1){this.rT();return}this.Jn(!1);const t=this.Ni,i=G.l();i.a(t);const s=this.Nl();this.uh(0,0,this.se.width,this.se.height);const n=this.position;this.lT(n,this.location),t.Pt(),t.x=n.x,t.y=n.y,t.u(),this.Ju(i,t),i.equals(t)?this.ps(s):this.ke()&&(!O.f(i.width,t.width)||!O.f(i.height,t.height))&&this.WS>=0&&this.invalidateLayout(16),G.e(i),this.tN(!1)}Ju(t,i){const s=this.diagram;if(s===null)return;let n=!1;if(s.ta===!1&&t.isReal()){const o=G.l();o.a(s.documentBounds),o.subtractMargin(s.padding),t.x>o.x&&t.y>o.y&&t.right<o.right&&t.bottom<o.bottom&&i.x>o.x&&i.y>o.y&&i.right<o.right&&i.bottom<o.bottom&&(n=!0),G.e(o)}(this.nO()===!0||!t.equals(i))&&this.KL(n,s),s.S(),!(!t.isReal()&&!i.isReal()||t.equalsApproxClose(i))&&(this instanceof gt&&!s.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.dh())}get location(){return this.Ks}set location(t){const i=t.x,s=t.y,n=this.Ks;(n.x!==i&&(!isNaN(n.x)||!isNaN(i))||n.y!==s&&(!isNaN(n.y)||!isNaN(s)))&&(t=t.copy(),this.oO(t,n)&&this.t("location",n,t.copy()))}oO(t,i){if(this.Cl())return!1;if(this.Ks=t,this.w|=2097152,this._e()===!1){this.g1();const s=this.at;if(s.isReal()){const n=this.diagram;if(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing){const o=s.copy();s.i(s.x+(t.x-i.x),s.y+(t.y-i.y)),this.hT(n,s,o.x,o.y),this.t("position",o,s.copy())}}}return!0}M2(t,i,s){if(this.Cl()||!t.isReal())return!1;const n=this.diagram;if(n!==null&&this.hT(n,t,i,s),this.at=t,this.w&=-2097153,this.Ks.isReal()&&(n===null||n.animationManager.isTicking||!n.undoManager.isUndoingRedoing)){const o=this.Ks;this.Ks=new C(o.x+(t.x-i),o.y+(t.y-s)),this.t("location",o,this.Ks.copy())}return this.ih()===!1&&this._e()===!1&&(this.g1(),this.rT()),!0}hT(t,i,s,n){if(t===null||this instanceof Ft)return;const o=t.animationManager;o.pi&&o.dL(this,new C(s,n),i,!1)}bc(t,i,s){const n=this.Ks,o=this.at;if(s){if(n.x===t&&n.y===i)return;this.ih()||this._e()?o.i(NaN,NaN):o.i(o.x+t-n.x,o.y+i-n.y),n.i(t,i)}else{if(o.x===t&&o.y===i)return;n.i(n.x+t-o.x,n.y+i-o.y),o.i(t,i)}this.g1()}N2(){this.w&=-2097153,this.g1()}lT(t,i){const s=this.IA(C.l()),n=this.diagram,o=i.isReal(),r=t.isReal();o&&r?this.w&2097152?this.aT(t,i,n,s):this.cT(t,i,n,s):o?this.aT(t,i,n,s):r&&this.cT(t,i,n,s),this.w|=2097152,C.e(s),this.$c()}aT(t,i,s,n){const o=t.x,r=t.y;if(t.i(i.x-n.x,i.y-n.y),s!==null){const a=s.animationManager,h=a.defaultAnimation.isAnimating;!h&&a.pi&&!(this instanceof Ft)&&a.dL(this,new C(o,r),t,!1),!h&&!(t.x===o&&t.y===r)&&this.t("position",new C(o,r),t.copy())}}cT(t,i,s,n){const o=i.copy();i.i(t.x+n.x,t.y+n.y),!i.equals(o)&&s!==null&&this.t("location",o,i.copy())}KL(t,i){this.w2(!1),this instanceof gt&&i.JM(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const s=this.Ni,n=i.viewportBounds;n.isReal()?this.Nl()?(s.intersectsRectPlus(n,10)||this.ps(!1),this.updateAdornments()):this.isVisible()&&s.intersectsRect(n)?(this.ps(!0),this.updateAdornments()):this.invalidateAdornments():i.Ic=!0}Yr(){return!0}ke(){return!0}Cl(){return!1}Xs(){return!0}hasPlaceholder(){return!1}get category(){return this.zo}set category(t){const i=this.zo;if(i===t)return;this.svg!==null&&(this.svg.remove(),this.Ve(!0));const s=this.diagram,n=this.data;let o=null;if(s!==null&&n!==null&&!(this instanceof Ft)){const r=s.model.undoManager;r.isEnabled&&!r.isUndoingRedoing&&(o=this.clone(),o.C.addAll(this.C))}if(this.zo=t,this.t("category",i,t),s!==null&&n!==null&&!(this instanceof Ft)){const r=s.model;if(r.undoManager.isUndoingRedoing)return;if(this.Cl()){s.partManager.setLinkCategoryForData(n,t);const a=s.partManager.findLinkTemplateForCategory(t);if(a!==null){a.Et();const h=a.copy();h!==null&&this.iN(h,i,t)}}else{r!==null&&r.setCategoryForNodeData(n,t);const a=s.partManager.findTemplateForNodeData(n,t);if(a!==null){a.Et();const h=a.copy();if(h!==null&&!(h instanceof St)){const l=this.location.copy();this.iN(h,i,t),this.location.isReal()||(this.location=l)}}}if(o!==null){const a=this.clone();a.C.addAll(this.C),this.t("self",o,a)}}else if(this instanceof Ft){const r=this.adornedPart;if(r!==null){const a=r.Xo;a!==null&&a.delete(i),r.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.iN(t,this.category,t.category)}iN(t,i,s){t.constructor!==this.constructor&&(ue.fT||(ue.fT=!0,u.ni('Should not change the class of the Part when changing category from "'+i+'" to "'+s+'"'),u.ni("  Old class: "+u.Dn(this.constructor)+", new class: "+u.Dn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const n=this.data,o=this.layerName,r=this.isSelected,a=this.isHighlighted;let h=!0,l=!0,c=!1;this instanceof gt&&(h=this.isTreeLeaf,l=this.isTreeExpanded,c=this.wasTreeExpanded),t.vo(this),t.cloneProtected(this),this.zo=s,this.svg!==null&&(this.svg.remove(),this.svg=null,this.Ve(!0)),this.c(),this.S();const d=this.diagram;let f=!0;d!==null&&(f=d.skipsUndoManager,d.skipsUndoManager=!0),this._t=n,this.w=r?this.w|4096:this.w&-4097,this.w=a?this.w|524288:this.w&-524289,this instanceof gt&&(this.v=h?this.v|4:this.v&-5,this.v=l?this.v|1:this.v&-2,this.v=c?this.v|2:this.v&-3),n!==null&&this.updateTargetBindings();const m=this.layerName;m!==o&&(this.nl=o,this.layerName=m),d!==null&&(d.skipsUndoManager=f),this.ke()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return i===null?!0:!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return i===null?!0:!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return i===null?!0:!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return i===null?!0:!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const i=t.diagram;return i===null?!0:!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return i===null?!0:!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const i=t.diagram;return i===null?!0:!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return i===null?!0:!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return i===null?!0:!!i.allowSelect}get copyable(){return(this.w&1)!==0}set copyable(t){const i=(this.w&1)!==0;i!==t&&(this.w=this.w^1,this.t("copyable",i,t))}get deletable(){return(this.w&2)!==0}set deletable(t){const i=(this.w&2)!==0;i!==t&&(this.w=this.w^2,this.t("deletable",i,t))}get textEditable(){return(this.w&4)!==0}set textEditable(t){const i=(this.w&4)!==0;i!==t&&(this.w=this.w^4,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return(this.w&8)!==0}set groupable(t){const i=(this.w&8)!==0;i!==t&&(this.w=this.w^8,this.t("groupable",i,t))}get movable(){return(this.w&16)!==0}set movable(t){const i=(this.w&16)!==0;i!==t&&(this.w=this.w^16,this.t("movable",i,t))}get selectionAdorned(){return(this.w&32)!==0}set selectionAdorned(t){const i=(this.w&32)!==0;i!==t&&(this.w=this.w^32,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.w&64)!==0}set isInDocumentBounds(t){const i=(this.w&64)!==0;if(i!==t){this.w=this.w^64;const s=this.diagram;s!==null&&s.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return(this.w&128)!==0}set isLayoutPositioned(t){const i=(this.w&128)!==0;i!==t&&(this.w=this.w^128,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.w&256)!==0}set selectable(t){const i=(this.w&256)!==0;i!==t&&(this.w=this.w^256,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return(this.w&512)!==0}set reshapable(t){const i=(this.w&512)!==0;i!==t&&(this.w=this.w^512,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return(this.w&1024)!==0}set resizable(t){const i=(this.w&1024)!==0;i!==t&&(this.w=this.w^1024,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return(this.w&2048)!==0}set rotatable(t){const i=(this.w&2048)!==0;i!==t&&(this.w=this.w^2048,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return(this.w&4096)!==0}set isSelected(t){const i=(this.w&4096)!==0;if(i!==t){const s=this.diagram;if(t){if(!this.canSelect())return;if(s!==null){const r=s.maxSelectionCount;if(s.selection.count>=r)return}}this.w=this.w^4096;let n=!1;if(s!==null){n=s.skipsUndoManager,s.skipsUndoManager=!0;const r=s.selection;r.Pt(),t?r.add(this):r.delete(this),r.u()}this.t("isSelected",i,t),this.invalidateAdornments();const o=this.selectionChanged;o!==null&&o(this),s!==null&&(s.requestUpdate(),s.skipsUndoManager=n)}}get isHighlighted(){return(this.w&524288)!==0}set isHighlighted(t){const i=(this.w&524288)!==0;if(i!==t){this.w=this.w^524288;const s=this.diagram;if(s!==null){const o=s.highlighteds;o.Pt(),t?o.add(this):o.delete(this),o.u()}this.t("isHighlighted",i,t),this.S();const n=this.highlightedChanged;n!==null&&n(this)}}get isShadowed(){return(this.w&8192)!==0}set isShadowed(t){const i=(this.w&8192)!==0;i!==t&&(this.w=this.w^8192,this.Ve(!0),this.t("isShadowed",i,t),this.S())}nT(){return(this.w&16384)!==0}oT(t){t?this.w|=16384:this.w&=-16385}ih(){return(this.w&32768)!==0}tN(t){t?this.w|=32768:this.w&=-32769}nO(){return(this.w&65536)!==0}w2(t){t?this.w|=65536:this.w&=-65537}Nl(){return(this.w&131072)!==0}ps(t){t?this.w|=131072:this.w&=-131073}uT(){return(this.w&1048576)!==0}m1(t){t?this.w|=1048576:this.w&=-1048577}get isAnimated(){return(this.w&262144)!==0}set isAnimated(t){const i=(this.w&262144)!==0;i!==t&&(this.w=this.w^262144,this.t("isAnimated",i,t))}get highlightedChanged(){return this.j!==null?this.j.Gp:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(t!==null&&u.k(t,ue,"highlightedChanged"),this.Hi().Gp=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return this.j!==null?this.j.Kp:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this.Hi().Kp=t,this.ol=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return this.j!==null?this.j.jp:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(t!==null&&t.Et(),this.Hi().jp=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(this.ol===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const i=this.findObject(t);i!==null?this.ol=i:this.ol=this}else if(this instanceof St){const i=this.path;i!==null?this.ol=i:this.ol=this}else this.ol=this}return this.ol}get selectionChanged(){return this.j!==null?this.j.Hp:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(t!==null&&u.k(t,ue,"selectionChanged"),this.Hi().Hp=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return this.j!==null?this.j.qp:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this.Hi().qp=t!==null?t.Et():null,this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return this.j!==null?this.j.Wp:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this.Hi().Wp=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get resizeCellSize(){return this.j!==null?this.j.Jp:rt.ww}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.P(),this.Hi().Jp=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return this.j!==null?this.j.$p:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this.Hi().$p=t!==null?t.Et():null,this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return this.j!==null?this.j.Zp:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this.Hi().Zp=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get rotationSpot(){return this.j!==null?this.j.Qp:U.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.P(),this.Hi().Qp=t,this.t("rotationSpot",i,t))}get text(){return this.ri}set text(t){const i=this.ri;i!==t&&(this.ri=t,this.t("text",i,t))}get containingGroup(){return this.xh}set containingGroup(t){if(this.ke()){const i=this.xh;if(i!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&u.o("Cannot make a Group a member of itself: "+this.toString()),u.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const s=this.diagram;if(i!==null?i.eN(this):this instanceof Nt&&s!==null&&s.zr.delete(this),this.xh=t,t!==null?t.sN(this):this instanceof Nt&&s!==null&&s.zr.add(this),this.invalidateLayout(1),s!==null&&s.X){const o=this.data,r=s.model;if(o!==null&&r.Hc()){const a=t!==null?t.data:null;r.setGroupForData(o,r.getKeyForNodeData(a))}}const n=this.containingGroupChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this,i,t),s!==null&&(s.X=o)}if(this instanceof Nt){const o=new I;ue.oh(o,this,!0,0,!0);const r=o.iterator;for(;r.next();){const a=r.value;if(a instanceof gt){const h=a.linksConnected;for(;h.next();)h.value.Pd()}}}if(this instanceof gt){const o=this.linksConnected;for(;o.next();)o.value.Pd();const r=this.labeledLink;r!==null&&r.Pd()}this.t("containingGroup",i,t),t!==null&&t.eO()}}else u.o("cannot set the Part.containingGroup of a Link or Adornment")}dh(){var i;const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&((i=t.placeholder)==null||i.c()),t.c(),t.invalidateConnectedLinks())}S(){const t=this.diagram;t!==null&&!this._e()&&!this.ih()&&this.isVisible()&&this.Ni.isReal()&&t.S(this.Wh(this.Ni))}c(){if(this.To())return;super.c();const t=this.diagram;t!==null&&(t.t0(this),this instanceof gt&&this.labeledLink!==null&&this.labeledLink.ef(),t.requestUpdate(!0))}ef(t){if(this._e())return;const i=this.diagram;i!==null&&(i.t0(this),this instanceof gt&&this.invalidateConnectedLinks(),i.requestUpdate()),this.Jn(!0)}Rm(t){if(!t){const i=this.xh;i!==null&&i.sN(this)}}vm(t){if(!t){const i=this.xh;i!==null&&i.eN(this)}}Xc(){const t=this.data;if(t!==null){const i=this.diagram;if(i!==null){const s=i.model;s!==null&&s.removeNodeData(t)}}}get containingGroupChanged(){return this.j!==null?this.j._p:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(t!==null&&u.k(t,ue,"containingGroupChanged"),this.Hi()._p=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.nN(this)}nN(t){const i=t.containingGroup;if(i!==null)return 1+this.nN(i);if(t instanceof gt){const s=t.labeledLink;if(s!==null)return this.nN(s)}return 0}findTopLevelPart(){return this.oN(this)}oN(t){const i=t.containingGroup;if(i!==null)return this.oN(i);if(t instanceof gt){const s=t.labeledLink;if(s!==null)return this.oN(s)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof gt&&this.labeledLink!==null)}isMemberOf(t){return t instanceof Nt?this.rN(this,t):!1}rN(t,i){if(t===i||i===null)return!1;const s=t.containingGroup;if(s!==null&&(s===i||this.rN(s,i)))return!0;if(t instanceof gt){const n=t.labeledLink;if(n!==null)return this.rN(n,i)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let i=this;for(;i!==null;){if(i instanceof Nt&&i.m1(!0),i instanceof gt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}let s=null;for(i=t;i!==null;){if(i.uT()){s=i;break}if(i instanceof gt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}for(i=this;i!==null;){if(i instanceof Nt&&i.m1(!1),i instanceof gt){const n=i.labeledLink;n!==null&&(i=n)}i=i.containingGroup}return s}get layoutConditions(){return this.j!==null?this.j.ty:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this.Hi().ty=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof gt&&this.isLinkLabel)}rO(t){if(!this.isLayoutPositioned||!(t&this.layoutConditions))return!1;const i=this.layer;if(i!==null&&i.isTemporary||this instanceof gt&&this.isLinkLabel)return!1;const s=this.diagram;return!(s!==null&&s.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.rO(t))return;const i=this.xh;if(i!==null){const s=i.layout;s!==null?s.invalidateLayout():i.invalidateLayout(t)}else{const s=this.diagram;if(s!==null){const n=s.layout;n!==null&&n.invalidateLayout()}}}jL(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static oh(t,i,s,n,o,r){if(r===void 0&&(r=null),!t.has(i)&&!(r!==null&&!r(i))&&!(i instanceof Ft)){if(t.add(i),i instanceof gt){if(s&&i instanceof Nt){const a=i.memberParts;for(;a.next();){const h=a.value;ue.oh(t,h,s,n,o,r)}}if(o!==!1){const a=i.linksConnected;for(;a.next();){const h=a.value;if(t.has(h))continue;const l=h.fromNode,c=h.toNode,d=l===null||t.has(l),f=c===null||t.has(c);(o?d&&f:d||f)&&ue.oh(t,h,s,n,o,r)}}if(n>1){const a=i.findTreeChildrenNodes();for(;a.next();){const h=a.value;ue.oh(t,h,s,n-1,o,r)}}}else if(i instanceof St){const a=i.labelNodes;for(;a.next();){const h=a.value;ue.oh(t,h,s,n,o,r)}}}}get dragComputation(){return this.j!==null?this.j.iy:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(t!==null&&u.k(t,ue,"dragComputation"),this.Hi().iy=t,this.t("dragComputation",i,t))}get shadowOffset(){return this.j!==null?this.j.ey:C.pC}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.P(),this.Hi().ey=t,this.S(),this.t("shadowOffset",i,t))}get shadowColor(){return this.j!==null?this.j.ny:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this.Hi().ny=t,this.S(),this.t("shadowColor",i,t))}get shadowBlur(){return this.j!==null?this.j.un:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this.Hi().un=t,this.S(),this.t("shadowBlur",i,t))}};g(ue,"LayoutNone",0),g(ue,"LayoutAdded",1),g(ue,"LayoutRemoved",2),g(ue,"LayoutShown",4),g(ue,"LayoutHidden",8),g(ue,"LayoutNodeSized",16),g(ue,"LayoutGroupLayout",32),g(ue,"LayoutNodeReplaced",64),g(ue,"LayoutStandard",127),g(ue,"LayoutAll",16777215),g(ue,"fT",!1);let Ht=ue;class Io{constructor(){g(this,"fi");g(this,"Bp");g(this,"_p");g(this,"jp");g(this,"Kp");g(this,"Hp");g(this,"Gp");g(this,"qp");g(this,"Wp");g(this,"Jp");g(this,"$p");g(this,"Zp");g(this,"Qp");g(this,"Xp");g(this,"Yp");g(this,"Vp");g(this,"zp");g(this,"iy");g(this,"ty");g(this,"ey");g(this,"ny");g(this,"un");this.fi=!1,this.Bp=null,this._p=null,this.jp=null,this.Kp="",this.Hp=null,this.Gp=null,this.qp=null,this.Wp="",this.Jp=rt.ww,this.$p=null,this.Zp="",this.Qp=U.Default,this.Xp="",this.Yp=U.TopLeft,this.Vp=C.gC,this.zp=C.mC,this.iy=null,this.ty=127,this.ey=C.pC,this.ny="gray",this.un=4}copy(){const e=new Io;return e.Bp=this.Bp,e._p=this._p,e.jp=this.jp,e.Kp=this.Kp,e.Hp=this.Hp,e.Gp=this.Gp,e.qp=this.qp,e.Wp=this.Wp,e.Jp=this.Jp.P(),e.$p=this.$p,e.Zp=this.Zp,e.Qp=this.Qp.P(),e.Xp=this.Xp,e.Yp=this.Yp.P(),e.Vp=this.Vp.P(),e.zp=this.zp.P(),e.iy=this.iy,e.ty=this.ty,e.ey=this.ey.P(),e.ny=this.ny,e.un=this.un,e}}class Ft extends Ht{constructor(t,i){let s;t===void 0||t instanceof Yt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"us");g(this,"Ft");g(this,"nS");g(this,"oS");g(this,"hf");this.w&=-257,this.nl="Adornment",this.us=null,this.nS=0,this.oS=!1,this.Ft=null,this.hf=null,i&&Object.assign(this,i)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}sd(t){const i=this.adornedObject;if(!(i instanceof At))return;const s=i.part;if(!(s instanceof St))return;const n=s.path;let o=n.geometry;s.sd(t),o=n.geometry;const r=this.C.r,a=r.length;for(let h=0;h<a;h++){const l=r[h];l.isPanelMain&&l instanceof At&&(l.ot=o)}}hasPlaceholder(){return this.Ft!==null&&this.Ft.isVisibleObject()}get placeholder(){return this.Ft}get adornedObject(){return this.us}set adornedObject(t){const i=this.adornedPart;let s=null;t!==null&&(s=t.part),i!==null&&(t===null||i!==s)&&i.removeAdornment(this.category),this.us=t,s!==null&&s.addAdornment(this.category,this)}get adornedPart(){const t=this.us;return t!==null?t.part:null}Yr(){const t=this.us;if(t===null)return!0;const i=t.part;return i===null||!i._e()}ke(){return!1}get containingGroup(){return null}qc(t,i,s,n,o,r,a){if(t===3&&i==="elements"){if(o instanceof si)this.Ft===null&&(this.Ft=o);else if(o instanceof bt){const h=o.findInVisualTree(l=>l instanceof si);h instanceof si&&this.Ft===null&&(this.Ft=h)}}else t===4&&i==="elements"&&this.Ft!==null&&(n===this.Ft?this.Ft=null:n instanceof bt&&this.Ft.isContainedBy(n)&&(this.Ft=null));super.qc(t,i,s,n,o,r,a)}updateAdornments(){}Xc(){}}var ga=(S=>(S[S.None=0]="None",S[S.Evenly=1]="Evenly",S[S.Packed=2]="Packed",S))(ga||{});const bi=class bi extends Ht{constructor(t,i){let s;t===void 0||t instanceof Yt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"v");g(this,"Rt");g(this,"kf");g(this,"rl");g(this,"bh");g(this,"ne");g(this,"ti");this.v=13,this.Rt=null,this.ti=new Y,this.kf=null,this.rl=null,this.ne=null,this.bh=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.v=this.v,this.Rt!==null&&(this.Rt.fi?t.Rt=this.Rt:t.Rt=this.Rt.copy())}vo(t){super.vo(t),t.invalidateConnectedLinks(),t.rl=this.rl,t.ne=null}ll(){return this.Rt===null?this.Rt=new Bo:this.Rt.fi&&(this.Rt=this.Rt.copy()),this.Rt}ch(){super.ch(),this.Rt!==null&&(this.Rt.fi=!0)}dT(t){t!==null&&(this.rl===null&&(this.rl=new I),this.rl.add(t))}gT(t){t!==null&&this.rl!==null&&this.rl.delete(t)}mT(t,i,s){if(t===null||this.rl===null)return null;const n=this.rl.iterator;for(;n.next();){const o=n.value;if(o.ly===this&&o.p1===t&&o.lN===i&&o.hN===s||o.ly===t&&o.p1===this&&o.lN===s&&o.hN===i)return o}return null}invalidateLinkBundle(t,i,s){i==null&&(i=""),s==null&&(s="");const n=this.mT(t,i,s);n!==null&&n.Sd()}qc(t,i,s,n,o,r,a){t===3&&i==="elements"?this.ne=null:t===4&&i==="elements"&&(this.ne=null),super.qc(t,i,s,n,o,r,a)}invalidateConnectedLinks(t){const i=this.linksConnected;for(;i.next();){const s=i.value;t!==void 0&&t.has(s)||(this.qi(s.fromPort),this.qi(s.toPort),s.invalidateRoute())}}bA(t){const i=this.linksConnected;for(;i.next();){const s=i.value;s.fromPort!==t&&s.toPort!==t||(this.qi(s.fromPort),this.qi(s.toPort),s.invalidateRoute())}}qi(t){if(t===null)return;const i=t.Ku;i!==null&&i.Sd();const s=t.part,n=s.containingGroup;n!==null&&!s.isVisible()&&n.qi(n.port)}Yr(){return!0}get portSpreading(){return this.Rt!==null?this.Rt.hy:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.ll().hy=t,this.t("portSpreading",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.v&8)!==0}set avoidable(t){const i=(this.v&8)!==0;if(i!==t){this.v=this.v^8;const s=this.diagram;s!==null&&s.JM(this),this.t("avoidable",i,t)}}get avoidableMargin(){return this.Rt!==null?this.Rt.ay:wt.PC}set avoidableMargin(t){typeof t=="number"&&(t=new wt(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.P(),this.ll().ay=t;const s=this.diagram;s!==null&&s.JM(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const s=this.diagram;if(s!==null){if(s.animationManager.hx(this))return!0;t=s.isTreePathToChildren,i=s.treeCollapsePolicy}if(i===1){const o=this.findTreeParentNode();if(o!==null&&!o.isTreeExpanded)return!1}else if(i===2){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){r=!0;const l=t?h.fromNode:h.toNode;if(l&&l.isTreeExpanded){a=!0;break}}}if(r&&!a)return!1}else if(i===3){const o=t?this.findLinksInto():this.findLinksOutOf();let r=!1,a=!1;for(;o.next();){const h=o.value;if(h.isTreeLink){r=!0;const l=t?h.fromNode:h.toNode;if(l&&!l.isTreeExpanded){a=!0;break}}}if(r&&a)return!1}const n=this.labeledLink;return n!==null?n.isVisible():!0}Ei(t){super.Ei(t);const i=this.linksConnected;for(;i.next();){const s=i.value;if(t&&this.containingGroup!==null){const n=s.getOtherNode(this);n!==null&&!n.isMemberOf(this.containingGroup)&&s.invalidateRoute()}s.Ei(t)}}get linksConnected(){return this.ti.iterator}findExternalTreeLinksConnected(){const t=new I,i=new I;return this.pT(this,t,i),i.iterator}pT(t,i,s){if(t===null||i.has(t))return;i.add(t);let n=!0;const o=this.diagram;o!==null&&(n=o.isTreePathToChildren),t.linksConnected.each(r=>{r.isTreeLink?(n?r.fromNode===t:r.toNode===t)&&this.pT(n?r.toNode:r.fromNode,i,s):s.add(r)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ti.iterator;const i=new j(this.ti),s=this;return i.predicate=n=>n.fromNode===s&&n.fromPortId===t||n.toNode===s&&n.toPortId===t,i}findLinksOutOf(t){t===void 0&&(t=null);const i=new j(this.ti),s=this;return i.predicate=n=>n.fromNode!==s?!1:t===null?!0:n.fromPortId===t,i}findLinksInto(t){t===void 0&&(t=null);const i=new j(this.ti),s=this;return i.predicate=n=>n.toNode!==s?!1:t===null?!0:n.toPortId===t,i}findNodesConnected(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this){if(t===null||o.fromPortId===t){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new I,i.add(s),i.add(r)):s=r}}else if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new I,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new z(s):A.instance}findNodesOutOf(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.fromNode===this&&(t===null||o.fromPortId===t)){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new I,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new z(s):A.instance}findNodesInto(t){t===void 0&&(t=null);let i=null,s=null;const n=this.ti.iterator;for(;n.next();){const o=n.value;if(o.toNode===this&&(t===null||o.toPortId===t)){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new I,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new z(s):A.instance}findLinksBetween(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new j(this.ti),o=this;return n.predicate=r=>r.fromNode===o&&r.toNode===t&&(i===null||r.fromPortId===i)&&(s===null||r.toPortId===s)||r.fromNode===t&&r.toNode===o&&(s===null||r.fromPortId===s)&&(i===null||r.toPortId===i),n}findLinksTo(t,i,s){i===void 0&&(i=null),s===void 0&&(s=null);const n=new j(this.ti),o=this;return n.predicate=r=>!(r.fromNode!==o||r.toNode!==t||i!==null&&r.fromPortId!==i||s!==null&&r.toPortId!==s),n}get linkConnected(){return this.Rt!==null?this.Rt.cy:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(t!==null&&u.k(t,bi,"linkConnected"),this.ll().cy=t,this.t("linkConnected",i,t))}get linkDisconnected(){return this.Rt!==null?this.Rt.fy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(t!==null&&u.k(t,bi,"linkDisconnected"),this.ll().fy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return this.Rt!==null?this.Rt.Ml:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(t!==null&&u.k(t,bi,"linkValidation"),this.ll().Ml=t,this.t("linkValidation",i,t))}w1(t,i){this.qi(i);const s=this.ti.has(t);if(s||this.ti.add(t),!s||t.fromNode===t.toNode){const n=this.linkConnected;if(n!==null){let o=!0;const r=this.diagram;r!==null&&(o=r.X,r.X=!0),n(this,t,i),r!==null&&(r.X=o)}}if(!s){if(!t.isTreeLink)return;const n=t.fromNode,o=t.toNode;if(n!==null&&o!==null&&n!==o){let r=!0;const a=this.diagram;a!==null&&(r=a.isTreePathToChildren);const h=r?o:n,l=r?n:o;if(h.bh||(h.bh=l),l.isTreeLeaf){if(a!==null&&a.undoManager.isUndoingRedoing)return;r?n===l&&(l.isTreeLeaf=!1):o===l&&(l.isTreeLeaf=!1)}}}}b1(t,i){this.qi(i);const s=this.ti.delete(t);let n=null;if(s||t.toNode===t.fromNode){const o=this.linkDisconnected;if(n=this.diagram,o!==null){let r=!0;n!==null&&(r=n.X,n.X=!0),o(this,t,i),n!==null&&(n.X=r)}}if(s){if(!t.isTreeLink)return;let o=!0;n!==null&&(o=n.isTreePathToChildren);const r=o?t.toNode:t.fromNode,a=o?t.fromNode:t.toNode;if(r!==null&&(r.bh=!1),a!==null&&!a.isTreeLeaf)if(a.ti.count===0){if(a.bh=null,n!==null&&n.undoManager.isUndoingRedoing)return;a.isTreeLeaf=!0}else a.l0()}}l0(){if(this.bh=!1,this.ti.count===0)return;let t=!0;const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;i!==null&&(t=i.isTreePathToChildren);const s=this.ti.iterator;for(;s.next();){const n=s.value;if(n.isTreeLink){if(t){if(n.fromNode===this){this.isTreeLeaf=!1;return}}else if(n.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}Rm(t){if(super.Rm(t),!t){this.l0();const i=this.kf;i!==null&&i.yT(this)}}vm(t){if(super.vm(t),!t){const i=this.kf;i!==null&&i.wT(this)}}Xc(){if(this.ti.count>0){const t=this.diagram;if(t!==null){const i=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this.ti.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.Xc()}get isLinkLabel(){return this.kf!==null}get labeledLink(){return this.kf}set labeledLink(t){const i=this.kf;if(i!==t){const s=this.diagram,n=this.data;if(i!==null){if(i.wT(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=i.data,r=s.model;if(o!==null&&r.Ra()){const a=r.getKeyForNodeData(n);a!==void 0&&r.removeLabelKeyForLinkData(o,a)}}this.containingGroup=null}if(this.kf=t,t!==null){if(t.yT(this),s!==null&&n!==null&&!s.undoManager.isUndoingRedoing){const o=t.data,r=s.model;if(o!==null&&r.Ra()){const a=r.getKeyForNodeData(n);a!==void 0&&r.addLabelKeyForLinkData(o,a)}}this.containingGroup=t.containingGroup}this.ef(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;i!==null&&(!i.actualBounds.isReal()||!i.isVisibleObject());)i=i.panel;return i===null?this.port:i}findPort(t){if(this.ne===null){if(t===""&&this.fn===!1)return this;this.xT()}let i=this.ne.get(t);return i!==null||t!==""&&(i=this.ne.get(""),i!==null)?i:this}get port(){return this.findPort("")}get ports(){return this.ne===null&&this.xT(),this.ne.iteratorValues}xT(){this.ne===null?this.ne=new Z:this.ne.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.LA(i)),this.ne.count===0&&this.ne.set("",this)}LA(t){const i=t.portId;i!==null&&this.ne!==null&&this.ne.set(i,t)}C2(t,i){const s=t.portId;if(s!==null){this.ne!==null&&this.ne.delete(s);const n=this.diagram;if(n!==null&&i){let o=null;const r=this.findLinksConnected(s);for(;r.next();){const a=r.value;o===null&&(o=u.et()),o.push(a)}if(o!==null){for(let a=0;a<o.length;a++){const h=o[a];n.remove(h)}u.J(o)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);let n=this;const o=t;let r;if(i)for(;n!==o;){r=null;const a=n.ti.iterator;for(;a.next();){const h=a.value;if(h.isTreeLink&&(r=h.fromNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}else for(;n!==o;){r=null;const a=n.ti.iterator;for(;a.next();){const h=a.value;if(h.isTreeLink&&(r=h.toNode,r!==n&&r!==this))break}if(r===this||r===null||r===n)return!1;n=r}return!0}findTreeRoot(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=this,n;if(t)for(;;){n=null;const o=s.ti.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.fromNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}else for(;;){n=null;const o=s.ti.iterator;for(;o.next();){const r=o.value;if(r.isTreeLink&&(n=r.toNode,n!==s&&n!==this))break}if(n===this)return this;if(n===null||n===s)return s;s=n}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let i=this;for(;i!==null;)i.m1(!0),i=i.findTreeParentNode();let s=null;for(i=t;i!==null;){if(i.uT()){s=i;break}i=i.findTreeParentNode()}for(i=this;i!==null;)i.m1(!1),i=i.findTreeParentNode();return s}findTreeParentLink(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=this.ti.iterator;if(t)for(;s.next();){const n=s.value;if(n.isTreeLink&&n.fromNode!==this)return n}else for(;s.next();){const n=s.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){const t=this.bh;if(t===null)return null;if(t instanceof bi)return t;const i=this.diagram,s=i!==null?i.isTreePathToChildren:!0,n=this.ti.iterator;for(;n.next();){const o=n.value;if(!o.isTreeLink)continue;const r=s?o.fromNode:o.toNode;if(r!==this)return this.bh=r,r}return this.bh=null,null}findTreeParentChain(){function t(s,n){n.add(s);const o=s.findTreeParentLink();if(o!==null){n.add(o);const r=s.findTreeParentNode();if(r===null)return;t(r,n)}}const i=new I;return t(this,i),i}findTreeLevel(){return this.lO(this)}lO(t){let i=0,s=t.findTreeParentNode();for(;s!==null&&s!==t;)s=s.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const s=new j(this.ti),n=this;return t?s.predicate=o=>!(!o.isTreeLink||o.fromNode!==n):s.predicate=o=>!(!o.isTreeLink||o.toNode!==n),s}findTreeChildrenNodes(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let s=null,n=null;const o=this.ti.iterator;if(t)for(;o.next();){const r=o.value;if(r.isTreeLink&&r.fromNode===this){const a=r.toNode;s!==null?s.add(a):n!==null&&n!==a?(s=new Y,s.add(n),s.add(a)):n=a}}else for(;o.next();){const r=o.value;if(r.isTreeLink&&r.toNode===this){const a=r.fromNode;s!==null?s.add(a):n!==null&&n!==a?(s=new Y,s.add(n),s.add(a)):n=a}}return s!==null?s.iterator:n!==null?new z(n):A.instance}findTreeParts(t){t===void 0&&(t=1/0),u.s(t,"number",bi,"findTreeParts:level");const i=new I;return Ht.oh(i,this,!1,t,!0),i}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new I;s.add(this),this.bT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}bT(t,i,s,n,o,r){if(s>1){const a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const h=a.value;if(!h.isTreeLink)continue;const l=h.getOtherNode(this);l!==null&&l!==this&&!t.has(l)&&(t.add(l),l.bT(t,i,s-1,n,o,r))}}else this.kT(t,i,n,o,r)}kT(t,i,s,n,o){const r=n===this?!0:this.isTreeExpanded,a=i?this.findLinksOutOf():this.findLinksInto();for(;a.next();){const h=a.value;if(!h.isTreeLink)continue;const l=h.getOtherNode(this);if(l!==null&&l!==this){const c=t.has(l);if(c||t.add(l),r){const d=i?l.findNodesInto():l.findNodesOutOf(),f=this;d.all(m=>m===f||!m.isTreeExpanded)&&s.Lc(l,n),l.dh(),l.Ei(!1)}l.isTreeExpanded&&(l.wasTreeExpanded=l.isTreeExpanded,c||l.kT(t,i,s,n,o))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const s=new I;s.add(this),this.PT(s,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}PT(t,i,s,n,o,r){const a=o===this?!1:this.isTreeExpanded,h=i?this.findLinksOutOf():this.findLinksInto();for(;h.next();){const l=h.value;if(!l.isTreeLink)continue;a||l.Se||l.invalidateRoute();const c=l.getOtherNode(this);if(c!==null&&c!==this&&!t.has(c)){if(t.add(c),!a){c.Ei(!0),c.dh();const d=i?c.findNodesInto():c.findNodesOutOf(),f=this;d.all(m=>m===f||!m.isTreeExpanded)&&n.Cc(c,o)}(s>2||c.wasTreeExpanded)&&(c.wasTreeExpanded=!1,c.PT(t,i,s-1,n,o,r))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.v&1)!==0}set isTreeExpanded(t){const i=(this.v&1)!==0;if(i!==t){this.v=this.v^1;const s=this.diagram;this.t("isTreeExpanded",i,t);const n=this.treeExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this),s!==null&&(s.X=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Ei(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.v&2)!==0}set wasTreeExpanded(t){const i=(this.v&2)!==0;i!==t&&(this.v=this.v^2,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return this.Rt!==null?this.Rt.uy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(t!==null&&u.k(t,bi,"treeExpandedChanged"),this.ll().uy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return(this.v&4)!==0}set isTreeLeaf(t){const i=(this.v&4)!==0;i!==t&&(this.v=this.v^4,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return this.findTreeParentLink()===null}};g(bi,"SpreadingNone",0),g(bi,"SpreadingEvenly",1),g(bi,"SpreadingPacked",2);let gt=bi;class Bo{constructor(){g(this,"fi");g(this,"cy");g(this,"fy");g(this,"Ml");g(this,"uy");g(this,"ay");g(this,"hy");g(this,"gy");g(this,"my");g(this,"nh");g(this,"yy");this.fi=!1,this.cy=null,this.fy=null,this.Ml=null,this.uy=null,this.ay=wt.PC,this.hy=1,this.gy=null,this.my=null,this.nh=null,this.yy=null}copy(){const e=new Bo;return e.cy=this.cy,e.fy=this.fy,e.Ml=this.Ml,e.uy=this.uy,e.ay=this.ay.P(),e.hy=this.hy,e.gy=this.gy,e.my=this.my,e.nh=this.nh,e.yy=this.yy,e}}var Vo=(S=>(S[S.None=0]="None",S[S.End=17]="End",S[S.Scale=18]="Scale",S[S.Stretch=19]="Stretch",S))(Vo||{}),zo=(S=>(S[S.Normal=1]="Normal",S[S.Orthogonal=2]="Orthogonal",S[S.AvoidsNodes=6]="AvoidsNodes",S[S.AvoidsNodesStraight=7]="AvoidsNodesStraight",S))(zo||{}),jo=(S=>(S[S.None=0]="None",S[S.Bezier=9]="Bezier",S[S.JumpGap=10]="JumpGap",S[S.JumpOver=11]="JumpOver",S))(jo||{});const Bt=class Bt extends Ht{constructor(t){super(bt.Link);g(this,"Nt");g(this,"so");g(this,"no");g(this,"Md");g(this,"oo");g(this,"ro");g(this,"Nd");g(this,"Pf");g(this,"Cd");g(this,"Ld");g(this,"Ad");g(this,"va");g(this,"Td");g(this,"js");g(this,"xi");g(this,"hl");g(this,"br");g(this,"Sf");g(this,"Ko");g(this,"aN");g(this,"cN");g(this,"k1");g(this,"fN");g(this,"uN");g(this,"Oa");g(this,"P1");g(this,"ot");g(this,"jo");g(this,"hf");g(this,"dN");g(this,"gN");this.Nt=8,this.so=null,this.no="",this.Md=null,this.oo=null,this.ro="",this.Nd=null,this.Pf=0,this.Cd=0,this.Ld=0,this.Ad=NaN,this.va=1,this.Td=.5,this.js=null,this.xi=new Y().u(),this.hl=null,this.br=null,this.Sf=new G,this.ot=new Tt,this.Ko=null,this.jo=null,this.aN=null,this.cN=null,this.dN=0,this.gN=0,this.k1=new C,this.fN=null,this.uN=null,this.Oa=null,this.P1=NaN,this.ct=null,this.hf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Nt=this.Nt&-113,t.no=this.no,t.Md=this.Md,t.ro=this.ro,t.Nd=this.Nd,t.Pf=this.Pf,t.Cd=this.Cd,t.Ld=this.Ld,t.Ad=this.Ad,t.va=this.va,t.Td=this.Td,this.ct!==null&&(t.ct=this.ct.copy())}vo(t){super.vo(t),this.no=t.no,this.ro=t.ro,t.hl=null,t.invalidateRoute(),t.jo=this.jo;const i=t.fromPort;i!==null&&t.fromNode.qi(i);const s=t.toPort;s!==null&&t.toNode.qi(s)}oi(t){t in zo||t in jo||t in Vo?Bt.mN(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||u.o("Unknown Link enum value for a Link property: "+t):super.oi(t)}Be(){return this.ct===null&&(this.ct=new jn),this.ct}bv(t,i,s){const n=t.segmentIndex,o=t.segmentFraction;let r=t.alignmentFocus;const a=t.segmentOrientation,h=t.segmentOffset;let l=0,c=0,d=0,f=0;if(isNaN(n)){const E=this.ot,R=u.et();E.getPointAndAngleAlongPath(o,R);const F=C.V(R[0],R[1]);if(F.add(this.getPoint(0)),E.type===1)F.offset(-E.startX,-E.startY);else{const V=E.figures.first();F.offset(-V.startX,-V.startY)}f=R[2],a!==0&&(d=this.computeAngle(t,a,f),t.angle=d),l=F.x,c=F.y,C.e(F),u.J(R)}else if(n<-i||n>=i){const E=C.l();this.OA(E),f=this.midAngle,a!==0&&(d=this.computeAngle(t,a,f),t.angle=d),l=E.x,c=E.y,C.e(E)}else{let E,R,F=0;if(n>=0?(E=s.r[n],R=n<i-1?s.r[n+1]:E):(F=i+n,E=s.r[F],R=F>0?s.r[F-1]:E),E.equalsApprox(R)){let V,K;n>=0?(V=n>0?s.r[n-1]:E,K=n<i-2?s.r[n+2]:R):(V=F<i-1?s.r[F+1]:E,K=F>1?s.r[F-2]:R);const H=V.distanceSquaredPoint(E),W=R.distanceSquaredPoint(K);H>W+10?f=n>=0?V.directionPoint(E):E.directionPoint(V):W>H+10?f=n>=0?R.directionPoint(K):K.directionPoint(R):f=n>=0?V.directionPoint(K):K.directionPoint(V)}else f=n>=0?E.directionPoint(R):R.directionPoint(E);a!==0&&(d=this.computeAngle(t,a,f),t.angle=d),l=E.x+(R.x-E.x)*o,c=E.y+(R.y-E.y)*o}if(r.isNone()){t.location=new C(l,c);return}else r.isNoSpot()&&(r=U.Center);const m=Pt.l();m.Ri(),m.tt(t.scale,t.scale),m.cs(t.angle,0,0);const p=t.naturalBounds,y=G.V(0,0,p.width,p.height),x=C.l();x.setRectSpot(y,r),m.gt(x);let b=-x.x,M=-x.y;const P=p.width,k=p.height,L=C.l();L.a(h);const T=isNaN(h.x),D=isNaN(h.y);if(T||D){const E=P/2+3,R=k/2+3,F=f>=45&&f<=135,V=f>=225&&f<=315;a===0&&(F||V)?(L.x=D?E:h.y,L.y=T?R:h.x,F?n>=0||isNaN(n)&&o<.5||T&&(L.y=-R):V&&((n>=0||isNaN(n)&&o<.5)&&T&&(L.y=-R),D&&(L.x=-E))):(T&&(n>=0||isNaN(n)&&o<.5?L.x=E:L.x=-E),D&&(L.y=-R),L.rotate(f))}else L.rotate(f);l+=L.x,c+=L.y,m.vg(y),b+=y.x,M+=y.y;const B=C.V(l+b,c+M);t.move(B),C.e(B),C.e(L),C.e(x),G.e(y),Pt.e(m)}Yr(){let t=this.fromNode;if(t!==null){const s=t.findVisibleNode();if(s!==null&&(t=s),t._e()||t.ih())return!1}let i=this.toNode;if(i!==null){const s=i.findVisibleNode();if(s!==null&&(i=s),i._e()||i.ih())return!1}return!0}M2(t,i,s){return!1}N2(){}ke(){return!1}computeAngle(t,i,s){return Bt.computeAngle(i,s)}static computeAngle(t,i){let s=0;switch(t){default:case 0:s=0;break;case 21:s=i;break;case 22:s=i+90;break;case 23:s=i-90;break;case 24:s=i+180;break;case 25:s=O.Ug(i),s>90&&s<270&&(s-=180);break;case 26:s=O.Ug(i+90),s>90&&s<270&&(s-=180);break;case 27:s=O.Ug(i-90),s>90&&s<270&&(s-=180);break;case 28:if(s=O.Ug(i),s>45&&s<135||s>225&&s<315)return 0;s>90&&s<270&&(s-=180);break}return O.Ug(s)}get fromNode(){return this.so}set fromNode(t){const i=this.so;if(i!==t){const s=this.fromPort;i!==null&&(this.oo!==i&&i.b1(this,s),this.wy(),this.invalidateLayout(2)),this.so=t,t!==null&&this.Ei(t.isVisible()),this.Ko=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.X&&n.partManager.setFromNodeForLink(this,t,i);const o=this.fromPort,r=this.fromPortChanged;if(r!==null){let a=!0;n!==null&&(a=n.X,n.X=!0),r(this,s,o),n!==null&&(n.X=a)}t!==null&&(this.oo!==t&&t.w1(this,o),this.xy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Pd()}}get fromPortId(){return this.no}set fromPortId(t){var s,n;const i=this.no;if(i!==t){const o=this.fromPort;o!==null&&((s=this.fromNode)==null||s.qi(o)),this.wy(),this.no=t;const r=this.fromPort;r!==null&&((n=this.fromNode)==null||n.qi(r));const a=this.diagram;if(a!==null){const h=this.data,l=a.model;h!==null&&l.Ra()&&l.setFromPortIdForLinkData(h,t)}if(o!==r){this.Ko=null,this.invalidateRoute();const h=this.fromPortChanged;if(h!==null){let l=!0;a!==null&&(l=a.X,a.X=!0),h(this,o,r),a!==null&&(a.X=l)}}this.xy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.so;if(t===null)return null;const i=this.no;return t.findPort(i)}get fromPortChanged(){return this.Md}set fromPortChanged(t){const i=this.Md;i!==t&&(t!==null&&u.k(t,Bt,"fromPortChanged"),this.Md=t,this.t("fromPortChanged",i,t))}get toNode(){return this.oo}set toNode(t){const i=this.oo;if(i!==t){const s=this.toPort;i!==null&&(this.so!==i&&i.b1(this,s),this.wy(),this.invalidateLayout(2)),this.oo=t,t!==null&&this.Ei(t.isVisible()),this.Ko=null,this.invalidateRoute();const n=this.diagram;n!==null&&n.X&&n.partManager.setToNodeForLink(this,t,i);const o=this.toPort,r=this.toPortChanged;if(r!==null){let a=!0;n!==null&&(a=n.X,n.X=!0),r(this,s,o),n!==null&&(n.X=a)}t!==null&&(this.so!==t&&t.w1(this,o),this.xy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Pd()}}get toPortId(){return this.ro}set toPortId(t){var s,n;const i=this.ro;if(i!==t){const o=this.toPort;o!==null&&((s=this.toNode)==null||s.qi(o)),this.wy(),this.ro=t;const r=this.toPort;r!==null&&((n=this.toNode)==null||n.qi(r));const a=this.diagram;if(a!==null){const h=this.data,l=a.model;h!==null&&l.Ra()&&l.setToPortIdForLinkData(h,t)}if(o!==r){this.Ko=null,this.invalidateRoute();const h=this.toPortChanged;if(h!==null){let l=!0;a!==null&&(l=a.X,a.X=!0),h(this,o,r),a!==null&&(a.X=l)}}this.xy(),this.t("toPortId",i,t)}}get toPort(){const t=this.oo;if(t===null)return null;const i=this.ro;return t.findPort(i)}get toPortChanged(){return this.Nd}set toPortChanged(t){const i=this.Nd;i!==t&&(t!==null&&u.k(t,Bt,"toPortChanged"),this.Nd=t,this.t("toPortChanged",i,t))}get fromSpot(){return this.ct!==null?this.ct.ga:U.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.P(),this.Be().ga=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const s=this.fromNode;s!==null&&s.qi(this.fromPort)}this.invalidateRoute()}}get fromEndSegmentLength(){return this.ct!==null?this.ct.pa:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&u.W(t,">= 0",Bt,"fromEndSegmentLength"),this.Be().pa=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const s=this.fromNode;s!==null&&s.qi(this.fromPort)}this.invalidateRoute()}}get fromShortLength(){return this.ct!==null?this.ct.wa:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Be().wa=t,this.ee(),this.t("fromShortLength",i,t))}get toSpot(){return this.ct!==null?this.ct.ma:U.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.P(),this.Be().ma=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const s=this.toNode;s!==null&&s.qi(this.toPort)}this.invalidateRoute()}}get toEndSegmentLength(){return this.ct!==null?this.ct.ya:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&u.W(t,">= 0",Bt,"toEndSegmentLength"),this.Be().ya=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const s=this.toNode;s!==null&&s.qi(this.toPort)}this.invalidateRoute()}}get toShortLength(){return this.ct!==null?this.ct.xa:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Be().xa=t,this.ee(),this.t("toShortLength",i,t))}Pd(){const t=this.fromNode,i=this.toNode;let s=null;if(t!==null?i!==null?s=t.findCommonContainingGroup(i):s=t.containingGroup:i!==null?s=i.containingGroup:s=null,this.fO(s),this.isLabeledLink){const n=this.labelNodes;for(;n.next();){const o=n.value;o.containingGroup=s}}}fO(t){const i=this.xh;if(i!==t){i!==null&&i.eN(this),this.xh=t,t!==null&&t.sN(this);const s=this.containingGroupChanged;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,i,t),o!==null&&(o.X=n)}this.Se&&(this.fN===i||this.uN===i)&&this.invalidateRoute()}}dh(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.dh()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return this.js===null?!1:this.js.count>0}get labelNodes(){return this.js===null?A.instance:this.js.iterator}yT(t){this.js===null&&(this.js=new I),this.js.add(t),this.c()}wT(t){this.js!==null&&(this.js.delete(t),this.c())}Rm(t){if(super.Rm(t),this.Ba()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.so;let s=null;i!==null&&(s=this.fromPort,i.w1(this,s));const n=this.oo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.w1(this,o)),this.xy()}}vm(t){if(super.vm(t),this.Ba()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.so;let s=null;i!==null&&(s=this.fromPort,i.b1(this,s));const n=this.oo;let o=null;n!==null&&(o=this.toPort,(n!==i||o!==s)&&n.b1(this,o)),this.wy()}}Xc(){if(this.Se=!0,this.js!==null){const t=this.diagram;if(t!==null){const i=this.js.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}if(this.data!==null){const t=this.diagram;t!==null&&t.partManager.pN(this)}}updateRelationshipsFromData(){if(this.data===null)return;const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}move(t,i){const s=i?this.location:this.position;let n=s.x;isNaN(n)&&(n=0);let o=s.y;isNaN(o)&&(o=0);const r=t.x-n,a=t.y-o;if(i===!0)super.move(t,!1);else{const l=C.V(s.x+r,s.y+a);super.move(l,!1),C.e(l)}this.fr(r,a);const h=this.labelNodes;for(;h.next();){const l=h.value,c=l.position;l.moveTo(c.x+r,c.y+a)}}get relinkableFrom(){return(this.Nt&1)!==0}set relinkableFrom(t){const i=(this.Nt&1)!==0;i!==t&&(this.Nt=this.Nt^1,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return(this.Nt&2)!==0}set relinkableTo(t){const i=(this.Nt&2)!==0;i!==t&&(this.Nt=this.Nt^2,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}get resegmentable(){return(this.Nt&4)!==0}set resegmentable(t){const i=(this.Nt&4)!==0;i!==t&&(this.Nt=this.Nt^4,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return(this.Nt&8)!==0}set isTreeLink(t){const i=(this.Nt&8)!==0;i!==t&&(this.Nt=this.Nt^8,this.t("isTreeLink",i,t),this.fromNode!==null&&this.fromNode.l0(),this.toNode!==null&&this.toNode.l0())}get path(){const t=this.findMainElement();return t instanceof At?t:null}get routeBounds(){return this.updateRoute(),this.uO(this.Sf)}uO(t){let i=1/0,s=1/0;const n=this.pointsCount;if(n===0)return t.i(NaN,NaN,0,0),t;if(n===1){const o=this.getPoint(0);i=Math.min(o.x,i),s=Math.min(o.y,s),t.i(o.x,o.y,0,0)}else if(n===2){const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.i(o.x,o.y,0,0),t.unionPoint(r)}else if(this.computeCurve()===9&&n>=3&&!this.isOrthogonal){let o=this.getPoint(0);if(i=o.x,s=o.y,t.i(i,s,0,0),n===3){const r=this.getPoint(1);i=Math.min(r.x,i),s=Math.min(r.y,s);const a=this.getPoint(2);i=Math.min(a.x,i),s=Math.min(a.y,s),O.ou(o.x,o.y,r.x,r.y,r.x,r.y,a.x,a.y,.5,t)}else for(let r=3;r<n;r+=3){const a=this.getPoint(r-2);r+3>=n&&(r=n-1);const h=this.getPoint(r-1),l=this.getPoint(r);O.ou(o.x,o.y,a.x,a.y,h.x,h.y,l.x,l.y,.5,t),i=Math.min(l.x,i),s=Math.min(l.y,s),o=l}}else{const o=this.getPoint(0),r=this.getPoint(1);i=Math.min(o.x,r.x),s=Math.min(o.y,r.y),t.i(o.x,o.y,0,0),t.unionPoint(r);for(let a=2;a<n;a++){const h=this.getPoint(a);i=Math.min(h.x,i),s=Math.min(h.y,s),t.unionPoint(h)}}return this.k1.i(i-t.x,s-t.y),t}get midPoint(){return this.updateRoute(),this.computeMidPoint(new C)}OA(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(i===0)return t.a(C.Ik),t;if(i===1)return t.a(this.getPoint(0)),t;if(i===2){const c=this.getPoint(0),d=this.getPoint(1);return t.i((c.x+d.x)/2,(c.y+d.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ot.getPointAlongPath(.5,t),t.add(this.getPoint(0));const c=this.ot.figures.first();return t.offset(-c.startX,-c.startY),t}if(this.computeCurve()===9){if(i===3){const f=this.getPoint(0),m=this.getPoint(1),p=this.getPoint(2);return O.AC(f.x,f.y,m.x,m.y,m.x,m.y,p.x,p.y,t),t}const c=(i-1)/3|0,d=(c/2|0)*3;if(c%2===1){const f=this.getPoint(d),m=this.getPoint(d+1),p=this.getPoint(d+2),y=this.getPoint(d+3);return O.AC(f.x,f.y,m.x,m.y,p.x,p.y,y.x,y.y,t),t}else return t.a(this.getPoint(d)),t}const s=this.flattenedLengths,n=this.flattenedTotalLength;let o=0,r=0,a=0;for(;o<n/2&&r<i&&(a=s[r],!(o+a>n/2));)o+=a,r++;const h=this.getPoint(r),l=this.getPoint(r+1);if(Math.abs(h.x-l.x)<1)h.y>l.y?t.i(h.x,h.y-(n/2-o)):t.i(h.x,h.y+(n/2-o));else if(Math.abs(h.y-l.y)<1)h.x>l.x?t.i(h.x-(n/2-o),h.y):t.i(h.x+(n/2-o),h.y);else{const c=(n/2-o)/a,d=c*(l.x-h.x),f=c*(l.y-h.y);t.i(h.x+d,h.y+f)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const l=this.getPoint(0),c=this.getPoint(1);return l.directionPoint(c)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ot.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const l=(t-1)/3|0;let c=(l/2|0)*3;if(l%2===1){c=Math.floor(c);const d=this.getPoint(c),f=this.getPoint(c+1),m=this.getPoint(c+2),p=this.getPoint(c+3);return O._D(d.x,d.y,f.x,f.y,m.x,m.y,p.x,p.y)}else if(c>0&&c+1<t){const d=this.getPoint(c-1),f=this.getPoint(c+1);return d.directionPoint(f)}}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<t&&(r=i[o],!(n+r>s/2));)n+=r,o++;const a=this.getPoint(o),h=this.getPoint(o+1);if(Math.abs(a.x-h.x)<1&&Math.abs(a.y-h.y)<1){if(o>0&&o+2<t){const l=this.getPoint(o-1),c=this.getPoint(o+2);return l.directionPoint(c)}}else{if(Math.abs(a.x-h.x)<1)return a.y>h.y?270:90;if(Math.abs(a.y-h.y)<1)return a.x>h.x?180:0}return a.directionPoint(h)}get flattenedLengths(){return this.Oa!==null?this.Oa:(this.Se||this.S1(),this.dO())}get flattenedTotalLength(){let t=this.P1;if(isNaN(t)){const i=this.flattenedLengths,s=i.length;t=0;for(let n=0;n<s;n++)t+=i[n];this.P1=t}return t}dO(){this.Oa===null?this.Oa=[]:this.Oa.length=0;const t=this.Oa,i=this.pointsCount;for(let s=0;s<i-1;s++){let n=0;const o=this.getPoint(s),r=this.getPoint(s+1);O.z(o.x,r.x)?(n=r.y-o.y,n<0&&(n=-n),t.push(n)):O.z(o.y,r.y)?(n=r.x-o.x,n<0&&(n=-n),t.push(n)):(n=Math.sqrt(o.distanceSquaredPoint(r)),t.push(n))}return t}get points(){return this.xi}set points(t){const i=this.xi;if(i===t)return;let s=null;if(Array.isArray(t)){const o=t;let r=o.length%2===0;if(r){for(let a=0;a<o.length;a++)if(typeof o[a]!="number"||isNaN(o[a])){r=!1;break}}if(r){s=new Y;for(let a=0;a<o.length/2;a++){const h=new C(o[a*2],o[a*2+1]).u();s.add(h)}}else{let a=!0;for(let h=0;h<o.length;h++){const l=o[h];if(!u.G(l)||typeof l.x!="number"||isNaN(l.x)||typeof l.y!="number"||isNaN(l.y)){a=!1;break}}if(a){s=new Y;for(let h=0;h<o.length;h++){const l=o[h];s.add(new C(l.x,l.y).u())}}}}else if(t instanceof Y){s=t.copy();const o=s.iterator;for(;o.next();)o.value.u()}else u.o("Link.points value is not an instance of List or Array: "+t);if(s===null)return;s.u(),this.xi=s,this.ee(),this.S1();const n=this.diagram;n!==null&&(!n.Vh&&!n.undoManager.isUndoingRedoing&&n.bx.add(this),n.animationManager.pi&&n.animationManager.VS(this,s)),this.t("points",i,s)}get pointsCount(){return this.xi.count}getPoint(t){return this.xi.r[t]}setPoint(t,i){this.xi.setElt(t,i)}setPointAt(t,i,s){this.xi.setElt(t,new C(i,s))}insertPoint(t,i){this.xi.insertAt(t,i)}insertPointAt(t,i,s){this.xi.insertAt(t,new C(i,s))}addPoint(t){this.xi.add(t)}addPointAt(t,i){this.xi.add(new C(t,i))}removePoint(t){this.xi.removeAt(t)}clearPoints(){this.xi.clear()}fr(t,i){if(t===0&&i===0)return;if(this.pointsCount===0){this.defaultFromPoint&&this.defaultFromPoint.offset(t,i),this.defaultToPoint&&this.defaultToPoint.offset(t,i);return}const s=this.Se,n=new Y,o=this.xi.iterator;for(;o.next();){const h=o.value;n.add(new C(h.x+t,h.y+i).u())}n.u();const r=this.xi;this.xi=n;const a=this.diagram;isNaN(t)||isNaN(i)||a!==null&&a.animationManager.pi?this.c():(this.Ks.i(this.Ks.x+t,this.Ks.y+i),this.at.i(this.at.x+t,this.at.y+i),this.ef()),s?this.S1():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),a!==null&&a.animationManager.pi&&a.animationManager.VS(this,n),this.t("points",r,n)}startRoute(){this.hl===null&&(this.hl=this.xi,this.xi=this.xi.copy())}commitRoute(){if(this.hl===null)return;const t=this.hl,i=this.xi;let s=1/0,n=1/0;const o=t.r,r=o.length;for(let f=0;f<r;f++){const m=o[f];s=Math.min(m.x,s),n=Math.min(m.y,n)}let a=1/0,h=1/0;const l=i.r,c=l.length;for(let f=0;f<c;f++){const m=l[f];a=Math.min(m.x,a),h=Math.min(m.y,h),m.u()}if(i.u(),c===r)for(let f=0;f<c;f++){const m=o[f],p=l[f];if(m.x-s!==p.x-a||m.y-n!==p.y-h){this.ee();break}}else this.ee();this.hl=null;const d=this.diagram;d!==null&&d.animationManager.pi&&d.animationManager.VS(this,i),this.S1(),this.t("points",t,i)}rollbackRoute(){this.hl!==null&&(this.xi=this.hl,this.hl=null)}BF(){this.br!==null&&(this.points=this.br,this.br=null)}S1(){if(this.xi.count===0){this.Se=!1;return}this.Se=!0,this.Oa=null,this.P1=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.M1(!1)}invalidateRoute(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const i=this.diagram;if(i){if(i.bx.has(this)||i.undoManager.isUndoingRedoing)return;const s=i.animationManager;if(s.isTicking&&!s.isAnimating)return;this.br!==null&&!s.isTicking&&(this.br=null)}this.Se=!1,this.c(),t.c()}get Se(){return(this.Nt&16)!==0}set Se(t){(this.Nt&16)!==0!==t&&(this.Nt=this.Nt^16)}get suspendsRouting(){return(this.Nt&32)!==0}set suspendsRouting(t){(this.Nt&32)!==0!==t&&(this.Nt=this.Nt^32)}get by(){return(this.Nt&64)!==0}set by(t){(this.Nt&64)!==0!==t&&(this.Nt=this.Nt^64)}get yN(){return(this.Nt&512)!==0}set yN(t){(this.Nt&512)!==0!==t&&(this.Nt=this.Nt^512)}get defaultFromPoint(){return this.aN}set defaultFromPoint(t){this.aN=t!==null?t.copy():null}get defaultToPoint(){return this.cN}set defaultToPoint(t){this.cN=t!==null?t.copy():null}updateRoute(){if(this.Se||this.by)return;let t=!0;try{this.by=!0,this.startRoute(),t=this.computePoints()}catch{this.by=!1,this.rollbackRoute()}finally{this.by=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let i=this.fromNode,s=null;if(i===null?(Bt.Ia||(Bt.Ia=new gt,Bt.Ia.desiredSize=rt.sc,Bt.Ia.ensureBounds()),this.defaultFromPoint&&(Bt.Ia.location=this.defaultFromPoint,Bt.Ia.ensureBounds(),i=Bt.Ia,s=Bt.Ia)):s=this.fromPort,s!==null&&!i.isVisible()){const y=i.findVisibleNode();y!==null&&y!==i?(i=y,s=y.port):i=y}if(this.fN=i,i===null||!i.location.isReal()||s===null||(s=i.findVisiblePort(s),s===null))return!1;let n=this.toNode,o=null;if(n===null?(Bt.Ea||(Bt.Ea=new gt,Bt.Ea.desiredSize=rt.sc,Bt.Ea.ensureBounds()),this.defaultToPoint&&(Bt.Ea.location=this.defaultToPoint,Bt.Ea.ensureBounds(),n=Bt.Ea,o=Bt.Ea)):o=this.toPort,o!==null&&!n.isVisible()){const y=n.findVisibleNode();y!==null&&y!==n?(n=y,o=y.port):n=y}if(this.uN=n,n===null||!n.location.isReal()||o===null||(o=n.findVisiblePort(o),o===null))return!1;const r=this.pointsCount,a=this.computeSpot(!0,s),h=this.computeSpot(!1,o),l=this.Dd(a),c=this.Dd(h),d=s===o&&s!==null,f=this.isOrthogonal;let m=this.curve===9;d&&!f?(m=!0,this.Ko=!0):this.Ko=!1;const p=this.computeAdjusting()===0||d;if(!f&&!d&&l&&c){let y=!1;if(!p&&r>=3){let x=this.getLinkPoint(i,s,a,!0,!1,n,o),b=this.getLinkPoint(n,o,h,!1,!1,i,s);y=this.adjustPoints(0,x,r-1,b),y&&(x=this.getLinkPoint(i,s,a,!0,!1,n,o),b=this.getLinkPoint(n,o,h,!1,!1,i,s),this.adjustPoints(0,x,r-1,b))}y||(this.clearPoints(),m?this.gO(i,s,a,n,o,h):this.mO(i,s,a,n,o,h))}else{const y=this.isAvoiding;p&&(f&&y||d)&&this.clearPoints();const x=d?this.computeCurviness():0,b=this.getLinkPoint(i,s,a,!0,f,n,o);let M=0,P=0,k=0;if(f||!l||d){let F=this.computeEndSegmentLength(i,s,a,!0);if(k=this.getLinkDirection(i,s,b,a,!0,f,n,o),d&&(l||a.equals(h)||!f&&a.x+h.x===1&&a.y+h.y===1)&&(k-=f?90:30,x<0&&(k-=180)),k<0?k+=360:k>=360&&(k-=360),d&&(F+=Math.abs(x)*(f?1:2)),k===0?M=F:k===90?P=F:k===180?M=-F:k===270?P=-F:(M=F*Math.cos(k*Math.PI/180),P=F*Math.sin(k*Math.PI/180)),a.isNoSpot()&&d){const V=s.getDocumentPoint(U.Center,C.l()),K=C.V(V.x+M*1e3,V.y+P*1e3);this.getLinkPointFromPoint(i,s,V,K,!0,b),C.e(V),C.e(K)}}const L=this.getLinkPoint(n,o,h,!1,f,i,s);let T=0,D=0,B=0;if(f||!c||d){let F=this.computeEndSegmentLength(n,o,h,!1);if(B=this.getLinkDirection(n,o,L,h,!1,f,i,s),d&&(c||a.equals(h)||!f&&a.x+h.x===1&&a.y+h.y===1)&&(B+=f?0:30,x<0&&(B+=180)),B<0?B+=360:B>=360&&(B-=360),d&&(F+=Math.abs(x)*(f?1:2)),B===0?T=F:B===90?D=F:B===180?T=-F:B===270?D=-F:(T=F*Math.cos(B*Math.PI/180),D=F*Math.sin(B*Math.PI/180)),h.isNoSpot()&&d){const V=o.getDocumentPoint(U.Center,C.l()),K=C.V(V.x+T*1e3,V.y+D*1e3);this.getLinkPointFromPoint(n,o,V,K,!1,L),C.e(V),C.e(K)}}let E=b;(f||!l||d)&&(E=new C(b.x+M,b.y+P));let R=L;(f||!c||d)&&(R=new C(L.x+T,L.y+D)),!p&&!f&&l&&r>3&&this.adjustPoints(0,b,r-2,R)?this.setPoint(r-1,L):!p&&!f&&c&&r>3&&this.adjustPoints(1,E,r-1,L)?this.setPoint(0,b):!p&&(f?r>=6:r>4)&&this.adjustPoints(1,E,r-2,R)?(this.setPoint(0,b),this.setPoint(r-1,L)):(this.clearPoints(),this.addPoint(b),(f||!l||d)&&this.addPoint(E),f&&this.addOrthoPoints(E,k,R,B,i,n),(f||!c||d)&&this.addPoint(R),this.addPoint(L))}return t.addInvalidRoute(this),!0}wN(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x>=t.x?i.x=t.x+9e9:i.x=t.x-9e9,i.y=t.y):(i.y>=t.y?i.y=t.y+9e9:i.y=t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,s,n,o,r){if(r===void 0&&(r=new C),t===null||i===null)return r.a(s),r;if(!t.isVisible()){const m=t.findVisibleNode();m!==null&&m!==t&&(t=m,i=t.port)}let a=0,h=0,l=0,c=0,d=null,f=i.panel;if(f!==null&&!f.an()&&(f=f.panel),f===null)a=n.x,h=n.y,l=s.x,c=s.y;else{d=f.Us;const m=1/(d.m11*d.m22-d.m12*d.m21),p=d.m22*m,y=-d.m12*m,x=-d.m21*m,b=d.m11*m,M=m*(d.m21*d.dy-d.m22*d.dx),P=m*(d.m12*d.dx-d.m11*d.dy);a=n.x*p+n.y*x+M,h=n.x*y+n.y*b+P,l=s.x*p+s.y*x+M,c=s.x*y+s.y*b+P}return i.Jc(a,h,l,c,r),d!==null&&r.T(d),r}pO(t,i){const s=t.Ku;return s!==null?s.ST(i):null}N1(t){if(t===null)return null;let i=t.Ku;return i===null&&(i=new Ko(t.part,t),t.Ku=i),i.ST(this)}getLinkPoint(t,i,s,n,o,r,a,h){if(h===void 0&&(h=new C),s.isSpot()&&!this.Dd(s))return i.getDocumentPoint(s,h),h;if(s.isSide()){const d=this.N1(i);if(d!==null){const f=d.Fd;if(h.a(f),o&&this.routing===7){const m=this.N1(a);if(m!==null&&d.Mf<m.Mf){const p=C.l(),y=C.l(),x=new G(i.getDocumentPoint(U.TopLeft,p),i.getDocumentPoint(U.BottomRight,y)),b=this.computeSpot(!n,a),M=this.getLinkPoint(r,a,b,!n,o,t,i,y);(s.includesSide(U.LeftSide)||s.includesSide(U.RightSide))&&M.y>=x.y&&M.y<=x.y+x.height?h.y=M.y:(s.includesSide(U.TopSide)||s.includesSide(U.BottomSide))&&M.x>=x.x&&M.x<=x.x+x.width&&(h.x=M.x),C.e(p),C.e(y)}}return h}}const l=i.getDocumentPoint(this.C1(s,n),C.l());let c=null;if(this.pointsCount>(o?6:2))c=n?this.getPoint(1):this.getPoint(this.pointsCount-2),o&&(c=this.wN(l,c.copy()));else{const d=this.computeSpot(!n,a),f=C.l();c=a.getDocumentPoint(this.C1(d,!n),f),o&&(c=this.wN(l,c)),C.e(f)}return this.getLinkPointFromPoint(t,i,l,c,n,h),C.e(l),h}getLinkDirection(t,i,s,n,o,r,a,h){let l=this.yO(t,i,s,n,o,r,a,h);if(a&&n.isNoSpot()&&a.isMemberOf(t)&&(l+=180,l>=360&&(l-=360)),this.Dd(n)||i===null)return l;const c=i.getDocumentAngle();return c===0||(45<=c&&c<135?l+=90:135<=c&&c<225?l+=180:225<=c&&c<315&&(l+=270),l>=360&&(l-=360)),l}yO(t,i,s,n,o,r,a,h){if(n.isSpot())return n.x>n.y?n.x>1-n.y?0:n.x<1-n.y?270:315:n.x<n.y?n.x>1-n.y?90:n.x<1-n.y?180:135:n.x<.5?225:n.x>.5?45:0;if(n.isSide()){const f=this.N1(i);if(f!==null)switch(f.me){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}else return n.includesSide(U.TopSide)?270:n.includesSide(U.BottomSide)?90:n.includesSide(U.LeftSide)?180:0}if(i===null||h===null)return 0;const l=i.getDocumentPoint(U.Center,C.l());let c=null;if(this.pointsCount>(r?6:2))c=o?this.getPoint(1):this.getPoint(this.pointsCount-2),r?c=this.wN(l,c.copy()):c=s;else{const f=C.l();c=h.getDocumentPoint(U.Center,f),C.e(f)}let d=0;return Math.abs(c.x-l.x)>Math.abs(c.y-l.y)?c.x>=l.x?d=0:d=180:c.y>=l.y?d=90:d=270,C.e(l),d}computeEndSegmentLength(t,i,s,n){if(i!==null&&s.isSide()){const r=this.N1(i);if(r!==null)return r.L1}let o=NaN;return n?o=this.fromEndSegmentLength:o=this.toEndSegmentLength,i!==null&&isNaN(o)&&(n?o=i.fromEndSegmentLength:o=i.toEndSegmentLength),isNaN(o)&&(o=10),o}computeSpot(t,i){return i===void 0&&(i=null),t?this.wO(i||this.fromPort):this.xO(i||this.toPort)}wO(t){if(t===null)return U.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===U.Default?U.None:i}xO(t){if(t===null)return U.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===U.Default?U.None:i}Dd(t){return t===U.None||t.x===.5&&t.y===.5}C1(t,i){return t.x===.5&&t.y===.5?t:U.Center}computeOtherPoint(t,i){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new C);{const s=this.pO(i,this);return s!==null?s.Fd:i.getDocumentPoint(U.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const s=this.fromPort;s!==null&&(i=s.fromShortLength)}return isNaN(i)?0:i}else{let i=this.toShortLength;if(isNaN(i)){const s=this.toPort;s!==null&&(i=s.toShortLength)}return isNaN(i)?0:i}}Tm(t,i,s,n,o,r){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);let a;if(r===void 0?(a=Pt.l(),a.Ri()):a=r,a.nc(this.T),this.containedInRect(t,a))return this.Y2(i,s,o),r===void 0&&Pt.e(a),!0;if(this.intersectsRect(t,a)){let h=!1;if(!this.af){const l=this.C.r,c=l.length;for(let d=c;d--;){const f=l[d];if(!f.visible&&f!==this.locationObject)continue;const m=f.actualBounds,p=this.naturalBounds;if(m.x>p.width||m.y>p.height||m.x+m.width<0||m.y+m.height<0)continue;const y=f,x=Pt.l();if(x.set(a),y instanceof bt?h=y.Tm(t,i,s,n,o,x):this.path===y?y instanceof At&&(h=y.Yv(t,n,x)):h=y.wA(t,n,x),h){let b=y;i!==null&&(b=i(y)),b&&(s===null||s(b))&&o.add(b)}Pt.e(x)}}return r===void 0&&Pt.e(a),h||this.background!==null}return r===void 0&&Pt.e(a),!1}get isOrthogonal(){return(this.va&2)===2}static mN(t){return(t&2)===2}get isAvoiding(){return(this.va&4)===4}computeCurve(){if(this.Ko===null){const t=this.fromPort,i=t!==null&&t===this.toPort,s=this.isOrthogonal;this.Ko=i&&!s}return this.Ko?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=10),t}findMidLabel(){const t=this.path,i=this.C.r,s=i.length;for(let o=0;o<s;o++){const r=i[o];if(!(r===t||r.isPanelMain)&&(r.segmentIndex===-1/0||isNaN(r.segmentIndex)))return r}const n=this.labelNodes;for(;n.next();){const o=n.value;if(o.segmentIndex===-1/0||isNaN(o.segmentIndex))return o}return null}computeSpacing(){if(!this.isVisible())return 0;let t=Bt.cO;t=Math.max(t,this.computeThickness());const i=this.fromPort,s=this.toPort;if(i!==null&&s!==null){const n=this.findMidLabel();if(n!==null){const o=n.naturalBounds,r=n.margin,a=isNaN(o.width)?30:o.width*n.scale+r.left+r.right,h=isNaN(o.height)?14:o.height*n.scale+r.top+r.bottom,l=n.segmentOrientation;if(l===21||l===25||l===24)t=Math.max(t,h);else if(l===23||l===27||l===22||l===26)t=Math.max(t,a);else{const c=i.getDocumentPoint(U.Center).directionPoint(s.getDocumentPoint(U.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(c)*a)+Math.abs(Math.cos(c)*h)+1)}this.curve===9&&(t*=1.333)}}return t}arrangeBundledLinks(t,i){if(i)for(let s=0;s<t.length;s++){const n=t[s];n.computeAdjusting()===0&&n.invalidateRoute()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=Bt.aO;const i=this.jo;if(i!==null){const s=u.et();let n=0;const o=i.Hs;for(let a=0;a<o.length;a++){const h=o[a].computeSpacing();s.push(h),n+=h}let r=-n/2;for(let a=0;a<o.length;a++){if(o[a]===this){t=r+s[a]/2;break}r+=s[a]}i.ly===this.fromNode&&(t=-t),u.J(s)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.jo!==null}mO(t,i,s,n,o,r){const a=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,r,!1,!1,t,i);if(this.hasCurviness()){const l=h.x-a.x,c=h.y-a.y,d=this.computeCurviness(),f=d,m=a.x+l/2,p=a.y+c/2;let y=m,x=p;if(O.f(c,0))l>0?x-=f:x+=f;else{const b=-l/c;let M=Math.sqrt(f*f/(b*b+1));d<0&&(M=-M),y=(c<0?-1:1)*M+m,x=b*(y-m)+p}this.addPoint(a),this.addPointAt(y,x),this.addPoint(h)}else{this.addPoint(a),this.addPoint(h);const l=G.l();i.getDocumentBounds(l);const c=l.containsPoint(h);o.getDocumentBounds(l);const d=l.containsPoint(a);if(c||d){const f=i.getDocumentPoint(this.C1(s,!0),new C);this.setPoint(0,this.getLinkPointFromPoint(t,i,f,h,!0,f));const m=o.getDocumentPoint(this.C1(r,!1),new C);this.setPoint(1,this.getLinkPointFromPoint(n,o,m,a,!1,m))}G.e(l)}}gO(t,i,s,n,o,r){const a=this.getLinkPoint(t,i,s,!0,!1,n,o),h=this.getLinkPoint(n,o,r,!1,!1,t,i),l=h.x-a.x,c=h.y-a.y,d=this.computeCurviness();let f=0,m=0,p=a.x+l/3,y=a.y+c/3,x=p,b=y;O.f(c,0)?l>0?b-=d:b+=d:(f=-l/c,m=Math.sqrt(d*d/(f*f+1)),d<0&&(m=-m),x=(c<0?-1:1)*m+p,b=f*(x-p)+y),p=a.x+2*l/3,y=a.y+2*c/3;let M=p,P=y;O.f(c,0)?l>0?P-=d:P+=d:(M=(c<0?-1:1)*m+p,P=f*(M-p)+y),this.clearPoints(),this.addPoint(a),this.addPointAt(x,b),this.addPointAt(M,P),this.addPoint(h),this.setPoint(0,this.getLinkPoint(t,i,s,!0,!1,n,o)),this.setPoint(3,this.getLinkPoint(n,o,r,!1,!1,t,i))}adjustPoints(t,i,s,n){let o=this.computeAdjusting();if(this.isOrthogonal){if(o===18)return!1;o===19&&(o=17)}switch(o){case 18:return this.bO(t,i,s,n);case 19:return this.kO(t,i,s,n);case 17:return this.PO(t,i,s,n);default:return!1}}bO(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,h=o.y,l=r.x,c=r.y;let d=l-a,f=c-h;const m=Math.sqrt(d*d+f*f);if(O.z(m,0))return!0;let p=0;O.z(d,0)?f<0?p=-Math.PI/2:p=Math.PI/2:(p=Math.atan(f/Math.abs(d)),d<0&&(p=Math.PI-p));const y=i.x,x=i.y,b=n.x,M=n.y,P=b-y,k=M-x,L=Math.sqrt(P*P+k*k);let T=0;O.z(P,0)?k<0?T=-Math.PI/2:T=Math.PI/2:(T=Math.atan(k/Math.abs(P)),P<0&&(T=Math.PI-T));const D=L/m,B=T-p;this.setPoint(t,i);for(let E=t+1;E<s;E++){const R=this.getPoint(E);d=R.x-a,f=R.y-h;const F=Math.sqrt(d*d+f*f);if(O.z(F,0))continue;let V=0;O.z(d,0)?f<0?V=-Math.PI/2:V=Math.PI/2:(V=Math.atan(f/Math.abs(d)),d<0&&(V=Math.PI-V));const K=V+B,H=F*D,W=y+H*Math.cos(K),J=x+H*Math.sin(K);this.setPointAt(E,W,J)}return this.setPoint(s,n),!0}kO(t,i,s,n){const o=this.getPoint(t),r=this.getPoint(s);if(o.equalsApprox(i)&&r.equalsApprox(n))return!0;const a=o.x,h=o.y,l=r.x,c=r.y,d=(l-a)**2+(c-h)**2,f=i.x,m=i.y,p=n.x,y=n.y;let x=0,b=1;p-f!==0?(x=(y-m)/(p-f),b=Math.sqrt(1+1/(x*x))):x=9e9,this.setPoint(t,i);for(let M=t+1;M<s;M++){const P=this.getPoint(M),k=P.x,L=P.y;let T=.5;d!==0&&(T=((a-k)*(a-l)+(h-L)*(h-c))/d);const D=a+T*(l-a),B=h+T*(c-h);let E=Math.sqrt((k-D)**2+(L-B)**2);L<x*(k-D)+B&&(E=-E),x>0&&(E=-E);const R=f+T*(p-f),F=m+T*(y-m);if(x!==0){const V=R+E/b,K=F-(V-R)/x;this.setPointAt(M,V,K)}else this.setPointAt(M,R,F+E)}return this.setPoint(s,n),!0}PO(t,i,s,n){if(this.isOrthogonal){let o=this.getPoint(t),r=this.getPoint(t+1),a=this.getPoint(t+2),h=r.x,l=r.y;const c=h,d=l;O.f(o.y,r.y)?O.f(r.x,a.x)?l=i.y:O.f(r.y,a.y)&&(h=i.x):O.f(o.x,r.x)&&(O.f(r.y,a.y)?h=i.x:O.f(r.x,a.x)&&(l=i.y)),this.setPointAt(t+1,h,l),o=this.getPoint(s),r=this.getPoint(s-1),a=this.getPoint(s-2);let f=r.x,m=r.y;const p=f,y=m;if(O.f(o.y,r.y)?O.f(r.x,a.x)?m=n.y:O.f(r.y,a.y)&&(f=n.x):O.f(o.x,r.x)&&(O.f(r.y,a.y)?f=n.x:O.f(r.x,a.x)&&(m=n.y)),this.setPointAt(s-1,f,m),this.WL())return this.setPointAt(t+1,c,d),this.setPointAt(s-1,p,y),!1}return this.setPoint(t,i),this.setPoint(s,n),!0}addOrthoPoints(t,i,s,n,o,r){i<0?i+=360:i>=360&&(i-=360),n<0?n+=360:n>=360&&(n-=360);const a=n;i>=315||i<45?i=0:45<=i&&i<135?i=90:135<=i&&i<225?i=180:i=270,n>=315||n<45?n=0:45<=n&&n<135?n=90:135<=n&&n<225?n=180:n=270;const h=t,l=s,c=o.actualBounds.copy(),d=r.actualBounds.copy();if(!c.isReal()||!d.isReal())return;c.inflate(Bt.Ua,Bt.Ua),d.inflate(Bt.Ua,Bt.Ua),c.unionPoint(t),d.unionPoint(s);const f=C.l(),m=C.l();i===0?l.x>h.x||n===270&&l.y<h.y&&d.right>h.x||n===90&&l.y>h.y&&d.right>h.x?(f.i(l.x,h.y),m.i(l.x,(h.y+l.y)/2),n===180?(f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1),m.x=f.x,m.y=l.y):n===270&&l.y<h.y||n===90&&l.y>h.y?(h.x<d.left?f.x=this.computeMidOrthoPosition(h.x,h.y,d.left,l.y,!1):h.x<d.right&&(n===270&&h.y<d.top||n===90&&h.y>d.bottom)?f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):f.x=d.right,m.x=f.x,m.y=l.y):n===0&&h.x<d.left&&h.y>d.top&&h.y<d.bottom&&(f.x=h.x,h.y<l.y?f.y=Math.min(l.y,d.top):f.y=Math.max(l.y,d.bottom),m.y=f.y)):(f.i(h.x,l.y),m.i((h.x+l.x)/2,l.y),(n===180||n===90&&l.y<c.top||n===270&&l.y>c.bottom)&&(n===180&&(d.containsPoint(h)||c.containsPoint(l))?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):l.y<h.y&&(n===180||n===90)?f.y=this.computeMidOrthoPosition(h.x,c.top,l.x,Math.max(l.y,d.bottom),!0):l.y>h.y&&(n===180||n===270)&&(f.y=this.computeMidOrthoPosition(h.x,c.bottom,l.x,Math.min(l.y,d.top),!0)),m.x=l.x,m.y=f.y),f.y>c.top&&f.y<c.bottom&&(l.x>=c.left&&l.x<=h.x||h.x<=d.right&&h.x>=l.x?(n===90||n===270)&&(f.i(Math.max((h.x+l.x)/2,h.x),h.y),m.i(f.x,l.y)):(n===270||(n===0||n===180)&&l.y<h.y?f.y=Math.min(l.y,n===0?c.top:Math.min(c.top,d.top)):f.y=Math.max(l.y,n===0?c.bottom:Math.max(c.bottom,d.bottom)),m.x=l.x,m.y=f.y))):i===180?l.x<h.x||n===270&&l.y<h.y&&d.left<h.x||n===90&&l.y>h.y&&d.left<h.x?(f.i(l.x,h.y),m.i(l.x,(h.y+l.y)/2),n===0?(f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1),m.x=f.x,m.y=l.y):n===270&&l.y<h.y||n===90&&l.y>h.y?(h.x>d.right?f.x=this.computeMidOrthoPosition(h.x,h.y,d.right,l.y,!1):h.x>d.left&&(n===270&&h.y<d.top||n===90&&h.y>d.bottom)?f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):f.x=d.left,m.x=f.x,m.y=l.y):n===180&&h.x>d.right&&h.y>d.top&&h.y<d.bottom&&(f.x=h.x,h.y<l.y?f.y=Math.min(l.y,d.top):f.y=Math.max(l.y,d.bottom),m.y=f.y)):(f.i(h.x,l.y),m.i((h.x+l.x)/2,l.y),(n===0||n===90&&l.y<c.top||n===270&&l.y>c.bottom)&&(n===0&&(d.containsPoint(h)||c.containsPoint(l))?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):l.y<h.y&&(n===0||n===90)?f.y=this.computeMidOrthoPosition(h.x,c.top,l.x,Math.max(l.y,d.bottom),!0):l.y>h.y&&(n===0||n===270)&&(f.y=this.computeMidOrthoPosition(h.x,c.bottom,l.x,Math.min(l.y,d.top),!0)),m.x=l.x,m.y=f.y),f.y>c.top&&f.y<c.bottom&&(l.x<=c.right&&l.x>=h.x||h.x>=d.left&&h.x<=l.x?(n===90||n===270)&&(f.i(Math.min((h.x+l.x)/2,h.x),h.y),m.i(f.x,l.y)):(n===270||(n===0||n===180)&&l.y<h.y?f.y=Math.min(l.y,n===180?c.top:Math.min(c.top,d.top)):f.y=Math.max(l.y,n===180?c.bottom:Math.max(c.bottom,d.bottom)),m.x=l.x,m.y=f.y))):i===90?l.y>h.y||n===180&&l.x<h.x&&d.bottom>h.y||n===0&&l.x>h.x&&d.bottom>h.y?(f.i(h.x,l.y),m.i((h.x+l.x)/2,l.y),n===270?(f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0),m.x=l.x,m.y=f.y):n===180&&l.x<h.x||n===0&&l.x>h.x?(h.y<d.top?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,d.top,!0):h.y<d.bottom&&(n===180&&h.x<d.left||n===0&&h.x>d.right)?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):f.y=d.bottom,m.x=l.x,m.y=f.y):n===90&&h.y<d.top&&h.x>d.left&&h.x<d.right&&(h.x<l.x?f.x=Math.min(l.x,d.left):f.x=Math.max(l.x,d.right),f.y=h.y,m.x=f.x)):(f.i(l.x,h.y),m.i(l.x,(h.y+l.y)/2),(n===270||n===0&&l.x<c.left||n===180&&l.x>c.right)&&(n===270&&(d.containsPoint(h)||c.containsPoint(l))?f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):l.x<h.x&&(n===270||n===0)?f.x=this.computeMidOrthoPosition(c.left,h.y,Math.max(l.x,d.right),l.y,!1):l.x>h.x&&(n===270||n===180)&&(f.x=this.computeMidOrthoPosition(c.right,h.y,Math.min(l.x,d.left),l.y,!1)),m.x=f.x,m.y=l.y),f.x>c.left&&f.x<c.right&&(l.y>=c.top&&l.y<=h.y||h.y<=d.bottom&&h.y>=l.y?(n===0||n===180)&&(f.i(h.x,Math.max((h.y+l.y)/2,h.y)),m.i(l.x,f.y)):(n===180||(n===90||n===270)&&l.x<h.x?f.x=Math.min(l.x,n===90?c.left:Math.min(c.left,d.left)):f.x=Math.max(l.x,n===90?c.right:Math.max(c.right,d.right)),m.x=f.x,m.y=l.y))):l.y<h.y||n===180&&l.x<h.x&&d.top<h.y||n===0&&l.x>h.x&&d.top<h.y?(f.i(h.x,l.y),m.i((h.x+l.x)/2,l.y),n===90?(f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0),m.x=l.x,m.y=f.y):n===180&&l.x<h.x||n===0&&l.x>=h.x?(h.y>d.bottom?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,d.bottom,!0):h.y>d.top&&(n===180&&h.x<d.left||n===0&&h.x>d.right)?f.y=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!0):f.y=d.top,m.x=l.x,m.y=f.y):n===270&&h.y>d.bottom&&h.x>d.left&&h.x<d.right&&(h.x<l.x?f.x=Math.min(l.x,d.left):f.x=Math.max(l.x,d.right),f.y=h.y,m.x=f.x)):(f.i(l.x,h.y),m.i(l.x,(h.y+l.y)/2),(n===90||n===0&&l.x<c.left||n===180&&l.x>c.right)&&(n===90&&(d.containsPoint(h)||c.containsPoint(l))?f.x=this.computeMidOrthoPosition(h.x,h.y,l.x,l.y,!1):l.x<h.x&&(n===90||n===0)?f.x=this.computeMidOrthoPosition(c.left,h.y,Math.max(l.x,d.right),l.y,!1):l.x>h.x&&(n===90||n===180)&&(f.x=this.computeMidOrthoPosition(c.right,h.y,Math.min(l.x,d.left),l.y,!1)),m.x=f.x,m.y=l.y),f.x>c.left&&f.x<c.right&&(l.y<=c.bottom&&l.y>=h.y||h.y>=d.top&&h.y<=l.y?(n===0||n===180)&&(f.i(h.x,Math.min((h.y+l.y)/2,h.y)),m.i(l.x,f.y)):(n===180||(n===90||n===270)&&l.x<h.x?f.x=Math.min(l.x,n===270?c.left:Math.min(c.left,d.left)):f.x=Math.max(l.x,n===270?c.right:Math.max(c.right,d.right)),m.x=f.x,m.y=l.y))),this.yN=n!==a,this.dN=i,this.gN=n,this.addPoint(f.copy()),this.addPoint(m.copy()),C.e(f),C.e(m)}computeMidOrthoPosition(t,i,s,n,o){let r=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(r=this.computeCurviness()),o?(i+n)/2+r:(t+s)/2+r}WL(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const s=this.diagram.getPositions(!1,this.containingGroup,null);for(let n=1;n<i-2;n++){const o=t[n],r=t[n+1];if(!s.isUnoccupied(Math.min(o.x,r.x),Math.min(o.y,r.y),Math.abs(o.x-r.x),Math.abs(o.y-r.y)))return!0}return!1}findClosestSegment(t){const i=t.x,s=t.y;let n=this.getPoint(0),o=this.getPoint(1),r=C.distanceLineSegmentSquared(i,s,n.x,n.y,o.x,o.y),a=0;for(let h=1;h<this.pointsCount-1;h++){n=this.getPoint(h+1);const l=C.distanceLineSegmentSquared(i,s,o.x,o.y,n.x,n.y);o=n,l<r&&(a=h,r=l)}return a}ee(){this.kh=!1,this.c()}get kh(){return(this.Nt&128)!==0}set kh(t){(this.Nt&128)!==0!==t&&(this.Nt=this.Nt^128)}get geometry(){if(!this.kh){if(this.updateRoute(),this.pointsCount<2)return this.kh=!0,this.ot;this.ot=this.makeGeometry()}return this.ot}sd(t){if(!t){if(this.Se===!1)return;const o=this.findMainElement();if(this.kh&&(o===null||o.geometry!==null))return}this.pointsCount<2?this.kh=!0:this.ot=this.makeGeometry();const i=this.path;if(i===null)return;i.ot=this.ot;const s=this.C.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];r!==i&&r.isPanelMain&&r instanceof At&&(r.ot=this.ot)}}SO(t){return this.Ba()&&t.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ot,i=this.pointsCount;let s=!1;const n=this.diagram;n!==null&&this.SO(n)&&(s=!0);let o=0,r=0,a=this.getPoint(0).copy();const h=a.copy(),l=this.xi.r,c=this.computeCurve();if(c===9&&i>=3&&!O.z(this.smoothness,0))if(i===3){let d=this.getPoint(1);o=Math.min(a.x,d.x),r=Math.min(a.y,d.y),d=this.getPoint(2),o=Math.min(o,d.x),r=Math.min(r,d.y)}else if(this.isOrthogonal){for(let d=0;d<i;d++){const f=l[d];h.x=Math.min(f.x,h.x),h.y=Math.min(f.y,h.y)}o=h.x,r=h.y}else{for(let d=3;d<i;d+=3){d+3>=i&&(d=i-1);const f=this.getPoint(d);h.x=Math.min(f.x,h.x),h.y=Math.min(f.y,h.y)}o=h.x,r=h.y}else{for(let d=0;d<i;d++){const f=l[d];h.x=Math.min(f.x,h.x),h.y=Math.min(f.y,h.y)}o=h.x,r=h.y}if(o-=this.k1.x,r-=this.k1.y,a.x-=o,a.y-=r,i===2&&!this.Ba()){let d=this.getPoint(1).copy();return d.x-=o,d.y-=r,this.computeShortLength(!0)!==0&&(a=this.Nf(a,!0,h)),this.computeShortLength(!1)!==0&&(d=this.Nf(d,!1,h)),t.type=1,t.startX=a.x,t.startY=a.y,t.endX=d.x,t.endY=d.y,this.kh=!0,t}else{t.type=4;const d=Ls.RC(t);if(this.computeShortLength(!0)!==0&&(a=this.Nf(a,!0,h)),d.hu(a.x,a.y,!1,!1),c===9&&i>=3&&!O.z(this.smoothness,0))if(i===3){const f=this.getPoint(1),m=f.x-o,p=f.y-r;let y=this.getPoint(2).copy();y.x-=o,y.y-=r,this.computeShortLength(!1)!==0&&(y=this.Nf(y,!1,h)),d.hr(m,p,m,p,y.x,y.y)}else if(this.isOrthogonal){const f=C.V(o,r),m=C.l();m.a(this.getPoint(1));const p=C.V(o,r),y=C.V(o,r);let x=this.getPoint(0),b=null;const M=this.smoothness/3;for(let T=1;T<this.pointsCount-1;T++){b=this.getPoint(T);const D=x,B=b,E=this.getPoint(this.xN(b,T,!1));O.z(D.x,B.x)&&O.z(B.x,E.x)||O.z(D.y,B.y)&&O.z(B.y,E.y)||(this.MO(D,B,E,M,p,y),(T===1||T===2&&O.z(x.x,this.getPoint(0).x)&&O.z(x.y,this.getPoint(0).y))&&(m.x=(x.x+b.x)*.5,m.y=(x.y+b.y)*.5),d.hr(m.x-o,m.y-r,p.x-o,p.y-r,b.x-o,b.y-r),f.set(p),m.set(y),x=b)}let P=x.x,k=x.y,L=this.getPoint(this.pointsCount-1);this.computeShortLength(!1)!==0&&(L=this.Nf(L.copy(),!1,C.xo)),P=.5*(P+L.x),k=.5*(k+L.y),d.hr(y.x-o,y.y-r,P-o,k-r,L.x-o,L.y-r),C.e(f),C.e(m),C.e(p),C.e(y)}else for(let f=3;f<i;f+=3){const m=this.getPoint(f-2);f+3>=i&&(f=i-1);const p=this.getPoint(f-1);let y=this.getPoint(f);f===i-1&&this.computeShortLength(!1)!==0&&(y=this.Nf(y.copy(),!1,C.xo)),d.hr(m.x-o,m.y-r,p.x-o,p.y-r,y.x-o,y.y-r)}else{const f=C.l();f.a(this.getPoint(0));const m=C.l();m.a(f);const p=this.computeCorner();let y=1,x=0;for(;y<i;){y=this.xN(f,y,y>1);let b=this.getPoint(y);if(y>=i-1){if(!f.equals(b))this.computeShortLength(!1)!==0&&(b=this.Nf(b.copy(),!1,C.xo)),this.xn(d,-o,-r,f,b,s);else if(x===0)for(y=1;y<i;)m.a(f),b=this.getPoint(y++),this.xn(d,-o,-r,f,b,s),f.a(b);break}x=this.xN(b,y+1,y<i-3);const M=this.getPoint(x);this.NO(d,-o,-r,f,b,M,f,m,p,s),m.a(b),y=x}C.e(f)}return Ls.vC(d),this.kh=!0,t}}A1(t,i,s,n){let o=s-t;if(isNaN(o)||o===1/0||o===-1/0)return NaN;o<0&&(o=-o);let r=n-i;return isNaN(r)||r===1/0||r===-1/0?NaN:(r<0&&(r=-r),O.z(o,0)?r:O.z(r,0)?o:Math.sqrt(o*o+r*r))}MO(t,i,s,n,o,r){isNaN(n)&&(n=this.smoothness/3);const a=t.x,h=t.y,l=i.x,c=i.y,d=s.x,f=s.y,m=n*this.A1(a,h,l,c),p=n*this.A1(l,c,d,f);if(O.z(h,c)&&O.z(l,d)&&(l>a?f>c?(o.x=l-m,o.y=c-m,r.x=l+p,r.y=c+p):(o.x=l-m,o.y=c+m,r.x=l+p,r.y=c-p):f>c?(o.x=l+m,o.y=c-m,r.x=l-p,r.y=c+p):(o.x=l+m,o.y=c+m,r.x=l-p,r.y=c-p)),O.z(a,l)&&O.z(c,f)&&(c>h?d>l?(o.x=l-m,o.y=c-m,r.x=l+p,r.y=c+p):(o.x=l+m,o.y=c-m,r.x=l-p,r.y=c+p):d>l?(o.x=l-m,o.y=c+m,r.x=l+p,r.y=c-p):(o.x=l+m,o.y=c+m,r.x=l-p,r.y=c-p)),O.z(a,l)&&O.z(l,d)||O.z(h,c)&&O.z(c,f)){const y=.5*(a+d),x=.5*(h+f);o.x=y,o.y=x,r.x=y,r.y=x}}Nf(t,i,s){const n=this.pointsCount;if(n<2)return t;if(i){const o=this.getPoint(1),r=o.x-s.x,a=o.y-s.y,h=this.A1(t.x,t.y,r,a);if(h===0)return t;const l=n===2?h*.5:h;let c=this.computeShortLength(!0);c>l&&(c=l);const d=c*(r-t.x)/h,f=c*(a-t.y)/h;t.x+=d,t.y+=f}else{const o=this.getPoint(n-2),r=o.x-s.x,a=o.y-s.y,h=this.A1(t.x,t.y,r,a);if(h===0)return t;const l=n===2?h*.5:h;let c=this.computeShortLength(!1);c>l&&(c=l);const d=c*(t.x-r)/h,f=c*(t.y-a)/h;t.x-=d,t.y-=f}return t}xN(t,i,s){const n=this.pointsCount;let o=t;for(;O.z(t.x,o.x)&&O.z(t.y,o.y);){if(i>=n)return n-1;o=this.getPoint(i++)}if(!O.z(t.x,o.x)&&!O.z(t.y,o.y))return i-1;let r=o;for(;O.z(t.x,o.x)&&O.z(o.x,r.x)&&(!s||(t.y>=o.y?o.y>=r.y:o.y<=r.y))||O.z(t.y,o.y)&&O.z(o.y,r.y)&&(!s||(t.x>=o.x?o.x>=r.x:o.x<=r.x));){if(i>=n)return n-1;r=this.getPoint(i++)}return i-2}NO(t,i,s,n,o,r,a,h,l,c){if(O.f(n.y,o.y)&&O.f(o.x,r.x)){let d=Math.min(l,Math.abs(o.x-h.x)/2);const f=Math.min(d,Math.abs(r.y-o.y)/2);if(d=f,O.f(d,0)){this.xn(t,i,s,n,o,c),a.a(o);return}let m=o.x;const p=o.y,y=m;let x=p;o.x>n.x?(m=o.x-d,r.y>o.y?x=o.y+f:x=o.y-f):(m=o.x+d,r.y>o.y?x=o.y+f:x=o.y-f);const b=C.V(m,p);this.xn(t,i,s,n,b,c),C.e(b),t.Cw(o.x+i,o.y+s,y+i,x+s),a.i(y,x)}else if(O.f(n.x,o.x)&&O.f(o.y,r.y)){let d=Math.min(l,Math.abs(o.y-h.y)/2);const f=Math.min(d,Math.abs(r.x-o.x)/2);if(d=f,O.f(f,0)){this.xn(t,i,s,n,o,c),a.a(o);return}const m=o.x;let p=o.y,y=m;const x=p;o.y>n.y?(p=o.y-d,r.x>o.x?y=o.x+f:y=o.x-f):(p=o.y+d,r.x>o.x?y=o.x+f:y=o.x-f);const b=C.V(m,p);this.xn(t,i,s,n,b,c),C.e(b),t.Cw(o.x+i,o.y+s,y+i,x+s),a.i(y,x)}else this.xn(t,i,s,n,o,c),a.a(o)}computeJumpLength(){return 10}xn(t,i,s,n,o,r){if(r||!this.Ba())t.lr(o.x+i,o.y+s);else{const a=this.computeJumpLength(),h=a/2,l=[];let c=0;this.isVisible()&&(c=this.CO(n,o,l));let d=n.x,f=n.y;if(c>0){if(O.f(n.y,o.y))if(n.x<o.x){let m=0;for(;m<c;){const p=Math.max(n.x,Math.min(l[m++]-h,o.x-a));t.lr(p+i,o.y+s),d=p+i,f=o.y+s;let y=Math.min(p+a,o.x);for(;m<c;){const P=l[m];if(P<y+a)m++,y=Math.min(P+h,o.x);else break}const x=o.y-a+s,b=y+i,M=o.y+s;this.curve===10?t.hu(b,M,!1,!1):t.hr(d,x,b,x,b,M),d=b,f=M}}else{let m=c-1;for(;m>=0;){const p=Math.min(n.x,Math.max(l[m--]+h,o.x+a));t.lr(p+i,o.y+s),d=p+i,f=o.y+s;let y=Math.max(p-a,o.x);for(;m>=0;){const P=l[m];if(P>y-a)m--,y=Math.max(P-h,o.x);else break}const x=o.y-a+s,b=y+i,M=o.y+s;this.curve===10?t.hu(b,M,!1,!1):t.hr(d,x,b,x,b,M),d=b,f=M}}else if(O.f(n.x,o.x))if(n.y<o.y){let m=0;for(;m<c;){const p=Math.max(n.y,Math.min(l[m++]-h,o.y-a));t.lr(o.x+i,p+s),d=o.x+i,f=p+s;let y=Math.min(p+a,o.y);for(;m<c;){const P=l[m];if(P<y+a)m++,y=Math.min(P+h,o.y);else break}const x=o.x-a+i,b=o.x+i,M=y+s;this.curve===10?t.hu(b,M,!1,!1):t.hr(x,f,x,M,b,M),d=b,f=M}}else{let m=c-1;for(;m>=0;){const p=Math.min(n.y,Math.max(l[m--]+h,o.y+a));t.lr(o.x+i,p+s),d=o.x+i,f=p+s;let y=Math.max(p-a,o.y);for(;m>=0;){const P=l[m];if(P>y-a)m--,y=Math.max(P-h,o.y);else break}const x=o.x-a+i,b=o.x+i,M=y+s;this.curve===10?t.hu(b,M,!1,!1):t.hr(x,f,x,M,b,M),d=b,f=M}}}t.lr(o.x+i,o.y+s)}}CO(t,i,s){const n=this.diagram;if(n===null||t.equals(i))return 0;const o=n.layers;for(;o.next();){const r=o.value;if(r!==null&&r.visible){const a=r.qS(),h=a.length;for(let l=0;l<h;l++){const c=a[l];if(!(c instanceof Bt))continue;if(c===this)return s.length>0&&s.sort((m,p)=>m-p),s.length;if(!c.isVisible()||!c.Ba())continue;const d=c.routeBounds;if(!d.isReal()||!this.routeBounds.intersectsRect(d)||this.usesSamePort(c))continue;const f=c.path;f!==null&&f.isVisibleObject()&&this.LO(t,i,s,c)}}}return s.length>0&&s.sort((r,a)=>r-a),s.length}LO(t,i,s,n){const o=O.f(t.y,i.y),r=n.pointsCount;let a=n.getPoint(0);const h=C.l();for(let l=1;l<r;l++){const c=n.getPoint(l);if(l<r-1){const d=n.getPoint(l+1);if(a.y===c.y&&c.y===d.y){if(c.x>a.x&&d.x>=c.x||c.x<a.x&&d.x<=c.x)continue}else if(a.x===c.x&&c.x===d.x&&(c.y>a.y&&d.y>=c.y||c.y<a.y&&d.y<=c.y))continue}this.AO(t,i,a,c,h)&&(o?s.push(h.x):s.push(h.y)),a=c}C.e(h)}AO(t,i,s,n,o){const r=t.x,a=t.y,h=i.x,l=i.y,c=s.x,d=s.y,f=n.x,m=n.y;if(O.f(r,h)){if(!O.f(a,l)&&O.f(d,m)&&Math.min(a,l)<d&&Math.max(a,l)>d&&Math.min(c,f)<r&&Math.max(c,f)>r&&!O.f(c,f))return o.x=r,o.y=d,!0}else if(O.f(a,l)&&O.f(c,f)&&Math.min(r,h)<c&&Math.max(r,h)>c&&Math.min(d,m)<a&&Math.max(d,m)>a&&!O.f(d,m))return o.x=c,o.y=a,!0;return o.x=0,o.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.Dd(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.Dd(this.computeSpot(!1))?t-2:t-1}Ba(){const t=this.curve;return t===11||t===10}M1(t){if(t||this.Ba()){const i=this.diagram;i!==null&&!i.animationManager.isTicking&&!i.$l.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&i.$l.set(this,this.Sf.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(i===null||!i.visible||i.isTemporary)return;const s=i.diagram;if(s===null||s.animationManager.isTicking)return;let n=!1;const o=s.layers;for(;o.next();){const r=o.value;if(r.visible){if(r===i){n=!0;let a=!1;const h=r.qS(),l=h.length;for(let c=0;c<l;c++){const d=h[c];d instanceof Bt&&(d===this?a=!0:a&&this.MT(d,t))}}else if(n){const a=r.qS(),h=a.length;for(let l=0;l<h;l++){const c=a[l];c instanceof Bt&&this.MT(c,t)}}}}}MT(t,i){if(t===null||!t.kh||!t.Se||!t.Ba())return;const s=t.routeBounds;s.isReal()&&(!this.routeBounds.intersectsRect(s)&&!i.intersectsRect(s)||this.usesSamePort(t)||t.ee())}usesSamePort(t){const i=this.pointsCount,s=t.pointsCount;if(i>0&&s>0){const n=this.getPoint(0),o=t.getPoint(0);if(n.equalsApprox(o))return!0;const r=this.getPoint(i-1),a=t.getPoint(s-1);if(r.equalsApprox(a)||n.equalsApprox(a)||r.equalsApprox(o))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const s=this.diagram;s!==null&&(i=s.isTreePathToChildren);const n=this.fromNode;if(n!==null){if(this.isTreeLink&&i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let r=n;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=n.findVisibleNode();if(a===null||a===t)return!1}const o=this.toNode;if(o!==null){if(this.isTreeLink&&!i&&!o.isTreeExpanded)return!1;if(o===t)return!0;let r=o;for(;r!==null;){if(r.labeledLink===this)return!0;r=r.containingGroup}const a=o.findVisibleNode();if(a===null||a===t)return!1}return!0}Ei(t){if(super.Ei(t),t&&this.M1(!1),this.jo!==null&&this.jo.Sd(),this.js!==null){const i=this.js.iterator;for(;i.next();)i.value.Ei(t)}}get adjusting(){return this.Pf}set adjusting(t){const i=this.Pf;i!==t&&(this.Pf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Pf}get corner(){return this.Cd}set corner(t){const i=this.Cd;i!==t&&(this.Cd=t,this.ee(),this.t("corner",i,t))}get curve(){return this.Ld}set curve(t){const i=this.Ld;i!==t&&(this.Ld=t,this.invalidateRoute(),this.ee(),this.M1(i===10||i===11||t===10||t===11),this.t("curve",i,t))}get curviness(){return this.Ad}set curviness(t){const i=this.Ad;i!==t&&(this.Ad=t,this.invalidateRoute(),this.ee(),this.t("curviness",i,t))}get routing(){return this.va}set routing(t){const i=this.va;i!==t&&(this.va=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.Vm=!0),this.Ko=null,this.invalidateRoute(),this.M1(Bt.mN(i)||Bt.mN(t)),this.t("routing",i,t))}get smoothness(){return this.Td}set smoothness(t){const i=this.Td;i!==t&&(this.Td=t,this.ee(),this.t("smoothness",i,t))}xy(){const t=this.so;if(t===null)return;const i=this.oo;if(i===null||!isNaN(this.curviness))return;const s=this.no,n=this.ro;let o=null,r=null;const a=t.ti.r,h=a.length;for(let l=0;l<h;l++){const c=a[l];!(c.so===t&&c.no===s&&c.oo===i&&c.ro===n)&&!(c.so===i&&c.no===n&&c.oo===t&&c.ro===s)||(r===null?r=c:(o===null&&(o=[],o.push(r)),o.push(c)))}if(o!==null){let l=t.mT(i,s,n);l===null&&(l=new yu(t,s,i,n),t.dT(l),i.dT(l)),l.Hs=o;for(let c=0;c<o.length;c++){const d=o[c];d.jo=l}l.Sd()}}wy(){const t=this.jo;if(t!==null){if(!isNaN(this.curviness))return;this.jo=null;const i=t.Hs.indexOf(this);i>=0&&(t.Hs.splice(i,1),t.Sd())}}Cl(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Ra()))return t.model.getKeyForLinkData(this.data)}};g(Bt,"Ia",null),g(Bt,"Ea",null),g(Bt,"Normal",1),g(Bt,"Orthogonal",2),g(Bt,"AvoidsNodes",6),g(Bt,"AvoidsNodesStraight",7),g(Bt,"None",0),g(Bt,"Bezier",9),g(Bt,"JumpGap",10),g(Bt,"JumpOver",11),g(Bt,"End",17),g(Bt,"Scale",18),g(Bt,"Stretch",19),g(Bt,"OrientAlong",21),g(Bt,"OrientPlus90",22),g(Bt,"OrientMinus90",23),g(Bt,"OrientOpposite",24),g(Bt,"OrientUpright",25),g(Bt,"OrientPlus90Upright",26),g(Bt,"OrientMinus90Upright",27),g(Bt,"OrientUpright45",28),g(Bt,"hO",8),g(Bt,"aO",16),g(Bt,"cO",14),g(Bt,"Ua",8);let St=Bt;class yu{constructor(e,t,i,s){g(this,"Fo");g(this,"Is");g(this,"ly");g(this,"lN");g(this,"p1");g(this,"hN");g(this,"Hs");I.Ki(this),this.Fo=!1,this.Is=!1,this.ly=e,this.lN=t,this.p1=i,this.hN=s,this.Hs=[]}Sd(){if(!this.Fo){const e=this.Hs;if(e.length>0){const t=e[0].diagram;t!==null&&(t.wM.add(this),this.Is=t.undoManager.isUndoingRedoing)}}this.Fo=!0}RM(){if(this.Fo){this.Fo=!1;const e=this.Hs;if(e.length>0){const t=e[0],i=t.diagram,s=i===null||i.Vh&&!this.Is;this.Is=!1,t.arrangeBundledLinks(e,s),e.length===1&&(t.jo=null,e.length=0)}e.length===0&&(this.ly.gT(this),this.p1.gT(this))}}}const _t=class _t{constructor(e){g(this,"oe");g(this,"re");g(this,"Va");g(this,"za");g(this,"di");g(this,"gi");g(this,"Vt");g(this,"Ph");g(this,"Sh");g(this,"ua");g(this,"jM");g(this,"Fo");g(this,"ky");g(this,"Gc");g(this,"HM");g(this,"qM");I.Ki(this),this.ua=null,this.jM=null,this.Fo=!0,this.ky=!1,this.oe=1,this.re=1,this.Va=-1,this.za=-1,this.di=e.width,this.gi=e.height,this.Vt=[],this.Ph=0,this.Sh=0,this.Gc=11,this.HM=this.Gc*2,this.qM=this.Gc*2}Lb(e){if(e.width<=0||e.height<=0)return;const t=e.x,i=e.y,s=e.x+e.width,n=e.y+e.height;this.oe=Math.floor((t-this.di)/this.di)*this.di,this.re=Math.floor((i-this.gi)/this.gi)*this.gi,this.Va=Math.ceil((s+2*this.di)/this.di)*this.di,this.za=Math.ceil((n+2*this.gi)/this.gi)*this.gi;const o=1+(Math.ceil((this.Va-this.oe)/this.di)|0),r=1+(Math.ceil((this.za-this.re)/this.gi)|0);if(this.Vt.length===0||this.Ph<o-1||this.Sh<r-1){const a=[];for(let h=0;h<=o;h++)a[h]=new Uint32Array(r);this.Vt=a,this.Ph=o-1,this.Sh=r-1}this.TO(_t.bN)}get bounds(){return new G(this.oe,this.re,this.Va-this.oe,this.za-this.re)}get cellWidth(){return this.di}set cellWidth(e){e>0&&e!==this.di&&(this.di=e,this.Lb(this.bounds))}get cellHeight(){return this.gi}set cellHeight(e){e>0&&e!==this.gi&&(this.gi=e,this.Lb(this.bounds))}vd(e,t){return this.oe<=e&&e<=this.Va&&this.re<=t&&t<=this.za}lo(e,t){if(!this.vd(e,t))return _t.bN;e-=this.oe,e/=this.di,t-=this.re,t/=this.gi;const i=e|0,s=t|0;return this.Vt[i][s]}VR(e,t,i,s){if(!this.vd(e,t))return;const n=(e-this.oe)/this.di|0,o=(t-this.re)/this.gi|0,r=(e+i-this.oe)/this.di|0,a=(t+s-this.re)/this.gi|0,h=Math.min(r,this.Ph),l=Math.min(a,this.Sh);for(let c=n;c<=h;c++){const d=this.Vt[c];if(d.fill)d.fill(_t.qs,o,l+1);else for(let f=o;f<=l;f++)d[f]=_t.qs}}TO(e){for(let t=0;t<=this.Ph;t++){const i=this.Vt[t];if(i.fill)i.fill(e);else for(let s=0;s<=this.Sh;s++)i[s]=e}}rA(){for(let e=0;e<=this.Ph;e++){const t=this.Vt[e];for(let i=0;i<=this.Sh;i++)t[i]>=_t.Xa&&(t[i]=_t.bN)}}DO(e,t){return this.lo(e,t)===_t.qs}isUnoccupied(e,t,i,s){if(e>this.Va||e+i<this.oe||t>this.za||t+s<this.re)return!0;let n=(e-this.oe)/this.di|0,o=(t-this.re)/this.gi|0,r=Math.max(0,i)/this.di+1|0,a=Math.max(0,s)/this.gi+1|0;if(n<0&&(r+=n,n=0),o<0&&(a+=o,o=0),r<0||a<0)return!0;const h=Math.min(n+r-1,this.Ph)|0,l=Math.min(o+a-1,this.Sh)|0;for(let c=n;c<=h;c++){const d=this.Vt[c];for(let f=o;f<=l;f++)if(d[f]===_t.qs)return!1}return!0}maxAvoidsLinksSpaceH(e,t,i,s){if(e>this.Va||t<this.oe||i>this.za||i<this.re)return 0;const n=(e-this.oe)/this.di|0,o=(t-this.oe)/this.di|0,r=(i-this.re)/this.gi|0,a=s/this.gi+1|0;let h;for(h=0;h<a/2;h++){let l=!1;for(let c=n;c<=o;c++)if(this.Vt[c][r+h]===_t.qs||this.Vt[c][r-h]===_t.qs){l=!0;break}if(l)return Math.max(0,(2*h-1)*this.gi)}return s}maxAvoidsLinksSpaceV(e,t,i,s){if(e>this.za||t<this.re||i>this.Va||i<this.oe)return 0;const n=(e-this.re)/this.gi|0,o=(t-this.re)/this.gi|0,r=(i-this.oe)/this.di|0,a=s/this.di+1|0;let h;for(h=0;h<a/2;h++){let l=!1;for(let c=n;c<=o;c++)if(this.Vt[r+h][c]===_t.qs||this.Vt[r-h][c]===_t.qs){l=!0;break}if(l)return Math.max(0,(2*h-1)*this.di)}return s}FO(e,t,i,s,n,o,r,a){e=e|0,t=t|0;let h=this.Vt[e][t];if(h>=_t.Xa&&h<_t.Rd)for(s?t+=i:e+=i,h+=1;n<=e&&e<=o&&r<=t&&t<=a;){const l=this.Vt[e][t];if(h>=l)break;this.Vt[e][t]=h,h+=1,s?t+=i:e+=i}return s?t:e}ho(e,t,i,s,n,o,r,a){if(e<n||e>o||t<r||t>a)return;const h=this.FO(e,t,i,s,n,o,r,a);if(s)if(i>0)for(let l=t+i;l<h;l+=i)this.ho(e,l,1,!s,n,o,r,a),this.ho(e,l,-1,!s,n,o,r,a);else for(let l=t+i;l>h;l+=i)this.ho(e,l,1,!s,n,o,r,a),this.ho(e,l,-1,!s,n,o,r,a);else if(i>0)for(let l=e+i;l<h;l+=i)this.ho(l,t,1,!s,n,o,r,a),this.ho(l,t,-1,!s,n,o,r,a);else for(let l=e+i;l>h;l+=i)this.ho(l,t,1,!s,n,o,r,a),this.ho(l,t,-1,!s,n,o,r,a)}T1(e,t,i,s,n,o,r,a,h,l){let c=e|0,d=t|0,f=_t.qs,m=_t.Xa;for(this.Vt[c][d]=m;f===_t.qs&&c>r&&c<a&&d>h&&d<l;)m+=1,this.Vt[c][d]=m,o?d+=n:c+=n,f=this.Vt[c][d];return o?d:c}D1(e,t,i,s,n,o,r,a,h,l){let c=i|0,d=s|0,f=_t.qs;const m=_t.Rd;for(this.Vt[c][d]=m;f===_t.qs&&c>r&&c<a&&d>h&&d<l;)this.Vt[c][d]=m,o?d+=n:c+=n,f=this.Vt[c][d]}NT(e,t,i,s,n,o){this.ky=!1;let r=e.x,a=e.y;if(!this.vd(r,a))return;r-=this.oe,r/=this.di,a-=this.re,a/=this.gi;let h=i.x,l=i.y;if(!this.vd(h,l))return;if(h-=this.oe,h/=this.di,l-=this.re,l/=this.gi,Math.abs(r-h)<=1&&Math.abs(a-l)<=1){this.ky=!0;return}let c=n.x,d=n.y,f=n.x+n.width,m=n.y+n.height;c-=this.oe,c/=this.di,d-=this.re,d/=this.gi,f-=this.oe,f/=this.di,m-=this.re,m/=this.gi;const p=Math.max(0,Math.min(this.Ph,c|0)),y=Math.min(this.Ph,Math.max(0,f|0)),x=Math.max(0,Math.min(this.Sh,d|0)),b=Math.min(this.Sh,Math.max(0,m|0)),M=0,P=90,k=270,L=this.Vt,T=r|0,D=a|0,B=h|0,E=l|0,R=t===M||t===P?1:-1,F=t===P||t===k;L[T][D]===_t.qs?(this.T1(T,D,B,E,R,F,p,y,x,b),this.T1(T,D,B,E,1,!F,p,y,x,b),this.T1(T,D,B,E,-1,!F,p,y,x,b)):this.T1(T,D,B,E,R,F,T,D,T,D),L[B][E]===_t.qs?(this.D1(T,D,B,E,s===M||s===P?1:-1,s===P||s===k,p,y,x,b),this.D1(T,D,B,E,1,!(s===P||s===k),p,y,x,b),this.D1(T,D,B,E,-1,!(s===P||s===k),p,y,x,b)):this.D1(T,D,B,E,R,F,B,E,B,E);const V=u.et();if(o&&this.CT(B,E,s,T,D,V)){(V[0]!==B||V[1]!==E)&&(V.unshift(E),V.unshift(B)),(V[V.length-2]!==T||V[V.length-1]!==D)&&(V.push(T),V.push(D));let K=_t.Xa,H=V[V.length-2],W=V[V.length-1];L[H][W]=K++;for(let J=V.length-4;J>=0;J-=2){H=V[J+2],W=V[J+3];const $=V[J],et=V[J+1];for(;$>H?H++:$<H?H--:et>W?W++:et<W&&W--,L[H][W]=K++,!(H===$&&W===et););}}else this.ho(T,D,1,!1,p,y,x,b),this.ho(T,D,-1,!1,p,y,x,b),this.ho(T,D,1,!0,p,y,x,b),this.ho(T,D,-1,!0,p,y,x,b);u.J(V)}CT(e,t,i,s,n,o){const r=this.Vt;let a=e,h=t;for(;;){if(a===s&&h===n)return!0;let l=a,c=h;if(i===0)if(l<s)l++;else break;else if(i===90)if(c<n)c++;else break;else if(i===180)if(l>s)l--;else break;else if(c>n)c--;else break;const d=r[l][c];if(d===0||d===_t.kN)break;a=l,h=c}for(;;){let l=i,c=a,d=h;i===0?d<n?(l=90,d++):d>n&&(l=270,d--):i===90?c<s?(l=0,c++):c>s&&(l=180,c--):i===180?d<n?(l=90,d++):d>n&&(l=270,d--):c<s?(l=0,c++):c>s&&(l=180,c--);const f=r[c][d];if(l!==i&&f!==0&&f!==_t.kN){if(o.push(a),o.push(h),this.CT(a,h,l,s,n,o))return!0;o.pop(),o.pop()}if(r[a][h]=_t.kN,i===0){if(a===e)return!1;a--}else if(i===90){if(h===t)return!1;h--}else if(i===180){if(a===e)return!1;a++}else{if(h===t)return!1;h++}}}};g(_t,"qs",0),g(_t,"Xa",1),g(_t,"Rd",999999),g(_t,"bN",_t.Rd+1),g(_t,"kN",_t.Rd+2);let Bi=_t;class Ko{constructor(e,t){g(this,"Me");g(this,"al");g(this,"os");g(this,"Od");I.Ki(this),this.Me=e,this.al=t,this.os=[],this.Od=!1}toString(){const e=this.os;let t=this.Me.toString()+" "+e.length.toString()+":";for(let i=0;i<e.length;i++){const s=e[i];s!==null&&(t+=`
  `+s.toString())}return t}RO(e,t,i,s){const n=t.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(e.height,e.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Sd(){this.os.length=0}ST(e){let t=this.os;t.length===0&&(this.vO(),t=this.os);for(let i=0;i<t.length;i++){const s=t[i];if(s!==null&&s.Ke===e)return s}return null}vO(){if(!this.Od){const e=this.Od;this.Od=!0;let t,i=null;const s=this.Me,n=s instanceof Nt?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.Od=e,this.os;i=n,t=i.findExternalLinksConnected()}else s.isTreeExpanded?t=s.findLinksConnected(this.al.portId):t=s.findExternalTreeLinksConnected();this.os.length=0;let o=0;const r=this.al.getDocumentPoint(U.TopLeft,C.l()),a=this.al.getDocumentPoint(U.BottomRight,C.l()),h=G.V(r.x,r.y,0,0);h.unionPoint(a),C.e(r),C.e(a);const l=C.V(h.x+h.width/2,h.y+h.height/2),c=this.al.getDocumentAngle(),d=t.iterator;for(;d.next();){const y=d.value;if(!y.isVisible()||y.fromPort===y.toPort)continue;const x=y.fromPort===this.al||y.fromNode!==null&&i!==null&&y.fromNode.isMemberOf(i),b=y.computeSpot(x,this.al);if(!b.isSide())continue;let M;if(x?M=y.toPort:M=y.fromPort,M===null)continue;let P=M.part;if(P===null)continue;const k=P.findVisibleNode();k!==null&&k!==P&&(P=k,M=P.port);const L=y.computeOtherPoint(P,M);let T=l.directionPoint(L);T-=c,T<0?T+=360:T>=360&&(T-=360);const D=this.RO(h,b,T,y.isOrthogonal);let B=0;D===0?(B=4,T>180&&(T-=360)):D===90?(B=8,T>270&&(T-=360)):D===180?B=2:(B=1,T<90&&(T+=360));let E=this.os[o];E===void 0?(E=new xu(y,T,B),this.os[o]=E):(E.Ke=y,E.Yt=T,E.me=B),E.F1.set(L),o++}C.e(l),this.OO();const f=this.os.length;let m=-1,p=0;for(o=0;o<f;o++){const y=this.os[o];y!==void 0&&(y.me!==m&&(m=y.me,p=0),y.Id=p,p++)}for(m=-1,p=0,o=f-1;o>=0;o--){const y=this.os[o];y!==void 0&&(y.me!==m&&(m=y.me,p=y.Id+1),y.Mf=p)}this.IO(this.os),this.EO(this.os),this.Od=e,G.e(h)}return this.os}UO(e,t){return e===t?0:e===null?-1:t===null?1:e.me<t.me?-1:e.me>t.me?1:e.Yt<t.Yt?-1:e.Yt>t.Yt?1:0}OO(){this.os.sort(Ko.prototype.UO)}IO(e){const t=this.al,i=this.Me.portSpreading,s=C.l(),n=C.l(),o=C.l(),r=C.l();t.getDocumentPoint(U.TopLeft,s),t.getDocumentPoint(U.TopRight,n),t.getDocumentPoint(U.BottomRight,o),t.getDocumentPoint(U.BottomLeft,r);let a=0,h=0,l=0,c=0;if(i===2)for(let M=0;M<e.length;M++){const P=e[M];if(P===null)continue;const k=P.Ke.computeThickness();switch(P.me){case 8:l+=k;break;case 2:c+=k;break;case 1:a+=k;break;default:case 4:h+=k;break}}let d=0,f=0,m=1,p=n,y=o,x=0,b=0;for(let M=0;M<e.length;M++){const P=e[M];if(P===null)continue;if(d!==P.me){switch(d=P.me,d){case 8:p=o,y=r;break;case 2:p=r,y=s;break;case 1:p=s,y=n;break;default:case 4:p=n,y=o;break}switch(x=y.x-p.x,b=y.y-p.y,d){case 8:l>Math.abs(x)?(m=Math.abs(x)/l,l=Math.abs(x)):m=1;break;case 2:c>Math.abs(b)?(m=Math.abs(b)/c,c=Math.abs(b)):m=1;break;case 1:a>Math.abs(x)?(m=Math.abs(x)/a,a=Math.abs(x)):m=1;break;default:case 4:h>Math.abs(b)?(m=Math.abs(b)/h,h=Math.abs(b)):m=1;break}f=0}const k=P.Fd;if(i===2){let L=P.Ke.computeThickness();switch(L*=m,k.set(p),d){case 8:k.x=p.x+x/2+l/2-f-L/2;break;case 2:k.y=p.y+b/2+c/2-f-L/2;break;case 1:k.x=p.x+x/2-a/2+f+L/2;break;default:case 4:k.y=p.y+b/2-h/2+f+L/2;break}f+=L}else{let L=.5;i===1&&(L=(P.Id+1)/(P.Mf+1)),k.x=p.x+x*L,k.y=p.y+b*L}}C.e(s),C.e(n),C.e(o),C.e(r)}EO(e){for(let t=0;t<e.length;t++){const i=e[t];i!==null&&(i.L1=this.BO(i))}}BO(e){const t=e.Ke,i=t.fromPort===this.al,s=t.computeEndSegmentLength(this.Me,this.al,U.None,i);let n=e.Id;if(n<0)return s;const o=e.Mf;if(o<=1||!t.isOrthogonal)return s;const r=e.F1,a=e.Fd;(e.me===2||e.me===8)&&(n=o-1-n);const h=St.hO,l=e.me===2||e.me===4;return(l?r.y<a.y:r.x<a.x)?s+n*h:(l?r.y===a.y:r.x===a.x)?s:s+(o-1-n)*h}}class xu{constructor(e,t,i){g(this,"Ke");g(this,"Yt");g(this,"me");g(this,"F1");g(this,"Id");g(this,"Mf");g(this,"Fd");g(this,"L1");this.Ke=e,this.Yt=t,this.me=i,this.F1=new C,this.Id=0,this.Mf=0,this.Fd=new C,this.L1=0}toString(){return this.Ke.toString()+" "+this.Yt.toString()+" "+this.me.toString()+":"+this.Id.toString()+"/"+this.Mf.toString()+" "+this.Fd.toString()+" "+this.L1.toString()+" "+this.F1.toString()}}class jn{constructor(){g(this,"ga");g(this,"ma");g(this,"pa");g(this,"ya");g(this,"wa");g(this,"xa");g(this,"O0");g(this,"R0");g(this,"I0");g(this,"v0");this.ga=U.Default,this.ma=U.Default,this.pa=NaN,this.ya=NaN,this.wa=NaN,this.xa=NaN,this.O0=null,this.R0=null,this.I0=1/0,this.v0=1/0}copy(){const e=new jn;return e.ga=this.ga.P(),e.ma=this.ma.P(),e.pa=this.pa,e.ya=this.ya,e.wa=this.wa,e.xa=this.xa,e.O0=this.O0,e.R0=this.R0,e.I0=this.I0,e.v0=this.v0,e}}class Ji{constructor(){g(this,"N0");g(this,"C0");g(this,"L0");g(this,"M0");g(this,"yp");g(this,"wp");this.N0=-1/0,this.C0=0,this.L0=C.xo,this.M0=0,this.yp="None",this.wp="None"}copy(){const e=new Ji;return e.N0=this.N0,e.C0=this.C0,e.L0=this.L0.P(),e.M0=this.M0,e.yp=this.yp,e.wp=this.wp,e}}class Nt extends gt{constructor(t,i){let s;t===void 0||t instanceof Yt||typeof t=="string"?s=t:t&&(i=t);super(s);g(this,"Ed");g(this,"Ft");g(this,"ca");g(this,"h0");g(this,"si");g(this,"ie");this.v=this.v|4608,this.Ed=new I,this.Ft=null,this.ie=new De,this.ie.group=this,this.ca=new I,this.h0=null,this.si=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),this.v=this.v&-32769;const i=t.findInVisualTree(s=>s instanceof si);i instanceof si?t.Ft=i:t.Ft=null,this.ie!==null?(t.ie=this.ie.copy(),t.ie.group=t):(t.ie!==null&&(t.ie.group=null),t.ie=null),this.si!==null&&(t.si=this.si.copy())}vo(t){super.vo(t);const i=t.findSubGraphParts(),s=t.memberParts;for(;s.next();){const n=s.value;if(n.c(),n.invalidateLayout(8),n.clearAdornments(),n instanceof gt)n.invalidateConnectedLinks(i);else if(n instanceof St){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(i)}}}qc(t,i,s,n,o,r,a){if(t===3&&i==="elements"){if(o instanceof si)this.Ft===null?this.Ft=o:this.Ft!==o&&u.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(o instanceof bt){const h=o.findInVisualTree(l=>l instanceof si);h instanceof si&&(this.Ft===null?this.Ft=h:this.Ft!==h&&u.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&i==="elements"&&this.Ft!==null&&(n===this.Ft?this.Ft=null:n instanceof bt&&this.Ft.isContainedBy(n)&&(this.Ft=null));super.qc(t,i,s,n,o,r,a)}Ju(t,i){if(super.Ju(t,i),this.isClipping&&this.type!==bt.Spot&&this.isSubGraphExpanded){let s=this.resizeObject;s instanceof bt&&(s=s.findMainElement()),this.si===null&&(this.si=new G),s.getDocumentBounds(this.si),s instanceof At&&this.si.inflate(-s.strokeWidth,-s.strokeWidth)}}uh(t,i,s,n){this.hasPlaceholder()&&(this.Go=this.placeholder),super.uh(t,i,s,n)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(t=>{t.ensureBounds()}),super.ensureBounds()}Yr(){if(!super.Yr())return!1;const t=this.memberParts;for(;t.next();){const i=t.value;if(i instanceof gt){if(!i.isVisible())continue;if(i._e())return!1}else if(i instanceof St){if(!i.isVisible())continue;if(i._e()&&i.fromNode!==this&&i.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.Ft!==null&&this.Ft.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Ft}get computesBoundsAfterDrag(){return(this.v&2048)!==0}set computesBoundsAfterDrag(t){const i=(this.v&2048)!==0;i!==t&&(this.v=this.v^2048,this.t("computesBoundsAfterDrag",i,t))}get computesBoundsIncludingLinks(){return(this.v&4096)!==0}set computesBoundsIncludingLinks(t){const i=(this.v&4096)!==0;i!==t&&(this.v=this.v^4096,this.t("computesBoundsIncludingLinks",i,t))}get computesBoundsIncludingLocation(){return(this.v&8192)!==0}set computesBoundsIncludingLocation(t){const i=(this.v&8192)!==0;i!==t&&(this.v=this.v^8192,this.t("computesBoundsIncludingLocation",i,t))}get handlesDragDropForMembers(){return(this.v&16384)!==0}set handlesDragDropForMembers(t){const i=(this.v&16384)!==0;i!==t&&(this.v=this.v^16384,this.t("handlesDragDropForMembers",i,t))}get avoidableMembers(){return(this.v&131072)!==0}set avoidableMembers(t){const i=(this.v&131072)!==0;i!==t&&(this.v=this.v^131072,this.t("avoidableMembers",i,t))}get memberParts(){return this.Ed.iterator}sN(t){if(this.Ed.add(t)){t instanceof Nt&&this.ca.add(t);const s=this.memberAdded;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,t),o!==null&&(o.X=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!1)}if(t instanceof St&&!this.computesBoundsIncludingLinks)return;let i=this.Ft;i===null&&(i=this),i.c()}eN(t){if(this.Ed.delete(t)){t instanceof Nt&&this.ca.delete(t);const s=this.memberRemoved;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.X,o.X=!0),s(this,t),o!==null&&(o.X=n)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Ei(!0)}if(t instanceof St&&!this.computesBoundsIncludingLinks)return;let i=this.Ft;i===null&&(i=this),i.c()}Xc(){if(this.Ed.count>0){const t=this.diagram;if(t!==null){const i=this.Ed.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}super.Xc()}get layout(){return this.ie}set layout(t){const i=this.ie;if(i!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&u.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),i!==null&&(i.diagram=null,i.group=null),this.ie=t;const s=this.diagram;t!==null&&(t.diagram=s,t.group=this),s!==null&&(s.Vr=!0),this.t("layout",i,t),s!==null&&s.requestUpdate()}}get memberAdded(){return this.Rt!==null?this.Rt.gy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(t!==null&&u.k(t,Nt,"memberAdded"),this.ll().gy=t,this.t("memberAdded",i,t))}get memberRemoved(){return this.Rt!==null?this.Rt.my:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(t!==null&&u.k(t,Nt,"memberRemoved"),this.ll().my=t,this.t("memberRemoved",i,t))}get memberValidation(){return this.Rt!==null?this.Rt.nh:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(t!==null&&u.k(t,Nt,"memberValidation"),this.ll().nh=t,this.t("memberValidation",i,t))}canAddMembers(t){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.m2(t).iterator;for(;n.next();){const o=n.value;if(!s.isValidMember(this,o))return!1}return!0}addMembers(t,i){const s=this.diagram;if(s===null)return!1;const n=s.commandHandler,o=n.m2(t);let r=!0;const a=o.iterator;for(;a.next();){const h=a.value;!i||n.isValidMember(this,h)?h.containingGroup=this:r=!1}return r}get ungroupable(){return(this.v&256)!==0}set ungroupable(t){const i=(this.v&256)!==0;i!==t&&(this.v=this.v^256,this.t("ungroupable",i,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const i=t.diagram;return!(i!==null&&!i.allowUngroup)}invalidateConnectedLinks(t){const i=this.VO();if(super.invalidateConnectedLinks(t),i)return;this.XL(!0);const s=this.findExternalLinksConnected();for(;s.next();){const n=s.value;if(t!==void 0&&t.has(n))continue;const o=n.fromNode;if(o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible())o.qi(n.fromPort),o.qi(n.toPort),n.invalidateRoute();else{const r=n.toNode;r!==null&&r!==this&&r.isMemberOf(this)&&!r.isVisible()&&(r.qi(n.fromPort),r.qi(n.toPort),n.invalidateRoute())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.MM;if(t&&this.h0!==null)return this.h0.iterator;const i=this.findSubGraphParts();i.add(this);const s=new I,n=i.iterator;for(;n.next();){const o=n.value;if(!(o instanceof gt))continue;const r=o.linksConnected;for(;r.next();){const a=r.value;i.has(a)||s.add(a)}}return t&&(this.h0=s),s.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const i=new I,s=t.iterator;for(;s.next();){const n=s.value;if(!(n instanceof gt))continue;const o=n.linksConnected;for(;o.next();){const r=o.value,a=r.fromNode;a!==null&&(!t.has(a)||a===this)&&i.add(a);const h=r.toNode;h!==null&&(!t.has(h)||h===this)&&i.add(h)}}return i.iterator}vE(){function t(s,n){s!==null&&(n.add(s),t(s.containingGroup,n))}const i=new I;return t(this,i),i}findSubGraphParts(){const t=new I;return Ht.oh(t,this,!0,0,!0),t.delete(this),t}Ei(t){super.Ei(t);const i=this.memberParts;for(;i.next();)i.value.Ei(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.LT(i,t,this),t.isCollapsingExpanding=!1}LT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!1),o instanceof Nt&&o.isSubGraphExpanded&&(o.wasSubGraphExpanded=o.isSubGraphExpanded,o.LT(t,i,s)),o instanceof gt)o.invalidateConnectedLinks(t),i.Lc(o,s);else if(o instanceof St){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.AT(i,t,this),t.isCollapsingExpanding=!1}AT(t,i,s){const n=this.memberParts;for(;n.next();){const o=n.value;if(o.Ei(!0),o instanceof Nt&&o.wasSubGraphExpanded&&(o.wasSubGraphExpanded=!1,o.AT(t,i,s)),o instanceof gt)o.invalidateConnectedLinks(t);else if(o instanceof St){const r=o.labelNodes;for(;r.next();)r.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.v&512)!==0}set isSubGraphExpanded(t){const i=(this.v&512)!==0;if(i!==t){this.v=this.v^512;const s=this.diagram;this.t("isSubGraphExpanded",i,t);const n=this.subGraphExpandedChanged;if(n!==null){let o=!0;s!==null&&(o=s.X,s.X=!0),n(this),s!==null&&(s.X=o)}if(s!==null&&s.undoManager.isUndoingRedoing){this.Ft!==null&&this.Ft.c(),this.memberParts.each(o=>o.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.v&1024)!==0}set wasSubGraphExpanded(t){const i=(this.v&1024)!==0;i!==t&&(this.v=this.v^1024,this.t("wasSubGraphExpanded",i,t))}get subGraphExpandedChanged(){return this.Rt!==null?this.Rt.yy:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(t!==null&&u.k(t,Nt,"subGraphExpandedChanged"),this.ll().yy=t,this.t("subGraphExpandedChanged",i,t))}move(t,i){i===void 0&&(i=!1);const s=i?this.location:this.position,n=s.x,o=s.y,r=t.x,a=t.y;if((n===r||isNaN(n)&&isNaN(r))&&(o===a||isNaN(o)&&isNaN(a)))return;const h=r-(isNaN(n)?0:n),l=a-(isNaN(o)?0:o),c=C.l();super.move(t,i);const d=new I,f=this.findSubGraphParts().iterator;for(;f.next();){const m=f.value;m instanceof St&&(m.suspendsRouting&&d.add(m),!(!m.Se&&(m.fromNode===this||m.toNode===this))&&(m.suspendsRouting=!0))}for(f.reset();f.next();){const m=f.value;if(m.Cl()||m instanceof gt&&m.isLinkLabel)continue;const p=m.position,y=m.location;p.isReal()?(c.x=p.x+h,c.y=p.y+l,m.position=c):y.isReal()&&(c.x=y.x+h,c.y=y.y+l,m.location=c)}for(f.reset();f.next();){const m=f.value;if(!(m instanceof St)||(m.suspendsRouting=d.has(m),!m.Se&&(m.fromNode===this||m.toNode===this)))continue;const p=m.position;c.x=p.x+h,c.y=p.y+l,c.isReal()?m.move(c):m.invalidateRoute()}C.e(c)}VO(){return(this.v&65536)!==0}XL(t){(this.v&65536)!==0!==t&&(this.v=this.v^65536)}get fa(){return(this.v&32768)!==0}set fa(t){(this.v&32768)!==0!==t&&(this.v=this.v^32768)}}class si extends Xt{constructor(t){super();g(this,"Zt");g(this,"Ud");this.Zt=wt.Rg,this.Ud=new G(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Zt=this.Zt.P(),t.Ud=this.Ud.copy()}fh(t){if(this.background===null)return!1;const i=this.naturalBounds;return G.contains(0,0,i.width,i.height,t.x,t.y)}Wu(t,i,s,n){const o=this.part;if((o===null||!(o instanceof Nt)&&!(o instanceof Ft))&&u.o("Placeholder is not inside a Group or Adornment."),o instanceof Nt){const r=this.computeBorder(this.Ud),a=this.minSize,h=isFinite(a.width)?Math.max(a.width,r.width):r.width,l=isFinite(a.height)?Math.max(a.height,r.height):r.height,c=this.zi;c.Fn(h||0,l||0),this.Wn(0,0,c.width,c.height);const d=o.memberParts;let f=!1;for(;d.next();)if(d.value.isVisible()){f=!0;break}const m=o.diagram;if(f&&m!==null&&!m.animationManager.US(o)&&!isNaN(r.x)&&!isNaN(r.y)){const p=C.l();p.setRectSpot(r,o.locationSpot),o.location=p,C.e(p)}}else{const r=o,a=this.zi,h=this.Zt,l=h.left+h.right,c=h.top+h.bottom,d=r.adornedObject,f=d.getDocumentAngle();r.angle=f;let m=0;d instanceof At&&(m=d.strokeWidth);const p=d.getDocumentScale(),y=d.naturalBounds,x=(y.width+m)*p,b=(y.height+m)*p;if(r.type!==bt.Link){const M=r.category==="Selection"?U.TopLeft:r.locationSpot,P=d.getDocumentPoint(M,C.l());r.location=P,C.e(P)}if(!isNaN(x)&&!isNaN(b))a.Fn(x+l||0,b+c||0),this.Wn(-h.left,-h.top,a.width,a.height);else{const M=d.getDocumentPoint(U.TopLeft,C.l()),P=G.V(M.x,M.y,0,0);P.unionPoint(d.getDocumentPoint(U.BottomRight,M)),P.unionPoint(d.getDocumentPoint(U.TopRight,M)),P.unionPoint(d.getDocumentPoint(U.BottomLeft,M)),a.Fn(P.width+l||0,P.height+c||0),this.Wn(-h.left,-h.top,a.width,a.height),C.e(M),G.e(P)}}}uh(t,i,s,n){this.actualBounds.i(t,i,s,n)}computeBorder(t){const i=this.part,s=i.diagram,n=s===null||!s.animationManager.isAnimating;if(s!==null&&i instanceof Nt&&!i.layer.isTemporary&&i.computesBoundsAfterDrag&&this.Ud.isReal()){const h=s.toolManager.findTool("Dragging");if(h===s.currentTool){const l=h.computeBorder(i,this.Ud,t);if(l!==null)return l}}const o=G.l(),r=this.computeMemberBounds(o),a=this.Zt;return i instanceof Nt&&!i.isSubGraphExpanded?t.i(r.x-a.left,r.y-a.top,0,0):t.i(r.x-a.left,r.y-a.top,Math.max(r.width+a.left+a.right,0),Math.max(r.height+a.top+a.bottom,0)),G.e(o),n&&i instanceof Nt&&i.computesBoundsIncludingLocation&&i.location.isReal()&&t.unionPoint(i.location),t}computeMemberBounds(t){if(!(this.part instanceof Nt))return t.i(0,0,0,0),t;const i=this.part;let s=1/0,n=1/0,o=-1/0,r=-1/0;const a=i.memberParts;for(;a.next();){const h=a.value;if(!h.isVisible()||h instanceof St&&(!i.computesBoundsIncludingLinks||h.To()||h.fromNode===i||h.toNode===i))continue;const l=h.actualBounds;l.left<s&&(s=l.left),l.top<n&&(n=l.top),l.right>o&&(o=l.right),l.bottom>r&&(r=l.bottom)}if(!isFinite(s)||!isFinite(n)){const h=i.location;t.i(h.x,h.y,0,0)}else t.i(s,n,o-s,r-n);return t}get padding(){return this.Zt}set padding(t){typeof t=="number"&&(t=new wt(t));const i=this.Zt;i.equals(t)||(t=t.P(),this.Zt=t,this.t("padding",i,t),this.c())}}class De{constructor(e){g(this,"N");g(this,"ua");g(this,"Bd");g(this,"wr");g(this,"Vd");g(this,"zd");g(this,"Co");g(this,"cl");g(this,"Xd");g(this,"Yd");g(this,"ao");I.Ki(this),this.N=null,this.ua=null,this.Bd=!0,this.wr=!0,this.Vd=!1,this.zd=new C(0,0).u(),this.Co=!0,this.cl=null,this.Xd=null,this.Yd=!1,this.ao=null,e&&Object.assign(this,e)}cloneProtected(e){e.Bd=this.Bd,e.wr=this.wr,e.Vd=this.Vd,e.zd.a(this.zd),e.Co=this.Co,e.cl=this.cl,e.Xd=this.Xd,e.Yd=!0}copy(){const e=new this.constructor;return this.cloneProtected(e),e}oi(e){}toString(){let e=u.Dn(this.constructor);return e+="(",this.group!==null&&(e+=" in "+this.group),this.diagram!==null&&(e+=" for "+this.diagram),e+=")",e}get diagram(){return this.N}set diagram(e){this.N=e}get group(){return this.ua}set group(e){this.ua!==e&&(this.ua=e,e!==null&&(this.N=e.diagram))}get isOngoing(){return this.Bd}set isOngoing(e){this.Bd!==e&&(u.s(e,"boolean",De,"isOngoing"),this.Bd=e)}get isInitial(){return this.wr}set isInitial(e){u.s(e,"boolean",De,"isInitial"),this.wr=e,e||(this.Yd=!0)}get isViewportSized(){return this.Vd}set isViewportSized(e){this.Vd!==e&&(u.s(e,"boolean",De,"isViewportSized"),this.Vd=e,e&&this.invalidateLayout())}get isRouting(){return this.Co}set isRouting(e){this.Co!==e&&(u.s(e,"boolean",De,"isRouting"),this.Co=e)}get isRealtime(){return this.cl}set isRealtime(e){this.cl!==e&&(e!==null&&u.s(e,"boolean",De,"isRealtime"),this.cl=e)}get isValidLayout(){return this.Yd}set isValidLayout(e){if(this.Yd!==e&&(u.s(e,"boolean",De,"isValidLayout"),this.Yd=e,!e)){const t=this.diagram;t!==null&&(t.Vr=!0)}}invalidateLayout(){if(this.isValidLayout){const e=this.diagram;if(e===null||e.undoManager.isUndoingRedoing)return;const t=e.animationManager;if(t.isTicking)return;t.defaultAnimation.isAnimating&&t.stopAnimation(),(this.isOngoing&&e.Vh||this.isInitial&&!e.Vh)&&(this.isValidLayout=!1,e.requestUpdate())}}get network(){return this.ao}set network(e){this.ao!==e&&(this.ao=e,e!==null&&(e.layout=this))}createNetwork(){return new _i(this)}makeNetwork(e){const t=this.createNetwork();return e instanceof zt?(t.addParts(e.nodes,!0),t.addParts(e.links,!0)):e instanceof Nt?t.addParts(e.memberParts):t.addParts(e.iterator),t}updateParts(){this.isValidLayout=!0;let e=this.diagram;if(e===null&&this.network!==null){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value.node;if(i!==null&&(e=i.diagram,e!==null))break}}try{e!==null&&e.startTransaction("Layout"),this.commitLayout()}finally{e!==null&&e.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const e=this.network.vertexes.iterator;for(;e.next();)e.value.commit();if(this.isRouting){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}doLayout(e){const t=new I;if(e instanceof zt?(this.Mh(t,e.nodes,!0,this.fa,!0,!1,!0),this.Mh(t,e.parts,!0,this.fa,!0,!1,!0)):e instanceof Nt?this.Mh(t,e.memberParts,!1,this.fa,!0,!1,!0):t.addAll(e.iterator),t.count>0){const i=this.diagram;i!==null&&i.startTransaction("Layout"),this.doMinimalNoNetworkLayout(t),i!==null&&i.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(e){const t=e.count,i=Math.ceil(Math.sqrt(t));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,a=0,h=0;const l=e.iterator;for(;l.next();){const c=l.value;c.ensureBounds();const d=c.measuredBounds,f=d.width,m=d.height;c.moveTo(o,r),c instanceof Nt&&(c.fa=!1),o+=Math.max(f,50)+20,h=Math.max(h,Math.max(m,50)),a>=i-1?(a=0,o=s,r+=h+20,h=0):a++}}fa(e){return!!(!e.location.isReal()&&!e.position.isReal()||e instanceof Nt&&e.fa)}Mh(e,t,i,s,n,o,r){const a=t.iterator;for(;a.next();){const h=a.value;if(!(i&&!h.isTopLevel)&&!(s!==null&&!s(h))&&h.canLayout())if(n&&h instanceof gt){if(h.isLinkLabel)continue;h instanceof Nt&&h.layout===null?this.Mh(e,h.memberParts,!1,s,n,o,r):(h.ensureBounds(),e.add(h))}else o&&h instanceof St?e.add(h):r&&h.ke()&&!(h instanceof gt)&&(h.ensureBounds(),e.add(h))}}getLayoutBounds(e,t){const i=this.boundsComputation;return i!==null?(t||(t=new G),i(e,this,t)):!t&&e.margin.equalTo(0,0,0,0)?e.actualBounds:(t||(t=new G),t.set(e.actualBounds),t.addMargin(e.margin),t)}get boundsComputation(){return this.Xd}set boundsComputation(e){this.Xd!==e&&(e!==null&&u.k(e,De,"boundsComputation"),this.Xd=e,this.invalidateLayout())}collectParts(e){const t=new I;return e instanceof zt?(this.Mh(t,e.nodes,!0,null,!0,!0,!0),this.Mh(t,e.links,!0,null,!0,!0,!0),this.Mh(t,e.parts,!0,null,!0,!0,!0)):e instanceof Nt?this.Mh(t,e.memberParts,!1,null,!0,!0,!0):this.Mh(t,e.iterator,!1,null,!0,!0,!0),t}get arrangementOrigin(){return this.zd}set arrangementOrigin(e){this.zd.equals(e)||(this.zd.a(e),this.invalidateLayout())}initialOrigin(e){const t=this.group;if(t!==null)if(t.hasPlaceholder()){const i=t.placeholder,s=i.getDocumentPoint(U.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(e);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=t.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(e),i}return e}}class _i{constructor(e){g(this,"ie");g(this,"co");g(this,"bn");g(this,"Py");g(this,"Sy");I.Ki(this),this.ie=e,this.co=new I,this.bn=new I,this.Py=new Z,this.Sy=new Z}clear(){if(this.co){const e=this.co.iterator;for(;e.next();)e.value.clear()}if(this.bn){const e=this.bn.iterator;for(;e.next();)e.value.clear()}this.co=new I,this.bn=new I,this.Py=new Z,this.Sy=new Z}toString(e){e===void 0&&(e=0);let t="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(e<=0)return t;if(t+=" vertexes: "+this.co.count+" edges: "+this.bn.count,e>1){const i=this.co.iterator;for(;i.next();){const n=i.value;t+=`
    `+n.toString(e-1)}const s=this.bn.iterator;for(;s.next();){const n=s.value;t+=`
    `+n.toString(e-1)}}return t}get layout(){return this.ie}set layout(e){e!==null&&(this.ie=e)}get vertexes(){return this.co}get edges(){return this.bn}createVertex(){return new Zi(this)}createEdge(){return new Ds(this)}addParts(e,t,i){if(e===null)return;t===void 0&&(t=!1),u.s(t,"boolean",_i,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof gt)return!n.isLinkLabel;if(n instanceof St){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=e.iterator;for(;s.next();){const n=s.value;if(n instanceof gt&&!(t&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof Nt&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof St)||t&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const a=this.findGroupVertex(o),h=this.findGroupVertex(r);this.linkVertexes(a,h,n)}}findGroupVertex(e){const t=e.findVisibleNode();if(t===null)return null;let i=this.findVertex(t);if(i!==null)return i;let s=t.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(e){this.co.add(e);const t=e.node;t!==null&&this.Py.set(t,e),e.network=this}addNode(e){let t=this.findVertex(e);return t===null&&(t=this.createVertex(),t.node=e,this.addVertex(t)),t}deleteVertex(e){if(this.TT(e)){let t=e.Ho;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}t=e.qo;for(let i=t.count-1;i>=0;i--){const s=t.elt(i);this.deleteEdge(s)}}}TT(e){const t=this.co.delete(e);if(t){const i=e.node;i!==null&&this.Py.delete(i)}return t}deleteNode(e){const t=this.findVertex(e);t!==null&&this.deleteVertex(t)}findVertex(e){return this.Py.get(e)}addEdge(e){this.PN(e);const t=e.toVertex;t!==null&&t.addSourceEdge(e);const i=e.fromVertex;i!==null&&i.addDestinationEdge(e)}PN(e){this.bn.add(e);const t=e.link;t!==null&&this.findEdge(t)===null&&this.Sy.set(t,e),e.network=this}addLink(e){const t=e.fromNode,i=e.toNode;let s=this.findEdge(e);return s===null?(s=this.createEdge(),s.link=e,t!==null&&(s.fromVertex=this.addNode(t)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(t!==null?s.fromVertex=this.addNode(t):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(e){const t=e.toVertex;t!==null&&t.deleteSourceEdge(e);const i=e.fromVertex;i!==null&&i.deleteDestinationEdge(e),this.SN(e)}SN(e){const t=this.bn.delete(e);if(t){const i=e.link;i!==null&&this.Sy.delete(i)}return t}deleteLink(e){const t=this.findEdge(e);t!==null&&this.deleteEdge(t)}findEdge(e){return this.Sy.get(e)}linkVertexes(e,t,i){if(e===null||t===null)return null;if(e.network===this&&t.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=e,s.toVertex=t,this.addEdge(s),s}return null}reverseEdge(e){const t=e.fromVertex,i=e.toVertex;t===null||i===null||(t.deleteDestinationEdge(e),i.deleteSourceEdge(e),e.reverseEdge(),t.addSourceEdge(e),i.addDestinationEdge(e))}deleteSelfEdges(){const e=u.et(),t=this.bn.iterator;for(;t.next();){const s=t.value;s.fromVertex===s.toVertex&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);u.J(e)}deleteArtificialVertexes(){const e=u.et(),t=this.co.iterator;for(;t.next();){const o=t.value;o.node===null&&o.data===null&&e.push(o)}let i=e.length;for(let o=0;o<i;o++)this.deleteVertex(e[o]);const s=u.et(),n=this.bn.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);u.J(e),u.J(s)}deleteUselessEdges(){const e=u.et(),t=this.bn.iterator;for(;t.next();){const s=t.value;(s.fromVertex===null||s.toVertex===null)&&e.push(s)}const i=e.length;for(let s=0;s<i;s++)this.deleteEdge(e[s]);u.J(e)}isSingleton(e){return!(e.Ho.count>0||e.qo.count>0)}splitIntoSubNetworks(e){e===void 0&&(e=!0),e&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const t=new Y;let i=!0;for(;i;){i=!1;const s=this.co.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();t.add(o),this.zO(o,n),i=!0;break}}return t.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),t}zO(e,t){if(t===null)return;const i=new Y;for(i.add(t);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===e)continue;this.TT(s),e.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==e&&(this.SN(o),e.PN(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==e&&(this.SN(o),e.PN(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const e=new I,t=this.co.iterator;for(;t.next();){const s=t.value;s.node&&e.add(s.node)}const i=this.bn.iterator;for(;i.next();){const s=i.value;s.link&&e.add(s.link)}return e}}class Zi{constructor(e){g(this,"ao");g(this,"_t");g(this,"Me");g(this,"Le");g(this,"je");g(this,"Ho");g(this,"qo");I.Ki(this),this.ao=e,this.Le=new G(0,0,10,10).u(),this.je=new C(5,5).u(),this._t=null,this.Me=null,this.Ho=new Y,this.qo=new Y}clear(){this._t=null,this.Me=null,this.Ho=new Y,this.qo=new Y}toString(e){e===void 0&&(e=0);let t="LayoutVertex#"+I.as(this);if(e>0&&(t+=this.node!==null?"("+this.node.toString()+")":"",e>1)){let i="",s=!0,n=this.Ho.iterator;for(;n.next();){const r=n.value;s?s=!1:i+=",",i+=r.toString(0)}let o="";for(s=!0,n=this.qo.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}t+=" sources: "+i+" destinations: "+o}return t}get fo(){return this.Ho.uC}get Wo(){return this.qo.uC}get data(){return this._t}set data(e){if(this._t=e,e!==null&&e.bounds){const t=e.bounds,i=t.x,s=t.y,n=t.width,o=t.height;this.je.i(n/2,o/2),this.Le.i(i,s,n,o)}}get node(){return this.Me}set node(e){if(this.Me!==e){if(this.Me=e,e===null)return;e.ensureBounds();const t=this.network.layout,i=G.l(),s=t.getLayoutBounds(e,i);let n=s.x,o=s.y;const r=s.width,a=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Le.i(n,o,r,a),G.e(i),!(e instanceof Nt)){const h=e.locationObject.getDocumentPoint(U.Center);if(h.isReal()){this.je.i(h.x-n,h.y-o);return}}this.je.i(r/2,a/2)}}get bounds(){return this.Le}set bounds(e){this.Le.equals(e)||this.Le.a(e)}get focus(){return this.je}set focus(e){this.je.equals(e)||this.je.a(e)}get centerX(){return this.Le.x+this.je.x}set centerX(e){const t=this.Le;t.x+this.je.x!==e&&(t.Pt(),t.x=e-this.je.x,t.u())}get centerY(){return this.Le.y+this.je.y}set centerY(e){const t=this.Le;t.y+this.je.y!==e&&(t.Pt(),t.y=e-this.je.y,t.u())}get focusX(){return this.je.x}set focusX(e){const t=this.je;t.x!==e&&(t.Pt(),t.x=e,t.u())}get focusY(){return this.je.y}set focusY(e){const t=this.je;t.y!==e&&(t.Pt(),t.y=e,t.u())}get x(){return this.Le.x}set x(e){const t=this.Le;t.x!==e&&(t.Pt(),t.x=e,t.u())}get y(){return this.Le.y}set y(e){const t=this.Le;t.y!==e&&(t.Pt(),t.y=e,t.u())}get width(){return this.Le.width}set width(e){const t=this.Le;t.width!==e&&(t.Pt(),t.width=e,t.u())}get height(){return this.Le.height}set height(e){const t=this.Le;t.height!==e&&(t.Pt(),t.height=e,t.u())}commit(){const e=this._t;if(e!==null){const i=this.bounds,s=e.bounds;u.G(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):e.bounds=i.copy();return}const t=this.node;if(t!==null){const i=this.bounds;if(!(t instanceof Nt)){const s=G.l();t.ensureBounds();const n=this.network.layout.getLayoutBounds(t,s),o=t.locationObject.getDocumentPoint(U.Center);if(n.isReal()&&o.isReal()){t.moveTo(i.x+this.focusX-(o.x-n.x)+t.margin.left,i.y+this.focusY-(o.y-n.y+t.margin.top)),G.e(s);return}G.e(s)}t.moveTo(i.x+t.margin.left,i.y+t.margin.top)}}addSourceEdge(e){e!==null&&(this.Ho.has(e)||this.Ho.add(e))}deleteSourceEdge(e){e!==null&&this.Ho.delete(e)}addDestinationEdge(e){e!==null&&(this.qo.has(e)||this.qo.add(e))}deleteDestinationEdge(e){e!==null&&this.qo.delete(e)}get network(){return this.ao}set network(e){this.ao=e}get sourceVertexes(){const e=new I,t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}return e.iterator}get destinationVertexes(){const e=new I,t=this.destinationEdges;for(;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get vertexes(){const e=new I;let t=this.sourceEdges;for(;t.next();){const i=t.value;i.fromVertex&&e.add(i.fromVertex)}for(t=this.destinationEdges;t.next();){const i=t.value;i.toVertex&&e.add(i.toVertex)}return e.iterator}get sourceEdges(){return this.Ho.iterator}get destinationEdges(){return this.qo.iterator}get edges(){const e=new Y;let t=this.sourceEdges;for(;t.next();){const i=t.value;e.add(i)}for(t=this.destinationEdges;t.next();){const i=t.value;e.add(i)}return e.iterator}get edgesCount(){return this.Ho.count+this.qo.count}static standardComparer(e,t){const i=e.Me,s=t.Me;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(e,t){if(e!==null)if(t!==null){const i=e.Me,s=t.Me;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),a=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let h=0;for(;h<r.length;h++)if(a[h]!==""&&a[h]!==void 0){const l=parseFloat(r[h]),c=parseFloat(a[h]);if(isNaN(l))if(isNaN(c)){if(r[h].localeCompare(a[h])!==0)return r[h].localeCompare(a[h]);continue}else return 1;else{if(isNaN(c))return-1;if(l-c!==0)return l-c;continue}}else{if(r[h]==="")continue;return 1}return a[h]!==""&&a[h]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return t!==null?-1:0}}class Ds{constructor(e){g(this,"ao");g(this,"_t");g(this,"Ke");g(this,"He");g(this,"qe");I.Ki(this),this.ao=e,this._t=null,this.Ke=null,this.He=null,this.qe=null}clear(){this._t=null,this.Ke=null,this.He=null,this.qe=null}toString(e){e===void 0&&(e=0);let t="LayoutEdge#"+I.as(this);return e>0&&(t+=this.Ke!==null?"("+this.Ke.toString()+")":"",e>1&&(t+=" "+(this.He?this.He.toString():"null")+" --> "+(this.qe?this.qe.toString():"null"))),t}reverseEdge(){const e=this.He;this.He=this.qe,this.qe=e}commit(){}getOtherVertex(e){return this.qe===e?this.He:this.He===e?this.qe:null}get network(){return this.ao}set network(e){this.ao=e}get data(){return this._t}set data(e){this._t!==e&&(this._t=e)}get link(){return this.Ke}set link(e){this.Ke!==e&&(this.Ke=e)}get fromVertex(){return this.He}set fromVertex(e){this.He!==e&&(this.He=e)}get toVertex(){return this.qe}set toVertex(e){this.qe!==e&&(this.qe=e)}}var Uo=(S=>(S[S.Position=0]="Position",S[S.Location=1]="Location",S))(Uo||{}),Yo=(S=>(S[S.LeftToRight=10]="LeftToRight",S[S.RightToLeft=11]="RightToLeft",S))(Yo||{}),Xo=(S=>(S[S.Forwards=20]="Forwards",S[S.Reverse=21]="Reverse",S[S.Ascending=22]="Ascending",S[S.Descending=23]="Descending",S))(Xo||{});const vi=class vi extends De{constructor(t){super();g(this,"Gd");g(this,"Kd");g(this,"Po");g(this,"kn");g(this,"hi");g(this,"Xi");g(this,"pe");g(this,"ye");this.isViewportSized=!0,this.Gd=NaN,this.Kd=NaN,this.Po=new rt(NaN,NaN).u(),this.kn=new rt(10,10).u(),this.hi=1,this.Xi=10,this.pe=22,this.ye=vi.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Gd=this.Gd,t.Kd=this.Kd,t.Po.a(this.Po),t.kn.a(this.kn),t.hi=this.hi,t.Xi=this.Xi,t.pe=this.pe,t.ye=this.ye}oi(t){t in Xo?this.sorting=t:t in Yo?this.arrangement=t:t in Uo?this.alignment=t:super.oi(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),s=this.diagram,n=i.copy().iterator;for(;n.next();){const p=n.value;if(p.Cl()&&(p.fromNode!==null||p.toNode!==null)){i.delete(p);continue}if(p.ensureBounds(),p instanceof Nt){const y=p.memberParts;for(;y.next();){const x=y.value;i.delete(x)}}}const o=i.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let r=this.wrappingColumn;isNaN(r)&&(r=0);let a=this.wrappingWidth;if(isNaN(a)&&s!==null){const p=s.viewportBounds,y=s.padding;a=Math.max(p.width-y.left-y.right,0)}else a=Math.max(this.wrappingWidth,0);r<=0&&a<=0&&(r=1);let h=this.spacing.width;isFinite(h)||(h=0);let l=this.spacing.height;isFinite(l)||(l=0),s!==null&&s.startTransaction("Layout");const c=[];switch(this.alignment){case 0:this.XO(o,a,r,h,l,c);break;case 1:this.YO(o,a,r,h,l,c);break}let d=0,f=0,m=0;for(let p=0;p<c.length;p++){const y=c[p];d=Math.min(d,y.x),f=Math.min(f,y.y),m=Math.max(m,y.x+y.width)}this.arrangement===11?this.commitLayers(c,new C(d+h/2-(m+d),f-l/2)):this.commitLayers(c,new C(d-h/2,f-l/2)),s!==null&&s.commitTransaction("Layout"),this.isValidLayout=!0}XO(t,i,s,n,o,r){const a=G.l();let h=Math.max(this.cellSize.width,1);if(!isFinite(h)){h=0;for(let b=0;b<t.length;b++){const M=t[b],P=this.getLayoutBounds(M,a);h=Math.max(h,P.width)}}h+=n,h=Math.max(h,1);let l=Math.max(this.cellSize.height,1);if(!isFinite(l)){l=0;for(let b=0;b<t.length;b++){const M=t[b],P=this.getLayoutBounds(M,a);l=Math.max(l,P.height)}}l+=o,l=Math.max(l,1);const c=this.arrangement,d=this.arrangementOrigin.x,f=this.arrangementOrigin.y;let m=d,p=f,y=0,x=0;for(let b=0;b<t.length;b++){const M=t[b],P=this.getLayoutBounds(M,a),k=Math.ceil((P.width+n)/h),L=Math.ceil((P.height+o)/l),T=k*h,D=L*l;let B=0;switch(c){case 11:B=Math.abs(m-P.width);break;default:B=m+P.width;break}(s>0&&y>s-1||i>0&&y>0&&B-d>i)&&(r.push(new G(0,p,i+n,x)),y=0,m=d,p+=x,x=0),x=Math.max(x,D);let E=0;switch(c){case 11:E=-P.width;break;default:E=0;break}switch(M.moveTo(m+E+M.margin.left,p+M.margin.top),c){case 11:m-=T;break;default:m+=T;break}y++}r.push(new G(0,p,i+n,x)),G.e(a)}YO(t,i,s,n,o,r){const a=G.l();let h=Math.max(this.cellSize.width,1),l=0,c=0,d=0;const f=C.l();for(let E=0;E<t.length;E++){const R=t[E],F=this.getLayoutBounds(R,a),V=R.getRelativePoint(R.locationObject,R.locationSpot,f);l=Math.max(l,V.x),c=Math.max(c,F.width-V.x),d=Math.max(d,V.y)}const m=this.arrangement;switch(m){case 11:l+=n;break;default:c+=n;break}isFinite(h)?h=Math.max(h+n,1):h=Math.max(l+c,1);const p=this.arrangementOrigin.x,y=this.arrangementOrigin.y;let x=p,b=y,M=0;i>=l&&(i-=l);let P=0,k=0;const L=Math.max(this.cellSize.height,1);d=0;let T=0,D=!0;const B=C.l();for(let E=0;E<t.length;E++){const R=t[E],F=this.getLayoutBounds(R,a),V=R.getRelativePoint(R.locationObject,R.locationSpot,f);if(M>0)switch(m){case 11:{let H=(x-p-(F.width-V.x))/h;O.z(Math.round(H),H)?H=Math.round(H):H=Math.floor(H),x=H*h+p;break}default:{let H=(x-p+V.x)/h;O.z(Math.round(H),H)?H=Math.round(H):H=Math.ceil(H),x=H*h+p;break}}else switch(m){case 11:P=x+V.x+F.width;break;default:P=x-V.x;break}let K=0;switch(m){case 11:K=-(x+V.x)+P;break;default:K=x+F.width-V.x-P;break}if(s>0&&M>s-1||i>0&&M>0&&K>i){r.push(new G(0,D?b-d:b,i+n,T+d+o));for(let H=0;H<M&&E!==M;H++){const W=t[E-M+H],J=W.getRelativePoint(W.locationObject,W.locationSpot,B);W.moveTo(W.position.x,W.position.y+d-J.y)}T+=o,D?b+=T:b+=T+d,d=0,T=0,M=0,x=p,D=!1}switch(x===p&&(m===11?k=Math.max(k,F.width-V.x):k=Math.min(k,-V.x)),d=Math.max(d,V.y),T=Math.max(T,F.height-V.y),isFinite(L)&&(T=Math.max(T,Math.max(F.height,L)-V.y)),D?R.moveTo(x-V.x,b-V.y):R.moveTo(x-V.x,b),m){case 11:x-=V.x+n;break;default:x+=F.width-V.x+n;break}M++}if(r.push(new G(0,b,i+n,(D?T:T+d)+o)),t.length!==M)for(let E=0;E<M;E++){const R=t[t.length-M+E],F=R.getRelativePoint(R.locationObject,R.locationSpot,f);R.moveTo(R.position.x,R.position.y+d-F.y)}if(C.e(f),C.e(B),m===11)for(let E=0;E<r.length;E++){const R=r[E];R.width+=k,R.x-=k}else for(let E=0;E<r.length;E++){const R=r[E];R.x>k&&(R.width+=R.x-k,R.x=k)}G.e(a)}commitLayers(t,i){}get wrappingWidth(){return this.Gd}set wrappingWidth(t){this.Gd!==t&&(t>0||isNaN(t))&&(this.Gd=t,this.isViewportSized=isNaN(t),this.invalidateLayout())}get wrappingColumn(){return this.Kd}set wrappingColumn(t){this.Kd!==t&&(t>0||isNaN(t))&&(this.Kd=t,this.invalidateLayout())}get cellSize(){return this.Po}set cellSize(t){this.Po.equals(t)||(this.Po.a(t),this.invalidateLayout())}get spacing(){return this.kn}set spacing(t){this.kn.equals(t)||(this.kn.a(t),this.invalidateLayout())}get alignment(){return this.hi}set alignment(t){this.hi!==t&&(t===1||t===0)&&(this.hi=t,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===10||t===11)&&(this.Xi=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(t===20||t===21||t===22||t===23)&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}static standardComparer(t,i){const s=t.text,n=i.text;return s<n?-1:s>n?1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const s=t.text.toLocaleLowerCase(),n=i.text.toLocaleLowerCase(),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let a=0;for(;a<o.length;a++)if(r[a]!==""&&r[a]!==void 0){const h=parseFloat(o[a]),l=parseFloat(r[a]);if(isNaN(h))if(isNaN(l)){if(o[a].localeCompare(r[a])!==0)return o[a].localeCompare(r[a]);continue}else return 1;else{if(isNaN(l))return-1;if(h-l!==0)return h-l;continue}}else{if(o[a]==="")continue;return 1}return r[a]!==""&&r[a]!==void 0?-1:0}else return 1;else return i!==null?-1:0}};g(vi,"Position",0),g(vi,"Location",1),g(vi,"LeftToRight",10),g(vi,"RightToLeft",11),g(vi,"Forward",20),g(vi,"Reverse",21),g(vi,"Ascending",22),g(vi,"Descending",23);let Kn=vi;const Si=class Si{constructor(){g(this,"jd");g(this,"Hs");g(this,"Ct");g(this,"uo");g(this,"Hd");g(this,"qd");g(this,"N");g(this,"MN");this.jd=new I,this.Hs=new I,this.Ct=new I,this.uo=new Z,this.Hd=new Z,this.qd=new Z,this.N=null,this.MN=!1}clear(){this.jd.clear(),this.Hs.clear(),this.Ct.clear(),this.uo.clear(),this.Hd.clear(),this.qd.clear()}Mo(e){this.N=e}Jh(e){if(e instanceof gt){if(this.jd.add(e),e instanceof Nt){const i=e.containingGroup;i===null?this.diagram.zr.add(e):i.ca.add(e);const s=e.layout;s!==null&&(s.diagram=this.diagram)}}else e instanceof St?(this.Hs.add(e),e.isAvoiding&&(this.diagram.Vm=!0)):e instanceof Ft||this.Ct.add(e);const t=e.data;t!==null&&(e instanceof Ft||(e instanceof St?this.DT(t,e):this.uo.set(t,e)))}te(e){if(e.clearAdornments(),e instanceof gt){if(this.jd.delete(e),e instanceof Nt){const i=e.containingGroup;i===null?this.diagram.zr.delete(e):i.ca.delete(e);const s=e.layout;s!==null&&(s.diagram=null)}}else e instanceof St?this.Hs.delete(e):e instanceof Ft||this.Ct.delete(e);const t=e.data;t!==null&&(e instanceof Ft||(e instanceof St?this.FT(t,e):this.uo.delete(t)))}DT(e,t){this.Hd.set(e,t)}FT(e,t){this.Hd.delete(e)}rebuildParts(){const e=this.diagram;if(e===null)return;const t=e.nodeTemplateMap.iterator;for(;t.next();){const f=t.value,m=t.key;(!f.ke()||f instanceof Nt)&&u.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${m}" must be a Node or a simple Part, not a Group or Link: ${f}`)}const i=e.groupTemplateMap.iterator;for(;i.next();){const f=i.value,m=i.key;f instanceof Nt||u.o(`Invalid group template in Diagram.groupTemplateMap: template for "${m}" must be a Group, not a normal Node or Link: ${f}`)}const s=e.linkTemplateMap.iterator;for(;s.next();){const f=s.value,m=s.key;f instanceof St||u.o(`Invalid link template in Diagram.linkTemplateMap: template for "${m}" must be a Link, not a normal Node or simple Part: ${f}`)}const n=u.et(),o=e.selection.iterator;for(;o.next();){const f=o.value.data;f&&n.push(f)}const r=u.et(),a=e.highlighteds.iterator;for(;a.next();){const f=a.value.data;f&&r.push(f)}const h=u.et(),l=this.nodes.iterator;for(;l.next();){const f=l.value;f.data!==null&&(h.push(f.data),h.push(f.location))}const c=this.links.iterator;for(;c.next();){const f=c.value;f.data!==null&&(h.push(f.data),h.push(f.location))}const d=this.parts.iterator;for(;d.next();){const f=d.value;f.data!==null&&(h.push(f.data),h.push(f.location))}this.RT(),this.zM();for(let f=0;f<n.length;f++){const m=this.findPartForData(n[f]);m!==null&&(m.isSelected=!0)}for(let f=0;f<r.length;f++){const m=this.findPartForData(r[f]);m!==null&&(m.isHighlighted=!0)}for(let f=0;f<h.length;f+=2){const m=this.findPartForData(h[f]);m!==null&&(m.location=h[f+1])}u.J(n),u.J(r),u.J(h)}zM(){const e=this.diagram.model;this.My(e.nodeDataArray)}My(e,t){const i=this.diagram.model;e.forEach(s=>{i.containsNodeData(s)&&this.vT(s,!1)}),e.forEach(s=>{i.containsNodeData(s)&&this.R1(s)}),t!==!1&&this.diagram.Cb(!1)}vT(e,t){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.uo.has(e))return null;t===void 0&&(t=!0);const i=this.GO(e);return i!==null&&t&&this.R1(e),i}GO(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.uo.has(e))return null;const t=this.KO(e),i=this.findTemplateForNodeData(e,t);if(i!==null){i.Et();const s=i.copy();if(s!==null){const n=this.diagram.fe;return this.diagram.fe=!0,s.zo=t,s._t=e,this.addsToTemporaryLayer&&(s.nl="Tool"),this.diagram.add(s),s._t=null,s.data=e,this.diagram.fe=n,s}}return null}insertLink(e,t,i,s){return null}R1(e){}KO(e){return this.diagram.model.getCategoryForNodeData(e)}findTemplateForNodeData(e,t){const i=this.diagram,s=i.model,n=s.Hc()&&s.isGroupForData(e);let o=null;return n?(o=i.groupTemplateMap.get(t),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(Si.IT||(Si.IT=!0,u.ni('No Group template found for category "'+t+'"'),u.ni("  Using default group template")),o=i.yM))):(o=i.nodeTemplateMap.get(t),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(Si.OT||(Si.OT=!0,u.ni('No Node template found for category "'+t+'"'),u.ni("  Using default node template")),o=i.gM))),o}getLinkCategoryForData(e){return""}setLinkCategoryForData(e,t){}setFromNodeForLink(e,t,i){}setToNodeForLink(e,t,i){}findLinkTemplateForCategory(e){const t=this.diagram;let i=t.linkTemplateMap.get(e);return i===null&&(i=t.linkTemplateMap.get(""),i===null&&(Si.ET||(Si.ET=!0,u.ni('No Link template found for category "'+e+'"'),u.ni("  Using default link template")),i=t.mM)),i}vv(e,t,i){e instanceof St?(t!==null&&this.FT(t,e),i!==null&&this.DT(i,e)):e instanceof Ht&&(t!==null&&this.uo.delete(t),i!==null&&this.uo.set(i,e))}RT(){const e=this.diagram.model;this.NN(e.nodeDataArray)}NN(e){e.forEach(t=>{this.v1(t)})}v1(e){const t=this.findPartForData(e);t!==null&&(this.diagram.UM(t,!1),this.CN(t))}CN(e){}pN(e){}findPartForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);return t!==null?this.uo.get(t):null}findNodeForKey(e){if(e==null)return null;const t=this.diagram.model.findNodeDataForKey(e);if(t===null)return null;const i=this.uo.get(t);return i instanceof gt?i:null}findLinkForKey(e){return null}findPartForData(e){if(e===null)return null;let t=this.uo.get(e);return t!==null||(t=this.Hd.get(e)),t}findNodeForData(e){if(e===null)return null;const t=this.uo.get(e);return t instanceof gt?t:null}findLinkForData(e,t){return e===null?null:this.Hd.get(e)}findNodesByExample(...e){const t=new I,i=this.jd.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(u.G(r)&&this.LN(n,r)){t.add(s);break}}}return t.iterator}findLinksByExample(...e){const t=new I,i=this.Hs.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(u.G(r)&&this.LN(n,r)){t.add(s);break}}}return t.iterator}LN(e,t){for(const i in t){const s=e[i],n=t[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let a=0;a<o.length;a++){const h=o[a],l=r[a];if(l!==void 0&&!this.UT(h,l))return!1}}else if(!this.UT(s,n))return!1}return!0}UT(e,t){if(u.it(t)){if(!t(e))return!1}else if(t instanceof RegExp){if(!e||!t.test(e.toString()))return!1}else if(u.G(e)&&u.G(t)){if(!this.LN(e,t))return!1}else if(e!==t)return!1;return!0}doModelDataChanged(e){if(e.model===this.diagram.model&&this.diagram.X){this.diagram.X=!1;try{const t=e.change;e.modelChange===""&&e.object!==null&&t===2&&this.Ny(e.object,e.propertyName)}finally{this.diagram.X=!0}}}doModelChanged(e){const t=this.diagram;if(!t||e.model!==t.model)return;const i=e.change;if(t.IR(e),!!t.X){t.X=!1;try{const s=e.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=e.object;if(n!==null){const o=this.findPartForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}}else if(s==="nodeDataArray"){const n=e.oldValue;this.NN(n);const o=e.newValue;this.My(o)}t.isModified=!0}else if(i===3){const n=e.newValue;s==="nodeDataArray"&&u.G(n)&&this.vT(n),t.isModified=!0}else if(i===4){const n=e.oldValue;s==="nodeDataArray"&&u.G(n)&&this.v1(n),t.isModified=!0}else i===1&&(s==="SourceChanged"?e.object!==null?this.Ny(e.object,e.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()):o!==null&&this.Ny(o,n),t.isModified=!0}else(i===3||i===4)&&(this.jO(e,t.model),t.isModified=!0)}finally{t.X=!0}}}updateAllTargetBindings(e){e===void 0&&(e="");let t=this.parts.iterator;for(;t.next();)t.value.updateTargetBindings(e);for(t=this.nodes.iterator;t.next();)t.value.updateTargetBindings(e);for(t=this.links.iterator;t.next();)t.value.updateTargetBindings(e)}updateAllThemeBindings(){let e=this.parts.iterator;for(;e.next();)e.value.Do();for(e=this.nodes.iterator;e.next();)e.value.Do();for(e=this.links.iterator;e.next();)e.value.Do()}updateAllRelationshipsFromData(){const e=this.diagram.model,t=new I,i=e.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o];t.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!t.has(o.data)&&s.push(o.data)}),s.forEach(o=>e.BT(o,!1));for(let o=0;o<i.length;o++){const r=i[o];this.findPartForData(r)===null&&e.VT(r,!1)}this.zT();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}zT(){}updateRelationshipsFromData(e){}Ny(e,t){if(typeof t=="string"){const i=this.findPartForData(e);if(i!==null)i.updateTargetBindings(t);else{const s=this.HO(e);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(t);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(t)}u.J(s)}}e===this.diagram.model.modelData&&this.updateAllTargetBindings(t)}}HO(e){let t=null;const i=this.qd.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const o=s[n].findItemPanelForData(e);o!==null&&(t===null&&(t=u.et()),t.push(o))}if(t!==null)break}return t}AN(e){return this.qd.get(e)}jO(e,t){const i=e.object;if(!Array.isArray(i))return;const s=e.change===3,n=s?e.newParam:e.oldParam,o=s?e.newValue:e.oldValue,r=this.AN(i);if(Array.isArray(r))for(let a=0;a<r.length;a++){const h=r[a];s?h.e1(o,n,!0):h.Iv(n)}}IM(e,t){t!==null&&e.Gr(s=>t.GL(s));const i=e.wh;if(Array.isArray(i)){const s=this.AN(i);if(s===null)this.qd.set(i,[e]);else{for(let n=0;n<s.length;n++)if(s[n]===e)return;s.push(e)}}}EM(e,t){e.Gr(s=>t.UR(s));const i=e.wh;if(Array.isArray(i)){const s=this.AN(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===e){s.splice(n,1),s.length===0&&this.qd.delete(i);return}}}}copyParts(e,t,i){i===void 0&&(i=!1);const s=new Z;if(Array.isArray(e))for(let o=0;o<e.length;o++)this.O1(e[o],t,s,i);else{const o=e.iterator;for(;o.next();)this.O1(o.value,t,s,i)}if(t!==null){const o=t.model,r=t.o0().dragsLink,a=new I,h=new Z,l=s.iterator;for(;l.next();){const c=l.value;if(c instanceof St)!r&&(c.fromNode===null||c.toNode===null)&&a.add(c);else if(c instanceof gt&&c.data!==null){if(o.pm()){const d=c,f=l.key,m=f.findTreeParentNode();if(m!==null){const p=s.get(m);if(p!==null){o.setParentKeyForNodeData(d.data,o.getKeyForNodeData(p.data));const y=t.findLinkForData(d.data),x=f.findTreeParentLink();x!==null&&y!==null&&h.set(x,y)}}}else if(o.Mb()){const d=c,f=l.key,m=o.isRelatedKeysPathTo?f.findNodesOutOf():f.findNodesInto();for(;m.next();){const p=m.value,y=s.get(p);if(y!==null){o.addRelatedKeyForNodeData(d.data,y.key);const x=t.partManager.findLinkForData(d.data,y.key),b=this.findLinkForData(f.data,p.key);b!==null&&x!==null&&h.set(b,x)}else o.removeRelatedKeyForNodeData(d.data,p.key)}}}}if(a.count>0&&t.removeParts(a,!1),h.count>0){const c=h.iterator;for(;c.next();){const d=c.key,f=c.value;s.set(d,f)}}}if(t!==null&&this.diagram!==null){const o=t.model,r=o.afterCopyFunction;if(r!==null){const a=new Z;s.each(l=>{l.key.data!==null&&a.set(l.key.data,l.value.data)});const h=this.diagram.model;r(a,o,h)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}O1(e,t,i,s){if(e===null||s&&!e.canCopy())return null;if(i.has(e))return i.get(e);const n=this.TN(e,t);if(!(n instanceof Ht))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(e,n),e instanceof gt){const o=e.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===e){const a=i.get(r);a!==null&&(a.fromNode=n)}if(r.toNode===e){const a=i.get(r);a!==null&&(a.toNode=n)}}if(e instanceof Nt&&n instanceof Nt){const r=e.memberParts;for(;r.next();){const a=r.value,h=this.O1(a,t,i,s);h instanceof St||h!==null&&(h.containingGroup=n)}}}else if(e instanceof St&&n instanceof St){const o=e.fromNode;if(o!==null){const h=i.get(o);h!==null&&(n.fromNode=h)}const r=e.toNode;if(r!==null){const h=i.get(r);h!==null&&(n.toNode=h)}const a=e.labelNodes;for(;a.next();){const h=a.value,l=this.O1(h,t,i,s);l!==null&&l instanceof gt&&(l.labeledLink=n)}}return n}TN(e,t){let i=null;const s=e.data;if(s!==null&&t!==null){const n=t.model;if(!(e instanceof St)){const o=n.copyNodeData(s);u.G(o)&&(n.addNodeData(o),i=t.findPartForData(o))}}else if(e.Et(),i=e.copy(),i!==null){const n=this.diagram;if(t!==null)t.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;i instanceof St||(r=o.copyNodeData(s)),u.G(r)&&(i.data=r)}}return i}get nodes(){return this.jd}get links(){return this.Hs}get parts(){return this.Ct}get diagram(){return this.N}get addsToTemporaryLayer(){return this.MN}set addsToTemporaryLayer(e){this.MN=e}};g(Si,"OT",!1),g(Si,"IT",!1),g(Si,"ET",!1);let cs=Si;class wu extends cs{zM(){const e=this.diagram.model;this.My(e.nodeDataArray),this.XT(e.linkDataArray)}My(e){super.My(e,!1);const t=this.links.iterator;for(;t.next();)t.value.Pd();this.diagram.Cb(!1)}XT(e){e.forEach(t=>{this.YT(t)}),this.diagram.Cb(!1)}YT(e){if(e==null||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(e))return null;const t=this.getLinkCategoryForData(e),i=this.findLinkTemplateForCategory(t);if(i!==null){i.Et();const s=i.copy();if(s!==null){const n=this.diagram.fe;this.diagram.fe=!0,s.zo=t,s._t=e;const o=this.diagram.model,r=o.I1(e,!0);r!==""&&(s.fromPortId=r);const a=o.Ae(e,!0);if(a!==void 0){const d=this.findNodeForKey(a);d instanceof gt&&(s.fromNode=d)}const h=o.I1(e,!1);h!==""&&(s.toPortId=h);const l=o.Ae(e,!1);if(l!==void 0){const d=this.findNodeForKey(l);d instanceof gt&&(s.toNode=d)}const c=o.getLabelKeysForLinkData(e);return Array.isArray(c)&&c.forEach(d=>{const f=this.findNodeForKey(d);f!==null&&(f.labeledLink=s)}),this.addsToTemporaryLayer&&(s.nl="Tool"),this.diagram.add(s),s._t=null,s.data=e,this.diagram.fe=n,s}}return null}RT(){const e=this.diagram.model;this.GT(e.linkDataArray),this.NN(e.nodeDataArray)}GT(e){e.forEach(t=>{this.v1(t)})}getLinkCategoryForData(e){return this.diagram.model.getCategoryForLinkData(e)}setLinkCategoryForData(e,t){return this.diagram.model.setCategoryForLinkData(e,t)}setFromNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setFromKeyForLinkData(e.data,i.getKeyForNodeData(s))}setToNodeForLink(e,t){const i=this.diagram.model,s=t!==null?t.data:null;i.setToKeyForLinkData(e.data,i.getKeyForNodeData(s))}pN(e){this.diagram.model.removeLinkData(e.data)}findPartForKey(e){const t=super.findPartForKey(e);if(t===null){const i=this.diagram.model.findLinkDataForKey(e);if(i!==null)return this.findLinkForData(i)}return t}findLinkForKey(e){if(e==null)return null;const t=this.diagram.model.findLinkDataForKey(e);return t!==null?this.findLinkForData(t):null}doModelChanged(e){if(super.doModelChanged(e),!this.diagram)return;const t=this.diagram;if(e.model!==t.model)return;const i=e.change;if(t.X){t.X=!1;try{const s=e.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,a=this.findNodeForKey(r);o.fromNode=a}}else if(s==="linkToKey"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue,a=this.findNodeForKey(r);o.toNode=a}}else if(s==="linkFromPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=e.object,o=this.findPartForData(n);if(o!==null){const r=e.newValue;if(r!==void 0){const a=this.findNodeForKey(r);a instanceof Nt?o.containingGroup=a:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=e.object,o=this.findLinkForData(n);if(o!==null){const r=e.oldValue,a=e.newValue;Array.isArray(r)&&r.forEach(h=>{if(a.indexOf(h)>=0)return;const l=this.findNodeForKey(h);l!==null&&(l.labeledLink=null)}),Array.isArray(a)&&a.forEach(h=>{const l=this.findNodeForKey(h);l!==null&&(l.labeledLink=o)})}}else if(s==="linkCategory"){const n=e.object,o=this.findLinkForData(n),r=e.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=e.oldValue;this.GT(n);const o=e.newValue;this.XT(o)}t.isModified=!0}else if(i===3){const n=e.newValue;if(s==="linkDataArray"&&u.G(n))this.YT(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=e.object,r=this.findLinkForData(o),a=this.findNodeForKey(n);r!==null&&a!==null&&(a.labeledLink=r)}t.isModified=!0}else if(i===4){const n=e.oldValue;if(s==="linkDataArray"&&u.G(n))this.v1(n);else if(s==="linkLabelKeys"&&e.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}t.isModified=!0}}else if(i===2){const n=e.propertyName,o=e.object,r=t.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(t.undoManager.isUndoingRedoing||this.rebuildParts()),t.isModified=!0}}finally{t.X=!0}}}zT(){const e=this.diagram.model,t=new I,i=e.linkDataArray;i.forEach(n=>{t.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!t.has(n.data)&&s.push(n.data)}),s.forEach(n=>{e.KT(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&e.jT(n,!1)})}updateRelationshipsFromData(e){const t=e.data;if(t===null)return;const i=e.diagram;if(i===null)return;const s=i.model;if(e instanceof St){let n=s.Ae(t,!0),o=i.findNodeForKey(n);e.fromNode=o,n=s.Ae(t,!1),o=i.findNodeForKey(n),e.toNode=o;const r=s.getLabelKeysForLinkData(t);if(r.length>0||e.labelNodes.count>0){if(r.length===1&&e.labelNodes.count===1){const d=r[0],f=e.labelNodes.first();if(s.getKeyForNodeData(f.data)===d)return}const a=new I().addAll(r),h=new I;e.labelNodes.each(d=>{if(d.data!==null){const f=s.getKeyForNodeData(d.data);f!==void 0&&h.add(f)}});const l=h.copy();l.removeAll(a);const c=a.copy();if(c.removeAll(h),l.count>0||c.count>0){const d=e;l.each(f=>{const m=i.findNodeForKey(f);m!==null&&m.labeledLink===d&&(m.labeledLink=null)}),c.each(f=>{const m=i.findNodeForKey(f);m!==null&&m.labeledLink!==d&&(m.labeledLink=d)})}}}else if(!(e instanceof Ft)){const n=s.getGroupKeyForNodeData(t),o=i.findPartForKey(n);(o===null||o instanceof Nt)&&(e.containingGroup=o)}}R1(e){const t=this.diagram.model,i=t.getKeyForNodeData(e);if(i!==void 0){const s=t.Cy(i),n=this.findPartForData(e);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const a=r.value;if(t.containsNodeData(a)){if(n instanceof Nt&&t.getGroupKeyForNodeData(a)===i){const h=this.findPartForData(a);h!==null&&(h.containingGroup=n)}}else{const h=this.findLinkForData(a);if(h!==null&&n instanceof gt){t.Ae(a,!0)===i&&(h.fromNode=n),t.Ae(a,!1)===i&&(h.toNode=n);const l=t.getLabelKeysForLinkData(a);Array.isArray(l)&&l.some(c=>c===i?(n.labeledLink=h,!0):!1)}}}t.Ws(i)}const o=t.getGroupKeyForNodeData(e);if(o!==void 0){const r=this.findNodeForKey(o);r instanceof Nt&&(n.containingGroup=r)}}}CN(e){const t=this.diagram.model;if(e instanceof gt){const i=t.getKeyForNodeData(e.data);if(i!==void 0){const s=e.linksConnected;for(;s.next();){const n=s.value;t.Js(i,n.data)}if(e.isLinkLabel){const n=e.labeledLink;n!==null&&t.Js(i,n.data)}if(e instanceof Nt){const n=e.memberParts;for(;n.next();){const o=n.value.data;t.containsNodeData(o)&&t.Js(i,o)}}}}}TN(e,t){let i=super.TN(e,t);if(e instanceof St){const s=e.data;if(s!==null&&t!==null){const n=t.model,o=n.copyLinkData(s);u.G(o)&&(n.addLinkData(o),i=t.findLinkForData(o))}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model.copyLinkData(s);u.G(o)&&(i.data=o)}}}return i}insertLink(e,t,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let a="";e!==null&&(t===null&&(t=e),a=t.portId,a===null&&(a=""));let h="";i!==null&&(s===null&&(s=i),h=s.portId,h===null&&(h=""));const l=r.archetypeLinkData;if(l instanceof St){l.Et();const c=l.copy();if(c!==null){c.fromNode=e,c.fromPortId=a,c.toNode=i,c.toPortId=h,n.add(c);const d=r.archetypeLabelNodeData;if(d instanceof gt){d.Et();const f=d.copy();f!==null&&(f.labeledLink=c,n.add(f))}return c}}else if(l!==null){const c=o.copyLinkData(l);if(u.G(c)){e!==null&&o.Wd(c,o.getKeyForNodeData(e.data),!0),o.Jd(c,a,!0),i!==null&&o.Wd(c,o.getKeyForNodeData(i.data),!1),o.Jd(c,h,!1),o.addLinkData(c);const d=r.archetypeLabelNodeData;if(d!==null&&!(d instanceof gt)){const f=o.copyNodeData(d);if(u.G(f)){o.addNodeData(f);const m=o.getKeyForNodeData(f);m!==void 0&&o.addLabelKeyForLinkData(c,m)}}return n.findLinkForData(c)}}return null}}class bu extends cs{constructor(){super(...arguments);g(this,"Nh",null)}E1(t,i){if(t===null||i===null||i.findTreeParentLink()!==null)return null;const s=this.diagram.toolManager.findTool("Linking");let n=t,o=i;if(this.diagram.isTreePathToChildren){if(s!==null&&s.yu(n,o,null,!0))return null}else if(n=i,o=t,s!==null&&s.yu(n,o,null,!0))return null;const r=this.getLinkCategoryForData(i.data),a=this.findLinkTemplateForCategory(r);if(a!==null){a.Et();const h=a.copy();if(h!==null){const l=this.diagram.fe;return this.diagram.fe=!0,h.zo=r,h._t=i.data,h.fromNode=n,h.toNode=o,this.diagram.add(h),h._t=null,h.data=i.data,this.diagram.fe=l,h}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,i){this.diagram.model.setParentLinkCategoryForNodeData(t,i)}setFromNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren)n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o));else{const r=this.Nh;this.Nh=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const a=t.toNode!==null?t.toNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(a)),this.Nh=r}}setToNodeForLink(t,i,s){const n=this.diagram.model;s===void 0&&(s=null);const o=i!==null?i.data:null;if(this.diagram.isTreePathToChildren){const r=this.Nh;this.Nh=t,s!==null&&n.setParentKeyForNodeData(s.data,void 0);const a=t.fromNode!==null?t.fromNode.data:null;n.setParentKeyForNodeData(o,n.getKeyForNodeData(a)),this.Nh=r}else n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(o))}pN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.findLinkForData(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const s=t.change;if(i.X){i.X=!1;try{const n=t.modelChange;if(n!==""){if(s===2){if(n==="nodeParentKey"){const o=t.object,r=t.newValue,a=this.findNodeForKey(r),h=this.findNodeForData(o);if(this.Nh!==null)a!==null&&(this.Nh.data=o,this.Nh.category=this.getLinkCategoryForData(o));else if(h!==null){const l=h.findTreeParentLink();l!==null?a===null?i.remove(l):i.isTreePathToChildren?l.fromNode=a:l.toNode=a:this.E1(a,h)}}else if(n==="parentLinkCategory"){const o=t.object,r=this.findNodeForData(o),a=t.newValue;if(r!==null&&typeof a=="string"){const h=r.findTreeParentLink();h!==null&&(h.category=a)}}i.isModified=!0}}else if(s===2){const o=t.propertyName,r=t.object,a=i.model;r===a&&o==="nodeParentKeyProperty"&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.X=!0}}}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const s=t.diagram;if(s===null)return;const n=s.model;if(t instanceof gt){const o=n.getParentKeyForNodeData(i),r=s.findNodeForKey(o),a=t.findTreeParentNode();if(r!==a){const h=t.findTreeParentLink();r!==null?h!==null?s.isTreePathToChildren?h.fromNode=r:h.toNode=r:this.E1(r,t):h!==null&&s.UM(h,!1)}}}Ny(t,i){if(super.Ny(t,i),typeof i=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(i)}}R1(t){const i=this.diagram.model,s=i.getKeyForNodeData(t);if(s!==void 0){const n=i.Cy(s),o=this.findPartForData(t);if(n!==null&&o!==null){const a=n.iterator;for(;a.next();){const h=a.value;if(i.containsNodeData(h)&&o instanceof gt&&i.getParentKeyForNodeData(h)===s){const l=this.findNodeForData(h);this.E1(o,l)}}i.Ws(s)}const r=i.getParentKeyForNodeData(t);if(r!==void 0&&o instanceof gt){const a=this.findNodeForKey(r);this.E1(a,o)}}}CN(t){const i=this.diagram.model;if(t instanceof gt){const s=i.getKeyForNodeData(t.data),n=this.findLinkForData(t.data);if(n!==null){n.isSelected=!1,n.isHighlighted=!1;const a=n.layer;if(a!==null){const h=a.te(-1,n,!1);h>=0&&this.diagram.raiseChangedEvent(4,"parts",a,n,null,h,null);const l=n.layerChanged;l!==null&&l(n,a,null)}}const o=this.diagram.isTreePathToChildren,r=t.linksConnected;for(;r.next();){const a=r.value,h=(o?a.toNode:a.fromNode).data;i.containsNodeData(h)&&i.Js(s,h)}}}insertLink(t,i,s,n){const o=this.diagram.model;let r=t,a=s;if(this.diagram.isTreePathToChildren||(r=s,a=t),r!==null&&a!==null){const h=r.data,l=a.data;return o.setParentKeyForNodeData(l,o.getKeyForNodeData(h)),a.findTreeParentLink()}return null}}var Un=(S=>(S[S.OneWay=1]="OneWay",S[S.TwoWay=2]="TwoWay",S))(Un||{});const We=class We{constructor(e,t,i,s){g(this,"n");g(this,"DN");g(this,"Ya");g(this,"Cf");g(this,"Ch");g(this,"Lf");g(this,"Af");g(this,"Tf");g(this,"U1");g(this,"be");g(this,"ad");g(this,"ff");I.Ki(this),e===void 0?e="":u.s(e,"string",We,"constructor:targetprop"),t===void 0?t=e:u.s(t,"string",We,"constructor:sourceprop"),i===void 0?i=null:i!==null&&u.k(i,We,"constructor:conv"),this.DN=-1,this.be=null,this.Ya=e,this.ad=0,this.ff=0,this.Cf=null,this.Ch=t,this.Lf=i,s===void 0?(this.Af=1,this.Tf=null):(this.Af=2,this.Tf=s),this.U1=new I,this.n=2}copy(){const e=new this.constructor;return this.cloneProtected(e),e}cloneProtected(e){e.Ya=this.Ya,e.ad=this.ad,e.ff=this.ff,e.Cf=this.Cf,e.Ch=this.Ch,e.Lf=this.Lf,e.Af=this.Af,e.Tf=this.Tf,e.n=this.n&-2}static parseEnum(e,t){return u.k(e,We,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=u.Uh(e,i),s===null)?t:s}}oi(e){e in Un?this.mode=e:u.er(this,e)}static toString(e){return u.toString(e)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+Un[this.mode]+")"}u(){return this.n=this.n|1,this}get targetId(){return this.DN}set targetId(e){this.h&&u.L(this),this.DN=e}get targetProperty(){return this.Ya}set targetProperty(e){this.h&&u.L(this),u.s(e,"string",We,"targetProperty"),this.Ya=e}get sourceProperty(){return this.Ch}set sourceProperty(e){this.h&&u.L(this),u.s(e,"string",We,"sourceProperty"),this.Ch=e}get h(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get FN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}qu(){return!1}get sourceName(){return this.Cf}set sourceName(e){this.h&&u.L(this),e!==null&&u.s(e,"string",We,"sourceName"),this.Cf=e,e!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.Lf}set converter(e){this.h&&u.L(this),e!==null&&u.k(e,We,"converter"),this.Lf=e}get backConverter(){return this.Tf}set backConverter(e){this.h&&u.L(this),e!==null&&u.k(e,We,"backConverter"),this.Tf=e}get mode(){return this.Af}set mode(e){this.h&&u.L(this),this.isToTheme&&e===2&&u.o("Theme Bindings cannot be TwoWay."),this.Af=e}makeTwoWay(e){return this.isToTheme&&u.o("Theme Bindings cannot be TwoWay."),this.mode=2,e&&(u.k(e,We,"makeTwoWay"),this.backConverter=e),this}ofObject(e){return this.h&&u.L(this),e===void 0&&(e=""),this.sourceName=e,this}ofModel(){return this.h&&u.L(this),this.n=this.n&-3&-5|8,this.Cf=null,this}yA(e,t){const i=this.sourceName;let s=null;return i===null||i===""?s=e:i==="/"?s=t.part:i==="."?s=t:i===".."?s=t.panel:s=e.findObject(i),s}check(e){const t=this.Ya,i=this.Ch,s=this.Lf;(this.qu()&&s===null&&this.Lh===null&&t===""||s===null&&t==="")&&u.ni("Binding error: target property is the empty string: "+this.toString()),this.qu()&&this.FN&&i===""&&s===null&&this.Lh===null&&u.ni("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),e&&typeof t=="string"&&(!u.it(["setAttribute"])&&t.length>0&&t[0]!=="_"&&!u.gw(e,t)?u.ni("Binding error: undefined target property: "+t+" on "+e.toString()):t==="name"&&e instanceof Xt&&u.ni("Binding error: cannot modify GraphObject.name on "+e.toString()))}updateTarget(e,t,i,s){var l;const n=this.Ch;if(i!==void 0&&n!==""&&n!==i)return;const o=this.Ya,r=this.Lf;let a=t;if(n!==""&&!this.FN&&(s?a=s.yt(t,n):a=te.yt(t,n)),a===void 0)return;const h=(l=e.diagram)==null?void 0:l.themeManager;if(r===null){if(o!==""){if(this.qu()&&(a=this.HT(h,a,e,o),a===void 0))return;s?s.Z(e,o,a):(t instanceof Xt||t instanceof Me)&&te.Z(e,o,a)}}else try{if(o!==""){let c=r(a,e);if(this.qu()&&(c=this.HT(h,c,e,o),c===void 0))return;s?s.Z(e,o,c):(t instanceof Xt||t instanceof Me)&&te.Z(e,o,c)}else r(a,e)}catch{}}updateSource(e,t,i,s){if(this.Af!==2)return;const n=this.Ya;if(i!==void 0&&n!==i)return;const o=this.Ch,r=this.Tf,a=s!==null?s.diagram:null,h=a!==null?a.model:null;let l=e;if(n!==""&&(h?l=h.yt(e,n):l=te.yt(e,n)),l!==void 0&&!this.U1.has(e))try{if(this.U1.add(e),r===null){if(o!=="")h!==null?h.setDataProperty(t,o,l):(t instanceof Xt||t instanceof Me)&&(t[o]=l);else if(h!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,d=s.panel.itemArray;h.removeArrayItem(d,c),h.insertArrayItem(d,c,l)}}else try{if(o!==""){const c=r(l,t,h);h!==null?h.setDataProperty(t,o,c):(t instanceof Xt||t instanceof Me)&&(t[o]=c)}else{const c=r(l,t,h);if(c!==void 0&&h!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const d=s.itemIndex,f=s.panel.itemArray;h.removeArrayItem(f,d),h.insertArrayItem(f,d,c)}}}catch{}}finally{this.U1.delete(e)}}};g(We,"OneWay",1),g(We,"TwoWay",2);let Vi=We;class Es extends Vi{constructor(t,i,s,n,o){super(t,i,n);g(this,"Ly");g(this,"Lh");g(this,"Ga");s==null&&(s=""),o===void 0&&(o=null),this.Ly=s,this.Lh=o,this.Ga=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.Ly=this.Ly,t.Lh=this.Lh,t.Ga=this.Ga}qu(){return!0}get themeSource(){return this.Ly}set themeSource(t){this.h&&u.L(this),t!==null&&u.s(t,"string",Es,"themeSource"),this.Ly=t,this.Ga=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Lh}set themeConverter(t){this.h&&u.L(this),t!==null&&u.k(t,Es,"themeConverter"),this.Lh=t}ofData(){return this.h&&u.L(this),this.n=this.n|2,this.Cf=null,this}HT(t,i,s,n){if(!t||(this.FN&&(i=this.Ch),!i&&i!==0))return;let o=this.themeSource;this.Ga!==null?o=this.Ga:typeof o=="string"&&o.includes(".")&&(this.Ga=o.split("."),o=this.Ga);let r=t.findValue(i,o,n);return r===void 0&&u.ni(`Theme warning: ${i} could not be found when setting target property ${n}.`),u.it(this.Lh)&&(r=this.Lh(r,s)),r}}const Ut=class Ut{constructor(e,t){g(this,"St");g(this,"$d");g(this,"Ao");g(this,"RN");g(this,"Te");g(this,"mi");g(this,"Ah");g(this,"Df");g(this,"Ff");g(this,"Zd");g(this,"Qd");g(this,"_d");g(this,"tg");g(this,"Ay");g(this,"Ka");g(this,"Jo");g(this,"Ty");g(this,"Lo");g(this,"B1");if(I.Ki(this),this.St="",this.$d="",this.Ao=!1,this.RN={},this.Te=[],this.mi=new Z,this.Ah="key",this.Df=null,this.Ff=null,this.Zd=!1,this.Qd=!1,this._d=!1,this.tg=null,this.Ay=100,this.Ka="category",this.Jo=new Z,this.Ty=[],this.Lo=!1,this.B1=null,this.undoManager=new ze,e!==void 0&&(Array.isArray(e)?this.nodeDataArray=e:t=e),t){Object.assign(this,t);const i=t.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(e){e.St=this.St,e.$d=this.$d,e.Ao=this.Ao,e.Ah=this.Ah,e.Df=this.Df,e.Ff=this.Ff,e.Zd=this.Zd,e.Qd=this.Qd,e._d=this._d,e.tg=this.tg,e.Ay=this.Ay,e.Ka=this.Ka}copy(){const e=new this.constructor;return this.cloneProtected(e),e}clear(){this.Te=[],this.mi.clear(),this.Jo.clear(),this.undoManager.clear()}toString(e){if(e===void 0&&(e=0),e>1)return this.toJson();{let t=(this.name!==""?this.name:"")+" Model";if(e>0){t+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];t+=" "+this.getKeyForNodeData(o)+":"+u.toString(o)}}return t}}toIncrementalData(e){e.change!==1&&u.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+e.toString());const t=e.object;if(!e.isTransactionFinished||!(t instanceof Te))return null;const i=this.qT(t);return this.vN(t,e.propertyName==="FinishedUndo",i)}vN(e,t,i){const s=this;let n=!1;const o=new I,r=new I,a=new I;e.changes.each(f=>{if(f.model===s){if(f.modelChange==="nodeDataArray")f.change===3?o.add(f.newValue):f.change===4&&a.add(f.oldValue);else if(s.containsNodeData(f.object))r.add(f.object);else if(f.change===2&&(s.modelData===f.object||f.propertyName==="modelData"))n=!0;else if(f.object!==null)if(i.has(f.object))i.get(f.object).each(m=>{s.containsNodeData(m)&&r.add(m)});else{if(f.object instanceof Ut||s.Ra()&&s.containsLinkData(f.object))return;s.WT(f.object).each(m=>{r.add(m)})}}});const h=new I;o.each(f=>{h.add(s.getKeyForNodeData(f)),t||r.add(f)});const l=new I;a.each(f=>{l.add(s.getKeyForNodeData(f)),t&&r.add(f)});const c=s.cloneDeep(r.toArray());let d=null;return n&&(d===null&&(d={}),d.modelData=this.cloneDeep(this.modelData)),h.count>0&&(d===null&&(d={}),t?d.removedNodeKeys=h.toArray():d.insertedNodeKeys=h.toArray()),c.length>0&&(d===null&&(d={}),d.modifiedNodeData=c),l.count>0&&(d===null&&(d={}),t?d.insertedNodeKeys=l.toArray():d.removedNodeKeys=l.toArray()),d}cloneDeep(e){return this.ig(e,!0)}ig(e,t,i,s){if(!u.G(e))return e;i||(i=new Z);const n=i.get(e);if(n)return n;let o;if(Array.isArray(e)){o=[],i.set(e,o);for(let r=0;r<e.length;r++){const a=e[r];o.push(this.ig(a,!1,i,s))}}else if(e instanceof C||e instanceof rt||e instanceof G||e instanceof wt||e instanceof U)o=e.copy(),i.set(e,o);else{if(e instanceof Jt||e instanceof Tt)return e;if(e instanceof Y)o=new Y().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof I)o=new I().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof Z)o=new Z().addAll(this.ig(e.toArray(),!1,i,s)),i.set(e,o);else if(e instanceof Date)o=new Date(e),i.set(e,o);else if(e instanceof RegExp)o=new RegExp(e),i.set(e,o),o.lastIndex=e.lastIndex;else if(Ut.ON(null,"",e))o=e;else if(u.it(e.copy))o=e.copy(),i.set(e,o);else{o={},i.set(e,o);for(const r in e){if(r==="__gohashid")continue;const a=e[r];o[r]=this.ig(a,!1,i,s)}}}return o}De(e){return JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,t=>{const i="0000"+t.charCodeAt(0).toString(16);return"\\u"+i.substring(i.length-4)})}eg(){let e="";return this.name!==""&&(e+=`,
  "name": `+this.De(this.name)),this.dataFormat!==""&&(e+=`,
  "dataFormat": `+this.De(this.dataFormat)),this.isReadOnly&&(e+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(e+=`,
  "nodeKeyProperty": `+this.De(this.nodeKeyProperty)),this.copiesArrays&&(e+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(e+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(e+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(e+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(e+=`,
  "nodeCategoryProperty": `+this.De(this.nodeCategoryProperty)),e}Dy(e){e.name&&(this.name=e.name),e.dataFormat&&(this.dataFormat=e.dataFormat),e.isReadOnly&&(this.isReadOnly=!0),e.nodeKeyProperty&&(this.nodeKeyProperty=e.nodeKeyProperty),e.copiesArrays&&(this.copiesArrays=!0),e.copiesArrayObjects&&(this.copiesArrayObjects=!0),e.copiesKey!==void 0&&(this.copiesKey=e.copiesKey),e.pointsDigits!==void 0&&(this.pointsDigits=parseInt(e.pointsDigits)),e.nodeCategoryProperty&&(this.nodeCategoryProperty=e.nodeCategoryProperty)}JT(){const e=this.modelData;return`,
  "modelData": `+this.$T(e)}ZT(e){const t=e.modelData;u.G(t)&&(this.replaceJsonObjects(t),this.modelData=t)}IN(){const e=this.modelData;let t=!1;for(const s in e)if(!this.V1(e,s,e[s])){t=!0;break}let i="";return t&&(i=this.JT()),i+`,
  "nodeDataArray": `+this.Th(this.nodeDataArray,!0)}EN(e){this.ZT(e);const t=e.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}UN(e,t,i){if(e===t)return!0;if(typeof e!=typeof t||u.it(e)||u.it(t))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(i.get(e)===t)return!0;if(i.set(e,t),e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!this.UN(e[s],t[s],i))return!1;return!0}else if(u.G(e)&&u.G(t)){if(i.get(e)===t)return!0;i.set(e,t);for(const s in e){const n=e[s];if(this.V1(e,s,n))continue;const o=t[s];if(o===void 0||!this.UN(n,o,i))return!1}for(const s in t){const n=t[s];if(this.V1(t,s,n))continue;const o=e[s];if(o===void 0||!this.UN(o,n,i))return!1}return!0}return!1}qT(e){let t=new Z;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let a=t.get(s);a===null?(a=new I,a.add(r),t.set(s,a)):a.add(r)};return e.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),t}WT(e){const t=new I;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.z1(e,s,s,t)}return t}z1(e,t,i,s){if(Array.isArray(t))for(let n=0;n<t.length;n++){const o=t[n];if(o===e)return s.add(i),!0;if(this.z1(e,o,i,s))return!0}else if(u.G(t)&&Object.getPrototypeOf(t)===Object.prototype)for(const n in t){const o=t[n];if(o===e)return s.add(i),!0;if(this.z1(e,o,i,s))return!0}return!1}BN(e,t,i){const s=this;let n=!1;const o=new I,r=new I,a=new I;e.changes.each(d=>{if(d.model===s){if(d.modelChange==="nodeDataArray")d.change===3?o.add(d.newValue):d.change===4&&a.add(d.oldValue);else if(s.containsNodeData(d.object))r.add(d.object);else if(d.change===2&&(s.modelData===d.object||d.propertyName==="modelData"))n=!0;else if(d.object!==null)if(i.has(d.object))i.get(d.object).each(f=>{s.containsNodeData(f)&&r.add(f)});else{if(d.object instanceof Ut||s.Ra()&&s.containsLinkData(d.object))return;s.WT(d.object).each(f=>{r.add(f)})}}});const h=new I;o.each(d=>{h.add(s.getKeyForNodeData(d)),t||r.add(d)});const l=new I;a.each(d=>{l.add(s.getKeyForNodeData(d)),t&&r.add(d)});let c="";return n&&(c+=this.JT()),h.count>0&&(c+=(t?Ut._T:Ut.QT)+this.Th(h.toArray(),!0)),r.count>0&&(c+=Ut.qO+this.Th(r.toArray(),!0)),l.count>0&&(c+=(t?Ut.QT:Ut._T)+this.Th(l.toArray(),!0)),c}Fy(e){(e.name!==void 0&&e.name!==this.name||e.dataFormat!==void 0&&e.dataFormat!==this.dataFormat||e.isReadOnly!==void 0&&e.isReadOnly!==this.isReadOnly||e.nodeKeyProperty!==void 0&&e.nodeKeyProperty!==this.nodeKeyProperty||e.copiesArrays!==void 0&&e.copiesArrays!==this.copiesArrays||e.copiesArrayObjects!==void 0&&e.copiesArrayObjects!==this.copiesArrayObjects||e.copiesKey!==void 0&&e.copiesKey!==this.copiesKey||e.nodeCategoryProperty!==void 0&&e.nodeCategoryProperty!==this.nodeCategoryProperty)&&u.o("applyIncrementalJson cannot change Model properties"),this.ZT(e);const t=e.insertedNodeKeys,i=e.modifiedNodeData,s=new Z;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],a=this.getKeyForNodeData(r);a!=null&&s.set(a,r)}if(Array.isArray(t)){const o=t.length;for(let r=0;r<o;r++){const a=t[r];let h=this.findNodeDataForKey(a);h===null&&(h=s.get(a)||this.copyNodeData({}),this.setKeyForNodeData(h,a),this.addNodeData(h))}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r],h=this.getKeyForNodeData(a),l=this.findNodeDataForKey(h);if(l!==null){for(const c in a)c==="__gohashid"||c===this.nodeKeyProperty||(this.mm()||this.Mb())&&c===this.nodeIsGroupProperty||this.setDataProperty(l,c,a[c]);this.sg(a,l)}}}const n=e.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const a=n[r],h=this.findNodeDataForKey(a);h!==null&&this.removeNodeData(h)}}}toIncrementalJson(e,t){e.change!==1&&u.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+e.toString());const i=e.object;if(!e.isTransactionFinished||!(i instanceof Te))return'{ "incremental": 0 }';t===void 0&&(t=u.Dn(this));const s=this.qT(i),n=this.BN(i,e.propertyName==="FinishedUndo",s);return'{ "class": '+this.De(t)+', "incremental": 1'+this.eg()+n+"}"}toIncrementalJSON(e,t){return this.toIncrementalJson(e,t)}toJson(e){return e===void 0&&(e=u.Dn(this)),'{ "class": '+this.De(e)+this.eg()+this.IN()+"}"}toJSON(e){return this.toJson(e)}applyIncrementalJson(e){let t=null;if(typeof e=="string")try{t=w.JSON.parse(e)}catch{}else u.G(e)?t=e:u.o("Unable to modify a Model from: "+e);const i=t.incremental;typeof i!="number"&&u.o("Unable to apply non-incremental changes to Model: "+e),i!==0&&(this.startTransaction("applyIncrementalJson"),this.Fy(t),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(e){return this.applyIncrementalJson(e)}static fromJson(e,t){t===void 0&&(t=null);let i=null;if(typeof e=="string")try{i=w.JSON.parse(e)}catch{}else u.G(e)?i=e:u.o("Unable to construct a Model from: "+e);if(t===null){const s=Ut.WO(i);s===null||s instanceof Ut?t=s:u.o("Unable to construct a Model of declared class: "+i.class)}return t===null&&(t=Ut.tD()),t.Dy(i),t.EN(i),t}static fromJSON(e,t){return this.fromJson(e,t)}static tD(){return new Ut}static WO(e){let t=null,i=e.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?s=Ut.VN(i.substring(3)):(s=Ut.VN(i),s===null&&(s=w[i])),u.it(s)&&(t=new s)}catch{}return t}replaceJsonObjects(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++){const s=e[i];u.G(s)&&this.iD(e,i,this.replaceJsonObjects(s))}}else if(u.G(e)){for(const t in e){const i=e[t];if(u.G(i)){const s=this.replaceJsonObjects(i);if(e[t]=s,t==="points"&&Array.isArray(s)){let n=s.length%2===0;for(let o=0;o<s.length;o++)if(typeof s[o]!="number"){n=!1;break}if(n){const o=new Y;for(let r=0;r<s.length/2;r++)o.add(new C(s[r*2],s[r*2+1]));o.u(),e[t]=o}}}}return this.JO(e)}return e}writeJsonValue(e){return e===void 0?"undefined":e===null?"null":e===!0?"true":e===!1?"false":typeof e=="string"?this.De(e):typeof e=="number"?e===1/0?"9e9999":e===-1/0?"-9e9999":isNaN(e)?'{"class":"NaN"}':e.toString():e instanceof Boolean?this.writeJsonValue(e.valueOf()):e instanceof String?this.writeJsonValue(e.valueOf()):e instanceof Number?this.writeJsonValue(e.valueOf()):e instanceof Date?'{"class":"Date", "value":"'+e.toJSON()+'"}':Array.isArray(e)?this.Th(e):u.G(e)?this.$T(e):u.it(e)?"null":'"'+e.toString()+'"'}Th(e,t){t===void 0&&(t=!1);const i=e.length;if(i<=0)return"[]";const s=new v;s.add("["),t&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=e[n];o!==void 0&&(n>0&&(s.add(","),t&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return t&&i>1&&s.add(`
`),s.add("]"),s.toString()}V1(e,t,i){return!!(i===void 0||t==="__gohashid"||t[0]==="_"||u.it(i))}Yi(e){return isNaN(e)?"NaN":e===1/0?"9e9999":e===-1/0?"-9e9999":e}$T(e){const t=e;if(t instanceof C)e={class:"go.Point",x:this.Yi(t.x),y:this.Yi(t.y)};else if(t instanceof rt)e={class:"go.Size",width:this.Yi(t.width),height:this.Yi(t.height)};else if(t instanceof G)e={class:"go.Rect",x:this.Yi(t.x),y:this.Yi(t.y),width:this.Yi(t.width),height:this.Yi(t.height)};else if(t instanceof wt)e={class:"go.Margin",top:this.Yi(t.top),right:this.Yi(t.right),bottom:this.Yi(t.bottom),left:this.Yi(t.left)};else if(t instanceof U)t.isSpot()?e={class:"go.Spot",x:this.Yi(t.x),y:this.Yi(t.y),offsetX:this.Yi(t.offsetX),offsetY:this.Yi(t.offsetY)}:e={class:"go.Spot",enum:t.toString()};else if(t instanceof Jt){if(e={class:"go.Brush",type:Wi[t.type]},t.type===1?e.color=t.color:(t.type===2||t.type===3)&&(e.start=t.start,e.end=t.end,t.type===3&&(t.startRadius!==0&&(e.startRadius=this.Yi(t.startRadius)),isNaN(t.endRadius)||(e.endRadius=this.Yi(t.endRadius)))),t.colorStops!==null){const n={},o=t.colorStops.iterator;for(;o.next();){const r=o.key,a=o.value;n[r]=a}e.colorStops=n}}else if(t instanceof Tt)e={class:"go.Geometry",type:ee[t.type]},t.startX!==0&&(e.startX=this.Yi(t.startX)),t.startY!==0&&(e.startY=this.Yi(t.startY)),t.endX!==0&&(e.endX=this.Yi(t.endX)),t.endY!==0&&(e.endY=this.Yi(t.endY)),t.spot1.equals(U.TopLeft)||(e.spot1=t.spot1),t.spot2.equals(U.BottomRight)||(e.spot2=t.spot2),t.type===4&&(e.path=Tt.stringify(t));else if(Ut.ON(null,"",t))return"{}";let i="{",s=!0;for(const n in e){const o=this.yt(e,n);if(!this.V1(e,n,o))if(s?s=!1:i+=",",i+=this.De(n)+":",n==="points"&&o instanceof Y){const r=o;let a="[";const h=r.iterator;for(;h.next();){const l=h.value;a.length>1&&(a+=","),a+=this.eD(l.x),a+=",",a+=this.eD(l.y)}a+="]",i+=a}else i+=this.writeJsonValue(o)}return i+="}",i}eD(e){if(e===1/0)return"9e9999";if(e===-1/0)return"-9e9999";if(isNaN(e))return"0";const t=this.pointsDigits;return t>16?e.toString():e.toFixed(t)}get pointsDigits(){return this.Ay}set pointsDigits(e){e<0?e=0:e>100&&(e=100),this.Ay=e}Gi(e){return typeof e=="number"?e:e==="NaN"?NaN:e==="9e9999"?1/0:e==="-9e9999"?-1/0:parseFloat(e)}JO(e){if(!u.G(e))return e;let t=e.class||"";if(typeof t!="string"||t==="")return e;if(t==="NaN")return NaN;if(t==="Date")return new Date(e.value);if(t.indexOf("go.")!==0)return e;t=t.substring(3);let i=e;if(t==="Point")i=new C(this.Gi(e.x),this.Gi(e.y));else if(t==="Size")i=new rt(this.Gi(e.width),this.Gi(e.height));else if(t==="Rect")i=new G(this.Gi(e.x),this.Gi(e.y),this.Gi(e.width),this.Gi(e.height));else if(t==="Margin")i=new wt(this.Gi(e.top),this.Gi(e.right),this.Gi(e.bottom),this.Gi(e.left));else if(t==="Spot")typeof e.enum=="string"?i=U.parse(e.enum):i=new U(this.Gi(e.x),this.Gi(e.y),this.Gi(e.offsetX),this.Gi(e.offsetY));else if(t==="Brush"){const s=new Jt;s.type=u.Uh(Wi,e.type)??1,typeof e.color=="string"&&(s.color=e.color),e.start instanceof U&&(s.start=e.start),e.end instanceof U&&(s.end=e.end),typeof e.startRadius=="number"&&(s.startRadius=this.Gi(e.startRadius)),typeof e.endRadius=="number"&&(s.endRadius=this.Gi(e.endRadius));const n=e.colorStops;if(u.G(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if(t==="Geometry"){let s=null;typeof e.path=="string"?s=Tt.parse(e.path):s=new Tt,s.type=u.Uh(ee,e.type)??1,typeof e.startX=="number"&&(s.startX=this.Gi(e.startX)),typeof e.startY=="number"&&(s.startY=this.Gi(e.startY)),typeof e.endX=="number"&&(s.endX=this.Gi(e.endX)),typeof e.endY=="number"&&(s.endY=this.Gi(e.endY)),e.spot1 instanceof U&&(s.spot1=e.spot1),e.spot2 instanceof U&&(s.spot2=e.spot2),i=s}else if(t==="EnumValue"){let s=e.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=Ut.VN(s);u.it(n)&&(i=u.Uh(n,e.name))}return i}get name(){return this.St}set name(e){const t=this.St;t!==e&&(u.s(e,"string",Ut,"name"),this.St=e,this.t("name",t,e))}get dataFormat(){return this.$d}set dataFormat(e){const t=this.$d;t!==e&&(u.s(e,"string",Ut,"dataFormat"),this.$d=e,this.t("dataFormat",t,e))}get isReadOnly(){return this.Ao}set isReadOnly(e){const t=this.Ao;t!==e&&(u.s(e,"boolean",Ut,"isReadOnly"),this.Ao=e,this.t("isReadOnly",t,e))}get modelData(){return this.RN}set modelData(e){const t=this.modelData;t!==e&&(u.ec(e,Ut,"modelData"),this.containsNodeData(e)&&u.o("Model.modelData Object must not be used by the rest of the model: "+e),this.RN=e,this.t("modelData",t,e),this.updateTargetBindings(e))}addChangedListener(e){return u.k(e,Ut,"addChangedListener:listener"),this.Ty.push(e),this}removeChangedListener(e){u.k(e,Ut,"removeChangedListener:listener");const t=this.Ty.indexOf(e);t>=0&&this.Ty.splice(t,1)}VM(e){this.skipsUndoManager||this.undoManager.handleChanged(e),this.sD(e)}sD(e){this.Ty.forEach(t=>t(e))}dF(e){this.sD(e)}raiseChangedEvent(e,t,i,s,n,o,r){this.vt("",e,t,i,s,n,o,r)}raiseChanged(e,t,i,s,n){this.vt("",2,e,this,t,i,s,n)}t(e,t,i,s,n){this.vt("",2,e,this,t,i,s,n)}raiseDataChanged(e,t,i,s,n,o){this.vt("",2,t,e,i,s,n,o)}vt(e,t,i,s,n,o,r,a){r===void 0&&(r=null),a===void 0&&(a=null);const h=new be;h.model=this,h.change=t,h.modelChange=e,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=r,h.newValue=o,h.newParam=a,this.VM(h)}get undoManager(){return this.B1}set undoManager(e){const t=this.B1;t!==e&&(t!==null&&t.removeModel(this),this.B1=e,e!==null&&e.addModel(this))}get skipsUndoManager(){return this.Lo}set skipsUndoManager(e){u.s(e,"boolean",Ut,"skipsUndoManager"),this.Lo=e}changeState(e,t){if(e!==null&&e.model===this)if(e.change===2){const i=e.object,s=e.propertyName,n=e.getValue(t);if(s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=e.getValue(!t);o!==void 0&&this.mi.delete(o),n!==void 0&&this.mi.set(n,i)}this.Z(i,s,n)}else if(e.change===3){const i=e.newParam;if(e.modelChange==="nodeDataArray"){const s=e.newValue;if(u.G(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Te[i]===s&&this.go(this.Te,i),n!==void 0&&this.mi.delete(n)):(this.Te[i]!==s&&this.$o(this.Te,i,s),n!==void 0&&this.mi.set(n,s))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.yt(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.newValue;t?this.go(s,i):this.$o(s,i,n)}}else u.o("unknown ChangeType.Insert modelChange: "+e.toString())}else if(e.change===4){const i=e.oldParam;if(e.modelChange==="nodeDataArray"){const s=e.oldValue;if(u.G(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);t?(this.Te[i]!==s&&this.$o(this.Te,i,s),n!==void 0&&this.mi.set(n,s)):(this.Te[i]===s&&this.go(this.Te,i),n!==void 0&&this.mi.delete(n))}}else if(e.modelChange===""){let s=e.object;if(s&&!Array.isArray(s)&&e.propertyName&&(s=this.yt(s,e.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=e.oldValue;t?this.$o(s,i,n):this.go(s,i)}}else u.o("unknown ChangeType.Remove modelChange: "+e.toString())}else e.change===1||u.o("unknown ChangedEvent: "+e.toString())}startTransaction(e){return this.undoManager.startTransaction(e)}commitTransaction(e){return this.undoManager.commitTransaction(e)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(e,t){let i=t;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{e(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(e,t){t===void 0&&(t=""),this.vt("SourceChanged",1,t,e,null,null)}get nodeKeyProperty(){return this.Ah}set nodeKeyProperty(e){const t=this.Ah;t!==e&&(this.Pn(e,Ut,"nodeKeyProperty"),e===""&&u.o("Model.nodeKeyProperty may not be the empty string"),this.mi.count>0&&u.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Ah=e,this.t("nodeKeyProperty",t,e))}Pn(e,t,i){}getKeyForNodeData(e){if(e===null)return;const t=this.Ah;if(t==="")return;const i=this.yt(e,t);if(i!==void 0){if(this.isKeyType(i))return i;u.o("Key value for node data "+e+" is not a number or a string: "+i)}}setKeyForNodeData(e,t){if((t==null||!this.isKeyType(t))&&u.Zi(t,"number or string",Ut,"setKeyForNodeData:key"),e===null)return;const i=this.Ah;if(i==="")return;if(!this.containsNodeData(e)){this.Z(e,i,t);return}const s=this.yt(e,i);if(s!==t){if(this.findNodeDataForKey(t)!==null)return;this.Z(e,i,t),s!==void 0&&this.mi.delete(s),this.mi.set(t,e),this.vt("nodeKey",2,i,e,s,t),typeof i=="string"&&this.updateTargetBindings(e,i),this.Ry(s,t)}}get makeUniqueKeyFunction(){return this.Df}set makeUniqueKeyFunction(e){const t=this.Df;t!==e&&(e!==null&&u.k(e,Ut,"makeUniqueKeyFunction"),this.Df=e,this.t("makeUniqueKeyFunction",t,e))}isKeyType(e){return typeof e=="number"||typeof e=="string"}containsNodeData(e){if(e===null)return!1;const t=this.getKeyForNodeData(e);return t===void 0?!1:this.mi.get(t)===e}findNodeDataForKey(e){return e===null&&u.o("Model.findNodeDataForKey:key must not be null"),e===void 0||!this.isKeyType(e)?null:this.mi.get(e)}get nodeDataArray(){return this.Te}set nodeDataArray(e){const t=this.Te;if(t!==e){this.zN(e,Ut,"nodeDataArray"),this.mi.clear(),this.XN();const i=e.length;for(let o=0;o<i;o++){const r=e[o];u.G(r)||u.o("Model.nodeDataArray must only contain Objects, not: "+r),r===this.modelData&&u.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Te=e;const s=new Y;for(let o=0;o<i;o++){const r=e[o],a=this.getKeyForNodeData(r);a===void 0||this.mi.get(a)!==null?s.add(r):this.mi.set(a,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.mi.set(r,o)}this.vt("nodeDataArray",2,"nodeDataArray",this,t,e);for(let o=0;o<i;o++){const r=e[o];this.ng(r),this.og(r)}}}X1(e){return e===void 0?!1:this.mi.has(e)}makeNodeDataKeyUnique(e){if(e===null)return;const t=this.Ah;if(t==="")return;let i=this.getKeyForNodeData(e);if(i!==void 0&&!this.X1(i))return;const s=this.Df;if(s!==null&&(i=s(this,e),i!=null&&!this.X1(i))){this.Z(e,t,i);return}if(typeof i=="string"){let n=2;for(;this.X1(i+n);)n++;this.Z(e,t,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.mi.count-1;for(;this.X1(n);)n--;this.Z(e,t,n)}}addNodeData(e){e!==null&&(e===this.modelData&&u.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(e)||this.VT(e,!0))}VT(e,t){let i=this.getKeyForNodeData(e);if(i===void 0)this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e);else{if(this.mi.get(i)===e)return;this.makeNodeDataKeyUnique(e),i=this.getKeyForNodeData(e)}i===void 0&&u.o("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.mi.set(i,e);let s=null;t&&(s=this.Te.length,this.$o(this.Te,s,e)),this.vt("nodeDataArray",3,"nodeDataArray",this,null,e,null,s),this.ng(e),this.og(e)}addNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.addNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.addNodeData(i)}}}removeNodeData(e){e!==null&&this.BT(e,!0)}BT(e,t){const i=this.getKeyForNodeData(e);i!==void 0&&this.mi.delete(i);let s=null;if(t){if(s=this.Te.indexOf(e),s<0)return;this.go(this.Te,s)}this.vt("nodeDataArray",4,"nodeDataArray",this,e,null,s,null),this.vy(e)}removeNodeDataCollection(e){if(Array.isArray(e)){const t=e.length;for(let i=0;i<t;i++)this.removeNodeData(e[i])}else{const t=e.iterator;for(;t.next();){const i=t.value;this.removeNodeData(i)}}}mergeNodeDataArray(e){if(e===this.nodeDataArray||!Array.isArray(e))return;const t=new I;t.addAll(this.mi.iteratorKeys);const i=new I,s=e.length;for(let o=0;o<s;o++){const r=e[o],a=this.getKeyForNodeData(r);if(a!==void 0){i.add(a);const h=this.findNodeDataForKey(a);if(h===r)continue;if(h!==null)this.assignAllDataProperties(h,r),this.sg(r,h);else{const l=this.cloneDeep(r);this.setKeyForNodeData(l,a),this.addNodeData(l)}}else{const h=this.cloneDeep(r);this.addNodeData(h),i.add(this.getKeyForNodeData(h))}}const n=t.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}}Ry(e,t){if(t===void 0)return;const i=this.Cy(e);i instanceof I&&this.Jo.set(t,i)}XN(){}ng(e){}og(e){}vy(e){}Js(e,t){if(e===void 0)return;let i=this.Jo.get(e);i===null&&(i=new I,this.Jo.set(e,i)),i.add(t)}Ws(e,t){if(e===void 0)return;const i=this.Jo.get(e);i instanceof I&&(t==null?this.Jo.delete(e):(i.delete(t),i.count===0&&this.Jo.delete(e)))}Cy(e){if(e===void 0)return null;const t=this.Jo.get(e);return t instanceof I?t:null}OE(e){e===void 0?this.Jo.clear():this.Jo.delete(e)}get copyNodeDataFunction(){return this.Ff}set copyNodeDataFunction(e){const t=this.Ff;t!==e&&(e!==null&&u.k(e,Ut,"copyNodeDataFunction"),this.Ff=e,this.t("copyNodeDataFunction",t,e))}get copiesArrays(){return this.Zd}set copiesArrays(e){const t=this.Zd;t!==e&&(e!==null&&u.s(e,"boolean",Ut,"copiesArrays"),this.Zd=e,this.t("copiesArrays",t,e))}get copiesArrayObjects(){return this.Qd}set copiesArrayObjects(e){const t=this.Qd;t!==e&&(e!==null&&u.s(e,"boolean",Ut,"copiesArrayObjects"),this.Qd=e,this.t("copiesArrayObjects",t,e))}get copiesKey(){return this._d}set copiesKey(e){const t=this._d;t!==e&&(e!==null&&u.s(e,"boolean",Ut,"copiesKey"),this._d=e,this.t("copiesKey",t,e))}copyNodeData(e){if(e===null)return null;let t=null;const i=this.Ff;return i!==null?t=i(e,this):t=this.Y1(e,!0),t}Y1(e,t){if(u.G(e))if(Array.isArray(e))if(this.copiesArrays){const i=e,s=[];for(let n=0;n<i.length;n++){const o=i[n],r=this.Y1(o,this.copiesArrayObjects);s.push(r)}return s}else return e;else{if(e instanceof C||e instanceof rt||e instanceof G||e instanceof wt||e instanceof U)return e.copy();if(t){const i=e,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in i){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const a=this.yt(i,r);if(!u.G(a))n[r]=a;else if(Ut.ON(i,r,a))this.Z(n,r,a);else{const h=this.Y1(a,!1);this.Z(n,r,h)}}return n}else return e}else return e}get afterCopyFunction(){return this.tg}set afterCopyFunction(e){const t=this.tg;t!==e&&(e!==null&&u.k(e,Ut,"afterCopyFunction"),this.tg=e,this.t("afterCopyFunction",t,e))}static ON(e,t,i){const s=u.Dn(i);return i instanceof Ut||i instanceof ze||i instanceof Te||i instanceof be||i instanceof Xt||i instanceof Me||i instanceof zt||i instanceof EventTarget||s==="Layer"||s==="RowColumnDefinition"||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}setDataProperty(e,t,i){if(this.containsNodeData(e)){if(t===this.nodeKeyProperty){this.setKeyForNodeData(e,i);return}else if(t===this.nodeCategoryProperty){this.setCategoryForNodeData(e,i);return}}else!Ut.nD&&e instanceof Xt&&(Ut.nD=!0,u.ni('Model.setDataProperty is modifying a GraphObject, "'+e.toString()+'"'),u.ni("  Is that really your intent?"));const s=this.yt(e,t);s!==i&&(this.Z(e,t,i),this.raiseDataChanged(e,t,s,i))}set(e,t,i){this.setDataProperty(e,t,i)}assignAllDataProperties(e,t){if(!t)return;const i=this.containsNodeData(e);for(const s in t)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(e,s,t[s]))}addArrayItem(e,t){this.insertArrayItem(e,-1,t)}insertArrayItem(e,t,i){t<0&&(t=e.length),e=this.$o(e,t,i),this.vt("",3,"",e,null,i,null,t)}removeArrayItem(e,t){t===void 0&&(t=-1),e===this.Te&&u.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),t===-1&&(t=e.length-1);const i=e[t];e=this.go(e,t),this.vt("",4,"",e,i,null,t,null)}get nodeCategoryProperty(){return this.Ka}set nodeCategoryProperty(e){const t=this.Ka;t!==e&&(this.Pn(e,Ut,"nodeCategoryProperty"),this.Ka=e,this.t("nodeCategoryProperty",t,e))}getCategoryForNodeData(e){if(e===null)return"";const t=this.Ka;if(t==="")return"";const i=this.yt(e,t);if(i===void 0)return"";if(typeof i=="string")return i;u.o("getCategoryForNodeData found a non-string category for "+e+": "+i)}setCategoryForNodeData(e,t){if(u.s(t,"string",Ut,"setCategoryForNodeData:cat"),e===null)return;const i=this.Ka;if(i==="")return;if(!this.containsNodeData(e)){this.Z(e,i,t);return}let s=this.yt(e,i);s===void 0&&(s=""),s!==t&&(this.Z(e,i,t),this.vt("nodeCategory",2,i,e,s,t))}sg(e,t){this.setCategoryForNodeData(t,this.getCategoryForNodeData(e))}get type(){return"Model"}pm(){return!1}mm(){return!1}Mb(){return!1}Ra(){return!1}Xw(){return!1}Hc(){return!1}static LM(){return new Ut}yt(e,t){return Ut.yt(e,t)}static yt(e,t){if(!e||!t)return null;let i;try{u.it(t)?i=t(e):u.it(e.getAttribute)?(i=e.getAttribute(t),i===null&&(i=void 0)):i=e[t]}catch{}return i}Z(e,t,i){Ut.Z(e,t,i)}static Z(e,t,i){if(!(!e||!t)){try{u.it(t)?t(e,i):u.it(e.setAttribute)?e.setAttribute(t,i):e[t]=i}catch{}return e}}zN(e,t,i){}iD(e,t,i){return e[t]=i,e}$o(e,t,i){return t>=e.length?e.push(i):e.splice(t,0,i),e}go(e,t){return t>=e.length?e.pop():e.splice(t,1),e}static VN(e){return Ut.YN[e]?Ut.YN[e]:w.go!==void 0&&w.go[e]?w.go[e]:null}static fl(e,t){Ut.YN[t]=e}};g(Ut,"QT",`,
  "insertedNodeKeys": `),g(Ut,"qO",`,
  "modifiedNodeData": `),g(Ut,"_T",`,
  "removedNodeKeys": `),g(Ut,"nD",!1),g(Ut,"YN",{});let te=Ut;te.fromJSON=te.fromJson=te.fromJson,te.fl(Jt,"Brush"),te.fl(Tt,"Geometry"),te.fl(wt,"Margin"),te.fl(C,"Point"),te.fl(G,"Rect"),te.fl(rt,"Size"),te.fl(U,"Spot"),te.fl(te,"Model");const pe=class pe extends te{constructor(t,i,s){super();g(this,"Ps");g(this,"Zo");g(this,"Di");g(this,"Dh");g(this,"Rf");g(this,"vf");g(this,"Ll");g(this,"mo");g(this,"po");g(this,"ja");g(this,"Ha");g(this,"qa");g(this,"$s");g(this,"Of");g(this,"Sn");g(this,"rg");g(this,"rD",`,
  "insertedLinkKeys": `);g(this,"$O",`,
  "modifiedLinkData": `);g(this,"lD",`,
  "removedLinkKeys": `);if(this.Ps=[],this.Zo=new I,this.Di=new Z,this.Dh="",this.Rf=null,this.vf=null,this.Ll=null,this.mo="from",this.po="to",this.ja="",this.Ha="",this.qa="category",this.$s="",this.Of="isGroup",this.Sn="group",this.rg=!1,i!==void 0&&(this.linkDataArray=i),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:s=t),s){Object.assign(this,s);const n=s.Changed;n&&(delete this.Changed,this.addChangedListener(n))}}cloneProtected(t){super.cloneProtected(t),t.Dh=this.Dh,t.Rf=this.Rf,t.vf=this.vf,t.mo=this.mo,t.po=this.po,t.ja=this.ja,t.Ha=this.Ha,t.qa=this.qa,t.$s=this.$s,t.Of=this.Of,t.Sn=this.Sn,t.rg=this.rg}clear(){this.Ps=[],this.Di.clear(),this.Zo.clear(),super.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){i+=`
 node data:`;let s=this.nodeDataArray,n=s.length,o=0;for(o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+Vi.toString(r)}for(i+=`
 link data:`,s=this.linkDataArray,n=s.length,o=0;o<n;o++){const r=s[o];i+=" "+this.Ae(r,!0)+"-->"+this.Ae(r,!1)}}return i}}vN(t,i,s){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}let n=super.vN(t,i,s);const o=this,r=new I,a=new I,h=new I;t.changes.each(f=>{if(f.model===o){if(f.modelChange==="linkDataArray")f.change===3?r.add(f.newValue):f.change===4&&h.add(f.oldValue);else if(o.containsLinkData(f.object))a.add(f.object);else if(f.object!==null)if(f.object!==null&&s.has(f.object))s.get(f.object).each(m=>{o.containsLinkData(m)&&a.add(m)});else{if(f.object instanceof te||o.containsNodeData(f.object))return;o.oD(f.object).each(m=>a.add(m))}}});const l=new I;r.each(f=>{l.add(o.getKeyForLinkData(f)),i||a.add(f)});const c=new I;h.each(f=>{c.add(o.getKeyForLinkData(f)),i&&a.add(f)});const d=o.cloneDeep(a.toArray());return l.count>0&&(n===null&&(n={}),i?n.removedLinkKeys=l.toArray():n.insertedLinkKeys=l.toArray()),d.length>0&&(n===null&&(n={}),n.modifiedLinkData=d),c.count>0&&(n===null&&(n={}),i?n.insertedLinkKeys=c.toArray():n.removedLinkKeys=c.toArray()),n}eg(){const t=super.eg();let i="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(i+=`,
  "linkCategoryProperty": `+this.De(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(i+=`,
  "linkKeyProperty": `+this.De(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(i+=`,
  "linkFromKeyProperty": `+this.De(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(i+=`,
  "linkToKeyProperty": `+this.De(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(i+=`,
  "linkFromPortIdProperty": `+this.De(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(i+=`,
  "linkToPortIdProperty": `+this.De(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(i+=`,
  "linkLabelKeysProperty": `+this.De(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(i+=`,
  "nodeIsGroupProperty": `+this.De(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(i+=`,
  "nodeGroupKeyProperty": `+this.De(this.nodeGroupKeyProperty)),t+i}Dy(t){super.Dy(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}IN(){const t=super.IN(),i=`,
  "linkDataArray": `+this.Th(this.linkDataArray,!0);return t+i}EN(t){super.EN(t);const i=t.linkDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.linkDataArray=i)}oD(t){const i=new I;for(let s=0;s<this.linkDataArray.length;s++){const n=this.linkDataArray[s];this.z1(t,n,n,i)}return i}BN(t,i,s){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}const n=super.BN(t,i,s),o=this,r=new I,a=new I,h=new I;t.changes.each(f=>{if(f.model===o){if(f.modelChange==="linkDataArray")f.change===3?r.add(f.newValue):f.change===4&&h.add(f.oldValue);else if(o.containsLinkData(f.object))a.add(f.object);else if(f.object!==null)if(f.object!==null&&s.has(f.object))s.get(f.object).each(m=>{o.containsLinkData(m)&&a.add(m)});else{if(f.object instanceof te||o.containsNodeData(f.object))return;o.oD(f.object).each(m=>a.add(m))}}});const l=new I;r.each(f=>{l.add(o.getKeyForLinkData(f)),i||a.add(f)});const c=new I;h.each(f=>{c.add(o.getKeyForLinkData(f)),i&&a.add(f)});let d=n;return l.count>0&&(d+=(i?this.lD:this.rD)+this.Th(l.toArray(),!0)),a.count>0&&(d+=this.$O+this.Th(a.toArray(),!0)),c.count>0&&(d+=(i?this.rD:this.lD)+this.Th(c.toArray(),!0)),d}Fy(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&u.o("applyIncrementalJson cannot change Model properties"),super.Fy(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const a=i[r];let h=this.findLinkDataForKey(a);h===null&&(h=this.copyLinkData({}),this.setKeyForLinkData(h,a),this.addLinkData(h))}}const s=t.modifiedLinkData;if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const a=s[r],h=this.getKeyForLinkData(a),l=this.findLinkDataForKey(h);if(l!==null){for(const c in a)c==="__gohashid"||c===this.linkKeyProperty||this.setDataProperty(l,c,a[c]);this.hD(a,l)}}}const n=t.removedLinkKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const a=n[r],h=this.findLinkDataForKey(a);h!==null&&this.removeLinkData(h)}}}changeState(t,i){if(!(t===null||t.model!==this)){if(t.change===2){const s=t.object,n=t.propertyName;if(n===this.linkKeyProperty&&this.containsLinkData(s)){const o=t.getValue(i),r=t.getValue(!i);r!==void 0&&this.Di.delete(r),o!==void 0&&this.Di.set(o,s),this.Z(s,n,o);return}}else if(t.change===3){let s=t.newParam;if(t.modelChange==="linkDataArray"){const n=t.newValue;if(u.G(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.Zo.delete(n),this.Ps[s]===n&&this.go(this.linkDataArray,s),o!==void 0&&this.Di.delete(o)):(this.Zo.add(n),this.Ps[s]!==n&&this.$o(this.Ps,s,n),o!==void 0&&this.Di.set(o,n))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=this.getLabelKeysForLinkData(n);Array.isArray(o)&&typeof s=="number"&&(i?(s=o.indexOf(t.newValue),s>=0&&this.go(o,s)):o.indexOf(t.newValue)<0&&this.$o(o,s,t.newValue));return}}else if(t.change===4){let s=t.oldParam;if(t.modelChange==="linkDataArray"){const n=t.oldValue;if(u.G(n)&&typeof s=="number"){const o=this.getKeyForLinkData(n);i?(this.Zo.add(n),this.Ps[s]!==n&&this.$o(this.Ps,s,n),o!==void 0&&this.Di.set(o,n)):(this.Zo.delete(n),this.Ps[s]===n&&this.go(this.linkDataArray,s),o!==void 0&&this.Di.delete(o))}return}else if(t.modelChange==="linkLabelKeys"){const n=t.object,o=this.getLabelKeysForLinkData(n);Array.isArray(o)&&typeof s=="number"&&(i?o.indexOf(t.oldValue)<0&&this.$o(o,s,t.oldValue):(s=o.indexOf(t.oldValue),s>=0&&this.go(o,s)));return}}super.changeState(t,i)}}get archetypeNodeData(){return this.Ll}set archetypeNodeData(t){const i=this.Ll;i!==t&&(t!==null&&u.ec(t,pe,"archetypeNodeData"),this.Ll=t,this.t("archetypeNodeData",i,t))}GN(t){if(t===void 0)return;const i=this.Ll;if(i!==null){let s=this.findNodeDataForKey(t);s===null&&(s=this.copyNodeData(i),this.Z(s,this.nodeKeyProperty,t),this.addNodeData(s))}return t}get linkFromKeyProperty(){return this.mo}set linkFromKeyProperty(t){const i=this.mo;i!==t&&(this.Pn(t,pe,"linkFromKeyProperty"),this.mo=t,this.t("linkFromKeyProperty",i,t))}getFromKeyForLinkData(t){return this.Ae(t,!0)}setFromKeyForLinkData(t,i){this.Wd(t,i,!0)}get linkToKeyProperty(){return this.po}set linkToKeyProperty(t){const i=this.po;i!==t&&(this.Pn(t,pe,"linkToKeyProperty"),this.po=t,this.t("linkToKeyProperty",i,t))}getToKeyForLinkData(t){return this.Ae(t,!1)}setToKeyForLinkData(t,i){this.Wd(t,i,!1)}Ae(t,i){if(t===null)return;const s=i?this.mo:this.po;if(s==="")return;const n=this.yt(t,s);if(n!==void 0){if(this.isKeyType(n))return n;u.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+n)}}Wd(t,i,s){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&u.Zi(i,"number or string",pe,s?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const n=s?this.mo:this.po;if(n==="")return;if(i=this.GN(i),!this.containsLinkData(t)){this.Z(t,n,i);return}const o=this.yt(t,n);o!==i&&(this.Ws(o,t),this.Z(t,n,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt(s?"linkFromKey":"linkToKey",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkFromPortIdProperty(){return this.ja}set linkFromPortIdProperty(t){const i=this.ja;i!==t&&(this.Pn(t,pe,"linkFromPortIdProperty"),this.ja=t,this.t("linkFromPortIdProperty",i,t))}getFromPortIdForLinkData(t){return this.I1(t,!0)}setFromPortIdForLinkData(t,i){this.Jd(t,i,!0)}get linkToPortIdProperty(){return this.Ha}set linkToPortIdProperty(t){const i=this.Ha;i!==t&&(this.Pn(t,pe,"linkToPortIdProperty"),this.Ha=t,this.t("linkToPortIdProperty",i,t))}getToPortIdForLinkData(t){return this.I1(t,!1)}setToPortIdForLinkData(t,i){this.Jd(t,i,!1)}I1(t,i){if(t===null)return"";const s=i?this.ja:this.Ha;if(s==="")return"";const n=this.yt(t,s);return n===void 0?"":n}Jd(t,i,s){if(t===null)return;const n=s?this.ja:this.Ha;if(n==="")return;if(!this.containsLinkData(t)){this.Z(t,n,i);return}let o=this.yt(t,n);o===void 0&&(o=""),o!==i&&(this.Z(t,n,i),this.vt(s?"linkFromPortId":"linkToPortId",2,n,t,o,i),typeof n=="string"&&this.updateTargetBindings(t,n))}get linkLabelKeysProperty(){return this.$s}set linkLabelKeysProperty(t){const i=this.$s;i!==t&&(this.Pn(t,pe,"linkLabelKeysProperty"),this.$s=t,this.t("linkLabelKeysProperty",i,t))}getLabelKeysForLinkData(t){if(t===null)return pe.EmptyArray;const i=this.$s;if(i==="")return pe.EmptyArray;const s=this.yt(t,i);return s===void 0?pe.EmptyArray:s}setLabelKeysForLinkData(t,i){if(this.zN(i,pe,"setLabelKeysForLinkData:arr"),t===null)return;const s=this.$s;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);if(n===void 0&&(n=pe.EmptyArray),n!==i){if(Array.isArray(n)){const r=n.length;for(let a=0;a<r;a++){const h=n[a];this.Ws(h,t)}}this.Z(t,s,i);const o=i.length;for(let r=0;r<o;r++){const a=i[r];this.findNodeDataForKey(a)===null&&this.Js(a,t)}this.vt("linkLabelKeys",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}addLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||u.Zi(i,"number or string",pe,"addLabelKeyForLinkData:key"),t===null))return;const s=this.$s;if(s==="")return;const n=this.yt(t,s);if(n===void 0){const o=[];o.push(i),this.setLabelKeysForLinkData(t,o)}else if(Array.isArray(n)){let o=n.indexOf(i);if(o>=0)return;o=n.length,n.push(i),this.containsLinkData(t)&&(this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("linkLabelKeys",3,s,t,null,i,null,o))}else u.o(s+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||u.Zi(i,"number or string",pe,"removeLabelKeyForLinkData:key"),t===null))return;const s=this.$s;if(s==="")return;const n=this.yt(t,s);if(Array.isArray(n)){const o=n.indexOf(i);if(o<0)return;this.go(n,o),this.containsLinkData(t)&&(this.Ws(i,t),this.vt("linkLabelKeys",4,s,t,i,null,o,null))}else n!==void 0&&u.o(s+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Ps}set linkDataArray(t){const i=this.Ps;if(i!==t){this.zN(t,pe,"linkDataArray"),this.Di.clear();const s=t.length;for(let o=0;o<s;o++){const r=t[o];u.G(r)||u.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+r)}if(this.Ps=t,this.linkKeyProperty!==""){const o=new Y;for(let a=0;a<s;a++){const h=t[a],l=this.getKeyForLinkData(h);l===void 0||this.Di.get(l)!==null?o.add(h):this.Di.set(l,h)}const r=o.iterator;for(;r.next();){const a=r.value;this.makeLinkDataKeyUnique(a);const h=this.getKeyForLinkData(a);h!==void 0&&this.Di.set(h,a)}}const n=new I;for(let o=0;o<s;o++){const r=t[o];n.add(r)}this.Zo=n,this.vt("linkDataArray",2,"linkDataArray",this,i,t);for(let o=0;o<s;o++){const r=t[o];this.KN(r)}}}get linkKeyProperty(){return this.Dh}set linkKeyProperty(t){const i=this.Dh;if(i!==t){this.Pn(t,pe,"linkKeyProperty"),this.Dh=t,this.Di.clear();const s=this.linkDataArray.length;for(let n=0;n<s;n++){const o=this.linkDataArray[n];let r=this.getKeyForLinkData(o);r===void 0&&(this.makeLinkDataKeyUnique(o),r=this.getKeyForLinkData(o)),r!==void 0&&this.Di.set(r,o)}this.t("linkKeyProperty",i,t)}}getKeyForLinkData(t){if(t===null)return;const i=this.Dh;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;u.o("Key value for link data "+t+" is not a number or a string: "+s)}}setKeyForLinkData(t,i){if((i==null||!this.isKeyType(i))&&u.Zi(i,"number or string",pe,"setKeyForLinkData:key"),t===null)return;const s=this.Dh;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);if(n!==i){if(this.findLinkDataForKey(i)!==null)return;this.Z(t,s,i),n!==void 0&&this.Di.delete(n),this.Di.set(i,t),this.vt("linkKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s)}}get makeUniqueLinkKeyFunction(){return this.Rf}set makeUniqueLinkKeyFunction(t){const i=this.Rf;i!==t&&(this.Rf=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return t===null&&u.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.Di.get(t)}G1(t){return t===void 0?!1:this.Di.has(t)}makeLinkDataKeyUnique(t){if(t===null)return;const i=this.Dh;if(i==="")return;let s=this.getKeyForLinkData(t);if(s!==void 0&&!this.G1(s))return;const n=this.Rf;if(n!==null&&(s=n(this,t),s!=null&&!this.G1(s))){this.Z(t,i,s);return}if(typeof s=="string"){let o=2;for(;this.G1(s+o);)o++;this.Z(t,i,s+o)}else if(s===void 0||typeof s=="number"){let o=-this.Di.count-1;for(;this.G1(o);)o--;this.Z(t,i,o)}}containsLinkData(t){return t===null?!1:this.Zo.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.jT(t,!0))}jT(t,i){if(this.linkKeyProperty!==""){let n=this.getKeyForLinkData(t);if(n===void 0)this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t);else{if(this.Di.get(n)===t)return;this.makeLinkDataKeyUnique(t),n=this.getKeyForLinkData(t)}n===void 0&&u.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Di.set(n,t)}this.Zo.add(t);let s=null;i&&(s=this.Ps.length,this.$o(this.Ps,s,t)),this.vt("linkDataArray",3,"linkDataArray",this,null,t,null,s),this.KN(t)}addLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.addLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.addLinkData(s)}}}removeLinkData(t){t!==null&&this.KT(t,!0)}KT(t,i){this.Zo.delete(t);const s=this.getKeyForLinkData(t);s!==void 0&&this.Di.delete(s);let n=null;if(i){if(n=this.Ps.indexOf(t),n<0)return;this.go(this.Ps,n)}this.vt("linkDataArray",4,"linkDataArray",this,t,null,n,null),this.ZO(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++)this.removeLinkData(t[s])}else{const i=t.iterator;for(;i.next();){const s=i.value;this.removeLinkData(s)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&u.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const i=new I;i.addAll(this.Di.iteratorKeys);const s=new I,n=t.length;for(let r=0;r<n;r++){const a=t[r],h=this.getKeyForLinkData(a);if(h!==void 0){s.add(h);const l=this.findLinkDataForKey(h);if(l===a)continue;if(l!==null)this.assignAllDataProperties(l,a),this.hD(a,l);else{const c=this.cloneDeep(a);this.setKeyForLinkData(c,h),this.addLinkData(c)}}else{const l=this.cloneDeep(a);this.addLinkData(l),s.add(this.getKeyForLinkData(l))}}const o=i.iterator;for(;o.next();){const r=o.value;if(!s.has(r)){const a=this.findLinkDataForKey(r);a&&this.removeLinkData(a)}}}KN(t){let i=this.Ae(t,!0);i=this.GN(i),this.findNodeDataForKey(i)===null&&this.Js(i,t),i=this.Ae(t,!1),i=this.GN(i),this.findNodeDataForKey(i)===null&&this.Js(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.findNodeDataForKey(i)===null&&this.Js(i,t)}}ZO(t){let i=this.Ae(t,!0);this.Ws(i,t),i=this.Ae(t,!1),this.Ws(i,t);const s=this.getLabelKeysForLinkData(t);if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++)i=s[o],this.Ws(i,t)}}get copyLinkDataFunction(){return this.vf}set copyLinkDataFunction(t){const i=this.vf;i!==t&&(this.vf=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){if(t===null)return null;let i=null;const s=this.vf;return s!==null?i=s(t,this):i=this.Y1(t,!0),u.G(i)&&(this.mo!==""&&this.Z(i,this.mo,void 0),this.po!==""&&this.Z(i,this.po,void 0),this.$s!==""&&this.Z(i,this.$s,[])),i}get nodeIsGroupProperty(){return this.Of}set nodeIsGroupProperty(t){const i=this.Of;i!==t&&(this.Pn(t,pe,"nodeIsGroupProperty"),this.Of=t,this.t("nodeIsGroupProperty",i,t))}isGroupForNodeData(t){if(t===null)return!1;const i=this.Of;return i===""?!1:!!this.yt(t,i)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Sn}set nodeGroupKeyProperty(t){const i=this.Sn;i!==t&&(this.Pn(t,pe,"nodeGroupKeyProperty"),this.Sn=t,this.t("nodeGroupKeyProperty",i,t))}get copiesGroupKeyOfNodeData(){return this.rg}set copiesGroupKeyOfNodeData(t){this.rg!==t&&(this.rg=t)}getGroupKeyForNodeData(t){if(t===null)return;const i=this.Sn;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;u.o("GroupKey value for node data "+t+" is not a number or a string: "+s)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&u.Zi(i,"number or string",pe,"setGroupKeyForNodeData:key"),t===null)return;const s=this.Sn;if(s==="")return;if(!this.containsNodeData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);n!==i&&(this.Ws(n,t),this.Z(t,s,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("nodeGroupKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setGroupForData(t,i){this.setGroupKeyForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Sn!==""&&this.yt(i,this.Sn)!==void 0&&this.Z(i,this.Sn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,s);return}}else if(this.containsLinkData(t)){if(i===this.linkFromKeyProperty){this.Wd(t,s,!0);return}else if(i===this.linkToKeyProperty){this.Wd(t,s,!1);return}else if(i===this.linkFromPortIdProperty){this.Jd(t,s,!0);return}else if(i===this.linkToPortIdProperty){this.Jd(t,s,!1);return}else if(i===this.linkKeyProperty){this.setKeyForLinkData(t,s);return}else if(i===this.linkCategoryProperty){this.setCategoryForLinkData(t,s);return}else if(i===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,s);return}}const n=this.yt(t,i);n!==s&&(this.Z(t,i,s),this.raiseDataChanged(t,i,n,s))}assignAllDataProperties(t,i){if(!i)return;const s=this.containsNodeData(t),n=this.containsLinkData(t);for(const o in i)if(o!=="__gohashid"&&!(s&&o===this.nodeKeyProperty)){if(s&&o===this.nodeIsGroupProperty&&this.yt(t,o)===i[o]||n&&o===this.linkKeyProperty)continue;this.setDataProperty(t,o,i[o])}}Ry(t,i){super.Ry(t,i);const s=this.mi.iterator;for(;s.next();){const o=s.value;this.jN(o,t,i)}const n=this.Zo.iterator;for(;n.next();){const o=n.value;this.QO(o,t,i)}}jN(t,i,s){if(this.getGroupKeyForNodeData(t)===i){const n=this.Sn;this.Z(t,n,s),this.vt("nodeGroupKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}QO(t,i,s){if(this.Ae(t,!0)===i){const o=this.mo;this.Z(t,o,s),this.vt("linkFromKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}if(this.Ae(t,!1)===i){const o=this.po;this.Z(t,o,s),this.vt("linkToKey",2,o,t,i,s),typeof o=="string"&&this.updateTargetBindings(t,o)}const n=this.getLabelKeysForLinkData(t);if(Array.isArray(n)){const o=n.length,r=this.$s;for(let a=0;a<o;a++)n[a]===i&&(this.iD(n,a,s),this.vt("linkLabelKeys",3,r,t,i,s,a,a))}}XN(){super.XN();const t=this.linkDataArray,i=t.length;for(let s=0;s<i;s++){const n=t[s];this.KN(n)}}ng(t){super.ng(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=u.et(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)){if(this.getGroupKeyForNodeData(r)===i){const a=this.Sn;this.vt("nodeGroupKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}}else{if(this.Ae(r,!0)===i){const h=this.mo;this.vt("linkFromKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}if(this.Ae(r,!1)===i){const h=this.po;this.vt("linkToKey",2,h,r,i,i),typeof h=="string"&&this.updateTargetBindings(r,h),n.push(r)}const a=this.getLabelKeysForLinkData(r);if(Array.isArray(a)){const h=a.length,l=this.$s;for(let c=0;c<h;c++)a[c]===i&&(this.vt("linkLabelKeys",3,l,r,i,i,c,c),n.push(r))}}}for(let r=0;r<n.length;r++)this.Ws(i,n[r]);u.J(n)}}og(t){super.og(t);const i=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(i)===null&&this.Js(i,t)}vy(t){super.vy(t);const i=this.getGroupKeyForNodeData(t);this.Ws(i,t)}get linkCategoryProperty(){return this.qa}set linkCategoryProperty(t){const i=this.qa;i!==t&&(this.Pn(t,pe,"linkCategoryProperty"),this.qa=t,this.t("linkCategoryProperty",i,t))}getCategoryForLinkData(t){if(t===null)return"";const i=this.qa;if(i==="")return"";const s=this.yt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;u.o("getCategoryForLinkData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(t===null)return;const s=this.qa;if(s==="")return;if(!this.containsLinkData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);n===void 0&&(n=""),n!==i&&(this.Z(t,s,i),this.vt("linkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setCategoryForLinkData(t,i)}sg(t,i){super.sg(t,i),this.setGroupKeyForNodeData(i,this.getGroupKeyForNodeData(t))}hD(t,i){this.setCategoryForLinkData(i,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(i,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(i,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(i,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(i,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(i,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}mm(){return!0}Ra(){return!0}Xw(){return!0}Hc(){return!0}};g(pe,"EmptyArray",Object.freeze([]));let Os=pe;te.fl(Os,"GraphLinksModel"),te.tD=()=>new Os,te.LM=()=>new Os;class Rs extends te{constructor(t,i){super();g(this,"Mn");g(this,"lg");g(this,"Wa");if(this.Mn="parent",this.lg=!1,this.Wa="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Mn=this.Mn,t.lg=this.lg,t.Wa=this.Wa}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" TreeModel";if(t>0){i+=`
 node data:`;const s=this.nodeDataArray,n=s.length;for(let o=0;o<n;o++){const r=s[o];i+=" "+this.getKeyForNodeData(r)+":"+Vi.toString(r)}}return i}}eg(){const t=super.eg();let i="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(i+=`,
  "nodeParentKeyProperty": `+this.De(this.nodeParentKeyProperty)),t+i}Dy(t){super.Dy(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Fy(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&u.o("applyIncrementalJson cannot change Model properties"),super.Fy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Mn}set nodeParentKeyProperty(t){const i=this.Mn;i!==t&&(this.Pn(t,Rs,"nodeParentKeyProperty"),this.Mn=t,this.t("nodeParentKeyProperty",i,t))}get copiesParentKeyOfNodeData(){return this.lg}set copiesParentKeyOfNodeData(t){this.lg!==t&&(this.lg=t)}getParentKeyForNodeData(t){if(t===null)return;const i=this.Mn;if(i==="")return;const s=this.yt(t,i);if(s!==void 0){if(this.isKeyType(s))return s;u.o("ParentKey value for node data "+t+" is not a number or a string: "+s)}}setParentKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&u.Zi(i,"number or string",Rs,"setParentKeyForNodeData:key"),t===null)return;const s=this.Mn;if(s==="")return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t)){this.Z(t,s,i);return}const n=this.yt(t,s);n!==i&&(this.Ws(n,t),this.Z(t,s,i),this.findNodeDataForKey(i)===null&&this.Js(i,t),this.vt("nodeParentKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get parentLinkCategoryProperty(){return this.Wa}set parentLinkCategoryProperty(t){const i=this.Wa;i!==t&&(this.Pn(t,Rs,"parentLinkCategoryProperty"),this.Wa=t,this.t("parentLinkCategoryProperty",i,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const i=this.Wa;if(i==="")return"";const s=this.yt(t,i);if(s===void 0)return"";if(typeof s=="string")return s;u.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+s)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(t===null)return;const s=this.Wa;if(s==="")return;if(!this.containsNodeData(t)){this.Z(t,s,i);return}let n=this.yt(t,s);n===void 0&&(n=""),n!==i&&(this.Z(t,s,i),this.vt("parentLinkCategory",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}setLinkCategoryForData(t,i){this.setParentLinkCategoryForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Mn!==""&&this.yt(i,this.Mn)!==void 0&&this.Z(i,this.Mn,void 0),i}setDataProperty(t,i,s){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,s);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,s);return}else if(i===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,s);return}else if(i===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,s);return}}const n=this.yt(t,i);n!==s&&(this.Z(t,i,s),this.raiseDataChanged(t,i,n,s))}Ry(t,i){super.Ry(t,i);const s=this.mi.iterator;for(;s.next();){const n=s.value;this.jN(n,t,i)}}jN(t,i,s){if(this.getParentKeyForNodeData(t)===i){const n=this.Mn;this.Z(t,n,s),this.vt("nodeParentKey",2,n,t,i,s),typeof n=="string"&&this.updateTargetBindings(t,n)}}ng(t){super.ng(t);const i=this.getKeyForNodeData(t),s=this.Cy(i);if(s!==null){const n=u.et(),o=s.iterator;for(;o.next();){const r=o.value;if(this.containsNodeData(r)&&this.getParentKeyForNodeData(r)===i){const a=this.Mn;this.vt("nodeParentKey",2,a,r,i,i),typeof a=="string"&&this.updateTargetBindings(r,a),n.push(r)}}for(let r=0;r<n.length;r++)this.Ws(i,n[r]);u.J(n)}}og(t){super.og(t);let i=this.getParentKeyForNodeData(t);i=this.maybeEnsureLinkReference(i),this.findNodeDataForKey(i)===null&&this.Js(i,t)}vy(t){super.vy(t);const i=this.getParentKeyForNodeData(t);this.Ws(i,t)}sg(t,i){super.sg(t,i),this.setParentLinkCategoryForNodeData(i,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(i,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}pm(){return!0}Xw(){return!0}}te.fl(Rs,"TreeModel");var Go=(S=>(S[S.ConstantSpacing=0]="ConstantSpacing",S[S.ConstantDistance=1]="ConstantDistance",S[S.ConstantAngle=2]="ConstantAngle",S[S.Packed=3]="Packed",S))(Go||{}),Ho=(S=>(S[S.Clockwise=10]="Clockwise",S[S.Counterclockwise=11]="Counterclockwise",S[S.BidirectionalLeft=12]="BidirectionalLeft",S[S.BidirectionalRight=13]="BidirectionalRight",S))(Ho||{}),qo=(S=>(S[S.Forwards=20]="Forwards",S[S.Reverse=21]="Reverse",S[S.Ascending=22]="Ascending",S[S.Descending=23]="Descending",S[S.Optimized=24]="Optimized",S))(qo||{}),$o=(S=>(S[S.Pythagorean=30]="Pythagorean",S[S.Circular=31]="Circular",S))($o||{});class Fe extends De{constructor(t){super();g(this,"le");g(this,"If");g(this,"K1");g(this,"hg");g(this,"j1");g(this,"Fh");g(this,"HN");g(this,"qN");g(this,"WN");g(this,"Ss");g(this,"Oy");g(this,"Iy");g(this,"Ja");g(this,"Ey");g(this,"aD");g(this,"ag");g(this,"cg");g(this,"fg");g(this,"Ef");g(this,"Xi");g(this,"b");g(this,"pe");g(this,"ye");g(this,"kn");g(this,"ug");this.le=0,this.If=0,this.K1=0,this.hg=360,this.j1=0,this.Fh=0,this.HN=new C,this.qN=30,this.WN=0,this.Ss=0,this.Oy=0,this.Iy=new ma,this.Ja=0,this.Ey=0,this.aD=600,this.ag=NaN,this.cg=1,this.fg=0,this.Ef=360,this.Xi=0,this.b=10,this.pe=24,this.ye=Zi.standardComparer,this.kn=6,this.ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ag=this.ag,t.cg=this.cg,t.fg=this.fg,t.Ef=this.Ef,t.Xi=this.Xi,t.b=this.b,t.pe=this.pe,t.ye=this.ye,t.kn=this.kn,t.ug=this.ug}oi(t){t in qo?this.sorting=t:t in Ho?this.direction=t:t in Go?this.arrangement=t:t in $o?this.nodeDiameterFormula=t:super.oi(t)}createNetwork(){return new pa(this)}_O(t,i,s){t=this.tI(t);let n=this.j1,o=this.qN,r=this.le,a=this.If,h=this.K1,l=this.hg,c=this.Fh,d=this.WN,f=this.Ss,m=this.Oy;if(n=this.arrangement,o=this.nodeDiameterFormula,r=this.radius,(!isFinite(r)||r<=0)&&(r=NaN),a=this.aspectRatio,(!isFinite(a)||a<=0)&&(a=1),h=this.startAngle,isFinite(h)||(h=0),l=this.sweepAngle,(!isFinite(l)||l>360||l<1)&&(l=360),c=this.spacing,isFinite(c)||(c=NaN),n===3&&o===31?n=0:n===3&&o!==31&&(o=31,n=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let x=0;!(x>=t.length||(i.add(t.elt(x)),x+1>=t.length));x+=2)s.add(t.elt(x+1));this.direction===12?(this.arrangement===3&&i.reverse(),t=new Y,t.addAll(i),t.addAll(s)):(this.arrangement===3&&s.reverse(),t=new Y,t.addAll(s),t.addAll(i))}const p=t.length;d=0;let y=0;for(let x=0;x<t.length;x++){const b=h+l*y*(this.direction===10?1:-1)/p;let M=t.elt(x).diameter;isNaN(M)&&(M=t.elt(x).Rh(b)),l<360&&(x===0||x===t.length-1)&&(M/=2),d+=M,y++}if(isNaN(r)||n===3){if(isNaN(c)&&(c=6),n!==0&&n!==3){let x=-1/0;for(let b=0;b<p;b++){const M=t.elt(b),P=t.elt(b===p-1?0:b+1);isNaN(M.diameter)&&M.Rh(0),isNaN(P.diameter)&&P.Rh(0),x=Math.max(x,(M.diameter+P.diameter)/2)}if(m=x+c,n===2){const b=2*Math.PI/p,M=(x+c)/b;a>1?(r=M,f=r*a):(f=M,r=f)}else r=this.H1(m*(l>=360?p:p-1),a,h*Math.PI/180,l*Math.PI/180)}else r=this.H1(d+(l>=360?p:p-1)*(n!==3?c:c*1.6),a,h*Math.PI/180,l*Math.PI/180);f=r*a}else{f=r*a;const x=this.JN(r,f,h*Math.PI/180,l*Math.PI/180);if(isNaN(c))n===0&&(c=(x-d)/(l>=360?p:p-1));else if(n===0){const b=(x-d)/(l>=360?p:p-1);b<c?(r=this.H1(d+c*(l>=360?p:p-1),a,h*Math.PI/180,l*Math.PI/180),f=r*a):c=b}else{let b=-1/0;for(let k=0;k<p;k++){const L=t.elt(k),T=t.elt(k===p-1?0:k+1);isNaN(L.diameter)&&L.Rh(0),isNaN(T.diameter)&&T.Rh(0),b=Math.max(b,(L.diameter+T.diameter)/2)}const M=b+c,P=this.H1(M*(l>=360?p:p-1),a,h*Math.PI/180,l*Math.PI/180);P>r?(r=P,f=r*a,m=M):m=x/(l>=360?p:p-1)}}return this.j1=n,this.qN=o,this.le=r,this.If=a,this.K1=h,this.hg=l,this.Fh=c,this.WN=d,this.Ss=f,this.Oy=m,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(i.count===1){const m=i.first();m.centerX=0,m.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let s=new Y;s.addAll(i.iterator);const n=new Y,o=new Y;s=this._O(s,n,o);const r=this.j1,a=this.le,h=this.K1,l=this.hg,c=this.Fh,d=this.Ss,f=this.Oy;if((this.direction===12||this.direction===13)&&r===3)this.cD(s,l,h-l/2,10);else if(this.direction===12||this.direction===13){let m=0;switch(r){case 1:m=this.q1(a,d,h,f)*180/Math.PI;break;case 0:{let p=0,y=0;const x=n.first();x!==null&&(p=x.Rh(Math.PI/2));const b=o.first();b!==null&&(y=b.Rh(Math.PI/2)),m=this.q1(a,d,h,c+(p+y)/2)*180/Math.PI;break}case 2:m=l/s.length;break}if(this.direction===12){switch(r){case 1:this.Uy(n,l/2,h,11);break;case 0:this.By(n,l/2,h,11);break;case 2:this.Vy(n,l/2,h,11);break}switch(r){case 1:this.Uy(o,l/2,h+m,10);break;case 0:this.By(o,l/2,h+m,10);break;case 2:this.Vy(o,l/2,h+m,10);break}}else{switch(r){case 1:this.Uy(o,l/2,h,11);break;case 0:this.By(o,l/2,h,11);break;case 2:this.Vy(o,l/2,h,11);break}switch(r){case 1:this.Uy(n,l/2,h+m,10);break;case 0:this.By(n,l/2,h+m,10);break;case 2:this.Vy(n,l/2,h+m,10);break}}}else switch(r){case 1:this.Uy(s,l,h,this.direction);break;case 0:this.By(s,l,h,this.direction);break;case 2:this.Vy(s,l,h,this.direction);break;case 3:this.cD(s,l,h,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}Vy(t,i,s,n){const o=this.hg,r=this.le,a=this.Ss,h=s*Math.PI/180,l=i*Math.PI/180,c=t.length;for(let d=0;d<c;d++){const f=h+(n===10?d*l/(o>=360?c:c-1):-(d*l)/c),m=t.elt(d),p=r*Math.tan(f)/a,y=Math.sqrt((r*r+a*a*p*p)/(1+p*p));m.centerX=y*Math.cos(f),m.centerY=y*Math.sin(f),m.actualAngle=f*180/Math.PI}}By(t,i,s,n){const o=this.le,r=this.Ss,a=this.Fh;let h=s*Math.PI/180;const l=t.length;for(let c=0;c<l;c++){const d=t.elt(c),f=t.elt(c===l-1?0:c+1),m=o*Math.cos(h),p=r*Math.sin(h);d.centerX=m,d.centerY=p,d.actualAngle=h*180/Math.PI,isNaN(d.diameter)&&d.Rh(0),isNaN(f.diameter)&&f.Rh(0);const y=(d.diameter+f.diameter)/2,x=this.q1(o,r,n===10?h:-h,y+a);h+=n===10?x:-x}}Uy(t,i,s,n){const o=this.le,r=this.Ss,a=this.Oy;let h=s*Math.PI/180;const l=t.length;for(let c=0;c<l;c++){const d=t.elt(c);d.centerX=o*Math.cos(h),d.centerY=r*Math.sin(h),d.actualAngle=h*180/Math.PI;const f=this.q1(o,r,n===10?h:-h,a);h+=n===10?f:-f}}cD(t,i,s,n){let o=this.Ey;const r=this.hg;if(this.Ja=0,this.Iy=new ma,i<360){for(o=s+(n===10?r:-r);o<0;)o+=360;o%=360,o>180&&(o-=360),o*=Math.PI/180,this.Ey=o,this.fD(t,i,s,n)}else this.uD(t,i,s,n);this.Iy.commit(t)}uD(t,i,s,n){const o=this.le,r=this.Ss,a=this.Fh,h=this.If;let l=o*Math.cos(s*Math.PI/180),c=r*Math.sin(s*Math.PI/180);const d=t.toArray();if(d.length===3){d[0].centerX=o,d[0].centerY=0,d[1].centerX=d[0].centerX-d[0].width/2-d[1].width/2-a,d[1].y=d[0].y,d[2].centerX=(d[0].centerX+d[1].centerX)/2,d[2].y=d[0].y-d[2].height-a;return}else if(d.length===4){d[0].centerX=o,d[0].centerY=0,d[2].centerX=-d[0].centerX,d[2].centerY=d[0].centerY,d[1].centerX=0,d[1].y=Math.min(d[0].y,d[2].y)-d[1].height-a,d[3].centerX=0,d[3].y=Math.max(d[0].y+d[0].height+a,d[2].y+d[2].height+a);return}const f=C.l();for(let L=0;L<d.length&&(d[L].centerX=l,d[L].centerY=c,!(L>=d.length-1));L++)this.dD(l,c,d,L,n,f)||this.gD(l,c,d,L,n,f),l=f.x,c=f.y;if(C.e(f),this.Ja++,this.Ja>23)return;const m=d[0].centerX,p=d[0].centerY,y=d[d.length-1].centerX,x=d[d.length-1].centerY;let b=Math.abs(m-y)-((d[0].width+d[d.length-1].width)/2+a);const M=Math.abs(p-x)-((d[0].height+d[d.length-1].height)/2+a);let P=0;if(Math.abs(M)<1){const L=Math.abs(m-y),T=(d[0].width+d[d.length-1].width)/2;L<T&&(P=0),b=L-T}else M>0?P=M:Math.abs(b)<1?P=0:P=b;let k=!1;Math.abs(y)>Math.abs(x)?k=y>0!=p>x:k=x>0!=m<y,k=n===10?k:!k,k&&(P=-Math.abs(P),P=Math.min(P,-d[d.length-1].width),P=Math.min(P,-d[d.length-1].height)),this.Iy.iI(P,d),Math.abs(P)>1&&(this.Ja<8?this.le-=P/(2*Math.PI):d.length<5&&P>10?this.le/=2:this.le-=P>0?1.7:-2.3,this.Ss=this.le*h,this.uD(t,i,s,n))}fD(t,i,s,n){const o=this.le,r=this.Ss,a=this.If;let h=o*Math.cos(s*Math.PI/180),l=r*Math.sin(s*Math.PI/180);const c=C.l(),d=t.toArray();for(let y=0;y<d.length&&(d[y].centerX=h,d[y].centerY=l,!(y>=d.length-1));y++)this.dD(h,l,d,y,n,c)||this.gD(h,l,d,y,n,c),h=c.x,l=c.y;if(C.e(c),this.Ja++,this.Ja>23)return;const f=Math.atan2(l,h);let m=n===10?this.Ey-f:f-this.Ey;m=Math.abs(m)<Math.abs(m-2*Math.PI)?m:m-2*Math.PI;const p=m*(o+r)/2;this.Iy.eI(p,d),Math.abs(p)>1&&(this.Ja<8?this.le-=p/(2*Math.PI):this.le-=p>0?1.7:-2.3,this.Ss=this.le*a,this.fD(t,i,s,n))}dD(t,i,s,n,o,r){const a=this.Fh,h=this.le,l=this.Ss;let c=0,d=0;const f=(s[n].width+s[n+1].width)/2+a;let m=!1;if(i>=0!=(o===10)){if(c=t+f,c>h){if(c=t-f,c<-h)return r.x=c,r.y=d,!1;m=!0}}else if(c=t-f,c<-h){if(c=t+f,c>h)return r.x=c,r.y=d,!1;m=!0}return d=Math.sqrt(1-Math.min(1,c*c/(h*h)))*l,i<0!==m&&(d=-d),Math.abs(i-d)>(s[n].height+s[n+1].height)/2?(r.x=c,r.y=d,!1):(r.x=c,r.y=d,!0)}gD(t,i,s,n,o,r){const a=this.Fh,h=this.le,l=this.Ss;let c=0,d=0;const f=(s[n].height+s[n+1].height)/2+a;let m=!1;if(t>=0!=(o===10)){if(d=i-f,d<-l){if(d=i+f,d>l)return r.x=c,r.y=d,!1;m=!0}}else if(d=i+f,d>l){if(d=i-f,d<-l)return r.x=c,r.y=d,!1;m=!0}return c=Math.sqrt(1-Math.min(1,d*d/(l*l)))*h,t<0!==m&&(c=-c),Math.abs(t-c)>(s[n].width+s[n+1].width)/2?(r.x=c,r.y=d,!1):(r.x=c,r.y=d,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let s=this.actualCenter;t?s=new C(0,0):(s.x=this.arrangementOrigin.x+this.le,s.y=this.arrangementOrigin.y+this.Ss);const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;o.x+=s.x,o.y+=s.y,o.commit()}if(t){this.group.ensureBounds();const o=this.group.position.copy(),r=this.group.location.copy(),a=i.subtract(r.subtract(o));this.group.move(a),this.HN=a.subtract(o)}}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}JN(t,i,s,n){const o=this.aD;if(Math.abs(this.If-1)<.001)return s!==void 0&&n!==void 0?n*t:2*Math.PI*t;const r=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let a=0,h=0;s!==void 0&&n!==void 0?h=n/(o+1):h=Math.PI/(2*(o+1));let l=0;for(let c=0;c<=o;c++){s!==void 0&&n!==void 0?l=s+c*n/o:l=c*Math.PI/(2*o);const d=Math.sin(l);a+=Math.sqrt(1-r*r*d*d)*h}return s!==void 0&&n!==void 0?(t>i?t:i)*a:4*(t>i?t:i)*a}H1(t,i,s,n){let o=0;return s!==void 0&&n!==void 0?o=this.JN(1,i,s,n):o=this.JN(1,i),t/o}q1(t,i,s,n){if(Math.abs(this.If-1)<.001)return n/t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let r=0;const a=2*Math.PI/(this.network.vertexes.count*700);t>i&&(s+=Math.PI/2);for(let h=0;;h++){const l=s+h*a,c=Math.sin(l);if(r+=(t>i?t:i)*Math.sqrt(1-o*o*c*c)*a,r>=n)return h*a}}tI(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.sI(this.nI(t));default:u.o("Invalid sorting type.")}return t}nI(t){const i=[];for(let n=0;n<t.length;n++)i.push(0);const s=new Y;for(let n=0;n<t.length;n++){let o=-1,r=-1;if(n===0)for(let d=0;d<t.length;d++){const f=t.elt(d).edgesCount;f>o&&(o=f,r=d)}else for(let d=0;d<t.length;d++){const f=i[d];f>o&&(o=f,r=d)}s.add(t.elt(r)),i[r]=-1;const a=t.elt(r);let h=0;const l=a.sourceEdges;for(;l.next();){const d=l.value.fromVertex;h=t.indexOf(d),!(h<0)&&i[h]>=0&&i[h]++}const c=a.destinationEdges;for(;c.next();){const d=c.value.toVertex;h=t.indexOf(d),!(h<0)&&i[h]>=0&&i[h]++}}return s}sI(t){const i=[];for(let f=0;f<t.length;f++){const m=t.elt(f);i[f]=[];let p=0;const y=m.destinationEdges;for(;y.next();){const b=y.value.toVertex;p=t.indexOf(b),p!==f&&i[f].indexOf(p)<0&&i[f].push(p)}const x=m.sourceEdges;for(;x.next();){const b=x.value.fromVertex;p=t.indexOf(b),p!==f&&i[f].indexOf(p)<0&&i[f].push(p)}}const s=[];for(let f=0;f<i.length;f++)s[f]=0;const n=[],o=[],r=[],a=[],h=new Y;let l=0;for(let f=0;f<i.length;f++){const m=i[f].length;if(m===1){a.push(f);continue}if(m===0){h.add(t.elt(f));continue}if(l===0){n.push(f),l++;continue}let p=1/0,y=1/0,x=-1;const b=[];for(let M=0;M<n.length;M++)i[n[M]].indexOf(n[M===n.length-1?0:M+1])<0&&b.push(M===n.length-1?0:M+1);if(b.length===0)for(let M=0;M<n.length;M++)b.push(M);for(let M=0;M<b.length;M++){const P=b[M],k=this.oI(i[f],o,r,s,P,n);let L=0;for(let T=0;T<i[f].length;T++){const D=i[f][T],B=n.indexOf(D);if(B>=0){const E=Math.abs(P-(B>=P?B+1:B));L+=E<n.length+1-E?E:n.length+1-E}}for(let T=0;T<o.length;T++){let D=s[o[T]],B=s[r[T]];if(D>=P&&D++,B>=P&&B++,D>B){const E=B;B=D,D=E}B-D<(n.length+2)/2==(D<P&&P<=B)&&L++}(k<p||k===p&&L<y)&&(p=k,y=L,x=P)}n.splice(x,0,f);for(let M=0;M<n.length;M++)s[n[M]]=M;for(let M=0;M<i[f].length;M++){const P=i[f][M];n.indexOf(P)>=0&&(o.push(f),r.push(P))}l++}let c=!1;const d=n.length;for(;;){c=!0;for(let f=0;f<a.length;f++){const m=a[f],p=i[m][0],y=n.indexOf(p);if(y>=0){let x=0;for(let b=0;b<i[p].length;b++){const M=i[p][b],P=n.indexOf(M);if(P<0||P===y)continue;const k=P>y?P-y:y-P,L=d-k;x+=P<y!=k>L?1:-1}n.splice(x<0?y:y+1,0,m),a.splice(f,1),f--}else c=!1}if(c)break;n.push(a[0]),a.splice(0,1)}for(let f=0;f<n.length;f++){const m=n[f];h.add(t.elt(m))}return h}oI(t,i,s,n,o,r){let a=0;for(let h=0;h<i.length;h++){const l=i[h],c=s[h],d=n[l],f=n[c];let m=0,p=0;if(d<f?(m=d,p=f):(m=f,p=d),m<o&&o<=p)for(let y=0;y<t.length;y++){const x=t[y];r.indexOf(x)<0||m<n[x]&&n[x]<p||m===n[x]||p===n[x]||a++}else for(let y=0;y<t.length;y++){const x=t[y];r.indexOf(x)<0||!(m<n[x]&&n[x]<p)||m===n[x]||p===n[x]||a++}}return a}get radius(){return this.ag}set radius(t){this.ag!==t&&(t>0||isNaN(t))&&(this.ag=t,this.invalidateLayout())}get aspectRatio(){return this.cg}set aspectRatio(t){this.cg!==t&&t>0&&(this.cg=t,this.invalidateLayout())}get startAngle(){return this.fg}set startAngle(t){this.fg!==t&&(this.fg=t,this.invalidateLayout())}get sweepAngle(){return this.Ef}set sweepAngle(t){this.Ef!==t&&(t>0&&t<=360?this.Ef=t:this.Ef=360,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===3||t===0||t===1||t===2)&&(this.Xi=t,this.invalidateLayout())}get direction(){return this.b}set direction(t){this.b!==t&&(t===10||t===11||t===12||t===13)&&(this.b=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t,this.invalidateLayout())}get spacing(){return this.kn}set spacing(t){this.kn!==t&&(this.kn=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.ug}set nodeDiameterFormula(t){this.ug!==t&&(t===30||t===31)&&(this.ug=t,this.invalidateLayout())}get actualXRadius(){return this.le}get actualYRadius(){return this.Ss}get actualSpacing(){return this.Fh}get actualCenter(){return this.HN}}g(Fe,"ConstantSpacing",0),g(Fe,"ConstantDistance",1),g(Fe,"ConstantAngle",2),g(Fe,"Packed",3),g(Fe,"Clockwise",10),g(Fe,"Counterclockwise",11),g(Fe,"BidirectionalLeft",12),g(Fe,"BidirectionalRight",13),g(Fe,"Forwards",20),g(Fe,"Reverse",21),g(Fe,"Ascending",22),g(Fe,"Descending",23),g(Fe,"Optimized",24),g(Fe,"Pythagorean",30),g(Fe,"Circular",31);class ma{constructor(){g(this,"Uf");g(this,"$a");g(this,"Bf");this.Uf=-1/0,this.$a=null,this.Bf=null}iI(e,t){if(e>0&&this.Uf<0||Math.abs(e)<Math.abs(this.Uf)&&!(e<0&&this.Uf>0)){this.Uf=e,this.$a=[],this.Bf=[];for(let i=0;i<t.length;i++)this.$a[i]=t[i].bounds.x,this.Bf[i]=t[i].bounds.y}}eI(e,t){if(Math.abs(e)<Math.abs(this.Uf)){this.Uf=e,this.$a=[],this.Bf=[];for(let i=0;i<t.length;i++)this.$a[i]=t[i].bounds.x,this.Bf[i]=t[i].bounds.y}}commit(e){if(!(this.$a===null||this.Bf===null))for(let t=0;t<this.$a.length;t++){const i=e.elt(t);i.x=this.$a[t],i.y=this.Bf[t]}}}class pa extends _i{constructor(e){super(e)}createVertex(){return new ya(this)}createEdge(){return new xa(this)}}class ya extends Zi{constructor(t){super(t);g(this,"yo");g(this,"W1");this.yo=NaN,this.W1=NaN}Rh(t){const i=this.network;if(i===null)return NaN;const s=i.layout;if(s===null)return NaN;if(s.arrangement===3){if(s.nodeDiameterFormula===31)return this.yo=Math.max(this.width,this.height),this.yo;{const n=Math.abs(Math.sin(t)),o=Math.abs(Math.cos(t));return n===0?this.width:o===0?this.height:(this.yo=Math.min(this.height/n,this.width/o),this.yo)}}else return s.nodeDiameterFormula===31?(this.yo=Math.max(this.width,this.height),this.yo):(this.yo=Math.sqrt(this.width*this.width+this.height*this.height),this.yo)}get diameter(){return this.yo}set diameter(t){this.yo!==t&&(this.yo=t)}get actualAngle(){return this.W1}set actualAngle(t){this.W1!==t&&(this.W1=t)}}class xa extends Ds{constructor(e){super(e)}}class vu extends De{constructor(t){super();g(this,"zy");g(this,"vh");g(this,"Ms");g(this,"dg");g(this,"Nn");g(this,"Fe");g(this,"gg");g(this,"mg");g(this,"pg");g(this,"Vf");g(this,"yg");g(this,"wg");g(this,"zf");g(this,"Xf");g(this,"Yf");g(this,"Gf");g(this,"xg");g(this,"bg");g(this,"Kf");g(this,"Za");this.zy=0,this.vh=0,this.Ms=new rt(100,100).u(),this.dg=!1,this.Nn=!0,this.Fe=!1,this.gg=100,this.mg=300,this.pg=1,this.Vf=1e3,this.yg=10,this.wg=Math,this.zf=.05,this.Xf=50,this.Yf=150,this.Gf=0,this.xg=10,this.bg=5,this.Kf=NaN,this.Za=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ms.a(this.Ms),t.dg=this.dg,t.Nn=this.Nn,t.Fe=this.Fe,t.gg=this.gg,t.mg=this.mg,t.pg=this.pg,t.Vf=this.Vf,t.yg=this.yg,t.wg=this.wg,t.zf=this.zf,t.Xf=this.Xf,t.Yf=this.Yf,t.Gf=this.Gf,t.xg=this.xg,t.bg=this.bg,t.Kf=this.Kf,t.Za=this.Za}createNetwork(){return new wa(this)}doLayout(t){this.network=this.makeNetwork(t);let i=this.network.vertexes.iterator;const s=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),i=this.network.vertexes.iterator;i.next();){const o=i.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const n=this.network.edges.iterator;for(;n.next();){const o=n.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.$N(),this.vh=0,this.needsPrelayout()){const o=this.network,r=o.splitIntoSubNetworks(!1);let a=r.iterator;for(;a.next();){const h=a.value;this.doConnectedSubnetLayout(h)}for(a=r.iterator,this.rI(a,o),a=r.iterator;a.next();){const h=a.value,l=h.vertexes.iterator;for(;l.next();){const d=l.value;o.addVertex(d)}const c=h.edges.iterator;for(;c.next();){const d=c.value;o.addEdge(d)}}}else this.mD(this.network,this.maxIterations);this.updateParts()}this.maxIterations=s,this.isValidLayout=!0}needsPrelayout(){if(this.network===null||this.network.vertexes.count<3)return!1;let t=0,i=0;const s=this.network.vertexes.first().bounds,n=this.network.vertexes.iterator;for(;n.next();){const o=n.value,r=o.bounds;if(isNaN(o.x)||isNaN(o.y)||r.intersectsRect(s)&&(t++,t>2))return!0;if(i>10)return!1;i++}return!1}doConnectedSubnetLayout(t){let i=t.vertexes.iterator;for(;i.next();){const h=i.value;h.hierarchicalVertexes.add(h)}let s=t,n=this.Kf;if(isNaN(n)&&(n=t.edges.count/t.vertexes.count),n<t.vertexes.count)for(;s.vertexes.count>Math.max(100,Math.sqrt(n*t.vertexes.count));)s=this.coarsenNetwork(s);let o=0;i=s.vertexes.iterator;let r=this.randomNumberGenerator;for(r===null&&(this.randomNumberGenerator=r=new Sa(0));i.next();){i.value.idInCluster=o++;const h=10*(r.random()-.5),l=10*(r.random()-.5);this.isFixed(i.value)||(i.value.x=h,i.value.y=l);const c=i.value.hierarchicalVertexes.iterator;for(;c.next();)this.isFixed(c.value)||(c.value.x=h,c.value.y=l)}const a=this.computePairwiseDistances(s);this.lI(s,a,this.maxPrelayoutIterations,t.vertexes.count),this.mD(t,this.maxIterations)}computePairwiseDistances(t){const i=t.vertexes.count,s=new Array(i);for(let a=0;a<i;a++)s[a]=new Array(i).fill(-1),s[a][a]=0;const n=t.vertexes.iterator;let o=new Map,r=[];for(;n.next();){const a=n.value;for(r=[a],o=new Map,o.set(a.idInCluster,0);r.length>0;){const h=r.shift(),l=h.vertexes.iterator;for(;l.next();){const c=l.value;o.has(c.idInCluster)||(o.set(c.idInCluster,o.get(h.idInCluster)+1),r.push(c))}}for(let h=0;h<i;h++){const l=Math.min(s[a.idInCluster][h],s[h][a.idInCluster]),c=o.get(h);(l<0||c<l)&&(s[a.idInCluster][h]=c,s[h][a.idInCluster]=c)}}return s}coarsenNetwork(t){const i=this.createNetwork(),s=new Map;let n=0,o=t.vertexes.iterator;for(;o.next();)o.value.idInCluster=n++;for(o=t.vertexes.iterator;o.next();){const a=o.value;if(s.has(a.idInCluster))continue;let h=Number.MAX_SAFE_INTEGER,l=null;const c=a.vertexes.iterator;for(;c.next();){const f=c.value;s.has(f.idInCluster)||f.hierarchicalVertexes.length<h&&(h=f.hierarchicalVertexes.length,l=f)}const d=i.createVertex();d.hierarchicalVertexes.addAll(a.hierarchicalVertexes),l!=null&&d.hierarchicalVertexes.addAll(l.hierarchicalVertexes),s.set(a.idInCluster,d),l!=null&&s.set(l.idInCluster,d),i.addVertex(d)}const r=t.edges.iterator;for(;r.next();){const a=r.value,h=s.get(a.fromVertex.idInCluster),l=s.get(a.toVertex.idInCluster);if(h===l)continue;const c=i.createEdge();c.fromVertex=h||null,c.toVertex=l||null,i.addEdge(c)}return i}Lw(t,i){let s=!0;const n=t.vertexes.iterator;for(;n.next();){const o=n.value;s?(s=!1,i.set(o.bounds)):i.unionRect(o.bounds)}return i}rI(t,i){const s=this.arrangementSpacing,n=t.count;let o=!0,r=0,a=0;const h=u.et();for(let f=0;f<n+i.vertexes.count+2;f++)h[f]=null;let l=0;t.reset();const c=G.l();let d;for(;t.next();){const f=t.value;if(this.Lw(f,c),o)o=!1,r=c.x+c.width/2,a=c.y+c.height/2,h[0]=new C(c.x+c.width+s.width,c.y),h[1]=new C(c.x,c.y+c.height+s.height),l=2;else{const m=this.pD(h,l,r,a,c.width,c.height,s),p=h[m],y=new C(p.x+c.width+s.width,p.y),x=new C(p.x,p.y+c.height+s.height);m+1<l&&h.splice(m+1,0,null),h[m]=y,h[m+1]=x,l++;const b=p.x-c.x,M=p.y-c.y;for(d=f.vertexes.iterator;d.next();){const P=d.value;this.isFixed(P)||(P.centerX+=b,P.centerY+=M)}}}for(G.e(c),d=i.vertexes.iterator;d.next();){const f=d.value,m=f.bounds;if(l<2){r=m.x+m.width/2,a=m.y+m.height/2,h[0]=new C(m.x+m.width+s.width,m.y),h[1]=new C(m.x,m.y+m.height+s.height),l=2;continue}const p=this.pD(h,l,r,a,m.width,m.height,s),y=h[p],x=new C(y.x+m.width+s.width,y.y),b=new C(y.x,y.y+m.height+s.height);p+1<l&&h.splice(p+1,0,null),h[p]=x,h[p+1]=b,l++,this.isFixed(f)||(f.centerX=y.x+f.width/2,f.centerY=y.y+f.height/2)}u.J(h)}pD(t,i,s,n,o,r,a){let h=9e19,l=-1;t:for(let c=0;c<i;c++){const d=t[c],f=d.x-s,m=d.y-n,p=f*f+m*m;if(p<h){for(let y=c-1;y>=0;y--)if(t[y].y>d.y&&t[y].x-d.x<o+a.width)continue t;for(let y=c+1;y<i;y++)if(t[y].x>d.x&&t[y].y-d.y<r+a.height)continue t;l=c,h=p}}return l}$N(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.node;if(i!==null){const s=i.findNodesConnected();for(;s.next();){const n=s.value;if(n.category!=="Comment"||!n.isVisible())continue;let o=this.network.findVertex(n);o===null&&(o=this.network.addNode(n)),o.charge=this.defaultCommentElectricalCharge;let r=null;const a=o.destinationEdges;for(;a.next();){const h=a.value;if(h.toVertex===t){r=h;break}}if(r===null){const h=o.sourceEdges;for(;h.next();){const l=h.value;if(l.fromVertex===t){r=l;break}}}r===null&&(r=this.network.linkVertexes(t,o,null)),r.length=this.defaultCommentSpringLength}}}yD(t,i){const s=t.bounds,n=s.x,o=s.y,r=s.width,a=s.height,h=i.bounds,l=h.x,c=h.y,d=h.width,f=h.height;if(n+r<l)if(o>c+f){const m=n+r-l,p=o-c-f;return O.Pw(m*m+p*p)}else if(o+a<c){const m=n+r-l,p=o+a-c;return O.Pw(m*m+p*p)}else return l-(n+r);else if(n>l+d)if(o>c+f){const m=n-l-d,p=o-c-f;return O.Pw(m*m+p*p)}else if(o+a<c){const m=n-l-d,p=o+a-c;return O.Pw(m*m+p*p)}else return n-(l+d);else return o>c+f?o-(c+f):o+a<c?c-(o+a):.1}mD(t,i){const s=this.vh+i;for(;this.vh<s&&(this.vh++,!!this.hI(t)););}hI(t){const i=t.vertexes.toArray();if(i.length<=0)return!1;const s=i[0];s.forceX=0,s.forceY=0;let n=s.centerX,o=n,r=s.centerY,a=r;for(let y=1;y<i.length;y++){const x=i[y];x.forceX=0,x.forceY=0;const b=x.centerX,M=x.centerY;n=Math.min(n,b),o=Math.max(o,b),r=Math.min(r,M),a=Math.max(a,M)}const h=o-n>a-r;h?i.sort((y,x)=>y===null||x===null||y===x?0:y.centerX-x.centerX):i.sort((y,x)=>y===null||x===null||y===x?0:y.centerY-x.centerY);const l=this.Vf;let c=0,d=0,f=0;for(let y=0;y<i.length;y++){const x=i[y],b=x.bounds,M=x.focus,P=b.x+M.x,k=b.y+M.y;d=x.charge*this.electricalFieldX(P,k),f=x.charge*this.electricalFieldY(P,k),d+=x.mass*this.gravitationalFieldX(P,k),f+=x.mass*this.gravitationalFieldY(P,k),x.forceX+=d,x.forceY+=f;for(let L=y+1;L<i.length;L++){const T=i[L];if(!this.shouldInteract(x,T)||L===y)continue;const D=T.bounds,B=T.focus,E=D.x+B.x,R=D.y+B.y;if(P-E>l||E-P>l){if(h)break;continue}if(k-R>l||R-k>l){if(!h)break;continue}const F=this.yD(x,T),V=2*x.charge,K=2*T.charge;if(F>1)c=V*K/(F*F),d=c*(P-E)/F,f=c*(k-R)/F;else{let H=this.randomNumberGenerator;H===null&&(this.randomNumberGenerator=H=new Sa(0));const W=H.random(),J=H.random();if(P>E)d=Math.abs(T.bounds.right-x.bounds.x),d=V*K*(1+d)*W;else if(P<E)d=Math.abs(T.bounds.x-x.bounds.right),d=-(V*K)*(1+d)*W;else{const $=Math.max(T.width,x.width);d=V*K*((1+$)*W-$/2)}if(k>R)f=Math.abs(T.bounds.bottom-x.bounds.y),f=V*K*(1+f)*J;else if(P<E)f=Math.abs(T.bounds.y-x.bounds.bottom),f=-(V*K)*(1+f)*J;else{const $=Math.max(T.height,x.height);f=V*K*((1+$)*J-$/2)}}x.forceX+=d,x.forceY+=f,T.forceX-=d,T.forceY-=f}}const m=t.edges.iterator;for(;m.next();){const y=m.value,x=y.fromVertex,b=y.toVertex,M=x.bounds,P=x.focus,k=M.x+P.x,L=M.y+P.y,T=b.bounds,D=b.focus,B=T.x+D.x,E=T.y+D.y,R=this.yD(x,b);R>1&&(c=.1*y.stiffness*(R-y.length),d=c*.5*(x.width+b.height)*(k-B)/R,f=c*.5*(x.width+b.height)*(L-E)/R),x.forceX-=d,x.forceY-=f,b.forceX+=d,b.forceY+=f}let p=0;for(let y=0;y<i.length;y++){const x=i[y];this.isFixed(x)?this.moveFixedVertex(x):p=Math.max(p,this.moveVertex(x)||0)}return p>this.epsilonDistance*this.epsilonDistance}lI(t,i,s,n){const o=this.vh+s,r=Math.sqrt(n);this.zy=this.Za*t.vertexes.count;const a=t.vertexes.toArray();let h=0,l=0,c=0;for(;this.vh<o;){this.vh++,l=h,h=0;for(let d=0;d<a.length;d++){a[d].forceX=0,a[d].forceY=0;for(let m=0;m<a.length;m++){if(d===m)continue;const p=Math.sqrt((a[d].centerX-a[m].centerX)**2+(a[d].centerY-a[m].centerY)**2),y=i[a[d].idInCluster][a[m].idInCluster],x=(p-this.Za*r*y)/p;a[d].forceX+=x*(a[m].x-a[d].x),a[d].forceY+=x*(a[m].y-a[d].y)}const f=Math.sqrt(a[d].forceX*a[d].forceX+a[d].forceY*a[d].forceY);if(f>0){a[d].forceX=this.zy*a[d].forceX/f,a[d].forceY=this.zy*a[d].forceY/f,this.isFixed(a[d])||(a[d].x+=a[d].forceX,a[d].y+=a[d].forceY);const m=a[d].hierarchicalVertexes.iterator;for(;m.next();){const p=m.value;this.isFixed(p)||(p.centerX+=a[d].forceX,p.centerY+=a[d].forceY)}}h+=f*f}if(h>=l){if(c++,c>=5)break}else c=0;this.zy*=.95}}moveVertex(t){let i=t.forceX,s=t.forceY;const n=this.moveLimit;return i<-n?i=-n:i>n&&(i=n),s<-n?s=-n:s>n&&(s=n),t.centerX+=i,t.centerY+=s,i*i+s*s}shouldInteract(t,i){return!0}moveFixedVertex(t){}commitLayout(){this.Xy(),this.commitNodes(),this.isRouting&&this.commitLinks()}Xy(){if(!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const i=t.value.link;i!==null&&(i.fromSpot=U.Default,i.toSpot=U.Default)}}commitNodes(){let t=0,i=0;if(this.arrangesToOrigin){const o=G.l();this.Lw(this.network,o);const r=this.arrangementOrigin;t=r.x-o.x,i=r.y-o.y,G.e(o)}const s=G.l(),n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;(t!==0||i!==0)&&(s.a(o.bounds),s.x+=t,s.y+=i,o.bounds=s),o.commit()}G.e(s)}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const i=t.stiffness;return isNaN(i)?this.zf:i}springLength(t){const i=t.length;return isNaN(i)?this.Xf:i}electricalCharge(t){const i=t.charge;return isNaN(i)?this.Yf:i}electricalFieldX(t,i){return 0}electricalFieldY(t,i){return 0}gravitationalMass(t){const i=t.mass;return isNaN(i)?this.Gf:i}gravitationalFieldX(t,i){return 0}gravitationalFieldY(t,i){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.vh}get arrangementSpacing(){return this.Ms}set arrangementSpacing(t){this.Ms.equals(t)||(this.Ms.a(t),this.invalidateLayout())}get arrangesToOrigin(){return this.dg}set arrangesToOrigin(t){this.dg!==t&&(this.dg=t,this.invalidateLayout())}get setsPortSpots(){return this.Nn}set setsPortSpots(t){this.Nn!==t&&(this.Nn=t,this.invalidateLayout())}get comments(){return this.Fe}set comments(t){this.Fe!==t&&(this.Fe=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.gg}set maxPrelayoutIterations(t){this.gg!==t&&t>=0&&(this.gg=t,this.invalidateLayout())}get maxIterations(){return this.mg}set maxIterations(t){this.mg!==t&&t>=0&&(this.mg=t,this.invalidateLayout())}get epsilonDistance(){return this.pg}set epsilonDistance(t){this.pg!==t&&t>0&&(this.pg=t,this.invalidateLayout())}get infinityDistance(){return this.Vf}set infinityDistance(t){this.Vf!==t&&t>1&&(this.Vf=t,this.invalidateLayout())}get moveLimit(){return this.yg}set moveLimit(t){this.yg!==t&&(this.yg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.wg}set randomNumberGenerator(t){this.wg!==t&&(t!==null&&!u.it(t.random)&&u.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.wg=t)}get defaultSpringStiffness(){return this.zf}set defaultSpringStiffness(t){this.zf!==t&&(this.zf=t,this.invalidateLayout())}get defaultSpringLength(){return this.Xf}set defaultSpringLength(t){this.Xf!==t&&(this.Xf=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.Yf}set defaultElectricalCharge(t){this.Yf!==t&&(this.Yf=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Gf}set defaultGravitationalMass(t){this.Gf!==t&&(this.Gf=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.xg}set defaultCommentSpringLength(t){this.xg!==t&&(this.xg=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.bg}set defaultCommentElectricalCharge(t){this.bg!==t&&(this.bg=t,this.invalidateLayout())}get prelayoutQuality(){return this.Kf}set prelayoutQuality(t){this.Kf!==t&&(this.Kf=t,this.invalidateLayout())}get prelayoutSpread(){return this.Za}set prelayoutSpread(t){this.Za!==t&&(this.Za=t,this.invalidateLayout())}}class wa extends _i{constructor(e){super(e)}createVertex(){return new ba(this)}createEdge(){return new va(this)}}class ba extends Zi{constructor(t){super(t);g(this,"J1");g(this,"$1");g(this,"Z1");g(this,"Q1");g(this,"_1");g(this,"hierarchicalVertexes");g(this,"idInCluster");this.J1=!1,this.$1=NaN,this.Z1=NaN,this.Q1=0,this._1=0,this.hierarchicalVertexes=new Y,this.idInCluster=-1}get isFixed(){return this.J1}set isFixed(t){this.J1!==t&&(this.J1=t)}get charge(){return this.$1}set charge(t){this.$1!==t&&(this.$1=t)}get mass(){return this.Z1}set mass(t){this.Z1!==t&&(this.Z1=t)}get forceX(){return this.Q1}set forceX(t){this.Q1!==t&&(this.Q1=t)}get forceY(){return this._1}set forceY(t){this._1!==t&&(this._1=t)}}class va extends Ds{constructor(t){super(t);g(this,"tk");g(this,"ik");this.tk=NaN,this.ik=NaN}get stiffness(){return this.tk}set stiffness(t){this.tk!==t&&(this.tk=t)}get length(){return this.ik}set length(t){this.ik!==t&&(this.ik=t)}}class Sa{constructor(e){g(this,"I");g(this,"R");g(this,"Q");g(this,"M");g(this,"A");g(this,"seed");e===void 0&&(e=42),this.seed=e,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const e=this.seed/this.Q,t=this.seed%this.Q,i=this.A*t-this.R*e;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var Wo=(S=>(S[S.DepthFirst=0]="DepthFirst",S[S.Greedy=1]="Greedy",S[S.FromLayers=2]="FromLayers",S))(Wo||{}),Jo=(S=>(S[S.OptimalLinkLength=10]="OptimalLinkLength",S[S.LongestPathSink=11]="LongestPathSink",S[S.LongestPathSource=12]="LongestPathSource",S))(Jo||{}),_o=(S=>(S[S.DepthFirstOut=20]="DepthFirstOut",S[S.DepthFirstIn=21]="DepthFirstIn",S[S.Naive=22]="Naive",S))(_o||{}),Zo=(S=>(S[S.None=30]="None",S[S.Less=31]="Less",S[S.More=32]="More",S))(Zo||{}),ka=(S=>(S[S.None=0]="None",S[S.Expand=1]="Expand",S[S.Straighten=2]="Straighten",S[S.Median=4]="Median",S[S.MaybeExpand=8]="MaybeExpand",S[S.All=15]="All",S))(ka||{}),Pa=(S=>(S[S.None=0]="None",S[S.UpperLeft=1]="UpperLeft",S[S.UpperRight=2]="UpperRight",S[S.LowerLeft=4]="LowerLeft",S[S.LowerRight=8]="LowerRight",S[S.All=15]="All",S))(Pa||{});class fe extends De{constructor(t){super();g(this,"Ns");g(this,"Wi");g(this,"b");g(this,"jf");g(this,"Hf");g(this,"qf");g(this,"Qa");g(this,"Wf");g(this,"Qo");g(this,"Jf");g(this,"Nn");g(this,"kt");g(this,"Yy");g(this,"zt");g(this,"kg");g(this,"Cs");g(this,"ci");g(this,"Zs");g(this,"Ls");g(this,"As");g(this,"It");g(this,"Pg");g(this,"_a");g(this,"Sg");g(this,"Qs");g(this,"$f");g(this,"_o");g(this,"Cn");g(this,"Ln");g(this,"ZN");this.Ns=25,this.Wi=25,this.b=0,this.jf=0,this.Hf=10,this.qf=20,this.Qa=4,this.Wf=31,this.Qo=15,this.Jf=10,this.Nn=!0,this.kt=-1,this.Yy=-1,this.zt=-1,this.kg=0,this.Cs=0,this.ci=null,this.Zs=null,this.Ls=null,this.As=null,this.It=null,this.Pg=0,this._a=null,this.Sg=null,this.Qs=0,this.$f=null,this._o=new C,this.Cn=[],this.Cn.length=100,this.Ln=15,this.ZN=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ns=this.Ns,t.Wi=this.Wi,t.b=this.b,t.jf=this.jf,t.Hf=this.Hf,t.qf=this.qf,t.Qa=this.Qa,t.Wf=this.Wf,t.Qo=this.Qo,t.Jf=this.Jf,t.Nn=this.Nn,t.Ln=this.Ln}oi(t){t in Zo?this.aggressiveOption=t:t in Wo?this.cycleRemoveOption=t:t in _o?this.initializeOption=t:t in Jo?this.layeringOption=t:super.oi(t)}createNetwork(){return new Ma(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.aI(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.cI(),this.cycleRemoveOption===2&&this.removeCycles(),this.fI(),this.uI(),this.dI(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,s=t.toVertex.node||t.toVertex.data;return i===null&&s===null?8:i===null||s===null?4:1}nodeMinLayerSpace(t,i){return t.node===null&&t.data===null?0:this.b===90||this.b===270?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(t.node===null&&t.data===null)return 0;const s=i?t.ek:t.sk;if(s!==null)return s;const n=this.b;return n===90||n===270?i?t.ek=t.focus.x/this.Wi+1|0:t.sk=(t.bounds.width-t.focus.x)/this.Wi+1|0:i?t.ek=t.focus.y/this.Wi+1|0:t.sk=(t.bounds.height-t.focus.y)/this.Wi+1|0}Ji(){this._a===null&&(this._a=[]);let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;this._a[t]=s.layer,t++,this._a[t]=s.column,t++,this._a[t]=s.index,t++}return this._a}We(t){let i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.layer=t[i],i++,n.column=t[i],i++,n.index=t[i],i++}}wD(t,i){const s=this.Oh(t),n=this.ci[t];(this.Sg===null||this.Sg.length<n*n)&&(this.Sg=[]);const o=this.Sg;for(let r=0;r<n;r++){let a=0;const h=s[r],l=h.near;let c=0;l!==null&&l!==h&&l.layer===h.layer&&(a+=Math.max(0,Math.abs(l.index-h.index)-1));let d,f=0,m,p=0,y=0,x=0,b,M=0,P,k=0,L=0,T=0,D;if(i>=0){for(d=s[r].fo,f=0;f<d.length;f++)if(m=d[f],m.valid&&m.fromVertex.layer!==t)for(p=m.fromVertex.index,y=m.portToPos,x=m.portFromPos,M=f+1;M<d.length;M++)P=d[M],P.valid&&P.fromVertex.layer!==t&&(k=P.fromVertex.index,L=P.portToPos,T=P.portFromPos,y<L&&(p>k||p===k&&x>T)&&a++,L<y&&(k>p||k===p&&T>x)&&a++)}if(i<=0){for(d=s[r].Wo,f=0;f<d.length;f++)if(m=d[f],m.valid&&m.toVertex.layer!==t)for(p=m.toVertex.index,y=m.portToPos,x=m.portFromPos,M=f+1;M<d.length;M++)P=d[M],P.valid&&P.toVertex.layer!==t&&(k=P.toVertex.index,L=P.portToPos,T=P.portFromPos,x<T&&(p>k||p===k&&y>L)&&a++,T<x&&(k>p||k===p&&L>y)&&a++)}for(o[r*n+r]=a,c=r+1;c<n;c++){let B=0,E=0;if(i>=0){for(b=s[r].fo,D=s[c].fo,f=0;f<b.length;f++)if(m=b[f],m.valid&&m.fromVertex.layer!==t)for(p=m.fromVertex.index,y=m.portToPos,x=m.portFromPos,M=0;M<D.length;M++)P=D[M],P.valid&&P.fromVertex.layer!==t&&(k=P.fromVertex.index,L=P.portToPos,T=P.portFromPos,(p<k||p===k&&x<T)&&E++,(k<p||k===p&&T<x)&&B++)}if(i<=0){for(b=s[r].Wo,D=s[c].Wo,f=0;f<b.length;f++)if(m=b[f],m.valid&&m.toVertex.layer!==t)for(p=m.toVertex.index,y=m.portToPos,x=m.portFromPos,M=0;M<D.length;M++)P=D[M],P.valid&&P.toVertex.layer!==t&&(k=P.toVertex.index,L=P.portToPos,T=P.portFromPos,(p<k||p===k&&y<L)&&E++,(k<p||k===p&&L<y)&&B++)}o[r*n+c]=B,o[c*n+r]=E}}return this.Ih(t,s),o}countCrossings(){let t=0;for(let i=0;i<=this.kt;i++){const s=this.wD(i,1),n=this.ci[i];for(let o=0;o<n;o++)for(let r=o;r<n;r++)t+=s[o*n+r]}return t}gI(t,i,s){const n=this.Oh(t),o=this.ci[t];let r=0;for(let a=0;a<o;a++){let h=null;i<=0&&(h=n[a].fo);let l=null;i>=0&&(l=n[a].Wo);let c,d=0,f=0;if(h!==null)for(let m=0;m<h.length;m++)c=h[m],c.valid&&c.fromVertex.layer!==t&&(d=c.fromVertex.column+c.portFromColOffset,f=c.toVertex.column+c.portToColOffset,s?r+=Math.abs(d-f)*this.linkStraightenWeight(c):r+=Math.abs(d-f));if(l!==null)for(let m=0;m<l.length;m++)c=l[m],c.valid&&c.toVertex.layer!==t&&(d=c.fromVertex.column+c.portFromColOffset,f=c.toVertex.column+c.portToColOffset,s?r+=(Math.abs(d-f)+1)*this.linkStraightenWeight(c):r+=Math.abs(d-f))}return this.Ih(t,n),r}nk(t){let i=0;for(let s=0;s<=this.kt;s++)i+=this.gI(s,1,t);return i}Gy(){let t=1/0;this.zt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=Math.min(t,s.column-this.nodeMinColumnSpace(s,!0)),this.zt=Math.max(this.zt,s.column+this.nodeMinColumnSpace(s,!1))}for(i.reset();i.next();){const s=i.value;s.column-=t}this.zt-=t}Ky(t,i){const s=this.Oh(t),n=this.ci[t],o=[];for(let r=0;r<n;r++){const a=s[r];let h=null;i<=0&&(h=a.fo);let l=null;i>=0&&(l=a.Wo);let c=0,d=0;const f=a.near;f!==null&&f.layer===a.layer&&(c+=f.column-1,d++);let m;if(h!==null)for(let p=0;p<h.length;p++){m=h[p];const y=m.fromVertex;m.valid&&!m.rev&&y.layer!==t&&(c+=y.column,d++)}if(l!==null)for(let p=0;p<l.length;p++){m=l[p];const y=m.toVertex;m.valid&&!m.rev&&y.layer!==t&&(c+=y.column,d++)}d===0?o[r]=-1:o[r]=c/d}return this.Ih(t,s),o}xD(t,i){const s=this.Oh(t),n=this.ci[t],o=[];for(let r=0;r<n;r++){const a=s[r];let h=null;i<=0&&(h=a.fo);let l=null;i>=0&&(l=a.Wo);let c=0;const d=[],f=a.near;f!==null&&f.layer===a.layer&&(d[c]=f.column-1,c++);let m;if(h!==null)for(let p=0;p<h.length;p++){m=h[p];const y=m.fromVertex;m.valid&&!m.rev&&y.layer!==t&&(d[c]=y.column+m.portFromColOffset,c++)}if(l!==null)for(let p=0;p<l.length;p++){m=l[p];const y=m.toVertex;m.valid&&!m.rev&&y.layer!==t&&(d[c]=y.column+m.portToColOffset,c++)}if(c===0)o[r]=-1;else{d.sort((y,x)=>y-x);const p=c>>1;c&1?o[r]=d[p]:o[r]=d[p-1]+d[p]>>1}}return this.Ih(t,s),o}jy(t,i,s,n,o){if(t.component===s){t.component=i;let r=0,a=0;if(n){const h=t.destinationEdges;for(;h.next();){const l=h.value,c=l.toVertex;r=t.layer-c.layer,a=this.linkMinLength(l),r===a&&this.jy(c,i,s,n,o)}}if(o){const h=t.sourceEdges;for(;h.next();){const l=h.value,c=l.fromVertex;r=c.layer-t.layer,a=this.linkMinLength(l),r===a&&this.jy(c,i,s,n,o)}}}}QN(t,i,s,n,o){if(t.component===s){if(t.component=i,n){const r=t.destinationEdges;for(;r.next();){const a=r.value.toVertex;this.QN(a,i,s,n,o)}}if(o){const r=t.sourceEdges;for(;r.next();){const a=r.value.fromVertex;this.QN(a,i,s,n,o)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const i=t.value;i.rev=!1}switch(this.jf){default:case 1:this.mI();break;case 0:this.pI();break;case 2:this.yI();break}}yI(){const t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();){const n=i.value;s=Math.min(s,n.layer)}if(s<1/0){if(s<0)for(i.reset();i.next();){const a=i.value;a.layer-=s}const n=[];for(i.reset();i.next();){const a=i.value,h=n[a.layer];h===void 0?n[a.layer]=[a]:h.push(a)}let o=0;for(let a=0;a<n.length;a++){const h=n[a];if(!h||h.length===0)o++;else if(a>0)for(let l=0;l<h.length;l++){const c=h[l];c.layer-=o}}const r=t.edges.iterator;for(;r.next();){const a=r.value,h=a.fromVertex,l=a.toVertex;h.layer<l.layer&&(t.reverseEdge(a),a.rev=!0)}}}mI(){const t=this.network;let i=0,s=t.vertexes.count-1;const n=[];n.length=s+1;const o=t.vertexes.iterator;for(;o.next();){const a=o.value;a.$i=!0}for(;this.wI(t)!==null;){let a;for(a=this.bD(t);a!==null;)n[s]=a,s--,a.$i=!1,a=this.bD(t);for(a=this.kD(t);a!==null;)n[i]=a,i++,a.$i=!1,a=this.kD(t);a=this.xI(t),a!==null&&(n[i]=a,i++,a.$i=!1)}for(let a=0;a<t.vertexes.count;a++)n[a].index=a;const r=t.edges.iterator;for(;r.next();){const a=r.value,h=a.fromVertex,l=a.toVertex;h.index>l.index&&(t.reverseEdge(a),a.rev=!0)}}wI(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i)return s}return null}bD(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i){let n=!0;const o=s.destinationEdges;for(;o.next();)if(o.value.toVertex.$i){n=!1;break}if(n)return s}}return null}kD(t){const i=t.vertexes.iterator;for(;i.next();){const s=i.value;if(s.$i){let n=!0;const o=s.sourceEdges;for(;o.next();)if(o.value.fromVertex.$i){n=!1;break}if(n)return s}}return null}xI(t){let i=null,s=0;const n=this.network.vertexes.iterator;for(;n.next();){const o=n.value;if(o.$i){let r=0;const a=o.destinationEdges;for(;a.next();)a.value.toVertex.$i&&r++;let h=0;const l=o.sourceEdges;for(;l.next();)l.value.fromVertex.$i&&h++;(i===null||s<r-h)&&(i=o,s=r-h)}}return i}pI(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.Zf=-1,s.Xn=-1}const i=this.network.edges.iterator;for(;i.next();){const s=i.value;s.forest=!1}for(this.Pg=0,t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this._N(s)}for(t.reset();t.next();){const s=t.value;s.Zf===-1&&this._N(s)}for(i.reset();i.next();){const s=i.value;if(!s.forest){const n=s.fromVertex,o=n.Zf,r=n.Xn,a=s.toVertex,h=a.Zf,l=a.Xn;h<o&&r<l&&(this.network.reverseEdge(s),s.rev=!0)}}}_N(t){t.Zf=this.Pg,this.Pg++;const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex;n.Zf===-1&&(s.forest=!0,this._N(n))}t.Xn=this.Pg,this.Pg++}cI(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.layer=-1}for(this.kt=-1,this.assignLayers(),t.reset();t.next();){const i=t.value;this.kt=Math.max(this.kt,i.layer)}}assignLayers(){switch(this.Hf){case 11:this.PD();break;case 12:this.bI();break;default:case 10:this.kI();break}}PD(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value,s=this.SD(i);this.kt=Math.max(s,this.kt)}}SD(t){let i=0;if(t.layer===-1){const s=t.destinationEdges;for(;s.next();){const n=s.value,o=n.toVertex,r=this.linkMinLength(n);i=Math.max(i,this.SD(o)+r)}t.layer=i}else i=t.layer;return i}bI(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;t=this.MD(s),this.kt=Math.max(t,this.kt)}for(i.reset();i.next();){const s=i.value;s.layer=this.kt-s.layer}}MD(t){let i=0;if(t.layer===-1){const s=t.sourceEdges;for(;s.next();){const n=s.value,o=n.fromVertex,r=this.linkMinLength(n);i=Math.max(i,this.MD(o)+r)}t.layer=i}else i=t.layer;return i}kI(){this.PD();const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.$i=!1}for(t.reset();t.next();){const s=t.value;s.sourceEdges.count===0&&this.ND(s)}let i=1/0;for(t.reset();t.next();){const s=t.value;i=Math.min(i,s.layer)}for(this.kt=-1,t.reset();t.next();){const s=t.value;s.layer-=i,this.kt=Math.max(this.kt,s.layer)}}ND(t){if(!t.$i){t.$i=!0;const i=t.destinationEdges;for(;i.next();){const s=i.value.toVertex;this.ND(s)}this.SI(t),this.MI(t)}}SI(t){const i=this.network.vertexes.iterator;for(;i.next();){const a=i.value;a.component=-1}const s=0,n=1,o=t.fo;let r=o.length;for(let a=0;a<r;a++){const h=o[a],l=h.fromVertex,c=h.toVertex,d=this.linkMinLength(h);l.layer-c.layer>d&&this.jy(l,s,-1,!0,!1)}for(this.jy(t,n,-1,!0,!0);t.component!==s;){let a=0,h=1/0,l=0,c=null;const d=this.network.vertexes.iterator;for(;d.next();){const f=d.value;if(f.component===n){let m=0,p=!1;const y=f.fo;r=y.length;for(let b=0;b<r;b++){const M=y[b],P=M.fromVertex;if(m+=this.linkLengthWeight(M),P.component!==n){a+=this.linkLengthWeight(M);const k=P.layer-f.layer,L=this.linkMinLength(M);h=Math.min(h,k-L)}}const x=f.Wo;r=x.length;for(let b=0;b<r;b++){const M=x[b],P=M.toVertex;m-=this.linkLengthWeight(M),P.component!==n?a-=this.linkLengthWeight(M):p=!0}(c===null||m<l)&&!p&&(c=f,l=m)}}if(a>0){for(i.reset();i.next();){const f=i.value;f.component===n&&(f.layer+=h)}t.component=s}else c.component=s}}MI(t){const i=this.network.vertexes.iterator;for(;i.next();){const o=i.value;o.component=-1}const s=0,n=1;for(this.jy(t,n,-1,!0,!1);t.component!==s;){let o=0,r=1/0,a=0,h=null;const l=this.network.vertexes.iterator;for(;l.next();){const c=l.value;if(c.component===n){let d=0,f=!1;const m=c.fo;let p=m.length;for(let x=0;x<p;x++){const b=m[x],M=b.fromVertex;d+=this.linkLengthWeight(b),M.component!==n?o+=this.linkLengthWeight(b):f=!0}const y=c.Wo;p=y.length;for(let x=0;x<p;x++){const b=y[x],M=b.toVertex;if(d-=this.linkLengthWeight(b),M.component!==n){o-=this.linkLengthWeight(b);const P=c.layer-M.layer,k=this.linkMinLength(b);r=Math.min(r,P-k)}}(h===null||d>a)&&!f&&(h=c,a=d)}}if(o<0){for(i.reset();i.next();){const c=i.value;c.component===n&&(c.layer-=r)}t.component=s}else h.component=s}}fI(){const t=this.network,i=[],s=t.edges.iterator;for(;s.next();){const n=s.value;n.valid=!1,i.push(n)}for(let n=0;n<i.length;n++){const o=i[n];let r=o.fromVertex;const a=o.toVertex;if(o.valid||(r.node===null&&r.data===null||a.node===null&&a.data===null)&&r.layer===a.layer)continue;let h=0,l=0,c=0,d=0;if(o.link!==null){const T=o.link;if(T===null)continue;const D=r.node,B=a.node;if(D===null||B===null)continue;let E=T.fromNode,R=T.toNode,F=T.fromPort;for(;F!==null&&!F.isVisibleObject();)F=F.panel;let V=T.toPort;for(;V!==null&&!V.isVisibleObject();)V=V.panel;if(o.rev){const ot=E,Ct=F;E=R,F=V,R=ot,V=Ct}const K=r.focus,H=a.focus,W=o.rev?a.bounds:r.bounds,J=C.l();D!==E?W.isReal()&&E.isVisible()?E.actualBounds.isReal()?(E.getRelativePoint(F,U.Center,J),J.x+=E.actualBounds.x-W.x,J.y+=E.actualBounds.y-W.y):(E.getRelativePoint(F,U.Center,J),J.isReal()||J.a(K)):J.a(K):W.isReal()?(E.getRelativePoint(F,U.Center,J),J.isReal()||J.a(K)):J.a(K);const $=o.rev?r.bounds:a.bounds,et=C.l();B!==R?$.isReal()&&R.isVisible()?R.actualBounds.isReal()?(R.getRelativePoint(V,U.Center,et),et.x+=R.actualBounds.x-$.x,et.y+=R.actualBounds.y-$.y):(R.getRelativePoint(V,U.Center,et),et.isReal()||et.a(H)):et.a(H):$.isReal()?(R.getRelativePoint(V,U.Center,et),et.isReal()||et.a(H)):et.a(H),this.b===90||this.b===270?(h=Math.round((J.x-K.x)/this.Wi),c=J.x,l=Math.round((et.x-H.x)/this.Wi),d=et.x):(h=Math.round((J.y-K.y)/this.Wi),c=J.y,l=Math.round((et.y-H.y)/this.Wi),d=et.y),C.e(J),C.e(et),o.portFromColOffset=h,o.portFromPos=c,o.portToColOffset=l,o.portToPos=d}else o.portFromColOffset=0,o.portFromPos=0,o.portToColOffset=0,o.portToPos=0;let f=r.layer;const m=a.layer,p=this.NI(o),y=p===1||p===3,x=p===2||p===3;let b,M,P=null,k;x&&(P=this.CI(r,a),k=1,M=t.createVertex(),M.node=null,M.ok=1,M.layer=f,M.near=r,t.addVertex(M),b=t.linkVertexes(r,M,o.link),b.valid=!1,b.rev=o.rev,b.portFromColOffset=h,b.portToColOffset=0,b.portFromPos=c,b.portToPos=0,r=M);let L=1;if(y&&L--,f-m>L&&f>0){for(o.valid=!1,M=t.createVertex(),M.node=null,M.ok=2,M.layer=f-1,P&&k<P.length&&M.layer===P[k].layer&&(M.near=P[k++]),t.addVertex(M),b=t.linkVertexes(r,M,o.link),b.valid=!0,b.rev=o.rev,b.portFromColOffset=x?0:h,b.portToColOffset=0,b.portFromPos=x?0:c,b.portToPos=0,r=M,f--;f-m>L&&f>0;)M=t.createVertex(),M.node=null,M.ok=3,M.layer=f-1,P&&k<P.length&&M.layer===P[k].layer&&(M.near=P[k++]),t.addVertex(M),b=t.linkVertexes(r,M,o.link),b.valid=!0,b.rev=o.rev,b.portFromColOffset=0,b.portToColOffset=0,b.portFromPos=0,b.portToPos=0,r=M,f--;b=t.linkVertexes(M,a,o.link),b.valid=!y,y&&(M.near=a),b.rev=o.rev,b.portFromColOffset=0,b.portToColOffset=l,b.portFromPos=0,b.portToPos=d}else o.valid=!0}}NI(t){let i=0;const s=t.link;if(s!==null){const n=s.fromPort,o=s.toPort;if(n!==null&&o!==null){const r=s.fromNode,a=s.toNode;if(r!==null&&a!==null){const h=this.rk(!0),l=this.rk(!1),c=this.setsPortSpots?h:s.computeSpot(!0,n),d=this.setsPortSpots?l:s.computeSpot(!1,o),f=s.isOrthogonal;if(c.isSide()&&c.includesSide(l)&&d.isSide()&&d.includesSide(h))return 0;const m=s.getLinkPoint(r,n,c,!0,f,a,o,C.l()),p=s.getLinkDirection(r,n,m,c,!0,f,a,o);C.e(m),(!c.isNone()&&p===this.CD(t,!0)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(i+=1);const y=s.getLinkPoint(a,o,d,!1,f,r,n,C.l()),x=s.getLinkDirection(a,o,y,d,!1,f,r,n);C.e(y),(!d.isNone()&&x===this.CD(t,!1)||this.setsPortSpots&&a!==null&&a.ports.count===1&&t.rev)&&(i+=2)}}}return i}CD(t,i){return this.b===90?i&&!t.rev||!i&&t.rev?270:90:this.b===180?i&&!t.rev||!i&&t.rev?0:180:this.b===270?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}CI(t,i){const s=[];return s.push(i),this.LD(t,s)?s.reverse():[]}LD(t,i){const s=i[i.length-1].sourceEdges.iterator;for(;s.next();){const n=s.value;if(n.rev||!n.valid)continue;const o=n.fromVertex;if(i.push(o),o===t||this.LD(t,i))return!0;i.pop()}return!1}uI(){const t=this.ci=[];for(let s=0;s<=this.kt;s++)t[s]=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.index=-1}this.initializeIndices(),this.Yy=-1,this.kg=0,this.Cs=0;for(let s=0;s<=this.kt;s++)t[s]>t[this.Cs]&&(this.Yy=t[s]-1,this.Cs=s),t[s]<t[this.kg]&&(this.kg=s);this.$f=[];for(let s=0;s<t.length;s++)this.$f[s]=[];for(i.reset();i.next();){const s=i.value,n=s.layer,o=this.$f[n];o[s.index]=s}}initializeIndices(){switch(this.qf){default:case 22:this.LI();break;case 20:this.AI();break;case 21:this.TI();break}}LI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(i.reset();i.next();){const s=i.value;if(s.near)continue;const n=s.layer;if(s.index=this.ci[n],this.ci[n]++,!t)continue;const o=t.get(s);Array.isArray(o)&&o.forEach(r=>{r.index=this.ci[n],this.ci[n]++})}}AI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=this.kt;s>=0;s--)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.AD(n,t)}}AD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ci[s],this.ci[s]++,i){const r=i.get(t);Array.isArray(r)&&r.forEach(a=>{a.index=this.ci[s],this.ci[s]++})}const n=t.Wo;let o=!0;for(;o;){o=!1;for(let r=0;r<n.length-1;r++){const a=n[r],h=n[r+1];a.portFromColOffset>h.portFromColOffset&&(o=!0,n[r]=h,n[r+1]=a)}}for(let r=0;r<n.length;r++){const a=n[r];if(a.valid){const h=a.toVertex;h.index===-1&&this.AD(h,i)}}}TI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;if(s.near&&(t===null&&(t=new Map),s.layer===s.near.layer)){const n=t.get(s.near)||[];n.push(s),t.set(s.near,n)}}for(let s=0;s<=this.kt;s++)for(i.reset();i.next();){const n=i.value;n.layer===s&&n.index===-1&&this.TD(n,t)}}TD(t,i){if(t.near)return;const s=t.layer;if(t.index=this.ci[s],this.ci[s]++,i){const l=i.get(t);Array.isArray(l)&&l.forEach(c=>{c.index=this.ci[s],this.ci[s]++})}const n=t.fo;let o=!0,r=0;for(;o;)for(o=!1,r=0;r<n.length-1;r++){const l=n[r],c=n[r+1];l.portToColOffset>c.portToColOffset&&(o=!0,n[r]=c,n[r+1]=l)}let a,h;for(r=0;r<n.length;r++)h=n[r],h.valid&&(a=h.fromVertex,a.index===-1&&this.TD(a,i))}dI(){this.zt=-1;for(let t=0;t<=this.kt;t++){const i=this.Oh(t);let s=0;const n=this.ci[t];for(let o=0;o<n;o++){const r=i[o];s+=this.nodeMinColumnSpace(r,!0),r.column=s,s+=1,s+=this.nodeMinColumnSpace(r,!1)}this.zt=Math.max(this.zt,s-1),this.Ih(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.Ji(),s=0,n=0,o=0;for(s=0;s<this.Qa;s++){for(n=0;n<=this.kt;n++)this.lk(n,1),this.rs(n,1,!1,1);for(o=this.countCrossings(),o<t&&(t=o,i=this.Ji()),n=this.kt;n>=0;n--)this.lk(n,-1),this.rs(n,-1,!1,-1);o=this.countCrossings(),o<t&&(t=o,i=this.Ji())}for(this.We(i),s=0;s<this.Qa;s++){for(n=0;n<=this.kt;n++)this.lk(n,0),this.rs(n,0,!1,0);for(o=this.countCrossings(),o<t&&(t=o,i=this.Ji()),n=this.kt;n>=0;n--)this.lk(n,0),this.rs(n,0,!1,0);o=this.countCrossings(),o<t&&(t=o,i=this.Ji())}this.We(i);let r=!1,a=0,h=0,l=0,c=0;switch(this.Wf){case 30:break;case 32:for(l=t+1;(c=this.countCrossings())<l;)for(l=c,a=this.kt;a>=0;a--)for(h=0;h<=a;h++){for(r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,1,!1,1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,-1,!1,-1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,0,!1,0)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,0,!1,0)||r;o>=t?this.We(i):(t=o,i=this.Ji())}break;default:case 31:for(a=this.kt,h=0,l=t+1;(c=this.countCrossings())<l;){for(l=c,r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,-1,!1,-1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,1,!1,1)||r;for(o=this.countCrossings(),o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,1,!1,1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,-1,!1,-1)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=a;n>=h;n--)r=this.rs(n,0,!1,0)||r;for(o>=t?this.We(i):(t=o,i=this.Ji()),r=!0;r;)for(r=!1,n=h;n<=a;n++)r=this.rs(n,0,!1,0)||r;o>=t?this.We(i):(t=o,i=this.Ji())}break}this.We(i)}lk(t,i){let s=0,n=!1;const o=this.Oh(t),r=this.ci[t],a=this.xD(t,i),h=this.Ky(t,i);for(s=0;s<r;s++)h[s]===-1&&(h[s]=o[s].column),a[s]===-1&&(a[s]=o[s].column);let l=!0,c;for(;l;)for(l=!1,s=0;s<r-1;s++)if(a[s+1]<a[s]||a[s+1]===a[s]&&h[s+1]<h[s]){n=!0,l=!0;const f=a[s];a[s]=a[s+1],a[s+1]=f;const m=h[s];h[s]=h[s+1],h[s+1]=m,c=o[s],o[s]=o[s+1],o[s+1]=c}let d=0;for(s=0;s<r;s++)c=o[s],c.index=s,d+=this.nodeMinColumnSpace(c,!0),c.column=d,d+=1,d+=this.nodeMinColumnSpace(c,!1);return this.Ih(t,o),n}rs(t,i,s,n){const o=this.Oh(t),r=this.ci[t],a=this.wD(t,i);let h=0,l;if(!s||n>0)for(l=[],h=0;h<r;h++)l[h]=-1;else l=this.Ky(t,-1);let c;if(!s||n<0)for(c=[],h=0;h<r;h++)c[h]=-1;else c=this.Ky(t,1);let d=!1,f=!0;for(;f;)for(f=!1,h=0;h<r-1;h++){const m=a[o[h].index*r+o[h+1].index],p=a[o[h+1].index*r+o[h].index];let y=0,x=0;const b=o[h].column,M=o[h+1].column,P=this.nodeMinColumnSpace(o[h],!0),k=this.nodeMinColumnSpace(o[h],!1),L=this.nodeMinColumnSpace(o[h+1],!0),T=this.nodeMinColumnSpace(o[h+1],!1),D=b-P+L,B=M-k+T;let E=0,R=0,F=0,V=0,K=0,H=0,W=0,J,$=0,et,ot=0;const Ct=o[h].sourceEdges.iterator;if(s&&n<=0)for(;Ct.next();){const It=Ct.value;J=It.fromVertex,It.valid&&J.layer!==t&&(F=this.linkStraightenWeight(It),V=It.portFromColOffset,K=It.portToColOffset,H=J.column,E+=(Math.abs(b+K-(H+V))+1)*F,R+=(Math.abs(B+K-(H+V))+1)*F)}for(Ct.reset();Ct.next();){const It=Ct.value;if(J=It.fromVertex,It.valid&&J.layer===t){for($=0;$<o.length&&o[$]!==J;)$++;$<h&&(y+=2*(h-$),x+=2*(h+1-$)),$===h+1&&(y+=1),$>h+1&&(y+=4*($-h),x+=4*($-(h+1)))}}const ht=o[h].destinationEdges.iterator;if(s&&n>=0)for(;ht.next();){const It=ht.value;et=It.toVertex,It.valid&&et.layer!==t&&(F=this.linkStraightenWeight(It),V=It.portFromColOffset,K=It.portToColOffset,W=et.column,E+=(Math.abs(b+V-(W+K))+1)*F,R+=(Math.abs(B+V-(W+K))+1)*F)}for(ht.reset();ht.next();){const It=ht.value;if(et=It.toVertex,It.valid&&et.layer===t){for(ot=0;ot<o.length&&o[ot]!==et;)ot++;ot===h+1&&(x+=1)}}const dt=o[h+1].sourceEdges.iterator;if(s&&n<=0)for(;dt.next();){const It=dt.value;J=It.fromVertex,It.valid&&J.layer!==t&&(F=this.linkStraightenWeight(It),V=It.portFromColOffset,K=It.portToColOffset,H=J.column,E+=(Math.abs(M+K-(H+V))+1)*F,R+=(Math.abs(D+K-(H+V))+1)*F)}for(dt.reset();dt.next();){const It=dt.value;if(J=It.fromVertex,It.valid&&J.layer===t){for($=0;$<o.length&&o[$]!==J;)$++;$<h&&(y+=2*(h+1-$),x+=2*(h-$)),$===h&&(x+=1),$>h+1&&(y+=4*($-(h+1)),x+=4*($-h))}}const ct=o[h+1].destinationEdges.iterator;if(s&&n>=0)for(;ct.next();){const It=ct.value;et=It.toVertex,It.valid&&et.layer!==t&&(F=this.linkStraightenWeight(It),V=It.portFromColOffset,K=It.portToColOffset,W=et.column,E+=(Math.abs(M+V-(W+K))+1)*F,R+=(Math.abs(D+V-(W+K))+1)*F)}for(ct.reset();ct.next();){const It=ct.value;if(et=It.toVertex,It.valid&&et.layer===t){for(ot=0;ot<o.length&&o[ot]!==et;)ot++;ot===h&&(y+=1)}}let ft=0,Ot=0;const Et=l[o[h].index],lt=c[o[h].index],vt=l[o[h+1].index],Qt=c[o[h+1].index];if(Et!==-1&&(ft+=Math.abs(Et-b),Ot+=Math.abs(Et-B)),lt!==-1&&(ft+=Math.abs(lt-b),Ot+=Math.abs(lt-B)),vt!==-1&&(ft+=Math.abs(vt-M),Ot+=Math.abs(vt-D)),Qt!==-1&&(ft+=Math.abs(Qt-M),Ot+=Math.abs(Qt-D)),x<y-.5||x===y&&p<m-.5||x===y&&p===m&&R<E-.5||x===y&&p===m&&R===E&&Ot<ft-.5){d=!0,f=!0,o[h].column=B,o[h+1].column=D;const It=o[h];o[h]=o[h+1],o[h+1]=It}}for(h=0;h<r;h++)o[h].index=h;return this.Ih(t,o),d}straightenAndPack(){if(this.Ln!==0){this.DI();return}let t=0,i=!1,s=(this.Qo&1)!==0;const n=(this.Qo&8)!==0;if(this.network.edges.count>1e3&&n&&(s=!1),s){const o=[];let r=0;for(r=0;r<=this.kt;r++)o[r]=0;let a=0;const h=this.network.vertexes.iterator;for(;h.next();){const c=h.value;t=c.layer,a=c.column;const d=this.nodeMinColumnSpace(c,!1);o[t]=Math.max(o[t],a+d)}const l=8;for(h.reset();h.next();){const c=h.value;t=c.layer,a=c.column,c.column=((this.zt-o[t])*l>>1)+a*l}this.zt*=l}if(this.Qo&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,t=this.Cs+1;t<=this.kt;t++)i=this.Mg(t,1)||i;for(t=this.Cs-1;t>=0;t--)i=this.Mg(t,-1)||i;i=this.Mg(this.Cs,0)||i,o++}}if(this.Qo&4){for(t=this.Cs+1;t<=this.kt;t++)this.tC(t,1);for(t=this.Cs-1;t>=0;t--)this.tC(t,-1);this.tC(this.Cs,0)}if(s&&(this.DD(-1),this.DD(1)),this.Qo&2){i=!0;let o=0;for(;i&&o<this.Jf;){for(i=!1,i=this.Mg(this.Cs,0)||i,t=this.Cs+1;t<=this.kt;t++)i=this.Mg(t,0)||i;for(t=this.Cs-1;t>=0;t--)i=this.Mg(t,0)||i;o++}}}Mg(t,i){let s=!1;for(;this.FI(t,i);)s=!0;return s}FI(t,i){let s=0;const n=this.Oh(t),o=this.ci[t],r=this.Ky(t,-1);if(i>0)for(s=0;s<o;s++)r[s]=-1;const a=this.Ky(t,1);if(i<0)for(s=0;s<o;s++)a[s]=-1;let h=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const c=n[s].column,d=this.nodeMinColumnSpace(n[s],!0),f=this.nodeMinColumnSpace(n[s],!1);let m=0;s-1<0||c-n[s-1].column-1>d+this.nodeMinColumnSpace(n[s-1],!1)?m=c-1:m=c;let p=0;s+1>=o||n[s+1].column-c-1>f+this.nodeMinColumnSpace(n[s+1],!0)?p=c+1:p=c;let y=0,x=0,b=0,M=0,P=0,k=0;if(i<=0){const R=n[s].sourceEdges.iterator;for(;R.next();){const F=R.value,V=F.fromVertex;if(F.valid&&V.layer!==t){M=this.linkStraightenWeight(F),P=F.portFromColOffset,k=F.portToColOffset;const K=V.column;y+=(Math.abs(c+k-(K+P))+1)*M,x+=(Math.abs(m+k-(K+P))+1)*M,b+=(Math.abs(p+k-(K+P))+1)*M}}}if(i>=0){const R=n[s].destinationEdges.iterator;for(;R.next();){const F=R.value,V=F.toVertex;if(F.valid&&V.layer!==t){M=this.linkStraightenWeight(F),P=F.portFromColOffset,k=F.portToColOffset;const K=V.column;y+=(Math.abs(c+P-(K+k))+1)*M,x+=(Math.abs(m+P-(K+k))+1)*M,b+=(Math.abs(p+P-(K+k))+1)*M}}}let L=0,T=0,D=0;const B=r[n[s].index],E=a[n[s].index];B!==-1&&(L+=Math.abs(B-c),T+=Math.abs(B-m),D+=Math.abs(B-p)),E!==-1&&(L+=Math.abs(E-c),T+=Math.abs(E-m),D+=Math.abs(E-p)),x<y||x===y&&T<L?(h=!0,l=!0,n[s].column=m):(b<y||b===y&&D<L)&&(h=!0,l=!0,n[s].column=p)}return this.Ih(t,n),this.Gy(),h}tC(t,i){let s=0;const n=this.Oh(t),o=this.ci[t],r=this.xD(t,i),a=[];for(s=0;s<o;s++)a[s]=r[s];let h=!1,l=!0;for(;l;)for(l=!1,s=0;s<o;s++){const c=n[s].column,d=this.nodeMinColumnSpace(n[s],!0),f=this.nodeMinColumnSpace(n[s],!1);let m=0,p=0,y=0,x=0,b=0;a[s]===-1?s===0&&s===o-1?m=c:s===0?(p=n[s+1].column,p-c===f+this.nodeMinColumnSpace(n[s+1],!0)?m=c-1:m=c):s===o-1?(y=n[s-1].column,c-y===d+this.nodeMinColumnSpace(n[s-1],!1)?m=c+1:m=c):(y=n[s-1].column,b=y+this.nodeMinColumnSpace(n[s-1],!1)+d+1,p=n[s+1].column,x=p-this.nodeMinColumnSpace(n[s+1],!0)-f-1,m=(b+x)/2|0):s===0&&s===o-1?m=a[s]:s===0?(p=n[s+1].column,x=p-this.nodeMinColumnSpace(n[s+1],!0)-f-1,m=Math.min(a[s],x)):s===o-1?(y=n[s-1].column,b=y+this.nodeMinColumnSpace(n[s-1],!1)+d+1,m=Math.max(a[s],b)):(y=n[s-1].column,b=y+this.nodeMinColumnSpace(n[s-1],!1)+d+1,p=n[s+1].column,x=p-this.nodeMinColumnSpace(n[s+1],!0)-f-1,b<a[s]&&a[s]<x?m=a[s]:b>=a[s]?m=b:x<=a[s]&&(m=x)),m!==c&&(h=!0,l=!0,n[s].column=m)}return this.Ih(t,n),this.Gy(),h}RI(){for(let t=0;t<=this.zt;t++)for(;this.vI(t,1););this.Gy()}vI(t,i){let s=!0;const n=this.network.vertexes.iterator;for(;n.next();){const r=n.value,a=this.nodeMinColumnSpace(r,!0),h=this.nodeMinColumnSpace(r,!1);if(r.column-a<=t&&r.column+h>=t){s=!1;break}}let o=!1;if(s){if(i>0)for(n.reset();n.next();){const r=n.value;r.column>t&&(r.column-=1,o=!0)}if(i<0)for(n.reset();n.next();){const r=n.value;r.column<t&&(r.column+=1,o=!0)}}return o}OI(){this.RI();for(let t=0;t<this.zt;t++)for(;this.II(t,1););this.Gy()}II(t,i){let s=t;i>0&&(s=t+1),i<0&&(s=t-1);let n=0;const o=[],r=[];for(n=0;n<=this.kt;n++)o[n]=!1,r[n]=!1;const a=this.network.vertexes.iterator;for(;a.next();){const c=a.value,d=c.column-this.nodeMinColumnSpace(c,!0),f=c.column+this.nodeMinColumnSpace(c,!1);d<=t&&f>=t&&(o[c.layer]=!0),d<=s&&f>=s&&(r[c.layer]=!0)}let h=!0,l=!1;for(n=0;n<=this.kt;n++)h=h&&!(o[n]&&r[n]);if(h){if(i>0)for(a.reset();a.next();){const c=a.value;c.column>t&&(c.column-=1,l=!0)}if(i<0)for(a.reset();a.next();){const c=a.value;c.column<t&&(c.column+=1,l=!0)}}return l}DD(t){this.OI();let i=0,s,n=0,o=0,r=0;if(t>0)for(i=0;i<=this.zt;i++)for(s=this.Ji(),n=this.nk(!0),o=n+1;n<o;)o=n,this.FD(i,1),r=this.nk(!0),r>n?this.We(s):r<n&&(n=r,s=this.Ji());if(t<0)for(i=this.zt;i>=0;i--)for(s=this.Ji(),n=this.nk(!0),o=n+1;n<o;)o=n,this.FD(i,-1),r=this.nk(!0),r>n?this.We(s):r<n&&(n=r,s=this.Ji());this.Gy()}FD(t,i){this.Qs=0;const s=this.network.vertexes.iterator;for(;s.next();){const d=s.value;d.component=-1}if(i>0)for(s.reset();s.next();){const d=s.value;d.column-this.nodeMinColumnSpace(d,!0)<=t&&(d.component=this.Qs)}if(i<0)for(s.reset();s.next();){const d=s.value;d.column+this.nodeMinColumnSpace(d,!1)>=t&&(d.component=this.Qs)}for(this.Qs++,s.reset();s.next();){const d=s.value;d.component===-1&&(this.QN(d,this.Qs,-1,!0,!0),this.Qs++)}let n=0;const o=[];for(n=0;n<this.Qs*this.Qs;n++)o[n]=!1;const r=[];for(n=0;n<(this.kt+1)*(this.zt+1);n++)r[n]=-1;for(s.reset();s.next();){const d=s.value,f=d.layer,m=Math.max(0,d.column-this.nodeMinColumnSpace(d,!0)),p=Math.min(this.zt,d.column+this.nodeMinColumnSpace(d,!1));for(let y=m;y<=p;y++)r[f*(this.zt+1)+y]=d.component}for(let d=0;d<=this.kt;d++){if(i>0)for(let f=0;f<this.zt;f++)r[d*(this.zt+1)+f]!==-1&&r[d*(this.zt+1)+f+1]!==-1&&r[d*(this.zt+1)+f]!==r[d*(this.zt+1)+f+1]&&(o[r[d*(this.zt+1)+f]*this.Qs+r[d*(this.zt+1)+f+1]]=!0);if(i<0)for(let f=this.zt;f>0;f--)r[d*(this.zt+1)+f]!==-1&&r[d*(this.zt+1)+f-1]!==-1&&r[d*(this.zt+1)+f]!==r[d*(this.zt+1)+f-1]&&(o[r[d*(this.zt+1)+f]*this.Qs+r[d*(this.zt+1)+f-1]]=!0)}const a=[];for(n=0;n<this.Qs;n++)a[n]=!0;const h=[];h.push(0);let l=0;for(;h.length!==0;)if(l=h[h.length-1],h.pop(),a[l])for(a[l]=!1,n=0;n<this.Qs;n++)o[l*this.Qs+n]&&h.splice(0,0,n);let c=!1;if(i>0)for(s.reset();s.next();){const d=s.value;a[d.component]&&(d.column-=1,c=!0)}if(i<0)for(s.reset();s.next();){const d=s.value;a[d.component]&&(d.column+=1,c=!0)}return c}DI(){const t=u.et(),i=this.$f.length;for(let m=0;m<=i;m++)t[m]=[];const s=this.network.vertexes.iterator;for(;s.next();){const m=s.value,p=i-m.layer,y=t[p];y[m.index]=m}const n=new I;this.EI(t,n);let o=null,r=null,a=null,h=null;const l=(this.Ln&1)!==0,c=(this.Ln&2)!==0,d=(this.Ln&4)!==0,f=(this.Ln&8)!==0;l&&(this.tl(t,n,!0),o=this.hk(t,!0,!1)),t.reverse(),d&&(this.tl(t,n,!1),a=this.hk(t,!1,!1));for(const m of t)m.reverse();f&&(this.tl(t,n,!1),h=this.hk(t,!1,!0)),t.reverse(),c&&(this.tl(t,n,!0),r=this.hk(t,!0,!0)),u.J(t),this.UI(o,r,a,h),this.network.vertexes.each(m=>{const p=m,y=u.et();l&&y.push(o.get(p)),c&&y.push(r.get(p)),d&&y.push(a.get(p)),f&&y.push(h.get(p)),y.sort((k,L)=>k-L);const x=y.length,b=Math.floor((x-1)/2),M=Math.ceil((x-1)/2),P=(y[b]+y[M])/2;u.J(y),p.he=P})}EI(t,i){const s=t.length;for(let n=1;n<s-1;n++){let o=0,r=0;const a=t[n],h=t[n+1];for(let l=0;r<h.length;l++){const c=h[l],d=this.BI(c);if(l===h.length-1||d){let f=a.length-1;for(d&&(f=c.getProperSourceVertexes()[0].index);r<=l;){const m=h[r].getProperSourceEdges();for(const p of m){const y=p.fromVertex.index;(y<o||y>f)&&i.add(p)}r++}o=f}}}}BI(t){if(t.node===null){const i=t.getProperSourceVertexes();if(i.length>0)return i[0].node===null}return!1}tl(t,i,s){this.VI(t);for(const n of t){let o=-1;for(const r of n){const a=s?r.getProperSourceVertexes():r.getProperDestinationVertexes(),h=a.length;if(h>0){a.sort((c,d)=>c.Eh-d.Eh);const l=(h-1)/2;for(let c=Math.floor(l),d=Math.ceil(l);c<=d;c++)if(r.An===r){const f=a[c];let m;s?m=f.getDestinationEdge(r):m=r.getDestinationEdge(f),!i.has(m)&&o<f.Eh&&(f.An=r,r.tc=f.tc,r.An=f.tc,o=f.Eh)}}}}}VI(t){for(let i=0;i<t.length;i++){const s=t[i];for(let n=0;n<s.length;n++){const o=s[n];o.tc=o,o.An=o,o.RD=i,o.Eh=n}}}hk(t,i,s){const n=this.b===90||this.b===270;for(const r of t)for(const a of r)a.Je=a,a.Qf=1/0,a.he=NaN,a.Tn=0;this.zI(t,i,s);for(const r of t)for(const a of r)a.tc===a&&this.vD(a,t);for(let r=0;r<t.length;r++){if(t[r].length<=0)continue;const a=t[r][0];if(a.Je===a){a.Je.Qf===1/0&&(a.Je.Qf=0);let h=r,l=0,c;do{for(c=t[h][l];c.An!==c.tc;)if(c=c.An,h++,c.Eh>0){const d=this.OD(c,t),f=n?d.width:d.height,m=c.Je.Qf+c.he+c.Tn-(d.he+d.Tn+f+this.columnSpacing);d.Je.Qf=Math.min(d.Je.Qf,m)}l=c.Eh+1}while(h<t.length&&l<t[h].length&&c.Je===t[h][l].Je)}}const o=new Z;for(const r of t)for(const a of r){a.he=a.he+a.Je.Qf+a.Tn;const h=n?a.width:a.height;o.set(a,s?-a.he-h:a.he)}return o}zI(t,i,s){const n=this.b===90||this.b===270;for(const o of t)for(const r of o)if(r.tc===r){let a=0,h=r;for(;h.An!==r;){const l=h.An,c=n?h.width:h.height,d=n?l.width:l.height;let f,m,p,y;i?(p=h.getDestinationEdge(l),f=p.portFromPos,m=p.portToPos,p.link!==null&&(h.node&&h.node!==p.link.fromNode&&(f=n?h.focusX:h.focusY),l.node&&l.node!==p.link.toNode&&(m=n?l.focusX:l.focusY)),s?y=h.Tn+(c-f)-(d-m):y=h.Tn+f-m):(p=l.getDestinationEdge(h),f=p.portToPos,m=p.portFromPos,p.link!==null&&(h.node&&h.node!==p.link.toNode&&(f=n?h.focusX:h.focusY),l.node&&l.node!==p.link.fromNode&&(m=n?l.focusX:l.focusY)),s?y=h.Tn+(c-f)-(d-m):y=h.Tn+f-m),l.Tn=y,a=Math.min(a,y),h=h.An}h=r;do h.Tn=h.Tn-a,h=h.An;while(h!==r)}}vD(t,i){if(!isNaN(t.he))return;t.he=0;let s=t;do{if(s.Eh>0){const n=this.OD(s,i),o=n.tc;this.vD(o,i),t.Je===t&&(t.Je=o.Je);const r=this.b===90||this.b===270?n.width:n.height;if(t.Je===o.Je){const a=o.he+n.Tn+r-s.Tn+this.columnSpacing;t.he=Math.max(t.he,a)}}s=s.An}while(s!==t);for(;s.An!==t;)s=s.An,s.he=t.he,s.Je=t.Je}OD(t,i){const s=t.RD,n=t.Eh;return n<1&&u.o("Could not determine previous vertex in layer"),i[s][n-1]}UI(...t){let i=-1;const s=u.et(),n=u.et();let o=1/0;for(let r=0;r<4;r++){if(!t[r])continue;const a=this.XI(t[r],s,n,r);a<o&&(i=r,o=a)}for(let r=0;r<4;r++){const a=t[r];if(!a)continue;const h=r===0||r===2?s[i]-s[r]:n[i]-n[r];h!==0&&a.each(l=>{a.set(l.key,l.value+h)})}u.J(s),u.J(n)}XI(t,i,s,n){if(!t||t.count===0)return i[n]=0,s[n]=0,1/0;let o=1/0,r=-1/0;return t.each(a=>{const h=a.key,l=a.value,c=this.b===90||this.b===270?h.width:h.height;l<o&&(o=l),l+c>r&&(r=l+c)}),i[n]=o,s[n]=r,r-o}commitLayout(){this.Xy(),this.commitNodes(),this.iC(),this.isRouting&&this.commitLinks()}Xy(){if(!this.setsPortSpots)return;const t=this.rk(!0),i=this.rk(!1),s=this.network.edges.iterator;for(;s.next();){const n=s.value.link;n!==null&&(n.fromSpot=t,n.toSpot=i)}}rk(t){return this.b===270?t?U.MiddleTop:U.MiddleBottom:this.b===90?t?U.MiddleBottom:U.MiddleTop:this.b===180?t?U.MiddleLeft:U.MiddleRight:t?U.MiddleRight:U.MiddleLeft}commitNodes(){this.Zs=[],this.Ls=[],this.As=[],this.It=[];for(let p=0;p<=this.kt;p++)this.Zs[p]=0,this.Ls[p]=0,this.As[p]=0,this.It[p]=0;const t=this.network.vertexes.iterator;for(;t.next();){const p=t.value,y=p.layer;this.Zs[y]=Math.max(this.Zs[y],this.nodeMinLayerSpace(p,!0)),this.Ls[y]=Math.max(this.Ls[y],this.nodeMinLayerSpace(p,!1))}let i=0;const s=this.Ns;for(let p=0;p<=this.kt;p++){let y=s;this.Zs[p]+this.Ls[p]<=0&&(y=0),p>0&&(i+=y/2),this.b===90||this.b===0?(i+=this.Ls[p],this.As[p]=i,i+=this.Zs[p]):(i+=this.Zs[p],this.As[p]=i,i+=this.Ls[p]),p<this.kt&&(i+=y/2),this.It[p]=i}const n=i,o=this.arrangementOrigin;for(let p=0;p<=this.kt;p++)this.b===270?this.As[p]=o.y+this.As[p]:this.b===90?(this.As[p]=o.y+n-this.As[p],this.It[p]=n-this.It[p]):this.b===180?this.As[p]=o.x+this.As[p]:(this.As[p]=o.x+n-this.As[p],this.It[p]=n-this.It[p]);const r=this.Ln!==0;t.reset();const a=this.b===270||this.b===90;let h=1/0,l=1/0,c=1/0,d=-1/0;for(;t.next();){const p=t.value,y=p.layer,x=p.column|0;let b=0,M=0;a?(b=o.x+this.Wi*x,M=this.As[y]):(b=this.As[y],M=o.y+this.Wi*x),p.centerX=b,p.centerY=M,r&&isFinite(p.he)&&(a?p.node?p.x=o.x+p.he:p.centerX=o.x+p.he:p.node?p.y=o.y+p.he:p.centerY=o.y+p.he),h=Math.min(p.x,h),l=Math.min(p.y,l),a?(c=h,d=Math.max(d,p.bounds.right)):(c=l,d=Math.max(d,p.bounds.bottom))}this.ZN=d-c;const f=o.x-h,m=o.y-l;for(this._o=new C(r&&a?0:f,r&&!a?0:m),t.reset();t.next();){const p=t.value;p.x+=f,p.y+=m,p.commit()}}iC(){let t=0;const i=this.Ns;for(let o=0;o<=this.kt;o++)t+=this.Zs[o],t+=this.Ls[o];t+=this.kt*i;const s=[],n=this.Ln!==0?this.ZN:this.Wi*this.zt;for(let o=this.maxLayer;o>=0;o--)this.b===270?o===0?s.push(new G(0,0,n,Math.abs(this.It[0]))):s.push(new G(0,this.It[o-1],n,Math.abs(this.It[o-1]-this.It[o]))):this.b===90?o===0?s.push(new G(0,this.It[0],n,Math.abs(this.It[0]-t))):s.push(new G(0,this.It[o],n,Math.abs(this.It[o-1]-this.It[o]))):this.b===180?o===0?s.push(new G(0,0,Math.abs(this.It[0]),n)):s.push(new G(this.It[o-1],0,Math.abs(this.It[o-1]-this.It[o]),n)):o===0?s.push(new G(this.It[0],0,Math.abs(this.It[0]-t),n)):s.push(new G(this.It[o],0,Math.abs(this.It[o-1]-this.It[o]),n));this.commitLayers(s,this._o)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i;for(;t.next();)i=t.value.link,i!==null&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,i!==null&&i.updateRoute();for(t.reset();t.next();){const s=t.value;if(i=s.link,i===null||i.pointsCount===0)continue;i.startRoute();const n=i;let o=n.fromNode,r=n.toNode,a=n.fromPort,h=n.toPort;if(o!==null){const F=o.findVisibleNode();F!==null&&F!==o&&(o=F,a=F.port)}if(r!==null){const F=r.findVisibleNode();F!==null&&F!==r&&(r=F,h=F.port)}const l=i.computeSpot(!0,a),c=i.computeSpot(!1,h);let d=s.fromVertex,f=s.toVertex;if(s.valid){if(i.curve===9&&i.pointsCount===4)if(d.column===f.column&&this.alignOption===0){const F=i.getLinkPoint(o,a,l,!0,!1,r,h),V=i.getLinkPoint(r,h,c,!1,!1,o,a);F.isReal()||F.set(o.actualBounds.center),V.isReal()||V.set(r.actualBounds.center),i.clearPoints(),i.addPointAt(F.x,F.y),i.addPointAt((2*F.x+V.x)/3,(2*F.y+V.y)/3),i.addPointAt((F.x+2*V.x)/3,(F.y+2*V.y)/3),i.addPointAt(V.x,V.y)}else{let F=!1,V=!1;if(a!==null&&l===U.None&&(F=!0),h!==null&&c===U.None&&(V=!0),F||V){let K=null;F&&(K=i.getLinkPointFromPoint(o,a,a.getDocumentPoint(U.Center),i.getPoint(3),!0),K.isReal()||K.set(o.actualBounds.center),i.setPointAt(0,K.x,K.y));let H=null;if(V&&(H=i.getLinkPointFromPoint(r,h,h.getDocumentPoint(U.Center),i.getPoint(0),!1),H.isReal()||H.set(r.actualBounds.center),i.setPointAt(3,H.x,H.y)),K){const W=i.getPoint(2);i.setPointAt(1,(K.x*2+W.x)/3,(K.y*2+W.y)/3)}if(H){const W=i.getPoint(1);i.setPointAt(2,(H.x*2+W.x)/3,(H.y*2+W.y)/3)}}}i.commitRoute();continue}if(d.layer===f.layer){i.commitRoute();continue}let m=!1,p=!1;const y=this.Ns;let x=0,b=i.firstPickIndex+1;if(i.isOrthogonal)p=!0,x=i.pointsCount,x>4&&i.points.removeRange(2,x-3);else if(i.curve===9)m=!0,x=i.pointsCount,x>4&&i.points.removeRange(2,x-3),x===4&&(b=2);else{x=i.pointsCount;const F=l===U.None,V=c===U.None;x>2&&F&&V?i.points.removeRange(1,x-2):x>3&&F&&!V?i.points.removeRange(1,x-3):x>3&&!F&&V?i.points.removeRange(2,x-2):x>4&&!F&&!V&&i.points.removeRange(2,x-3)}let M,P,k=0,L=0,T=0,D=0,B=0,E=0,R=0;if(s.rev){let F=0;for(;f!==null&&d!==f;){M=null,P=null;const V=f.sourceEdges.iterator;for(;V.next();){const K=V.value;if(K.link===s.link&&(M=K.fromVertex,P=K.toVertex,M.node===null))break}if(M===null)break;if(M!==d)if(k=i.getPoint(b-1).x,L=i.getPoint(b-1).y,T=M.centerX,D=M.centerY,p)this.b===180||this.b===0?b===i.firstPickIndex+1?(i.insertPointAt(b++,k,L),i.insertPointAt(b++,k,D)):(P!==null?P.centerY:L)!==D&&(B=this.It[M.layer-1]+this._o.x,i.insertPointAt(b++,B,L),i.insertPointAt(b++,B,D)):b===i.firstPickIndex+1?(i.insertPointAt(b++,k,L),i.insertPointAt(b++,T,L)):(P!==null?P.centerX:k)!==T&&(B=this.It[M.layer-1]+this._o.y,i.insertPointAt(b++,k,B),i.insertPointAt(b++,T,B));else if(b===i.firstPickIndex+1)if(E=Math.max(10,this.Zs[f.layer]),R=Math.max(10,this.Ls[f.layer]),m)this.b===180?T<=f.bounds.x?(F=f.bounds.x,i.insertPointAt(b++,F-E,D),i.insertPointAt(b++,F,D),i.insertPointAt(b++,F+R,D)):(i.insertPointAt(b++,T-E,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T+R,D)):this.b===90?D>=f.bounds.bottom?(F=f.bounds.y+f.bounds.height,i.insertPointAt(b++,T,F+R),i.insertPointAt(b++,T,F),i.insertPointAt(b++,T,F-E)):(i.insertPointAt(b++,T,D+R),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D-E)):this.b===270?D<=f.bounds.y?(F=f.bounds.y,i.insertPointAt(b++,T,F-E),i.insertPointAt(b++,T,F),i.insertPointAt(b++,T,F+R)):(i.insertPointAt(b++,T,D-E),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D+R)):this.b===0&&(T>=f.bounds.right?(F=f.bounds.x+f.bounds.width,i.insertPointAt(b++,F+R,D),i.insertPointAt(b++,F,D),i.insertPointAt(b++,F-E,D)):(i.insertPointAt(b++,T+R,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T-E,D)));else{i.insertPointAt(b++,k,L);let K=0;this.b===180||this.b===0?((this.b===180?T>=f.bounds.right:T<=f.bounds.x)&&(K=(this.b===0?-E:R)/2),i.insertPointAt(b++,k+K,D)):((this.b===270?D>=f.bounds.bottom:D<=f.bounds.y)&&(K=(this.b===90?-E:R)/2),i.insertPointAt(b++,T,L+K)),i.insertPointAt(b++,T,D)}else E=Math.max(10,this.Zs[M.layer]),R=Math.max(10,this.Ls[M.layer]),m?this.b===180?(i.insertPointAt(b++,T-E-y,D),i.insertPointAt(b++,Math.min(T-E+y/2,T),D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,Math.max(T+R-y/2,T),D),i.insertPointAt(b++,T+R+y,D)):this.b===90?(i.insertPointAt(b++,T,D+R+y),i.insertPointAt(b++,T,Math.max(D+R-y/2,D)),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,Math.min(D-E+y/2,D)),i.insertPointAt(b++,T,D-E-y)):this.b===270?(i.insertPointAt(b++,T,D-E-y),i.insertPointAt(b++,T,Math.min(D-E+y/2,D)),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,Math.max(D+R-y/2,D)),i.insertPointAt(b++,T,D+R+y)):(i.insertPointAt(b++,T+R+y,D),i.insertPointAt(b++,Math.max(T+R-y/2,T),D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,Math.min(T-E+y/2,T),D),i.insertPointAt(b++,T-E-y,D)):(this.b===180||this.b===90||this.b,i.insertPointAt(b++,T,D));f=M}if(h===null||l!==U.None||p)if(k=i.getPoint(b-1).x,L=i.getPoint(b-1).y,T=i.getPoint(b).x,D=i.getPoint(b).y,p){const V=this.Ls[d.layer];let K=0;this.b===180||this.b===0?(K=L,K>=d.bounds.y&&K<=d.bounds.bottom&&(this.b===180?T>=d.bounds.x:T<=d.bounds.right)&&(F=d.centerX+(this.b===180?-V:V),K<d.bounds.y+d.bounds.height/2?K=d.bounds.y-this.Wi/2:K=d.bounds.bottom+this.Wi/2,i.insertPointAt(b++,F,L),i.insertPointAt(b++,F,K)),i.insertPointAt(b++,T,K),i.insertPointAt(b++,T,D)):(K=k,K>=d.bounds.x&&K<=d.bounds.right&&(this.b===270?D>=d.bounds.y:D<=d.bounds.bottom)&&(F=d.centerY+(this.b===270?-V:V),K<d.bounds.x+d.bounds.width/2?K=d.bounds.x-this.Wi/2:K=d.bounds.right+this.Wi/2,i.insertPointAt(b++,k,F),i.insertPointAt(b++,K,F)),i.insertPointAt(b++,K,D),i.insertPointAt(b++,T,D))}else if(m)E=Math.max(10,this.Zs[d.layer]),R=Math.max(10,this.Ls[d.layer]),this.b===180&&T>=d.bounds.x?(F=d.bounds.x+d.bounds.width,i.setPointAt(b-2,F,L),i.setPointAt(b-1,F+R,L)):this.b===90&&D<=d.bounds.bottom?(F=d.bounds.y,i.setPointAt(b-2,k,F),i.setPointAt(b-1,k,F-E)):this.b===270&&D>=d.bounds.y?(F=d.bounds.y+d.bounds.height,i.setPointAt(b-2,k,F),i.setPointAt(b-1,k,F+R)):this.b===0&&T<=d.bounds.right&&(F=d.bounds.x,i.setPointAt(b-2,F,L),i.setPointAt(b-1,F-E,L));else{E=Math.max(10,this.Zs[d.layer]),R=Math.max(10,this.Ls[d.layer]);let V=0;this.b===180||this.b===0?((this.b===180?T<=d.bounds.x:T>=d.bounds.right)&&(V=(this.b===0?R:-E)/2),i.insertPointAt(b++,T+V,L)):((this.b===270?D<=d.bounds.y:D>=d.bounds.bottom)&&(V=(this.b===90?R:-E)/2),i.insertPointAt(b++,k,D+V)),i.insertPointAt(b++,T,D)}}else{for(;d!==null&&d!==f;){M=null,P=null;const F=d.destinationEdges.iterator;for(;F.next();){const V=F.value;if(V.link===s.link&&(M=V.toVertex,P=V.fromVertex,P.node!==null&&(P=null),M.node===null))break}if(M===null)break;M!==f&&(k=i.getPoint(b-1).x,L=i.getPoint(b-1).y,T=M.centerX,D=M.centerY,p?this.b===180||this.b===0?(P!==null?P.centerY:L)!==D&&(B=this.It[M.layer]+this._o.x,b===i.firstPickIndex+1&&(this.b===0?B=Math.max(B,k):B=Math.min(B,k)),i.insertPointAt(b++,B,L),i.insertPointAt(b++,B,D)):(P!==null?P.centerX:k)!==T&&(B=this.It[M.layer]+this._o.y,b===i.firstPickIndex+1&&(this.b===90?B=Math.max(B,L):B=Math.min(B,L)),i.insertPointAt(b++,k,B),i.insertPointAt(b++,T,B)):(E=Math.max(10,this.Zs[M.layer]),R=Math.max(10,this.Ls[M.layer]),m?this.b===180?(i.insertPointAt(b++,T+R+y,D),i.insertPointAt(b++,Math.max(T+R-y/2,T),D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,Math.min(T-E+y/2,T),D),i.insertPointAt(b++,T-E-y,D)):this.b===90?(i.insertPointAt(b++,T,D-E-y),i.insertPointAt(b++,T,Math.min(D-E+y/2,D)),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,Math.max(D+R-y/2,D)),i.insertPointAt(b++,T,D+R+y)):this.b===270?(i.insertPointAt(b++,T,D+R+y),i.insertPointAt(b++,T,Math.max(D+R-y/2,D)),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,Math.min(D-E+y/2,D)),i.insertPointAt(b++,T,D-E-y)):(i.insertPointAt(b++,T-E-y,D),i.insertPointAt(b++,Math.min(T-E+y/2,T),D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,T,D),i.insertPointAt(b++,Math.max(T+R-y/2,T),D),i.insertPointAt(b++,T+R+y,D)):this.b===180?(i.insertPointAt(b++,T+R,D),i.insertPointAt(b++,T-E,D)):this.b===90?(i.insertPointAt(b++,T,D-E),i.insertPointAt(b++,T,D+R)):this.b===270?(i.insertPointAt(b++,T,D+R),i.insertPointAt(b++,T,D-E)):(i.insertPointAt(b++,T-E,D),i.insertPointAt(b++,T+R,D)))),d=M}p&&(k=i.getPoint(b-1).x,L=i.getPoint(b-1).y,T=i.getPoint(b).x,D=i.getPoint(b).y,this.b===180||this.b===0?L!==D&&(this.b===0?B=Math.min(Math.max((T+k)/2,this.It[f.layer]+this._o.x),T):B=Math.max(Math.min((T+k)/2,this.It[f.layer]+this._o.x),T),i.insertPointAt(b++,B,L),i.insertPointAt(b++,B,D)):k!==T&&(this.b===90?B=Math.min(Math.max((D+L)/2,this.It[f.layer]+this._o.y),D):B=Math.max(Math.min((D+L)/2,this.It[f.layer]+this._o.y),D),i.insertPointAt(b++,k,B),i.insertPointAt(b++,T,B)))}if(n!==null&&m&&i.pointsCount>=4){if(a!==null){const F=l===U.None?i.getLinkPointFromPoint(o,a,a.getDocumentPoint(U.Center),i.getPoint(3),!0):i.getPoint(0);if(l===U.None){const V=i.getPoint(2),K=i.getPoint(3);this.direction===90||this.direction===270?(i.setPointAt(1,(F.x+V.x)/2,V.y),i.setPointAt(2,K.x,(V.y+K.y)/2)):(i.setPointAt(1,V.x,(F.y+V.y)/2),i.setPointAt(2,(V.x+K.x)/2,K.y))}F.isReal()||F.set(o.actualBounds.center),i.setPointAt(0,F.x,F.y)}if(h!==null){const F=c===U.None?i.getLinkPointFromPoint(r,h,h.getDocumentPoint(U.Center),i.getPoint(i.pointsCount-4),!1):i.getPoint(i.pointsCount-1);if(c===U.None){const V=i.getPoint(i.pointsCount-3),K=i.getPoint(i.pointsCount-4);this.direction===90||this.direction===270?(i.setPointAt(i.pointsCount-2,(F.x+V.x)/2,V.y),i.setPointAt(i.pointsCount-2,K.x,(V.y+K.y)/2)):(i.setPointAt(i.pointsCount-2,V.x,(F.y+V.y)/2),i.setPointAt(i.pointsCount-3,(V.x+K.x)/2,K.y))}F.isReal()||F.set(r.actualBounds.center),i.setPointAt(i.pointsCount-1,F.x,F.y)}}i.commitRoute(),s.commit()}}aI(){this.Yy=-1,this.kg=0,this.Cs=0,this._a=null,this.Sg=null,this.$f=null;for(let t=0;t<this.Cn.length;t++)this.Cn[t]=null}Oh(t){let i;const s=this.ci[t];if(s>=this.Cn.length){const o=[];for(let r=0;r<this.Cn.length;r++)o[r]=this.Cn[r];this.Cn=o}this.Cn[s]===void 0||this.Cn[s]===null?i=[]:(i=this.Cn[s],this.Cn[s]=null);const n=this.$f[t];for(let o=0;o<n.length;o++){const r=n[o];i[r.index]=r}return i}Ih(t,i){this.Cn[this.ci[t]]=i}get layerSpacing(){return this.Ns}set layerSpacing(t){this.Ns!==t&&t>=0&&(this.Ns=t,this.invalidateLayout())}get columnSpacing(){return this.Wi}set columnSpacing(t){this.Wi!==t&&t>0&&(this.Wi=t,this.invalidateLayout())}get direction(){return this.b}set direction(t){this.b!==t&&(t===0||t===90||t===180||t===270?(this.b=t,this.invalidateLayout()):u.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.jf}set cycleRemoveOption(t){this.jf!==t&&(t===1||t===0||t===2)&&(this.jf=t,this.invalidateLayout())}get layeringOption(){return this.Hf}set layeringOption(t){this.Hf!==t&&(t===10||t===11||t===12)&&(this.Hf=t,this.invalidateLayout())}get initializeOption(){return this.qf}set initializeOption(t){this.qf!==t&&(t===20||t===21||t===22)&&(this.qf=t,this.invalidateLayout())}get iterations(){return this.Qa}set iterations(t){this.Qa!==t&&t>=0&&(this.Qa=t,this.invalidateLayout())}get aggressiveOption(){return this.Wf}set aggressiveOption(t){this.Wf!==t&&(t===30||t===31||t===32)&&(this.Wf=t,this.invalidateLayout())}get packOption(){return this.Qo}set packOption(t){this.Qo!==t&&t>=0&&t<8&&(this.Qo=t,this.invalidateLayout())}get packIterations(){return this.Jf}set packIterations(t){this.Jf=t}get alignOption(){return this.Ln}set alignOption(t){this.Ln!==t&&t>=0&&t<16&&(this.Ln=t,this.invalidateLayout())}get setsPortSpots(){return this.Nn}set setsPortSpots(t){this.Nn!==t&&(this.Nn=t,this.invalidateLayout())}get maxLayer(){return this.kt}get maxIndex(){return this.Yy}get maxColumn(){return this.zt}get minIndexLayer(){return this.kg}get maxIndexLayer(){return this.Cs}}g(fe,"CycleDepthFirst",0),g(fe,"CycleGreedy",1),g(fe,"CycleFromLayers",2),g(fe,"LayerOptimalLinkLength",10),g(fe,"LayerLongestPathSink",11),g(fe,"LayerLongestPathSource",12),g(fe,"InitDepthFirstOut",20),g(fe,"InitDepthFirstIn",21),g(fe,"InitNaive",22),g(fe,"AggressiveNone",30),g(fe,"AggressiveLess",31),g(fe,"AggressiveMore",32),g(fe,"PackNone",0),g(fe,"PackExpand",1),g(fe,"PackStraighten",2),g(fe,"PackMedian",4),g(fe,"PackAll",15),g(fe,"AlignNone",0),g(fe,"AlignUpperLeft",1),g(fe,"AlignUpperRight",2),g(fe,"AlignLowerLeft",4),g(fe,"AlignLowerRight",8),g(fe,"AlignAll",15);class Ma extends _i{constructor(e){super(e)}createVertex(){return new gn(this)}createEdge(){return new Na(this)}}class gn extends Zi{constructor(t){super(t);g(this,"Yo");g(this,"Hr");g(this,"At");g(this,"ak");g(this,"ck");g(this,"$i");g(this,"Zf");g(this,"Xn");g(this,"ok");g(this,"ek");g(this,"sk");g(this,"tc");g(this,"An");g(this,"RD");g(this,"Eh");g(this,"Je");g(this,"Qf");g(this,"he");g(this,"Tn");g(this,"Hy",null);g(this,"qy",null);g(this,"Wy",null);g(this,"Jy",null);this.Yo=-1,this.Hr=-1,this.At=-1,this.ak=NaN,this.ck=null,this.$i=!1,this.Zf=NaN,this.Xn=NaN,this.ok=0,this.ek=null,this.sk=null}static ID(t,i){return t.index-i.index}getProperSourceEdges(){if(!this.Wy){const t=[];for(const i of this.fo){const s=i;s.valid&&t.push(s)}this.Wy=t}return this.Wy}getProperDestinationEdges(){if(!this.Jy){const t=[];for(const i of this.Wo){const s=i;s.valid&&t.push(s)}this.Jy=t}return this.Jy}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const s of i)if(s.toVertex===t)return s;u.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Hy){const t=[];for(const i of this.fo){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.fromVertex)}t.sort(gn.ID),this.Hy=t}return this.Hy}getProperDestinationVertexes(){if(!this.qy){const t=[];for(const i of this.Wo){const s=i;!s.valid||s.fromVertex.layer<=s.toVertex.layer||t.push(s.toVertex)}t.sort(gn.ID),this.qy=t}return this.qy}addSourceEdge(t){super.addSourceEdge(t),this.Hy=null,this.Wy=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Hy=null,this.Wy=null}addDestinationEdge(t){super.addDestinationEdge(t),this.qy=null,this.Jy=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.qy=null,this.Jy=null}get layer(){return this.Yo}set layer(t){this.Yo!==t&&(this.Yo=t)}get column(){return this.Hr}set column(t){this.Hr!==t&&(this.Hr=t)}get index(){return this.At}set index(t){this.At!==t&&(this.At=t)}get component(){return this.ak}set component(t){this.ak!==t&&(this.ak=t)}get near(){return this.ck}set near(t){this.ck!==t&&(this.ck=t)}}class Na extends Ds{constructor(t){super(t);g(this,"$i");g(this,"fk");g(this,"uk");g(this,"dk");g(this,"gk");g(this,"mk");g(this,"pk");this.$i=!1,this.fk=!1,this.uk=!1,this.dk=NaN,this.gk=NaN,this.mk=0,this.pk=0}get fromVertex(){return this.He}set fromVertex(t){this.He!==t&&(this.He=t)}get toVertex(){return this.qe}set toVertex(t){this.qe!==t&&(this.qe=t)}get valid(){return this.$i}set valid(t){this.$i!==t&&(this.$i=t)}get rev(){return this.fk}set rev(t){this.fk!==t&&(this.fk=t)}get forest(){return this.uk}set forest(t){this.uk!==t&&(this.uk=t)}get portFromPos(){return this.dk}set portFromPos(t){this.dk!==t&&(this.dk=t)}get portToPos(){return this.gk}set portToPos(t){this.gk!==t&&(this.gk=t)}get portFromColOffset(){return this.mk}set portFromColOffset(t){this.mk!==t&&(this.mk=t)}get portToColOffset(){return this.pk}set portToColOffset(t){this.pk!==t&&(this.pk=t)}}var Qo=(S=>(S[S.Default=0]="Default",S[S.Destination=1]="Destination",S[S.Source=2]="Source",S))(Qo||{}),tr=(S=>(S[S.Forwards=10]="Forwards",S[S.Reverse=11]="Reverse",S[S.Ascending=12]="Ascending",S[S.Descending=13]="Descending",S))(tr||{}),er=(S=>(S[S.CenterSubtrees=20]="CenterSubtrees",S[S.CenterChildren=21]="CenterChildren",S[S.Start=22]="Start",S[S.End=23]="End",S[S.Bus=24]="Bus",S[S.BusBranching=25]="BusBranching",S[S.TopLeftBus=26]="TopLeftBus",S[S.BottomRightBus=27]="BottomRightBus",S[S.Custom=28]="Custom",S))(er||{}),ir=(S=>(S[S.None=30]="None",S[S.Block=31]="Block",S))(ir||{}),sr=(S=>(S[S.Layered=40]="Layered",S[S.LastParents=41]="LastParents",S[S.Alternating=42]="Alternating",S[S.RootOnly=43]="RootOnly",S))(sr||{}),nr=(S=>(S[S.Vertical=50]="Vertical",S[S.Horizontal=51]="Horizontal",S[S.FixedRoots=52]="FixedRoots",S))(nr||{}),Ca=(S=>(S[S.Individual=60]="Individual",S[S.Siblings=61]="Siblings",S[S.Uniform=62]="Uniform",S))(Ca||{});class se extends De{constructor(t){super();g(this,"Fi");g(this,"Li");g(this,"_f");g(this,"Ng");g(this,"eC");g(this,"Fe");g(this,"Xi");g(this,"Ms");g(this,"U");g(this,"B");g(this,"yk");g(this,"ls");this.Fi=new I,this.Li=0,this.ls=1,this._f=40,this.Ng=60,this.eC=[],this.Fe=!0,this.Xi=50,this.Ms=new rt(10,10).u();const i=new or(this);this.U=new ui(i),this.B=new ui(i),this.yk=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Li=this.Li,t._f=this._f,t.Ng=this.Ng,t.Fe=this.Fe,t.Xi=this.Xi,t.Ms.a(this.Ms),t.U.copyInheritedPropertiesFrom(this.U),t.B.copyInheritedPropertiesFrom(this.B)}oi(t){t in er?this.alignment=t:t in nr?this.arrangement=t:t in ir?this.compaction=t:t in Qo?this.path=t:t in tr?this.sorting=t:t in sr?this.treeStyle=t:super.oi(t)}createNetwork(){return new or(this)}makeNetwork(t){const i=this.createNetwork(),s=n=>{if(n instanceof gt)return!n.isLinkLabel&&n.category!=="Comment";if(n instanceof St){const o=n.fromNode;if(o===null||o.isLinkLabel||o.category==="Comment")return!1;const r=n.toNode;return!(r===null||r.isLinkLabel||r.category==="Comment")}return!1};return t instanceof zt?(i.addParts(t.nodes,!0,s),i.addParts(t.links,!0,s)):t instanceof Nt?i.addParts(t.memberParts,!1,s):i.addParts(t.iterator,!1,s),i}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;i===null&&t instanceof zt&&(i=t),this.path===0&&i!==null?this.ls=i.isTreePathToChildren?1:2:this.ls=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.HI(),this.qI(),this.WI(),this.JI(),this.$N(),this.$I(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Fi=new I,this.isValidLayout=!0}HI(){this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const o=t.value;o.initialized=!1,o.level=0,o.parent=null,o.children=[]}if(this.Fi.count>0){const o=new I,r=this.Fi.iterator;for(;r.next();){const a=r.value;if(a instanceof gt){const h=this.network.findVertex(a);h!==null&&o.add(h)}else a instanceof ui&&o.add(a)}this.Fi=o}this.Fi.count===0&&this.findRoots();const i=this.Fi.copy().iterator;for(;i.next();){const o=i.value;o.initialized||(o.initialized=!0,this.sC(o))}let s=this.network.vertexes,n=null;for(;n=this.ZI(s),n.count>0;){const o=this.ED(n);o!==null&&this.Fi.add(o),o.initialized=!0,this.sC(o),s=n}}ZI(t){const i=new I,s=t.iterator;for(;s.next();){const n=s.value;n.initialized||i.add(n)}return i}findRoots(){const t=this.network.vertexes,i=t.iterator;for(;i.next();){const s=i.value;switch(this.ls){case 1:s.sourceEdges.count===0&&this.Fi.add(s);break;case 2:s.destinationEdges.count===0&&this.Fi.add(s);break;default:u.o("Unhandled path value "+this.ls.toString())}}if(this.Fi.count===0){const s=this.ED(t);s!==null&&this.Fi.add(s)}}ED(t){let i=999999,s=null;const n=t.iterator;for(;n.next();){const o=n.value;switch(this.ls){case 1:o.sourceEdges.count<i&&(i=o.sourceEdges.count,s=o);break;case 2:o.destinationEdges.count<i&&(i=o.destinationEdges.count,s=o);break;default:u.o("Unhandled path value "+this.ls.toString())}}return s}sC(t){if(t===null)return;switch(this.ls){case 1:if(t.destinationEdges.count>0){const n=new Y,o=t.destinationVertexes;for(;o.next();){const r=o.value;this.UD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;case 2:if(t.sourceEdges.count>0){const n=new Y,o=t.sourceVertexes;for(;o.next();){const r=o.value;this.UD(t,r)&&n.add(r)}n.count>0&&(t.children=n.toArray())}break;default:u.o("Unhandled path value"+this.ls.toString())}const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];o.initialized=!0,o.level=t.level+1,o.parent=t,this.Fi.delete(o)}for(let n=0;n<s;n++){const o=i[n];this.sC(o)}}UD(t,i){return i.initialized?this.QI(i,t)||i.level>t.level?!1:(this._I(i.parent,i),!0):!0}QI(t,i){if(i===null)return!1;let s=i.parent;for(;s!==null&&s!==t;)s=s.parent;return s===t}_I(t,i){if(t===null||i===null)return;const s=t.children;let n=0;for(let o=0;o<s.length;o++)s[o]===i&&n++;if(n>0){const o=new Array(s.length-n);let r=0;for(let a=0;a<s.length;a++)s[a]!==i&&(o[r++]=s[a]);t.children=o}}qI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof ui&&this.BD(i)}}BD(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let i=0,s=t.childrenCount,n=0;const o=t.children,r=o.length;for(let a=0;a<r;a++){const h=o[a];this.BD(h),i+=h.descendantCount+1,s=Math.max(s,h.maxChildrenCount),n=Math.max(n,h.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=s,t.maxGenerationCount=s>0?n+1:0}tE(t){switch(this._f){default:case 40:return t.parent!==null?t.parent:this.U;case 43:return t.parent===null?this.U:t.parent.parent===null?this.B:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.B:this.U;case 41:{let i=!0;if(t.childrenCount===0)i=!1;else{const s=t.children,n=s.length;for(let o=0;o<n;o++)if(s[o].childrenCount>0){i=!1;break}}return i&&t.parent!==null?this.B:t.parent!==null?t.parent:this.U}}}initializeTreeVertexValues(t){const i=this.tE(t);if(t.copyInheritedPropertiesFrom(i),t.parent!==null&&t.parent.alignment===25){let s=t.angle;const n=t.parent.children;let o=0;for(;o<n.length&&t!==n[o];)o++;o%2===0?o!==n.length-1&&(s===90?s=180:s===180?s=270:s===270?s=180:s=270):s===90?s=0:s===180?s=90:s===270?s=0:s=90,t.angle=s}t.initialized=!0}WI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof ui&&this.VD(i)}}VD(t){if(t===null)return;this.assignTreeVertexValues(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.VD(o)}}assignTreeVertexValues(t){}JI(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof ui&&this.zD(i)}}zD(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.zD(o)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}$N(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.angle,s=t.parent;let n=0,o=21,r=!1;s!==null&&(n=s.angle,o=s.alignment,r=this.isBusAlignment(o));const a=i===90||i===270,h=n===90||n===270,l=t.childrenCount===0;let c=0,d=0,f=0;const m=t.commentSpacing;if(t.node!==null){const p=t.node.findNodesConnected();for(;p.next();){const y=p.value;if(y.category!=="Comment"||!y.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(y),y.ensureBounds();const x=y.measuredBounds;a&&!l||!r&&!h&&l||r&&h&&l?(c=Math.max(c,x.width),d+=x.height+Math.abs(f)):(c+=x.width+Math.abs(f),d=Math.max(d,x.height)),f=m}}if(t.comments!==null){a&&!l||!r&&!h&&l||r&&h&&l?(c+=Math.abs(t.commentMargin),d=Math.max(0,d-t.height)):(d+=Math.abs(t.commentMargin),c=Math.max(0,c-t.width));const p=G.V(0,0,t.bounds.width+c,t.bounds.height+d);t.bounds=p,G.e(p)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}$y(t){return t===24||t===25}nC(t){const i=t.parent;if(i!==null){const s=i.alignment;if(this.isBusAlignment(s))if(this.$y(s)){const n=i.children;let o=0;for(;o<n.length&&t!==n[o];)o++;return o%2===0}else return s===26}return!1}layoutComments(t){if(t.comments!==null){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,a=!1;s!==null&&(o=s.angle,r=s.alignment,a=this.isBusAlignment(r));const h=n===90||n===270,l=o===90||o===270,c=t.childrenCount===0,d=this.nC(t);let f=0;const m=t.comments,p=m.length,y=C.l();for(let b=0;b<p;b++){const M=m[b],P=M.measuredBounds;if(h&&!c||!a&&!l&&c||a&&l&&c){if(o>135&&!a||l&&d)if(t.commentMargin>=0){y.i(t.bounds.x-t.commentMargin-P.width,t.bounds.y+f),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleLeft,L.toSpot=U.MiddleRight}}else{y.i(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+f),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleRight,L.toSpot=U.MiddleLeft}}else if(t.commentMargin>=0){y.i(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+f),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleRight,L.toSpot=U.MiddleLeft}}else{y.i(t.bounds.x+t.commentMargin-P.width,t.bounds.y+f),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleLeft,L.toSpot=U.MiddleRight}}t.commentSpacing>=0?f+=P.height+t.commentSpacing:f+=t.commentSpacing-P.height}else{if(o>135&&!a||!l&&d)if(t.commentMargin>=0){y.i(t.bounds.x+f,t.bounds.y-t.commentMargin-P.height),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleTop,L.toSpot=U.MiddleBottom}}else{y.i(t.bounds.x+f,t.bounds.y+t.focus.y*2-t.commentMargin),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleBottom,L.toSpot=U.MiddleTop}}else if(t.commentMargin>=0){y.i(t.bounds.x+f,t.bounds.y+t.focus.y*2+t.commentMargin),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleBottom,L.toSpot=U.MiddleTop}}else{y.i(t.bounds.x+f,t.bounds.y+t.commentMargin-P.height),M.move(y);const k=M.findLinksInto();for(;k.next();){const L=k.value;L.fromSpot=U.MiddleTop,L.toSpot=U.MiddleBottom}}t.commentSpacing>=0?f+=P.width+t.commentSpacing:f+=t.commentSpacing-P.width}}C.e(y);const x=f-t.commentSpacing-(h?i.height:i.width);if(this.ls===1){const b=t.destinationEdges;for(;b.next();){const M=b.value.link;M!==null&&!M.isAvoiding&&(M.fromEndSegmentLength=x>0?x:NaN)}}else{const b=t.sourceEdges;for(;b.next();){const M=b.value.link;M!==null&&!M.isAvoiding&&(M.toEndSegmentLength=x>0?x:NaN)}}}}$I(){if(this.layerStyle===62){const i=[];let s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n);const r=o.angle===0||o.angle===180;let a=i[n.level];a===void 0&&(a=0),i[n.level]=Math.max(a,r?n.width:n.height)}for(let n=0;n<i.length;n++)i[n]===void 0&&(i[n]=0);for(this.eC=i,s=this.network.vertexes.iterator;s.next();){const n=s.value;let o=n.parent;o===null&&(o=n),o.angle===0||o.angle===180?(o.angle===180&&(n.focusX+=i[n.level]-n.width),n.width=i[n.level]):(o.angle===270&&(n.focusY+=i[n.level]-n.height),n.height=i[n.level])}}else if(this.layerStyle===61){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value,n=s.angle===0||s.angle===180;let o=-1;for(let r=0;r<s.children.length;r++){const a=s.children[r];o=Math.max(o,n?a.width:a.height)}if(o>=0)for(let r=0;r<s.children.length;r++){const a=s.children[r];n?(s.angle===180&&(a.focusX+=o-a.width),a.width=o):(s.angle===270&&(a.focusY+=o-a.height),a.height=o)}}}const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof ui&&this.layoutTree(i)}}layoutTree(t){if(t===null)return;const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.layoutTree(o)}switch(t.compaction){case 30:this.XD(t);break;default:case 31:t.alignment===25?this.XD(t):this.iE(t);break}}XD(t){if(t.childrenCount===0){let J=!1,$=0,et=21;t.parent!==null&&($=t.parent.angle,et=t.parent.alignment,J=this.isBusAlignment(et));const ot=this.nC(t);t.O.i(0,0),t.ut.i(t.width,t.height),t.parent!==null&&t.comments!==null&&(($===180||$===270)&&!J||ot)?$===180&&!J||($===90||$===270)&&ot?t.lt.i(t.width-t.focus.x*2,0):t.lt.i(0,t.height-t.focus.y*2):t.lt.i(0,0);return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let J=0;J<r;J++){const $=o[J];n=Math.max(n,s?$.ut.width:$.ut.height)}const a=t.alignment,h=a===22,l=a===23,c=this.isBusAlignment(a),d=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),m=t.nodeSpacing,p=this.computeNodeIndent(t),y=h||l?0:p/2,x=t.rowSpacing;let b=0;(h||l)&&(b=Math.max(0,t.rowIndent));const M=t.width,P=t.height;let k=0,L=0,T=0,D=0,B=0,E=0,R=0,F=0,V=0,K=0;if(c&&!this.$y(a)&&i>135&&o.reverse(),this.$y(a))if(r>1)for(let J=0;J<r;J++){const $=o[J],et=$.ut;J%2===0&&J!==r-1?V=Math.max(V,(s?et.width:et.height)+this.computeBusNodeSpacing($)-m):J%2!==0&&(K=Math.max(K,(s?et.width:et.height)+this.computeBusNodeSpacing($)-m))}else r===1&&(V=s?o[0].ut.width:o[0].ut.height);if(c)switch(a){case 24:case 25:let J;i<135?J=this.YD(t,o,V,K,k,L):J=this.GD(t,o,V,K,k,L),V=J.x,k=J.width,L=J.height;break;case 26:for(let $=0;$<r;$++){const et=o[$],ot=et.ut,Ct=R===0?0:x;s?(et.O.i(n-ot.width,B+Ct),k=Math.max(k,ot.width),L=Math.max(L,B+Ct+ot.height),B+=Ct+ot.height):(et.O.i(D+Ct,n-ot.height),k=Math.max(k,D+Ct+ot.width),L=Math.max(L,ot.height),D+=Ct+ot.width),R++}break;case 27:for(let $=0;$<r;$++){const et=o[$],ot=et.ut,Ct=R===0?0:x;s?(et.O.i(m/2+t.focus.x,B+Ct),k=Math.max(k,ot.width),L=Math.max(L,B+Ct+ot.height),B+=Ct+ot.height):(et.O.i(D+Ct,m/2+t.focus.y),k=Math.max(k,D+Ct+ot.width),L=Math.max(L,ot.height),D+=Ct+ot.width),R++}break}else for(let J=0;J<r;J++){const $=o[J],et=$.ut;if(s){d>0&&R>0&&D+m+et.width>d&&(D<n&&this.ic(t,a,n-D,0,F,J-1),E++,R=0,F=J,T=L,D=0,B=i>135?-L-x:L+x);const ot=R===0?y:m;this.wk($,0,B),$.O.i(D+ot,B),k=Math.max(k,D+ot+et.width),L=Math.max(L,T+(E===0?0:x)+et.height),D+=ot+et.width}else{d>0&&R>0&&B+m+et.height>d&&(B<n&&this.ic(t,a,0,n-B,F,J-1),E++,R=0,F=J,T=k,B=0,D=i>135?-k-x:k+x);const ot=R===0?y:m;this.wk($,D,0),$.O.i(D,B+ot),L=Math.max(L,B+ot+et.height),k=Math.max(k,T+(E===0?0:x)+et.width),B+=ot+et.height}R++}E>0&&(s?(L+=Math.max(0,f),D<k&&this.ic(t,a,k-D,0,F,r-1),b>0&&(l||this.tu(t,b,0,0,r-1),k+=b)):(k+=Math.max(0,f),B<L&&this.ic(t,a,0,L-B,F,r-1),b>0&&(l||this.tu(t,0,b,0,r-1),L+=b)));let H=0,W=0;switch(a){case 20:s?H+=k/2-t.focus.x-p/2:W+=L/2-t.focus.y-p/2;break;default:case 21:if(E>0)s?H+=k/2-t.focus.x-p/2:W+=L/2-t.focus.y-p/2;else{const $=r;if(s){const et=o[0].O.x+o[0].lt.x,ot=o[$-1].O.x+o[$-1].lt.x+o[$-1].focus.x*2;H+=et+(ot-et)/2-t.focus.x-p/2}else{const et=o[0].O.y+o[0].lt.y,ot=o[$-1].O.y+o[$-1].lt.y+o[$-1].focus.y*2;W+=et+(ot-et)/2-t.focus.y-p/2}}break;case 22:s?(H-=p,k+=p):(W-=p,L+=p);break;case 23:s?(H+=k-t.width+p,k+=p):(W+=L-t.height+p,L+=p);break;case 24:case 25:s?r>1?H+=V+m/2-t.focus.x:H+=o[0].focus.x-t.focus.x+o[0].lt.x:r>1?W+=V+m/2-t.focus.y:W+=o[0].focus.y-t.focus.y+o[0].lt.y;break;case 26:s?H+=k+m/2-t.focus.x:W+=L+m/2-t.focus.y;break;case 27:break;case 28:const J=this.customAlignment(t,H,W,k,L);H=J[0],W=J[1],k=J[2],L=J[3];break}for(let J=0;J<r;J++){const $=o[J];s?$.O.i($.O.x+$.lt.x-H,$.O.y+(i>135?(c?-L:-$.ut.height)+$.lt.y-f:P+f+$.lt.y)):$.O.i($.O.x+(i>135?(c?-k:-$.ut.width)+$.lt.x-f:M+f+$.lt.x),$.O.y+$.lt.y-W)}s?(k=this.oC(t,k,H),H<0&&(H=0),i>135&&(W+=L+f),L=Math.max(Math.max(L,P),L+P+f)):(i>135&&(H+=k+f),k=Math.max(Math.max(k,M),k+M+f),L=this.rC(t,L,W),W<0&&(W=0)),t.lt.i(H,W),t.ut.i(k,L)}customAlignment(t,i,s,n,o){return[i,s,n,o]}YD(t,i,s,n,o,r){const a=i.length;if(a===0)return new G(s,0,o,r);if(a===1){const x=i[0];return o=x.ut.width,r=x.ut.height,new G(s,0,o,r)}const h=t.nodeSpacing,l=t.rowSpacing,c=this.orthoAngle(t)===90;let d=0,f=0,m=0;for(let x=0;x<a;x++){if(x%2!==0||a>1&&x===a-1)continue;const b=i[x],M=b.ut,P=d===0?0:l;if(c){const k=this.computeBusNodeSpacing(b)-h;b.O.i(s-(M.width+k),m+P),o=Math.max(o,M.width+k),r=Math.max(r,m+P+M.height),m+=P+M.height}else{const k=this.computeBusNodeSpacing(b)-h;b.O.i(f+P,s-(M.height+k)),r=Math.max(r,M.height+k),o=Math.max(o,f+P+M.width),f+=P+M.width}d++}d=0;const p=f,y=m;c?(f=s+h,m=0):(f=0,m=s+h);for(let x=0;x<a;x++){if(x%2===0)continue;const b=i[x],M=b.ut,P=d===0?0:l;if(c){const k=this.computeBusNodeSpacing(b)-h;b.O.i(f+k,m+P),o=Math.max(o,f+M.width+k),r=Math.max(r,m+P+M.height),m+=P+M.height}else{const k=this.computeBusNodeSpacing(b)-h;b.O.i(f+P,m+k),o=Math.max(o,f+P+M.width),r=Math.max(r,m+M.height+k),f+=P+M.width}d++}if(a>1&&a%2===1){const x=i[a-1],b=x.ut,M=this.computeBusLastRowSpacing(x,c?Math.max(Math.abs(y),Math.abs(m)):Math.max(Math.abs(p),Math.abs(f)));if(c){x.O.i(s+h/2-x.focus.x-x.lt.x,r+M);const P=s+h/2-x.focus.x-x.lt.x;o=Math.max(o,P+b.width),P<0&&(o-=P),r=Math.max(r,Math.max(y,m)+M+b.height),x.O.x<0&&(s=this.xk(t,x.O.x,!1,s,h))}else{x.O.i(o+M,s+h/2-x.focus.y-x.lt.y),o=Math.max(o,Math.max(p,f)+M+b.width);const P=s+h/2-x.focus.y-x.lt.y;r=Math.max(r,P+b.height),P<0&&(r-=P),x.O.y<0&&(s=this.xk(t,x.O.y,!0,s,h))}}return new G(s,0,o,r)}GD(t,i,s,n,o,r){const a=i.length;if(a===0)return new G(s,0,o,r);if(a===1){const x=i[0];return o=x.ut.width,r=x.ut.height,new G(s,0,o,r)}const h=t.nodeSpacing,l=t.rowSpacing,c=this.orthoAngle(t)===270;let d=0,f=0,m=0;for(let x=0;x<a;x++){if(x%2!==0||a>1&&x===a-1)continue;const b=i[x],M=b.ut,P=d===0?0:l;if(c){const k=this.computeBusNodeSpacing(b)-h;m-=P+M.height,b.O.i(s-(M.width+k),m),o=Math.max(o,M.width+k),r=Math.max(r,Math.abs(m))}else{const k=this.computeBusNodeSpacing(b)-h;f-=P+M.width,b.O.i(f,s-(M.height+k)),r=Math.max(r,M.height+k),o=Math.max(o,Math.abs(f))}d++}d=0;const p=f,y=m;c?(f=s+h,m=0):(f=0,m=s+h);for(let x=0;x<a;x++){if(x%2===0)continue;const b=i[x],M=b.ut,P=d===0?0:l;if(c){const k=this.computeBusNodeSpacing(b)-h;m-=P+M.height,b.O.i(f+k,m),o=Math.max(o,f+M.width+k),r=Math.max(r,Math.abs(m))}else{const k=this.computeBusNodeSpacing(b)-h;f-=P+M.width,b.O.i(f,m+k),r=Math.max(r,m+M.height+k),o=Math.max(o,Math.abs(f))}d++}if(a>1&&a%2===1){const x=i[a-1],b=x.ut,M=this.computeBusLastRowSpacing(x,c?Math.max(Math.abs(y),Math.abs(m)):Math.max(Math.abs(p),Math.abs(f)));if(c){x.O.i(s+h/2-x.focus.x-x.lt.x,-r-b.height-M);const P=s+h/2-x.focus.x-x.lt.x;o=Math.max(o,P+b.width),P<0&&(o-=P),r=Math.max(r,Math.abs(Math.min(y,m))+M+b.height),x.O.x<0&&(s=this.xk(t,x.O.x,!1,s,h))}else{x.O.i(-o-b.width-M,s+h/2-x.focus.y-x.lt.y),o=Math.max(o,Math.abs(Math.min(p,f))+M+b.width);const P=s+h/2-x.focus.y-x.lt.y;r=Math.max(r,P+b.height),P<0&&(r-=P),x.O.y<0&&(s=this.xk(t,x.O.y,!0,s,h))}}for(let x=0;x<a;x++){const b=i[x];c?b.O.i(b.O.x,b.O.y+r):b.O.i(b.O.x+o,b.O.y)}return new G(s,0,o,r)}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return t.parent===null?0:t.parent.rowSpacing}xk(t,i,s,n,o){const r=t.children,a=r.length;for(let l=0;l<a;l++)s?r[l].O.i(r[l].O.x,r[l].O.y-i):r[l].O.i(r[l].O.x-i,r[l].O.y);const h=r[a-1];return Math.max(n,s?h.lt.y+h.focus.y-o/2:h.lt.x+h.focus.x-o/2)}oC(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.width>n&&(n=s+t.width),s<0&&(n-=s),n;case 22:return t.width>i?t.width:i;case 23:return t.focus.x*2>i?t.width:i+t.width-t.focus.x*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.width);return Math.max(t.width,r-o);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}rC(t,i,s){switch(t.alignment){case 21:case 20:let n=i;return s+t.height>n&&(n=s+t.height),s<0&&(n-=s),n;case 22:return t.height>i?t.height:i;case 23:return t.focus.y*2>i?t.height:i+t.height-t.focus.y*2;case 24:case 25:const o=Math.min(0,s),r=Math.max(i,s+t.height);return Math.max(t.height,r-o);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}lC(t,i,s){switch(t){case 20:i/=2,s/=2;break;case 21:i/=2,s/=2;break;case 22:i=0,s=0;break;case 23:break;default:u.o("Unhandled alignment value "+t.toString())}return new C(i,s)}ic(t,i,s,n,o,r){const a=this.lC(i,s,n);this.tu(t,a.x,a.y,o,r)}tu(t,i,s,n,o){if(i===0&&s===0)return;const r=t.children;for(let a=n;a<=o;a++){const h=r[a].O;h.x+=i,h.y+=s}}wk(t,i,s){const n=t.parent;switch(this.ls){case 1:{const o=t.sourceEdges;for(;o.next();){const r=o.value;r.fromVertex===n&&r.relativePoint.i(i,s)}break}case 2:{const o=t.destinationEdges;for(;o.next();){const r=o.value;r.toVertex===n&&r.relativePoint.i(i,s)}break}default:u.o("Unhandled path value "+this.ls.toString())}}iE(t){if(t.childrenCount===0){const ct=t.parent;let ft=!1,Ot=0,Et=21;ct!==null&&(Ot=ct.angle,Et=ct.alignment,ft=this.isBusAlignment(Et));const lt=this.nC(t);t.O.i(0,0),t.ut.i(t.width,t.height),t.parent!==null&&t.comments!==null&&((Ot===180||Ot===270)&&!ft||lt)?Ot===180&&!ft||(Ot===90||Ot===270)&&lt?t.lt.i(t.width-t.focus.x*2,0):t.lt.i(0,t.height-t.focus.y*2):t.lt.i(0,0),t.Cg=null,t.Lg=null;return}const i=this.orthoAngle(t),s=i===90||i===270;let n=0;const o=t.children,r=o.length;for(let ct=0;ct<r;ct++){const ft=o[ct];n=Math.max(n,s?ft.ut.width:ft.ut.height)}const a=t.alignment,h=a===22,l=a===23,c=this.isBusAlignment(a),d=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),m=t.nodeSpacing,p=this.computeNodeIndent(t),y=t.rowSpacing;let x=0;(h||l)&&(x=Math.max(0,t.rowIndent));const b=t.width,M=t.height;let P=0,k=0,L=0,T=null,D=null,B=0,E=0,R=0,F=0,V=0,K=0,H=0,W=0,J=0;if(c&&!this.$y(a)&&i>135&&o.reverse(),this.$y(a))if(r>1)for(let ct=0;ct<r;ct++)ct%2===0&&ct!==r-1?W=Math.max(W,s?o[ct].ut.width:o[ct].ut.height):ct%2!==0&&(J=Math.max(J,s?o[ct].ut.width:o[ct].ut.height));else r===1&&(W=s?o[0].ut.width:o[0].ut.height);if(c){switch(a){case 24:let ct;i<135?ct=this.YD(t,o,W,J,P,k):ct=this.GD(t,o,W,J,P,k),W=ct.x,P=ct.width,k=ct.height;break;case 26:for(let ft=0;ft<r;ft++){const Ot=o[ft],Et=Ot.ut,lt=K===0?0:y;s?(Ot.O.i(n-Et.width,F+lt),P=Math.max(P,Et.width),k=Math.max(k,F+lt+Et.height),F+=lt+Et.height):(Ot.O.i(R+lt,n-Et.height),P=Math.max(P,R+lt+Et.width),k=Math.max(k,Et.height),R+=lt+Et.width),K++}break;case 27:for(let ft=0;ft<r;ft++){const Ot=o[ft],Et=Ot.ut,lt=K===0?0:y;s?(Ot.O.i(m/2+t.focus.x,F+lt),P=Math.max(P,Et.width),k=Math.max(k,F+lt+Et.height),F+=lt+Et.height):(Ot.O.i(R+lt,m/2+t.focus.y),P=Math.max(P,R+lt+Et.width),k=Math.max(k,Et.height),R+=lt+Et.width),K++}break}T=this.ae(2),D=this.ae(2),s?(T[0].i(0,0),T[1].i(0,k),D[0].i(P,0),D[1].i(P,k)):(T[0].i(0,0),T[1].i(P,0),D[0].i(0,k),D[1].i(P,k))}else for(let ct=0;ct<r;ct++){const ft=o[ct],Ot=ft.ut;if(s){d>0&&K>0&&R+m+Ot.width>d&&(R<n&&this.ic(t,a,n-R,0,H,ct-1),V++,K=0,H=ct,L=k,R=0,F=i>135?-k-y:k+y),this.wk(ft,0,F);let Et=0;if(K===0)T=ft.Cg,D=ft.Lg,B=Ot.width,E=Ot.height,(T===null||D===null||i!==this.orthoAngle(ft))&&(T=this.ae(2),D=this.ae(2),T[0].i(0,0),T[1].i(0,E),D[0].i(B,0),D[1].i(B,E));else{const lt=u.et(),vt=this.KD(t,ft,T,D,B,E,lt);Et=vt.x,T=lt[0],D=lt[1],B=vt.width,E=vt.height,u.J(lt),R<Ot.width&&Et<0&&(this.tu(t,-Et,0,H,ct-1),this.bk(T,-Et,0),this.bk(D,-Et,0),Et=0)}ft.O.i(Et,F),P=Math.max(P,B),k=Math.max(k,L+(V===0?0:y)+Ot.height),R=B}else{d>0&&K>0&&F+m+Ot.height>d&&(F<n&&this.ic(t,a,0,n-F,H,ct-1),V++,K=0,H=ct,L=P,F=0,R=i>135?-P-y:P+y),this.wk(ft,R,0);let Et=0;if(K===0)T=ft.Cg,D=ft.Lg,B=Ot.width,E=Ot.height,(T===null||D===null||i!==this.orthoAngle(ft))&&(T=this.ae(2),D=this.ae(2),T[0].i(0,0),T[1].i(B,0),D[0].i(0,E),D[1].i(B,E));else{const lt=u.et(),vt=this.KD(t,ft,T,D,B,E,lt);Et=vt.x,T=lt[0],D=lt[1],B=vt.width,E=vt.height,u.J(lt),F<Ot.height&&Et<0&&(this.tu(t,0,-Et,H,ct-1),this.bk(T,0,-Et),this.bk(D,0,-Et),Et=0)}ft.O.i(R,Et),k=Math.max(k,E),P=Math.max(P,L+(V===0?0:y)+Ot.width),F=E}K++}V>0&&(s?(k+=Math.max(0,f),R<P&&this.ic(t,a,P-R,0,H,r-1),x>0&&(l||this.tu(t,x,0,0,r-1),P+=x)):(P+=Math.max(0,f),F<k&&this.ic(t,a,0,k-F,H,r-1),x>0&&(l||this.tu(t,0,x,0,r-1),k+=x)));let $=0,et=0;switch(a){case 20:s?$+=P/2-t.focus.x-p/2:et+=k/2-t.focus.y-p/2;break;default:case 21:if(V>0)s?$+=P/2-t.focus.x-p/2:et+=k/2-t.focus.y-p/2;else{const ft=r;if(s){const Ot=o[0].O.x+o[0].lt.x,Et=o[ft-1].O.x+o[ft-1].lt.x+o[ft-1].focus.x*2;$+=Ot+(Et-Ot)/2-t.focus.x-p/2}else{const Ot=o[0].O.y+o[0].lt.y,Et=o[ft-1].O.y+o[ft-1].lt.y+o[ft-1].focus.y*2;et+=Ot+(Et-Ot)/2-t.focus.y-p/2}}break;case 22:s?($-=p,P+=p):(et-=p,k+=p);break;case 23:s?($+=P-t.width+p,P+=p):(et+=k-t.height+p,k+=p);break;case 24:s?r>1?$+=W+m/2-t.focus.x:$+=o[0].focus.x-t.focus.x+o[0].lt.x:r>1?et+=W+m/2-t.focus.y:et+=o[0].focus.y-t.focus.y+o[0].lt.y;break;case 26:s?$+=P+m/2-t.focus.x:et+=k+m/2-t.focus.y;break;case 27:break;case 28:const ct=this.customAlignment(t,$,et,P,k);$=ct[0],et=ct[1],P=ct[2],k=ct[3];break}for(let ct=0;ct<r;ct++){const ft=o[ct];s?ft.O.i(ft.O.x+ft.lt.x-$,ft.O.y+(i>135?(c?-k:-ft.ut.height)+ft.lt.y-f:M+f+ft.lt.y)):ft.O.i(ft.O.x+(i>135?(c?-P:-ft.ut.width)+ft.lt.x-f:b+f+ft.lt.x),ft.O.y+ft.lt.y-et)}let ot=0,Ct=0;if(c)s?(P=this.oC(t,P,$),$<0&&($=0),i>135&&(et+=k+f),k+=M+f,a===27&&(ot+=m/2+t.focus.x),Ct+=M+f):(i>135&&($+=P+f),P+=b+f,k=this.rC(t,k,et),et<0&&(et=0),a===27&&(Ct+=m/2+t.focus.y),ot+=b+f);else if(s){if(t.comments===null){if(b>P){const ct=this.lC(a,b-P,0);ot=ct.x,Ct=ct.y,P=b,$=0}}else P=this.oC(t,P,$);$<0&&(ot-=$,$=0),i>135&&(et+=k+f),k=Math.max(Math.max(k,M),k+M+f),Ct+=M+f}else{if(i>135&&($+=P+f),P=Math.max(Math.max(P,b),P+b+f),t.comments===null){if(M>k){const ct=this.lC(a,0,M-k);ot=ct.x,Ct=ct.y,k=M,et=0}}else k=this.rC(t,k,et);et<0&&(Ct-=et,et=0),ot+=b+f}let ht,dt;if(V>0)ht=this.ae(4),dt=this.ae(4),s?(ht[2].i(0,M+f),ht[3].i(ht[2].x,k),dt[2].i(P,ht[2].y),dt[3].i(dt[2].x,ht[3].y)):(ht[2].i(b+f,0),ht[3].i(P,ht[2].y),dt[2].i(ht[2].x,k),dt[3].i(ht[3].x,dt[2].y));else{ht=this.ae(T.length+2),dt=this.ae(D.length+2);for(let ct=0;ct<T.length;ct++){const ft=T[ct];ht[ct+2].i(ft.x+ot,ft.y+Ct)}for(let ct=0;ct<D.length;ct++){const ft=D[ct];dt[ct+2].i(ft.x+ot,ft.y+Ct)}}s?(ht[0].i($,0),ht[1].i(ht[0].x,M),ht[2].y<ht[1].y&&(ht[2].x>ht[0].x?ht[2].a(ht[1]):ht[1].a(ht[2])),ht[3].y<ht[2].y&&(ht[3].x>ht[0].x?ht[3].a(ht[2]):ht[2].a(ht[3])),dt[0].i($+b,0),dt[1].i(dt[0].x,M),dt[2].y<dt[1].y&&(dt[2].x<dt[0].x?dt[2].a(dt[1]):dt[1].a(dt[2])),dt[3].y<dt[2].y&&(dt[3].x<dt[0].x?dt[3].a(dt[2]):dt[2].a(dt[3])),ht[2].y-=f/2,dt[2].y-=f/2):(ht[0].i(0,et),ht[1].i(b,ht[0].y),ht[2].x<ht[1].x&&(ht[2].y>ht[0].y?ht[2].a(ht[1]):ht[1].a(ht[2])),ht[3].x<ht[2].x&&(ht[3].y>ht[0].y?ht[3].a(ht[2]):ht[2].a(ht[3])),dt[0].i(0,et+M),dt[1].i(b,dt[0].y),dt[2].x<dt[1].x&&(dt[2].y<dt[0].y?dt[2].a(dt[1]):dt[1].a(dt[2])),dt[3].x<dt[2].x&&(dt[3].y<dt[0].y?dt[3].a(dt[2]):dt[2].a(dt[3])),ht[2].x-=f/2,dt[2].x-=f/2),this._s(T),this._s(D),t.Cg=ht,t.Lg=dt,t.lt.i($,et),t.ut.i(P,k)}bk(t,i,s){for(let n=0;n<t.length;n++){const o=t[n];o.x+=i,o.y+=s}}KD(t,i,s,n,o,r,a){const h=this.orthoAngle(t),l=h===90||h===270,c=t.nodeSpacing,d=s,f=n,m=o,p=r;let y=i.Cg,x=i.Lg;const b=i.ut,M=l?Math.max(p,b.height):Math.max(m,b.width);if((y===null||h!==this.orthoAngle(i))&&(y=this.ae(2),x=this.ae(2),l?(y[0].i(0,0),y[1].i(0,b.height),x[0].i(b.width,0),x[1].i(x[0].x,y[1].y)):(y[0].i(0,0),y[1].i(b.width,0),x[0].i(0,b.height),x[1].i(y[1].x,x[0].y))),l){const P=m;let k=P-this.eE(f,y,P);return k+=c,s=this.sE(d,y,k),n=this.nE(f,x,k),o=Math.max(0,k)+b.width,r=M,this._s(d),this._s(y),this._s(f),this._s(x),a[0]=s,a[1]=n,new G(k,0,o,r)}else{const P=p;let k=P-this.oE(f,y,P);return k+=c,s=this.rE(d,y,k),n=this.lE(f,x,k),o=M,r=Math.max(0,k)+b.height,this._s(d),this._s(y),this._s(f),this._s(x),a[0]=s,a[1]=n,new G(k,0,o,r)}}rE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].x<t[0].x;){const c=i[r++];n[a++].i(c.x,c.y+s)}for(;o<t.length;){const c=t[o++];n[a++].i(c.x,c.y)}const h=t[t.length-1].x;for(;r<i.length&&i[r].x<=h;)r++;for(;r<i.length&&i[r].x>h;){const c=i[r++];n[a++].i(c.x,c.y+s)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this._s(n),l}sE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;r<i.length&&i[r].y<t[0].y;){const c=i[r++];n[a++].i(c.x+s,c.y)}for(;o<t.length;){const c=t[o++];n[a++].i(c.x,c.y)}const h=t[t.length-1].y;for(;r<i.length&&i[r].y<=h;)r++;for(;r<i.length&&i[r].y>h;){const c=i[r++];n[a++].i(c.x+s,c.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this._s(n),l}lE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].x<i[0].x;){const c=t[o++];n[a++].i(c.x,c.y)}for(;r<i.length;){const c=i[r++];n[a++].i(c.x,c.y+s)}const h=i[i.length-1].x;for(;o<t.length&&t[o].x<=h;)o++;for(;o<t.length&&t[o].x>h;){const c=t[o++];n[a++].i(c.x,c.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this._s(n),l}nE(t,i,s){if(t===null||t.length<2||i===null||i.length<2)return null;const n=this.ae(t.length+i.length);let o=0,r=0,a=0;for(;o<t.length&&t[o].y<i[0].y;){const c=t[o++];n[a++].i(c.x,c.y)}for(;r<i.length;){const c=i[r++];n[a++].i(c.x+s,c.y)}const h=i[i.length-1].y;for(;o<t.length&&t[o].y<=h;)o++;for(;o<t.length&&t[o].y>h;){const c=t[o++];n[a++].i(c.x,c.y)}const l=this.ae(a);for(o=0;o<a;o++)l[o].a(n[o]);return this._s(n),l}oE(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],h=i[r],l=h.x;let c=h.y;c+=s;let d=a;o+1<t.length&&(d=t[o+1]);let f=h,m=f.x,p=f.y;r+1<i.length&&(f=i[r+1],m=f.x,p=f.y,p+=s);let y=n;a.x===l?y=c-a.y:a.x>l&&a.x<m?y=c+(a.x-l)/(m-l)*(p-c)-a.y:l>a.x&&l<d.x&&(y=c-(a.y+(l-a.x)/(d.x-a.x)*(d.y-a.y))),y<n&&(n=y),d.x<=a.x?o++:m<=l?r++:(d.x<=m&&o++,m<=d.x&&r++)}return n}eE(t,i,s){let n=9999999;if(t===null||t.length<2||i===null||i.length<2)return n;let o=0,r=0;for(;o<t.length&&r<i.length;){const a=t[o],h=i[r];let l=h.x;const c=h.y;l+=s;let d=a;o+1<t.length&&(d=t[o+1]);let f=h,m=f.x,p=f.y;r+1<i.length&&(f=i[r+1],m=f.x,p=f.y,m+=s);let y=n;a.y===c?y=l-a.x:a.y>c&&a.y<p?y=l+(a.y-c)/(p-c)*(m-l)-a.x:c>a.y&&c<d.y&&(y=l-(a.x+(c-a.y)/(d.y-a.y)*(d.x-a.x))),y<n&&(n=y),d.y<=a.y?o++:p<=c?r++:(d.y<=p&&o++,p<=d.y&&r++)}return n}ae(t){const i=this.yk[t];if(i!==void 0){const n=i.pop();if(n!==void 0)return n}const s=[];for(let n=0;n<t;n++)s[n]=new C;return s}_s(t){if(!t)return;const i=t.length;let s=this.yk[i];s===void 0&&(s=[],this.yk[i]=s),s.push(t)}arrangeTrees(){if(this.Xi===52){const t=this.Fi.iterator;for(;t.next();){const i=t.value;if(!(i instanceof ui))continue;const s=i.node;if(s===null)continue;const n=s.position;let o=n.x,r=n.y;isFinite(o)||(o=0),isFinite(r)||(r=0),this.hC(i,o,r)}}else{const t=[],i=this.Fi.iterator;for(;i.next();){const r=i.value;r instanceof ui&&t.push(r)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const s=this.arrangementOrigin;let n=s.x,o=s.y;for(let r=0;r<t.length;r++){const a=t[r];switch(this.hC(a,n+a.lt.x,o+a.lt.y),this.Xi){case 50:o+=a.ut.height+this.Ms.height;break;default:case 51:n+=a.ut.width+this.Ms.width;break}}}}hC(t,i,s){if(t===null)return;t.x=i,t.y=s;const n=t.children,o=n.length;for(let r=0;r<o;r++){const a=n[r];this.hC(a,i+a.O.x,s+a.O.y)}}commitLayout(){this.Xy(),this.commitNodes(),this.iC(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const i=t.value;this.layoutComments(i)}}iC(){if(this.layerStyle!==62)return;const t=this.eC,i=[];let s=null;const n=this.network.vertexes.iterator;for(;n.next();){const l=n.value;s===null?s=l.bounds.copy():s.unionRect(l.bounds);let c=i[l.level];c===void 0?c=this.computeLayerSpacing(l):c=Math.max(c,this.computeLayerSpacing(l)),i[l.level]=c}for(let l=0;l<i.length;l++)i[l]===void 0&&(i[l]=0);let o;this.angle===90||this.angle===270?(s.inflate(this.nodeSpacing/2,this.layerSpacing),o=new C(-this.nodeSpacing/2,-this.layerSpacing/2)):(s.inflate(this.layerSpacing,this.nodeSpacing/2),o=new C(-this.layerSpacing/2,-this.nodeSpacing/2));const r=[],a=this.angle===90||this.angle===270?s.width:s.height;let h=0;if(this.angle===180||this.angle===270)for(let l=0;l<t.length;l++)h+=t[l]+i[l];for(let l=0;l<t.length;l++){const c=t[l]+i[l];this.angle===270?(h-=c,r.push(new G(0,h,a,c))):this.angle===90?(r.push(new G(0,h,a,c)),h+=c):this.angle===180?(h-=c,r.push(new G(h,0,c,a))):(r.push(new G(h,0,c,a)),h+=c)}this.commitLayers(r,o)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Xy(){const t=this.Fi.iterator;for(;t.next();){const i=t.value;i instanceof ui&&this.jD(i)}}jD(t){if(t===null)return;this.setPortSpots(t);const i=t.children,s=i.length;for(let n=0;n<s;n++){const o=i[n];this.jD(o)}}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.hE(t,i);else{const s=this.orthoAngle(t);if(this.ls===1){const n=t.destinationEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.fromSpot=U.MiddleRight;break;case 90:o.fromSpot=U.MiddleBottom;break;case 180:o.fromSpot=U.MiddleLeft;break;default:o.fromSpot=U.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.toSpot=U.MiddleLeft;break;case 90:o.toSpot=U.MiddleTop;break;case 180:o.toSpot=U.MiddleRight;break;default:o.toSpot=U.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const n=t.sourceEdges;for(;n.next();){const o=n.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(s){case 0:o.toSpot=U.MiddleRight;break;case 90:o.toSpot=U.MiddleBottom;break;case 180:o.toSpot=U.MiddleLeft;break;default:o.toSpot=U.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(s){case 0:o.fromSpot=U.MiddleLeft;break;case 90:o.fromSpot=U.MiddleTop;break;case 180:o.fromSpot=U.MiddleRight;break;default:o.fromSpot=U.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}hE(t,i){const s=this.ls===1,n=this.orthoAngle(t);let o;switch(n){case 0:o=U.MiddleRight;break;case 90:o=U.MiddleBottom;break;case 180:o=U.MiddleLeft;break;default:o=U.MiddleTop;break}const r=t.children,a=r.length;switch(i){case 24:case 25:{for(let h=0;h<a;h++){const l=r[h],c=(s?l.sourceEdges:l.destinationEdges).first();if(c===null)continue;const d=c.link;if(d!==null){let f=n===90||n===270?U.MiddleLeft:U.MiddleTop;if(a===1||h===a-1&&a%2===1)switch(n){case 0:f=U.MiddleLeft;break;case 90:f=U.MiddleTop;break;case 180:f=U.MiddleRight;break;default:f=U.MiddleBottom;break}else h%2===0&&(f=n===90||n===270?U.MiddleRight:U.MiddleBottom);s?(t.setsPortSpot&&(d.fromSpot=o),t.setsChildPortSpot&&(d.toSpot=f)):(t.setsPortSpot&&(d.fromSpot=f),t.setsChildPortSpot&&(d.toSpot=o))}}break}case 26:{const h=n===90||n===270?U.MiddleRight:U.MiddleBottom,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const c=l.value.link;c!==null&&(s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=h)):(t.setsPortSpot&&(c.fromSpot=h),t.setsChildPortSpot&&(c.toSpot=o)))}break}case 27:{const h=n===90||n===270?U.MiddleLeft:U.MiddleTop,l=s?t.destinationEdges:t.sourceEdges;for(;l.next();){const c=l.value.link;c!==null&&(s?(t.setsPortSpot&&(c.fromSpot=o),t.setsChildPortSpot&&(c.toSpot=h)):(t.setsPortSpot&&(c.fromSpot=h),t.setsChildPortSpot&&(c.toSpot=o)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const o=Math.min(1,t.layerSpacingParentOverlap);n-=s?t.height*o:t.width*o}return n<(s?-t.height:-t.width)&&(n=s?-t.height:-t.width),n}computeNodeIndent(t){const i=this.orthoAngle(t),s=i===90||i===270;let n=t.nodeIndent;if(t.nodeIndentPastParent>0){const o=Math.min(1,t.nodeIndentPastParent);n+=s?t.width*o:t.height*o}return n=Math.max(0,n),n}get roots(){return this.Fi}set roots(t){this.Fi!==t&&(this.Fi=t,this.invalidateLayout())}get path(){return this.Li}set path(t){this.Li!==t&&(this.Li=t,this.invalidateLayout())}get treeStyle(){return this._f}set treeStyle(t){this._f!==t&&(t===40||t===42||t===41||t===43)&&(this._f=t,this.invalidateLayout())}get layerStyle(){return this.Ng}set layerStyle(t){this.Ng!==t&&(t===60||t===61||t===62)&&(this.Ng=t,this.invalidateLayout())}get comments(){return this.Fe}set comments(t){this.Fe!==t&&(this.Fe=t,this.invalidateLayout())}get arrangement(){return this.Xi}set arrangement(t){this.Xi!==t&&(t===50||t===51||t===52)&&(this.Xi=t,this.invalidateLayout())}get arrangementSpacing(){return this.Ms}set arrangementSpacing(t){this.Ms.equals(t)||(this.Ms.a(t),this.invalidateLayout())}get rootDefaults(){return this.U}set rootDefaults(t){this.U!==t&&(this.U=t,this.invalidateLayout())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.invalidateLayout())}get sorting(){return this.U.sorting}set sorting(t){this.U.sorting!==t&&(this.U.sorting=t,this.invalidateLayout())}get comparer(){return this.U.comparer}set comparer(t){this.U.comparer!==t&&(this.U.comparer=t,this.invalidateLayout())}get angle(){return this.U.angle}set angle(t){this.U.angle!==t&&(t===0||t===90||t===180||t===270?(this.U.angle=t,this.invalidateLayout()):u.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.U.alignment}set alignment(t){this.U.alignment!==t&&(this.U.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.U.nodeIndent}set nodeIndent(t){this.U.nodeIndent!==t&&t>=0&&(this.U.nodeIndent=t,this.invalidateLayout())}get nodeIndentPastParent(){return this.U.nodeIndentPastParent}set nodeIndentPastParent(t){this.U.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.U.nodeIndentPastParent=t,this.invalidateLayout())}get nodeSpacing(){return this.U.nodeSpacing}set nodeSpacing(t){this.U.nodeSpacing!==t&&(this.U.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.U.layerSpacing}set layerSpacing(t){this.U.layerSpacing!==t&&(this.U.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.U.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.U.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.U.layerSpacingParentOverlap=t,this.invalidateLayout())}get compaction(){return this.U.compaction}set compaction(t){this.U.compaction!==t&&(t===30||t===31)&&(this.U.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.U.breadthLimit}set breadthLimit(t){this.U.breadthLimit!==t&&t>=0&&(this.U.breadthLimit=t,this.invalidateLayout())}get rowSpacing(){return this.U.rowSpacing}set rowSpacing(t){this.U.rowSpacing!==t&&(this.U.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.U.rowIndent}set rowIndent(t){this.U.rowIndent!==t&&t>=0&&(this.U.rowIndent=t,this.invalidateLayout())}get commentSpacing(){return this.U.commentSpacing}set commentSpacing(t){this.U.commentSpacing!==t&&(this.U.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.U.commentMargin}set commentMargin(t){this.U.commentMargin!==t&&(this.U.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.U.setsPortSpot}set setsPortSpot(t){this.U.setsPortSpot!==t&&(this.U.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.U.portSpot}set portSpot(t){this.U.portSpot.equals(t)||(this.U.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.U.setsChildPortSpot}set setsChildPortSpot(t){this.U.setsChildPortSpot!==t&&(this.U.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.U.childPortSpot}set childPortSpot(t){this.U.childPortSpot.equals(t)||(this.U.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(this.B.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(t===0||t===90||t===180||t===270)&&(this.B.angle=t,this.invalidateLayout())}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&t>=0&&(this.B.nodeIndent=t,this.invalidateLayout())}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.invalidateLayout())}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(this.B.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(this.B.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.invalidateLayout())}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(t===30||t===31)&&(this.B.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&t>=0&&(this.B.breadthLimit=t,this.invalidateLayout())}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(this.B.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&t>=0&&(this.B.rowIndent=t,this.invalidateLayout())}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(this.B.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(this.B.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(this.B.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(this.B.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.invalidateLayout())}}g(se,"PathDefault",0),g(se,"PathDestination",1),g(se,"PathSource",2),g(se,"SortingForwards",10),g(se,"SortingReverse",11),g(se,"SortingAscending",12),g(se,"SortingDescending",13),g(se,"AlignmentCenterSubtrees",20),g(se,"AlignmentCenterChildren",21),g(se,"AlignmentStart",22),g(se,"AlignmentEnd",23),g(se,"AlignmentBus",24),g(se,"AlignmentBusBranching",25),g(se,"AlignmentTopLeftBus",26),g(se,"AlignmentBottomRightBus",27),g(se,"CompactionNone",30),g(se,"CompactionBlock",31),g(se,"StyleLayered",40),g(se,"StyleLastParents",41),g(se,"StyleAlternating",42),g(se,"StyleRootOnly",43),g(se,"ArrangementVertical",50),g(se,"ArrangementHorizontal",51),g(se,"ArrangementFixedRoots",52),g(se,"LayerIndividual",60),g(se,"LayerSiblings",61),g(se,"LayerUniform",62);class or extends _i{constructor(e){super(e)}createVertex(){return new ui(this)}createEdge(){return new Ta(this)}}class ui extends Zi{constructor(t){super(t);g(this,"O");g(this,"ut");g(this,"lt");g(this,"kk");g(this,"Pk");g(this,"Sk");g(this,"Mk");g(this,"Nk");g(this,"Ck");g(this,"Lk");g(this,"Fe");g(this,"Cg");g(this,"Lg");g(this,"pe");g(this,"ye");g(this,"Yt");g(this,"hi");g(this,"Zy");g(this,"Qy");g(this,"_y");g(this,"Ns");g(this,"tw");g(this,"iw");g(this,"ew");g(this,"nw");g(this,"ow");g(this,"lw");g(this,"hw");g(this,"aw");g(this,"cw");g(this,"fw");g(this,"uw");this.kk=!1,this.Pk=null,this.Sk=[],this.Mk=0,this.Nk=0,this.Ck=0,this.Lk=0,this.Fe=null,this.O=new C(0,0),this.ut=new rt(0,0),this.lt=new C(0,0),this.Cg=null,this.Lg=null,this.pe=10,this.ye=Zi.standardComparer,this.Yt=0,this.hi=21,this.Zy=0,this.Qy=0,this._y=20,this.Ns=50,this.tw=0,this.iw=31,this.ew=0,this.nw=25,this.ow=10,this.lw=10,this.hw=20,this.aw=!0,this.cw=U.Default,this.fw=!0,this.uw=U.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.pe=t.sorting,this.ye=t.comparer,this.Yt=t.angle,this.hi=t.alignment,this.Zy=t.nodeIndent,this.Qy=t.nodeIndentPastParent,this._y=t.nodeSpacing,this.Ns=t.layerSpacing,this.tw=t.layerSpacingParentOverlap,this.iw=t.compaction,this.ew=t.breadthLimit,this.nw=t.rowSpacing,this.ow=t.rowIndent,this.lw=t.commentSpacing,this.hw=t.commentMargin,this.aw=t.setsPortSpot,this.cw=t.portSpot,this.fw=t.setsChildPortSpot,this.uw=t.childPortSpot)}get initialized(){return this.kk}set initialized(t){this.kk!==t&&(this.kk=t)}get parent(){return this.Pk}set parent(t){this.Pk!==t&&(this.Pk=t)}get children(){return this.Sk}set children(t){if(this.Sk!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Sk=t}}get level(){return this.Mk}set level(t){this.Mk!==t&&(this.Mk=t)}get descendantCount(){return this.Nk}set descendantCount(t){this.Nk!==t&&(this.Nk=t)}get maxChildrenCount(){return this.Ck}set maxChildrenCount(t){this.Ck!==t&&(this.Ck=t)}get maxGenerationCount(){return this.Lk}set maxGenerationCount(t){this.Lk!==t&&(this.Lk=t)}get comments(){return this.Fe}set comments(t){if(this.Fe!==t){if(t!==null){const i=t.length;for(let s=0;s<i;s++)t[s]}this.Fe=t}}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t)}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(this.ye=t)}get angle(){return this.Yt}set angle(t){this.Yt!==t&&(this.Yt=t)}get alignment(){return this.hi}set alignment(t){this.hi!==t&&(this.hi=t)}get nodeIndent(){return this.Zy}set nodeIndent(t){this.Zy!==t&&(this.Zy=t)}get nodeIndentPastParent(){return this.Qy}set nodeIndentPastParent(t){this.Qy!==t&&(this.Qy=t)}get nodeSpacing(){return this._y}set nodeSpacing(t){this._y!==t&&(this._y=t)}get layerSpacing(){return this.Ns}set layerSpacing(t){this.Ns!==t&&(this.Ns=t)}get layerSpacingParentOverlap(){return this.tw}set layerSpacingParentOverlap(t){this.tw!==t&&(this.tw=t)}get compaction(){return this.iw}set compaction(t){this.iw!==t&&(this.iw=t)}get breadthLimit(){return this.ew}set breadthLimit(t){this.ew!==t&&(this.ew=t)}get rowSpacing(){return this.nw}set rowSpacing(t){this.nw!==t&&(this.nw=t)}get rowIndent(){return this.ow}set rowIndent(t){this.ow!==t&&(this.ow=t)}get commentSpacing(){return this.lw}set commentSpacing(t){this.lw!==t&&(this.lw=t)}get commentMargin(){return this.hw}set commentMargin(t){this.hw!==t&&(this.hw=t)}get setsPortSpot(){return this.aw}set setsPortSpot(t){this.aw!==t&&(this.aw=t)}get portSpot(){return this.cw}set portSpot(t){this.cw.equals(t)||(this.cw=t)}get setsChildPortSpot(){return this.fw}set setsChildPortSpot(t){this.fw!==t&&(this.fw=t)}get childPortSpot(){return this.uw}set childPortSpot(t){this.uw.equals(t)||(this.uw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.O}set relativePosition(t){this.O.set(t)}get subtreeSize(){return this.ut}set subtreeSize(t){this.ut.set(t)}get subtreeOffset(){return this.lt}set subtreeOffset(t){this.lt.set(t)}}class Ta extends Ds{constructor(t){super(t);g(this,"Ak");this.Ak=new C(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const i=this.network.layout;let s=null,n=null;switch(i.ls){case 1:s=this.fromVertex,n=this.toVertex;break;case 2:s=this.toVertex,n=this.fromVertex;break;default:u.o("Unhandled path value "+i.ls.toString())}if(s===null||n===null)return;const o=this.Ak;if(o.x===0&&o.y===0){this.aE(s,n);return}const r=s.bounds,a=i.orthoAngle(s),h=i.computeLayerSpacing(s),l=s.rowSpacing;t.updateRoute();const c=t.curve===9,d=t.isOrthogonal;let f=0,m,p;if(t.startRoute(),d||c){for(f=2;t.pointsCount>4;)t.removePoint(2);m=t.getPoint(1),p=t.getPoint(2)}else{for(f=1;t.pointsCount>3;)t.removePoint(1);m=t.getPoint(0),p=t.getPoint(t.pointsCount-1)}const y=t.getPoint(t.pointsCount-1);let x=0;a===0?(s.alignment===23?(x=r.bottom+o.y,o.y===0&&m.y>y.y+s.rowIndent&&(x=Math.min(x,Math.max(m.y,x-i.computeNodeIndent(s))))):s.alignment===22?(x=r.top+o.y,o.y===0&&m.y<y.y-s.rowIndent&&(x=Math.max(x,Math.min(m.y,x+i.computeNodeIndent(s))))):x=r.y+r.height/2+o.y,c?(t.insertPointAt(f,m.x,x),f++,t.insertPointAt(f,r.right+h,x),f++,t.insertPointAt(f,r.right+h+(o.x-l)/3,x),f++,t.insertPointAt(f,r.right+h+(o.x-l)*2/3,x),f++,t.insertPointAt(f,r.right+h+(o.x-l),x),f++,t.insertPointAt(f,p.x,x),f++):(d&&(t.insertPointAt(f,r.right+h/2,m.y),f++),t.insertPointAt(f,r.right+h/2,x),f++,t.insertPointAt(f,r.right+h+o.x-(d?l/2:l),x),f++,d&&(t.insertPointAt(f,t.getPoint(f-1).x,p.y),f++))):a===90?(s.alignment===23?(x=r.right+o.x,o.x===0&&m.x>y.x+s.rowIndent&&(x=Math.min(x,Math.max(m.x,x-i.computeNodeIndent(s))))):s.alignment===22?(x=r.left+o.x,o.x===0&&m.x<y.x-s.rowIndent&&(x=Math.max(x,Math.min(m.x,x+i.computeNodeIndent(s))))):x=r.x+r.width/2+o.x,c?(t.insertPointAt(f,x,m.y),f++,t.insertPointAt(f,x,r.bottom+h),f++,t.insertPointAt(f,x,r.bottom+h+(o.y-l)/3),f++,t.insertPointAt(f,x,r.bottom+h+(o.y-l)*2/3),f++,t.insertPointAt(f,x,r.bottom+h+(o.y-l)),f++,t.insertPointAt(f,x,p.y),f++):(d&&(t.insertPointAt(f,m.x,r.bottom+h/2),f++),t.insertPointAt(f,x,r.bottom+h/2),f++,t.insertPointAt(f,x,r.bottom+h+o.y-(d?l/2:l)),f++,d&&(t.insertPointAt(f,p.x,t.getPoint(f-1).y),f++))):a===180?(s.alignment===23?(x=r.bottom+o.y,o.y===0&&m.y>y.y+s.rowIndent&&(x=Math.min(x,Math.max(m.y,x-i.computeNodeIndent(s))))):s.alignment===22?(x=r.top+o.y,o.y===0&&m.y<y.y-s.rowIndent&&(x=Math.max(x,Math.min(m.y,x+i.computeNodeIndent(s))))):x=r.y+r.height/2+o.y,c?(t.insertPointAt(f,m.x,x),f++,t.insertPointAt(f,r.left-h,x),f++,t.insertPointAt(f,r.left-h+(o.x+l)/3,x),f++,t.insertPointAt(f,r.left-h+(o.x+l)*2/3,x),f++,t.insertPointAt(f,r.left-h+(o.x+l),x),f++,t.insertPointAt(f,p.x,x),f++):(d&&(t.insertPointAt(f,r.left-h/2,m.y),f++),t.insertPointAt(f,r.left-h/2,x),f++,t.insertPointAt(f,r.left-h+o.x+(d?l/2:l),x),f++,d&&(t.insertPointAt(f,t.getPoint(f-1).x,p.y),f++))):a===270?(s.alignment===23?(x=r.right+o.x,o.x===0&&m.x>y.x+s.rowIndent&&(x=Math.min(x,Math.max(m.x,x-i.computeNodeIndent(s))))):s.alignment===22?(x=r.left+o.x,o.x===0&&m.x<y.x-s.rowIndent&&(x=Math.max(x,Math.min(m.x,x+i.computeNodeIndent(s))))):x=r.x+r.width/2+o.x,c?(t.insertPointAt(f,x,m.y),f++,t.insertPointAt(f,x,r.top-h),f++,t.insertPointAt(f,x,r.top-h+(o.y+l)/3),f++,t.insertPointAt(f,x,r.top-h+(o.y+l)*2/3),f++,t.insertPointAt(f,x,r.top-h+(o.y+l)),f++,t.insertPointAt(f,x,p.y),f++):(d&&(t.insertPointAt(f,m.x,r.top-h/2),f++),t.insertPointAt(f,x,r.top-h/2),f++,t.insertPointAt(f,x,r.top-h+o.y+(d?l/2:l)),f++,d&&(t.insertPointAt(f,p.x,t.getPoint(f-1).y),f++))):u.o("Invalid angle "+a),t.commitRoute()}aE(t,i){const s=this.link;if(s===null)return;const n=this.network.layout,o=n.orthoAngle(t),r=n.orthoAngle(i);if(o===r)return;const a=n.computeLayerSpacing(t),h=t.bounds,l=i.bounds;if(o===0&&l.left-h.right<a+1||o===90&&l.top-h.bottom<a+1||o===180&&h.left-l.right<a+1||o===270&&h.top-l.bottom<a+1)return;s.updateRoute();const c=s.curve===9,d=s.isOrthogonal,f=this.fromVertex,m=n.isBusAlignment(f.alignment);if(s.startRoute(),o===0){const p=h.right+a/2;if(c){if(s.pointsCount===4){const y=s.getPoint(3).y;s.setPointAt(1,p-20,s.getPoint(1).y),s.insertPointAt(2,p-20,y),s.insertPointAt(3,p,y),s.insertPointAt(4,p+20,y),s.setPointAt(5,s.getPoint(5).x,y)}}else d?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,p,s.getPoint(2).y),s.setPointAt(3,p,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,p,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,p,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,p,s.getPoint(1).y)}else if(o===90){const p=h.bottom+a/2;if(c){if(s.pointsCount===4){const y=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,p-20),s.insertPointAt(2,y,p-20),s.insertPointAt(3,y,p),s.insertPointAt(4,y,p+20),s.setPointAt(5,y,s.getPoint(5).y)}}else d?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,p),s.setPointAt(3,s.getPoint(3).x,p)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,p):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,p):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,p)}else if(o===180){const p=h.left-a/2;if(c){if(s.pointsCount===4){const y=s.getPoint(3).y;s.setPointAt(1,p+20,s.getPoint(1).y),s.insertPointAt(2,p+20,y),s.insertPointAt(3,p,y),s.insertPointAt(4,p-20,y),s.setPointAt(5,s.getPoint(5).x,y)}}else d?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,p,s.getPoint(2).y),s.setPointAt(3,p,s.getPoint(3).y)):s.pointsCount===4?s.insertPointAt(2,p,s.getPoint(2).y):s.pointsCount===3?s.setPointAt(1,p,s.getPoint(2).y):s.pointsCount===2&&s.insertPointAt(1,p,s.getPoint(1).y)}else if(o===270){const p=h.top-a/2;if(c){if(s.pointsCount===4){const y=s.getPoint(3).x;s.setPointAt(1,s.getPoint(1).x,p+20),s.insertPointAt(2,y,p+20),s.insertPointAt(3,y,p),s.insertPointAt(4,y,p-20),s.setPointAt(5,y,s.getPoint(5).y)}}else d?m?s.setPointAt(3,s.getPoint(2).x,s.getPoint(4).y):s.pointsCount===6&&(s.setPointAt(2,s.getPoint(2).x,p),s.setPointAt(3,s.getPoint(3).x,p)):s.pointsCount===4?s.insertPointAt(2,s.getPoint(2).x,p):s.pointsCount===3?s.setPointAt(1,s.getPoint(2).x,p):s.pointsCount===2&&s.insertPointAt(1,s.getPoint(1).x,p)}s.commitRoute()}get fromVertex(){return this.He}set fromVertex(t){this.He!==t&&(this.He=t)}get toVertex(){return this.qe}set toVertex(t){this.qe!==t&&(this.qe=t)}get relativePoint(){return this.Ak}set relativePoint(t){this.Ak.set(t)}}class ni{constructor(){}}g(ni,"Light",{colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new wt(5)},arrowheads:{toArrow:"Standard"}}),g(ni,"Dark",{colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new wt(5)},arrowheads:{toArrow:"Standard"}});const Is=class Is{constructor(e){g(this,"ts",new Set);g(this,"iu",new Z);g(this,"Tk","light");g(this,"Dk","light");g(this,"Fk",!1);g(this,"Ag","light");g(this,"HD",e=>{const t=e.matches?"dark":"light";t!==this.Ag&&(this.Ag=t,this.Dk==="system"&&this.dw())});e&&Object.assign(this,e),e!=null&&e.themeMap||(this.iu.set("light",{colors:{...ni.Light.colors},fonts:{...ni.Light.fonts},numbers:{...ni.Light.numbers},margins:{...ni.Light.margins},arrowheads:{...ni.Light.arrowheads}}),this.iu.set("dark",{colors:{...ni.Dark.colors},fonts:{...ni.Dark.fonts},numbers:{...ni.Dark.numbers},margins:{...ni.Dark.margins},arrowheads:{...ni.Dark.arrowheads}})),w.matchMedia&&(this.Ag=w.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.iu}set themeMap(e){this.iu!==e&&(this.iu=e,this.dw())}get defaultTheme(){return this.Tk}set defaultTheme(e){this.Tk!==e&&(u.s(e,"string",Is,"defaultTheme"),this.Tk=e,this.dw())}get currentTheme(){return this.Dk}set currentTheme(e){this.Dk!==e&&(u.s(e,"string",Is,"currentTheme"),this.Dk=e,this.dw())}get changesDivBackground(){return this.Fk}set changesDivBackground(e){if(this.Fk!==e&&(this.Fk=e,e))for(const t of this.ts)t.setDivBackground(this.findValue("div","","fill")),t.D("ThemeChanged",this)}get preferredColorScheme(){return this.Ag}addDiagram(e){return this.ts.add(e),this.aC(e),this}removeDiagram(e){return this.ts.delete(e),this.aC(e),this}hR(){var e;this.ts.size===0&&w.matchMedia&&((e=w.matchMedia("(prefers-color-scheme: dark)"))==null||e.addEventListener("change",this.HD))}aR(){var e;this.ts.size===0&&w.matchMedia&&((e=w.matchMedia("(prefers-color-scheme: dark)"))==null||e.removeEventListener("change",this.HD))}set(e,t){e===""&&(e=this.Tk),e==="system"&&(e=this.Ag);let i=this.iu.get(e);return i?i=this.qD(i,t):i=t,this.iu.set(e,i),this.dw(),this}findValue(e,t,i){return this.getValue(this.findTheme(this.currentTheme),e,t,i)||this.getValue(this.findTheme(this.defaultTheme),e,t,i)}getValue(e,t,i,s){var a;if(!e)return;i==null&&(i="");let n=e;const o=h=>{if(n===void 0||h==="")return;if(typeof h=="number"||!(Array.isArray(h)||h.includes(".")))return n[h];const l=Array.isArray(h)?h:h.split(".");for(let c=0;c<l.length;c++){const d=l[c];if(d!==""&&(n=n[d],n===void 0))return}return n},r=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof t=="number"?n=n[t%n.length]:n=o(t),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let h=(a=e.targetPropertyMap)==null?void 0:a.get(s);if(h?n=e[h]:(h=Is.cE.get(s),n=h?e[h]:e.colors),n=r(),n!==void 0)return n}return n}findTheme(e){return this.themeMap.get(e==="system"?this.Ag:e)}aC(e){const t=e.skipsUndoManager;e.skipsUndoManager=!0,e.updateAllThemeBindings(),this.Fk&&e.setDivBackground(this.findValue("div","","fill")),e.skipsUndoManager=t,e.D("ThemeChanged",this)}dw(){for(const e of this.ts)this.aC(e)}qD(e,t){for(const i in t)if(u.gw(t,i))try{t[i].constructor===Object?e[i]=this.qD(e[i]??{},t[i]):e[i]=t[i]}catch{delete e[i]}return e}};g(Is,"cE",new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]]));let mn=Is;class Aa{constructor(){g(this,"St");g(this,"N");g(this,"Oi");g(this,"cl");this.N=zt.um(),this.St="",this.Oi=!0,this.cl=!0}get name(){return this.St}set name(e){this.St=e}get isEnabled(){return this.Oi}set isEnabled(e){this.Oi=e}get isRealtime(){return this.cl}set isRealtime(e){this.cl=e}get diagram(){return this.N}set diagram(e){this.N!==e&&(this.N=e,e.bl=!0,e.requestUpdate())}invalidateRouter(){this.N!==null&&(this.N.bl=!0,this.N.requestUpdate())}canRoute(e){if(!this.isEnabled)return!1;const t=this.diagram;return!(t&&(!this.isRealtime&&t.gu||t.animationManager.isTicking))}routeLinks(e,t){}toString(){return this.name!==""?this.name+" Router":u.Dn(this.constructor)}}class Su extends Aa{constructor(e){super(),this.name="AvoidsNodes",e&&Object.assign(this,e)}canRoute(e){return(e instanceof zt?e.Vm:e.diagram.Vm)?super.canRoute(e):!1}routeLinks(e,t){const i=t instanceof zt?null:t,s=e.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const o=s.value;if(!o.isAvoiding||o.containingGroup!==i||o.toNode===null||o.fromNode===null||o.pointsCount<4)continue;o.startRoute();const r=o.pointsCount,a=o.getPoint(1),h=o.getPoint(r-2),l=o.fromNode.actualBounds.copy();l.inflate(St.Ua,St.Ua),l.unionPoint(o.getPoint(0));const c=o.toNode.actualBounds.copy();c.inflate(St.Ua,St.Ua),c.unionPoint(o.getPoint(r-1)),this.fE(o,l,c,n)&&this.uE(o,a,o.dN,h,o.gN,l,c,n),o.commitRoute()}}fE(e,t,i,s){const n=e.diagram,o=e.pointsCount;if(n===null||e.fromNode===e.toNode||e.layer.isTemporary||t.containsPoint(e.getPoint(o-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(e.segmentIndex===17)return!0;const r=e.getPoint(1),a=e.getPoint(o-2),h=e.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,h.x),Math.min(r.y,h.y),Math.abs(r.x-h.x),Math.abs(r.y-h.y)))return!0;for(let c=2;c<o-3;c++){const d=e.getPoint(c),f=e.getPoint(c+1);if(!s.isUnoccupied(Math.min(d.x,f.x),Math.min(d.y,f.y),Math.abs(d.x-f.x),Math.abs(d.y-f.y)))return!0}const l=e.getPoint(o-3);return!s.isUnoccupied(Math.min(l.x,a.x),Math.min(l.y,a.y),Math.abs(l.x-a.x),Math.abs(l.y-a.y))}uE(e,t,i,s,n,o,r,a){const h=e.diagram,l=t,c=s;let d=null,f=null;if(h.isVirtualized){const y=a.bounds.copy(),x=e.getPoint(2),b=e.getPoint(e.pointsCount-3);y.inflate(-a.cellWidth,-a.cellHeight);const M=C.l();a.vd(t.x,t.y)||(O.gl(y.x,y.y,y.x+y.width,y.y+y.height,t.x,t.y,x.x,x.y,M)?(d=t=M.copy(),i=M.directionPoint(x)):O.gl(y.x,y.y,y.x+y.width,y.y+y.height,x.x,x.y,b.x,b.y,M)?(d=t=M.copy(),i=M.directionPoint(b)):O.gl(y.x,y.y,y.x+y.width,y.y+y.height,b.x,b.y,s.x,s.y,M)&&(d=t=M.copy(),i=M.directionPoint(s))),a.vd(s.x,s.y)||(O.gl(y.x,y.y,y.x+y.width,y.y+y.height,s.x,s.y,b.x,b.y,M)?(f=s=M.copy(),n=b.directionPoint(M)):O.gl(y.x,y.y,y.x+y.width,y.y+y.height,b.x,b.y,x.x,x.y,M)?(f=s=M.copy(),n=x.directionPoint(M)):O.gl(y.x,y.y,y.x+y.width,y.y+y.height,x.x,x.y,t.x,t.y,M)&&(f=s=M.copy(),n=t.directionPoint(M))),C.e(M)}const m=o.copy().unionRect(r);m.inflate(a.cellWidth*a.Gc,a.cellHeight*a.Gc),a.NT(t,i,s,n,m,!0);let p=a.lo(s.x,s.y);if(!a.ky&&p>=Bi.Rd&&(a.rA(),m.inflate(a.cellWidth*a.HM,a.cellHeight*a.qM),a.NT(t,i,s,n,m,!1),p=a.lo(s.x,s.y)),!a.ky&&p<Bi.Rd&&!a.DO(s.x,s.y)){e.points.removeRange(2,e.pointsCount-3),this.cC(e,a,s.x,s.y,n,!0);const y=0,x=90,b=180,M=270,P=e.getPoint(2);if(e.pointsCount<4)i===y||i===b?(P.x=t.x,P.y=s.y):(P.x=s.x,P.y=t.y),e.setPointAt(2,P.x,P.y),e.insertPointAt(3,P.x,P.y);else{const k=e.getPoint(3);if(i===y||i===b)if(O.f(P.x,k.x)){const L=i===y?Math.max(P.x,t.x):Math.min(P.x,t.x);e.setPointAt(2,L,t.y),e.setPointAt(3,L,k.y)}else O.f(P.y,k.y)?(Math.abs(t.y-P.y)<=a.cellHeight/2&&(e.setPointAt(2,P.x,t.y),e.setPointAt(3,k.x,t.y)),e.insertPointAt(2,P.x,t.y)):e.setPointAt(2,t.x,P.y);else if(i===x||i===M)if(O.f(P.y,k.y)){const L=i===x?Math.max(P.y,t.y):Math.min(P.y,t.y);e.setPointAt(2,t.x,L),e.setPointAt(3,k.x,L)}else O.f(P.x,k.x)?(Math.abs(t.x-P.x)<=a.cellWidth/2&&(e.setPointAt(2,t.x,P.y),e.setPointAt(3,t.x,k.y)),e.insertPointAt(2,t.x,P.y)):e.setPointAt(2,P.x,t.y)}if(d!==null){const k=e.getPoint(1),L=e.getPoint(2);k.x!==L.x&&k.y!==L.y?i===y||i===b?e.insertPointAt(2,k.x,L.y):e.insertPointAt(2,L.x,k.y):i===y||i===b?e.insertPointAt(2,l.x,d.y):e.insertPointAt(2,d.x,l.y)}f!==null&&(n===y||n===b?e.insertPointAt(e.pointsCount-2,c.x,f.y):e.insertPointAt(e.pointsCount-2,f.x,c.y))}}cC(e,t,i,s,n,o){const r=t.cellWidth,a=t.cellHeight;let h=t.lo(i,s),l=i,c=s,d=l,f=c;for(n===0?d+=r:n===90?f+=a:n===180?d-=r:f-=a,e.yN&&h>Bi.Xa&&t.lo(d,f)!==h-1&&(t.lo(l-r,c)===h-1?(n=180,d=l-r,f=c):t.lo(l+r,c)===h-1?(n=0,d=l+r,f=c):t.lo(l,c-a)===h-1?(n=270,d=l,f=c-a):t.lo(l,c+a)===h-1&&(n=90,d=l,f=c+a));h>Bi.Xa&&t.lo(d,f)===h-1;)l=d,c=f,n===0?d+=r:n===90?f+=a:n===180?d-=r:f-=a,h-=1;if(o?h>Bi.Xa&&(n===180||n===0?l=Math.floor(l/r)*r+r/2:(n===90||n===270)&&(c=Math.floor(c/a)*a+a/2)):(l=Math.floor(l/r)*r+r/2,c=Math.floor(c/a)*a+a/2),h>Bi.Xa){let m=n,p=l,y=c;if(n===0?(m=90,y+=a):n===90?(m=180,p-=r):n===180?(m=270,y-=a):n===270&&(m=0,p+=r),t.lo(p,y)===h-1)this.cC(e,t,p,y,m,!1);else{let x=l,b=c;n===0?(m=270,b-=a):n===90?(m=0,x+=r):n===180?(m=90,b+=a):n===270&&(m=180,x-=r),t.lo(x,b)===h-1&&this.cC(e,t,x,b,m,!1)}}e.insertPointAt(e.pointsCount-2,l,c)}}Pe.prototype.initializeStandardTools=function(){this.Jt("Action",new Fn,this.mouseDownTools),this.Jt("Relinking",new xi,this.mouseDownTools),this.Jt("LinkReshaping",new Hi,this.mouseDownTools),this.Jt("Rotating",new Rn,this.mouseDownTools),this.Jt("Resizing",new Ns,this.mouseDownTools),this.Jt("Linking",new Fi,this.mouseMoveTools),this.Jt("Dragging",new Ne,this.mouseMoveTools),this.Jt("DragSelecting",new on,this.mouseMoveTools),this.Jt("Panning",new rn,this.mouseMoveTools),this.Jt("ContextMenu",new li,this.mouseUpTools),this.Jt("TextEditing",new qi,this.mouseUpTools),this.Jt("ClickCreating",new Cs,this.mouseUpTools),this.Jt("ClickSelecting",new nn,this.mouseUpTools)},zt.CM("GraphLinksModel",wu),zt.CM("TreeModel",bu);const Yn=w.go,pn={get version(){return zt.version},Group:Nt,List:Y,Set:I,Map:Z,Point:C,Size:rt,Rect:G,Margin:wt,Spot:U,Geometry:Tt,PathFigure:Gt,PathSegment:Mt,InputEvent:de,DiagramEvent:Ve,ChangedEvent:be,Model:te,GraphLinksModel:Os,TreeModel:Rs,Binding:Vi,ThemeBinding:Es,Transaction:Te,UndoManager:ze,CommandHandler:ei,Tool:ve,DraggingTool:Ne,DraggingInfo:ls,DraggingOptions:Bn,LinkingBaseTool:Ue,LinkingTool:Fi,RelinkingTool:xi,LinkReshapingTool:Hi,ResizingTool:Ns,RotatingTool:Rn,ClickSelectingTool:nn,ActionTool:Fn,ClickCreatingTool:Cs,HTMLInfo:Ti,ContextMenuTool:li,DragSelectingTool:on,PanningTool:rn,TextEditingTool:qi,ToolManager:Pe,Animation:Ii,AnimationManager:ti,AnimationTrigger:un,Layer:Xe,Diagram:zt,Palette:iu,Overview:Vn,Brush:Jt,GraphObject:Xt,Panel:bt,RowColumnDefinition:Me,Shape:At,TextBlock:ae,Picture:ii,Part:Ht,Adornment:Ft,Node:gt,Link:St,Placeholder:si,Layout:De,LayoutNetwork:_i,LayoutVertex:Zi,LayoutEdge:Ds,GridLayout:Kn,PanelLayout:Yt,CircularLayout:Fe,CircularNetwork:pa,CircularVertex:ya,CircularEdge:xa,ForceDirectedLayout:vu,ForceDirectedNetwork:wa,ForceDirectedVertex:ba,ForceDirectedEdge:va,LayeredDigraphLayout:fe,LayeredDigraphNetwork:Ma,LayeredDigraphVertex:gn,LayeredDigraphEdge:Na,TreeLayout:se,TreeNetwork:or,TreeVertex:ui,TreeEdge:Ta,Themes:ni,ThemeManager:mn,Router:Aa,AnimationStyle:ln,AutoScale:No,CycleMode:ra,Flip:la,TextFormat:Oo,ImageStretch:Fo,LayoutConditions:fa,LinkAdjusting:Vo,Curve:jo,Routing:zo,Orientation:To,TextOverflow:da,PortSpreading:ga,ScrollMode:aa,CollapsePolicy:ha,Sizing:Lo,TriggerStart:oa,Stretch:Co,ViewboxStretch:ca,Wrap:Eo,BrushType:Wi,ColorSpace:ua,GeometryStretch:re,GeometryType:ee,SegmentType:we,BindingMode:Un,ChangeType:ie,CircularArrangement:Go,CircularDirection:Ho,CircularNodeDiameterFormula:$o,CircularSorting:qo,GridAlignment:Uo,GridArrangement:Yo,GridSorting:Xo,LayeredDigraphAggressive:Zo,LayeredDigraphAlign:Pa,LayeredDigraphCycleRemove:Wo,LayeredDigraphInit:_o,LayeredDigraphLayering:Jo,LayeredDigraphPack:ka,TreeAlignment:er,TreeArrangement:nr,TreeCompaction:ir,TreeLayerStyle:Ca,TreePath:Qo,TreeSorting:tr,TreeStyle:sr,GestureMode:Ke,LinkingDirection:Gi,ReshapingBehavior:Ms,TextEditingAccept:hs,TextEditingStarting:an,TextEditingState:hn,WheelMode:je};for(const S in pn){const e=pn[S];u.it(e)&&e!==Oo&&(e.className=S)}u.G(Yn)&&Yn.version&&u.ni("WARNING: a `go` object on the root object is already defined.  "+("Debug"in Yn?"debug ":"")+"version: "+Yn.version+", replaced with version: "+pn.version),zt.prototype.go=pn,w.go=pn})();const st=typeof global<"u"?global.go:self.go;st.Group;st.List;st.Set;st.Map;st.Point;st.Size;st.Rect;st.Margin;st.Spot;st.Geometry;st.PathFigure;st.PathSegment;st.InputEvent;st.DiagramEvent;st.ChangedEvent;st.Model;const Qp=st.GraphLinksModel;st.TreeModel;const t0=st.Binding;st.ThemeBinding;st.Transaction;st.UndoManager;st.CommandHandler;st.Tool;st.DraggingTool;st.DraggingInfo;st.DraggingOptions;st.LinkingBaseTool;st.LinkingTool;st.RelinkingTool;st.LinkReshapingTool;st.ResizingTool;st.RotatingTool;st.ClickSelectingTool;st.ActionTool;st.ClickCreatingTool;st.HTMLInfo;st.ContextMenuTool;st.DragSelectingTool;st.PanningTool;st.TextEditingTool;st.ToolManager;st.Animation;st.AnimationManager;st.AnimationTrigger;st.Layer;const e0=st.Diagram;st.Palette;st.Overview;st.Brush;const Pr=st.GraphObject;st.Panel;st.RowColumnDefinition;const Th=st.Shape,i0=st.TextBlock;st.Picture;st.Part;st.Adornment;const s0=st.Node,Ah=st.Link;st.Placeholder;st.Layout;st.LayoutNetwork;st.LayoutVertex;st.LayoutEdge;st.GridLayout;st.PanelLayout;st.CircularLayout;st.CircularNetwork;st.CircularVertex;st.CircularEdge;st.ForceDirectedLayout;st.ForceDirectedNetwork;st.ForceDirectedVertex;st.ForceDirectedEdge;st.LayeredDigraphLayout;st.LayeredDigraphNetwork;st.LayeredDigraphVertex;st.LayeredDigraphEdge;const n0=st.TreeLayout;st.TreeNetwork;st.TreeVertex;st.TreeEdge;st.Themes;st.ThemeManager;st.Router;st.version;st.AnimationStyle;st.AutoScale;st.Curve;st.CycleMode;st.Flip;st.ImageStretch;st.LayoutConditions;st.LinkAdjusting;st.Orientation;st.PortSpreading;st.Routing;st.ScrollMode;st.CollapsePolicy;st.Sizing;st.TriggerStart;st.Stretch;st.TextFormat;st.TextOverflow;st.ViewboxStretch;st.Wrap;st.BrushType;st.ColorSpace;st.GeometryStretch;st.GeometryType;st.SegmentType;st.BindingMode;st.ChangeType;st.CircularArrangement;st.CircularDirection;st.CircularNodeDiameterFormula;st.CircularSorting;st.GridAlignment;st.GridArrangement;st.GridSorting;st.LayeredDigraphAggressive;st.LayeredDigraphAlign;st.LayeredDigraphCycleRemove;st.LayeredDigraphInit;st.LayeredDigraphLayering;st.LayeredDigraphPack;st.TreeAlignment;st.TreeArrangement;st.TreeCompaction;st.TreeLayerStyle;st.TreePath;st.TreeSorting;st.TreeStyle;st.GestureMode;st.LinkingDirection;st.ReshapingBehavior;st.TextEditingAccept;st.TextEditingStarting;st.TextEditingState;st.WheelMode;class Ql{constructor(u){this.containerElementId=u,this.diagram=null,this.init()}init(){console.log(" GoJS Maden Sistemi balatlyor..."),this.initDiagram(),this.setupNodeTemplates(),this.setupLinkTemplates(),console.log(" GoJS Maden Sistemi baaryla balatld!")}initDiagram(){const u=Pr.make;this.diagram=u(e0,this.containerElementId,{"undoManager.isEnabled":!0,layout:u(n0,{angle:90,layerSpacing:35})})}setupNodeTemplates(){const u=Pr.make;this.diagram.nodeTemplate=u(s0,"Auto",u(Th,"RoundedRectangle",{strokeWidth:0,fill:"lightblue"}),u(i0,{margin:8,stroke:"#333",font:"bold 14px sans-serif"},new t0("text","name")))}setupLinkTemplates(){const u=Pr.make;this.diagram.linkTemplate=u(Ah,{routing:Ah.Orthogonal,corner:5},u(Th,{strokeWidth:3,stroke:"#555"}))}getSampleData(){return{nodeDataArray:[{key:1,name:"Ana Maden",category:"mine"},{key:2,name:"Kmr Katman",category:"layer",parent:1},{key:3,name:"Demir Katman",category:"layer",parent:1},{key:4,name:"Ana Tnel",category:"tunnel",parent:1},{key:5,name:"Yan Galeri",category:"tunnel",parent:4}],linkDataArray:[{from:1,to:2},{from:1,to:3},{from:1,to:4},{from:4,to:5}]}}loadData(u){this.diagram.model=new Qp(u.nodeDataArray,u.linkDataArray)}loadSampleData(){this.loadData(this.getSampleData())}}window.MineGoJSSystem=Ql;window.MineGoJSSystem=Ql;
