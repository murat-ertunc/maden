<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Tunnel Designer Test</title>
    <script src="https://unpkg.com/gojs@3.0.26/release/go.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Simple Tunnel Designer Test</h1>
        
        <div class="alert alert-info">
            <strong>Status:</strong> <span id="status">Initializing...</span>
        </div>
        
        <div class="mb-3">
            <button id="btn-tunnel" class="btn btn-primary me-2">🚇 Tünel Çiz</button>
            <button id="btn-station" class="btn btn-success me-2">📍 İstasyon</button>
            <button id="btn-exit" class="btn btn-secondary">❌ Çıkış</button>
        </div>
        
        <div id="tunnel-diagram-container" class="border" style="width: 800px; height: 500px;">
            <!-- GoJS diagram will be here -->
        </div>
    </div>

    <script>
        // Basit TunnelDesigner implementation - inline
        class SimpleTunnelDesigner {
            constructor(containerId, config = {}) {
                this.containerId = containerId;
                this.config = {
                    gridSize: config.gridSize || 0.5,
                    showGrid: config.showGrid !== false,
                    snapToGrid: config.snapToGrid !== false,
                    ...config
                };
                
                this.diagram = null;
                this.isDrawing = false;
                this.drawingMode = null;
                this.currentTunnel = null;
                
                this.init();
            }
            
            init() {
                if (typeof go === 'undefined') {
                    throw new Error('GoJS library not loaded');
                }
                
                const $ = go.GraphObject.make;
                
                this.diagram = $(go.Diagram, this.containerId, {
                    "undoManager.isEnabled": true,
                    "grid.visible": this.config.showGrid,
                    "allowDrop": true,
                    "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
                    "initialContentAlignment": go.Spot.Center
                });
                
                // Basit node template
                this.diagram.nodeTemplate = $(go.Node, "Auto",
                    $(go.Shape, "RoundedRectangle", { fill: "lightblue", stroke: "darkblue" }),
                    $(go.TextBlock, { margin: 8 }, new go.Binding("text", "name"))
                );
                
                // Event listeners
                this.diagram.addDiagramListener("BackgroundSingleClicked", (e) => {
                    if (this.isDrawing) {
                        this.addPoint(e.diagram.lastInput.documentPoint);
                    }
                });
                
                console.log('✅ Simple TunnelDesigner initialized');
            }
            
            setDrawingMode(mode) {
                this.drawingMode = mode;
                this.isDrawing = true;
                this.diagram.div.style.cursor = 'crosshair';
                console.log(`Drawing mode: ${mode}`);
            }
            
            exitDrawingMode() {
                this.isDrawing = false;
                this.drawingMode = null;
                this.diagram.div.style.cursor = 'default';
                console.log('Drawing mode exited');
            }
            
            addPoint(point) {
                const nodeData = {
                    key: Date.now().toString(),
                    name: `Point ${this.diagram.model.nodeDataArray.length + 1}`,
                    loc: go.Point.stringify(point)
                };
                
                this.diagram.model.addNodeData(nodeData);
                console.log(`Point added: ${point.x}, ${point.y}`);
            }
        }
        
        // Initialize
        let designer = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            try {
                designer = new SimpleTunnelDesigner('tunnel-diagram-container');
                document.getElementById('status').textContent = 'Ready ✅';
                
                // Event listeners
                document.getElementById('btn-tunnel').addEventListener('click', () => {
                    designer.setDrawingMode('tunnel');
                    document.getElementById('status').textContent = 'Tunnel drawing mode';
                });
                
                document.getElementById('btn-station').addEventListener('click', () => {
                    designer.setDrawingMode('station');
                    document.getElementById('status').textContent = 'Station placement mode';
                });
                
                document.getElementById('btn-exit').addEventListener('click', () => {
                    designer.exitDrawingMode();
                    document.getElementById('status').textContent = 'Ready ✅';
                });
                
            } catch (error) {
                document.getElementById('status').textContent = 'Error: ' + error.message;
                console.error('Initialization error:', error);
            }
        });
    </script>
</body>
</html>